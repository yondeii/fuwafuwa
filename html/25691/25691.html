<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Visual Studio C#でESP32 Esp32If/RemoteEsp32導入編</title>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/css/mainday.css" title="default">
<link rel="alternate stylesheet" href="/css/mainnight.css" title="alternate">
<script type="text/javascript" src="/js/styleswitcher.js"></script>
<script type="text/javascript" src="/js/global.js"></script>
</head>
<body>
<div class="novelpage">
<div class="novelbody">
<div id="tateyoko">
<div id="_top"></div>
<a href="/">🏠</a>&emsp;
<a href="#" onclick="setActiveStyleSheet('default'); return false;">日</a>&emsp;
<a href="#" onclick="setActiveStyleSheet('alternate'); return false;">月</a>&emsp;
<a href="#_top" onclick="myFunction()" style="cursor: pointer;">縦書き／横書き</a>
<div id="calibre_link-0">
<div>
<div>
<table class="noveltitle">
<tr>
<td colspan="2"><i><span><i>Visual Studio C#でESP32 Esp32If/RemoteEsp32導入編</i></span></i></td>
</tr>
<tr>
                    
                    
      </tr>
<tr>
<td colspan="2">rapidnack</td>
</tr>
<tr>
<td colspan="2"> (2018)</td>
</tr>
<tr>
<td colspan="2"></td>
</tr>
</table>
<div></div>
</div>
<div></div>
</div>
</div>



<div id="calibre_link-1">
<div>
<p>&nbsp;<span>Visual Studio C#</span>
 &nbsp;</p>
<p>&nbsp;<span>で</span>
 &nbsp;</p>
<p>&nbsp;<span>ESP32</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Esp32If/RemoteEsp3</span>
<span>2</span>
<span>導入編</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>rapidnack&nbsp;--&nbsp;著</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<p>&nbsp;<span>・以下のサイトで、本書で掲載したソースコードを入手できます。</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://github.com/Rapidnack/Esp32IfTest">
<span><u>https://github.com/Rapidnack/Esp32IfTest</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="https://github.com/Rapidnack/RemoteEsp32">
<span><u>https://github.com/Rapidnack/RemoteEsp32</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>・本書中の会社名や商品名は、該当する各社の商標または登録商標です。本書中で</span>
<span>は</span>
<span>T</span>
<span>M</span>
<span>およ</span>
<span>び®</span>
<span>マークは省略させていただいております。</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<p>&nbsp;<a id="calibre_link-38"></a>
<a href="#calibre_link-2">
<span><u>はじめに</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-3">
<span><u>1</u></span>
<span><u>Visual Studio Communit</u></span>
<span><u>y</u></span>
<span><u>の準備</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-4">
<span><u>2</u></span>
<span><u>ESP3</u></span>
<span><u>2</u></span>
<span><u>の準備</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-5">
<span><u>3</u></span>
<span><u>Arduino ID</u></span>
<span><u>E</u></span>
<span><u>の準備</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-6">
<span><u>3.1</u></span>
<span><u>Arduino ID</u></span>
<span><u>E</u></span>
<span><u>をインストール</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-7">
<span><u>3.2</u></span>
<span><u>Arduino core for the ESP3</u></span>
<span><u>2</u></span>
<span><u>をインストール</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-8">
<span><u>3.3</u></span>
<span><u>RemoteEsp3</u></span>
<span><u>2</u></span>
<span><u>ライブラリをインストール</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-9">
<span><u>3.4</u></span>
<span><u>Oled Driver for SSD1306 displa</u></span>
<span><u>y</u></span>
<span><u>をインストール</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-10">
<span><u>3.5</u></span>
<span><u>AD9833 Librar</u></span>
<span><u>y</u></span>
<span><u>をインストール</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-11">
<span><u>3.6</u></span>
<span><u>Adafruit Unified senso</u></span>
<span><u>r</u></span>
<span><u>をインストール</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-12">
<span><u>3.7</u></span>
<span><u>Adafruit ADXL34</u></span>
<span><u>5</u></span>
<span><u>をインストール</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-13">
<span><u>3.8</u></span>
<span><u>サンプルスケッ</u></span>
<span><u>チ</u></span>
<span><u>Esp32ServerStaTest.in</u></span>
<span><u>o</u></span>
<span><u>を開く</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-14">
<span><u>4</u></span>
<span><u>アプリケーションの準備</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-15">
<span><u>5</u></span>
<span><u>デジタル入出力</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-16">
<span><u>6</u></span>
<span><u>外部割り込み</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-17">
<span><u>7</u></span>
<span><u>AD</u></span>
<span><u>C</u></span>
<span><u>グラフ表示</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-18">
<span><u>8</u></span>
<span><u>AD</u></span>
<span><u>C</u></span>
<span><u>グラフ表示多チャンネル化</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-19">
<span><u>9</u></span>
<span><u>AD</u></span>
<span><u>C</u></span>
<span><u>グラフ表示高速化</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-20">
<span><u>10</u></span>
<span><u>DAC</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-21">
<span><u>11</u></span>
<span><u>LED</u></span>
<span><u>C</u></span>
<span><u>（サーボパルス出力可能）</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-22">
<span><u>12</u></span>
<span><u>SPI</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-23">
<span><u>12.1</u></span>
<span><u>SP</u></span>
<span><u>I</u></span>
<span><u>関数を使う場合</u></span>
<span><u>（</u></span>
<span><u>AD983</u></span>
<span><u>3</u></span>
<span><u>）</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-24">
<span><u>12.2</u></span>
<span><u>ライブラリを使う場合</u></span>
<span><u>（</u></span>
<span><u>AD983</u></span>
<span><u>3</u></span>
<span><u>）</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-25">
<span><u>13</u></span>
<span><u>タッチセンサー</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-26">
<span><u>14</u></span>
<span><u>I2C</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-27">
<span><u>14.1</u></span>
<span><u>I2</u></span>
<span><u>C</u></span>
<span><u>関数を使う場合</u></span>
<span><u>（</u></span>
<span><u>ADXL34</u></span>
<span><u>5</u></span>
<span><u>）</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-28">
<span><u>14.2</u></span>
<span><u>ライブラリを使う場合</u></span>
<span><u>（</u></span>
<span><u>ADXL34</u></span>
<span><u>5</u></span>
<span><u>）</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-29">
<span><u>14.3</u></span>
<span><u>ライブラリを使う場合</u></span>
<span><u>（</u></span>
<span><u>SSD130</u></span>
<span><u>6</u></span>
<span><u>）</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-30">
<span><u>15</u></span>
<span><u>新規アプリケーション</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-31">
<span><u>15.1</u></span>
<span><u>新しいソリューションを作成</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-32">
<span><u>15.2</u></span>
<span><u>ライブラリプロジェクトを追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-33">
<span><u>15.3</u></span>
<span><u>ログ出力</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-34">
<span><u>15.4</u></span>
<span><u>例外対策</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-35">
<span><u>15.5</u></span>
<span><u>OxyPlot.WindowsForm</u></span>
<span><u>s</u></span>
<span><u>パッケージをインストール</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-36">
<span><u>15.6</u></span>
<span><u>PlotVie</u></span>
<span><u>w</u></span>
<span><u>を画面に追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-37">
<span><u>15.7</u></span>
<span><u>Esp32I</u></span>
<span><u>f</u></span>
<span><u>インスタンスを追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<a id="calibre_link-2"><b>
<span><b>はじめに</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>&nbsp;</span>
<a href="https://github.com/espressif/arduino-esp32">
<span><u>Arduino core for the ESP32</u></span>
</a>
<span>がライブラリマネージャからインストールできるようになり</span>
<span>、</span>
<span>ESP3</span>
<span>2</span>
<span>のプログラミングがますます手軽になりました。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>そこで、データのグラフ表示なども簡単になるように</span>
<span>、</span>
<span>Visual Studi</span>
<span>o</span>
<span>で作成し</span>
<span>た</span>
<span>Windows.Form</span>
<span>s</span>
<span>アプリケーションか</span>
<span>ら</span>
<span>Arduino core for the ESP3</span>
<span>2</span>
<span>の関数を実行できるようにしました</span>
<span>。</span>
<span>P</span>
<span>C</span>
<span>側</span>
<span>に</span>
<span>C</span>
<span>#</span>
<span>のライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>を</span>
<span>、</span>
<span>ESP3</span>
<span>2</span>
<span>側</span>
<span>に</span>
<span>Arduin</span>
<span>o</span>
<span>ライブラ</span>
<span>リ</span>
<span>RemoreEsp3</span>
<span>2</span>
<span>を追加し</span>
<span>て</span>
<span>Wif</span>
<span>i</span>
<span>で接続します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000030.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>L</span>
<span>チカは次のように記述できます。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>pinMode</span>
<span>(LED_PIN, Esp32If.GpioFunction.OUTPUT);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>digitalWrite</span>
<span>(LED_PIN, Esp32If.HIGH);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>digitalWrite</span>
<span>(LED_PIN, Esp32If.LOW);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>デジタル入力ピンの外部割り込みとタッチセンサーの割り込み</span>
<span>は</span>
<span>C</span>
<span>#</span>
<span>のメソッドを実行します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>esp32If.</span>
<span>attachInterrupt</span>
<span>(INTERRUPT_PIN, (gpio, millis) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"pin:&nbsp;</span>
<span>{gpio}</span>
<span>, value:&nbsp;</span>
<span>{esp32If.digitalRead(gpio)}</span>
<span>, milliseconds:&nbsp;</span>
<span>{millis}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>}, Esp32If.InterruptMode.CHANGE);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>esp32If.</span>
<span>touchAttachInterrupt</span>
<span>(12, (gpio, millis) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"pin:&nbsp;</span>
<span>{gpio}</span>
<span>, value:&nbsp;</span>
<span>{esp32If.touchRead(gpio)}</span>
<span>, milliseconds:&nbsp;</span>
<span>{millis}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>}, 30);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ライブラリの機能を説明するため</span>
<span>、</span>
<span>Windows.Form</span>
<span>s</span>
<span>アプリケーション</span>
<span>と</span>
<span>Arduin</span>
<span>o</span>
<span>スケッチ</span>
<span>を</span>
<span>GitHu</span>
<span>b</span>
<span>に用意しました</span>
<span>。</span>
<span>I2</span>
<span>Cは3</span>
<span>軸加速度センサモジュー</span>
<span>ル</span>
<span>ADXL34</span>
<span>5</span>
<span>を使って</span>
<span>、</span>
<span>SP</span>
<span>I</span>
<span>はプログラマブル波形発生</span>
<span>器</span>
<span>AD983</span>
<span>3</span>
<span>を使って説明します。またそれぞれのデバイス用に提供されているライブラリの関数</span>
<span>を</span>
<span>C</span>
<span>#</span>
<span>から使う方法も説明します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000075.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000088.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000048.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>、</span>
 &nbsp;</p>
<p>&nbsp;<span>Windows.Form</span>
<span>s</span>
<span>アプリケーショ</span>
<span>ン</span>
<span>Esp32IfTes</span>
<span>t</span>
<span>、</span>
 &nbsp;</p>
<p>&nbsp;<span>Arduin</span>
<span>o</span>
<span>ライブラ</span>
<span>リ</span>
<span>RemoteEsp3</span>
<span>2</span>
<span>、</span>
 &nbsp;</p>
<p>&nbsp;<span>Arduin</span>
<span>o</span>
<span>スケッ</span>
<span>チ</span>
<span>Esp32ServerStaTest.in</span>
<span>oを</span>
<span>GitHu</span>
<span>b</span>
<span>で公開しています。</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://github.com/Rapidnack/Esp32IfTest">
<span><u>https://github.com/Rapidnack/Esp32IfTest</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="https://github.com/Rapidnack/RemoteEsp32">
<span><u>https://github.com/Rapidnack/RemoteEsp32</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>201</span>
<span>8年</span>
<span>1</span>
<span>2</span>
<span>月&nbsp;rapidnack</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-3"><b>
<span><b>Visual Studio Communit</b></span>
<span><b>y</b></span>
<span><b>の準備</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>Visual Studio Community&nbsp;201</span>
<span>7</span>
<span>で動作確認をしています</span>
<span>。</span>
<span>Visual Studi</span>
<span>o</span>
<span>をインストールしていない場合は</span>
<span>、</span>
<span>Visual Studio Communit</span>
<span>y</span>
<span>をインストールしてください。</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://visualstudio.microsoft.com/ja/vs/community/">
<span><u>https://visualstudio.microsoft.com/ja/vs/community/</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000086.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-4"><b>
<span><b>ESP3</b></span>
<span><b>2</b></span>
<span><b>の準備</b></span>
</b></a>
</b></h1>
<p>&nbsp;<img src="images/000088.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>次のモジュールを使用します。</span>
 &nbsp;</p>
<p>&nbsp;<span>●</span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<span>ESP32-WROOM-32</span>
<span>&nbsp;</span>
<span>開発ボード</span>
 &nbsp;</p>
<p>&nbsp;<span>●</span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<span>有</span>
<span>機</span>
<span>E</span>
<span>L</span>
<span>ディスプレ</span>
<span>イ</span>
<span>SSD1306</span>
 &nbsp;</p>
<p>&nbsp;<span>●</span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<span>プログラマブル波形発生</span>
<span>器</span>
<span>AD9833</span>
 &nbsp;</p>
<p>&nbsp;<span>●</span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<span>3</span>
<span>軸加速度センサモジュー</span>
<span>ル</span>
<span>ADXL345</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>ESP32-WROOM-32</span>
<span>&nbsp;</span>
<span>開発ボード」以外は必須ではありません。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ブレッドボード</span>
<span>は</span>
<span>6</span>
<span>連結ピン</span>
<span>の「サンハヤト&nbsp;SAD-101</span>
<span>&nbsp;</span>
<span>ニューブレッドボード」が便利です。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>ESP32-WROOM-32</span>
<span>&nbsp;</span>
<span>開発ボード」の下の配線は次のようになっています。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000041.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-5"><b>
<span><b>Arduino ID</b></span>
<span><b>E</b></span>
<span><b>の準備</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>Arduino ID</span>
<span>E</span>
<span>をインストールし、インストールし</span>
<span>た</span>
<span>Arduino ID</span>
<span>E</span>
<span>に各種ライブラリをインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>3.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-6"><b>
<span><b>Arduino ID</b></span>
<span><b>E</b></span>
<span><b>をインストール</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>Arduino 1.8.</span>
<span>7</span>
<span>で動作確認しています。</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://www.arduino.cc/en/main/software">
<span><u>https://www.arduino.cc/en/main/software</u></span>
</a>
<span>か</span>
<span>ら</span>
<span>Arduino ID</span>
<span>E</span>
<span>をダウンロードしてインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>3.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-7"><b>
<span><b>Arduino core for the ESP3</b></span>
<span><b>2</b></span>
<span><b>をインストール</b></span>
</b></a>
</b></h2>
<p>&nbsp;<a href="https://github.com/espressif/arduino-esp32/blob/master/docs/arduino-ide/boards_manager.md">
<span><u>Installation instructions using Arduino IDE Boards Manager</u></span>
</a>
<span>の手順に従いインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>環境設定の「追加のボードマネージャ</span>
<span>の</span>
<span>UR</span>
<span>L</span>
<span>」に</span>
<span>「</span>
<span>https://dl.espressif.com/dl/package_esp32_index.jso</span>
<span>n</span>
<span>」を追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000045.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000090.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000000.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ボードマネージャで</span>
<span>「</span>
<span>esp3</span>
<span>2</span>
<span>」を検索してインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000080.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000064.jpg" alt="" />
 &nbsp;</p>
<h2><b>
<span><b>3.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-8"><b>
<span><b>RemoteEsp3</b></span>
<span><b>2</b></span>
<span><b>ライブラリをインストール</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>GitHub&nbsp;</span>
<a href="https://github.com/Rapidnack/RemoteEsp32">
<span><u>Rapidnack/RemoteEsp32</u></span>
</a>
<span>からライブラリ</span>
<span>を</span>
<span>ZI</span>
<span>P</span>
<span>ファイルでダウンロードしてインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000074.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000098.jpg" alt="" />
 &nbsp;</p>
<h2><b>
<span><b>3.4</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-9"><b>
<span><b>Oled Driver for SSD1306 displa</b></span>
<span><b>y</b></span>
<span><b>をインストール</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>ライブラリマネージャで検索してインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000013.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000037.jpg" alt="" />
 &nbsp;</p>
<h2><b>
<span><b>3.5</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-10"><b>
<span><b>AD9833 Librar</b></span>
<span><b>y</b></span>
<span><b>をインストール</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>GitHub&nbsp;</span>
<a href="https://github.com/Billwilliams1952/AD9833-Library-Arduino">
<span><u>Billwilliams1952/AD9833-Library-Arduino</u></span>
</a>
<span>からライブラリ</span>
<span>を</span>
<span>ZI</span>
<span>P</span>
<span>ファイルでダウンロードしてインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000063.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000098.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>3.6</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-11"><b>
<span><b>Adafruit Unified senso</b></span>
<span><b>r</b></span>
<span><b>をインストール</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>ライブラリマネージャで検索してインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000013.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000085.jpg" alt="" />
 &nbsp;</p>
<h2><b>
<span><b>3.7</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-12"><b>
<span><b>Adafruit ADXL34</b></span>
<span><b>5</b></span>
<span><b>をインストール</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>ライブラリマネージャで検索してインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000013.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000054.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>3.8</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-13"><b>
<span><b>サンプルスケッ</b></span>
<span><b>チ</b></span>
<span><b>Esp32ServerStaTest.in</b></span>
<span><b>o</b></span>
<span><b>を開く</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>RemoteEsp3</span>
<span>2</span>
<span>ライブラリに同梱されているサンプルスケッ</span>
<span>チ</span>
<span>Esp32ServerStaTest.in</span>
<span>o</span>
<span>を開きます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000015.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ssi</span>
<span>dと</span>
<span>passwor</span>
<span>d</span>
<span>を環境に合わせて変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000046.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>4</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-14"><b>
<span><b>アプリケーションの準備</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>GitHub&nbsp;</span>
<a href="https://github.com/Rapidnack/Esp32IfTest">
<span><u>https://github.com/Rapidnack/Esp32IfTest</u></span>
</a>
<span>か</span>
<span>ら</span>
<span>Windows.Form</span>
<span>s</span>
<span>アプリケーショ</span>
<span>ン</span>
<span>Esp32IfTes</span>
<span>tを</span>
<span>ZI</span>
<span>P</span>
<span>ファイルでダウンロードします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000003.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ZI</span>
<span>P</span>
<span>ファイルを解凍し、中のソリューションファイ</span>
<span>ル</span>
<span>Esp32IfTest.sl</span>
<span>n</span>
<span>を開きます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000096.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ビルドして実行すると次の画面が表示されます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000009.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ESP3</span>
<span>2の</span>
<span>I</span>
<span>P</span>
<span>アドレスを入力し、</span>
<span>「</span>
<span>Ope</span>
<span>n</span>
<span>」をクリックすると接続メッセージが２回表示されて、各種操作ボタンが有効になります。接続メッセージが２回表示されるのは、コマンド用と割り込み用に別々の接続を使用しているためです。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000101.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>以上で準備完了です。</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>5</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-15"><b>
<span><b>デジタル入出力</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>スケッチに記述する場合と同様の関数が使えます。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>void</span>
<span>&nbsp;pinMode(</span>
<span>int</span>
<span>&nbsp;pin, GpioFunction mode);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;digitalWrite(</span>
<span>int</span>
<span>&nbsp;pin,&nbsp;</span>
<span>int</span>
<span>&nbsp;val);</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;digitalRead(</span>
<span>int</span>
<span>&nbsp;pin);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下記</span>
<span>は</span>
<span>LE</span>
<span>Dを1</span>
<span>秒周期で点滅させる例です。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>ledCts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = ledCts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>pinMode</span>
<span>(16, Esp32If.GpioFunction.OUTPUT);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>digitalWrite</span>
<span>(16, Esp32If.HIGH);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>digitalWrite</span>
<span>(16, Esp32If.LOW);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションでは</span>
<span>ピ</span>
<span>ン</span>
<span>1</span>
<span>6と</span>
<span>GN</span>
<span>D</span>
<span>の間に抵抗</span>
<span>と</span>
<span>LE</span>
<span>D</span>
<span>を接続し</span>
<span>て1</span>
<span>秒周期で点滅させます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000052.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000082.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000106.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000020.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;LED_PIN = 16;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource ledCts;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonLedStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonLedStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonLedStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ledCts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = ledCts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>pinMode</span>
<span>(LED_PIN, Esp32If.GpioFunction.OUTPUT);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>digitalWrite</span>
<span>(LED_PIN, Esp32If.HIGH);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>digitalWrite</span>
<span>(LED_PIN, Esp32If.LOW);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(GpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ledCts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonLedStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonLedStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonLedStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ledCts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>6</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-16"><b>
<span><b>外部割り込み</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>スケッチに記述する場合と同様の関数が使えます。デジタル入力ピンのレベルの変化</span>
<span>で</span>
<span>C</span>
<span>#</span>
<span>のメソッドが実行されます。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>void</span>
<span>&nbsp;attachInterrupt(</span>
<span>int</span>
<span>&nbsp;pin, Action&lt;</span>
<span>int</span>
<span>, UInt32&gt; f, InterruptMode mode);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;detachInterrupt(</span>
<span>int</span>
<span>&nbsp;pin);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下記は</span>
<span>ピ</span>
<span>ン4</span>
<span>に割り込みを登録する例です。ピ</span>
<span>ン4の</span>
<span>Hi/Lo</span>
<span>w</span>
<span>が変化したとき、</span>
<span>ログ画面にピン番号、値、時刻（ミリ秒）を表示します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>esp32If.</span>
<span>attachInterrupt</span>
<span>(4, (gpio, millis) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"pin:&nbsp;</span>
<span>{gpio}</span>
<span>, value:&nbsp;</span>
<span>{esp32If.digitalRead(gpio)}</span>
<span>, milliseconds:&nbsp;</span>
<span>{millis}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>}, Esp32If.InterruptMode.CHANGE);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下記は</span>
<span>ピ</span>
<span>ン4</span>
<span>の割り込みを解除する例です。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>esp32If.</span>
<span>detachInterrupt</span>
<span>(4);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションでは、ピ</span>
<span>ン</span>
<span>1</span>
<span>6</span>
<span>の出力をピン４に入力します。ピ</span>
<span>ン</span>
<span>1</span>
<span>6</span>
<span>の値が変化するたびにピ</span>
<span>ン4</span>
<span>に登録し</span>
<span>た</span>
<span>C</span>
<span>#</span>
<span>のメソッドが実行され、</span>
<span>ログ画面にピン番号、値、タイムスタンプ（ミリ秒）を表示されます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000084.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000067.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000099.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;LED_PIN = 16;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;INTERRUPT_PIN = 4;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource ledCts;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonLedStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonLedStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonLedStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ledCts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = ledCts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>attachInterrupt</span>
<span>(INTERRUPT_PIN, (gpio, millis) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"pin:&nbsp;</span>
<span>{gpio}</span>
<span>, value:&nbsp;</span>
<span>{esp32If.digitalRead(gpio)}</span>
<span>, milliseconds:&nbsp;</span>
<span>{millis}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>}, Esp32If.InterruptMode.CHANGE);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.pinMode(LED_PIN, Esp32If.GpioFunction.OUTPUT);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.digitalWrite(LED_PIN, Esp32If.HIGH);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.digitalWrite(LED_PIN, Esp32If.LOW);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>detachInterrupt</span>
<span>(INTERRUPT_PIN);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(GpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ledCts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonLedStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonLedStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonLedStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ledCts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>7</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-17"><b>
<span><b>AD</b></span>
<span><b>C</b></span>
<span><b>グラフ表示</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>スケッチに記述する場合と同様の関数が使えます。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>int</span>
<span>&nbsp;analogRead(</span>
<span>int</span>
<span>&nbsp;pin);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;analogReadResolution(</span>
<span>int</span>
<span>&nbsp;bits);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;analogSetWidth(</span>
<span>int</span>
<span>&nbsp;bits);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;analogSetCycles(</span>
<span>int</span>
<span>&nbsp;cycles);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;analogSetSamples(</span>
<span>int</span>
<span>&nbsp;samples);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;analogSetClockDiv(</span>
<span>int</span>
<span>&nbsp;clockDiv);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;analogSetAttenuation(AdcAttenuation attenuation);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;analogSetPinAttenuation(</span>
<span>int</span>
<span>&nbsp;pin, AdcAttenuation adcAttenuation);</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;hallRead();</span>
 &nbsp;</p>
<p>&nbsp;<span>bool</span>
<span>&nbsp;adcAttachPin(</span>
<span>int</span>
<span>&nbsp;pin);</span>
 &nbsp;</p>
<p>&nbsp;<span>bool</span>
<span>&nbsp;adcStart(</span>
<span>int</span>
<span>&nbsp;pin);</span>
 &nbsp;</p>
<p>&nbsp;<span>bool</span>
<span>&nbsp;adcBusy(</span>
<span>int</span>
<span>&nbsp;pin);</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;adcEnd(</span>
<span>int</span>
<span>&nbsp;pin);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下記はアナログ入力ピ</span>
<span>ン</span>
<span>3</span>
<span>9</span>
<span>（</span>
<span>ADC</span>
<span>3</span>
<span>、シルク表記</span>
<span>は</span>
<span>SV</span>
<span>N</span>
<span>）</span>
<span>のアッテネータ</span>
<span>を</span>
<span>11d</span>
<span>B</span>
<span>に設定し電源電</span>
<span>圧</span>
<span>3.3</span>
<span>V</span>
<span>をフルスケールにしています。デフォルトの分解能</span>
<span>は</span>
<span>1</span>
<span>2</span>
<span>ビットなの</span>
<span>で</span>
<span>analogRead(</span>
<span>)</span>
<span>で取得した値</span>
<span>が</span>
<span>409</span>
<span>6</span>
<span>のと</span>
<span>き</span>
<span>3.3</span>
<span>V</span>
<span>になるように換算しています。アッテネータ</span>
<span>を</span>
<span>0d</span>
<span>B</span>
<span>に設定する</span>
<span>と</span>
<span>1.1</span>
<span>V</span>
<span>フルスケールになります。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>rollCts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = rollCts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>analogSetPinAttenuation</span>
<span>(39, Esp32If.AdcAttenuation.ADC_11db);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;volt =&nbsp;3.3&nbsp;* esp32If.</span>
<span>analogRead</span>
<span>(39) / 4096.0;</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"</span>
<span>{volt.ToString(</span>
<span>"0.0"</span>
<span>)}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションでは、デジタルピ</span>
<span>ン</span>
<span>1</span>
<span>6</span>
<span>の出力をアナログ</span>
<span>入力</span>
<span>ピ</span>
<span>ン</span>
<span>3</span>
<span>9（</span>
<span>ADC</span>
<span>3</span>
<span>、シルク表記</span>
<span>は</span>
<span>SV</span>
<span>N</span>
<span>）に入力します。ピ</span>
<span>ン</span>
<span>1</span>
<span>6</span>
<span>の値の変化をグラフに表示します</span>
<span>。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000039.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000004.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000066.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;ROLL_ADC_PIN = 39;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource rollCts;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonRollStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonRollStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonRollStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;ADC_SCALE = 3.3;</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;NUM_SAMPLES = 200;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>PlotModel plotModel =&nbsp;</span>
<span>new</span>
<span>&nbsp;PlotModel();</span>
 &nbsp;</p>
<p>&nbsp;<span>LineSeries lineSeries =&nbsp;</span>
<span>new</span>
<span>&nbsp;LineSeries() { Title =&nbsp;</span>
<span>"ADC3"</span>
<span>&nbsp;};</span>
 &nbsp;</p>
<p>&nbsp;<span>LinearAxis linearAxis =&nbsp;</span>
<span>new</span>
<span>&nbsp;LinearAxis() { Position = AxisPosition.Left, Minimum = 0 - 0.1, Maximum = ADC_SCALE + 0.1 };</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Series.Add(lineSeries);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Axes.Add(linearAxis);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Model = plotModel;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>rollCts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = rollCts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>analogSetPinAttenuation</span>
<span>(ROLL_ADC_PIN, Esp32If.AdcAttenuation.ADC_11db);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>lineSeries.Points.Clear();</span>
 &nbsp;</p>
<p>&nbsp;<span>DateTime start = DateTime.Now;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>TimeSpan ts = DateTime.Now - start;</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;volt = ADC_SCALE * esp32If.</span>
<span>analogRead</span>
<span>(ROLL_ADC_PIN) / 4096.0;</span>
 &nbsp;</p>
<p>&nbsp;<span>DataPoint dataPoint =&nbsp;</span>
<span>new</span>
<span>&nbsp;DataPoint(ts.TotalSeconds, volt);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(lineSeries.Points.Count &gt;= NUM_SAMPLES)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>lineSeries.Points.RemoveAt(0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>lineSeries.Points.Add(dataPoint);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.InvalidatePlot(</span>
<span>true</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Invalidate();</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(GpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>rollCts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonRollStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonRollStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonRollStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>rollCts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>8</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-18"><b>
<span><b>AD</b></span>
<span><b>C</b></span>
<span><b>グラフ表示多チャンネル化</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>ADC</span>
<span>4、5、6、7</span>
<span>の４チャンネルのデータをグラフに表示します</span>
<span>。</span>
<span>C</span>
<span>#</span>
<span>から４</span>
<span>回</span>
<span>analogRead(</span>
<span>)</span>
<span>を実行するよ</span>
<span>り</span>
<span>ESP3</span>
<span>2</span>
<span>側で４チャンネル分のデータを纏めて取得するコマンドを追加した方が時間差の少ないのデータを取得できます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000049.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>か</span>
<span>ら</span>
<span>Arduin</span>
<span>o</span>
<span>ライブラ</span>
<span>リ</span>
<span>RemoteEsp3</span>
<span>2</span>
<span>に送るコマンドのフォーマットは次のようになります。基本</span>
<span>は</span>
<span>3</span>
<span>2</span>
<span>ビット整数４個</span>
<span>、</span>
<span>1</span>
<span>6</span>
<span>バイトです。引数が３個以上の場合や文字列などの場合は</span>
<span>、</span>
<span>extsByte</span>
<span>s</span>
<span>にバイト数をセットして後に追加します。文字列の場合</span>
<span>は</span>
<span>C+</span>
<span>+</span>
<span>側で便利なようにゼロを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000028.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>コマンドの応答のフォーマットは次のようになります</span>
<span>。</span>
<span>erro</span>
<span>rは</span>
<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>内部で使用します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000092.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>独自に追加するコマンド</span>
<span>の</span>
<span>I</span>
<span>Dは</span>
<span>1000</span>
<span>0</span>
<span>以上にします。今回のコマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000094.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションに次のコードを追加しています</span>
<span>。</span>
<span>extsByte</span>
<span>s</span>
<span>分のバイト列</span>
<span>が</span>
<span>rxBu</span>
<span>f</span>
<span>に入るの</span>
<span>で</span>
<span>BytesToIntArray(</span>
<span>)で</span>
<span>in</span>
<span>t</span>
<span>配列に変換します</span>
<span>。</span>
<span>in</span>
<span>t</span>
<span>配列に</span>
<span>は</span>
<span>AD</span>
<span>C</span>
<span>の値とタイムスタン</span>
<span>プ(</span>
<span>ミリ</span>
<span>秒)</span>
<span>が交互に並んでいます</span>
<span>。</span>
<span>GpioCommand(</span>
<span>)</span>
<span>の戻り</span>
<span>値</span>
<span>resul</span>
<span>t</span>
<span>は使いません。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;ANALOG_READ_4 = 10000;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>int</span>
<span>[] analogRead4()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>byte</span>
<span>[] rxBuf;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>GpioCommand</span>
<span>(ANALOG_READ_4, 0, 0,&nbsp;</span>
<span>out</span>
<span>&nbsp;rxBuf);</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>&nbsp;esp32If.</span>
<span>BytesToIntArray</span>
<span>(rxBuf);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Arduin</span>
<span>o</span>
<span>のサンプルスケッチに次のコードを追加しています</span>
<span>。</span>
<span>intToBytes( , buffer + 12</span>
<span>)で</span>
<span>extsByte</span>
<span>s</span>
<span>を</span>
<span>、</span>
<span>intsToBytes( , buffer + 16</span>
<span>)で</span>
<span>AD</span>
<span>C</span>
<span>の値とタイムスタンプを４組バッファーにセットしています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>#define ANALOG_READ_4 10000</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void&nbsp;</span>
<span>callback</span>
<span>(byte* buffer, int command, int p1, int p2, int extsBytes) {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; switch (command) {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define ANALOG_READ_4 10000</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case ANALOG_READ_4: {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int NUM_CH = 4;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int adcPins[NUM_CH] = { 32, 33, 34, 35 };</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int adcBuf[NUM_CH * 2];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int ch = 0; ch &lt; NUM_CH; ch++) {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; adcBuf[ch * 2] = analogRead(adcPins[ch]);&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; adcBuf[ch * 2 + 1] = millis();&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; extsBytes = (NUM_CH * 2) * 4;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoteEsp32.</span>
<span>intToBytes</span>
<span>(extsBytes, buffer + 12);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoteEsp32.</span>
<span>intsToBytes</span>
<span>(adcBuf, NUM_CH * 2, buffer + 16);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>以上でコマンドを追加できました。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションでは、アナログ</span>
<span>入力</span>
<span>ピ</span>
<span>ン</span>
<span>3</span>
<span>2、</span>
<span>3</span>
<span>3、</span>
<span>3</span>
<span>4、</span>
<span>3</span>
<span>5（</span>
<span>ADC</span>
<span>4、5、6、7</span>
<span>）の値の変化をグラフに表示します</span>
<span>。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000078.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>動作確認のため</span>
<span>、</span>
<span>DA</span>
<span>C</span>
<span>出力ピ</span>
<span>ン</span>
<span>2</span>
<span>5</span>
<span>をアナログ入力ピ</span>
<span>ン</span>
<span>3</span>
<span>2（</span>
<span>ADC</span>
<span>4</span>
<span>）に</span>
<span>、</span>
<span>DA</span>
<span>C</span>
<span>出力ピ</span>
<span>ン</span>
<span>2</span>
<span>6</span>
<span>をアナログ入力ピ</span>
<span>ン</span>
<span>3</span>
<span>3（</span>
<span>ADC</span>
<span>5</span>
<span>）に接続します。トラックバー</span>
<span>で</span>
<span>DA</span>
<span>C</span>
<span>の出力レベルを変化させグラフに表示します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000102.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000014.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource rollMultiCts;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;ANALOG_READ_4 = 10000;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>int</span>
<span>[]&nbsp;</span>
<span>analogRead4</span>
<span>()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>byte</span>
<span>[] rxBuf;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.GpioCommand(ANALOG_READ_4, 0, 0,&nbsp;</span>
<span>out</span>
<span>&nbsp;rxBuf);</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>&nbsp;esp32If.BytesToIntArray(rxBuf);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonRollMultiStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonRollMultiStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonRollMultiStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;ADC_SCALE = 3.3;</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>[] adcPins = { 32, 33, 34, 35 };</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>[] adcCHs = { 4, 5, 6, 7 };</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;NUM_CHANNELS = 4;</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;NUM_SAMPLES = 200;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>PlotModel plotModel =&nbsp;</span>
<span>new</span>
<span>&nbsp;PlotModel();</span>
 &nbsp;</p>
<p>&nbsp;<span>LineSeries[] lineSeries =&nbsp;</span>
<span>new</span>
<span>&nbsp;LineSeries[NUM_CHANNELS];</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>lineSeries[ch] =&nbsp;</span>
<span>new</span>
<span>&nbsp;LineSeries();</span>
 &nbsp;</p>
<p>&nbsp;<span>lineSeries[ch].Title =&nbsp;</span>
<span>string</span>
<span>.Format(</span>
<span>$"ADC</span>
<span>{adcCHs[ch]}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Series.Add(lineSeries[ch]);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Axes.Add(</span>
 &nbsp;</p>
<p>&nbsp;<span>new</span>
<span>&nbsp;LinearAxis() { Position = AxisPosition.Left, Minimum = 0 - 0.1, Maximum = ADC_SCALE + 0.1 }</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Model = plotModel;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>rollMultiCts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = rollMultiCts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.analogSetPinAttenuation(adcPins[ch], Esp32If.AdcAttenuation.ADC_11db);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>lineSeries[ch].Points.Clear();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>DateTime start = DateTime.Now;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>[] volts =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>double</span>
<span>[NUM_CHANNELS];</span>
 &nbsp;</p>
<p>&nbsp;<span>DataPoint[] dataPoints =&nbsp;</span>
<span>new</span>
<span>&nbsp;DataPoint[NUM_CHANNELS];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>[] ints =&nbsp;</span>
<span>analogRead4</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(ints.Length != NUM_CHANNELS * 2)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>TimeSpan ts = DateTime.Now - start;</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;volt = ADC_SCALE * ints[ch * 2] / 4096.0;</span>
 &nbsp;</p>
<p>&nbsp;<span>volts[ch] = volt;</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[ch] =&nbsp;</span>
<span>new</span>
<span>&nbsp;DataPoint(ts.TotalSeconds, volt);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(lineSeries[ch].Points.Count &gt;= NUM_SAMPLES)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>lineSeries[ch].Points.RemoveAt(0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>lineSeries[ch].Points.Add(dataPoints[ch]);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.InvalidatePlot(</span>
<span>true</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Invalidate();</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(GpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>rollMultiCts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonRollMultiStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonRollMultiStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonRollMultiStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>rollMultiCts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>9</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-19"><b>
<span><b>AD</b></span>
<span><b>C</b></span>
<span><b>グラフ表示高速化</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>ledcWrite(</span>
<span>)</span>
<span>で発生させるサーボモーター用のパルスを確認するため</span>
<span>に</span>
<span>AD</span>
<span>C</span>
<span>グラフを高速化します</span>
<span>。</span>
<span>C</span>
<span>#</span>
<span>か</span>
<span>ら</span>
<span>analogRead(</span>
<span>)</span>
<span>を実行せず</span>
<span>に</span>
<span>ESP3</span>
<span>2</span>
<span>側でグラ</span>
<span>フ1</span>
<span>枚分のデータを纏めて取得するコマンドを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000010.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>か</span>
<span>ら</span>
<span>Arduin</span>
<span>o</span>
<span>ライブラ</span>
<span>リ</span>
<span>RemoteEsp3</span>
<span>2</span>
<span>に送るコマンドのフォーマットは次のようになります。基本</span>
<span>は</span>
<span>3</span>
<span>2</span>
<span>ビット整数４個</span>
<span>、</span>
<span>1</span>
<span>6</span>
<span>バイトです。引数が３個以上の場合や文字列などの場合は</span>
<span>、</span>
<span>extsByte</span>
<span>s</span>
<span>にバイト数をセットして後に追加します。文字列の場合</span>
<span>は</span>
<span>C+</span>
<span>+</span>
<span>側で便利なようにゼロを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000028.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>コマンドの応答のフォーマットは次のようになります</span>
<span>。</span>
<span>erro</span>
<span>rは</span>
<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>内部で使用します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000092.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>独自に追加するコマンド</span>
<span>の</span>
<span>I</span>
<span>Dは</span>
<span>1000</span>
<span>0</span>
<span>以上にします。今回のコマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000026.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションに次のコードを追加しました</span>
<span>。</span>
<span>extsByte</span>
<span>s</span>
<span>分のバイト列</span>
<span>が</span>
<span>rxBu</span>
<span>f</span>
<span>に入るの</span>
<span>で</span>
<span>BytesToIntArray(</span>
<span>)で</span>
<span>in</span>
<span>t</span>
<span>配列に変換します</span>
<span>。</span>
<span>in</span>
<span>t</span>
<span>配列に</span>
<span>は</span>
<span>AD</span>
<span>C</span>
<span>の値とタイムスタン</span>
<span>プ(</span>
<span>ミリ</span>
<span>秒)</span>
<span>が交互に並んでいます</span>
<span>。</span>
<span>GpioCommand(</span>
<span>)</span>
<span>の戻り</span>
<span>値</span>
<span>resul</span>
<span>t</span>
<span>は使いません。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;ANALOG_FAST_READ = 10001;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>int</span>
<span>[] analogFastRead(</span>
<span>int</span>
<span>&nbsp;pin,&nbsp;</span>
<span>int</span>
<span>&nbsp;samples)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>byte</span>
<span>[] rxBuf;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>GpioCommand</span>
<span>(ANALOG_FAST_READ, pin, samples,&nbsp;</span>
<span>out</span>
<span>&nbsp;rxBuf);</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>&nbsp;esp32If.</span>
<span>BytesToIntArray</span>
<span>(rxBuf);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Arduin</span>
<span>o</span>
<span>のサンプルスケッチに次のコードを追加しています。</span>
 &nbsp;</p>
<p>&nbsp;<span>入力レベルの立ち上がりをグラフ</span>
<span>の</span>
<span>10</span>
<span>%</span>
<span>の位置に固定する簡単なトリガ機能を実装しています。コマンドを受け取るとサンプル数全体</span>
<span>の</span>
<span>10</span>
<span>%</span>
<span>を取得してから入力レベルの立ち上がりを待ちます。立ち上がりを検出後サンプル数全体</span>
<span>の</span>
<span>90</span>
<span>%</span>
<span>を取得してグラ</span>
<span>フ1</span>
<span>枚分のデータを送り返します。</span>
 &nbsp;</p>
<p>&nbsp;<span>intToBytes( , buffer + 12</span>
<span>)で</span>
<span>extsByte</span>
<span>s</span>
<span>を</span>
<span>、</span>
<span>intsToBytes( , buffer + 16</span>
<span>)で</span>
<span>AD</span>
<span>C</span>
<span>の値とタイムスタンプをバッファーにセットしています。</span>
 &nbsp;</p>
<p>&nbsp;<span>バッファー上のデータは時間順に並んでいませんが測定時刻</span>
<span>も</span>
<span>micros(</span>
<span>)</span>
<span>で取得しているので、サンプルアプリケーション側でソートしてグラフに表示します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>#define ANALOG_FAST_READ 10001</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void callback(byte* buffer, int command, int p1, int p2, int extsBytes) {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; switch (command) {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define ANALOG_FAST_READ 10001</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case ANALOG_FAST_READ: {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int adcBuf[p2 * 2];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pos = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int n = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; (p2 * 10) / 100; i++) { //&nbsp;10% pre trigger</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; adcBuf[pos * 2] =&nbsp;</span>
<span>analogRead</span>
<span>(p1);&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; adcBuf[pos * 2 + 1] =&nbsp;</span>
<span>micros</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pos = (pos &lt; p2 - 1) ? pos + 1 : 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (n &lt; p2 * 50) {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int val =&nbsp;</span>
<span>analogRead</span>
<span>(p1);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; adcBuf[pos * 2] = val;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; adcBuf[pos * 2 + 1] =&nbsp;</span>
<span>micros</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pos = (pos &lt; p2 - 1) ? pos + 1 : 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (val &lt; 0x800) break;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (n &lt; p2 * 50) {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int val =&nbsp;</span>
<span>analogRead</span>
<span>(p1);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; adcBuf[pos * 2] = val;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; adcBuf[pos * 2 + 1] =&nbsp;</span>
<span>micros</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pos = (pos &lt; p2 - 1) ? pos + 1 : 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (val &gt;= 0x800) break;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; (p2 * 90) / 100; i++) { //&nbsp;90% post trigger</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; adcBuf[pos * 2] =&nbsp;</span>
<span>analogRead</span>
<span>(p1);&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; adcBuf[pos * 2 + 1] =&nbsp;</span>
<span>micros</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pos = (pos &lt; p2 - 1) ? pos + 1 : 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; extsBytes = (p2 * 2) * 4;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoteEsp32.</span>
<span>intToBytes</span>
<span>(extsBytes, buffer + 12);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoteEsp32.</span>
<span>intsToBytes</span>
<span>(adcBuf, p2 * 2, buffer + 16);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>以上でコマンドを追加できました。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションでは、アナログ入力ピ</span>
<span>ン</span>
<span>3</span>
<span>6（</span>
<span>ADC</span>
<span>0</span>
<span>、シルク表記</span>
<span>は</span>
<span>SV</span>
<span>P</span>
<span>）の値の変化をグラフに表示します</span>
<span>。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000091.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>動作確認のため</span>
<span>、</span>
<span>LED</span>
<span>C</span>
<span>出力ピ</span>
<span>ン</span>
<span>2</span>
<span>7</span>
<span>をアナログ入力ピ</span>
<span>ン</span>
<span>3</span>
<span>6（</span>
<span>ADC</span>
<span>0</span>
<span>、シルク表記</span>
<span>は</span>
<span>SV</span>
<span>P</span>
<span>）に接続します。トラックバー</span>
<span>で</span>
<span>LED</span>
<span>C</span>
<span>の出力パルス幅を変化させグラフに表示します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000001.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000105.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<p>&nbsp;<span>フルスケールを変更したとき</span>
<span>は</span>
<span>Tas</span>
<span>k</span>
<span>を一度キャンセルしてやり直すよう</span>
<span>に</span>
<span>do { } whil</span>
<span>e</span>
<span>ループで括っています。</span>
 &nbsp;</p>
<p>&nbsp;<span>更新間隔</span>
<span>を</span>
<span>33m</span>
<span>s</span>
<span>以上に抑えています。</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints.OrderBy(</span>
<span>)</span>
<span>で取得したデータをタイムスタンプ順に並び替えています。</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints.Select(</span>
<span>)で</span>
<span>10</span>
<span>%</span>
<span>位置のデータの</span>
<span>タイムスタンプ</span>
<span>を0</span>
<span>にしています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;FAST_ADC_PIN = 36;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource fastCts;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>bool</span>
<span>&nbsp;repeatRequested;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;ANALOG_FAST_READ = 10001;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>int</span>
<span>[]&nbsp;</span>
<span>analogFastRead</span>
<span>(</span>
<span>int</span>
<span>&nbsp;pin,&nbsp;</span>
<span>int</span>
<span>&nbsp;samples)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>byte</span>
<span>[] rxBuf;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.GpioCommand(ANALOG_FAST_READ, pin, samples,&nbsp;</span>
<span>out</span>
<span>&nbsp;rxBuf);</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>&nbsp;esp32If.BytesToIntArray(rxBuf);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonFastStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>do</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonFastStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonFastStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;ADC_SCALE;</span>
 &nbsp;</p>
<p>&nbsp;<span>Esp32If.AdcAttenuation att;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(radioButton1v.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ADC_SCALE = 1.1;</span>
 &nbsp;</p>
<p>&nbsp;<span>att = Esp32If.AdcAttenuation.ADC_0db;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ADC_SCALE = 3.3;</span>
 &nbsp;</p>
<p>&nbsp;<span>att = Esp32If.AdcAttenuation.ADC_11db;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;NUM_SAMPLES = 200;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>PlotModel plotModel =&nbsp;</span>
<span>new</span>
<span>&nbsp;PlotModel();</span>
 &nbsp;</p>
<p>&nbsp;<span>LineSeries lineSeries =&nbsp;</span>
<span>new</span>
<span>&nbsp;LineSeries() { Title =&nbsp;</span>
<span>"ADC0"</span>
<span>&nbsp;};</span>
 &nbsp;</p>
<p>&nbsp;<span>LinearAxis linearAxis =&nbsp;</span>
<span>new</span>
<span>&nbsp;LinearAxis() { Position = AxisPosition.Left, Minimum = 0 - 0.1, Maximum = ADC_SCALE + 0.1 };</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Series.Add(lineSeries);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Axes.Add(linearAxis);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Model = plotModel;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>fastCts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = fastCts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.analogSetPinAttenuation(FAST_ADC_PIN, att);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>DateTime lastAccessTime = DateTime.MinValue;</span>
 &nbsp;</p>
<p>&nbsp;<span>lineSeries.Points.Clear();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;leftInMS =&nbsp;</span>
<span>33</span>
<span>&nbsp;- (</span>
<span>int</span>
<span>)(DateTime.Now - lastAccessTime).TotalMilliseconds;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(leftInMS &lt;= 0)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(Math.Min(leftInMS, 10), ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>[] ints =&nbsp;</span>
<span>analogFastRead</span>
<span>(FAST_ADC_PIN, NUM_SAMPLES);</span>
 &nbsp;</p>
<p>&nbsp;<span>lastAccessTime = DateTime.Now;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(ints.Length != 2 * NUM_SAMPLES)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>DataPoint[] dataPoints =&nbsp;</span>
<span>new</span>
<span>&nbsp;DataPoint[NUM_SAMPLES];</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;i = 0; i &lt; NUM_SAMPLES; i++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;volt = ADC_SCALE * ints[2 * i] / 4096.0;</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;seconds = ints[2 * i + 1] / 1e6;</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[i] =&nbsp;</span>
<span>new</span>
<span>&nbsp;DataPoint(seconds, volt);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints = dataPoints.OrderBy(p =&gt; p.X).ToArray();</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;trigPos = (NUM_SAMPLES * 10) / 100;</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;trigX = dataPoints[trigPos].X;</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints = dataPoints.Select(p =&gt;&nbsp;</span>
<span>new</span>
<span>&nbsp;DataPoint(p.X - trigX, p.Y)).ToArray();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>lineSeries.Points.Clear();</span>
 &nbsp;</p>
<p>&nbsp;<span>lineSeries.Points.AddRange(dataPoints);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.InvalidatePlot(</span>
<span>true</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Invalidate();</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(GpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>fastCts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonFastStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonFastStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}&nbsp;</span>
<span>while</span>
<span>&nbsp;(repeatRequested);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonFastStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>fastCts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;radioButton1v_CheckedChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(fastCts ==&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>fastCts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>10</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-20"><b>
<span><b>DAC</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>スケッチに記述する場合と同様の関数が使えます。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>void</span>
<span>&nbsp;dacWrite(</span>
<span>int</span>
<span>&nbsp;pin,&nbsp;</span>
<span>int</span>
<span>&nbsp;value);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションでは</span>
<span>、</span>
<span>DA</span>
<span>C</span>
<span>出力ピ</span>
<span>ン</span>
<span>2</span>
<span>5</span>
<span>をアナログ入力ピ</span>
<span>ン</span>
<span>3</span>
<span>2（</span>
<span>ADC</span>
<span>4</span>
<span>）に</span>
<span>、</span>
<span>DA</span>
<span>C</span>
<span>出力ピ</span>
<span>ン</span>
<span>2</span>
<span>6</span>
<span>をアナログ入力ピ</span>
<span>ン</span>
<span>3</span>
<span>3（</span>
<span>ADC</span>
<span>5</span>
<span>）に接続します。トラックバー</span>
<span>で</span>
<span>DA</span>
<span>C</span>
<span>の出力レベルを変化させグラフに表示します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000047.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000102.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000014.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarDac1_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>dacWrite</span>
<span>(25, trackBarDac1.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarDac2_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>dacWrite</span>
<span>(26, trackBarDac2.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>トラックバーの値の範囲</span>
<span>は0～</span>
<span>25</span>
<span>5</span>
<span>に設定します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000002.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>11</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-21"><b>
<span><b>LED</b></span>
<span><b>C</b></span>
<span><b>（サーボパルス出力可能）</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>スケッチに記述する場合と同様の関数が使えます。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>double</span>
<span>&nbsp;ledcSetup(</span>
<span>int</span>
<span>&nbsp;channel,&nbsp;</span>
<span>double</span>
<span>&nbsp;freq,&nbsp;</span>
<span>int</span>
<span>&nbsp;resolution_bits);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;ledcWrite(</span>
<span>int</span>
<span>&nbsp;channel,&nbsp;</span>
<span>int</span>
<span>&nbsp;duty);</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;ledcWriteTone(</span>
<span>int</span>
<span>&nbsp;channel,&nbsp;</span>
<span>double</span>
<span>&nbsp;freq);</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;ledcWriteNote(</span>
<span>int</span>
<span>&nbsp;channel, Note note,&nbsp;</span>
<span>int</span>
<span>&nbsp;octave);</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;ledcRead(</span>
<span>int</span>
<span>&nbsp;channel);</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;ledcReadFreq(</span>
<span>int</span>
<span>&nbsp;channel);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;ledcAttachPin(</span>
<span>int</span>
<span>&nbsp;pin,&nbsp;</span>
<span>int</span>
<span>&nbsp;channel);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;ledcDetachPin(</span>
<span>int</span>
<span>&nbsp;pin);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションでは</span>
<span>、</span>
<span>LED</span>
<span>C</span>
<span>の周波数</span>
<span>を</span>
<span>50H</span>
<span>z</span>
<span>に設定し、デューティー比</span>
<span>を</span>
<span>500us / 20000u</span>
<span>s</span>
<span>か</span>
<span>ら</span>
<span>2500us / 20000u</span>
<span>s</span>
<span>の間で変化させることでサーボモーター用のパルスを出力します。</span>
 &nbsp;</p>
<p>&nbsp;<span>ピ</span>
<span>ン</span>
<span>1</span>
<span>7</span>
<span>の出力パルスをサーボモーターに接続します。</span>
 &nbsp;</p>
<p>&nbsp;<span>ピ</span>
<span>ン</span>
<span>2</span>
<span>7</span>
<span>の出力パルスをアナログ入力ピ</span>
<span>ン</span>
<span>3</span>
<span>6</span>
<span>（シルクの表記</span>
<span>は</span>
<span>SV</span>
<span>P</span>
<span>）に入力し、グラフに表示します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000031.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000018.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000001.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000105.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<p>&nbsp;<span>ESP3</span>
<span>2</span>
<span>と接続したと</span>
<span>き</span>
<span>LED</span>
<span>C</span>
<span>のチャンネ</span>
<span>ル0</span>
<span>をピ</span>
<span>ン</span>
<span>2</span>
<span>7</span>
<span>に</span>
<span>、</span>
<span>LED</span>
<span>C</span>
<span>のチャンネ</span>
<span>ル1</span>
<span>をピ</span>
<span>ン</span>
<span>1</span>
<span>7</span>
<span>にアサインしています。チャンネ</span>
<span>ル0、1</span>
<span>とも周波数</span>
<span>を</span>
<span>50H</span>
<span>z</span>
<span>に、</span>
<span>分解能</span>
<span>を</span>
<span>1</span>
<span>6</span>
<span>ビットに設定しています。</span>
 &nbsp;</p>
<p>&nbsp;<span>周期</span>
<span>を</span>
<span>20m</span>
<span>s</span>
<span>、分解能</span>
<span>を</span>
<span>1</span>
<span>6</span>
<span>ビットに設定しているので、</span>
<span>トラックバーの値</span>
<span>が</span>
<span>2000</span>
<span>0</span>
<span>のと</span>
<span>き</span>
<span>0x1000</span>
<span>0</span>
<span>になるように換算し</span>
<span>て</span>
<span>ledcWrite(</span>
<span>)</span>
<span>に渡しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_1_PIN = 27;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_1_CH = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_2_PIN = 17;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_2_CH = 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.StreamConnected += (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>ledcSetup</span>
<span>(SERVO_1_CH, 50, 16);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>ledcAttachPin</span>
<span>(SERVO_1_PIN, SERVO_1_CH);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>ledcSetup</span>
<span>(SERVO_2_CH, 50, 16);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>ledcAttachPin</span>
<span>(SERVO_2_PIN, SERVO_2_CH);</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo1_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;duty = (0x00010000 * trackBarServo1.Value) / 20000;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>ledcWrite</span>
<span>(SERVO_1_CH, duty);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo2_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;duty = (0x00010000 * trackBarServo2.Value) / 20000;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>ledcWrite</span>
<span>(SERVO_2_CH, duty);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>トラックバーの値の範囲</span>
<span>は</span>
<span>50</span>
<span>0～</span>
<span>250</span>
<span>0</span>
<span>に設定します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000110.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>12</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-22"><b>
<span><b>SPI</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>ESP3</span>
<span>2の</span>
<span>SP</span>
<span>I</span>
<span>バスにプログラマブル波形発生</span>
<span>器</span>
<span>AD983</span>
<span>3</span>
<span>を接続し、正弦波、三角波を出力します。</span>
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>に用意されてい</span>
<span>る</span>
<span>SP</span>
<span>I</span>
<span>インスタンスを使う方法と、コマンドを追加し</span>
<span>て</span>
<span>Arduin</span>
<span>o</span>
<span>ライブラリ</span>
<span>「</span>
<span>AD983</span>
<span>3</span>
<span>」のメソッドを実行する方法を説明します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000022.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>プログラマブル波形発生</span>
<span>器</span>
<span>AD983</span>
<span>3は</span>
<span>MIS</span>
<span>O</span>
<span>を使用しないので、ピ</span>
<span>ン</span>
<span>1</span>
<span>9</span>
<span>は何も接続しません。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000058.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2><b>
<span><b>12.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-23"><b>
<span><b>SP</b></span>
<span><b>I</b></span>
<span><b>関数を使う場合</b></span>
<span><b>（</b></span>
<span><b>AD983</b></span>
<span><b>3</b></span>
<span><b>）</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>スケッチ</span>
<span>の</span>
<span>SP</span>
<span>I</span>
<span>インスタンスに対応す</span>
<span>る</span>
<span>SP</span>
<span>I</span>
<span>インスタンス</span>
<span>が</span>
<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>にも用意されており、スケッチに記述するのと同じ関数が使えます。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>void</span>
<span>&nbsp;begin(</span>
<span>int</span>
<span>&nbsp;sck = -1,&nbsp;</span>
<span>int</span>
<span>&nbsp;miso = -1,&nbsp;</span>
<span>int</span>
<span>&nbsp;mosi = -1,&nbsp;</span>
<span>int</span>
<span>&nbsp;ss = -1)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;end()</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;setHwCs(</span>
<span>bool</span>
<span>&nbsp;hwCs)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;setBitOrder(SPIBitOrder bitOrder)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;setDataMode(SPIMode mode)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;setFrequency(</span>
<span>uint</span>
<span>&nbsp;frequency)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;setClockDivider(</span>
<span>uint</span>
<span>&nbsp;clockDiv)</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;getClockDivider()</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;beginTransaction(</span>
<span>uint</span>
<span>&nbsp;clock = 1000000, SPIBitOrder bitOrder = SPIBitOrder.MSBFIRST, SPIMode dataMode = SPIMode.MODE0)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;endTransaction()</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;transfer(</span>
<span>int</span>
<span>&nbsp;data)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;transfer16(</span>
<span>int</span>
<span>&nbsp;data)</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;transfer32(</span>
<span>uint</span>
<span>&nbsp;data)</span>
 &nbsp;</p>
<p>&nbsp;<span>byte</span>
<span>[] transferBytes(</span>
<span>byte</span>
<span>[] txBuf)</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;transferBits(</span>
<span>uint</span>
<span>&nbsp;data,&nbsp;</span>
<span>int</span>
<span>&nbsp;bits)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;write(</span>
<span>int</span>
<span>&nbsp;data)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;write16(</span>
<span>int</span>
<span>&nbsp;data)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;write32(</span>
<span>uint</span>
<span>&nbsp;data)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;writeBytes(</span>
<span>byte</span>
<span>[] data)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;writePixels(</span>
<span>byte</span>
<span>[] data)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;writePattern(</span>
<span>byte</span>
<span>[] data,&nbsp;</span>
<span>uint</span>
<span>&nbsp;repeat)</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>に用意されてい</span>
<span>る</span>
<span>SP</span>
<span>I</span>
<span>インスタンスを使って、プログラマブル波形発生</span>
<span>器</span>
<span>AD983</span>
<span>3</span>
<span>から周波数がスイープする正弦波を出力します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000108.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>次の画像はオシロスコープの表示です。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000021.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource spiCts;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;</span>
<span>WriteRegister</span>
<span>(</span>
<span>ushort</span>
<span>&nbsp;data)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>digitalWrite</span>
<span>(5, Esp32If.LOW);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>byte</span>
<span>[] bytes =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>byte</span>
<span>[2];</span>
 &nbsp;</p>
<p>&nbsp;<span>bytes[0] = (</span>
<span>byte</span>
<span>)((data &gt;&gt; 8) &amp; 0xff);</span>
 &nbsp;</p>
<p>&nbsp;<span>bytes[1] = (</span>
<span>byte</span>
<span>)(data &amp; 0xff);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>SPI.transferBytes</span>
<span>(bytes);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>digitalWrite</span>
<span>(5, Esp32If.HIGH);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>ushort</span>
<span>[] GetFrequencyData(</span>
<span>double</span>
<span>&nbsp;frequency)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ushort</span>
<span>[] data =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>ushort</span>
<span>[2];</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;freqData = (</span>
<span>uint</span>
<span>)((frequency * Math.Pow(2, 28)) / 25e6);</span>
 &nbsp;</p>
<p>&nbsp;<span>data[0] = (</span>
<span>ushort</span>
<span>)((freqData &amp; 0x3fff) | 0x4000);</span>
 &nbsp;</p>
<p>&nbsp;<span>data[1] = (</span>
<span>ushort</span>
<span>)(((freqData &gt;&gt; 14) &amp; 0x3fff) | 0x4000);</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>&nbsp;data;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonSpiStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonSpiStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonSpiStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>spiCts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = spiCts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;freq = 1000;</span>
 &nbsp;</p>
<p>&nbsp;<span>bool</span>
<span>&nbsp;up =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>SPI.begin</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>SPI.setDataMode</span>
<span>(SPIClass.SPIMode.MODE2);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>SPI.setFrequency</span>
<span>(1000000);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>pinMode</span>
<span>(5, Esp32If.GpioFunction.OUTPUT);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>WriteRegister</span>
<span>(0x0100);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(100, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>WriteRegister</span>
<span>(0x2000);</span>
 &nbsp;</p>
<p>&nbsp;<span>ushort</span>
<span>[] data = GetFrequencyData(freq);</span>
 &nbsp;</p>
<p>&nbsp;<span>WriteRegister</span>
<span>(data[0]);</span>
 &nbsp;</p>
<p>&nbsp;<span>WriteRegister</span>
<span>(data[1]);</span>
 &nbsp;</p>
<p>&nbsp;<span>WriteRegister</span>
<span>(0xc000);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>WriteRegister</span>
<span>(0x2000);</span>
 &nbsp;</p>
<p>&nbsp;<span>data = GetFrequencyData(freq);</span>
 &nbsp;</p>
<p>&nbsp;<span>WriteRegister</span>
<span>(data[0]);</span>
 &nbsp;</p>
<p>&nbsp;<span>WriteRegister</span>
<span>(data[1]);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(up)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>freq *= 1.1;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(freq &gt; 10e3)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>up =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>freq /= 1.1;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(freq &lt; 1000)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>up =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(100, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(GpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>spiCts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonSpiStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonSpiStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonSpiStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>spiCts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2><b>
<span><b>12.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-24"><b>
<span><b>ライブラリを使う場合</b></span>
<span><b>（</b></span>
<span><b>AD983</b></span>
<span><b>3</b></span>
<span><b>）</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>ライブラリの関数のうち必要なものをコマンドとして追加すれば、便利なライブラリ</span>
<span>を</span>
<span>C</span>
<span>#</span>
<span>から活用できます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下記はライブラリのサンプルスケッチの抜粋です。ヘッダーファイルをインクルードしてインスタンスを作成し</span>
<span>、</span>
<span>setup(</span>
<span>)</span>
<span>でインスタンスのメソッドを呼んでいます。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>#include &lt;AD9833.h&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>AD9833 gen(5);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void setup() {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; gen.</span>
<span>Begin</span>
<span>();&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; gen.</span>
<span>ApplySignal</span>
<span>(SINE_WAVE,REG0,1000);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; gen.</span>
<span>EnableOutput</span>
<span>(true);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void loop() {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>次の４つの関数</span>
<span>を</span>
<span>C</span>
<span>#</span>
<span>から実行できるようにコマンドとして追加しました。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>Begin()</span>
 &nbsp;</p>
<p>&nbsp;<span>ApplySignal()</span>
 &nbsp;</p>
<p>&nbsp;<span>SetFrequency()</span>
 &nbsp;</p>
<p>&nbsp;<span>EnableOutput()</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下記はライブラリのヘッダーファイルの抜粋です。</span>
 &nbsp;</p>
<p>&nbsp;<span>C:¥Users</span>
<span>¥</span>
<span>ユーザー</span>
<span>名</span>
<span>¥Documents¥Arduino¥libraries¥AD9833-Library-Arduino-master¥AD9833.h</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>typedef enum { SINE_WAVE = 0x2000, TRIANGLE_WAVE = 0x2002,</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp; SQUARE_WAVE = 0x2028, HALF_SQUARE_WAVE = 0x2020 } WaveformType;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>typedef enum { REG0, REG1, SAME_AS_REG0 } Registers;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>class AD9833 {</span>
 &nbsp;</p>
<p>&nbsp;<span>public:</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>// Must be the first command after creating the AD9833 object.</span>
 &nbsp;</p>
<p>&nbsp;<span>void Begin ( void );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// Setup and apply a signal. Note that any calls to EnableOut,</span>
 &nbsp;</p>
<p>&nbsp;<span>// SleepMode, DisableDAC, or DisableInternalClock remain in effect</span>
 &nbsp;</p>
<p>&nbsp;<span>void ApplySignal ( WaveformType waveType, Registers freqReg,</span>
 &nbsp;</p>
<p>&nbsp;<span>float frequencyInHz,</span>
 &nbsp;</p>
<p>&nbsp;<span>Registers phaseReg = SAME_AS_REG0, float phaseInDeg = 0.0 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// Update just the frequency in REG0 or REG1</span>
 &nbsp;</p>
<p>&nbsp;<span>void SetFrequency ( Registers freqReg, float frequency );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// Turn ON / OFF output using the RESET command.</span>
 &nbsp;</p>
<p>&nbsp;<span>void EnableOutput ( bool enable );</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>か</span>
<span>ら</span>
<span>Arduin</span>
<span>o</span>
<span>ライブラ</span>
<span>リ</span>
<span>RemoteEsp3</span>
<span>2</span>
<span>に送るコマンドのフォーマットは次のようになります。基本</span>
<span>は</span>
<span>3</span>
<span>2</span>
<span>ビット整数４個</span>
<span>、</span>
<span>1</span>
<span>6</span>
<span>バイトです。引数が３個以上の場合や文字列などの場合は</span>
<span>、</span>
<span>extsByte</span>
<span>s</span>
<span>にバイト数をセットして後に追加します。文字列の場合</span>
<span>は</span>
<span>C+</span>
<span>+</span>
<span>側で便利なようにゼロを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000028.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>コマンドの応答のフォーマットは次のようになります</span>
<span>。</span>
<span>erro</span>
<span>rは</span>
<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>内部で使用します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000092.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>独自に追加するコマンド</span>
<span>の</span>
<span>I</span>
<span>Dは</span>
<span>1000</span>
<span>0</span>
<span>以上にします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>begin(</span>
<span>)</span>
<span>コマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000069.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ApplySignal(</span>
<span>)</span>
<span>コマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000070.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>SetFrequency(</span>
<span>)</span>
<span>コマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000087.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>EnableOutput(</span>
<span>)</span>
<span>コマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000089.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションにクラ</span>
<span>ス</span>
<span>MyAD983</span>
<span>3</span>
<span>を追加しています。周波数</span>
<span>は</span>
<span>1</span>
<span>0</span>
<span>倍してから整数に、位相</span>
<span>は</span>
<span>100</span>
<span>0</span>
<span>倍してから整数に変換しています</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>側でそれぞ</span>
<span>れ</span>
<span>1/1</span>
<span>0、</span>
<span>1/100</span>
<span>0</span>
<span>して元に戻しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net.Esp32;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Esp32IfTest</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>class</span>
<span>&nbsp;</span>
<span>MyAD9833</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>enum</span>
<span>&nbsp;</span>
<span>WaveformType</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>SINE_WAVE = 0x2000,</span>
 &nbsp;</p>
<p>&nbsp;<span>TRIANGLE_WAVE = 0x2002,</span>
 &nbsp;</p>
<p>&nbsp;<span>SQUARE_WAVE = 0x2028,</span>
 &nbsp;</p>
<p>&nbsp;<span>HALF_SQUARE_WAVE = 0x2020</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>enum</span>
<span>&nbsp;</span>
<span>Registers</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>REG0, REG1,</span>
 &nbsp;</p>
<p>&nbsp;<span>SAME_AS_REG0</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;AD9833_BASE = 20100;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;AD9833_BEGIN = (AD9833_BASE + 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;AD9833_APPLY_SIGNAL = (AD9833_BASE + 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;AD9833_SET_FREQUENCY = (AD9833_BASE + 3);</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;AD9833_ENABLE_OUTPUT = (AD9833_BASE + 9);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;Esp32If esp32If;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;MyAD9833(Esp32If esp32If)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>this</span>
<span>.esp32If = esp32If;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// private const int AD9833_BEGIN = (AD9833_BASE + 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;</span>
<span>Begin</span>
<span>()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.GpioCommand(AD9833_BEGIN, 0, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// private const int AD9833_APPLY_SIGNAL = (AD9833_BASE + 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;</span>
<span>ApplySignal</span>
<span>(WaveformType waveType, Registers freqReg,</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;frequencyInHz,</span>
 &nbsp;</p>
<p>&nbsp;<span>Registers phaseReg = Registers.SAME_AS_REG0,&nbsp;</span>
<span>double</span>
<span>&nbsp;phaseInDeg = 0.0)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Esp32If.GpioExtent[] exts =&nbsp;</span>
<span>new</span>
<span>&nbsp;Esp32If.GpioExtent[] {</span>
 &nbsp;</p>
<p>&nbsp;<span>new</span>
<span>&nbsp;Esp32If.GpioExtent(),</span>
 &nbsp;</p>
<p>&nbsp;<span>new</span>
<span>&nbsp;Esp32If.GpioExtent(),</span>
 &nbsp;</p>
<p>&nbsp;<span>new</span>
<span>&nbsp;Esp32If.GpioExtent()</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>/*</span>
 &nbsp;</p>
<p>&nbsp;<span>p1=waveType</span>
 &nbsp;</p>
<p>&nbsp;<span>p2=freqReg</span>
 &nbsp;</p>
<p>&nbsp;<span>## extension ##</span>
 &nbsp;</p>
<p>&nbsp;<span>double frequencyInHz</span>
 &nbsp;</p>
<p>&nbsp;<span>Registers phaseReg</span>
 &nbsp;</p>
<p>&nbsp;<span>double phaseInDeg</span>
 &nbsp;</p>
<p>&nbsp;<span>*/</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>exts[0].Contents = esp32If.IntToBytes((</span>
<span>int</span>
<span>)(frequencyInHz * 10));</span>
 &nbsp;</p>
<p>&nbsp;<span>exts[1].Contents = esp32If.IntToBytes((</span>
<span>int</span>
<span>)phaseReg);</span>
 &nbsp;</p>
<p>&nbsp;<span>exts[2].Contents = esp32If.IntToBytes((</span>
<span>int</span>
<span>)(phaseInDeg * 1000));</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.GpioCommandExt(AD9833_APPLY_SIGNAL, (</span>
<span>int</span>
<span>)waveType, (</span>
<span>int</span>
<span>)freqReg, exts);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// private const int AD9833_SET_FREQUENCY = (AD9833_BASE + 3);</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;</span>
<span>SetFrequency</span>
<span>(Registers freqReg,&nbsp;</span>
<span>double</span>
<span>&nbsp;freqInHz)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.GpioCommand(AD9833_SET_FREQUENCY, (</span>
<span>int</span>
<span>)freqReg, (</span>
<span>int</span>
<span>)(freqInHz * 10));</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// private const int AD9833_ENABLE_OUTPUT = (AD9833_BASE + 9);</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;</span>
<span>EnableOutput</span>
<span>(</span>
<span>bool</span>
<span>&nbsp;enable)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.GpioCommand(AD9833_ENABLE_OUTPUT, enable ? 1 : 0, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Arduin</span>
<span>o</span>
<span>のサンプルスケッチに次のコードを追加しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>#include &lt;AD9833.h&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>AD9833 ad9833(5);</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>#define AD9833_BASE 20100</span>
 &nbsp;</p>
<p>&nbsp;<span>#define AD9833_BEGIN (AD9833_BASE+0)</span>
 &nbsp;</p>
<p>&nbsp;<span>#define AD9833_APPLY_SIGNAL (AD9833_BASE+1)</span>
 &nbsp;</p>
<p>&nbsp;<span>#define AD9833_SET_FREQUENCY (AD9833_BASE+3)</span>
 &nbsp;</p>
<p>&nbsp;<span>#define AD9833_ENABLE_OUTPUT (AD9833_BASE+9)</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>void&nbsp;</span>
<span>callback</span>
<span>(byte* buffer, int command, int p1, int p2, int extsBytes) {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; switch (command) {</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define AD9833_BEGIN (AD9833_BASE+0)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case AD9833_BEGIN: ad9833.</span>
<span>Begin</span>
<span>(); break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define AD9833_APPLY_SIGNAL (AD9833_BASE+1)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case AD9833_APPLY_SIGNAL: {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int p3 = RemoteEsp32.</span>
<span>bytesToInt</span>
<span>(buffer + 16);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int p4 = RemoteEsp32.</span>
<span>bytesToInt</span>
<span>(buffer + 20);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int p5 = RemoteEsp32.</span>
<span>bytesToInt</span>
<span>(buffer + 24);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ad9833.</span>
<span>ApplySignal</span>
<span>((WaveformType)p1, (Registers)p2, (float)p3 / 10, (Registers)p4, (float)p5 / 1000);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define AD9833_SET_FREQUENCY (AD9833_BASE+3)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case AD9833_SET_FREQUENCY: ad9833.</span>
<span>SetFrequency</span>
<span>((Registers)p1, (float)p2 / 10); break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define AD9833_ENABLE_OUTPUT (AD9833_BASE+9)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case AD9833_ENABLE_OUTPUT: ad9833.</span>
<span>EnableOutput</span>
<span>((bool)p1); break;</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Arduin</span>
<span>o</span>
<span>ライブラ</span>
<span>リ</span>
<span>AD983</span>
<span>3</span>
<span>を使って、プログラマブル波形発生</span>
<span>器</span>
<span>AD983</span>
<span>3</span>
<span>から周波数がスイープする三角波を出力します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000033.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>次の画像はオシロスコープの表示です。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000057.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;Esp32If esp32If;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>MyAD9833</span>
<span>&nbsp;ad9833;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If =&nbsp;</span>
<span>new</span>
<span>&nbsp;Esp32If();</span>
 &nbsp;</p>
<p>&nbsp;<span>ad9833 =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>MyAD9833</span>
<span>(esp32If);</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonSpiLibStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonSpiLibStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonSpiLibStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>spiLibCts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = spiLibCts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;freq = 1000;</span>
 &nbsp;</p>
<p>&nbsp;<span>bool</span>
<span>&nbsp;up =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ad9833.</span>
<span>Begin</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>ad9833.</span>
<span>ApplySignal</span>
<span>(MyAD9833.WaveformType.TRIANGLE_WAVE, MyAD9833.Registers.REG0, freq);</span>
 &nbsp;</p>
<p>&nbsp;<span>ad9833.</span>
<span>EnableOutput</span>
<span>(</span>
<span>true</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ad9833.</span>
<span>SetFrequency</span>
<span>(MyAD9833.Registers.REG0, freq);</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(up)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>freq *= 1.1;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(freq &gt; 10e3)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>up =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>freq /= 1.1;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(freq &lt; 1000)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>up =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(100, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(GpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>spiLibCts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonSpiLibStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonSpiLibStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonSpiLibStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>spiLibCts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>13</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-25"><b>
<span><b>タッチセンサー</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>スケッチに記述する場合と同様の関数が使えます</span>
<span>。</span>
<span>touchAttachInterrupt(</span>
<span>)</span>
<span>は、タッチセンサーの値が閾値以下になったとき割り込みを使っ</span>
<span>て</span>
<span>C</span>
<span>#</span>
<span>のメソッドを実行します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>void</span>
<span>&nbsp;touchSetCycles(</span>
<span>int</span>
<span>&nbsp;measure,&nbsp;</span>
<span>int</span>
<span>&nbsp;sleep);</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;touchRead(</span>
<span>int</span>
<span>&nbsp;pin);</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;touchAttachInterrupt(</span>
<span>int</span>
<span>&nbsp;pin, Action&lt;</span>
<span>int</span>
<span>, UInt32&gt; f,&nbsp;</span>
<span>int</span>
<span>&nbsp;threshold);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下記はピ</span>
<span>ン</span>
<span>1</span>
<span>2</span>
<span>に閾</span>
<span>値</span>
<span>3</span>
<span>0</span>
<span>で割り込みを登録する例です。ログ画面にピン番号、タッチセンサーの値、時刻（ミリ秒）を表示します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>esp32If.touchAttachInterrupt(12, (gpio, millis) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"pin:&nbsp;</span>
<span>{gpio}</span>
<span>, value:&nbsp;</span>
<span>{esp32If.touchRead(gpio)}</span>
<span>, milliseconds:&nbsp;</span>
<span>{millis}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>}, 30);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下記はピ</span>
<span>ン</span>
<span>1</span>
<span>2</span>
<span>の割り込み設定を解除する例です。外部割り込みと同</span>
<span>じ</span>
<span>detachInterrupt(</span>
<span>)</span>
<span>を使います。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>esp32If.detachInterrupt(12);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションではピ</span>
<span>ン</span>
<span>1</span>
<span>2、</span>
<span>1</span>
<span>3、</span>
<span>1</span>
<span>4、</span>
<span>1</span>
<span>5</span>
<span>に割り込みを登録します。ピンに数センチのリード線を接続し芯線に手を触れると、割り込みが発生してログ画面に</span>
<span>ピン番号、タッチセンサーの値、時刻（ミリ秒）が表示されます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000038.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>ピ</span>
<span>ン</span>
<span>1</span>
<span>2</span>
<span>にリード線を接続した例です。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000071.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000019.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonTouchStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonTouchStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonTouchStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>touchAttachInterrupt</span>
<span>(12, (gpio, millis) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"pin:&nbsp;</span>
<span>{gpio}</span>
<span>, value:&nbsp;</span>
<span>{esp32If.touchRead(gpio)}</span>
<span>, milliseconds:&nbsp;</span>
<span>{millis}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>}, 30);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>touchAttachInterrupt</span>
<span>(13, (gpio, millis) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"pin:&nbsp;</span>
<span>{gpio}</span>
<span>, value:&nbsp;</span>
<span>{esp32If.touchRead(gpio)}</span>
<span>, milliseconds:&nbsp;</span>
<span>{millis}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>}, 30);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>touchAttachInterrupt</span>
<span>(14, (gpio, millis) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"pin:&nbsp;</span>
<span>{gpio}</span>
<span>, value:&nbsp;</span>
<span>{esp32If.touchRead(gpio)}</span>
<span>, milliseconds:&nbsp;</span>
<span>{millis}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>}, 30);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>touchAttachInterrupt</span>
<span>(15, (gpio, millis) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"pin:&nbsp;</span>
<span>{gpio}</span>
<span>, value:&nbsp;</span>
<span>{esp32If.touchRead(gpio)}</span>
<span>, milliseconds:&nbsp;</span>
<span>{millis}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>}, 30);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonTouchStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonTouchStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonTouchStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>detachInterrupt</span>
<span>(12);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>detachInterrupt</span>
<span>(13);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>detachInterrupt</span>
<span>(14);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>detachInterrupt</span>
<span>(15);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>14</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-26"><b>
<span><b>I2C</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>ESP3</span>
<span>2の</span>
<span>I2</span>
<span>C</span>
<span>バスに加速度センサ</span>
<span>ー</span>
<span>ADXL34</span>
<span>5</span>
<span>を接続し</span>
<span>、3</span>
<span>軸の数値を取得して表示します。</span>
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>に用意されてい</span>
<span>る</span>
<span>Wir</span>
<span>e</span>
<span>インスタンスを使う方法と、コマンドを追加し</span>
<span>て</span>
<span>Adafrui</span>
<span>t</span>
<span>から提供されてい</span>
<span>る</span>
<span>Arduin</span>
<span>o</span>
<span>ライブラリ</span>
<span>「</span>
<span>Adafruit_ADXL345_</span>
<span>U</span>
<span>」のメソッドを実行する方法を説明します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000044.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000036.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2><b>
<span><b>14.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-27"><b>
<span><b>I2</b></span>
<span><b>C</b></span>
<span><b>関数を使う場合</b></span>
<span><b>（</b></span>
<span><b>ADXL34</b></span>
<span><b>5</b></span>
<span><b>）</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>スケッチ</span>
<span>の</span>
<span>Wir</span>
<span>e、</span>
<span>Wire</span>
<span>1</span>
<span>インスタンスに対応す</span>
<span>る</span>
<span>Wir</span>
<span>e、</span>
<span>Wire</span>
<span>1</span>
<span>インスタンス</span>
<span>が</span>
<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>にも用意されており、スケッチに記述するのと同じ関数が使えます。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>void</span>
<span>&nbsp;begin(</span>
<span>int</span>
<span>&nbsp;sda = -1,&nbsp;</span>
<span>int</span>
<span>&nbsp;scl = -1,&nbsp;</span>
<span>uint</span>
<span>&nbsp;frequency = 0)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;setClock(</span>
<span>uint</span>
<span>&nbsp;frequency)</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;getClock(</span>
<span>uint</span>
<span>&nbsp;frequency)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;setTimeOut(</span>
<span>int</span>
<span>&nbsp;timeOutMillis)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;getTimeOut()</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;lastError()</span>
 &nbsp;</p>
<p>&nbsp;<span>string</span>
<span>&nbsp;getErrorText(</span>
<span>int</span>
<span>&nbsp;err)</span>
 &nbsp;</p>
<p>&nbsp;<span>I2CError writeTransmission(</span>
<span>int</span>
<span>&nbsp;address,&nbsp;</span>
<span>byte</span>
<span>[] buff,&nbsp;</span>
<span>bool</span>
<span>&nbsp;sendStop =&nbsp;</span>
<span>true</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>I2CError readTransmission(</span>
<span>int</span>
<span>&nbsp;address,&nbsp;</span>
<span>byte</span>
<span>[] buff,&nbsp;</span>
<span>bool</span>
<span>&nbsp;sendStop,&nbsp;</span>
<span>out</span>
<span>&nbsp;</span>
<span>uint</span>
<span>&nbsp;readCount)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;beginTransmission(UInt16 address)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;beginTransmission(</span>
<span>byte</span>
<span>&nbsp;address)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;beginTransmission(</span>
<span>int</span>
<span>&nbsp;address)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;endTransmission(</span>
<span>bool</span>
<span>&nbsp;sendStop)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;endTransmission(</span>
<span>int</span>
<span>&nbsp;sendStop)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;endTransmission()</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;requestFrom(UInt16 address,&nbsp;</span>
<span>int</span>
<span>&nbsp;size,&nbsp;</span>
<span>bool</span>
<span>&nbsp;sendStop)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;requestFrom(UInt16 address,&nbsp;</span>
<span>int</span>
<span>&nbsp;size,&nbsp;</span>
<span>int</span>
<span>&nbsp;sendStop)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;requestFrom(UInt16 address,&nbsp;</span>
<span>int</span>
<span>&nbsp;size)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;requestFrom(</span>
<span>byte</span>
<span>&nbsp;address,&nbsp;</span>
<span>int</span>
<span>&nbsp;size,&nbsp;</span>
<span>int</span>
<span>&nbsp;sendStop)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;requestFrom(</span>
<span>byte</span>
<span>&nbsp;address,&nbsp;</span>
<span>int</span>
<span>&nbsp;size)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;requestFrom(</span>
<span>int</span>
<span>&nbsp;address,&nbsp;</span>
<span>int</span>
<span>&nbsp;size,&nbsp;</span>
<span>int</span>
<span>&nbsp;sendStop)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;requestFrom(</span>
<span>int</span>
<span>&nbsp;address,&nbsp;</span>
<span>int</span>
<span>&nbsp;size)</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;write(</span>
<span>byte</span>
<span>&nbsp;data)</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;write(</span>
<span>byte</span>
<span>[] buff)</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;available()</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;read()</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;peek()</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;flush()</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;write(</span>
<span>string</span>
<span>&nbsp;s)</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;write(</span>
<span>uint</span>
<span>&nbsp;n)</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;write(</span>
<span>int</span>
<span>&nbsp;n)</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;write(UInt16 n)</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;write(Int16 n)</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;dumpInts()</span>
 &nbsp;</p>
<p>&nbsp;<span>void</span>
<span>&nbsp;dumpI2C()</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>に用意されてい</span>
<span>る</span>
<span>Wir</span>
<span>e</span>
<span>インスタンスを使って、加速度センサ</span>
<span>ー</span>
<span>ADXL34</span>
<span>5</span>
<span>か</span>
<span>ら3</span>
<span>軸の数値を取得して表示します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000093.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource i2cCts;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;writeI2c(</span>
<span>byte</span>
<span>&nbsp;device_addr,&nbsp;</span>
<span>byte</span>
<span>&nbsp;register_addr,&nbsp;</span>
<span>byte</span>
<span>&nbsp;value)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>Wire.beginTransmission</span>
<span>(device_addr);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>Wire.write</span>
<span>(register_addr);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>Wire.write</span>
<span>(value);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>Wire.endTransmission</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>byte</span>
<span>[] readI2c(</span>
<span>byte</span>
<span>&nbsp;device_addr,&nbsp;</span>
<span>byte</span>
<span>&nbsp;register_addr,&nbsp;</span>
<span>int</span>
<span>&nbsp;num)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>byte</span>
<span>[] buffer =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>byte</span>
<span>[num];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>Wire.beginTransmission</span>
<span>(device_addr);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>Wire.write</span>
<span>(register_addr);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>Wire.endTransmission</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>Wire.beginTransmission</span>
<span>(device_addr);</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>Wire.requestFrom</span>
<span>(device_addr, num);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;i = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(esp32If.</span>
<span>Wire.available</span>
<span>() != 0)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buffer[i++] = (</span>
<span>byte</span>
<span>)esp32If.</span>
<span>Wire.read</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.</span>
<span>Wire.endTransmission</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>&nbsp;buffer;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonI2cStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonI2cStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonI2cStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>byte</span>
<span>&nbsp;DEVICE_ADDR = 0x53;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>i2cCts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = i2cCts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>writeI2c(DEVICE_ADDR, 0x31, 0x00);&nbsp;</span>
<span>// DATA_FORMAT</span>
 &nbsp;</p>
<p>&nbsp;<span>writeI2c(DEVICE_ADDR, 0x2d, 0x08);&nbsp;</span>
<span>// POWER_TCL</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>byte</span>
<span>[] axis_buff = readI2c(DEVICE_ADDR, 0x32, 6);</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;x = (axis_buff[1] &lt;&lt; 8) + axis_buff[0];</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;y = (axis_buff[3] &lt;&lt; 8) + axis_buff[2];</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;z = (axis_buff[5] &lt;&lt; 8) + axis_buff[4];</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(x &gt; 0x8000) x -= 0x10000;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(y &gt; 0x8000) y -= 0x10000;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(z &gt; 0x8000) z -= 0x10000;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"x:&nbsp;</span>
<span>{x}</span>
<span>&nbsp;y:&nbsp;</span>
<span>{y}</span>
<span>&nbsp;z:&nbsp;</span>
<span>{z}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(100, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(GpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>i2cCts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonI2cStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonI2cStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonI2cStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>i2cCts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2><b>
<span><b>14.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-28"><b>
<span><b>ライブラリを使う場合</b></span>
<span><b>（</b></span>
<span><b>ADXL34</b></span>
<span><b>5</b></span>
<span><b>）</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>Arduino ID</span>
<span>E</span>
<span>の「ライブラリを管</span>
<span>理...</span>
<span>」を検索すると、</span>
<span>「</span>
<span>Adafruit_ADXL345_</span>
<span>U</span>
<span>」というライブラリが見つかります。ライブラリの関数のうち必要なものをコマンドとして追加すれば、便利なライブラリ</span>
<span>を</span>
<span>C</span>
<span>#</span>
<span>から活用できます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下記はライブラリのサンプルスケッチの抜粋です。ヘッダーファイルをインクルードしてインスタンスを作成し</span>
<span>、</span>
<span>setup(</span>
<span>)と</span>
<span>loop(</span>
<span>)</span>
<span>でインスタンスのメソッドを呼んでいます。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>#include &lt;Adafruit_Sensor.h&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>#include &lt;Adafruit_ADXL345_U.h&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Adafruit_ADXL345_Unified accel = Adafruit_ADXL345_Unified(12345);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void setup(void)&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; Serial.begin(9600);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; accel.</span>
<span>begin</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; accel.</span>
<span>setRange</span>
<span>(ADXL345_RANGE_16_G);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void loop(void)&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; sensors_event_t event;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; accel.</span>
<span>getEvent</span>
<span>(&amp;event);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; Serial.print("X: "); Serial.print(event.acceleration.x); Serial.print("&nbsp; ");</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; Serial.print("Y: "); Serial.print(event.acceleration.y); Serial.print("&nbsp; ");</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; Serial.print("Z: "); Serial.print(event.acceleration.z); Serial.print("&nbsp; ");Serial.println("m/s^2 ");</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; delay(500);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>次の３つの関数</span>
<span>を</span>
<span>C</span>
<span>#</span>
<span>から実行できるようにコマンドとして追加しました。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>begin()</span>
 &nbsp;</p>
<p>&nbsp;<span>setRange()</span>
 &nbsp;</p>
<p>&nbsp;<span>getEvent()</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下記はライブラリのヘッダーファイルの抜粋です。</span>
 &nbsp;</p>
<p>&nbsp;<span>C:¥Users</span>
<span>¥</span>
<span>ユーザー</span>
<span>名</span>
<span>¥Documents¥Arduino¥libraries¥Adafruit_ADXL345¥Adafruit_ADXL345_U.h</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>#define ADXL345_DEFAULT_ADDRESS&nbsp;&nbsp;&nbsp;&nbsp; (0x53)&nbsp; // Assumes ALT address pin low&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>typedef enum</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; ADXL345_RANGE_16_G&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0b11,&nbsp;&nbsp; // +/- 16g</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; ADXL345_RANGE_8_G&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0b10,&nbsp;&nbsp; // +/- 8g</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; ADXL345_RANGE_4_G&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0b01,&nbsp;&nbsp; // +/- 4g</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; ADXL345_RANGE_2_G&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0b00&nbsp;&nbsp;&nbsp; // +/- 2g (default value)</span>
 &nbsp;</p>
<p>&nbsp;<span>} range_t;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Bool&nbsp;begin(uint8_t addr = ADXL345_DEFAULT_ADDRESS);</span>
 &nbsp;</p>
<p>&nbsp;<span>Void&nbsp;setRange(range_t range);</span>
 &nbsp;</p>
<p>&nbsp;<span>Bool&nbsp;getEvent(sensors_event_t*);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>か</span>
<span>ら</span>
<span>Arduin</span>
<span>o</span>
<span>ライブラ</span>
<span>リ</span>
<span>RemoteEsp3</span>
<span>2</span>
<span>に送るコマンドのフォーマットは次のようになります。基本</span>
<span>は</span>
<span>3</span>
<span>2</span>
<span>ビット整数４個</span>
<span>、</span>
<span>1</span>
<span>6</span>
<span>バイトです。引数が３個以上の場合や文字列などの場合は</span>
<span>、</span>
<span>extsByte</span>
<span>s</span>
<span>にバイト数をセットして後に追加します。文字列の場合</span>
<span>は</span>
<span>C+</span>
<span>+</span>
<span>側で便利なようにゼロを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000028.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>コマンドの応答のフォーマットは次のようになります</span>
<span>。</span>
<span>erro</span>
<span>rは</span>
<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>内部で使用します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000092.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>独自に追加するコマンド</span>
<span>の</span>
<span>I</span>
<span>Dは</span>
<span>1000</span>
<span>0</span>
<span>以上にします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>begin(</span>
<span>)</span>
<span>コマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000050.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>setRange(</span>
<span>)</span>
<span>コマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000029.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>getEvent(</span>
<span>)</span>
<span>コマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000055.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションにクラ</span>
<span>ス</span>
<span>MyADXL34</span>
<span>5</span>
<span>を追加しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net.Esp32;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Esp32IfTest</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>class</span>
<span>&nbsp;</span>
<span>MyADXL345</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>enum</span>
<span>&nbsp;</span>
<span>range_t</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ADXL345_RANGE_16_G = 0b11,&nbsp;&nbsp;&nbsp;</span>
<span>// +/- 16g</span>
 &nbsp;</p>
<p>&nbsp;<span>ADXL345_RANGE_8_G = 0b10,&nbsp;&nbsp;&nbsp;</span>
<span>// +/- 8g</span>
 &nbsp;</p>
<p>&nbsp;<span>ADXL345_RANGE_4_G = 0b01,&nbsp;&nbsp;&nbsp;</span>
<span>// +/- 4g</span>
 &nbsp;</p>
<p>&nbsp;<span>ADXL345_RANGE_2_G = 0b00&nbsp;&nbsp;&nbsp;&nbsp;</span>
<span>// +/- 2g (default value)</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;ADXL345_BASE = 20000;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;ADXL345_BEGIN = (ADXL345_BASE + 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;ADXL345_SET_RANGE = (ADXL345_BASE + 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;ADXL345_GET_EVENT = (ADXL345_BASE + 5);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;Esp32If esp32If;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;MyADXL345(Esp32If esp32If)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>this</span>
<span>.esp32If = esp32If;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// private const int ADXL345_BEGIN = (ADXL345_BASE + 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;</span>
<span>Begin</span>
<span>()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>&nbsp;esp32If.GpioCommand(ADXL345_BEGIN, 0, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// private const int ADXL345_SET_RANGE = (ADXL345_BASE + 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;</span>
<span>SetRange</span>
<span>(range_t range)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>&nbsp;esp32If.GpioCommand(ADXL345_SET_RANGE, (</span>
<span>int</span>
<span>)range, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// private const int ADXL345_GET_EVENT = (ADXL345_BASE + 2);</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>double</span>
<span>[]&nbsp;</span>
<span>GetEvent</span>
<span>()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>byte</span>
<span>[] rxBuf;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.GpioCommand(ADXL345_GET_EVENT, 0, 0,&nbsp;</span>
<span>out</span>
<span>&nbsp;rxBuf);</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>[] ints = esp32If.BytesToIntArray(rxBuf);</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>[] doubles =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>double</span>
<span>[ints.Length];</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;i = 0; i &lt; ints.Length; i++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>doubles[i] = (</span>
<span>double</span>
<span>)ints[i] / 100;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>&nbsp;doubles;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Arduin</span>
<span>o</span>
<span>のサンプルスケッチに次のコードを追加しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>#include &lt;Adafruit_Sensor.h&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>#include &lt;Adafruit_ADXL345_U.h&gt;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>/* Assign a unique ID to this sensor at the same time */</span>
 &nbsp;</p>
<p>&nbsp;<span>Adafruit_ADXL345_Unified accel = Adafruit_ADXL345_Unified(12345);</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>#define ADXL345_BASE 20000</span>
 &nbsp;</p>
<p>&nbsp;<span>#define ADXL345_BEGIN (ADXL345_BASE+0)</span>
 &nbsp;</p>
<p>&nbsp;<span>#define ADXL345_SET_RANGE (ADXL345_BASE+1)</span>
 &nbsp;</p>
<p>&nbsp;<span>#define ADXL345_GET_EVENT (ADXL345_BASE+5)</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>void&nbsp;</span>
<span>callback</span>
<span>(byte* buffer, int command, int p1, int p2, int extsBytes) {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; switch (command) {</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define ADXL345_BEGIN (ADXL345_BASE+0)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case ADXL345_BEGIN:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoteEsp32.intToBytes((int)accel.</span>
<span>begin</span>
<span>(), buffer + 8);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define ADXL345_SET_RANGE (ADXL345_BASE+1)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case ADXL345_SET_RANGE: accel.</span>
<span>setRange</span>
<span>((range_t)p1); break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define ADXL345_GET_EVENT (ADXL345_BASE+5)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case ADXL345_GET_EVENT: {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Get a new sensor event */&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sensors_event_t event;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; accel.</span>
<span>getEvent</span>
<span>(&amp;event);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; extsBytes = 3 * 4;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoteEsp32.intToBytes(extsBytes, buffer + 12);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoteEsp32.intToBytes((int)(event.acceleration.x * 100), buffer + 16);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoteEsp32.intToBytes((int)(event.acceleration.y * 100), buffer + 20);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoteEsp32.intToBytes((int)(event.acceleration.z * 100), buffer + 24);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; break;</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>以上でコマンドを追加できました。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000012.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;Esp32If esp32If;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>MyADXL345</span>
<span>&nbsp;adxl345;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource i2cLibCts;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If =&nbsp;</span>
<span>new</span>
<span>&nbsp;Esp32If();</span>
 &nbsp;</p>
<p>&nbsp;<span>adxl345 =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>MyADXL345</span>
<span>(esp32If);</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonI2cLibStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonI2cLibStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonI2cLibStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>i2cLibCts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = i2cLibCts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(adxl345.</span>
<span>Begin</span>
<span>() == 0)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>/* There was a problem detecting the ADXL345 ... check your connections */</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>"Ooops, no ADXL345 detected ... Check your wiring!"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>adxl345.</span>
<span>SetRange</span>
<span>(MyADXL345.range_t.ADXL345_RANGE_16_G);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>[] xyz = adxl345.</span>
<span>GetEvent</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>$"x:&nbsp;</span>
<span>{xyz[0]}</span>
<span>&nbsp;y:&nbsp;</span>
<span>{xyz[1]}</span>
<span>&nbsp;z:&nbsp;</span>
<span>{xyz[2]}</span>
<span>"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(100, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(GpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>i2cLibCts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonI2cLibStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonI2cLibStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonI2cLibStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>i2cLibCts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2><b>
<span><b>14.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-29"><b>
<span><b>ライブラリを使う場合</b></span>
<span><b>（</b></span>
<span><b>SSD130</b></span>
<span><b>6</b></span>
<span><b>）</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>ESP3</span>
<span>2の</span>
<span>I</span>
<span>P</span>
<span>アドレスを表示している有</span>
<span>機</span>
<span>E</span>
<span>L</span>
<span>ディスプレ</span>
<span>イ</span>
<span>SSD130</span>
<span>6に</span>
<span>C</span>
<span>#</span>
<span>から文字を表示できるようにコマンドを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>次の関数</span>
<span>を</span>
<span>C</span>
<span>#</span>
<span>から実行できるようにコマンドとして追加します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>drawString()</span>
 &nbsp;</p>
<p>&nbsp;<span>setFont()</span>
 &nbsp;</p>
<p>&nbsp;<span>display()</span>
 &nbsp;</p>
<p>&nbsp;<span>clear()</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下記はライブラリのヘッダーファイルの抜粋です。</span>
 &nbsp;</p>
<p>&nbsp;<span>C:¥Users¥zaurus¥Documents¥Arduino¥libraries¥ESP8266_and_ESP32_Oled_Driver_for_SSD1306_display¥src¥OLEDDisplay.h</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; // Draws a string at the given location</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; void&nbsp;</span>
<span>drawString</span>
<span>(int16_t x, int16_t y, String text);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; // Sets the current font. Available default fonts</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; // ArialMT_Plain_10, ArialMT_Plain_16, ArialMT_Plain_24</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; void&nbsp;</span>
<span>setFont</span>
<span>(const uint8_t *fontData);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; // Write the buffer to the display memory</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; virtual void&nbsp;</span>
<span>display</span>
<span>(void) = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; // Clear the local pixel buffer</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; void&nbsp;</span>
<span>clear</span>
<span>(void);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>か</span>
<span>ら</span>
<span>Arduin</span>
<span>o</span>
<span>ライブラ</span>
<span>リ</span>
<span>RemoteEsp3</span>
<span>2</span>
<span>に送るコマンドのフォーマットは次のようになります。基本</span>
<span>は</span>
<span>3</span>
<span>2</span>
<span>ビット整数４個</span>
<span>、</span>
<span>1</span>
<span>6</span>
<span>バイトです。引数が３個以上の場合や文字列などの場合は</span>
<span>、</span>
<span>extsByte</span>
<span>s</span>
<span>にバイト数をセットして後に追加します。文字列の場合</span>
<span>は</span>
<span>C+</span>
<span>+</span>
<span>側で便利なようにゼロを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000028.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>コマンドの応答のフォーマットは次のようになります</span>
<span>。</span>
<span>erro</span>
<span>rは</span>
<span>C</span>
<span>#</span>
<span>ライブラ</span>
<span>リ</span>
<span>Esp32I</span>
<span>f</span>
<span>内部で使用します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000092.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>独自に追加するコマンド</span>
<span>の</span>
<span>I</span>
<span>Dは</span>
<span>1000</span>
<span>0</span>
<span>以上にします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>drawString(</span>
<span>)</span>
<span>コマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000059.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>setFont(</span>
<span>)</span>
<span>コマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000005.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>display(</span>
<span>)</span>
<span>コマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000024.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>clear(</span>
<span>)</span>
<span>コマンドとその応答は次のようにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000053.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションにクラ</span>
<span>ス</span>
<span>MyOLEDDispla</span>
<span>y</span>
<span>を追加しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net.Esp32;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Esp32IfTest</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>class</span>
<span>&nbsp;</span>
<span>MyOLEDDisplay</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;OLEDDISPLAY_BASE = 20200;</span>
 &nbsp;</p>
<p>&nbsp;<span>// void drawString(int16_t x, int16_t y, String text);</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;OLEDDISPLAY_DRAW_STRING = (OLEDDISPLAY_BASE + 17);</span>
 &nbsp;</p>
<p>&nbsp;<span>// void setFont(const uint8_t *fontData);</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;OLEDDISPLAY_SET_FONT = (OLEDDISPLAY_BASE + 21);</span>
 &nbsp;</p>
<p>&nbsp;<span>// virtual void display(void) = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;OLEDDISPLAY_DISPLAY = (OLEDDISPLAY_BASE + 31);</span>
 &nbsp;</p>
<p>&nbsp;<span>// void clear(void);</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;OLEDDISPLAY_CLEAR = (OLEDDISPLAY_BASE + 32);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;Esp32If esp32If;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;MyOLEDDisplay(Esp32If esp32If)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>this</span>
<span>.esp32If = esp32If;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// void drawString(int16_t x, int16_t y, String text);</span>
 &nbsp;</p>
<p>&nbsp;<span>// private const int OLEDDISPLAY_DRAW_STRING = 1617;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;</span>
<span>drawString</span>
<span>(</span>
<span>int</span>
<span>&nbsp;x,&nbsp;</span>
<span>int</span>
<span>&nbsp;y,&nbsp;</span>
<span>string</span>
<span>&nbsp;text)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Esp32If.GpioExtent[] exts =&nbsp;</span>
<span>new</span>
<span>&nbsp;Esp32If.GpioExtent[] {&nbsp;</span>
<span>new</span>
<span>&nbsp;Esp32If.GpioExtent() };</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>/*</span>
 &nbsp;</p>
<p>&nbsp;<span>p1=x</span>
 &nbsp;</p>
<p>&nbsp;<span>p2=y</span>
 &nbsp;</p>
<p>&nbsp;<span>## extension ##</span>
 &nbsp;</p>
<p>&nbsp;<span>char text[len]</span>
 &nbsp;</p>
<p>&nbsp;<span>*/</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>exts[0].Contents = System.Text.Encoding.UTF8.GetBytes(text +&nbsp;</span>
<span>"¥0"</span>
<span>);&nbsp;</span>
<span>/* include null byte */</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.GpioCommandExt(OLEDDISPLAY_DRAW_STRING, x, y, exts);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// void setFont(const uint8_t *fontData);</span>
 &nbsp;</p>
<p>&nbsp;<span>// private const int OLEDDISPLAY_SET_FONT = (OLEDDISPLAY_BASE + 21);</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;</span>
<span>setFont</span>
<span>(</span>
<span>int</span>
<span>&nbsp;size)</span>
 &nbsp;</p>
<p>&nbsp;<span>{ esp32If.GpioCommand(OLEDDISPLAY_SET_FONT, size, 0); }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// virtual void display(void) = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>// private const int OLEDDISPLAY_DISPLAY = (OLEDDISPLAY_BASE + 31);</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;</span>
<span>display</span>
<span>()</span>
 &nbsp;</p>
<p>&nbsp;<span>{ esp32If.GpioCommand(OLEDDISPLAY_DISPLAY, 0, 0); }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// void clear(void);</span>
 &nbsp;</p>
<p>&nbsp;<span>// private const int OLEDDISPLAY_CLEAR = (OLEDDISPLAY_BASE + 32);</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;</span>
<span>clear</span>
<span>()</span>
 &nbsp;</p>
<p>&nbsp;<span>{&nbsp;</span>
<span>return</span>
<span>&nbsp;esp32If.GpioCommand(OLEDDISPLAY_CLEAR, 0, 0); }</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Arduin</span>
<span>o</span>
<span>のサンプルスケッチに次のコードを追加しています。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>#include "SSD1306Wire.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>SSD1306Wire display(0x3c, 21, 22);</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>void setup() {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; display.init();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; display.flipScreenVertically();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; display.setFont(ArialMT_Plain_16);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; display.drawString(0, 0, WiFi.localIP().toString());</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; display.drawString(0, 16, "ESP32 (STA)");</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; display.display();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>#define OLEDDISPLAY_BASE 20200</span>
 &nbsp;</p>
<p>&nbsp;<span>#define OLEDDISPLAY_DRAW_STRING (OLEDDISPLAY_BASE+17)</span>
 &nbsp;</p>
<p>&nbsp;<span>#define OLEDDISPLAY_SET_FONT (OLEDDISPLAY_BASE+21)</span>
 &nbsp;</p>
<p>&nbsp;<span>#define OLEDDISPLAY_DISPLAY (OLEDDISPLAY_BASE+31)</span>
 &nbsp;</p>
<p>&nbsp;<span>#define OLEDDISPLAY_CLEAR (OLEDDISPLAY_BASE+32)</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>void&nbsp;</span>
<span>callback</span>
<span>(byte* buffer, int command, int p1, int p2, int extsBytes) {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; switch (command) {</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define OLEDDISPLAY_DRAW_STRING (OLEDDISPLAY_BASE+17)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case OLEDDISPLAY_DRAW_STRING: {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String p3 = String((char*)(buffer + 16));</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; display.</span>
<span>drawString</span>
<span>(p1, p2, p3);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define OLEDDISPLAY_SET_FONT (OLEDDISPLAY_BASE+21)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case OLEDDISPLAY_SET_FONT:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (p1) {</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 10: display.</span>
<span>setFont</span>
<span>(ArialMT_Plain_10); break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 16: display.</span>
<span>setFont</span>
<span>(ArialMT_Plain_16); break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 24: display.</span>
<span>setFont</span>
<span>(ArialMT_Plain_24); break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define OLEDDISPLAY_DISPLAY (OLEDDISPLAY_BASE+31)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; case OLEDDISPLAY_DISPLAY: display.</span>
<span>display</span>
<span>(); break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; //#define OLEDDISPLAY_CLEAR (OLEDDISPLAY_BASE+32)</span>
 &nbsp;</p>
<p>&nbsp;<span>case OLEDDISPLAY_CLEAR: display.</span>
<span>clear</span>
<span>(); break;</span>
 &nbsp;</p>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; }</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>以上でコマンドを追加できました。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>サンプルアプリケーションのソースコードです</span>
<span>。</span>
<span>ESP3</span>
<span>2</span>
<span>との接続処理の記述は省略しています。</span>
 &nbsp;</p>
<p>&nbsp;<span>コマンド用と割り込み用の２つの接続が繋がったとき</span>
<span>、</span>
<span>ESP3</span>
<span>2に</span>
<span>I2</span>
<span>C</span>
<span>で接続し</span>
<span>た</span>
<span>SSD130</span>
<span>6</span>
<span>ディスプレイ</span>
<span>に</span>
<span>Connecte</span>
<span>d</span>
<span>と表示します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;Esp32If esp32If;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>MyOLEDDisplay</span>
<span>&nbsp;oledDisplay;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If =&nbsp;</span>
<span>new</span>
<span>&nbsp;Esp32If();</span>
 &nbsp;</p>
<p>&nbsp;<span>oledDisplay =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>MyOLEDDisplay</span>
<span>(esp32If);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.StreamConnected += (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>oledDisplay.</span>
<span>drawString</span>
<span>(0, 48,&nbsp;</span>
<span>"Connected"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>oledDisplay.</span>
<span>display</span>
<span>();</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>15</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-30"><b>
<span><b>新規アプリケーション</b></span>
</b></a>
</b></h1>
<h2><b>
<span><b>15.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-31"><b>
<span><b>新しいソリューションを作成</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>フレームワーク</span>
<span>に</span>
<span>.NET Framework 4.</span>
<span>5</span>
<span>以上を選択して新しいプロジェク</span>
<span>ト</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションを作成します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000107.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>15.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-32"><b>
<span><b>ライブラリプロジェクトを追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>ソリューションエクスプローラでソリューションを右クリックし、「エクスプローラでフォルダーを開</span>
<span>く</span>
<span>(X</span>
<span>)</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000083.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>表示されたフォルダーに</span>
<span>、</span>
<span>GitHu</span>
<span>b</span>
<span>からダウンロードしたライブラリプロジェクト</span>
<span>「</span>
<span>Rapidnack.Commo</span>
<span>n</span>
<span>」と</span>
<span>「</span>
<span>Rapidnack.Ne</span>
<span>t</span>
<span>」をコピーします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000011.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ライブラリプロジェクト</span>
<span>「</span>
<span>Rapidnack.Commo</span>
<span>n</span>
<span>」と</span>
<span>「</span>
<span>Rapidnack.Ne</span>
<span>t</span>
<span>」をソリューションに追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000073.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000065.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000079.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ソリューションに追加されました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000042.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>プロジェクト</span>
<span>「</span>
<span>WindowsFormsApp</span>
<span>1</span>
<span>」の「参照」を右クリックして、「参照を追加</span>
<span>（R</span>
<span>）」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000027.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ライブラリプロジェクト</span>
<span>「</span>
<span>Rapidnack.Commo</span>
<span>n</span>
<span>」と</span>
<span>「</span>
<span>Rapidnack.Ne</span>
<span>t</span>
<span>」の参照をプロジェクト</span>
<span>「</span>
<span>WindowsFormsApp</span>
<span>1</span>
<span>」に追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000056.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>15.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-33"><b>
<span><b>ログ出力</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>ライブラリプロジェクト</span>
<span>「</span>
<span>Rapidnack.Commo</span>
<span>n</span>
<span>」をソリューションに追加してビルドすると、ツールボックス</span>
<span>に</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>コントロールが追加され、フォームに追加できるようになります。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000060.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>フォーム</span>
<span>に</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>を追加すると</span>
<span>、</span>
<span>System.Console.Write(</span>
<span>)、</span>
<span>System.Console.WriteLine(</span>
<span>)</span>
<span>の出力</span>
<span>が</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>に表示されるようになります。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>まず、フォームサイズ、フォントサイズなどを調整しておきます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000072.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000025.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>フォームの左側にボタンなどを載せるパネルを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000008.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000040.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>フォームの左側にグラフとログ表示エリアを載せるスプリットコンテナを追加して上下方向に分割します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000103.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>等分割になるよう</span>
<span>に</span>
<span>SplitterDistanc</span>
<span>e</span>
<span>を変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000097.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>下側</span>
<span>に</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>を配置します。ログ表示用なの</span>
<span>で</span>
<span>Multilin</span>
<span>e、</span>
<span>ReadOnl</span>
<span>y</span>
<span>にして、見易いよう</span>
<span>に</span>
<span>BackColo</span>
<span>r</span>
<span>プロパティ</span>
<span>を</span>
<span>Windo</span>
<span>w</span>
<span>に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000007.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000034.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000016.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>パネルにボタンを追加して試してみます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000109.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;button1_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;i = 0; i &lt; 10; i++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>"i = {0}"</span>
<span>, i);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000095.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>15.4</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-34"><b>
<span><b>例外対策</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>わざと例外が発生するコードを実行してみます。配列の範囲外をアクセスします。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;button1_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>[] data =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>int</span>
<span>[] { 0, 1, 4, 9, 16 };</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;i = 0; i &lt; 10; i++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>"data[{0}] = {1}"</span>
<span>, i, data[i]);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「デバッ</span>
<span>グ</span>
<span>(D</span>
<span>)</span>
<span>」メニューから「デバッグなしで開</span>
<span>始</span>
<span>(H</span>
<span>)</span>
<span>」をクリックすると、次のエラーダイアログが表示されます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000076.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000062.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>エラーダイアログの代わりに例外の情報</span>
<span>を</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>に表示するよう</span>
<span>に</span>
<span>Program.c</span>
<span>s</span>
<span>を変更します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;System;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Windows.Forms;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Max10Graph</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>static class&nbsp;</span>
<span>Program</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>///</span>
<span>&nbsp;</span>
<span>&lt;summary&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>///</span>
<span>&nbsp;アプリケーションのメイン&nbsp;エントリ&nbsp;ポイントです。</span>
 &nbsp;</p>
<p>&nbsp;<span>///</span>
<span>&nbsp;</span>
<span>&lt;/summary&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>[STAThread]</span>
 &nbsp;</p>
<p>&nbsp;<span>static</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Main()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.ThreadException += (s, e) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
 &nbsp;</p>
<p>&nbsp;<span>"{0}, {1}¥r¥n{2}¥r¥n"</span>
<span>, e.Exception.TargetSite, e.Exception.Message, e.Exception.StackTrace);</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>AppDomain.CurrentDomain.UnhandledException += (s, e) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Exception ex = e.ExceptionObject&nbsp;</span>
<span>as</span>
<span>&nbsp;Exception;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(ex !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
 &nbsp;</p>
<p>&nbsp;<span>"{0}, {1}¥r¥n{2}¥r¥n"</span>
<span>, ex.TargetSite, ex.Message, ex.StackTrace);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.EnableVisualStyles();</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.SetCompatibleTextRenderingDefault(</span>
<span>false</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.Run(</span>
<span>new</span>
<span>&nbsp;MainForm());</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「デバッ</span>
<span>グ</span>
<span>(D</span>
<span>)</span>
<span>」メニューから「デバッグなしで開</span>
<span>始</span>
<span>(H</span>
<span>)</span>
<span>」をクリックすると、例外の情報</span>
<span>が</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>に表示されます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000006.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>追加したボタ</span>
<span>ン</span>
<span>button</span>
<span>1</span>
<span>とそのイベントハンド</span>
<span>ラ</span>
<span>button1_Click(</span>
<span>)</span>
<span>は不要なので削除しておきます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>15.5</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-39"><b></b></a>
<a id="calibre_link-35"><b>
<span><b>OxyPlot.WindowsForm</b></span>
<span><b>s</b></span>
<span><b>パッケージをインストール</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>NuGe</span>
<span>t</span>
<span>パッケージマネージャーを表示します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000068.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>OxyPlot.WindowsForm</span>
<span>s</span>
<span>パッケージを検索してインストールします</span>
<span>。</span>
<span>OxyPlot.Cor</span>
<span>e</span>
<span>パッケージも一緒にインストールされます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000023.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>OxyPlot.WindowsForm</span>
<span>s</span>
<span>パッケージをインストールすると、ツールボックス</span>
<span>に</span>
<span>PlotVie</span>
<span>w</span>
<span>コントロールが表示され、フォームに追加できるようになります。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000032.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>15.6</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-40"><b></b></a>
<a id="calibre_link-36"><b>
<span><b>PlotVie</b></span>
<span><b>w</b></span>
<span><b>を画面に追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>スプリットコンテナの上側</span>
<span>に</span>
<span>PlotVie</span>
<span>w</span>
<span>を配置します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000077.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>PlotView</span>
<span>&nbsp;の</span>
<span>Doc</span>
<span>k</span>
<span>プロパティ</span>
<span>を</span>
<span>Fil</span>
<span>l、</span>
<span>BackColo</span>
<span>r</span>
<span>プロパティ</span>
<span>を</span>
<span>Windo</span>
<span>w</span>
<span>に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000081.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>15.7</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-37"><b>
<span><b>Esp32I</b></span>
<span><b>f</b></span>
<span><b>インスタンスを追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>ESP3</span>
<span>2</span>
<span>との接続に使</span>
<span>う</span>
<span>I</span>
<span>P</span>
<span>アドレス入力フィールド</span>
<span>、</span>
<span>Ope</span>
<span>n</span>
<span>ボタン</span>
<span>、</span>
<span>Clos</span>
<span>e</span>
<span>ボタンをパネルに追加します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span><b>Type</b></span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span><b>(Name)</b></span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span><b>Text</b></span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>TextBox</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>textBoxAddress</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>Button</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>buttonOpen</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>Open</span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>Button</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>buttonClose</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>Close</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000100.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>各種操作ボタンなどを配置するパネルを配置します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span><b>Type</b></span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span><b>(Name)</b></span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span><b>Text</b></span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>Panel</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>panelOperation</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000104.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000051.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>FormLoa</span>
<span>d</span>
<span>イベント</span>
<span>、</span>
<span>FormClosin</span>
<span>g</span>
<span>イベント</span>
<span>、</span>
<span>Ope</span>
<span>n</span>
<span>ボタン</span>
<span>、</span>
<span>Clos</span>
<span>e</span>
<span>ボタン</span>
<span>の</span>
<span>Clic</span>
<span>k</span>
<span>イベントを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000017.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ソースコードは次のようになります。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net.Esp32;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Windows.Forms;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;WindowsFormsApp1</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>partial</span>
<span>&nbsp;</span>
<span>class</span>
<span>&nbsp;</span>
<span>Form1</span>
<span>&nbsp;: Form</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;Esp32If esp32If;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;Form1()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>InitializeComponent();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;CloseConnection()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.GpioStop();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If =&nbsp;</span>
<span>new</span>
<span>&nbsp;Esp32If();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.StreamConnected += (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_FormClosing(</span>
<span>object</span>
<span>&nbsp;sender, FormClosingEventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonOpen_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>esp32If.GpioStart(textBoxAddress.Text,&nbsp;</span>
<span>"8888"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonClose_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ビルドして実行すると次の画面が表示されます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000035.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ESP3</span>
<span>2の</span>
<span>I</span>
<span>P</span>
<span>アドレスを入力し</span>
<span>て</span>
<span>Ope</span>
<span>n</span>
<span>ボタンをクリックすると接続メッセージが２回表示されます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000043.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>以上</span>
<span>で</span>
<span>Esp32I</span>
<span>f</span>
<span>ライブラリを使うアプリケーションのベースが完成しました。</span>
</p>
</div>
</div>


<script>function myFunction(){document.getElementById("tateyoko").classList.toggle("tateread")}</script></body></html>