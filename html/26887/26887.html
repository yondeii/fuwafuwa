<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Embedded System Advanced 3ã€€æ—¥æœ¬èªç‰ˆ: Training material for engineer Discover! How? (NGO TAMA)</title>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/css/mainday.css" title="default">
<link rel="alternate stylesheet" href="/css/mainnight.css" title="alternate">
<script type="text/javascript" src="/js/styleswitcher.js"></script>
<script type="text/javascript" src="/js/global.js"></script>
</head>
<body>
<div class="novelpage">
<div class="novelbody">
<div id="tateyoko">
<div id="_top"></div>
<a href="/">ğŸ </a>&emsp;
<a href="#" onclick="setActiveStyleSheet('default'); return false;">æ—¥</a>&emsp;
<a href="#" onclick="setActiveStyleSheet('alternate'); return false;">æœˆ</a>&emsp;
<a href="#_top" onclick="myFunction()" style="cursor: pointer;">ç¸¦æ›¸ãï¼æ¨ªæ›¸ã</a>
<div id="calibre_link-30">
<div>
<div>
<table class="noveltitle">
<tr>
<td colspan="2"><i><span><i>Embedded System Advanced 3ã€€æ—¥æœ¬èªç‰ˆ: Training material for engineer Discover! How? (NGO TAMA)</i></span></i></td>
</tr>
<tr>
                    
                    
      </tr>
<tr>
<td colspan="2">NGO TAMA</td>
</tr>
<tr>
<td colspan="2">ENUJIHOH TAMA (2017)</td>
</tr>
<tr>
<td colspan="2"></td>
</tr>
</table>
<div></div>
</div>
<div></div>
</div>
</div>



<div id="calibre_link-0">
<div>
<p>&nbsp;<span>ç›®æ¬¡</span>
 &nbsp;</p>
<p>&nbsp;<a id="calibre_link-31"></a>
<a href="#calibre_link-1">
<span><u>[1]&nbsp;é‹è»¢åˆ¶å¾¡</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-2">
<span><u>(1)&nbsp;é‹è»¢ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-3">
<span><u>(2)&nbsp;å‹•ä½œè¡¨ç¤º</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-4">
<span><u>[2]&nbsp;å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-5">
<span><u>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-6">
<span><u>(2)&nbsp;å‹•ä½œç¢ºèª</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-7">
<span><u>[3]&nbsp;å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-8">
<span><u>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-9">
<span><u>(2)&nbsp;å‹•ä½œç¢ºèª</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-10">
<span><u>[4]&nbsp;é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-11">
<span><u>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-12">
<span><u>(2)&nbsp;å‹•ä½œç¢ºèª</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-13">
<span><u>[5]&nbsp;åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-14">
<span><u>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-15">
<span><u>(2)&nbsp;å‹•ä½œç¢ºèª</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-16">
<span><u>[6]&nbsp;ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-17">
<span><u>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-18">
<span><u>(2)&nbsp;å‹•ä½œç¢ºèªï¼‘</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-19">
<span><u>(3)&nbsp;é›»åœ§ã€å›è»¢æ•°ã®ç¢ºç«‹</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-20">
<span><u>(4)&nbsp;åœæ­¢æ¤œå‡º</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-21">
<span><u>(5)&nbsp;å‹•ä½œç¢ºèªï¼’</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-22">
<span><u>[7]&nbsp;ç•°å¸¸å‡¦ç†</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-23">
<span><u>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-24">
<span><u>(2)&nbsp;å‹•ä½œç¢ºèª</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-25">
<span><u>[8]&nbsp;é‹è»¢è¨˜éŒ²</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-26">
<span><u>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-27">
<span><u>(2)&nbsp;å‹•ä½œç¢ºèª</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-28">
<span><u>[9]&nbsp;ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-29">
<span><u>[10]&nbsp;ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<p>&nbsp;<span>[æ¦‚è¦]</span>
 &nbsp;</p>
<p>&nbsp;<span>ã„ã‚ˆã„ã‚ˆã€ã“ã®æœ¬ã§ã¯åˆ¶å¾¡ã®ä¸­å¿ƒã¨ãªã‚‹é‹è»¢åˆ¶å¾¡ã‚’æ‰±ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<h1>
<a id="calibre_link-1">
<span>[1]&nbsp;é‹è»¢åˆ¶å¾¡</span>
</a>
</h1>
<p>&nbsp;<span>é‹è»¢åˆ¶å¾¡ã§ã¯ä¸‹è¨˜ã®å…¥å‡ºåŠ›ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã‚Œã‚‰ã®ãƒãƒ¼ãƒˆã®æ©Ÿèƒ½ã¯ã€ã™ã§ã«"hwsetup.cpp"ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000003.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000008.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>é‹è»¢åˆ¶å¾¡ã¯ä¸‹å›³ã®4ã¤ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«å¤§ããåˆ†ã‘ã‚‰ã‚Œã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000011.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å„ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã¯ã€æ¬¡ã®é …ç›®ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>1)&nbsp;å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸(Waiting)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(1) èµ·å‹•æ¡ä»¶ã®åˆ¤å®š</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(2) èµ·å‹•ï¼å†èµ·å‹•æ“ä½œ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(3) ç•°å¸¸å›å¾©</span>
 &nbsp;</p>
<p>&nbsp;<span>2)&nbsp;å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸(Starting)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(1)&nbsp;ã‚¨ãƒ³ã‚¸ãƒ³èµ·å‹•æŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(2) ç•°å¸¸æ¤œçŸ¥</span>
 &nbsp;</p>
<p>&nbsp;<span>3) é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸(Running)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(1)&nbsp;å›è»¢ã€é›»åœ§ã®å®‰å®šæ¤œå‡º</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(2)&nbsp;è² è·æŠ•å…¥</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(3) ç•°å¸¸æ¤œçŸ¥</span>
 &nbsp;</p>
<p>&nbsp;<span>4) åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸(Stopping)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(1) ã‚¹ãƒ­ãƒƒãƒˆãƒ«å¼é–‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(2)&nbsp;è² è·åˆ‡æ–­</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(3) åœæ­¢æ“ä½œ</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¾ãŸã€å„ã‚¹ãƒ†ãƒ¼ã‚¸ã¨ã¯ç‹¬ç«‹ã«ã€ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨ãŒã‚¨ãƒ³ã‚¸ãƒ³ã®èµ·å‹•ã€åœæ­¢ãªã©ã®æ“ä½œã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000010.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã¯å¾ã€…ã«çµ„ã¿ç«‹ã¦ã¦è¡Œãã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;common.h&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//é‹è»¢åˆ¶å¾¡ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
 &nbsp;</p>
<p>&nbsp;<span>M_WAIT,</span>
 &nbsp;</p>
<p>&nbsp;<span>M_START,</span>
 &nbsp;</p>
<p>&nbsp;<span>M_RUN,</span>
 &nbsp;</p>
<p>&nbsp;<span>M_STOP</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-2">
<span>(1) é‹è»¢ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</span>
</a>
</h2>
<p>&nbsp;<span>æ–°è¦ã«é‹è»¢ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Operation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; FILE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Operation.cpp</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; DESCRIPTION : Machine control</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; CPU TYPE&nbsp;&nbsp;&nbsp; : SH7286</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; DATE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Nov 01, 2016</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; VERSION ï¼š1.0&nbsp;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•</span>
 &nbsp;</p>
<p>&nbsp;<span>#include &lt;string.h&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>#include &lt;machine.h&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "iodefine.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>extern "C" {</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "vect.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "common.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "proto.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>#define TEST</span>
<span>1</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>static short runStage ;</span>
<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static short runSeq ;</span>
<span>//é‹è»¢ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>static short nowRpm ;</span>
<span>//ç¾åœ¨å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private function</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Waiting(void);</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Starting(void);</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Running(void);</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Stopping(void);</span>
 &nbsp;</p>
<p>&nbsp;<span>static void EngCtrl(void);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//--------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>// Functions</span>
 &nbsp;</p>
<p>&nbsp;<span>//--------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitOperation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>nowRpm = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//é‹è»¢åˆ¶å¾¡éƒ¨</span>
 &nbsp;</p>
<p>&nbsp;<span>void Operation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>ErrorCheck();</span>
 &nbsp;</p>
<p>&nbsp;<span>nowRpm = GetRpm() ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é‹è»¢åˆ¶å¾¡ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( runStage )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>case M_WAIT :</span>
<span>//å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>Waiting() ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case M_START :</span>
<span>//å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>Starting() ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case M_RUN :</span>
<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>Running() ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case M_STOP :</span>
<span>//åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>Stopping() ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>default :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>EngCtrl();</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Waiting()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Starting()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Running()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Stopping()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡</span>
 &nbsp;</p>
<p>&nbsp;<span>static void EngCtrl()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-3">
<span>(2) å‹•ä½œè¡¨ç¤º</span>
</a>
</h2>
<p>&nbsp;<span>å‹•ä½œãƒã‚§ãƒƒã‚¯ã®ãŸã‚ã«ã€é‹è»¢åˆ¶å¾¡ã«é–¢ã™ã‚‹æƒ…å ±ã‚’LCDç”»é¢ã«è¡¨ç¤ºã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Display.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//LCD display</span>
 &nbsp;</p>
<p>&nbsp;<span>void DispLCD()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( nowPage ){</span>
 &nbsp;</p>
<p>&nbsp;<span>case D_Run :</span>
<span>//operating status</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DispFunc( GetRunStage,&nbsp; GetOpeMsg );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>selectLED = L_ROT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>LCDç”»é¢ã«è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Operation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char&nbsp;scRun[][21] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Sta&nbsp;00 Seq 00 Lod 00"},</span>
<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸/é‹è»¢ã‚·ãƒ¼ã‚±ãƒ³ã‚¹/æŠ•å…¥è² è·</span>
 &nbsp;</p>
<p>&nbsp;<span>{"seq 00 sta 00 rdy 0 "},</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹/ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹/èµ·å‹•ä¸å¯ç†ç”±</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Rot&nbsp;00 Vol&nbsp;00 Try 00"},</span>
<span>//å›è»¢æ•°ç¢ºç«‹ãƒ•ãƒ©ã‚°/é›»åœ§ç¢ºç«‹ãƒ•ãƒ©ã‚°/ãƒªãƒˆãƒ©ã‚¤ã‚«ã‚¦ãƒ³ã‚¿</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Rpm 0000&nbsp;&nbsp;Rs&nbsp;0 Er 00"}};</span>
<span>//ç¾åœ¨å›è»¢æ•°/å†èµ·å‹•ãƒ•ãƒ©ã‚°/ç•°å¸¸ã‚³ãƒ¼ãƒ‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp;For Display</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetRunStage( int data[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>data[0] = runStage ;</span>
<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>data[1] = runSeq ;</span>
<span>//é‹è»¢ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>data[2] =&nbsp;0&nbsp;;</span>
<span>//æŠ•å…¥è² è·</span>
 &nbsp;</p>
<p>&nbsp;<span>data[3] =&nbsp;0&nbsp;;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>data[4] =&nbsp;0&nbsp;;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹</span>
 &nbsp;</p>
<p>&nbsp;<span>data[5] =&nbsp;0&nbsp;;</span>
<span>//èµ·å‹•ä¸å¯ç†ç”±</span>
 &nbsp;</p>
<p>&nbsp;<span>data[6] =&nbsp;0&nbsp;;</span>
<span>//å›è»¢æ•°ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>data[7] =&nbsp;0&nbsp;;</span>
<span>//é›»åœ§ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>data[8] =&nbsp;0&nbsp;;</span>
<span>//ãƒªãƒˆãƒ©ã‚¤ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>data[9] = nowRpm ;</span>
<span>//ç¾åœ¨å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>data[10] =&nbsp;0&nbsp;;</span>
<span>//å†èµ·å‹•ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>data[11] =&nbsp;0&nbsp;;</span>
<span>//ç•°å¸¸ç•ªå·</span>
 &nbsp;</p>
<p>&nbsp;<span>return 12 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//LCD</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetOpeMsg( int val[], char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[22], temp[8]&nbsp; ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int m = 0 ; m &lt; 3 ; m++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scRun[m], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[m*3+n], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 2, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[4+n*7], temp, 2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( line, scRun[3], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoa2( val[9], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>adjust( temp, 4, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[4], temp, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>itoa2( val[10], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[13], temp, 1 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>itoa2( val[11], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>adjust( temp, 2, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[18], temp, 2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ¡ã‚¤ãƒ³é–¢æ•°ã‹ã‚‰é‹è»¢ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Main.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void main(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>InitOperation();</span>
 &nbsp;</p>
<p>&nbsp;<span>set_imask(0);</span>
 &nbsp;</p>
<p>&nbsp;<span>while ( 1 )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>Analog();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>Operation();//é‹è»¢åˆ¶å¾¡éƒ¨</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã“ã¾ã§ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã‚¨ãƒ©ãƒ¼ãŒç„¡ã„ã“ã¨ã‚’ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>OKã§ã—ãŸã‚‰ã€ãƒ‡ã‚¸ã‚¿ãƒ«å…¥åŠ›éƒ¨ã«é‹è»¢æ“ä½œã‹ã‚‰å‘¼ã³å‡ºã™é–¢æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ä¸‹è¨˜ã®ãƒœã‚¿ãƒ³ã¯ã€ãƒ¢ãƒ‹ã‚¿ãƒ¼ãƒ‘ã‚½ã‚³ãƒ³ã‹ã‚‰ã‚‚æ“ä½œã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Input.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//èµ·å‹•ãƒœã‚¿ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsStart()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( ChkInp( P_Di00 ) == ON || ChkInp( P_Di12&nbsp;) == ON )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//åœæ­¢ãƒœã‚¿ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsStop()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( ChkInp( P_Di01 ) == ON || ChkInp( P_Di13&nbsp;) == ON )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsReset()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( ChkInp( P_Di02 ) == ON || ChkInp( P_Di14&nbsp;) == ON )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsEmStop()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( ChkInp( P_Di03 ) == ON || ChkInp( P_Di15&nbsp;) == ON )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã¯ã€å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸ã®çµ„ã¿è¾¼ã¿ã«é€²ã¿ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-4">
<span>[2]&nbsp;å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸</span>
</a>
</h1>
<p>&nbsp;<span>èµ·å‹•ã™ã‚‹å‰ã«ã€é‹è»¢ãŒå¯èƒ½ãªçŠ¶æ…‹ã«ã‚ã‚‹ã‹ã‚’èª¿ã¹ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¾ãŸã€ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸæ™‚ã®å‹•ä½œã‚‚çµ„ã¿è¾¼ã¿ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼ˆä»Šå›ä½¿ç”¨ã™ã‚‹å®Ÿæ©Ÿã§ã¯ã€æ”¾ç†±ãƒ•ã‚¡ãƒ³ã¯ã‚¨ãƒ³ã‚¸ãƒ³å´ã§åˆ¶å¾¡ã—ã¦ã„ã¾ã™ã®ã§ã€ãƒã‚¤ã‚³ãƒ³å´ã§ã¯æ‰±ã£ã¦ã„ã¾ã›ã‚“ã€‚ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000012.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-5">
<span>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </span>
</a>
</h2>
<p>&nbsp;<span>===== Operation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>#define R_STOP</span>
<span>100</span>
<span>//åœæ­¢ã¨åˆ¤æ–­ã™ã‚‹å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>//å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>enum { W_BEGIN,W_WAKEUP,W_START,W_ERROR,W_RESET,W_RELEASE };</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ³ã‚¸ãƒ³é‹è»¢æŒ‡ç¤º&nbsp; engCmd</span>
 &nbsp;</p>
<p>&nbsp;<span>enum { C_NULL,C_STOP,C_START,C_EMSTOP };</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>static short reason ;</span>
<span>//èµ·å‹•ä¸å¯ã®ç†ç”±</span>
 &nbsp;</p>
<p>&nbsp;<span>static short engCmd ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³é‹è»¢æŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>static short loadIndex ;</span>
<span>//æŠ•å…¥è² è·</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitOperation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>reason = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>engCmd = C_NULL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>loadIndex = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//èµ·å‹•ã®æº–å‚™ãŒå‡ºæ¥ã¦ã„ã‚‹ã‹ã‚’èª¿ã¹ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>static int IsStartReady()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsEmStop() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>reason = 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ã‚µãƒ¼ãƒãƒ«ãƒˆãƒªãƒƒãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( ChkInp( P_Di07&nbsp;) == ON&nbsp; )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>reason = 2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//å›è»¢ä¸­ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( nowRpm &gt;= R_STOP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>reason = 3 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ã‚¿ãƒ¼å¾…æ©Ÿä½ç½®</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (&nbsp;IsMotorReady&nbsp;() == false )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>reason = 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//è‡ªå‹•ã‚¹ã‚¤ãƒƒãƒOFF</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( ChkInp( P_Di04 ) == ON )</span>
<span>// è‡ªå‹•=OFFï¼æ‰‹å‹•=ON</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>reason = 5 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>reason = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return reason ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>static void EmStop()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>engCmd = C_EMSTOP ;</span>
<span>//ç·Šæ€¥åœæ­¢æŒ‡ç¤ºã‚’å‡ºã™</span>
 &nbsp;</p>
<p>&nbsp;<span>OffOut( P_Do00 );</span>
<span>//ACC-SWITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>OffOut( P_Do01 );</span>
<span>//ON-SWITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>OffOut( P_Do02 );</span>
<span>//START-SWITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>OffOut( P_Do04 );</span>
<span>//è² è·ï¼‘</span>
 &nbsp;</p>
<p>&nbsp;<span>OffOut( P_Do05 );</span>
<span>//è² è·ï¼’</span>
 &nbsp;</p>
<p>&nbsp;<span>OffOut( P_Do06 );</span>
<span>//è² è·ï¼“</span>
 &nbsp;</p>
<p>&nbsp;<span>OffOut( P_Do07 );</span>
<span>//è² è·ï¼”</span>
 &nbsp;</p>
<p>&nbsp;<span>OffOut( P_Do08 );</span>
<span>//è² è·ï¼•</span>
 &nbsp;</p>
<p>&nbsp;<span>OffOut( P_Do09 );</span>
<span>//è² è·ï¼–</span>
 &nbsp;</p>
<p>&nbsp;<span>OffOut( P_Do10 );</span>
<span>//ç‡ƒæ–™é®æ–­å¼ã€é‹è»¢ä¸­è¡¨ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>StopMotor();</span>
<span>//ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ã‚¿ãƒ¼åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>loadIndex = 0;</span>
<span>//æŠ•å…¥è² è·</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Waiting()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( runSeq &lt; W_ERROR &amp;&amp; IsEmergency() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>EmStop();</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = W_ERROR ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( runSeq ){</span>
 &nbsp;</p>
<p>&nbsp;<span>case W_BEGIN :</span>
<span>//èµ·å‹•å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer(&nbsp;TM18&nbsp;) == OFF )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnTimer(&nbsp;TM18&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( ChkTimer(&nbsp;TM18&nbsp;) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engCmd = C_NULL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsStartReady() == 0 )</span>
<span>//èµ·å‹•å¯èƒ½ãªã‚‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnOut( P_Do00&nbsp;);</span>
<span>//ACC-SWITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer(&nbsp;TM18&nbsp;);&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runSeq++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case W_WAKEUP :</span>
<span>//èµ·å‹•å¾…ã¡</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsStartReady() == 0 )</span>
<span>//èµ·å‹•å¯èƒ½ãªã‚‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsStart() == true )</span>
<span>//èµ·å‹•ãƒœã‚¿ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnOut( P_Do01&nbsp;);</span>
<span>//ON-SWITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnOut( P_Do10 );</span>
<span>//ç‡ƒæ–™é®æ–­å¼ON,é‹è»¢ä¸­è¡¨ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer(&nbsp;TM18&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runSeq++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffOut( P_Do00&nbsp;);</span>
<span>//ACC-SWITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = W_BEGIN ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case W_START :</span>
<span>//èµ·å‹•å†ç¢ºèª</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer(&nbsp;TM18&nbsp;) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer(&nbsp;TM18&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsStartReady() == 0 )</span>
<span>//èµ·å‹•å¯èƒ½ãªã‚‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runStage = M_START ;</span>
<span>//ç™ºé›»è£…ç½®é‹è»¢é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffOut( P_Do00&nbsp;);</span>
<span>//ACC-SWITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffOut( P_Do01&nbsp;);</span>
<span>//ON-SWITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffOut( P_Do10 );</span>
<span>//ç‡ƒæ–™é®æ–­å¼OFF</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runSeq = W_BEGIN ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case W_ERROR :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>EmStop();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case W_RESET :</span>
<span>//ç•°å¸¸è§£é™¤å¾…ã¡</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsReset() == true&nbsp;&amp;&amp; IsMsgDisp() == false&nbsp;)</span>
<span>//ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ResetError();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;</span>
<span>W_RELEASE :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsReset() == false )</span>
<span>//ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = W_BEGIN ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>default :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq =&nbsp;0&nbsp;;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Starting()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsEmergency() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>EmStop();</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = W_ERROR ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsEmergency()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return IsEmStop();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void ResetError()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>OffOut( P_Do03 );</span>
<span>//ç•°å¸¸ãƒ©ãƒ³ãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ã‚¿ãƒ¼å´ã®æƒ…å ±å–å¾—ã¨ã€ãƒ¢ãƒ¼ã‚¿ãƒ¼ã®åœæ­¢ã‚’æŒ‡ç¤ºã™ã‚‹é–¢æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Stepping.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ã‚¿ãƒ¼ã¯å¾…æ©ŸçŠ¶æ…‹ã«ã‚ã‚‹ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsMotorReady()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( sequence == S_COMMAND )</span>
<span>//å‘½ä»¤å¾…æ©Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ã‚¿ãƒ¼åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>void&nbsp;StopMotor()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>MoveValve( 0 );</span>
 &nbsp;</p>
<p>&nbsp;<span>AutoControl( false );</span>
 &nbsp;</p>
<p>&nbsp;<span>sequence = S_ERROR2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-6">
<span>(2) å‹•ä½œç¢ºèª</span>
</a>
</h2>
<p>&nbsp;<span>ãƒ“ãƒ«ãƒ‰å¾Œã€å®Ÿè¡Œã—ã¦ã€ã“ã“ã¾ã§ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰èµ·å‹•é–‹å§‹æ¡ä»¶ãŒæˆç«‹ã—ã¦ã„ã‚‹æ™‚ã¯ã€AC</span>
<span>C</span>
<span>&nbsp;</span>
<span>-SWITCHãŒONã—ã¦ã„ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰ã‚µãƒ¼ãƒãƒ«ãƒˆãƒªãƒƒãƒ—ã‚’ä½œå‹•ã•ã›ã‚‹ã¨ã€AC</span>
<span>C</span>
<span>&nbsp;</span>
<span>-SWITCHã¯OFFã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰æ¡ä»¶ãŒæˆç«‹ã—ã¦ã„ã‚‹æ™‚ã«ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€AC</span>
<span>C</span>
<span>&nbsp;</span>
<span>-SWITCHãŒOFFã«ãªã‚Šã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒç•°å¸¸è§£é™¤å¾…ã¡ã«è¡Œãã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼”ï¼‰ç·Šæ€¥åœæ­¢ã‚’è§£é™¤ã—ã¦ã€ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€å†ã³AC</span>
<span>C</span>
<span>&nbsp;</span>
<span>-SWITCHã¯ONã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼•ï¼‰AC</span>
<span>C</span>
<span>&nbsp;</span>
<span>-SWITCHãŒONã®æ™‚ã«ã€é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ON-SWITCHã¨ç‡ƒæ–™é®æ–­å¼ãŒONã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼–ï¼‰ãã—ã¦ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã¯å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼—ï¼‰å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã®çŠ¶æ…‹ã§ã€ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã¯å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸ã«æˆ»ã‚Šã€ãƒªã‚»ãƒƒãƒˆå¾…ã¡ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã™ã¹ã¦OKã§ã—ãŸã‚‰ã€å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã®çµ„ã¿è¾¼ã¿ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-7">
<span>[3]&nbsp;å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸</span>
</a>
</h1>
<p>&nbsp;<span>ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒ†ã‚¹ãƒˆä¸­ã¯ã‚¨ãƒ³ã‚¸ãƒ³ã‚’å‹•ã‹ã—ã¾ã›ã‚“ã€‚ã—ã‹ã—ã€ã“ã®çŠ¶æ…‹ã§ã¯å¤‰åŒ–ãŒãªãã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒé€²ã¿ã¾ã›ã‚“ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®ãŸã‚ã€ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨ã«ãƒ†ã‚¹ãƒˆç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚’æº–å‚™ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000000.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-8">
<span>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </span>
</a>
</h2>
<p>&nbsp;<span>===== Operation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>//å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>enum { S_BEGIN</span>
<span>,</span>
<span>&nbsp;</span>
<span>S_MOST&nbsp;};</span>
 &nbsp;</p>
<p>&nbsp;<span>//åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>enum { T_STOP,T_DOWN,T_DOWN2,T_ZERO,T_WAIT };</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹&nbsp; engStep</span>
 &nbsp;</p>
<p>&nbsp;<span>enum { E_IDLE,E_MOVE,E_MOVE2,E_START,E_UP,E_RESTA,E_AUTO,E_STABLE,E_GENE,E_STOP,E_SLOW };</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹&nbsp; engState</span>
 &nbsp;</p>
<p>&nbsp;<span>enum { A_IDLE,A_MOST,A_SUMMIT,A_FAIL };</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>static short engState ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹</span>
 &nbsp;</p>
<p>&nbsp;<span>static short engStep ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitOperation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>engState = A_IDLE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>engStep = E_IDLE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Starting()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsEmergency() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é€šå¸¸åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsStop() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( runSeq ){</span>
 &nbsp;</p>
<p>&nbsp;<span>case S_BEGIN :</span>
<span>//é‹è»¢é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engCmd = C_START ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³èµ·å‹•é–‹å§‹æŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;S_MOST&nbsp;:</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³å§‹å‹•ãƒã‚§ãƒƒã‚¯</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( engState == A_FAIL )</span>
<span>//å§‹å‹•å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( engState ==&nbsp;A_MOST )</span>
<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã¸</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_RUN ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>default :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq =&nbsp;0&nbsp;;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Running()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsEmergency() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>EmStop();</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = W_ERROR ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Stopping()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsEmergency() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>EmStop();</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = W_ERROR ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( runSeq )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>case T_STOP :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engCmd = C_STOP ;</span>
<span>//é‹è»¢åœæ­¢æŒ‡ç¤ºã‚’å‡ºã™</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffOut( P_Do10 );</span>
<span>//ç‡ƒæ–™é®æ–­å¼ã€é‹è»¢ä¸­è¡¨ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffOut( P_Do01 );</span>
<span>//ON-SWITCH=OFF</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>case T_DOWN :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>static void EngCtrl()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( engStep ){</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_IDLE :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm &gt;= GetCtrl( C06 )) //ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼åœæ­¢å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_MOVE :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm &gt;= GetCtrl( C07 ))</span>
<span>//ã‚¨ãƒ³ã‚¹ãƒˆåˆ¤å®šå›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_MOST ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( nowRpm &lt; GetCtrl( C06 ))</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_UP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_MOVE2 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm &gt;= GetCtrl( C08 ))</span>
<span>//ç›®æ¨™å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_SUMMIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( nowRpm &lt; GetCtrl( C07 ))&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_UP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_START :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm &lt; GetCtrl( C07 ))&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_UP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;</span>
<span>E_UP :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm &lt; R_STOP )</span>
<span>//åœæ­¢åˆ¤å®šå›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_IDLE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_IDLE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetRunStage( int data[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>data[3] = engStep ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>data[4] = engState ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹</span>
 &nbsp;</p>
<p>&nbsp;<span>data[5] = reason ;</span>
<span>//èµ·å‹•ä¸å¯ç†ç”±</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å›è»¢æ•°å€¤ã‚’å®šç¾©ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;common.h&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//åˆ¶å¾¡å®šæ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>C06,</span>
<span>//ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼åœæ­¢å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>C07,</span>
<span>//ã‚¨ãƒ³ã‚¹ãƒˆåˆ¤å®šå›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>C08,</span>
<span>//ç›®æ¨™å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>åˆ¶å¾¡å®šæ•°ã«å›è»¢æ•°å€¤ã‚’ã‚»ãƒƒãƒˆã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;ctrl.h&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>const short ctrlBase[CTRLNUM] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>400,</span>
<span>//C06</span>
 &nbsp;</p>
<p>&nbsp;<span>1100,</span>
<span>//C07</span>
 &nbsp;</p>
<p>&nbsp;<span>1500,</span>
<span>//C08</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-9">
<span>(2) å‹•ä½œç¢ºèª</span>
</a>
</h2>
<p>&nbsp;<span>ã§ã¯å®Ÿè¡Œã—ã¦ã€å§‹å‹•ã¾ã§ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã«å…¥ã£ãŸã®ãŒã€LCDã§ç¢ºèªå‡ºæ¥ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰ãã®æ™‚ã«ã€ã‚¨ãƒ³ã‚¸ãƒ³èµ·å‹•é–‹å§‹æŒ‡ç¤ºã‚‚è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼”ï¼‰åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã§ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€å¾…æ©Ÿã«æˆ»ã—ã€å†ã³å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã«å…¥ã‚Œã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼•ï¼‰å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã§ãƒ†ã‚¹ãƒˆç”¨ã®å›è»¢æ•°å¤‰æ›´VRã‚’å›ã—ã¦ã€å›è»¢æ•°ã‚’410rpmä»¥ä¸Šã«è¨­å®šã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼–ï¼‰ãã®å¾Œã€å›è»¢æ•°ã‚’400rpmä»¥ä¸‹ã«ã™ã‚‹ã¨ã€ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹ã¯å§‹å‹•å¤±æ•—ã«ãªã‚Šã€åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼—ï¼‰å›è»¢æ•°ã‚’0rpmã«ã—ã¦ã€å†ã³å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã«å…¥ã‚Œã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼˜ï¼‰VRã‚’å›ã—ã¦ã€å›è»¢æ•°ãŒ1500rpmã‚’è¶…ãˆã‚‹ã¨ã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒé‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼™ï¼‰é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã§ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€å¾…æ©Ÿã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å¦‚ä½•ã§ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ã™ã¹ã¦OKã§ã—ãŸã‚‰ã€æ¬¡ã®é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã®çµ„ã¿è¾¼ã¿ã«é€²ã¿ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-10">
<span>[4]&nbsp;é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
</a>
</h1>
<p>&nbsp;<span>é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000006.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-11">
<span>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </span>
</a>
</h2>
<p>&nbsp;<span>===== Operation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>enum { R_MOST,R_LOAD,R_RUNNING };</span>
 &nbsp;</p>
<p>&nbsp;<span>#define LOADCOUNT</span>
<span>6</span>
<span>//æŠ•å…¥è² è·æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Running()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsEmergency() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é€šå¸¸åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if (&nbsp;IsStop() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( engState == A_FAIL )&nbsp;</span>
<span>//ä¸å…·åˆç™ºç”Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>loadIndex = 0;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( runSeq )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;R_MOST ://å›è»¢ã€é›»åœ§ç¢ºç«‹å¾…ã¡</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( engState == A_SUMMIT )</span>
<span>//å›è»¢ã€é›»åœ§å…±ã«ç¢ºç«‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnTimer( TM05 );</span>
<span>//è² è·æŠ•å…¥é–“éš”</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>loadIndex = 1;</span>
<span>//æŠ•å…¥è² è·</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnOut( P_Do04 );</span>
<span>//è² è·ï¼‘</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;R_LOAD&nbsp;:</span>
<span>//è² è·æŠ•å…¥</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer( TM05 ) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>switch ( loadIndex ){</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 1 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnOut( P_Do05 );</span>
<span>//è² è·ï¼’</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 2 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnOut( P_Do06 );</span>
<span>//è² è·ï¼“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 3 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnOut( P_Do07 );</span>
<span>//è² è·ï¼”</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 4 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnOut( P_Do08 );</span>
<span>//è² è·ï¼•</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 5 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnOut( P_Do09 );</span>
<span>//è² è·ï¼–</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//å…¨éƒ¨æŠ•å…¥ã—ãŸã‚‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++loadIndex &gt;= LOADCOUNT )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffTimer( TM05 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runSeq++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer( TM05 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case R_RUNNING :</span>
<span>//å®šå¸¸é‹è»¢ä¸­</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>default :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int&nbsp;GetRunStage( int data[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>data[2] = loadIndex ;</span>
<span>//æŠ•å…¥è² è·</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;common.h&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¿ã‚¤ãƒãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>TM05,</span>
<span>//è² è·æŠ•å…¥é–“éš”</span>
 &nbsp;</p>
<p>&nbsp;<span>TM06,</span>
<span>//è² è·åˆ‡æ–­é–“éš”;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;timer.h&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>const unsigned short timeBase[TMRNUM] = {</span>
<span>//100ms</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>50,</span>
<span>//TM05</span>
 &nbsp;</p>
<p>&nbsp;<span>10,</span>
<span>//TM06</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-12">
<span>(2) å‹•ä½œç¢ºèª</span>
</a>
</h2>
<p>&nbsp;<span>ã§ã¯å®Ÿè¡Œã—ã¦ã€é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã¾ã§ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã€å›è»¢æ•°ã‚’1500rpmä»¥ä¸Šã«ã—ã¦é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«å…¥ã‚Œã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰è² è·æŠ•å…¥ãŒ5ç§’ä½ã®é–“éš”ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰å…¨éƒ¨ã®è² è·ãŒæŠ•å…¥ã•ã‚ŒãŸã‚‰ã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒå®šå¸¸é‹è»¢ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼”ï¼‰ã“ã“ã§å›è»¢æ•°ã‚’1100rpmã‚ˆã‚Šä¸‹ã’ã‚‹ã¨ã€ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹ã¯ã‚¨ãƒ³ã‚¹ãƒˆã¨ãªã‚Šã€åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼•ï¼‰åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã§ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€å¾…æ©Ÿã«æˆ»ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼–ï¼‰å›è»¢æ•°ã‚’0rpmã«ã—ã¦ã‹ã‚‰ã€å†ã³é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«å…¥ã‚Œã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼—ï¼‰è² è·æŠ•å…¥ä¸­ã§ã‚‚ã€åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨ã«é‹è»¢åœæ­¢æŒ‡ç¤ºãŒå‡ºã•ã‚Œã€åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼˜ï¼‰é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã§ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨ã«ç·Šæ€¥åœæ­¢æŒ‡ç¤ºãŒå‡ºã•ã‚Œã€å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã‚Œã‚‚ã™ã¹ã¦OKã§ã—ãŸã‚‰ã€æ¬¡ã®åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã®çµ„ã¿è¾¼ã¿ã«ç§»ã‚Šã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-13">
<span>[5]&nbsp;åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
</a>
</h1>
<p>&nbsp;<span>ã‚¨ãƒ³ã‚¸ãƒ³ã¯ç¨®ã€…ã®è¦å› ã§ä¸èª¿ã«ãªã‚Šæ­¢ã¾ã£ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—é‡å¤§ã§ã¯ãªã„åŸå› ã§åœæ­¢ã—ãŸå ´åˆã¯ã€è‡ªå‹•çš„ã«å†èµ·å‹•ã‚’è©¦ã¿ã‚‹ã“ã¨ãŒæœ›ã¾ã‚Œã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰åœæ­¢ãƒœã‚¿ãƒ³ã‚„ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦åœæ­¢ã•ã›ãŸã®ã‹</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰é‡å¤§ãªç•°å¸¸ã‚’æ¤œå‡ºã—ã¦åœæ­¢ã—ãŸã®ã‹</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰ã‚¨ãƒ³ã‚¸ãƒ³ã®å§‹å‹•ã«å¤±æ•—ã—ãŸã¨ã‹ã€ç‡ƒæ–™ã®é–¢ä¿‚ã§ã‚¨ãƒ³ã‚¹ãƒˆã—ãŸã®ã‹</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚’åˆ¤æ–­ã—ã¦ã€å†èµ·å‹•ã‚’è¡Œã†ã‹å¦ã‹ã‚’æ±ºã‚ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ãã®ãŸã‚ã«ã€åœæ­¢åŸå› ã‚’ç¤ºã™å¤‰æ•°(cause)ã‚’ä½¿ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000001.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-14">
<span>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </span>
</a>
</h2>
<p>&nbsp;<span>===== Operation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>//é‹è»¢åœæ­¢åŸå›  cause</span>
 &nbsp;</p>
<p>&nbsp;<span>enum { U_NONE,U_STOP,U_ERROR,U_FAIL };</span>
<span>//åœæ­¢ãƒœã‚¿ãƒ³ã€ã‚¨ãƒ©ãƒ¼ã€å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool&nbsp;restart&nbsp;;</span>
<span>//å†èµ·å‹•ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>static short cause ;</span>
<span>//åœæ­¢åŸå› </span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitOperation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>restart&nbsp; = false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>cause = U_NONE ;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Waiting()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case W_WAKEUP :</span>
<span>//èµ·å‹•å¾…ã¡</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsStartReady() == 0 )</span>
<span>//èµ·å‹•å¯èƒ½ãªã‚‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsStart() == true || (( ChkTimer(&nbsp;TM18&nbsp;) == UP ) &amp;&amp; (&nbsp;restart&nbsp;== true )))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//èµ·å‹•ãƒœã‚¿ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case W_START :</span>
<span>//èµ·å‹•å†ç¢ºèª</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsStartReady(true) == 0 )</span>
<span>//èµ·å‹•å¯èƒ½ãªã‚‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>cause = U_NONE;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;</span>
<span>W_RELEASE :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsReset() == false )</span>
<span>//ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = W_BEGIN ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>restart&nbsp;= false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Starting()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é€šå¸¸åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsStop() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>cause = U_STOP ;</span>
<span>//åœæ­¢åŸå› </span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Running()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é€šå¸¸åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsStop() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>cause = U_STOP ;</span>
<span>//åœæ­¢åŸå› </span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Stopping()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsEmergency() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsStop() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>cause = U_STOP ;</span>
<span>//åœæ­¢åŸå› </span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( runSeq )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>case T_STOP :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>case T_DOWN :</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm &lt; R_STOP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnTimer( TM06 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>loadIndex = 1;</span>
<span>//åˆ‡æ–­è² è·</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffOut( P_Do04 );</span>
<span>//è² è·ï¼‘</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>case T_DOWN2 :</span>
<span>//è² è·åˆ‡æ–­</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer( TM06 ) == UP )</span>
<span>//è² è·åˆ‡æ–­é–“éš”</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>switch ( loadIndex ){</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 1 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffOut( P_Do05 );</span>
<span>//è² è·ï¼’</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 2 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffOut( P_Do06 );</span>
<span>//è² è·ï¼“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 3 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffOut( P_Do07 );</span>
<span>//è² è·ï¼”</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 4 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffOut( P_Do08 );</span>
<span>//è² è·ï¼•</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 5 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffOut( P_Do09 );</span>
<span>//è² è·ï¼–</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//å…¨éƒ¨åˆ‡æ–­ã—ãŸã‚‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++loadIndex &gt;= LOADCOUNT )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffTimer( TM06 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer(&nbsp;TM20&nbsp;);</span>
<span>//åŸç‚¹å¾©å¸°å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runSeq++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer( TM06 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case T_ZERO :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ã‚¿ãƒ¼å¾…æ©ŸçŠ¶æ…‹æ¤œçŸ¥</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if (IsMotorReady() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer(&nbsp;TM20&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( Severity() == HIGH_ERR )</span>
<span>//é‡å¤§ãªç•°å¸¸</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runSeq = W_ERROR ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer(&nbsp;TM17&nbsp;);&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runSeq++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( ChkTimer(&nbsp;TM20&nbsp;) == UP )</span>
<span>//åŸç‚¹å¾©å¸°å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer(&nbsp;TM20&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetError(ERR_4);</span>
<span>//åŸç‚¹å¾©å¸°å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = W_ERROR ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>case T_WAIT :</span>
<span>//å†èµ·å‹•ã®ä¼‘æ­¢æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer(&nbsp;TM17&nbsp;) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer(&nbsp;TM17&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>loadIndex = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( cause == U_STOP || cause == U_ERROR )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>restart&nbsp;= false;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>restart&nbsp;= true;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>default :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡</span>
 &nbsp;</p>
<p>&nbsp;<span>static void EngCtrl()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( engStep ){</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_MOVE :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//å§‹å‹•å¤±æ•—æ¤œå‡ºç”¨</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( nowRpm &lt; GetCtrl( C06 )) //ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼åœæ­¢å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_UP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>cause = U_FAIL&nbsp;;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_MOVE2 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ã‚¨ãƒ³ã‚¹ãƒˆæ¤œå‡ºç”¨</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( nowRpm &lt; GetCtrl( C07 ))</span>
<span>//ã‚¨ãƒ³ã‚¹ãƒˆå›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_UP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>cause = U_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_START :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm &lt; GetCtrl( C07 ))</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_UP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>cause = U_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void SetError(int n)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int Severity()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return&nbsp;LOW_ERR&nbsp;;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;common.h&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ©ãƒ¼ã®é‡å¤§ã•</span>
 &nbsp;</p>
<p>&nbsp;<span>enum { NONE_ERR,LOW_ERR,HIGH_ERR };</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_1 = 1,</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_2,</span>
<span>//ã‚¹ãƒ­ãƒƒãƒˆãƒ«ä½ç½®é€¸è„±</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_3,</span>
<span>//å†èµ·å‹•å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_4,</span>
<span>//åŸç‚¹å¾©å¸°å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_5,</span>
<span>//ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ã‚¿ãƒ¼ç•°å¸¸</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_6,</span>
<span>//ã‚µãƒ¼ãƒãƒ«ãƒˆãƒªãƒƒãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_7,</span>
<span>//é«˜å›è»¢</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_8,</span>
<span>//æ²¹åœ§ã‚¹ã‚¤ãƒƒãƒä½œå‹•</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_9,</span>
<span>//å†·å´æ°´é«˜æ¸©</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_10,</span>
<span>//å‘¨æ³¢æ•°ç¯„å›²å¤–</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_11,</span>
<span>//ç™ºé›»é›»åœ§ç¯„å›²å¤–</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_12,</span>
<span>//èµ·å‹•å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_13,</span>
<span>//ã‚¨ãƒ³ã‚¹ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_14,</span>
<span>//ç¢ºç«‹å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_15,</span>
<span>//å†·å´æ°´ãƒ¬ãƒ™ãƒ«&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ERR_16,</span>
<span>//äºˆå‚™</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-15">
<span>(2) å‹•ä½œç¢ºèª</span>
</a>
</h2>
<p>&nbsp;<span>ã§ã¯å®Ÿè¡Œã—ã¦ã€åœæ­¢ã¾ã§ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã«ã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰å›è»¢æ•°ã‚’410rpmã¾ã§ä¸Šã’ãŸå¾Œã«ã€400rpmä»¥ä¸‹ã«ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰ã™ã‚‹ã¨å§‹å‹•å¤±æ•—ã«ãªã‚Šã€åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼”ï¼‰ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨ã«åœæ­¢æŒ‡ç¤ºãŒå‡ºã•ã‚Œã€ç‡ƒæ–™é®æ–­å¼ã¨ON-SWITCHãŒOFFã«ãªã‚Šã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼•ï¼‰ã—ã°ã‚‰ãå¾…ã£ã¦ã„ã‚‹ã¨ã€å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸ã«ãªã‚Šã€è‡ªå‹•çš„ã«å†èµ·å‹•ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼–ï¼‰ä»Šåº¦ã¯é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã¾ã§ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’é€²ã‚ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼—ï¼‰è² è·æŠ•å…¥ã®æœ€ä¸­ã«ã€å›è»¢æ•°ã‚’1000rpmä»¥ä¸‹ã«ä¸‹ã’ã‚‹ã¨ã‚¨ãƒ³ã‚¹ãƒˆã«ãªã‚Šã€åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼˜ï¼‰ãã“ã§å›è»¢æ•°ã‚’100rpmä»¥ä¸‹ã«ã™ã‚‹ã¨è² è·ã®åˆ‡æ–­ãŒé–‹å§‹ã•ã‚Œã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼™ï¼‰å…¨éƒ¨ã®è² è·ãŒåˆ‡æ–­ã•ã‚Œã‚‹ã¨ã€ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ã‚¿ãƒ¼ã«åŸç‚¹å¾©å¸°æŒ‡ç¤ºãŒå‡ºã•ã‚Œã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼ï¼‰ãã—ã¦ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ã‚¿ãƒ¼ãŒã‚³ãƒãƒ³ãƒ‰å¾…ã¡çŠ¶æ…‹ã«ãªã‚Šã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‘ï¼‰ãã®å¾Œã€å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸ã«æˆ»ã‚Šã€è‡ªå‹•çš„ã«å†èµ·å‹•ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼’ï¼‰å†ã³ã€é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«é€²ã‚ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼“ï¼‰å…¨éƒ¨ã®è² è·ãŒæŠ•å…¥ã•ã‚ŒãŸå¾Œã«ã€åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼”ï¼‰ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨ã«åœæ­¢æŒ‡ç¤ºãŒå‡ºã•ã‚Œã€ç‡ƒæ–™é®æ–­å¼ã¨ON-SWITCHãŒOFFã«ãªã‚Šã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼•ï¼‰ãã—ã¦å›è»¢æ•°ã‚’100rpmä»¥ä¸‹ã«ã™ã‚‹ã¨è² è·ã®åˆ‡æ–­ãŒè¡Œã‚ã‚Œã€å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸ã«æˆ»ã‚Šã¾ã—ãŸï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼–ï¼‰åœæ­¢ãƒœã‚¿ãƒ³ã§åœæ­¢ã•ã›ãŸã®ã§ã€å†èµ·å‹•ã¯ã—ãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã™ã¹ã¦OKã§ã—ãŸã‚‰ã€æœ€å¾Œã®ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨ã®çµ„ã¿è¾¼ã¿ã«ç§»ã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-16">
<span>[6]&nbsp;ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨</span>
</a>
</h1>
<p>&nbsp;<span>ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã¯ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨ã§æ“ä½œã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã§ã¯ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒONã—ãªã„ã‚ˆã†ã«å›è·¯ã‚’åˆ‡æ–­ã—ã¦ã€LED ã‚„LCDã§å‹•ä½œã®ç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000009.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000002.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000004.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-17">
<span>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </span>
</a>
</h2>
<p>&nbsp;<span>===== Operation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>#define RETRY 5</span>
<span>//æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>static short tryCtr ;</span>
<span>//ãƒªãƒˆãƒ©ã‚¤ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool rotZone ;</span>
<span>//å›è»¢æ•°ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool volZone ;</span>
<span>//é›»åœ§ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitOperation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>tryCtr = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>rotZone = false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>volZone = false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡</span>
 &nbsp;</p>
<p>&nbsp;<span>static void EngCtrl()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( engCmd == C_EMSTOP )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engCmd = C_NULL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( engStep &gt;= E_MOVE &amp;&amp; engStep &lt;= E_GENE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( engCmd == C_STOP )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engCmd = C_NULL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( engStep &gt;= E_MOVE &amp;&amp; engStep &lt;= E_GENE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( engCmd == C_START )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engCmd = C_NULL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( engStep == E_IDLE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_MOVE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( engStep ){</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_IDLE :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>tryCtr = 0 ;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_IDLE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_MOVE :</span>
<span>//ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼èµ·å‹•ã®ãŸã‚ã‚¹ãƒ­ãƒƒãƒˆãƒ«ã‚’é–‹ã</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>StepSetting( V_FIX, GetCtrl( C00 ));</span>
<span>//èµ·å‹•æ™‚ã®ã‚¹ãƒ­ãƒƒãƒˆãƒ«é–‹åº¦</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnTimer( TM08 );</span>
<span>//ã‚¹ãƒ­ãƒƒãƒˆãƒ«èµ·å‹•ä½ç½®å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_MOVE2 :</span>
<span>//&nbsp;ã‚¹ãƒ­ãƒƒãƒˆãƒ«å§‹å‹•ä½ç½®</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsGiveOff() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM08 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( ChkTimer( TM08 ) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM08 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetError(ERR_12);</span>
<span>//&nbsp;å§‹å‹•å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>cause = U_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_START :</span>
<span>//ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼èµ·å‹•</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnOut( P_Do02 );</span>
<span>//ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼&nbsp;(START)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnTimer( TM03 );</span>
<span>//å›è»¢æ•°ä¸Šæ˜‡å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>StartInputCapture();</span>
 &nbsp;</p>
<p>&nbsp;<span>#ifdef TEST</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>StartCrankPulse();</span>
<span>//ã‚¯ãƒ©ãƒ³ã‚¯ãƒ‘ãƒ«ã‚¹å‡ºåŠ›é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>#endif</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_UP :</span>
<span>//&nbsp;å›è»¢æ•°ä¸Šæ˜‡å¾…ã¡</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if&nbsp;( nowRpm &gt;= GetCtrl( C06 ))</span>
<span>//ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼åœæ­¢å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffOut( P_Do02 );</span>
<span>//ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼&nbsp;(START)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM03 );&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//&nbsp;æ¡ä»¶å¤‰æ›´</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>StepSetting( V_FIX, GetCtrl( C01 ));</span>
<span>//é‹è»¢æ™‚ã®ã‚¹ãƒ­ãƒƒãƒˆãƒ«é–‹åº¦</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnTimer( TM10 );</span>
<span>//è‡ªå‹•åˆ¶å¾¡é–‹å§‹å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnTimer( TM11 );</span>
<span>//é›»åœ§ç¢ºç«‹æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM12 );</span>
<span>//å›è»¢ç¢ºç«‹æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM13 );</span>
<span>//æŠ•å…¥ç¢ºèªæ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>volZone = false ;</span>
<span>//é›»åœ§ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>rotZone = false ;</span>
<span>//å›è»¢æ•°ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>#ifdef TEST</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>StartDAC();</span>
<span>// DACå‡ºåŠ›é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>#endif</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_AUTO ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( ChkTimer( TM03 ) == UP )</span>
<span>//å›è»¢æ•°ä¸Šæ˜‡å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM03 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffOut( P_Do02 );</span>
<span>//ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼&nbsp;(START)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++tryCtr &lt; RETRY )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer( TM16 );</span>
<span>//å†èµ·å‹•å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>engStep = E_RESTA ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>engState = A_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>SetError(ERR_12);</span>
<span>//å§‹å‹•å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>cause = U_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>engStep = E_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_RESTA :</span>
<span>//&nbsp;å†èµ·å‹•å¾…ã¡</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer( TM16 ) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM16 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_START ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_AUTO :</span>
<span>//è‡ªå‹•åˆ¶å¾¡é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_STOP :</span>
<span>//åœæ­¢é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffOut( P_Do02 );</span>
<span>//ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼(START)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>rotZone = false ;</span>
<span>//å›è»¢æ•°ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>volZone = false ;</span>
<span>//é›»åœ§ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>StepSetting( V_FIX, 0 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnTimer( TM04 );</span>
<span>//å›è»¢æ•°ä½ä¸‹å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_SLOW :</span>
<span>//å›è»¢æ•°ä½ä¸‹å¾…ã¡</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm == 0 &amp;&amp; ChkTimer( TM04 ) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM04 );</span>
<span>//å›è»¢æ•°ä½ä¸‹å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>StopInputCapture();</span>
 &nbsp;</p>
<p>&nbsp;<span>#ifdef TEST</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>StopCrankPulse();</span>
<span>//ãƒ†ã‚¹ãƒˆç”¨ã‚¯ãƒ©ãƒ³ã‚¯ãƒ‘ãƒ«ã‚¹å‡ºåŠ›ã‚’åœæ­¢ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>StopDAC();</span>
<span>//ãƒ†ã‚¹ãƒˆç”¨DACå‡ºåŠ›ã‚’åœæ­¢ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>#endif</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_IDLE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_IDLE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>default :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_IDLE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetRunStage( int data[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>data[0] = runStage ;</span>
<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>data[1] = runSeq ;</span>
<span>//é‹è»¢ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>data[2] = loadIndex ;</span>
<span>//æŠ•å…¥è² è·</span>
 &nbsp;</p>
<p>&nbsp;<span>data[3] = engStep ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>data[4] = engState ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹</span>
 &nbsp;</p>
<p>&nbsp;<span>data[5] = reason ;</span>
<span>//èµ·å‹•ä¸å¯ç†ç”±</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>data[6] = rotZone ;</span>
<span>//å›è»¢æ•°ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>data[7] = volZone ;</span>
<span>//é›»åœ§ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>data[8] = tryCtr ;</span>
<span>//ãƒªãƒˆãƒ©ã‚¤ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>data[9] = nowRpm ;</span>
<span>//ç¾åœ¨å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>data[10] =&nbsp;restart&nbsp;;</span>
<span>//å†èµ·å‹•ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>data[11] =&nbsp;GetErrorCode()&nbsp;;</span>
<span>//ç•°å¸¸ç•ªå·</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>return 12 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetErrorCode()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void StartCrankPulse()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void StopCrankPulse()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void StartInputCapture()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void StopInputCapture()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void StartDAC()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void StopDAC()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ç¢ºç«‹æ™‚é–“ã‚„ã‚¹ãƒ­ãƒƒãƒˆãƒ«é–‹åº¦ã‚’å®šç¾©ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== common.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¿ã‚¤ãƒãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>TM03,</span>
<span>//å›è»¢æ•°ä¸Šæ˜‡å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM04,</span>
<span>//å›è»¢æ•°ä½ä¸‹å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>TM07,</span>
<span>//LCDè¡¨ç¤ºå‘¨æœŸ</span>
 &nbsp;</p>
<p>&nbsp;<span>TM08,</span>
<span>//ã‚¹ãƒ­ãƒƒãƒˆãƒ«èµ·å‹•ä½ç½®å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>TM10,</span>
<span>//è‡ªå‹•åˆ¶å¾¡é–‹å§‹å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM11,</span>
<span>//é›»åœ§ç¢ºç«‹æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM12,</span>
<span>//å›è»¢ç¢ºç«‹æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM13,</span>
<span>//æŠ•å…¥ç¢ºèªæ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM14,</span>
<span>//ç¢ºç«‹ç›£è¦–æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM15,</span>
<span>//ã‚¨ãƒ³ã‚¹ãƒˆç¢ºèªæ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM16,</span>
<span>//å†èµ·å‹•å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM17,</span>
<span>//å†èµ·å‹•ã®ä¼‘æ­¢æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM18,</span>
<span>//èµ·å‹•å¯èƒ½ãƒã‚§ãƒƒã‚¯æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM19,</span>
<span>//å›è»¢ç›£è¦–æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM20,</span>
<span>//åŸç‚¹å¾©å¸°å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//åˆ¶å¾¡å®šæ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
 &nbsp;</p>
<p>&nbsp;<span>C00,</span>
<span>//èµ·å‹•æ™‚ã®ã‚¹ãƒ­ãƒƒãƒˆãƒ«é–‹åº¦ï¼ˆãƒ‘ãƒ«ã‚¹å€¤ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>C01,</span>
<span>//é‹è»¢æ™‚ã®ã‚¹ãƒ­ãƒƒãƒˆãƒ«é–‹åº¦ï¼ˆãƒ‘ãƒ«ã‚¹å€¤ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ç¢ºç«‹æ™‚é–“ã‚’è¨­å®šã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;timer.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>const unsigned short timeBase[TMRNUM] = {</span>
<span>//100ms</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>30,</span>
<span>//TM03</span>
 &nbsp;</p>
<p>&nbsp;<span>10,</span>
<span>//TM04</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>5,</span>
<span>//TM07</span>
 &nbsp;</p>
<p>&nbsp;<span>10,</span>
<span>//TM08</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>5,</span>
<span>//TM10</span>
 &nbsp;</p>
<p>&nbsp;<span>10,</span>
<span>//TM11</span>
 &nbsp;</p>
<p>&nbsp;<span>10,</span>
<span>//TM12</span>
 &nbsp;</p>
<p>&nbsp;<span>10,</span>
<span>//TM13</span>
 &nbsp;</p>
<p>&nbsp;<span>200,</span>
<span>//TM14</span>
 &nbsp;</p>
<p>&nbsp;<span>10,</span>
<span>//TM15</span>
 &nbsp;</p>
<p>&nbsp;<span>30,</span>
<span>//TM16</span>
 &nbsp;</p>
<p>&nbsp;<span>50,</span>
<span>//TM17</span>
 &nbsp;</p>
<p>&nbsp;<span>10,</span>
<span>//TM18</span>
 &nbsp;</p>
<p>&nbsp;<span>2,</span>
<span>//TM19</span>
 &nbsp;</p>
<p>&nbsp;<span>50,</span>
<span>//TM20</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>åˆ¶å¾¡å®šæ•°ã‚’ã‚»ãƒƒãƒˆã—ã¾ã™ã€‚ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆç”¨ã®ä»®ã®å€¤ã§ã™ã€‚å®Ÿéš›ã«ã¯å®Ÿæ©Ÿã§æ¸¬å®šã—ã¦æ±ºã‚ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¾ãŸã€ã‚¿ã‚¤ãƒãƒ¼ã‚„åˆ¶å¾¡å®šæ•°ã‚’å¤‰æ›´ã—ãŸã®ã§ã€EEPROMã®ROMãƒãƒ¼ã‚¸ãƒ§ãƒ³å€¤ã‚’å¤‰æ›´ã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== ctrl.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>const short ctrlBase[CTRLNUM] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>150,</span>
<span>//C00</span>
 &nbsp;</p>
<p>&nbsp;<span>300,</span>
<span>//C01</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-18">
<span>(2) å‹•ä½œç¢ºèªï¼‘</span>
</a>
</h2>
<p>&nbsp;<span>å…ˆãšã€ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã‚’èµ·å‹•ã—ã€ã‚¨ãƒ³ã‚¸ãƒ³ãŒã‹ã‹ã‚‹ã¨ã“ã‚ã¾ã§ã‚’ç¢ºèªã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å›è»¢æ•°VRã‚’ä¸€ç•ªä¸‹ã¾ã§ä¸‹ã’ã¦ç½®ãã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã«å…¥ã‚Œã‚‹ã¨ã€ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãŒèµ·å‹•æ™‚ã®é–‹åº¦ã¾ã§é–‹ãã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãŒé–‹ãã¨ã€ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒONã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼”ï¼‰å›è»¢æ•°VRã‚’æ“ä½œã—ã¦ã„ãªã„ã®ã§ã€3ç§’ä½ã§ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã¯OFFã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼•ï¼‰ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã®ON/OFFã‚’ï¼•å›ç¹°ã‚Šè¿”ã™ã¨ã€å§‹å‹•å¤±æ•—ã¨ãªã‚Šã€åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼–ï¼‰ãã—ã¦ç‡ƒæ–™é®æ–­å¼ã¨ON-SWITCHã¯OFFã«ãªã‚Šã€ã‚¹ãƒ­ãƒƒãƒˆãƒ«ã¯é–‰ã˜ã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼—ï¼‰å§‹å‹•å¤±æ•—ã¯ã€å†èµ·å‹•ãŒå¯èƒ½ãªã®ã§ã€åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã‹ã‚‰ã€å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸ã«æˆ»ã‚Šã€è‡ªå‹•çš„ã«å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã«å…¥ã‚Šã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼˜ï¼‰ä»Šåº¦ã¯ã€ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒå›ã£ãŸã‚‰ã€å›è»¢æ•°VRã§410rpmä»¥ä¸Šã«ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼™ï¼‰ã™ã‚‹ã¨ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒOFFã«ãªã‚Šã€ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãŒã•ã‚‰ã«é‹è»¢æ™‚ã®é–‹åº¦ã¾ã§é–‹ãã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼ï¼‰OKã§ã—ãŸã‚‰ã€åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãŒé–‰ã˜ã‚‹ã®ã‚’ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‘ï¼‰å›è»¢æ•°VRã§100rpmä»¥ä¸‹ã«ã™ã‚‹ã¨ã€å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸ã«æˆ»ã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>æ¬¡ã®æ®µéšã®ã‚³ãƒ¼ãƒ‰ã‚’çµ„ã¿è¾¼ã¿ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2>
<a id="calibre_link-19">
<span>(3)&nbsp;é›»åœ§ã€å›è»¢æ•°ã®ç¢ºç«‹</span>
</a>
</h2>
<p>&nbsp;<span>é›»åœ§ã®ç¢ºç«‹ã‚’èª¿ã¹ã¦ã„ã¾ã™ãŒã€ã¾ã é›»åœ§ã¯æ¸¬å®šã—ã¦ã„ãªã„ã®ã§ã€trueã‚’è¿”ã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å›è»¢æ•°ã®ç¢ºç«‹ã¯ã€2æ®µéšã«ãªã£ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰ç›®æ¨™å›è»¢æ•°ã®+/-7%ä»¥å†…ã«ä¸€å®šã®æ™‚é–“å…¥ã£ãŸæ™‚ã‚’ã€å›è»¢æ•°ç¢ºç«‹ã¨ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ãã—ã¦å‡ºåŠ›ãŒç›®æ¨™ç¯„å›²å†…ã«åã¾ã‚‹ã‚ˆã†ã«å›è»¢æ•°åˆ¶å¾¡å€¤ã‚’å¤‰æ›´ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰å›è»¢æ•°ç¢ºç«‹å¾Œã€ç›®æ¨™å›è»¢æ•°ã®+/-2%ä»¥å†…ã«ä¸€å®šã®æ™‚é–“å…¥ã£ãŸå¾Œã«ã€è² è·ã®æŠ•å…¥ã‚’é–‹å§‹ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¾ãŸã€æ—¢å®šã®æ™‚é–“å†…ã«ã“ã‚Œã‚‰ãŒç¢ºç«‹ã—ãªã‹ã£ãŸæ™‚ã¯ã€ç¢ºç«‹å¤±æ•—ã¨ã—ã¦ã€å†èµ·å‹•ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Operation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>static short middle[2] ;</span>
<span>//R_MID1,2</span>
 &nbsp;</p>
<p>&nbsp;<span>static short center[2] ;&nbsp;</span>
<span>//R_CENT1,2</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitOperation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>int m = GetCtrl( C08 );</span>
<span>//ç›®æ¨™å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>int n = ( m * 7 ) / 100 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>middle[0] = m - n ;</span>
<span>//R_MID1</span>
 &nbsp;</p>
<p>&nbsp;<span>middle[1] = m + n ;</span>
<span>//R_MID2</span>
 &nbsp;</p>
<p>&nbsp;<span>n = ( m * 2 ) / 100 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>center[0] = m - n ;&nbsp;</span>
<span>//R_CENT1</span>
 &nbsp;</p>
<p>&nbsp;<span>center[1] = m + n ;&nbsp;</span>
<span>//R_CENT2</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>static void EngCtrl()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_AUTO :</span>
<span>//è‡ªå‹•åˆ¶å¾¡é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é‹è»¢æ™‚ã®ã‚¹ãƒ­ãƒƒãƒˆãƒ«é–‹åº¦åˆ°é”ç¢ºèª</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsGiveOff() == true &amp;&amp;&nbsp;IsMotorReady() == true &amp;&amp; ChkTimer( TM10 ) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer(&nbsp;TM10&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>FuzzyBase( C04 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>StepSetting(&nbsp;V_AUTO, 0 );//&nbsp;ã‚¹ãƒ­ãƒƒãƒˆãƒ«è‡ªå‹•åˆ¶å¾¡é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_MOST ;</span>
<span>//è‡ªå‹•åˆ¶å¾¡é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnTimer(&nbsp;TM14&nbsp;);</span>
<span>//ç¢ºç«‹ç›£è¦–æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_STABLE :</span>
<span>//ç¢ºç«‹å¾…ã¡</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer(&nbsp;TM14&nbsp;) == UP )</span>
<span>//ç¢ºç«‹ç›£è¦–æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer(&nbsp;TM14&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetError(ERR_14);</span>
<span>//ç¢ºç«‹å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engState = A_FAIL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>cause = U_FAIL;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>engStep = E_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsAutoSequence() == false )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>StepSetting( V_AUTO, 0 );//è‡ªå‹•åˆ¶å¾¡é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é›»åœ§ç¢ºç«‹ç¢ºèª</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsGeneVolt() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer(&nbsp;TM11&nbsp;) == OFF )&nbsp;</span>
<span>//é›»åœ§ç¢ºç«‹æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer(&nbsp;TM11&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( ChkTimer(&nbsp;TM11&nbsp;) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( volZone == false )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>volZone = true ;</span>
<span>//é›»åœ§ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>volZone = false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer(&nbsp;TM11&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//å›è»¢æ•°ç¢ºç«‹ç¢ºèª</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm &gt;= middle[0] &amp;&amp; nowRpm &lt;= middle[1] )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer(&nbsp;TM12&nbsp;) == OFF )</span>
<span>//å›è»¢ç¢ºç«‹æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer(&nbsp;TM12&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( ChkTimer(&nbsp;TM12&nbsp;) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( rotZone == false )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>rotZone = true ;</span>
<span>//å›è»¢æ•°ç¢ºç«‹ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>FuzzyBase( C05 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( rotZone == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>rotZone = false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>FuzzyBase( C04 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer(&nbsp;TM12&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ä¸€å®šã®æ™‚é–“ã€åŒæœŸæŠ•å…¥å›è»¢æ•°ç¯„å›²ã«å…¥ã£ã¦ã„ãŸã‚‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( volZone == true &amp;&amp; rotZone == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm &gt;= center[0] &amp;&amp; nowRpm &lt;= center[1] )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( ChkTimer(&nbsp;TM13&nbsp;) == OFF )</span>
<span>//åŒæœŸæŠ•å…¥å›è»¢ç¢ºèªæ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer(&nbsp;TM13&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>else if ( ChkTimer(&nbsp;TM13&nbsp;) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffTimer(&nbsp;TM13&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>engState = A_SUMMIT ;</span>
<span>//é‹è»¢åˆ¶å¾¡ã¯è² è·æŠ•å…¥ã«å…¥ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>engStep = E_GENE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffTimer(&nbsp;TM13&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_GENE :</span>
<span>//ç™ºé›»ä¸­</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm &lt; GetCtrl( C07&nbsp;))</span>
<span>//å›è»¢æ•°ãŒä½ä¸‹ã—ãŸ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer( TM15 ) == OFF )</span>
<span>//ã‚¨ãƒ³ã‚¹ãƒˆç¢ºèªæ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer( TM15 ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( ChkTimer( TM15 ) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffTimer( TM15 ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>SetError(ERR_13);</span>
<span>//ã‚¨ãƒ³ã‚¹ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>engState = A_FAIL ;</span>
<span>//å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>cause = U_FAIL;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>engStep = E_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM15 ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case E_STOP :</span>
<span>//åœæ­¢é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsGeneVolt()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return true;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Stepping.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>static short oldBase ;</span>
<span>//æ—§Fuzzyå‡ºåŠ›å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>static short newBase ;</span>
<span>//æ–°Fuzzyå‡ºåŠ›å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitStepping()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>oldBase = newBase = C04 ;</span>
<span>//Fuzzyå‡ºåŠ›å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>int n = GetCtrl( newBase );</span>
 &nbsp;</p>
<p>&nbsp;<span>ChangeBase( n );</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2S_MTU3S_TGIA3(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>nowRpm = GetRpm() ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( oldBase != newBase )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>oldBase = newBase ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>int n = GetCtrl( newBase );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>ChangeBase( n );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>fuzValue = Fuzzy( nowRpm, oldRpm );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void FuzzyBase( int n )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>newBase = n ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//è‡ªå‹•åˆ¶å¾¡ã«ã‚ã‚‹ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsAutoSequence()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( sequence ==&nbsp;S_AUTO)</span>
<span>//è‡ªå‹•åˆ¶å¾¡</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ•ã‚¡ã‚¸ãƒ¼è¨ˆç®—å€¤ã‚’å¤‰æ›´å‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== common.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//åˆ¶å¾¡å®šæ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>C04,</span>
<span>//Fuzzyå‡ºåŠ›å€¤A</span>
 &nbsp;</p>
<p>&nbsp;<span>C05,</span>
<span>//Fuzzyå‡ºåŠ›å€¤B</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>è©²å½“ã™ã‚‹åˆ¶å¾¡å®šæ•°ã‚’å¤‰æ›´ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¾ãŸã€åˆ¶å¾¡å®šæ•°ã‚’å¤‰æ›´ã—ãŸã®ã§ã€EEPROMã®ROMãƒãƒ¼ã‚¸ãƒ§ãƒ³å€¤ã‚’å¤‰æ›´ã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== ctrl.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>const short ctrlBase[CTRLNUM] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>60,</span>
<span>//C04</span>
 &nbsp;</p>
<p>&nbsp;<span>80,</span>
<span>//C05</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-20">
<span>(4) åœæ­¢æ¤œå‡º</span>
</a>
</h2>
<p>&nbsp;<span>å®Ÿæ©Ÿã§ã¯ã€ã‚¨ãƒ³ã‚¸ãƒ³ãŒæ­¢ã¾ã‚‹ã¨ã‚¯ãƒ©ãƒ³ã‚¯ãƒ‘ãƒ«ã‚¹ãŒå…¥ã‚‰ãšã€ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£ãŒå‘¼ã³å‡ºã•ã‚Œãªã„ã®ã§ã€ã‚¿ã‚¤ãƒãƒ¼ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ä¸‹å›³ã®ã‚ˆã†ã«ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ãŸæ¬¡ã®ãƒ‡ãƒ¼ã‚¿ã¯æ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼ã—ãŸå€¤ã¯å°‘ãªã„ãŸã‚é«˜é€Ÿã¨è¨ˆç®—ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¤ã¾ã‚Šã€ä½å›è»¢ã§å›ã£ã¦ã„ã‚‹å ´åˆã€æ™‚ã€…ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ã€ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å€¤ã¯æ­£ã—ã„ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚ã§ã™ã‹ã‚‰ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ãªã—ã§1å›è»¢ã—ã¦ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã§è¨ˆç®—ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000005.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£ã‚¿ã‚¤ãƒãƒ¼ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’æ¤œå‡ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== hwsetup.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//Interrupt priority</span>
 &nbsp;</p>
<p>&nbsp;<span>INTC.IPR10.BIT._MTU22C = 14 ;</span>
<span>//MTU22.TIER.BIT.TCIEV ãƒ†ã‚¹ãƒˆç”¨ã‚¯ãƒ©ãƒ³ã‚¯ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚µãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒãƒ«ãƒãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>//MTU2 ãƒãƒ£ãƒãƒ«2ã‚’ãƒ†ã‚¹ãƒˆç”¨ã‚¯ãƒ©ãƒ³ã‚¯ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚µãƒ¼ã«ä½¿ç”¨ PE6/TIOC2A</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU22.TIER.BIT.TGIEA = 1 ;</span>
<span>//1ï¼šTGFAãƒ“ãƒƒãƒˆã«ã‚ˆã‚‹å‰²ã‚Šè¾¼ã¿è¦æ±‚ï¼ˆTGIAï¼‰ã‚’è¨±å¯</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU22.TIER.BIT.TCIEV = 1 ;</span>
<span>//1ï¼šTCFVãƒ“ãƒƒãƒˆã«ã‚ˆã‚‹å‰²ã‚Šè¾¼ã¿è¦æ±‚ï¼ˆTGIVï¼‰ã‚’è¨±å¯</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>é–¢æ•°å†…ã‚’ä¸€éƒ¨å¤‰æ›´ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Rotation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// 172 MTU2 MTU2 TGIA2</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2_MTU2_TGIA2(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( MTU22.TSR.BIT.TGFA )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU22.TSR.BIT.TGFA = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( newCtr &lt; 36 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>newCtr++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU22.TCNT = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>newCount = MTU22.TGRA ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//æ¬ æ­¯ã‚’åˆ¤å®šã™ã‚‹ï¼å‰å›ã®å€¤ã®ï¼“å€è¿‘ã„ï¼ï¼’å€ã‚’è¶Šãˆã¦ã„ã‚‹ãªã‚‰æ¬ æ­¯</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if (( ctrBuf[0] &gt; 0 ) &amp;&amp; ( newCount &gt;= ( ctrBuf[1] + ctrBuf[2] )))</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; delete &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>if ( newCtr &lt; 36 )</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>newCtr++;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//84msã§overflowã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>// 176 MTU2 MTU2 TCIV2</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2_MTU2_TCIV2(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( MTU22.TSR.BIT.TCFV )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU22.TSR.BIT.TCFV = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>newCtr = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¾ãŸã€åœæ­¢ã—ã¦ã‚‚å›è»¢æ•°ã®æ•°å€¤ãŒæ®‹ã£ãŸã¾ã¾ã«ãªã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã‚Œã‚’é¿ã‘ã‚‹ãŸã‚ã«ã€ã‚¨ãƒ³ã‚¸ãƒ³ã®å›è»¢ã‚’ç›£è¦–ã™ã‚‹é–¢æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Operation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void Operation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>EngCtrl();</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡éƒ¨</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>WatchRotation();</span>
<span>//å›è»¢ç›£è¦–</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å›è»¢æ•°æ¤œå‡ºéƒ¨ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Rotation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>#define HIGHCTR</span>
<span>650</span>
<span>//newCount &lt;= HIGHCTRã§é«˜é€Ÿã¨åˆ¤æ–­ 2000rpm</span>
 &nbsp;</p>
<p>&nbsp;<span>#define LOWCTR</span>
<span>10000</span>
<span>//newCount &gt;= LOWCTRã§åœæ­¢ã¨åˆ¤æ–­ 130rpm</span>
 &nbsp;</p>
<p>&nbsp;<span>#define MAXSURE</span>
<span>5</span>
 &nbsp;</p>
<p>&nbsp;<span>static short sure ;</span>
<span>//åœæ­¢åˆ¤æ–­ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>static unsigned short oldPtr ;</span>
<span>//ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ç¢ºèªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitRotate()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>rpmPtr = oldPtr = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>sure = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>MTU2.TSTR.BIT.CST2 = 1 ;</span>
<span>//MTU2ãƒãƒ£ãƒãƒ«2ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>MTU2.TSTR.BIT.CST4 = 1 ;</span>
<span>//MTU2ãƒãƒ£ãƒãƒ«ï¼”ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//200msæ¯ã«å›è»¢ã‚’ç›£è¦–ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>void WatchRotation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( ChkTimer(&nbsp;TM19&nbsp;) == OFF )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnTimer(TM19);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( ChkTimer(&nbsp;TM19&nbsp;) == ON )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return ;</span>
 &nbsp;</p>
<p>&nbsp;<span>OnTimer(TM19);</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( rpmPtr == oldPtr )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( sure &gt;= MAXSURE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>InitRotate();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sure = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sure++;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>oldPtr = rpmPtr ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( newCount &lt;&nbsp; HIGHCTR )</span>
<span>//2000rpm</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetError( ERR_7&nbsp;);</span>
<span>//é«˜å›è»¢</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sure = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ä»Šã¾ã§ç©ºã ã£ãŸé–¢æ•°ã®ä¸€éƒ¨ã‚’ã“ã“ã§è£œã„ã¾ã™ã€‚ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®è©²å½“ã™ã‚‹ç©ºã®é–¢æ•°ã®å‰Šé™¤ã‚’å¿˜ã‚Œãªã„ã§ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Rotation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¯ãƒ©ãƒ³ã‚¯ãƒ‘ãƒ«ã‚¹å‡ºåŠ›ã‚’é–‹å§‹ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>void StartCrankPulse()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>crankOut = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU2.TSTR.BIT.CST4 = 1 ;</span>
<span>//ãƒ†ã‚¹ãƒˆç”¨ã‚¯ãƒ©ãƒ³ã‚¯ãƒ‘ãƒ«ã‚¹å‡ºåŠ›ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¯ãƒ©ãƒ³ã‚¯ãƒ‘ãƒ«ã‚¹å‡ºåŠ›ã‚’åœæ­¢ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>void StopCrankPulse()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU2.TSTR.BIT.CST4 = 0 ;</span>
<span>//ãƒ†ã‚¹ãƒˆç”¨ã‚¯ãƒ©ãƒ³ã‚¯ãƒ‘ãƒ«ã‚¹å‡ºåŠ›ã‚¿ã‚¤ãƒãƒ¼åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>newCount =&nbsp; NUMERATOR2;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void StartInputCapture()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU2.TSTR.BIT.CST2 = 1 ;</span>
<span>//MTU2ãƒãƒ£ãƒãƒ«2 ãƒ†ã‚¹ãƒˆç”¨ã‚¯ãƒ©ãƒ³ã‚¯ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚µãƒ¼ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void StopInputCapture()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU2.TSTR.BIT.CST2 = 0 ;</span>
<span>//MTU2ãƒãƒ£ãƒãƒ«2 ãƒ†ã‚¹ãƒˆç”¨ã‚¯ãƒ©ãƒ³ã‚¯ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚µãƒ¼ã‚¿ã‚¤ãƒãƒ¼åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-21">
<span>(5) å‹•ä½œç¢ºèªï¼’</span>
</a>
</h2>
<p>&nbsp;<span>ã§ã¯ã€ã“ã“ã¾ã§ã®å‹•ä½œã‚’èª¿ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å›è»¢æ•°ã‚’0rpmã«ã—ã¦ã€ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒå›ã£ãŸã‚‰ã€å›è»¢æ•°ã‚’1000rpmç¨‹åº¦ã«ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰ã“ã®çŠ¶æ…‹ã§ã€é›»åœ§ç¢ºç«‹ãƒ•ãƒ©ã‚°ã¯ï¼‘ã§ã€å›è»¢æ•°ç¢ºç«‹ãƒ•ãƒ©ã‚°ã¯ï¼ã«ãªã£ã¦ã„ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰ã¾ãŸã€ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹ãƒ•ãƒ©ã‚°ã¯ï¼‘ã«ãªã£ã¦ã„ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼”ï¼‰å›è»¢æ•°ã‚’å¾ã€…ã«ä¸Šã’ã¦ã€1400rpmã‚’è¶Šãˆã‚‹ã¨å›è»¢æ•°ç¢ºç«‹ãƒ•ãƒ©ã‚°ã¯ï¼‘ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼•ï¼‰ã•ã‚‰ã«å›è»¢æ•°ã‚’ä¸Šã’ã¦ã€1470rpmã‚’è¶Šãˆã‚‹ã¨ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹ãƒ•ãƒ©ã‚°ã¯ï¼’ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼–ï¼‰ãã—ã¦ã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒé‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»ã‚Šã€è² è·æŠ•å…¥ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼—ï¼‰ã“ã®çŠ¶æ…‹ã‹ã‚‰å›è»¢æ•°ã‚’1100rpmã‚ˆã‚Šä¸‹ã’ã‚‹ã¨ã€ã‚¨ãƒ³ã‚¹ãƒˆã«ãªã‚Šã€ã‚¹ãƒ­ãƒƒãƒˆãƒ«ã¯é–‰ã˜ã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼˜ï¼‰åœæ­¢ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«ç§»ã‚Šã€å›è»¢æ•°ã‚’100rpmä»¥ä¸‹ã«ã™ã‚‹ã¨ã€è² è·ã®åˆ‡æ–­ãŒè¡Œã‚ã‚Œã€å¾…æ©ŸçŠ¶æ…‹ã«æˆ»ã‚Šã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>OKã§ã—ãŸã‚‰ã€æ¬¡ã¯å®Ÿç”¨åŒ–ã«å‘ã‘ã¦ã€å¿…é ˆã®ç•°å¸¸å‡¦ç†éƒ¨ã‚’è¿½åŠ ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-22">
<span>[7]&nbsp;ç•°å¸¸å‡¦ç†</span>
</a>
</h1>
<p>&nbsp;<span>ã•ã¦ã€å®Ÿéš›ã«æ©Ÿæ¢°ãŒå‹•ä½œã™ã‚‹æ®µéšã«å…¥ã‚Šã¾ã™ã®ã§ã€ç•°å¸¸ã‚’æ¤œçŸ¥ã—ã¦åœæ­¢ã™ã‚‹æ©Ÿèƒ½ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ç•°å¸¸ã‚’æ‰±ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–°è¦ã«ä½œæˆã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-23">
<span>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </span>
</a>
</h2>
<p>&nbsp;<span>=====&nbsp;Error.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; FILE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Error.cpp</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; DESCRIPTION : Error Check</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; CPU TYPE&nbsp;&nbsp;&nbsp; : SH7286</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; DATE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Nov 01, 2016</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; VERSION ï¼š1.0&nbsp;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•</span>
 &nbsp;</p>
<p>&nbsp;<span>#include &lt;string.h&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>#include &lt;stdlib.h&gt;</span>
<span>//abs</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "iodefine.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>extern "C" {</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "vect.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "common.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "proto.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>static short errCode ;</span>
<span>//ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰</span>
 &nbsp;</p>
<p>&nbsp;<span>static int errBit ;</span>
<span>//ã‚¨ãƒ©ãƒ¼ãƒ“ãƒƒãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ©ãƒ¼ãƒ“ãƒƒãƒˆ Hex&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//01 ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>//02 ã‚¹ãƒ­ãƒƒãƒˆãƒ«ä½ç½®ç¯„å›²å¤–</span>
 &nbsp;</p>
<p>&nbsp;<span>//04å†èµ·å‹•å¤±æ•—ï¼å†èµ·å‹•3å›ã§ã‚‚æ­£å¸¸ã«ãªã‚‰ãªã„</span>
 &nbsp;</p>
<p>&nbsp;<span>//08 åŸç‚¹å¾©å¸°å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>//10 ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ã‚¿ãƒ¼ç•°å¸¸</span>
 &nbsp;</p>
<p>&nbsp;<span>//20 ã‚µãƒ¼ãƒãƒ«ãƒˆãƒªãƒƒãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>//40é«˜å›è»¢</span>
 &nbsp;</p>
<p>&nbsp;<span>//80 æ²¹åœ§ã‚¹ã‚¤ãƒƒãƒä½œå‹•</span>
 &nbsp;</p>
<p>&nbsp;<span>//100 å†·å´æ°´é«˜æ¸©</span>
 &nbsp;</p>
<p>&nbsp;<span>//200å‘¨æ³¢æ•°ç¯„å›²å¤–</span>
 &nbsp;</p>
<p>&nbsp;<span>//400ç™ºé›»é›»åœ§ç¯„å›²å¤–</span>
 &nbsp;</p>
<p>&nbsp;<span>//800 èµ·å‹•å¤±æ•—ï¼ï¼è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ã§ã¯ãªã„ å†èµ·å‹•å¯èƒ½</span>
 &nbsp;</p>
<p>&nbsp;<span>//1000 ã‚¨ãƒ³ã‚¹ãƒˆï¼ï¼è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ã§ã¯ãªã„ å†èµ·å‹•å¯èƒ½</span>
 &nbsp;</p>
<p>&nbsp;<span>//2000 ç¢ºç«‹å¤±æ•— ï¼ï¼è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ã§ã¯ãªã„ å†èµ·å‹•å¯èƒ½</span>
 &nbsp;</p>
<p>&nbsp;<span>//4000 å†·å´æ°´ãƒ¬ãƒ™ãƒ«</span>
 &nbsp;</p>
<p>&nbsp;<span>//8000&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>#define MSGSIZE</span>
<span>16</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char *error[MSGSIZE] ={</span>
 &nbsp;</p>
<p>&nbsp;<span>"01:Emergency stop",</span>
 &nbsp;</p>
<p>&nbsp;<span>"02:Throttle range",</span>
 &nbsp;</p>
<p>&nbsp;<span>"04:Fail to&nbsp;restart",</span>
 &nbsp;</p>
<p>&nbsp;<span>"08:Fail to return",</span>
 &nbsp;</p>
<p>&nbsp;<span>"10:Step Motor Fail",</span>
 &nbsp;</p>
<p>&nbsp;<span>"20:Thermal trip",</span>
 &nbsp;</p>
<p>&nbsp;<span>"40:High rotation",</span>
 &nbsp;</p>
<p>&nbsp;<span>"80:Oil pressure",</span>
 &nbsp;</p>
<p>&nbsp;<span>"100:Water temp",</span>
 &nbsp;</p>
<p>&nbsp;<span>"200:Frequency range",</span>
 &nbsp;</p>
<p>&nbsp;<span>"400:Voltage range",</span>
 &nbsp;</p>
<p>&nbsp;<span>"800:Fail to start up",</span>
 &nbsp;</p>
<p>&nbsp;<span>"1000:Engine stall",</span>
 &nbsp;</p>
<p>&nbsp;<span>"2000:Fail establish",</span>
 &nbsp;</p>
<p>&nbsp;<span>"4000:Water level",</span>
 &nbsp;</p>
<p>&nbsp;<span>"8000:",</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>//å†èµ·å‹•</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
 &nbsp;</p>
<p>&nbsp;<span>T_StartUp,</span>
<span>//èµ·å‹•å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>T_EngStop,</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³ã‚¹ãƒˆãƒƒãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>T_Unstable,</span>
<span>//é›»åœ§ã€å›è»¢ä¸ç¢ºç«‹</span>
 &nbsp;</p>
<p>&nbsp;<span>T_NotFix,</span>
<span>//äºˆå‚™</span>
 &nbsp;</p>
<p>&nbsp;<span>TRYNUM</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>#define SERIOUS</span>
<span>0x07FF</span>
 &nbsp;</p>
<p>&nbsp;<span>#define BOOTABLE</span>
<span>0xF800</span>
 &nbsp;</p>
<p>&nbsp;<span>static unsigned short tryCtr[TRYNUM];</span>
<span>//å†èµ·å‹•ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// ---------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private function</span>
 &nbsp;</p>
<p>&nbsp;<span>// ---------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>static void SetErrBit( int errCode );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//--------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>// Functions</span>
 &nbsp;</p>
<p>&nbsp;<span>//--------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitError()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>errCode = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>errBit = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; TRYNUM ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>tryCtr[n] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç·Šæ€¥ã«åœæ­¢ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsEmergency()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsEmStop() == true )</span>
<span>// 3 ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetError( ERR_1 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (( errBit &amp; SERIOUS ) != 0 )</span>
<span>//é‡å¤§ã‚¨ãƒ©ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç•°å¸¸ãƒã‚§ãƒƒã‚¯</span>
 &nbsp;</p>
<p>&nbsp;<span>void ErrorCheck()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsRunning() == true )&nbsp;</span>
<span>//é‹è»¢ä¸­ã«</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( GetStage() == M_RUN )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’ç›£è¦–ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int val = GetAdcVal(P_Ai02);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int max = GetCtrl( C03 );</span>
<span>//ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãƒã‚¸ã‚·ãƒ§ãƒ³æœ€å¤§å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( val &gt; max )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>SetError( ERR_2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int min = GetCtrl( C02 );</span>
<span>//ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãƒã‚¸ã‚·ãƒ§ãƒ³æœ€å°å€¤ï¼ˆADå€¤ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( val &lt; min )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>SetError( ERR_2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ã‚µãƒ¼ãƒãƒ«ãƒˆãƒªãƒƒãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkInp( P_Di07 ) == ON )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetError( ERR_6 );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//è² è·æŠ•å…¥å¾Œ</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsNormalRun() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int range = GetCtrl( C12 ) * 10;</span>
<span>//å‘¨æ³¢æ•°è¨±å®¹å€¤&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int val = GetHelz();</span>
<span>//0.1Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( abs( val - 500 ) &gt; range )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer( TM24 ) == OFF )</span>
<span>//å‘¨æ³¢æ•°ç›£è¦–æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer( TM24 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( ChkTimer( TM24 ) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>SetError( ERR_10 );</span>
<span>//å‘¨æ³¢æ•°ç¯„å›²å¤–</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM24 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>range = GetCtrl( C13 ) * 10;</span>
<span>//ç™ºé›»é›»åœ§è¨±å®¹å€¤ 0.1V&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int volt = GetCtrl( C14 ) * 10 ;</span>
<span>//ä¸­å¿ƒé›»åœ§ 0.1V</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = GetVoltage();</span>
<span>//0.1V</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( abs( val - volt ) &gt; range )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer( TM25 ) == OFF )</span>
<span>//ç™ºé›»é›»åœ§ç›£è¦–æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnTimer( TM25 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( ChkTimer( TM25 ) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>SetError( ERR_11 );</span>
<span>//ç™ºé›»é›»åœ§ç¯„å›²å¤–</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM25 );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM24 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer( TM25 );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>/*</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( ChkInp( P_Di05 ) == ON )</span>
<span>// æ²¹åœ§ã‚¹ã‚¤ãƒƒãƒ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetError( ERR_8 );</span>
 &nbsp;</p>
<p>&nbsp;<span>*/</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( ChkInp( P_Di08 ) == ON )</span>
<span>// å†·å´æ°´ãƒ¬ãƒ™ãƒ«</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetError( ERR_15 );</span>
 &nbsp;</p>
<p>&nbsp;<span>/*</span>
 &nbsp;</p>
<p>&nbsp;<span>val = GetAdcVal(P_Ai03);</span>
<span>//å†·å´æ°´æ¸©</span>
 &nbsp;</p>
<p>&nbsp;<span>max = GetCtrl( C10 );</span>
<span>//å†·å´æ°´æ¸©ç•°å¸¸å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( val &gt; max )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetError( ERR_9 );</span>
 &nbsp;</p>
<p>&nbsp;<span>*/</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( ChkInp( P_Di04 ) == OFF )</span>
<span>// 4 è‡ªå‹•=OFFï¼æ‰‹å‹•=ON</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if (( errBit &amp; SERIOUS ) != 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkOut( P_Do03 ) == OFF )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnOut( P_Do03 );</span>
<span>//ç•°å¸¸ãƒ©ãƒ³ãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkOut( P_Do03 ) == ON )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffOut( P_Do03 );</span>
<span>//ç•°å¸¸ãƒ©ãƒ³ãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ©ãƒ¼ã®é‡å¤§ã•</span>
 &nbsp;</p>
<p>&nbsp;<span>int Severity()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if (( errBit &amp; SERIOUS ) != 0 )</span>
<span>//é‡å¤§ã‚¨ãƒ©ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return HIGH_ERR;</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (( errBit &amp; BOOTABLE ) != 0 )</span>
<span>//å†èµ·å‹•å¯èƒ½ã‚¨ãƒ©ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return LOW_ERR;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return NONE_ERR;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetErrorCode()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return errCode ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ©ãƒ¼ãƒ“ãƒƒãƒˆã‚’è¿”ã™</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetErrorBit( int val[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = errBit ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ©ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>void ResetError()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>InitError();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ãƒ“ãƒƒãƒˆã‚’ã‚»ãƒƒãƒˆã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>static void SetErrBit( int code )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( code &gt; 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>unsigned int mask = 0x0001 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>mask &lt;&lt;= ( code - 1 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if (( errBit &amp; mask ) == 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>errBit |= mask ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//å†èµ·å‹•ã‚¨ãƒ©ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç•°å¸¸æ¤œå‡ºå›æ•°ã«é”ã—ãŸæ™‚ã¯trueã‚’è¿”ã™</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool ChkRetryErr( int code )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int index = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( code ){</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_12 :</span>
<span>//èµ·å‹•å¤±æ•—ï¼ˆå†èµ·å‹•ã‚¨ãƒ©ãƒ¼ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>index = T_StartUp ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_13 :</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³ã‚¹ãƒˆãƒƒãƒ—ï¼ˆå†èµ·å‹•ã‚¨ãƒ©ãƒ¼ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>index = T_EngStop ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_14 :</span>
<span>//ç¢ºç«‹å¤±æ•—ï¼ˆå†èµ·å‹•ã‚¨ãƒ©ãƒ¼ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>index = T_Unstable ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_16 :</span>
<span>//äºˆå‚™ï¼ˆå†èµ·å‹•ã‚¨ãƒ©ãƒ¼ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>index = T_NotFix ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>default :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned int mask = 0x0001 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( code &gt; 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>mask &lt;&lt;= ( code - 1 );</span>
 &nbsp;</p>
<p>&nbsp;<span>int noMore = GetCtrl( C09 );</span>
<span>//å†èµ·å‹•ç•°å¸¸æ¤œå‡ºå›æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>tryCtr[index] += 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( tryCtr[index] &gt;= noMore )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ã‚»ãƒƒãƒˆã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>void SetError( int code )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>errCode = code ;</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( code ){</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_1 :</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_2 :</span>
<span>//ã‚¹ãƒ­ãƒƒãƒˆãƒ«ä½ç½®é€¸è„±</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_3 :</span>
<span>//å†èµ·å‹•å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_4 :</span>
<span>//åŸç‚¹å¾©å¸°å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_5 :</span>
<span>//ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ã‚¿ãƒ¼ç•°å¸¸</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_6 :</span>
<span>//ã‚µãƒ¼ãƒãƒ«ãƒˆãƒªãƒƒãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_7 :</span>
<span>//é«˜å›è»¢</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_8 :</span>
<span>//æ²¹åœ§ã‚¹ã‚¤ãƒƒãƒä½œå‹•</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_9 :</span>
<span>//å†·å´æ°´é«˜æ¸©</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_10 :</span>
<span>//å‘¨æ³¢æ•°ç¯„å›²å¤–</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_11 :</span>
<span>//ç™ºé›»é›»åœ§ç¯„å›²å¤–</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_15 :</span>
<span>//å†·å´æ°´ãƒ¬ãƒ™ãƒ«&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetErrBit( code );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_12 :</span>
<span>//èµ·å‹•å¤±æ•—ï¼ˆå†èµ·å‹•ã‚¨ãƒ©ãƒ¼ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_13 :</span>
<span>//ã‚¨ãƒ³ã‚¹ãƒˆï¼ˆå†èµ·å‹•ã‚¨ãƒ©ãƒ¼ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_14 :</span>
<span>//ç¢ºç«‹å¤±æ•—ï¼ˆå†èµ·å‹•ã‚¨ãƒ©ãƒ¼ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>case ERR_16 :</span>
<span>//äºˆå‚™ï¼ˆå†èµ·å‹•ã‚¨ãƒ©ãƒ¼ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetErrBit( code );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkRetryErr( code ) == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetErrBit( ERR_3&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== common.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¿ã‚¤ãƒãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>TM24,</span>
<span>//å‘¨æ³¢æ•°ç›£è¦–æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>TM25,</span>
<span>//ç™ºé›»é›»åœ§ç›£è¦–æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>//åˆ¶å¾¡å®šæ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>C03,</span>
<span>//ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãƒã‚¸ã‚·ãƒ§ãƒ³æœ€å¤§å€¤ï¼ˆADå€¤ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>C09,</span>
<span>//å†èµ·å‹•ç•°å¸¸æ¤œå‡ºå›æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>C10,</span>
<span>//å†·å´æ°´æ¸©ç•°å¸¸å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>C11,</span>
<span>//å¯å‹•ç¯„å›²ã®æœ€å¤§ãƒ‘ãƒ«ã‚¹æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>C12,</span>
<span>//å‘¨æ³¢æ•°è¨±å®¹å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>C13,</span>
<span>//ç™ºé›»é›»åœ§è¨±å®¹å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>C14,</span>
<span>//ä¸­å¿ƒé›»åœ§</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== timer.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>const unsigned short timeBase[TMRNUM] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>30,</span>
<span>//TM24</span>
 &nbsp;</p>
<p>&nbsp;<span>30,</span>
<span>//TM25</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== cntl.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>const short ctrlBase[CTRLNUM] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>1300,</span>
<span>//C03</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>3,</span>
<span>//C09&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>1000,</span>
<span>//C10</span>
 &nbsp;</p>
<p>&nbsp;<span>1000,</span>
<span>//C11</span>
 &nbsp;</p>
<p>&nbsp;<span>5,</span>
<span>//C12</span>
 &nbsp;</p>
<p>&nbsp;<span>20,</span>
<span>//C13</span>
 &nbsp;</p>
<p>&nbsp;<span>230,</span>
<span>//C14</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Main.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void main(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>InitError();</span>
 &nbsp;</p>
<p>&nbsp;<span>set_imask(0);</span>
<span>//å‰²ã‚Šè¾¼ã¿ãƒã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«å¤‰æ›´</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Operation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void Operation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>ErrorCheck();</span>
 &nbsp;</p>
<p>&nbsp;<span>nowRpm = GetRpm() ;</span>
<span>//å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//é‹è»¢ä¸­(TRUE)ã‹å¦(FALSE)ã‹</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsRunning()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( runStage &gt;= M_START &amp;&amp; runStage &lt;= M_RUN )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetStage()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return runStage ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsNormalRun()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( runStage == M_RUN &amp;&amp; runSeq == R_RUNNING )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ä¸‹è¨˜ã®ãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ã¯ç¬¬4å·»ã§å¼ã‚’è¨­å®šã—ã¾ã™ãŒã€ã“ã“ã§ã¯ä¸€æ™‚çš„ã«å€¤ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetVoltage()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return 2300; //0.1V</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetCurrent()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return 600;&nbsp;</span>
<span>//0.1A</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetHelz()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return 500;&nbsp;</span>
<span>//0.1Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚¨ãƒ©ãƒ¼ãƒ“ãƒƒãƒˆæƒ…å ±ã¨ã€ã‚¨ãƒ©ãƒ¼ã®å†…å®¹ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Display.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void DispLCD()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( nowPage ){</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case D_ErrInfo :</span>
<span>//Error information</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DispFunc( GetErrInfo,&nbsp; GetInfoMsg );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>LCDç”»é¢ã«è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Error.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char&nbsp;scErrInfo[][21] = {</span>
<span>//ç•°å¸¸æƒ…å ±</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Error&nbsp; 00&nbsp;&nbsp;&nbsp; 0000&nbsp;&nbsp; "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Try&nbsp; 00 00&nbsp;00 00&nbsp;&nbsp;&nbsp; "}};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetErrInfo(int val[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = errCode ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[1] = errBit ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; TRYNUM ; n++ )</span>
<span>//TRYNUM=4</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val[n+2] = tryCtr[n] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int n1 = TRYNUM + 2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int data[2];</span>
 &nbsp;</p>
<p>&nbsp;<span>int n2 = GetOffset( data );</span>
<span>//Record offset</span>
 &nbsp;</p>
<p>&nbsp;<span>val[n1] = data[0];</span>
 &nbsp;</p>
<p>&nbsp;<span>val[n1+1] = data[1];</span>
 &nbsp;</p>
<p>&nbsp;<span>return n1 + n2 ;</span>
<span>//=8</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetInfoMsg( int val[], char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[42], temp[8] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>//1st line</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( line, scErrInfo[0], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoa2( val[0], temp );</span>
<span>//Error code</span>
 &nbsp;</p>
<p>&nbsp;<span>adjust( temp, 2, ' ' );</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[7], temp, 2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh4( val[1], temp );</span>
<span>//Error bits</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[13], temp, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>//2nd line</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( line, scErrInfo[1], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 4 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n+2], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 2, ' ' );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[5+n*3], temp, 2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>//Record offset</span>
 &nbsp;</p>
<p>&nbsp;<span>GetOffsetMsg( &amp;val[6], line );</span>
<span>//Two rows of data</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<span>&nbsp;</span>
<a id="calibre_link-24">
<span>(2) å‹•ä½œç¢ºèª</span>
</a>
</h2>
<p>&nbsp;<span>ã§ã¯ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã‚’ç„¡é§„ã«å‹•ä½œã•ã›ãªã„ãŸã‚ã«ã€ã“ã“ã§å†èµ·å‹•ã®å‹•ä½œã‚’ã—ã£ã‹ã‚Šç¢ºèªã—ã¦ãŠãã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å›è»¢æ•°VRã‚’0rpmã«ã—ã¦ã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰å§‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒON/OFFã‚’ãƒªãƒˆãƒ©ã‚¤å›æ•°ç¹°ã‚Šè¿”ã—ã€èµ·å‹•å¤±æ•—ã§åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç§»ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã‹ã‚‰ã€å¾…æ©Ÿã«ç§»ã‚Šã€å†ã³ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒèµ·å‹•ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼”ï¼‰ã“ã‚Œã‚’å†èµ·å‹•å›æ•°ç¹°ã‚Šè¿”ã—ãŸã‚‰ã€å†èµ·å‹•ç•°å¸¸ã§åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼•ï¼‰ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚‚ã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã•ãªã„é™ã‚Šã€èµ·å‹•ã¯ã—ã¾ã›ã‚“ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼–ï¼‰ã§ã¯å†ã³ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒON/OFFã—ã€èµ·å‹•ã‚’è©¦ã¿ã¦ã„ã‚‹æ™‚ã«åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼—ï¼‰å¾…æ©Ÿã‚¹ãƒ†ãƒ¼ã‚¸ã«æˆ»ã£ã¦ã‹ã‚‰ã€è‡ªå‹•çš„ã«å†èµ·å‹•ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>OKã§ã—ãŸã‚‰ã€æ¬¡ã¯ç¢ºç«‹æ®µéšã®å†èµ·å‹•ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼˜ï¼‰ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã€ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒONã—ãŸã‚‰ã€å›è»¢æ•°ã‚’400rpmä»¥ä¸Šã«ã™ã‚‹ã¨</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒOFFã«ãªã‚Šã¾ã™ã€‚ãã‚Œã‹ã‚‰å›è»¢æ•°ã‚’1200rpmä½ã«ä¸Šã’ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼™ï¼‰ã‚¹ãƒ­ãƒƒãƒˆãƒ«ã®è‡ªå‹•åˆ¶å¾¡ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸãŒã€ã‚¹ãƒ­ãƒƒãƒˆãƒ«ã‚’ã‚‚ã£ã¨é–‹ã„ã¦ã‚‚ç›®æ¨™å›è»¢æ•°ã«é”ã—ãªã„ã®ã§ã€ã‚„ãŒã¦åˆ¶é™é–‹åº¦ã«é”ã—ã€ã‚¹ãƒ­ãƒƒãƒˆãƒ«ä½ç½®ã®ç•°å¸¸ã§åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼ï¼‰å†ã³èµ·å‹•ã—ã¦ã€ä»Šåº¦ã¯å›è»¢æ•°ã‚’1450rpmã«ã™ã‚‹ã¨ã€å›è»¢æ•°ç¢ºç«‹ã«ã¯ãªã‚Šã¾ã™ãŒã€è² è·ã®æŠ•å…¥ã«ã¯å›è»¢æ•°ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã¾ã¾ç¢ºç«‹ç›£è¦–æ™‚é–“åˆ‡ã‚Œã«ãªã‚‹ã¨ã€ç¢ºç«‹å¤±æ•—ã«ãªã‚Šåœæ­¢ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‘ï¼‰ã“ã‚Œã‚’å†èµ·å‹•å›æ•°ç¹°ã‚Šè¿”ã—ãŸã‚‰ã€å†èµ·å‹•ç•°å¸¸ã§åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼’ï¼‰ã“ã®å ´åˆã‚‚ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã•ãªã„é™ã‚Šã€èµ·å‹•ã¯ã—ã¾ã›ã‚“ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼“ï¼‰ã§ã¯ã€å†ã³èµ·å‹•ã—ã¦ã€é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã«é€²ã‚ã€å›è»¢æ•°ã‚’å¾ã€…ã«ä¸Šã’2000rpmã‚’è¶Šãˆã‚‹ã¨ã€é«˜å›è»¢ç•°å¸¸ã§åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼”ï¼‰é‹è»¢ä¸­ã«ã‚µãƒ¼ãƒãƒ«ãƒˆãƒªãƒƒãƒ—ã‚’å‹•ä½œã•ã›ã‚‹ã¨ã€ç·Šæ€¥åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã•ã‚‰ã«ã€ä¸æ¸¬ã®äº‹æ…‹ã«å‚™ãˆã‚‹ãŸã‚ã«ã€ç¨®ã€…ã®æƒ³å®šã§è©¦é¨“ã‚’è¡Œã£ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-25">
<span>[8]&nbsp;é‹è»¢è¨˜éŒ²</span>
</a>
</h1>
<p>&nbsp;<span>é‹è»¢ã®é–‹å§‹ã‚„åœæ­¢æ™‚åˆ»ã€ç•°å¸¸ã®ç™ºç”Ÿç†ç”±ã¨ãã®æ™‚ã®çŠ¶æ…‹ã‚’EEPROMã«è¨˜éŒ²ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ã¯ä¸€æ™‚çš„ã«è¨˜æ†¶ã—ã¦ã€EEPROMã¸ã®æ›¸ãè¾¼ã¿ã¯ã€å¤šé‡ã®å‰²ã‚Šè¾¼ã¿ãŒç™ºç”Ÿã—ã¦ã„ãªã„æ™‚ã«è¡Œã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å›³ç¤ºã™ã‚‹ã¨ã€ä¸‹å›³ã®ã€ŒSã€ãŒä¸€æ™‚è¨˜æ†¶ã§ã€ã€ŒEã€EEPROMã¸ã®æ›¸ãè¾¼ã¿ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000007.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ä¸Šå›³ã«å¾“ã£ã¦ã€ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<a id="calibre_link-26">
<span>(1)&nbsp;ãƒ—ãƒ­ã‚°ãƒ©ãƒ </span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>ä¸€æ™‚çš„ã«è¨˜æ†¶ã™ã‚‹å ´æ‰€ã‚’è¨­å®šã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Operation.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>#define RECBUFSZ</span>
<span>3</span>
 &nbsp;</p>
<p>&nbsp;<span>static RECORD runRecord[RECBUFSZ] ;</span>
<span>//é‹è»¢è¨˜éŒ²ä¸€æ™‚ãƒãƒƒãƒ•ã‚¡</span>
 &nbsp;</p>
<p>&nbsp;<span>#define B_START</span>
<span>0x0100</span>
 &nbsp;</p>
<p>&nbsp;<span>#define B_STOP</span>
<span>0x0200</span>
 &nbsp;</p>
<p>&nbsp;<span>#define B_ERROR</span>
<span>0x0400</span>
 &nbsp;</p>
<p>&nbsp;<span>#define B_EMSTOP</span>
<span>0x0800</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private function</span>
 &nbsp;</p>
<p>&nbsp;<span>static void ClearRunRecord(void);</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool SetRecordEEPROM(void);</span>
 &nbsp;</p>
<p>&nbsp;<span>static void WriteRunRecord( int state );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitOperation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>ClearRunRecord();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã«ã€è¨˜éŒ²ã—æ›¸ãè¾¼ã¿ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Operation.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Waiting()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case W_START :</span>
<span>//èµ·å‹•å†ç¢ºèª</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkTimer(&nbsp;TM18&nbsp;) == UP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsStartReady() == 0 )</span>
<span>//èµ·å‹•å¯èƒ½ãªã‚‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>WriteRunRecord(&nbsp;B_START );</span>
<span>//é‹è»¢è¨˜éŒ²</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>SetRecordEEPROM();</span>
<span>//é‹è»¢è¨˜éŒ²æ›¸ãè¾¼ã¿</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>runStage = M_START ;</span>
<span>//ç™ºé›»è£…ç½®é‹è»¢é–‹å§‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰é‡å¤§ãªç•°å¸¸ãŒç™ºç”Ÿã—ãŸæ™‚ã«è¨˜éŒ²ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Operation.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Starting()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsEmergency() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>EmStop();</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>WriteRunRecord(&nbsp;B_EMSTOP );</span>
<span>//é‹è»¢è¨˜éŒ²</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Running()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsEmergency() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>EmStop();</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>WriteRunRecord(&nbsp;B_EMSTOP );</span>
<span>//é‹è»¢è¨˜éŒ²</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Stopping()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsEmergency() == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>EmStop();</span>
<span>//ç·Šæ€¥åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>WriteRunRecord(&nbsp;B_EMSTOP );</span>
<span>//é‹è»¢è¨˜éŒ²</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>3)é‹è»¢ã«å¤±æ•—ã—ãŸæ™‚ã«ã€è¨˜éŒ²ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Operation.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Starting()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;S_MOST :</span>
<span>//å›è»¢ä¸Šæ˜‡å¾…ã¡</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( engState == A_FAIL )</span>
<span>//èµ·å‹•æ¸‹æ»</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>WriteRunRecord(&nbsp;B_ERROR );</span>
<span>//é‹è»¢è¨˜éŒ²</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Running()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( engState == A_FAIL )</span>
<span>//ä¸å…·åˆç™ºç”Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>WriteRunRecord(&nbsp;B_ERROR );</span>
<span>//é‹è»¢è¨˜éŒ²</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>4)åœæ­¢ã‚¹ãƒ†ãƒ¼ã‚¸ã§åŸç‚¹å¾©å¸°ãŒå¤±æ•—ã—ãŸæ™‚ã«ã€è¨˜éŒ²ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Operation.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Stopping()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case T_ZERO :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( ChkTimer(&nbsp;TM20&nbsp;) == UP )</span>
<span>//åŸç‚¹å¾©å¸°å¾…ã¡æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffTimer(&nbsp;TM20&nbsp;);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetError(ERR_4);</span>
<span>//åŸç‚¹å¾©å¸°å¤±æ•—</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>WriteRunRecord(&nbsp;B_ERROR );</span>
<span>//é‹è»¢è¨˜éŒ²</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>5)ç•°å¸¸ã§ã¯ãªãã¦ã€åœæ­¢ãƒœã‚¿ãƒ³ã§é‹è»¢ã‚’åœæ­¢ã—ãŸæ™‚ã«ã€è¨˜éŒ²ã—æ›¸ãè¾¼ã¿ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Operation.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Stopping()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case T_WAIT :</span>
<span>//å†èµ·å‹•ã®ä¼‘æ­¢æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>restart&nbsp;= true;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>WriteRunRecord(&nbsp;B_STOP );</span>
<span>//é‹è»¢è¨˜éŒ²</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetRecordEEPROM();</span>
<span>//é‹è»¢è¨˜éŒ²æ›¸ãè¾¼ã¿</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runStage = M_WAIT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>6)ç•°å¸¸ã®æ›¸ãè¾¼ã¿ã‚’è¡Œã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Operation.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static void Waiting()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case W_ERROR :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>EmStop();</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetRecordEEPROM();</span>
<span>//é‹è»¢è¨˜éŒ²æ›¸ãè¾¼ã¿</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>runSeq++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>è¨˜éŒ²ã«å¿…è¦ãªé–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Operation.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ä¸€æ™‚ä¿å­˜ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>static void WriteRunRecord( int state )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>RECORD *sp ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int p = 0 ; p &lt; RECBUFSZ ; p++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp = &amp;runRecord[p] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( sp-&gt;state&nbsp;!= 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>continue;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;state = state + GetErrorCode() ;</span>
<span>//4) è£…ç½®çŠ¶æ…‹ï¼ˆä¸Šä½ï¼‰ï¼‹ç•°å¸¸ç•ªå·ï¼ˆä¸‹ä½ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;value1 = nowRpm ;</span>
<span>//5) å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;stage = ( runStage &lt;&lt; 8 ) + runSeq ;</span>
<span>//6)é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆä¸Šä½ï¼‰ï¼‹é‹è»¢ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ï¼ˆä¸‹ä½ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;engine = ( engState &lt;&lt; 8 ) + engStep ;</span>
<span>//7) ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹ï¼ˆä¸Šä½ï¼‰ï¼‹ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ï¼ˆä¸‹ä½ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;step = ( GetStepSeq() &lt;&lt; 8 ) +&nbsp;restart&nbsp;;</span>
<span>//8)ã‚¹ãƒ†ãƒƒãƒ—ãƒ¢ãƒ¼ã‚¿ãƒ¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ï¼ˆä¸Šä½ï¼‰ï¼‹å†èµ·å‹•ãƒ•ãƒ©ã‚°ï¼ˆä¸‹ä½ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;value2 = ( GetVoltage() &lt;&lt; 8 ) + GetCurrent() ;</span>
<span>//9) å®ŸåŠ¹é›»åœ§å€¤ï¼ˆä¸Šä½ï¼‰ï¼‹å®ŸåŠ¹é›»æµå€¤ï¼ˆä¸‹ä½ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>static void ClearRunRecord()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>RECORD *sp ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; RECBUFSZ ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp = &amp;runRecord[n] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;yearMonth = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;dayHour = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;minSec = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;state =&nbsp; 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;value1 = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;stage= 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;engine= 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;step= 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;value2 = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ä¸€æ™‚ä¿å­˜ã•ã‚ŒãŸè¨˜éŒ²ã‚’å…¨ã¦æ›¸ãè¾¼ã‚€</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool SetRecordEEPROM()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>bool flag = false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned char caleTbl[7] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>set_imask(15);</span>
<span>//å‰²ã‚Šè¾¼ã¿ãƒã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«å¤‰æ›´</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( ReadTimeRTC( caleTbl ) == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>RECORD *sp ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( int p = 0 ; p &lt; RECBUFSZ ; p++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp = &amp;runRecord[p] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( sp-&gt;state&nbsp;== 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>continue;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int m = caleTbl[6] ;</span>
<span>//year</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m &lt;&lt;= 8 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int n = caleTbl[5] ;</span>
<span>//month</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;yearMonth = m + n ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//caleTbl[4]ã¯é€±</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m = caleTbl[3] ;</span>
<span>//day</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m &lt;&lt;= 8 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n = caleTbl[2] ;</span>
<span>//hour</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;dayHour = m + n ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m = caleTbl[1] ;</span>
<span>//min</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m &lt;&lt;= 8 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n = caleTbl[0] ;</span>
<span>//sec</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;minSec = m + n ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>flag = WriteRecordEEPROM( sp );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( flag == false )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>flag = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>set_imask(0);</span>
<span>//å‰²ã‚Šè¾¼ã¿ãƒã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«å¤‰æ›´</span>
 &nbsp;</p>
<p>&nbsp;<span>ClearRunRecord();</span>
 &nbsp;</p>
<p>&nbsp;<span>return flag;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Stepping.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetStepSeq()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return sequence;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-27">
<span>(2)&nbsp;å‹•ä½œç¢ºèª</span>
</a>
</h2>
<p>&nbsp;<span>ã§ã¯ã€é‹è»¢ã‚’é–‹å§‹ã—ã¦ã€é‹è»¢ä¸­ã«åœæ­¢ã•ã›ã‚‹ã€é‹è»¢ä¸­ã«ç•°å¸¸ã‚’ç™ºç”Ÿã•ã›ã‚‹ã€ç­‰ã€…ã‚’è¡Œã„è¨˜éŒ²ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ãã—ã¦ã€ã‚·ãƒªã‚¢ãƒ«é€šä¿¡ã§èª­ã¿å‡ºã—ã¦ã€æ­£ã—ãè¨˜éŒ²ã•ã‚ŒãŸã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-28">
<span>[9]&nbsp;ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</span>
</a>
</h1>
<p>&nbsp;<span>é‹è»¢çŠ¶æ…‹ã‚’LCDç”»é¢ã§ç¢ºèªã§ãã¾ã—ãŸãŒã€æ•°å­—ã§è¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ãã®æ„å‘³ã‚’æ–‡å­—ã§ç”»é¢ã«è¡¨ç¤ºã—ãŸã‚‰ä¾¿åˆ©ã§ã™ã€‚ä¸‹è¨˜ã®ï¼”ç¨®ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æº–å‚™ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰ç•°å¸¸ç•ªå·ã®å†…å®¹</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰èµ·å‹•ä¸å¯ã®ç†ç”±</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼”ï¼‰ã‚¹ãƒ†ãƒƒãƒ—ãƒ¢ãƒ¼ã‚¿ãƒ¼åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>ç”»é¢ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¯ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã§è¡Œã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Error.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char scError[][21] = {</span>
<span>// Error Message</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Error Message&nbsp;&nbsp; 0&nbsp;&nbsp; "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "}};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp;mã‹ã‚‰3è¡Œã®æ–‡å­—åˆ—ã‚’è¿”ã—ã¾ã™</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetErrMsg( int m, int val, char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[22], temp[8] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int j, k ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>//1st line</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( line, scError[0], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh4( val, temp );</span>
<span>//Error bits</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[16], temp, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//After 2nd line</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( m &gt;= MSGSIZE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = m ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scError[1], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>k = strlen( error[j] );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, error[j], k );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++j &gt;= MSGSIZE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetErrMsgSize()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return MSGSIZE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Operation.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>#define ENGMSG</span>
<span>11</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char *engineMsg[ENGMSG] ={</span>
<span>//engStep</span>
 &nbsp;</p>
<p>&nbsp;<span>"0:Stanby",</span>
 &nbsp;</p>
<p>&nbsp;<span>"1:Throttle start",</span>
 &nbsp;</p>
<p>&nbsp;<span>"2:Start position",</span>
 &nbsp;</p>
<p>&nbsp;<span>"3:Starter ON",</span>
 &nbsp;</p>
<p>&nbsp;<span>"4:Wait Rotation up",</span>
 &nbsp;</p>
<p>&nbsp;<span>"5:Retry",</span>
 &nbsp;</p>
<p>&nbsp;<span>"6:Auto Control",</span>
 &nbsp;</p>
<p>&nbsp;<span>"7:Wait Stable state",</span>
 &nbsp;</p>
<p>&nbsp;<span>"8:Generating",</span>
 &nbsp;</p>
<p>&nbsp;<span>"9:Stop",</span>
 &nbsp;</p>
<p>&nbsp;<span>"10:Wait Slowdown"</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>//èµ·å‹•ä¸å¯ã®ç†ç”±ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>#define STARTMSG</span>
<span>5</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char *startMsg[STARTMSG] ={</span>
 &nbsp;</p>
<p>&nbsp;<span>"1:Emergency button",</span>
 &nbsp;</p>
<p>&nbsp;<span>"2:Thermal trip",</span>
 &nbsp;</p>
<p>&nbsp;<span>"3:Rotation high",</span>
 &nbsp;</p>
<p>&nbsp;<span>"4:Step position",</span>
 &nbsp;</p>
<p>&nbsp;<span>"5:Manual mode",</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char scEngStep[][21] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Engine Step&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "}};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char scStartup[][21] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>{"StartUp&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "}};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetEngStep( int val[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = engStep ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>// mã‹ã‚‰3è¡Œã®æ–‡å­—åˆ—ã‚’è¿”ã—ã¾ã™</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetEngineMsg( int m, int val, char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[22], temp[8] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int j, k ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>//1è¡Œç›®</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( line, scEngStep[0], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoa2( val, temp );</span>
<span>//&nbsp;ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>adjust( temp, 2, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[14], temp, 2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//2è¡Œç›®ä»¥é™</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( m &gt;= ENGMSG )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = m ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scEngStep[1], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>k = strlen( engineMsg[j] );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, engineMsg[j], k );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++j &gt;= ENGMSG )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetEngMsgSize()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return ENGMSG ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetReason( int val[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = reason ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>// mã‹ã‚‰3è¡Œã®æ–‡å­—åˆ—ã‚’è¿”ã—ã¾ã™</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetReasonMsg( int m, int val, char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[22], temp[8] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int j, k ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>//1è¡Œç›®</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( line, scStartup[0], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoa2( val, temp );</span>
<span>//</span>
 &nbsp;</p>
<p>&nbsp;<span>adjust( temp, 2, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[12], temp, 2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//2è¡Œç›®ä»¥é™</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( m &gt;= STARTMSG )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = m ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scStartup[1], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>k = strlen( startMsg[j] );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, startMsg[j], k );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++j &gt;= STARTMSG )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetReasonSize()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return STARTMSG ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚¹ãƒ†ãƒƒãƒ—ãƒ¢ãƒ¼ã‚¿ãƒ¼åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Stepping.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>#define MSGSIZE</span>
<span>10</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char *motor[MSGSIZE] ={</span>
 &nbsp;</p>
<p>&nbsp;<span>"0:Begin sequence",</span>
 &nbsp;</p>
<p>&nbsp;<span>"1:Confirm stable",</span>
 &nbsp;</p>
<p>&nbsp;<span>"2:Move away",</span>
 &nbsp;</p>
<p>&nbsp;<span>"3:Back to Home",</span>
 &nbsp;</p>
<p>&nbsp;<span>"4:Confirm arrival",</span>
 &nbsp;</p>
<p>&nbsp;<span>"5:Stand by",</span>
 &nbsp;</p>
<p>&nbsp;<span>"6:Fix position",</span>
 &nbsp;</p>
<p>&nbsp;<span>"7:Auto control",</span>
 &nbsp;</p>
<p>&nbsp;<span>"8:Error",</span>
 &nbsp;</p>
<p>&nbsp;<span>"9:Error2"</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char scMtrStep[][21] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Motor Step&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "}};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetMotStep( int val[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = sequence;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>// mã‹ã‚‰3è¡Œã®æ–‡å­—åˆ—ã‚’è¿”ã—ã¾ã™</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetStepMsg( int m, int val, char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[22], temp[8] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int j, k ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>//1è¡Œç›®</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( line, scMtrStep[0], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoa2( val, temp );</span>
<span>//</span>
 &nbsp;</p>
<p>&nbsp;<span>adjust( temp, 2, ' ' );</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[14], temp, 2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//2è¡Œç›®ä»¥é™</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( m &gt;= MSGSIZE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = m ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scMtrStep[1], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>k = strlen( motor[j] );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, motor[j], k );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++j &gt;= MSGSIZE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetStepMsgSize()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return MSGSIZE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>è¡¨ç¤ºç”¨ã®é–¢æ•°ã‚’ç”¨æ„ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Display.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool swState ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitLCD()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>swState = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>static void DispFunc2( void (*func1)(int []),&nbsp; int (*func2)(void), void (*func3)(int, int, char []))</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int val[8] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>func1( val );</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( val[0] != term[0] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>term[0] = val[0] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>term[1] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>func3( term[1], val[0], lcdBuff );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ShowLcdBuff( 4, 1 );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( swState == false)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( IsReset() == true )&nbsp;&nbsp;&nbsp; // SW3 =&gt; reset</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>swState = true;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>term[1] += 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( term[1] &gt;= func2())</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>term[1] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>func3( term[1], val[0], lcdBuff );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ShowLcdBuff( 4, 1 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;if ( IsReset() == false )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>swState = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void DispLCD()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case D_ErrorMsg :</span>
<span>//Error contents</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DispFunc2( GetErrorBit,&nbsp; GetErrMsgSize, GetErrMsg );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case D_EngineMsg :</span>
<span>//Engine Steps</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DispFunc2( GetEngStep,&nbsp; GetEngMsgSize, GetEngineMsg );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case D_StartMsg :</span>
<span>//OPeration Start up</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DispFunc2( GetReason,&nbsp; GetReasonSize, GetReasonMsg );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>case D_MotorMsg :</span>
<span>//Stepping Motor</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DispFunc2( GetMotStep,&nbsp; GetStepMsgSize, GetStepMsg );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-29">
<span>[10]&nbsp;ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“</span>
</a>
</h1>
<p>&nbsp;<span>ã“ã“ã§ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã®ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã‚’è¨ˆæ¸¬ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚³ãƒ³ãƒšã‚¢ãƒãƒƒãƒã‚¿ã‚¤ãƒãƒ¼ï¼‘ã‚’ä½¿ã£ã¦è¨ˆã‚Šã€LCDç”»é¢ã«è¡¨ç¤ºã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;hwsetup.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//Interrupt priority</span>
 &nbsp;</p>
<p>&nbsp;<span>INTC.IPR08.BIT._CMT1 =&nbsp;6&nbsp;;</span>
<span>//CMT1 ã‚³ãƒ³ãƒšã‚¢ãƒãƒƒãƒ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//-----------------------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“è¨ˆæ¸¬ã«ä½¿ç”¨</span>
 &nbsp;</p>
<p>&nbsp;<span>CMT1.CMCSR.BIT.CMIE = 0 ;</span>
<span>//0ï¼šã‚³ãƒ³ãƒšã‚¢ãƒãƒƒãƒå‰²ã‚Šè¾¼ã¿ï¼ˆCMIï¼‰ã‚’ç¦æ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>CMT1.CMCSR.BIT.CKS = 3 ;</span>
<span>//11ï¼šPÏ†/512 = 10.24us</span>
 &nbsp;</p>
<p>&nbsp;<span>CMT1.CMCNT = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>CMT1.CMCOR = 0xFFFF ;</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Main.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«ã®æ™‚é–“è¨ˆæ¸¬</span>
 &nbsp;</p>
<p>&nbsp;<span>#define COUNTMAX</span>
<span>24</span>
<span>//ç§»å‹•å¹³å‡æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>static unsigned short countAve[COUNTMAX] ;</span>
<span>//ç§»å‹•å¹³å‡ãƒãƒƒãƒ•ã‚¡</span>
 &nbsp;</p>
<p>&nbsp;<span>static short countPtr ;</span>
<span>//ç§»å‹•å¹³å‡ãƒã‚¤ãƒ³ã‚¿</span>
 &nbsp;</p>
<p>&nbsp;<span>static unsigned long countBuf ;</span>
<span>//ã‚«ã‚¦ãƒ³ã‚¿ç©ç®—ãƒãƒƒãƒ•ã‚¡</span>
 &nbsp;</p>
<p>&nbsp;<span>static unsigned short countMin ;</span>
<span>//æœ€å°å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>static unsigned short countMax ;</span>
<span>//æœ€å¤§å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private function</span>
 &nbsp;</p>
<p>&nbsp;<span>static void CheckCycle (void);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void main(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>set_imask(0);</span>
<span>//å‰²ã‚Šè¾¼ã¿ãƒã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«å¤‰æ›´</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>CMT1.CMCNT = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>CMT.CMSTR.BIT.STR1 = 1 ;</span>
<span>//CMT1 ã‚³ãƒ³ãƒšã‚¢ãƒãƒƒãƒã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>while ( 1 )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>Twinkle();</span>
<span>//å‹•ä½œè¡¨ç¤ºéƒ¨</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>CheckCycle&nbsp;();</span>
<span>//ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«ã®æ™‚é–“è¨ˆæ¸¬</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void&nbsp;ClearCycle&nbsp;()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; COUNTMAX ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>countAve[n] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>countPtr&nbsp; = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>countBuf = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>countMin = 0xFFFF ;</span>
 &nbsp;</p>
<p>&nbsp;<span>countMax = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>static void InitMain()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>ClearCycle&nbsp;();</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>selectLED = L_NONE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«ã®æ™‚é–“è¨ˆæ¸¬</span>
 &nbsp;</p>
<p>&nbsp;<span>static void CheckCycle()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int tcnt = CMT1.CMCNT ;</span>
 &nbsp;</p>
<p>&nbsp;<span>countBuf -= countAve[countPtr] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>countAve[countPtr] = tcnt ;</span>
 &nbsp;</p>
<p>&nbsp;<span>countBuf += tcnt ;</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( ++countPtr &gt;= COUNTMAX )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>countPtr = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( tcnt &gt; countMax )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>countMax = tcnt ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( tcnt &lt; countMin )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>countMin = tcnt ;</span>
 &nbsp;</p>
<p>&nbsp;<span>CMT1.CMCNT = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>LCDç”»é¢ã«è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Main.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>#include &lt;string.h&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char scCycle[][21] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>{"AVE&nbsp; 0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"MAX&nbsp; 0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"MIN&nbsp; 0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"ONE&nbsp; 0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "}};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//æ™‚é–“è¨ˆæ¸¬ã‚’è¿”ã™</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetCycle(int val[])</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = countBuf / COUNTMAX ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[1] = countMax ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[2] = countMin ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[3] = 0;</span>
<span>//GetOneTime();</span>
 &nbsp;</p>
<p>&nbsp;<span>return 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//LCD</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetCycleMsg( int val[], char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[22], temp[8] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 4 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scCycle[n], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( val[n], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[5], temp, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>LCDç”»é¢ã«è¡¨ç¤ºã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Display.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private function</span>
 &nbsp;</p>
<p>&nbsp;<span>static void DispCycle(void);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void DispLCD()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( nowPage ){</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;D_Cycle&nbsp;://Cycle</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DispCycle();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>selectLED = L_MAIN ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚µã‚¤ã‚¯ãƒ«ã®æ™‚é–“ã®è¡¨ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>static void DispCycle()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>DispFunc( GetCycle,&nbsp; GetCycleMsg );</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( swState == false)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkInp( P_Di10 ) == ON )&nbsp;&nbsp;&nbsp; // SW3</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>swState = true;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ClearCycle();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkInp( P_Di10 ) == OFF )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>swState = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>è¨ˆæ¸¬ã®çµæœã¯å¦‚ä½•ã§ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®ã€å…¨è² è·æŠ•å…¥å¾Œã®è¨ˆæ¸¬ã§ã¯ã€</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰é€šå¸¸å‹•ä½œæ™‚</span>
 &nbsp;</p>
<p>&nbsp;<span>æœ€å¤§&nbsp;3.3ms</span>
 &nbsp;</p>
<p>&nbsp;<span>æœ€å° 10us</span>
 &nbsp;</p>
<p>&nbsp;<span>å¹³å‡&nbsp;24.5us</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰å§‹å‹•ã‚„åœæ­¢ãªã©ã®çŠ¶æ…‹é·ç§»æ™‚</span>
 &nbsp;</p>
<p>&nbsp;<span>æœ€å¤§ 110.5ms</span>
 &nbsp;</p>
<p>&nbsp;<span>æœ€å° 10us</span>
 &nbsp;</p>
<p>&nbsp;<span>å¹³å‡ 24.5us</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã—ãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã‚Œã¯EEPROMã¸ã®æ›¸ãè¾¼ã¿æ™‚é–“ã®å½±éŸ¿ã‚’å—ã‘ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>EEPROMã¸ã®æ›¸ãè¾¼ã¿ã‚’çœç•¥ã™ã‚‹ã¨ã€ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯é€šå¸¸å‹•ä½œæ™‚ã¨åŒã˜ã«ãªã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å¾Œè¨˜ã®åŠ¹ç‡åŒ–ã®ã¨ã“ã‚ã§ã‚‚ã€ã“ã‚Œã‚‰ã‚’æ‰±ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<p>&nbsp;<span>ç¬¬ï¼”å·»ã§ã¯æ¬¡ã®ãƒ†ãƒ¼ãƒã‚’æ‰±ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰ç™ºé›»å‘¨æ³¢æ•°ã€é›»åœ§ã€é›»æµã¨é›»åŠ›ã®è¨ˆç®—</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰åŠ¹ç‡åŒ–</span>
 &nbsp;</p>
<p>&nbsp;<span>ã•ã‚‰ã«ã€å®Ÿç”¨çš„ãªã‚·ã‚¹ãƒ†ãƒ ã«ã™ã‚‹ãŸã‚ã«ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚‚ã†å°‘ã—ã®åŠªåŠ›ã§ã€ã‚ãªãŸã¯ç›®æ¨™ã«é”ã—ã¾ã™ã€‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>ã€Œç­†è€…ã®ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã€</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¾ã é§†ã‘å‡ºã—ã®é ƒã€ç²¾å¯†é›»å­æ©Ÿå™¨ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’æŠ¼ã—é€€ã‘ã¦ã€ã‚ã‚‹è£…ç½®ã®ãƒã‚¤ã‚³ãƒ³å´ã®è£½ä½œã‚’ä¾é ¼ã•ã‚ŒãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>æ©Ÿæ¢°å´ã¯åœ°å…ƒã®å°‚é–€ãƒ¡ãƒ¼ã‚«ãƒ¼ãŒæ‹…å½“ã™ã‚‹ã“ã¨ã«ãªã£ãŸã€‚ãã®ãƒ¡ãƒ¼ã‚«ãƒ¼ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã¦ã€ç´ äººãŒå‡ºæ¥ã‚‹åˆ†é‡ã§ã¯ãªã„ã‹ã‚‰ã€æ‰‹ã‚’å¼•ãã‚ˆã†ã«è¦æ±‚ã•ã‚ŒãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã—ã‹ã—ã€å½“æ–¹ã®è£½ä½œã—ãŸãƒã‚¤ã‚³ãƒ³è£…ç½®ã¯ã€ãã®å¾ŒEPROMã®è¨˜æ†¶ä¿æŒæœŸé–“ãŒéããŸã‚‰æ–°ã—ã„ã®ã«æ›¸ãç›´ã™äº‹ã‚’ç¹°ã‚Šè¿”ã—ã¦é•·æœŸé–“ä½¿ã‚ã‚ŒãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ãã‚“ãªç´ äººã«ç™ºæ³¨ã—ãŸã®ã¯ã€è²»ç”¨ä»¥ä¸Šã«ã€ãŸã æ‹…å½“è€…ã®å½“æ–¹ã®æŠ€è¡“ã«å¯¾ã™ã‚‹ä¿¡é ¼ã§ã‚ã‚Šã€ã“ã‚ŒãŒä»Šæ—¥ã®ç§ãŸã¡ã®åŸå‹•åŠ›ã¨ãªã£ãŸã¨æ„Ÿè¬ã—ã¦ã„ã‚‹ã€‚</span>
</p>
</div>
</div>


<script>function myFunction(){document.getElementById("tateyoko").classList.toggle("tateread")}</script></body></html>