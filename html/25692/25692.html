<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Visual Studio C#でRaspberry Pi Intel MAX 10 FPGA編</title>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/css/mainday.css" title="default">
<link rel="alternate stylesheet" href="/css/mainnight.css" title="alternate">
<script type="text/javascript" src="/js/styleswitcher.js"></script>
<script type="text/javascript" src="/js/global.js"></script>
</head>
<body>
<div class="novelpage">
<div class="novelbody">
<div id="tateyoko">
<div id="_top"></div>
<a href="/">🏠</a>&emsp;
<a href="#" onclick="setActiveStyleSheet('default'); return false;">日</a>&emsp;
<a href="#" onclick="setActiveStyleSheet('alternate'); return false;">月</a>&emsp;
<a href="#_top" onclick="myFunction()" style="cursor: pointer;">縦書き／横書き</a>
<div id="calibre_link-64">
<div>
<div>
<table class="noveltitle">
<tr>
<td colspan="2"><i><span><i>Visual Studio C#でRaspberry Pi Intel MAX 10 FPGA編</i></span></i></td>
</tr>
<tr>
                    
                    
      </tr>
<tr>
<td colspan="2">rapidnack</td>
</tr>
<tr>
<td colspan="2"> (2018)</td>
</tr>
<tr>
<td colspan="2"></td>
</tr>
</table>
<div></div>
</div>
<div></div>
</div>
</div>



<div id="calibre_link-0">
<div>
<p>&nbsp;<span>Visual Studio C#</span>
 &nbsp;</p>
<p>&nbsp;<span>で</span>
 &nbsp;</p>
<p>&nbsp;<span>Raspberry Pi</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Intel MAX 10&nbsp;FPG</span>
<span>A</span>
<span>編</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>rapidnack&nbsp;--&nbsp;著</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<p>&nbsp;<span>・以下のサイトで、本書で掲載したソースコードを入手できます。</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://github.com/Rapidnack/PigpiodIfTest">
<span><u>https://github.com/Rapidnack/PigpiodIfTest</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>・本書中の会社名や商品名は、該当する各社の商標または登録商標です。本書中で</span>
<span>は</span>
<span>T</span>
<span>M</span>
<span>およ</span>
<span>び®</span>
<span>マークは省略させていただいております。</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<p>&nbsp;<a id="calibre_link-65"></a>
<a href="#calibre_link-1">
<span><u>はじめに</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-2">
<span><u>1</u></span>
<span><u>Visual Studio Communit</u></span>
<span><u>y</u></span>
<span><u>の準備</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-3">
<span><u>2</u></span>
<span><u>Raspberry P</u></span>
<span><u>i</u></span>
<span><u>の準備</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-4">
<span><u>2.1</u></span>
<span><u>Mon</u></span>
<span><u>o</u></span>
<span><u>のバージョン</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-5">
<span><u>2.2</u></span>
<span><u>ファイルシステムを書き込み可にする</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-6">
<span><u>2.3</u></span>
<span><u>KIOS</u></span>
<span><u>K</u></span>
<span><u>モード</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-7">
<span><u>3</u></span>
<span><u>Quartus Prime Lite Editio</u></span>
<span><u>n</u></span>
<span><u>の準備</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-8">
<span><u>3.1</u></span>
<span><u>Quartus Prime Lite Editio</u></span>
<span><u>n</u></span>
<span><u>をインストール</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-9">
<span><u>3.2</u></span>
<span><u>USB Programmer Drive</u></span>
<span><u>r</u></span>
<span><u>をインストール</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-10">
<span><u>3.3</u></span>
<span><u>プロジェクトを作成</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-11">
<span><u>3.4</u></span>
<span><u>トップモジュールを追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-12">
<span><u>3.5</u></span>
<span><u>ピン配置（クロック</u></span>
<span><u>、</u></span>
<span><u>LE</u></span>
<span><u>D</u></span>
<span><u>）</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-13">
<span><u>3.6</u></span>
<span><u>書き込み</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-14">
<span><u>4</u></span>
<span><u>新しいソリューションを作成</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-15">
<span><u>4.1</u></span>
<span><u>ソースコードをダウンロード</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-16">
<span><u>4.2</u></span>
<span><u>すぐ試してみたい場合は</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-17">
<span><u>4.3</u></span>
<span><u>新しいソリューションを作成</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-18">
<span><u>4.4</u></span>
<span><u>ライブラリプロジェクトを追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-19">
<span><u>4.5</u></span>
<span><u>ログ出力</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-20">
<span><u>4.6</u></span>
<span><u>例外対策</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-21">
<span><u>5</u></span>
<span><u>PigpiodI</u></span>
<span><u>f</u></span>
<span><u>クラス</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-22">
<span><u>5.1</u></span>
<span><u>PigpiodI</u></span>
<span><u>f</u></span>
<span><u>を追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-23">
<span><u>5.2</u></span>
<span><u>GPI</u></span>
<span><u>OでL</u></span>
<span><u>チカ</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-24">
<span><u>5.3</u></span>
<span><u>サーボパルスを出力</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-25">
<span><u>6</u></span>
<span><u>SPI Slave to Avalon Master Bridge</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-26">
<span><u>6.1</u></span>
<span><u>Raspberry P</u></span>
<span><u>i</u></span>
<span><u>と評価ボードを接続</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-27">
<span><u>6.2</u></span>
<span><u>Raspberry Pi SPI</u></span>
<span><u>1</u></span>
<span><u>の不具合</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-28">
<span><u>6.3</u></span>
<span><u>ALTPL</u></span>
<span><u>L</u></span>
<span><u>を追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-29">
<span><u>6.4</u></span>
<span><u>Platform Designer (Qsys</u></span>
<span><u>)</u></span>
<span><u>に追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-30">
<span><u>6.5</u></span>
<span><u>ピン配置</u></span>
<span><u>（</u></span>
<span><u>SP</u></span>
<span><u>I</u></span>
<span><u>）</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-31">
<span><u>6.6</u></span>
<span><u>書き込み</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-32">
<span><u>7</u></span>
<span><u>AvalonM</u></span>
<span><u>M</u></span>
<span><u>クラス</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-33">
<span><u>7.1</u></span>
<span><u>AvalonM</u></span>
<span><u>M</u></span>
<span><u>を追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-34">
<span><u>7.2</u></span>
<span><u>AvalonM</u></span>
<span><u>MでL</u></span>
<span><u>チカ</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-35">
<span><u>8</u></span>
<span><u>MyBasicStorag</u></span>
<span><u>e</u></span>
<span><u>コンポーネント</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-36">
<span><u>8.1</u></span>
<span><u>Raspberry P</u></span>
<span><u>i</u></span>
<span><u>と評価ボードを接続</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-37">
<span><u>8.2</u></span>
<span><u>メモリを作成</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-38">
<span><u>8.3</u></span>
<span><u>コンポーネントを作成</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-39">
<span><u>8.4</u></span>
<span><u>Platform Designer (Qsys</u></span>
<span><u>)</u></span>
<span><u>に追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-40">
<span><u>8.5</u></span>
<span><u>ピン配置</u></span>
<span><u>（</u></span>
<span><u>COMPLET</u></span>
<span><u>E</u></span>
<span><u>）</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-41">
<span><u>8.6</u></span>
<span><u>書き込み</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-42">
<span><u>8.7</u></span>
<span><u>アプリケーションを変更</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-43">
<span><u>9</u></span>
<span><u>グラフ表示</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-44">
<span><u>9.1</u></span>
<span><u>OxyPlot.WindowsForm</u></span>
<span><u>s</u></span>
<span><u>パッケージをインストール</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-45">
<span><u>9.2</u></span>
<span><u>PlotVie</u></span>
<span><u>w</u></span>
<span><u>を画面に追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-46">
<span><u>9.3</u></span>
<span><u>アプリケーションを変更</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-47">
<span><u>10</u></span>
<span><u>MyTriggeredStorag</u></span>
<span><u>e</u></span>
<span><u>コンポーネント</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-48">
<span><u>10.1</u></span>
<span><u>コンポーネントを作成</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-49">
<span><u>10.2</u></span>
<span><u>Platform Designer (Qsys</u></span>
<span><u>)</u></span>
<span><u>に追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-50">
<span><u>10.3</u></span>
<span><u>書き込み</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-51">
<span><u>10.4</u></span>
<span><u>アプリケーションを変更</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-52">
<span><u>11</u></span>
<span><u>モジュラ</u></span>
<span><u>ー</u></span>
<span><u>ADC I</u></span>
<span><u>P</u></span>
<span><u>コア</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-53">
<span><u>11.1</u></span>
<span><u>Platform Designer (Qsys</u></span>
<span><u>)</u></span>
<span><u>に追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-54">
<span><u>12</u></span>
<span><u>MyAdcAdapte</u></span>
<span><u>r</u></span>
<span><u>コンポーネント</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-55">
<span><u>12.1</u></span>
<span><u>コンポーネントを作成</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-56">
<span><u>12.2</u></span>
<span><u>Platform Designer (Qsys</u></span>
<span><u>)</u></span>
<span><u>に追加</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-57">
<span><u>12.3</u></span>
<span><u>書き込み</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-58">
<span><u>12.4</u></span>
<span><u>アプリケーションを変更</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-59">
<span><u>13</u></span>
<span><u>Raspberry P</u></span>
<span><u>i</u></span>
<span><u>で実行</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-60">
<span><u>13.1</u></span>
<span><u>Raspberry P</u></span>
<span><u>i</u></span>
<span><u>で実行（リモートデスクトップ）</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-61">
<span><u>13.2</u></span>
<span><u>Raspberry P</u></span>
<span><u>i</u></span>
<span><u>で実行（小</u></span>
<span><u>型</u></span>
<span><u>LC</u></span>
<span><u>D</u></span>
<span><u>）</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<a id="calibre_link-1"><b>
<span><b>はじめに</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>Raspberry P</span>
<span>i</span>
<span>用にタッチパネル付き小</span>
<span>型</span>
<span>LC</span>
<span>D</span>
<span>が多数販売されています</span>
<span>。</span>
<span>GU</span>
<span>I</span>
<span>アプリケーションを作りたくなりますね</span>
<span>。</span>
<span>We</span>
<span>bで</span>
<span>GU</span>
<span>I</span>
<span>アプリケーションの作成方法を検索する</span>
<span>と</span>
<span>Pytho</span>
<span>nか</span>
<span>C+</span>
<span>+</span>
<span>の例がほとんどです</span>
<span>。</span>
<span>Window</span>
<span>s</span>
<span>のよう</span>
<span>に</span>
<span>Visual Studi</span>
<span>o</span>
<span>で簡単</span>
<span>に</span>
<span>GU</span>
<span>I</span>
<span>アプリケーションを作れないものでしょうか。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>そんな思いから、前々作</span>
<span>「</span>
<span>Visual Studio C</span>
<span>#で</span>
<span>Raspberry Pi</span>
<span>&nbsp;</span>
<span>リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>導入編」では</span>
<span>、</span>
<span>Visual Studi</span>
<span>o</span>
<span>で作成し</span>
<span>た</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションをそのま</span>
<span>ま</span>
<span>Raspberry P</span>
<span>i</span>
<span>で実行する手順を、前作</span>
<span>「</span>
<span>Visual Studio C</span>
<span>#で</span>
<span>Raspberry Pi</span>
<span>&nbsp;</span>
<span>リモー</span>
<span>ト</span>
<span>AD</span>
<span>C</span>
<span>グラフ編」で</span>
<span>は</span>
<span>Raspberry P</span>
<span>i</span>
<span>に接続し</span>
<span>た</span>
<span>A/</span>
<span>D</span>
<span>コンバータ―からデータを取得してグラフ表示する方法を説明しました。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>本書</span>
<span>は</span>
<span>A/</span>
<span>D</span>
<span>コンバータ―を内蔵し</span>
<span>た</span>
<span>FPG</span>
<span>A、</span>
<span>Intel MAX 1</span>
<span>0を</span>
<span>Raspberry P</span>
<span>i</span>
<span>に接続して</span>
<span>、</span>
<span>500kS/s&nbsp;</span>
<span>2</span>
<span>チャンネルの簡易オシロスコープを作成します。今回使用す</span>
<span>る</span>
<span>arrow.co</span>
<span>m</span>
<span>の評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0は</span>
<span>US</span>
<span>B</span>
<span>書き込み機能付きでわず</span>
<span>か</span>
<span>2</span>
<span>9</span>
<span>ドル、日本へも送料無料</span>
<span>、2</span>
<span>日ほどで到着します。下の写真は別途用意したピンソケットをはんだ付けした状態です。</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://www.arrow.com/en/products/max1000/arrow-development-tools">
<span><u>https://www.arrow.com/en/products/max1000/arrow-development-tools</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<img src="images/000038.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>作成する簡易オシロスコープは</span>
<span>、</span>
<span>51</span>
<span>2</span>
<span>サンプルのデータ</span>
<span>を</span>
<span>FPG</span>
<span>A</span>
<span>内部のメモリに書き込み、まとめてグラフ表示します。データ取得がハードウェア制御になるので、高速、等間隔にできます。トリガー機能</span>
<span>も</span>
<span>FPG</span>
<span>A</span>
<span>に組み込みます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>グラフ描画には、前作と同じく、多量のデータを高速に表示できるグラフライブラ</span>
<span>リ</span>
<span>OxyPlo</span>
<span>t</span>
<span>を使用します。</span>
 &nbsp;</p>
<p>&nbsp;<a href="http://www.oxyplot.org/">
<span><u>http://www.oxyplot.org/</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>下図は</span>
<span>、</span>
<span>+9</span>
<span>0°</span>
<span>(2500us</span>
<span>)と</span>
<span>-9</span>
<span>0°</span>
<span>(500us</span>
<span>)</span>
<span>のサーボパルスを入力したときの表示です。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000181.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>本書は</span>
<span>、</span>
<span>FPG</span>
<span>A</span>
<span>の開発手順</span>
<span>と</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションの開発手順を中心に説明します</span>
<span>。</span>
<span>Raspberry P</span>
<span>i</span>
<span>の準備については、前々作</span>
<span>「</span>
<span>Visual Studio C</span>
<span>#で</span>
<span>Raspberry Pi</span>
<span>&nbsp;</span>
<span>リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>導入編」をご覧ください。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>作成す</span>
<span>る</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションは、次のよう</span>
<span>に</span>
<span>Visual Studi</span>
<span>oで</span>
<span>Raspberry P</span>
<span>iの</span>
<span>GPI</span>
<span>O</span>
<span>を使ったデバッグができます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000059.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>あとは、完成し</span>
<span>た</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションをそのま</span>
<span>ま</span>
<span>Raspberry P</span>
<span>i</span>
<span>で実行するだけです。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000152.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>で「リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>」を操作するためのライブラリ</span>
<span>、</span>
<span>C</span>
<span>#で</span>
<span>Intel FPG</span>
<span>A</span>
<span>を操作するためのライブラリ、本書で作成す</span>
<span>る</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションのソースコード</span>
<span>を</span>
<span>GitHu</span>
<span>b</span>
<span>で公開しています。</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://github.com/Rapidnack/PigpiodIfTest">
<span><u>https://github.com/Rapidnack/PigpiodIfTest</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>201</span>
<span>8年</span>
<span>1</span>
<span>0</span>
<span>月&nbsp;rapidnack</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-2"><b>
<span><b>Visual Studio Communit</b></span>
<span><b>y</b></span>
<span><b>の準備</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>Visual Studio Community&nbsp;201</span>
<span>5、</span>
<span>Visual Studio Community&nbsp;201</span>
<span>7</span>
<span>で動作確認をしています</span>
<span>。</span>
<span>Visual Studi</span>
<span>o</span>
<span>をインストールしていない場合は</span>
<span>、</span>
<span>Visual Studio Communit</span>
<span>y</span>
<span>をインストールしてください。</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://visualstudio.microsoft.com/ja/vs/community/">
<span><u>https://visualstudio.microsoft.com/ja/vs/community/</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000145.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Visual Studi</span>
<span>o</span>
<span>に慣れていない方は、簡単</span>
<span>な</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションが作れるように、入門書、説明サイト等で勉強してください。</span>
 &nbsp;</p>
<p>&nbsp;<span>サイト例：</span>
<a href="http://www.atmarkit.co.jp/ait/articles/1704/10/news026.html">
<span><u>http://www.atmarkit.co.jp/ait/articles/1704/10/news026.html</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-3"><b>
<span><b>Raspberry P</b></span>
<span><b>i</b></span>
<span><b>の準備</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>前作</span>
<span>「</span>
<span>Visual Studio C</span>
<span>#で</span>
<span>Raspberry Pi</span>
<span>&nbsp;</span>
<span>リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>導入編」でセットアップし</span>
<span>た</span>
<span>Raspberry P</span>
<span>i</span>
<span>の設定を一部変更します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>2.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-4"><b>
<span><b>Mon</b></span>
<span><b>o</b></span>
<span><b>のバージョン</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>2018/10/0</span>
<span>4</span>
<span>現在</span>
<span>の</span>
<span>Stabl</span>
<span>e版</span>
<span>5.1</span>
<span>4</span>
<span>はテキストボックスの表示に不具合があります。また</span>
<span>、</span>
<span>5.1</span>
<span>0</span>
<span>以前のバージョンはメモリリークがあり、グラフの更新を長時間続けると表示が固まってしまいます。そこで本書では一つ前</span>
<span>の</span>
<span>Stabl</span>
<span>e版</span>
<span>5.1</span>
<span>2</span>
<span>をインストールすることにしました。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>インストールされてい</span>
<span>る</span>
<span>Mon</span>
<span>o</span>
<span>のバージョンを確認します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>Mono -V</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>Mono JIT compiler version&nbsp;</span>
<span>5.12.0.301</span>
<span>&nbsp;(tarball Wed Jul 25 17:43:40 UTC 2018)</span>
 &nbsp;</p>
<p>&nbsp;<span>Copyright (C) 2002-2014 Novell, Inc, Xamarin Inc and Contributors. www.mono-project.com</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TLS:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __thread</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SIGSEGV:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; normal</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Notifications: epoll</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Architecture:&nbsp; armel,vfp+hard</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Disabled:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; none</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Misc:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; softdebug</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Interpreter:&nbsp;&nbsp; yes</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LLVM:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; supported, not enabled.</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GC:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sgen (concurrent by default)</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>5.1</span>
<span>4</span>
<span>がインストールされていた場合は、次の手順</span>
<span>で</span>
<span>5.1</span>
<span>2</span>
<span>に変更します。</span>
<span>「</span>
<span>sudo apt updat</span>
<span>e</span>
<span>」で警告が表示されますが問題ありません。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>sudo apt remove monodevelop</span>
 &nbsp;</p>
<p>&nbsp;<span>sudo apt autoremove</span>
 &nbsp;</p>
<p>&nbsp;<span>sudo rm&nbsp;/etc/apt/sources.list.d/mono-official-stable.list</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>echo "deb https://download.mono-project.com/repo/debian stable-raspbianstretch/snapshots/5.12 main" | sudo tee /etc/apt/sources.list.d/mono-snapshot_5_12.list</span>
 &nbsp;</p>
<p>&nbsp;<span>sudo apt update</span>
 &nbsp;</p>
<p>&nbsp;<span>sudo apt install monodevelop</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>2.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-5"><b>
<span><b>ファイルシステムを書き込み可にする</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>前作</span>
<span>「</span>
<span>Visual Studio C</span>
<span>#で</span>
<span>Raspberry Pi</span>
<span>&nbsp;</span>
<span>リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>導入編」の「</span>
<a id="calibre_link-66">
<span>Read only Root-FS</span>
</a>
<span>」を導入している場合は、次の操作で書き込み可にしておきます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>/boot/config.tx</span>
<span>t</span>
<span>の</span>
<span>最後の行をコメントアウトして</span>
<span>再起動すると、</span>
<span>書き込み可能になります。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>sudo mount -o remount,rw /mnt/boot-ro</span>
 &nbsp;</p>
<p>&nbsp;<span>sudo vi /mnt/boot-ro/config.txt</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>最後の行をコメントアウトして再起動：</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>#initramfs initrd.gz</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>再度書き込み禁止に戻すときは次のようにします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>/boot/config.tx</span>
<span>t</span>
<span>の</span>
<span>最後の行のコメントアウトを外して</span>
<span>再起動すると、</span>
<span>書き込み禁止に戻ります。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>sudo vi /boot/config.txt</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>最後の行のコメントアウトを外して再起動：</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>initramfs initrd.gz</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>2.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-6"><b>
<span><b>KIOS</b></span>
<span><b>K</b></span>
<span><b>モード</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>起動す</span>
<span>る</span>
<span>GU</span>
<span>I</span>
<span>アプリケーションが異なるので、前作</span>
<span>「</span>
<span>Visual Studio C</span>
<span>#で</span>
<span>Raspberry Pi</span>
<span>&nbsp;</span>
<span>リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>導入編」の</span>
<span>「</span>
<span>KIOS</span>
<span>K</span>
<span>モード」の設定を一部変更します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>自動的にカーソルを消すようにします。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>sudo apt-get install unclutter</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>自動的</span>
<span>に</span>
<span>GU</span>
<span>I</span>
<span>アプリケーションを起動するように</span>
<span>、</span>
<span>~/.config/lxsession/LXDE-pi/autostar</span>
<span>t</span>
<span>を編集します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>vi ~/.config/lxsession/LXDE-pi/autostart</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>~/.config/lxsession/LXDE-pi/autostar</span>
<span>t</span>
<span>の内容：</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>@lxpanel --profile LXDE-pi</span>
 &nbsp;</p>
<p>&nbsp;<span>@pcmanfm --desktop --profile LXDE-pi</span>
 &nbsp;</p>
<p>&nbsp;<span>@xscreensaver -no-splash</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>@xset s off</span>
 &nbsp;</p>
<p>&nbsp;<span>@xset -dpms</span>
 &nbsp;</p>
<p>&nbsp;<span>@xset s noblank</span>
 &nbsp;</p>
<p>&nbsp;<span>@unclutter</span>
 &nbsp;</p>
<p>&nbsp;<span>@mono /home/pi/Projects/</span>
<span>Max10Graph</span>
<span>/</span>
<span>Max10Graph</span>
<span>/bin/Debug/</span>
<span>Max10Graph</span>
<span>.exe</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>GU</span>
<span>I</span>
<span>アプリケーションを全画面表示で起動するように</span>
<span>、</span>
<span>~/.config/openbox/lxde-pi-rc.xm</span>
<span>l</span>
<span>を編集します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>vi ~/.config/openbox/lxde-pi-rc.xml</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>ファイルの最後の方に追加：</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>...</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; # end of the example</span>
 &nbsp;</p>
<p>&nbsp;<span>--&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; &lt;application title="</span>
<span>MAX 10&nbsp;Graph</span>
<span>"&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;fullscreen&gt;yes&lt;/fullscreen&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;&nbsp;&nbsp; &lt;/application&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp; &lt;/applications&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&lt;/openbox_config&gt;</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>これで起動時に全画面表示で実行されるようになりました</span>
<span>。</span>
<span><b>Alt+F1</b></span>
<span><b>1</b></span>
<span>キーで全画面表示を解除できます。</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-7"><b>
<span><b>Quartus Prime Lite Editio</b></span>
<span><b>n</b></span>
<span><b>の準備</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>Intel FPGA</span>
<span>(旧</span>
<span>Altera</span>
<span>)</span>
<span>の無償版開発ツール&nbsp;Quartus Prime Lite Editio</span>
<span>n</span>
<span>をインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<span>arrow.co</span>
<span>m</span>
<span>の評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0</span>
<span>内蔵</span>
<span>の</span>
<span>Arrow-USB-Blaste</span>
<span>r</span>
<span>のドライバもインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>3.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-8"><b>
<span><b>Quartus Prime Lite Editio</b></span>
<span><b>n</b></span>
<span><b>をインストール</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>下記アドレスから「ライト・エディション」を選択します。</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://www.intel.co.jp/content/www/jp/ja/software/programmable/quartus-prime/download.html">
<span><u>インテ</u></span>
<span><u>ル</u></span>
<span><u>® Quartus® Prime</u></span>
<span><u>&nbsp;</u></span>
<span><u>開発ソフトウェアのダウンロード</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<img src="images/000178.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Quartus Prime (includes Nios II EDS)</span>
<span>&nbsp;</span>
<span>」と</span>
<span>「</span>
<span>MAX 10 FPGA device suppor</span>
<span>t</span>
<span>」</span>
<span>は必ずダウンロードしてください。</span>
<span>ダウンロード時にログインが必要です。ユーザーアカウントを取得していない場合は登録してください。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000033.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ダウンロードされた</span>
<span>「</span>
<span>QuartusLiteSetup-18.1.0.625-windows.ex</span>
<span>e</span>
<span>」を実行してインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000078.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>3.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-9"><b>
<span><b>USB Programmer Drive</b></span>
<span><b>r</b></span>
<span><b>をインストール</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>下記アドレスから、</span>
<span>「</span>
<span>MAX1000 User Guid</span>
<span>e</span>
<span>」、</span>
<span>「</span>
<span>USB Programmer Driver Ver. 2.2 (Win64</span>
<span>)</span>
<span>」をダウンロードできます。</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://www.arrow.com/en/products/max1000/arrow-development-tools">
<span><u>https://www.arrow.com/en/products/max1000/arrow-development-tools</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>MAX1000 User Guide&nbsp;:</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://www.arrow.com/en/products/max1000/arrow-development-tools/~/media/f19115ca0929486c9e09fc138b8c7c81.ashx?h=16&amp;thn=1&amp;w=16">
<span><u>https://www.arrow.com/en/products/max1000/arrow-development-tools/~/media/f19115ca0929486c9e09fc138b8c7c81.ashx?h=16&amp;thn=1&amp;w=16</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>USB Programmer Driver Ver. 2.2 (Win64)&nbsp;:</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://www.arrow.com/en/products/max1000/arrow-development-tools/-/media/e0151a61f1d844378206d2db77f3f259.ashx?h=16&amp;thn=1&amp;w=16">
<span><u>https://www.arrow.com/en/products/max1000/arrow-development-tools/-/media/e0151a61f1d844378206d2db77f3f259.ashx?h=16&amp;thn=1&amp;w=16</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000139.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ダウンロードした</span>
<span>「</span>
<span>Arrow_USB_Programmer_22_win64.zi</span>
<span>p</span>
<span>」を解凍して、</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Arrow-USB-Blaster-Setup-2.2.ex</span>
<span>e</span>
<span>」を実行してインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>3.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-10"><b>
<span><b>プロジェクトを作成</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>開発環境と評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0</span>
<span>の確認のため、簡単なプログラム</span>
<span>を</span>
<span>FPG</span>
<span>A</span>
<span>に書き込んでみます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Fil</span>
<span>e</span>
<span>」メニューから</span>
<span>「</span>
<span>New Project Wizards</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000032.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000011.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000051.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000172.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000140.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Famil</span>
<span>y</span>
<span>」に</span>
<span>「</span>
<span>MAX 1</span>
<span>0</span>
<span>」を選択し、</span>
<span>「</span>
<span>Name filte</span>
<span>r</span>
<span>」に</span>
<span>「</span>
<span>10M08SAU169C8</span>
<span>G</span>
<span>」を入力します。</span>
<span>「</span>
<span>Available device</span>
<span>s</span>
<span>」で</span>
<span>「</span>
<span>10M08SAU169C8</span>
<span>G</span>
<span>」が選択されていることを確認して</span>
<span>「</span>
<span>Next&nbsp;</span>
<span>&gt;</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000198.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000174.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000029.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>空のプロジェクトができました。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>3.4</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-11"><b>
<span><b>トップモジュールを追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Fil</span>
<span>e</span>
<span>」メニューから</span>
<span>「</span>
<span>New</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000143.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>空のファイルが表示されるので、</span>
<span>「</span>
<span>Fil</span>
<span>e</span>
<span>」メニューから</span>
<span>「</span>
<span>Save As</span>
<span>...</span>
<span>」をクリックし、名前を付けて保存します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000157.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000170.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>プロジェクトに空のトップモジュール</span>
<span>「</span>
<span>top.</span>
<span>v</span>
<span>」が追加されました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000083.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>空のトップモジュール</span>
<span>「</span>
<span>top.</span>
<span>v</span>
<span>」に次の内容を入力し、</span>
<span>「</span>
<span>Fil</span>
<span>e</span>
<span>」メニューから</span>
<span>「</span>
<span>Sav</span>
<span>e</span>
<span>」をクリックし保存します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>`timescale 1 ps / 1 ps</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>module&nbsp;top</span>
 &nbsp;</p>
<p>&nbsp;<span>(</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire CLK,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>output wire [7:0] LED</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [31:0] counter;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge CLK) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>counter &lt;= counter + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>assign LED = counter[25 -: 8];</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>endmodule</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Analysis &amp; Synthesi</span>
<span>s</span>
<span>」を右クリックして</span>
<span>「</span>
<span>Star</span>
<span>t</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000090.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Analysis &amp; Synthesi</span>
<span>s</span>
<span>」がエラー無く終了したことを確認します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000137.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>3.5</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-12"><b>
<span><b>ピン配置（クロック</b></span>
<span><b>、</b></span>
<span><b>LE</b></span>
<span><b>D</b></span>
<span><b>）</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0</span>
<span>のクロック</span>
<span>と</span>
<span>LE</span>
<span>D</span>
<span>のピン番号は次のようになっています。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>CLK (H6)</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000177.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>LED[7:0] (D8,&nbsp;C10,&nbsp;C9,&nbsp;B10,&nbsp;A10,&nbsp;A11,&nbsp;A9, A8)</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000141.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Assignment</span>
<span>s</span>
<span>」メニューから</span>
<span>「</span>
<span>Pin Planne</span>
<span>r</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Locatio</span>
<span>n</span>
<span>」と</span>
<span>「</span>
<span>I/O Standar</span>
<span>d</span>
<span>」を次のように入力して</span>
<span>「</span>
<span>Pin Planne</span>
<span>r</span>
<span>」を閉じます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000064.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>3.6</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-13"><b>
<span><b>書き込み</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>「</span>
<span>Compile Desig</span>
<span>n</span>
<span>」を右クリックして</span>
<span>「</span>
<span>Star</span>
<span>t</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000109.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Compile Desig</span>
<span>n</span>
<span>」がエラー無く終了したことを確認します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000079.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Program Device (Open Programmer</span>
<span>)</span>
<span>」を右クリックして</span>
<span>「</span>
<span>Ope</span>
<span>n</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000197.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Star</span>
<span>t</span>
<span>」をクリックし</span>
<span>て</span>
<span>FPG</span>
<span>A</span>
<span>に書き込みます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000049.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>書き込みが終了すると、評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0の</span>
<span>LE</span>
<span>D</span>
<span>がカウンタの値で点滅し続けます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000112.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>FLAS</span>
<span>H</span>
<span>メモリに書き込めば、電源を切ってもコンフィグレーションが消えないようにできます</span>
<span>。</span>
<span>top.so</span>
<span>fを</span>
<span>top.po</span>
<span>f</span>
<span>に替えて書き込みます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000138.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000169.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000017.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>4</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-14"><b>
<span><b>新しいソリューションを作成</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>新しいソリューションを作成し</span>
<span>、</span>
<span>GitHu</span>
<span>b</span>
<span>で公開しているライブラリを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>4.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-15"><b>
<span><b>ソースコードをダウンロード</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>GitHu</span>
<span>b</span>
<span>で公開している</span>
<span>、</span>
<span>C</span>
<span>#</span>
<span>で「リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>」を操作するためのライブラリをダウンロードします。</span>
 &nbsp;</p>
<p>&nbsp;<a href="https://github.com/Rapidnack/PigpiodIfTest">
<span><u>https://github.com/Rapidnack/PigpiodIfTest</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<span>本書で作成す</span>
<span>る</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションのソースコードも含まれています。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000081.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ダウンロードし</span>
<span>た</span>
<span>ZI</span>
<span>P</span>
<span>ファイルを解凍します。解凍したフォルダーにあるライブラリプロジェクト</span>
<span>「</span>
<span>Rapidnack.Commo</span>
<span>n</span>
<span>」と</span>
<span>「</span>
<span>Rapidnack.Ne</span>
<span>t</span>
<span>」を使って新規</span>
<span>に</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションを作成していきます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000045.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>4.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-16"><b>
<span><b>すぐ試してみたい場合は</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>解凍したフォルダーには本書で作成す</span>
<span>る</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションのソースコードが入っているので、新規</span>
<span>に</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションを作成する前</span>
<span>に</span>
<span>Raspberry P</span>
<span>i</span>
<span>で動作させることができます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>FPG</span>
<span>A</span>
<span>のコンフィグレーションファイルも解凍したフォルダーに入っているので</span>
<span>、</span>
<span>Quartus Prime Lite Editio</span>
<span>nの</span>
<span>Programme</span>
<span>r</span>
<span>を起動して書き込みます。</span>
 &nbsp;</p>
<p>&nbsp;<span>●</span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<span>解凍したフォルダ</span>
<span>ー</span>
<span>¥PigpiodIfTest-master¥Max10Graph¥FPGA¥MAX1000¥output_files¥top.sof</span>
 &nbsp;</p>
<p>&nbsp;<span>●</span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<span>解凍したフォルダ</span>
<span>ー</span>
<span>¥PigpiodIfTest-master¥Max10Graph¥FPGA¥MAX1000¥output_files¥top.pof</span>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-67">
<span><u>Raspberry P</u></span>
<span><u>i</u></span>
<span><u>と評価ボードを接続</u></span>
</a>
<span>、</span>
<a href="#calibre_link-68">
<span><u>Raspberry P</u></span>
<span><u>i</u></span>
<span><u>と評価ボードを接続</u></span>
</a>
<span>を参照し</span>
<span>て</span>
<span>Raspberry P</span>
<span>i</span>
<span>と評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0</span>
<span>を接続します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>解凍したフォルダーにあ</span>
<span>る</span>
<span>Max10Graph.sl</span>
<span>nを</span>
<span>Visual Studi</span>
<span>o</span>
<span>で開きます。ソリューションエクスプローラでプロジェク</span>
<span>ト</span>
<span>Max10Grap</span>
<span>h</span>
<span>を右クリック、「スタートアッププロジェクトに設</span>
<span>定</span>
<span>(A</span>
<span>)</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000156.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>NuGe</span>
<span>t</span>
<span>パッケージを復元するため一度ソリューションをビルドします。ビルドに失敗する場合は、下記の手順</span>
<span>で</span>
<span>OxyPlot.WindowsForm</span>
<span>s</span>
<span>パッケージ</span>
<span>と</span>
<span>OxyPlot.Cor</span>
<span>e</span>
<span>パッケージをインストールし直してください。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000102.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>OxyPlot.WindowsForm</span>
<span>s</span>
<span>パッケージ</span>
<span>と</span>
<span>OxyPlot.Cor</span>
<span>e</span>
<span>パッケージをアンインストールします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000186.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<img src="images/000104.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>改め</span>
<span>て</span>
<span>OxyPlot.WindowsForm</span>
<span>s</span>
<span>パッケージを検索してインストールします</span>
<span>。</span>
<span>OxyPlot.Cor</span>
<span>e</span>
<span>パッケージも一緒にインストールされます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000087.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>前々作</span>
<span>「</span>
<span>Visual Studio C</span>
<span>#で</span>
<span>Raspberry Pi</span>
<span>&nbsp;</span>
<span>リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>導入編」でセットアップし</span>
<span>た</span>
<span>Raspberry P</span>
<span>i</span>
<span>の電源を入れておきます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ビルドして実行します</span>
<span>。</span>
<span>I</span>
<span>P</span>
<span>アドレスに</span>
<span>「</span>
<span>raspberrypi.loca</span>
<span>l</span>
<span>」を入力したときは最初の接続に失敗することがあります。接続できないときは一</span>
<span>度</span>
<span>Clos</span>
<span>e</span>
<span>して再</span>
<span>度</span>
<span>Ope</span>
<span>n</span>
<span>してみてください。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000130.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>動作を確認できたなら、前作</span>
<span>「</span>
<span>Visual Studio C</span>
<span>#で</span>
<span>Raspberry Pi</span>
<span>&nbsp;</span>
<span>リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>導入編」を参照して</span>
<span>、</span>
<span>Raspberry P</span>
<span>i</span>
<span>で実行してください。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>KIOS</span>
<span>K</span>
<span>モードのセットアップを変更する必要があります。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>vi ~/.config/lxsession/LXDE-pi/autostart</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>~/.config/lxsession/LXDE-pi/autostar</span>
<span>t</span>
<span>の内容：</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>@lxpanel --profile LXDE-pi</span>
 &nbsp;</p>
<p>&nbsp;<span>@pcmanfm --desktop --profile LXDE-pi</span>
 &nbsp;</p>
<p>&nbsp;<span>@xscreensaver -no-splash</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>@xset s off</span>
 &nbsp;</p>
<p>&nbsp;<span>@xset -dpms</span>
 &nbsp;</p>
<p>&nbsp;<span>@xset s noblank</span>
 &nbsp;</p>
<p>&nbsp;<span>@unclutter</span>
 &nbsp;</p>
<p>&nbsp;<span>@mono /home/pi/Projects/</span>
<span>PigpiodIfTest-master</span>
<span>/</span>
<span>Max10Graph</span>
<span>/bin/Debug/</span>
<span>Max10Graph</span>
<span>.exe</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000181.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>4.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-17"><b>
<span><b>新しいソリューションを作成</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>フレームワーク</span>
<span>に</span>
<span>.NET Framework 4.</span>
<span>5</span>
<span>以上を選択して新しいプロジェクト</span>
<span>「</span>
<span>Max10Grap</span>
<span>h</span>
<span>」を作成します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000042.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>4.4</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-18"><b>
<span><b>ライブラリプロジェクトを追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>ソリューションエクスプローラでソリューションを右クリックし、「エクスプローラでフォルダーを開</span>
<span>く</span>
<span>(X</span>
<span>)</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000077.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>表示されたフォルダーに</span>
<span>、</span>
<span>GitHu</span>
<span>b</span>
<span>からダウンロードしたライブラリプロジェクト</span>
<span>「</span>
<span>Rapidnack.Commo</span>
<span>n</span>
<span>」と</span>
<span>「</span>
<span>Rapidnack.Ne</span>
<span>t</span>
<span>」をコピーします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000123.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ライブラリプロジェクト</span>
<span>「</span>
<span>Rapidnack.Commo</span>
<span>n</span>
<span>」と</span>
<span>「</span>
<span>Rapidnack.Ne</span>
<span>t</span>
<span>」をソリューションに追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000163.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000097.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000013.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ソリューションに追加されました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000188.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>プロジェクト</span>
<span>「</span>
<span>Max10Grap</span>
<span>h</span>
<span>」の「参照」を右クリックして、「参照を追加</span>
<span>（R</span>
<span>）」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000195.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ライブラリプロジェクト</span>
<span>「</span>
<span>Rapidnack.Commo</span>
<span>n</span>
<span>」と</span>
<span>「</span>
<span>Rapidnack.Ne</span>
<span>t</span>
<span>」の参照をプロジェクト</span>
<span>「</span>
<span>Max10Grap</span>
<span>h</span>
<span>」に追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000185.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>4.5</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-19"><b>
<span><b>ログ出力</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>ライブラリプロジェクト</span>
<span>「</span>
<span>Rapidnack.Commo</span>
<span>n</span>
<span>」をソリューションに追加してビルドすると、ツールボックス</span>
<span>に</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>コントロールが追加され、フォームに追加できるようになります。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000028.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>フォーム</span>
<span>に</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>を追加すると</span>
<span>、</span>
<span>System.Console.Write(</span>
<span>)、</span>
<span>System.Console.WriteLine(</span>
<span>)</span>
<span>の出力</span>
<span>が</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>に表示されるようになります。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>まず、フォームサイズなど</span>
<span>を</span>
<span>Raspberry P</span>
<span>iの</span>
<span>LC</span>
<span>D</span>
<span>のサイズに合わせておきます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000072.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000114.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>フォームの左側にボタンなどを載せるパネルを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000009.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000005.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>残りの部分</span>
<span>に</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>を配置します。ログ表示用なの</span>
<span>で</span>
<span>Multilin</span>
<span>e、</span>
<span>ReadOnl</span>
<span>y</span>
<span>にして、見易いよう</span>
<span>に</span>
<span>BackColo</span>
<span>r</span>
<span>プロパティ</span>
<span>を</span>
<span>Windo</span>
<span>w</span>
<span>に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000046.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000153.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000015.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>パネルにボタンを追加して試してみます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000089.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;button1_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;i = 0; i &lt; 10; i++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>"i = {0}"</span>
<span>, i);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000020.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>4.6</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-20"><b>
<span><b>例外対策</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>わざと例外が発生するコードを実行してみます。配列の範囲外をアクセスします。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;button1_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>[] data =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>int</span>
<span>[] { 0, 1, 4, 9, 16 };</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;i = 0; i &lt; 10; i++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>"data[{0}] = {1}"</span>
<span>, i, data[i]);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「デバッ</span>
<span>グ</span>
<span>(D</span>
<span>)</span>
<span>」メニューから「デバッグなしで開</span>
<span>始</span>
<span>(H</span>
<span>)</span>
<span>」をクリックすると、次のエラーダイアログが表示されます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000003.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000120.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>エラーダイアログの代わりに例外の情報</span>
<span>を</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>に表示するよう</span>
<span>に</span>
<span>Program.c</span>
<span>s</span>
<span>を変更します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;System;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Windows.Forms;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Max10Graph</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>static class&nbsp;</span>
<span>Program</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>///</span>
<span>&nbsp;</span>
<span>&lt;summary&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>///</span>
<span>&nbsp;アプリケーションのメイン&nbsp;エントリ&nbsp;ポイントです。</span>
 &nbsp;</p>
<p>&nbsp;<span>///</span>
<span>&nbsp;</span>
<span>&lt;/summary&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>[STAThread]</span>
 &nbsp;</p>
<p>&nbsp;<span>static</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Main()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.ThreadException += (s, e) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
 &nbsp;</p>
<p>&nbsp;<span>"{0}, {1}¥r¥n{2}¥r¥n"</span>
<span>, e.Exception.TargetSite, e.Exception.Message, e.Exception.StackTrace);</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>AppDomain.CurrentDomain.UnhandledException += (s, e) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Exception ex = e.ExceptionObject&nbsp;</span>
<span>as</span>
<span>&nbsp;Exception;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(ex !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
 &nbsp;</p>
<p>&nbsp;<span>"{0}, {1}¥r¥n{2}¥r¥n"</span>
<span>, ex.TargetSite, ex.Message, ex.StackTrace);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.EnableVisualStyles();</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.SetCompatibleTextRenderingDefault(</span>
<span>false</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.Run(</span>
<span>new</span>
<span>&nbsp;MainForm());</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「デバッ</span>
<span>グ</span>
<span>(D</span>
<span>)</span>
<span>」メニューから「デバッグなしで開</span>
<span>始</span>
<span>(H</span>
<span>)</span>
<span>」をクリックすると、例外の情報</span>
<span>が</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>に表示されます。通常はログファイルに出力するようにしますが、本書で</span>
<span>は</span>
<span>Raspberry P</span>
<span>i</span>
<span>のファイルシステムを</span>
<span>「</span>
<span>Read-only Root-F</span>
<span>S</span>
<span>」にするので画面に表示することにしました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000154.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>追加したボタ</span>
<span>ン</span>
<span>button</span>
<span>1</span>
<span>とそのイベントハンド</span>
<span>ラ</span>
<span>button1_Click(</span>
<span>)</span>
<span>は不要なので削除しておきます。</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>5</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-21"><b>
<span><b>PigpiodI</b></span>
<span><b>f</b></span>
<span><b>クラス</b></span>
</b></a>
</b></h1>
<p>&nbsp;<img src="images/000196.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>C</span>
<span>#</span>
<span>で「リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>」を操作するためのクラ</span>
<span>ス</span>
<span>PigpiodI</span>
<span>f</span>
<span>を使って</span>
<span>、</span>
<span>Raspberry P</span>
<span>iの</span>
<span>GPI</span>
<span>O</span>
<span>を操作してみます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000039.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>5.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-22"><b>
<span><b>PigpiodI</b></span>
<span><b>f</b></span>
<span><b>を追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>Raspberry P</span>
<span>i</span>
<span>との接続に使</span>
<span>う</span>
<span>I</span>
<span>P</span>
<span>アドレス入力フィールド</span>
<span>、</span>
<span>Ope</span>
<span>n</span>
<span>ボタン</span>
<span>、</span>
<span>Clos</span>
<span>e</span>
<span>ボタンをパネルに追加します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span><b>Type</b></span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span><b>(Name)</b></span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span><b>Text</b></span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>TextBox</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>textBoxAddress</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>Button</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>buttonOpen</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>Open</span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>Button</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>buttonClose</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>Close</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000171.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>GPI</span>
<span>O</span>
<span>を操作するボタン等を配置するパネルを追加します</span>
<span>。</span>
<span>Raspberry P</span>
<span>i</span>
<span>との接続状態に合わせて有効・無効を切り替えるので名前を付けておきます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span><b>Type</b></span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span><b>(Name)</b></span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>Panel</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>panelOperation</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000129.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000004.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Form1_Load(</span>
<span>)</span>
<span>イベントハンドラでクラ</span>
<span>ス</span>
<span>PigpiodI</span>
<span>f</span>
<span>のインスタンスを生成</span>
<span>、</span>
<span>buttonOpen_Click&nbsp;(</span>
<span>)</span>
<span>イベントハンドラ</span>
<span>で</span>
<span>Raspberry P</span>
<span>i</span>
<span>と接続</span>
<span>、</span>
<span>buttonClose_Click(</span>
<span>)</span>
<span>イベントハンドラで接続を切ります。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Windows.Forms;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Max10Graph</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>partial</span>
<span>&nbsp;</span>
<span>class</span>
<span>&nbsp;</span>
<span>Form1</span>
<span>&nbsp;: Form</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;PigpiodIf pigpiodIf;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;Form1()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>InitializeComponent();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;CloseConnection()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_stop();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf =&nbsp;</span>
<span>new</span>
<span>&nbsp;PigpiodIf();</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.StreamConnected&nbsp;+= (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_FormClosing(</span>
<span>object</span>
<span>&nbsp;sender, FormClosingEventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonOpen_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_start(textBoxAddress.Text,&nbsp;</span>
<span>"8888"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonClose_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Raspberry P</span>
<span>i</span>
<span>に接続したときパネ</span>
<span>ル</span>
<span>panelOperatio</span>
<span>n</span>
<span>を有効にするため</span>
<span>、</span>
<span>PigpiodI</span>
<span>f</span>
<span>のイベン</span>
<span>ト</span>
<span>StreamConnecte</span>
<span>d</span>
<span>にイベントハンドラを登録しています。イベン</span>
<span>ト</span>
<span>StreamConnecte</span>
<span>d</span>
<span>はアプリケーション</span>
<span>の</span>
<span>GU</span>
<span>I</span>
<span>スレッドとは別のスレッドで呼ばれるため、イベントハンドラの中</span>
<span>で</span>
<span>GU</span>
<span>I</span>
<span>を変更する場合</span>
<span>は</span>
<span>Invoke(</span>
<span>)</span>
<span>を使っ</span>
<span>て</span>
<span>GU</span>
<span>I</span>
<span>スレッドにして実行します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>pigpiodIf.StreamConnected&nbsp;+= (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// GU</span>
<span>I</span>
<span>を変更</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Raspberry P</span>
<span>iの</span>
<span>I</span>
<span>P</span>
<span>アドレスまたは</span>
<span>「</span>
<span>raspberrypi.loca</span>
<span>l</span>
<span>」を入力して</span>
<span>「</span>
<span>Ope</span>
<span>n</span>
<span>」をクリックします</span>
<span>。</span>
<span>I</span>
<span>P</span>
<span>アドレスに</span>
<span>「</span>
<span>raspberrypi.loca</span>
<span>l</span>
<span>」を入力したときは最初の接続に失敗することがあります。接続できないときは一</span>
<span>度</span>
<span>Clos</span>
<span>e</span>
<span>して再</span>
<span>度</span>
<span>Ope</span>
<span>n</span>
<span>してみてください。</span>
 &nbsp;</p>
<p>&nbsp;<span>2</span>
<span>回接続メッセージが表示されますが、これ</span>
<span>は</span>
<span>pigpio</span>
<span>d</span>
<span>がコマンド用の接続とは別にピンの値が変化したこと通知する接続も使うためです。</span>
<span>「</span>
<span>Clos</span>
<span>e</span>
<span>」をクリックすると両方の接続が切れます</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000066.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>5.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-23"><b>
<span><b>GPI</b></span>
<span><b>OでL</b></span>
<span><b>チカ</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>LE</span>
<span>D</span>
<span>と抵抗をピン</span>
<span>「</span>
<span>BCM&nbsp;</span>
<span>5</span>
<span>」</span>
<span>と</span>
<span>GN</span>
<span>D</span>
<span>に接続し、１秒周期で点滅させます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000159.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>PiGpiodI</span>
<span>f</span>
<span>クラスのメソッ</span>
<span>ド</span>
<span>gpio_write(</span>
<span>)</span>
<span>を使います。機能の詳細は</span>
<a href="http://abyz.me.uk/rpi/pigpio/pdif2.html">
<span><u>http://abyz.me.uk/rpi/pigpio/pdif2.html</u></span>
</a>
<span>を、使い方はテストコー</span>
<span>ド</span>
<span>Rapidnack.Ne</span>
<span>t</span>
<span>フォルダーにあ</span>
<span>る</span>
<span>XPigpiodIf.c</span>
<span>sの</span>
<span>t1(</span>
<span>)</span>
<span>を参考にしてください。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>LED Star</span>
<span>t</span>
<span>ボタン</span>
<span>、</span>
<span>LED Sto</span>
<span>p</span>
<span>ボタンをパネ</span>
<span>ル</span>
<span>panelOperatio</span>
<span>n</span>
<span>に追加します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span><b>Type</b></span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span><b>(Name)</b></span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span><b>Text</b></span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>Button</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>buttonStart</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>Start</span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>Button</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>buttonStop</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>Stop</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000095.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading.Tasks;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Windows.Forms;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Max10Graph</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>partial</span>
<span>&nbsp;</span>
<span>class</span>
<span>&nbsp;</span>
<span>Form1</span>
<span>&nbsp;: Form</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;PigpiodIf pigpiodIf;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;LED = 5;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource cts;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;Form1()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>InitializeComponent();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;CloseConnection()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(cts !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.DoEvents();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_stop();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf =&nbsp;</span>
<span>new</span>
<span>&nbsp;PigpiodIf();</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.StreamConnected&nbsp;+= (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_FormClosing(</span>
<span>object</span>
<span>&nbsp;sender, FormClosingEventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonOpen_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_start(textBoxAddress.Text,&nbsp;</span>
<span>"8888"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonClose_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = cts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.gpio_write(LED, PigpiodIf.PI_HIGH);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.gpio_write(LED, PigpiodIf.PI_LOW);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>スタートボタンをクリックして繰り返し動作を開始、ストップボタンをクリックして終了、というパターンには、次のコードが便利です。スレッドを明示的に作らずに済みます。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading.Tasks;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource&nbsp;cts;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct =&nbsp;cts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>繰り返し動作</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>5.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-24"><b>
<span><b>サーボパルスを出力</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>Raspberry P</span>
<span>i</span>
<span>のリモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>は任意</span>
<span>の</span>
<span>GPI</span>
<span>O</span>
<span>ピンからサーボパルスを出力できます。本書ではピン</span>
<span>「</span>
<span>BCM 1</span>
<span>2</span>
<span>」とピン</span>
<span>「</span>
<span>BCM 1</span>
<span>3</span>
<span>」を使います。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000010.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>PiGpiodI</span>
<span>f</span>
<span>クラスのメソッ</span>
<span>ド</span>
<span>set_servo_pulsewidth(</span>
<span>)</span>
<span>を使います。機能の詳細は</span>
<a href="http://abyz.me.uk/rpi/pigpio/pdif2.html">
<span><u>http://abyz.me.uk/rpi/pigpio/pdif2.html</u></span>
</a>
<span>を、使い方はテストコー</span>
<span>ド</span>
<span>Rapidnack.Ne</span>
<span>t</span>
<span>フォルダーにあ</span>
<span>る</span>
<span>XPigpiodIf.c</span>
<span>sの</span>
<span>t3(</span>
<span>)</span>
<span>を参考にしてください。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>チェックボックスとトラックバー</span>
<span>を2</span>
<span>組パネルに追加します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span><b>Type</b></span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span><b>(Name)</b></span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>CheckBox</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>checkBoxServo1</span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>CheckBox</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>checkBoxServo2</span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>TrackBar</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>trackBarServo1</span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>TrackBar</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>trackBarServo2</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000125.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>トラックバーの範囲</span>
<span>は</span>
<span>500~250</span>
<span>0</span>
<span>で初期値</span>
<span>は</span>
<span>150</span>
<span>0</span>
<span>です。サーボモーターの角度</span>
<span>は</span>
<span>50</span>
<span>0で</span>
<span>-9</span>
<span>0</span>
<span>°</span>
<span>、</span>
<span>150</span>
<span>0で0</span>
<span>°</span>
<span>、</span>
<span>250</span>
<span>0で</span>
<span>+9</span>
<span>0</span>
<span>°になります。値</span>
<span>を0</span>
<span>にするとサーボパルス出力が停止します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000161.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading.Tasks;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Windows.Forms;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Max10Graph</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public partial class&nbsp;</span>
<span>Form1</span>
<span>&nbsp;: Form</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_1 =&nbsp;12;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_2 = 13;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf =&nbsp;</span>
<span>new</span>
<span>&nbsp;PigpiodIf();</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.StreamConnected&nbsp;+= (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo1_CheckedChanged(checkBoxServo1,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo2_CheckedChanged(checkBoxServo2,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;checkBoxServo1_CheckedChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo1.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, (UInt32)trackBarServo1.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo1_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo1.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, (UInt32)trackBarServo1.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo1.Checked =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;checkBoxServo2_CheckedChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo2.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, (UInt32)trackBarServo2.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo2_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo2.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, (UInt32)trackBarServo2.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo2.Checked =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Raspberry P</span>
<span>i</span>
<span>に接続したときサーボパルス出力をチェックボックスとトラックバーの状態に合わせるため</span>
<span>、</span>
<span>PigpiodI</span>
<span>f</span>
<span>のイベン</span>
<span>ト</span>
<span>StreamConnecte</span>
<span>d</span>
<span>にイベントハンドラを登録しています。イベン</span>
<span>ト</span>
<span>StreamConnecte</span>
<span>d</span>
<span>はアプリケーション</span>
<span>の</span>
<span>GU</span>
<span>I</span>
<span>スレッドとは別のスレッドで呼ばれるため、イベントハンドラの中</span>
<span>で</span>
<span>GU</span>
<span>I</span>
<span>を変更する場合</span>
<span>は</span>
<span>Invoke(</span>
<span>)</span>
<span>を使っ</span>
<span>て</span>
<span>GU</span>
<span>I</span>
<span>スレッドにして実行します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>pigpiodIf.StreamConnected&nbsp;+= (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo1_CheckedChanged(checkBoxServo1,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo2_CheckedChanged(checkBoxServo2,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ピン</span>
<span>「</span>
<span>BCM 1</span>
<span>2</span>
<span>」</span>
<span>に</span>
<span>250</span>
<span>0</span>
<span>、ピン</span>
<span>「</span>
<span>BCM 1</span>
<span>3</span>
<span>」</span>
<span>に</span>
<span>150</span>
<span>0</span>
<span>をセットしたときのサーボパルスをオシロスコープで確認しました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000025.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000063.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ピン</span>
<span>「</span>
<span>BCM 1</span>
<span>2</span>
<span>」</span>
<span>に</span>
<span>250</span>
<span>0</span>
<span>、ピン</span>
<span>「</span>
<span>BCM 1</span>
<span>3</span>
<span>」</span>
<span>に</span>
<span>50</span>
<span>0</span>
<span>をセットしたときのサーボパルスをオシロスコープで確認しました。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000039.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000189.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>6</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-25"><b>
<span><b>SPI Slave to Avalon Master Bridge</b></span>
</b></a>
</b></h1>
<p>&nbsp;<img src="images/000092.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>Intel FPG</span>
<span>A</span>
<span>は標準で用意されてい</span>
<span>る</span>
<span>SPI Slave to Avalon Master Bridge&nbsp;I</span>
<span>P</span>
<span>コアを追加すると</span>
<span>、</span>
<span>SP</span>
<span>I</span>
<span>マスター機能を持っ</span>
<span>た</span>
<span>Raspberry P</span>
<span>i</span>
<span>等か</span>
<span>ら</span>
<span>FPG</span>
<span>A</span>
<span>内部を制御できるようになります。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000007.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>6.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-67"><b></b></a>
<a id="calibre_link-26"><b>
<span><b>Raspberry P</b></span>
<span><b>i</b></span>
<span><b>と評価ボードを接続</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>SPI</span>
<span>0</span>
<span>は小</span>
<span>型</span>
<span>LC</span>
<span>D</span>
<span>が使用するので</span>
<span>、</span>
<span>SPI</span>
<span>1に</span>
<span>FPG</span>
<span>A</span>
<span>を接続します。ジャンパーケーブルではグランドの接続が弱いの</span>
<span>で2</span>
<span>本のグランドピン</span>
<span>で</span>
<span>Raspberry P</span>
<span>iと</span>
<span>FPG</span>
<span>A</span>
<span>を接続しておきます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000121.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>FPG</span>
<span>A</span>
<span>側は</span>
<span>、</span>
<span>arrow.co</span>
<span>m</span>
<span>の評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0の</span>
<span>PMO</span>
<span>D</span>
<span>ソケットを使います。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000093.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>6.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-27"><b>
<span><b>Raspberry Pi&nbsp;SPI</b></span>
<span><b>1</b></span>
<span><b>の不具合</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>SPI</span>
<span>0</span>
<span>のクロックとデータのタイミングはモード０～モード３全</span>
<span>部</span>
<span>O</span>
<span>K</span>
<span>ですが</span>
<span>、</span>
<span>SPI</span>
<span>1</span>
<span>のクロックとデータのタイミングはモード０とモード２だ</span>
<span>け</span>
<span>O</span>
<span>K</span>
<span>です。モード１とモード３はデータがクロックよ</span>
<span>り1</span>
<span>クロック分進んでしまっています。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>SPI</span>
<span>0</span>
<span>モード１</span>
<span>：</span>
<span>OK</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000147.jpg" alt="http://rapidack.sakura.ne.jp/ttl/wp-content/uploads/2018/09/TEK0005.bmp" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>SPI</span>
<span>1</span>
<span>モード１</span>
<span>：</span>
<span>N</span>
<span>G</span>
<span>（データがクロックよ</span>
<span>り1</span>
<span>クロック分進んでしまっています）</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000128.jpg" alt="http://rapidack.sakura.ne.jp/ttl/wp-content/uploads/2018/09/TEK0001.bmp" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>SPI</span>
<span>0</span>
<span>モード３</span>
<span>：</span>
<span>OK</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000096.jpg" alt="http://rapidack.sakura.ne.jp/ttl/wp-content/uploads/2018/09/TEK0007.bmp" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>SPI</span>
<span>1</span>
<span>モード３</span>
<span>：</span>
<span>N</span>
<span>G</span>
<span>（データがクロックよ</span>
<span>り1</span>
<span>クロック分進んでしまっています）</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000105.jpg" alt="http://rapidack.sakura.ne.jp/ttl/wp-content/uploads/2018/09/TEK0003.bmp" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>SPI Slave to Avalon Master Bridge&nbsp;I</span>
<span>P</span>
<span>コアはモー</span>
<span>ド1</span>
<span>を使用するので</span>
<span>、</span>
<span>FPG</span>
<span>A</span>
<span>側でデータ</span>
<span>を1</span>
<span>クロック分遅らせて対応します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>6.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-28"><b>
<span><b>ALTPL</b></span>
<span><b>L</b></span>
<span><b>を追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>プロジェクト</span>
<span>に</span>
<span>ALTPL</span>
<span>L</span>
<span>を追加して、評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0の</span>
<span>12MH</span>
<span>z</span>
<span>クロックから、モジュラ</span>
<span>ー</span>
<span>ADC I</span>
<span>P</span>
<span>コア用</span>
<span>の</span>
<span>10MH</span>
<span>z</span>
<span>クロック</span>
<span>と</span>
<span>FPG</span>
<span>A</span>
<span>全体</span>
<span>の</span>
<span>50MH</span>
<span>z</span>
<span>クロックを作ります</span>
<span>。</span>
<span>Platform Designe</span>
<span>r</span>
<span>に追加することもできますが、デバッグの際トップモジュール内</span>
<span>で</span>
<span>50MH</span>
<span>z</span>
<span>クロックを使いたいのでプロジェクトに直接追加します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>IP Catalo</span>
<span>g</span>
<span>から</span>
<span>「</span>
<span>ALTPL</span>
<span>L</span>
<span>」を選択し、</span>
<span>「</span>
<span>Add</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000073.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>名前を付けて</span>
<span>「</span>
<span>O</span>
<span>K</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000116.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000016.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000183.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000058.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000122.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000086.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000002.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>プロジェクトに</span>
<span>「</span>
<span>pll.qi</span>
<span>p</span>
<span>」が追加されました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000111.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>6.4</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-29"><b>
<span><b>Platform Designer&nbsp;(Qsys</b></span>
<span><b>)</b></span>
<span><b>に追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>開発環境と評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0</span>
<span>の動作確認に使ったプロジェクトに、</span>
<span>「</span>
<span>SPI Slave to Avalon Master Bridge&nbsp;I</span>
<span>P</span>
<span>」と</span>
<span>「</span>
<span>PIO (Parallel I/O) Intel FPGA I</span>
<span>P</span>
<span>」を追加します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Tool</span>
<span>s</span>
<span>」メニューから</span>
<span>「</span>
<span>Platform Designe</span>
<span>r</span>
<span>」を起動します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000199.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>SPI Slave to Avalon Master Bridge Intel FPGA I</span>
<span>P</span>
<span>」を追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000165.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000054.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>交点をクリックして</span>
<span>「</span>
<span>cl</span>
<span>k</span>
<span>」と</span>
<span>「</span>
<span>clk_rese</span>
<span>t</span>
<span>」を接続します。</span>
<span>「</span>
<span>export_</span>
<span>0</span>
<span>」</span>
<span>は</span>
<span>SP</span>
<span>Iの</span>
<span>nss/mosi/miso/scl</span>
<span>k</span>
<span>なので、ダブルクリックして外部に公開します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000167.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>PIO (Parallel I/O) Intel FPGA I</span>
<span>P</span>
<span>」を追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000076.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ビット幅</span>
<span>を</span>
<span>3</span>
<span>2</span>
<span>ビットに変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000044.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>交点をクリックして</span>
<span>「</span>
<span>cl</span>
<span>k</span>
<span>」、</span>
<span>「</span>
<span>clk_rese</span>
<span>t</span>
<span>」、</span>
<span>「</span>
<span>Avalon-M</span>
<span>M</span>
<span>バス」を接続します。</span>
<span>「</span>
<span>external_connectio</span>
<span>n</span>
<span>」</span>
<span>は</span>
<span>I/</span>
<span>O</span>
<span>ポート（今回</span>
<span>は</span>
<span>3</span>
<span>2</span>
<span>ビット出力ポート）なので、ダブルクリックして外部に公開します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000110.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>PI</span>
<span>O</span>
<span>に割り当てられ</span>
<span>た</span>
<span>Avalon-M</span>
<span>M</span>
<span>バスのアドレスを確認しておきます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000022.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Platform Designe</span>
<span>r</span>
<span>の</span>
<span>「</span>
<span>Generat</span>
<span>e</span>
<span>」メニューから</span>
<span>「</span>
<span>Show Instantiation Template</span>
<span>...</span>
<span>」をクリックして、内容をメモ帳等にコピーしておきます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000126.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000050.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>出力フォルダーの名前を付けて</span>
<span>「</span>
<span>Generat</span>
<span>e</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000084.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000131.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>出力ファイルに名前を付けて保存します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000023.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000192.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000074.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>以上</span>
<span>で</span>
<span>Platform Designe</span>
<span>r</span>
<span>での作業は終了です。</span>
<span>「</span>
<span>Finis</span>
<span>h</span>
<span>」をクリックし</span>
<span>て</span>
<span>Platform Designe</span>
<span>r</span>
<span>を閉じます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000134.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000100.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Projec</span>
<span>t</span>
<span>」メニューから</span>
<span>「</span>
<span>Add/Remove Files in Project</span>
<span>...</span>
<span>」をクリックします。表示された</span>
<span>「</span>
<span>Setting</span>
<span>s</span>
<span>」画面で</span>
<span>「...</span>
<span>」をクリックし、ダイアログで</span>
<span>「</span>
<span>QsysCore.qsy</span>
<span>s</span>
<span>」を選択し「開</span>
<span>く</span>
<span>(O</span>
<span>)</span>
<span>」をクリック、</span>
<span>「</span>
<span>Setting</span>
<span>s</span>
<span>」画面に戻って</span>
<span>「</span>
<span>O</span>
<span>K</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000070.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>プロジェクトに</span>
<span>「</span>
<span>QsysCore.qsy</span>
<span>s</span>
<span>」が追加されました。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000040.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>トップモジュール</span>
<span>「</span>
<span>top.</span>
<span>v</span>
<span>」を次のように変更します。</span>
<span>黄色の箇所</span>
<span>は</span>
<span>Raspberry P</span>
<span>iの</span>
<span>SPI</span>
<span>1</span>
<span>の不具合に対応するためのコードです。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>`timescale 1 ps / 1 ps</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>module&nbsp;top</span>
 &nbsp;</p>
<p>&nbsp;<span>(</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire CLK,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>input wire SPI_NSS,</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire SPI_MOSI,</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire SPI_MISO,</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire SPI_SCLK,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>output wire [7:0] LED</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg spi_mosi;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire adc_clk;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire clk;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire locked;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire [31:0] pio_0;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge SPI_SCLK) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>spi_mosi &lt;= SPI_MOSI;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>pll pll_inst (</span>
 &nbsp;</p>
<p>&nbsp;<span>.inclk0 (CLK),</span>
 &nbsp;</p>
<p>&nbsp;<span>.c0 (adc_clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.c1 (clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.locked (locked)</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>QsysCore QsysCore_inst (</span>
 &nbsp;</p>
<p>&nbsp;<span>.clk_clk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.reset_reset_n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (1'b1),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_mosi_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span>
<span>spi_mosi</span>
<span>),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_nss_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SPI_NSS),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_miso_to_and_from_the_spislave_inst_for_spichain (SPI_MISO),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_sclk_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SPI_SCLK),</span>
 &nbsp;</p>
<p>&nbsp;<span>.pio_0_external_connection_export&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (pio_0)</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>assign LED = pio_0[7:0];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>endmodule</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Compile Desig</span>
<span>n</span>
<span>」を右クリックして、</span>
<span>「</span>
<span>Star</span>
<span>t</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000012.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Analysis &amp; Synthesi</span>
<span>s</span>
<span>」がエラー無く終了したことを確認します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000137.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2><b>
<span><b>6.5</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-30"><b>
<span><b>ピン配置</b></span>
<span><b>（</b></span>
<span><b>SP</b></span>
<span><b>I</b></span>
<span><b>）</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0の</span>
<span>PMO</span>
<span>D</span>
<span>ソケット</span>
<span>を</span>
<span>SP</span>
<span>I</span>
<span>で使用します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>SPI_NSS (M3), SPI_MOSI (L3), SPI_MISO (M2), SPI_SCLK (M1)</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000155.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Assignment</span>
<span>s</span>
<span>」メニューから</span>
<span>「</span>
<span>Pin Planne</span>
<span>r</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<span>追加し</span>
<span>た</span>
<span>SP</span>
<span>I</span>
<span>のピンの</span>
<span>「</span>
<span>Locatio</span>
<span>n</span>
<span>」と</span>
<span>「</span>
<span>I/O Standar</span>
<span>d</span>
<span>」を次のように入力して</span>
<span>「</span>
<span>Pin Planne</span>
<span>r</span>
<span>」を閉じます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000068.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>6.6</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-31"><b>
<span><b>書き込み</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>「</span>
<span>Compile Desig</span>
<span>n</span>
<span>」を右クリックして</span>
<span>「</span>
<span>Star</span>
<span>t</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000109.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Compile Desig</span>
<span>n</span>
<span>」がエラー無く終了したことを確認します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000079.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Program Device (Open Programmer</span>
<span>)</span>
<span>」を右クリックして</span>
<span>「</span>
<span>Ope</span>
<span>n</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000197.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Star</span>
<span>t</span>
<span>」をクリックし</span>
<span>て</span>
<span>FPG</span>
<span>A</span>
<span>に書き込みます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000049.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000112.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>以上でハードウェア側の準備が整いました。</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>7</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-32"><b>
<span><b>AvalonM</b></span>
<span><b>M</b></span>
<span><b>クラス</b></span>
</b></a>
</b></h1>
<p>&nbsp;<img src="images/000184.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>Raspberry P</span>
<span>iの</span>
<span>SP</span>
<span>I</span>
<span>から下図一番上</span>
<span>（</span>
<span>Physical Laye</span>
<span>r</span>
<span>）のバイト列を送信すると</span>
<span>、</span>
<span>FPG</span>
<span>A</span>
<span>内部</span>
<span>の</span>
<span>SPI Slave to Avalon Master Bridge&nbsp;I</span>
<span>P</span>
<span>コアから下図一番下</span>
<span>（</span>
<span>Transaction Laye</span>
<span>r</span>
<span>）のバイト列がトランザクションとして実行され</span>
<span>、</span>
<span>Avalon-M</span>
<span>M</span>
<span>バスのアドレ</span>
<span>ス</span>
<span>0x024B7A4</span>
<span>0</span>
<span>にデー</span>
<span>タ</span>
<span>0x5F03FF4</span>
<span>A</span>
<span>が書き込まれます。アドレスはビッグエンディアン、データはリトルエンディアンです。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000085.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Transaction Laye</span>
<span>r</span>
<span>のバイト列</span>
<span>を</span>
<span>SP</span>
<span>Iで</span>
<span>FPG</span>
<span>A</span>
<span>に送信す</span>
<span>る</span>
<span>Physical Laye</span>
<span>r</span>
<span>のバイト列に変換する機能と</span>
<span>、</span>
<span>FPG</span>
<span>A</span>
<span>から受信し</span>
<span>た</span>
<span>Physical Laye</span>
<span>r</span>
<span>のバイト列</span>
<span>を</span>
<span>Transaction Laye</span>
<span>r</span>
<span>のバイト列に戻す機能を持っ</span>
<span>た</span>
<span>AvalonM</span>
<span>M</span>
<span>クラスを用意しました</span>
<span>。</span>
<span>PigpiodI</span>
<span>f</span>
<span>クラスと組み合わせて使用します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>7.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-33"><b>
<span><b>AvalonM</b></span>
<span><b>M</b></span>
<span><b>を追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>PigpiodI</span>
<span>f</span>
<span>クラス</span>
<span>が</span>
<span>Raspberry P</span>
<span>i</span>
<span>と接続したとき</span>
<span>、</span>
<span>PigpiodI</span>
<span>f</span>
<span>クラス</span>
<span>の</span>
<span>SP</span>
<span>I</span>
<span>接続を使っ</span>
<span>て</span>
<span>SpiStrea</span>
<span>m</span>
<span>クラスのインスタンスを生成</span>
<span>し</span>
<span>AvalonM</span>
<span>M</span>
<span>クラスのインスタンスにセットします</span>
<span>。</span>
<span>Raspberry P</span>
<span>i</span>
<span>と切断する前</span>
<span>に</span>
<span>SpiStrea</span>
<span>m</span>
<span>クラスのインスタンスを削除します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading.Tasks;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Windows.Forms;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Max10Graph</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>partial</span>
<span>&nbsp;</span>
<span>class</span>
<span>&nbsp;</span>
<span>Form1</span>
<span>&nbsp;: Form</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;PigpiodIf pigpiodIf;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;AvalonMM avalonMM =&nbsp;</span>
<span>new</span>
<span>&nbsp;AvalonMM();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;CloseConnection()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(avalonMM.Stream !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream.Dispose();</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_stop();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf =&nbsp;</span>
<span>new</span>
<span>&nbsp;PigpiodIf();</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.StreamConnected&nbsp;+= (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// CS2, 20MHz, Auxiliary SPI + Mode1</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream =&nbsp;</span>
<span>new</span>
<span>&nbsp;SpiStream(pigpiodIf, 2, 20 * 1000000, 256 + 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(PigpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_FormClosing(</span>
<span>object</span>
<span>&nbsp;sender, FormClosingEventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonClose_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>（省略）</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>7.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-34"><b>
<span><b>AvalonM</b></span>
<span><b>MでL</b></span>
<span><b>チカ</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>GPI</span>
<span>OでL</span>
<span>チカのコードに評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0の</span>
<span>LE</span>
<span>D</span>
<span>を点滅させるコードを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = cts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.gpio_write(LED, PigpiodIf.PI_HIGH);</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(0, 0x55);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.gpio_write(LED, PigpiodIf.PI_LOW);</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(0, 0xaa);</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(500, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Raspberry P</span>
<span>i</span>
<span>のピン</span>
<span>「</span>
<span>BCM&nbsp;</span>
<span>5</span>
<span>」接続し</span>
<span>た</span>
<span>LE</span>
<span>D</span>
<span>と一緒に、評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0の</span>
<span>LE</span>
<span>D</span>
<span>も点滅し続けます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000056.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>8</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-35"><b>
<span><b>MyBasicStorag</b></span>
<span><b>e</b></span>
<span><b>コンポーネント</b></span>
</b></a>
</b></h1>
<p>&nbsp;<img src="images/000127.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>FPG</span>
<span>A</span>
<span>内部に作ったカウンタの出力を連続してメモリに書き込んで</span>
<span>、</span>
<span>Raspberry P</span>
<span>i</span>
<span>から纏めて読み出せ</span>
<span>る</span>
<span>Platform Designe</span>
<span>r（</span>
<span>Qsy</span>
<span>s</span>
<span>）コンポーネントを作ります。後でカウンタをモジュラ</span>
<span>ー</span>
<span>ADC I</span>
<span>P</span>
<span>コアに、表示をグラフに置き換えます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000000.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2><b>
<span><b>8.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-68"><b></b></a>
<a id="calibre_link-36"><b>
<span><b>Raspberry P</b></span>
<span><b>i</b></span>
<span><b>と評価ボードを接続</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>メモリ全体にデータが書き込まれてこ</span>
<span>と</span>
<span>Raspberry P</span>
<span>i</span>
<span>に伝えるための信号線</span>
<span>を1</span>
<span>本追加します</span>
<span>。</span>
<span>Raspberry P</span>
<span>i</span>
<span>と評価ボードの下図のピンを接続します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000162.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000065.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>8.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-37"><b>
<span><b>メモリを作成</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>連続したデータを書き込むメモリを用意します</span>
<span>。</span>
<span>Avalon-S</span>
<span>T</span>
<span>インターフェースから入力したデータを書き込んで</span>
<span>、</span>
<span>Raspberry P</span>
<span>i</span>
<span>か</span>
<span>ら</span>
<span>Avalon-M</span>
<span>M</span>
<span>バス経由で読み出されるので、２ポートメモリを選択します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000180.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>1</span>
<span>6</span>
<span>ビット幅のデータ</span>
<span>を2</span>
<span>チャンネル分欲しいので、メモリのサイズ</span>
<span>は</span>
<span>3</span>
<span>2</span>
<span>ビット</span>
<span>幅</span>
<span>51</span>
<span>2</span>
<span>ワードとします。</span>
 &nbsp;</p>
<p>&nbsp;<span>メモリ使用量は４％なので１</span>
<span>０K</span>
<span>ワードぐらいまでは拡張できそうです。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000094.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000043.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000124.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000034.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>8.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-38"><b>
<span><b>コンポーネントを作成</b></span>
</b></a>
</b></h2>
<p>&nbsp;<img src="images/000151.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>MyBasicStorag</span>
<span>e</span>
<span>コンポーネントは、データを入力す</span>
<span>る</span>
<span>Avalon-S</span>
<span>T</span>
<span>シンクが１つ</span>
<span>、</span>
<span>Raspberry P</span>
<span>i</span>
<span>からデータを読み出すため</span>
<span>の</span>
<span>Avalon-M</span>
<span>M</span>
<span>スレーブが１つ、上図では省略されていますがメモリ全体にデータが書き込まれたこと</span>
<span>を</span>
<span>Raspberry P</span>
<span>i</span>
<span>に伝えるための信号線</span>
<span>が1</span>
<span>本必要です。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>QsysCore.qsy</span>
<span>s</span>
<span>」をダブルクリック</span>
<span>し</span>
<span>Platform Designe</span>
<span>r</span>
<span>を起動して、テンプレートファイルを入手します。</span>
 &nbsp;</p>
<p>&nbsp;<span>Platform Designe</span>
<span>r</span>
<span>の</span>
<span>「</span>
<span>IP Catalo</span>
<span>g</span>
<span>」の</span>
<span>「</span>
<span>New</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000062.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>テンプレートファイルを入手するだけなので、</span>
<span>「</span>
<span>Nam</span>
<span>e</span>
<span>」などはそのままにします。</span>
 &nbsp;</p>
<p>&nbsp;<span>Component Edito</span>
<span>r</span>
<span>の</span>
<span>「</span>
<span>Template</span>
<span>s</span>
<span>」メニューの</span>
<span>「</span>
<span>Add Avalon-MM Simple Slav</span>
<span>e</span>
<span>」と</span>
<span>「</span>
<span>Add Typical Avalon-ST Sin</span>
<span>k</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000014.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>File</span>
<span>s</span>
<span>」ページに移動して、</span>
<span>「</span>
<span>Create Synthesis File form Signal</span>
<span>s</span>
<span>」をクリックしてテンプレートファイルを保存します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000091.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000006.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Finish</span>
<span>...</span>
<span>」をクリックして</span>
<span>、</span>
<span>Component Edito</span>
<span>r</span>
<span>を閉じます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000027.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Platform Designe</span>
<span>r</span>
<span>を開いたまま</span>
<span>、</span>
<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>を操作します。</span>
 &nbsp;</p>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Fil</span>
<span>e</span>
<span>」メニューの</span>
<span>「</span>
<span>Open</span>
<span>...</span>
<span>」をクリックして、保存した</span>
<span>「</span>
<span>new_component.</span>
<span>v</span>
<span>」を表示します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>// new_component.v</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// This file was auto-generated as a prototype implementation of a module</span>
 &nbsp;</p>
<p>&nbsp;<span>// created in component editor.&nbsp; It ties off all outputs to ground and</span>
 &nbsp;</p>
<p>&nbsp;<span>// ignores all inputs.&nbsp; It needs to be edited to make it do something</span>
 &nbsp;</p>
<p>&nbsp;<span>// useful.</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// This file will not be automatically regenerated.&nbsp; You should check it in</span>
 &nbsp;</p>
<p>&nbsp;<span>// to your version control system if you want to keep it.</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>`timescale 1 ps / 1 ps</span>
 &nbsp;</p>
<p>&nbsp;<span>module new_component (</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [7:0]&nbsp; avs_s0_address,&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; avs_s0.address</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; avs_s0_read,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .read</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire [31:0] avs_s0_readdata,&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .readdata</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; avs_s0_write,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .write</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [31:0] avs_s0_writedata,&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .writedata</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; avs_s0_waitrequest, //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .waitrequest</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; clock_clk,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp; clock.clk</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reset_reset,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp; reset.reset</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [31:0] asi_in0_data,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // asi_in0.data</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asi_in0_ready,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .ready</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asi_in0_valid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .valid</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// TODO: Auto-generated HDL template</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>assign avs_s0_readdata = 32'b00000000000000000000000000000000;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>assign avs_s0_waitrequest = 1'b0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>assign asi_in0_ready = 1'b0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>endmodule</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Fil</span>
<span>e</span>
<span>」メニューの</span>
<span>「</span>
<span>Save As</span>
<span>...</span>
<span>」をクリックして、</span>
<span>「</span>
<span>MyBasicStorage.</span>
<span>v</span>
<span>」という名前で保存します。テンプレートの</span>
<span>「</span>
<span>clock_cl</span>
<span>k</span>
<span>」、</span>
<span>「</span>
<span>reset_rese</span>
<span>t</span>
<span>」はそれぞれ</span>
<span>「</span>
<span>csi_cl</span>
<span>k</span>
<span>」、</span>
<span>「</span>
<span>rsi_rese</span>
<span>t</span>
<span>」と変更する</span>
<span>と</span>
<span>Component Edito</span>
<span>r</span>
<span>に読み込んだときクロック、リセットと認識してもらえます。</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>MyBasicStorage.</span>
<span>v</span>
<span>」の内容を次のように変更します。</span>
<span>「</span>
<span>coe_complet</span>
<span>e</span>
<span>」はメモリ全体にデータが書き込まれたこと</span>
<span>を</span>
<span>Raspberry P</span>
<span>i</span>
<span>に伝えるための信号線です。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>`timescale 1 ps / 1 ps</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>module MyBasicStorage (</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; csi_clk,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp; csi.clk</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rsi_reset,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp; rsi.reset</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [9:0]&nbsp; avs_s0_address,&nbsp;&nbsp; //&nbsp; avs_s0.address</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; avs_s0_read,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .read</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire [31:0] avs_s0_readdata,&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .readdata</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; avs_s0_write,&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .write</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [31:0] avs_s0_writedata, //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .writedata</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [31:0] asi_in0_data,&nbsp;&nbsp;&nbsp;&nbsp; // asi_in0.data</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asi_in0_valid,&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .valid</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>output reg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; coe_complete</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>localparam ADDR_SIZE = 512;</span>
 &nbsp;</p>
<p>&nbsp;<span>localparam ADDR_WIDTH = 9;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>localparam STATE_IDLE = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>localparam STATE_RUNNING = 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>localparam STATE_COMPLETED = 2;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>reg run;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>reg [2:0] state;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [ADDR_WIDTH:0] sample;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire wren;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>reg [ADDR_WIDTH-1:0] addr;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire [31:0] q;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge csi_clk) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (rsi_reset) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>run &lt;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (avs_s0_write &amp;&amp; avs_s0_address == 10'h200)</span>
 &nbsp;</p>
<p>&nbsp;<span>run &lt;= avs_s0_writedata[0];</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>assign avs_s0_readdata = (avs_s0_address == 10'h200) ? state :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(avs_s0_address == 10'h201) ? sample :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;q;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge csi_clk) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (rsi_reset) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_IDLE;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else begin</span>
 &nbsp;</p>
<p>&nbsp;<span>case (state)</span>
 &nbsp;</p>
<p>&nbsp;<span>STATE_IDLE : begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (run)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_RUNNING;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>sample &lt;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>coe_complete &lt;= 1'b0;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>STATE_RUNNING : begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (run == 1'b0)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_IDLE;</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (sample == ADDR_SIZE)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_COMPLETED;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if (asi_in0_valid)</span>
 &nbsp;</p>
<p>&nbsp;<span>sample &lt;= sample + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>STATE_COMPLETED : begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (run == 1'b0)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_IDLE;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>coe_complete &lt;= 1'b1;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>endcase</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>assign wren = asi_in0_valid &amp;&amp; state == STATE_RUNNING;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge csi_clk) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (rsi_reset) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>addr &lt;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else if (wren) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>addr &lt;= addr + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>ram2_32x512 ram2_32x512_inst (</span>
 &nbsp;</p>
<p>&nbsp;<span>.clock(csi_clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.wraddress(addr),</span>
 &nbsp;</p>
<p>&nbsp;<span>.data(asi_in0_data),</span>
 &nbsp;</p>
<p>&nbsp;<span>.wren(wren),</span>
 &nbsp;</p>
<p>&nbsp;<span>.rdaddress(addr + avs_s0_address),</span>
 &nbsp;</p>
<p>&nbsp;<span>.q(q)</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>endmodule</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Platform Designe</span>
<span>r</span>
<span>に戻って</span>
<span>「</span>
<span>IP Catalo</span>
<span>g</span>
<span>」の</span>
<span>「</span>
<span>New</span>
<span>...</span>
<span>」をクリックし</span>
<span>、</span>
<span>Component Edito</span>
<span>r</span>
<span>を起動します。</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Nam</span>
<span>e</span>
<span>」と</span>
<span>「</span>
<span>Display nam</span>
<span>e</span>
<span>」を</span>
<span>「</span>
<span>MyBasicStorag</span>
<span>e</span>
<span>」に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000031.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>File</span>
<span>s</span>
<span>」ページで、作成した</span>
<span>「</span>
<span>MyBasicStorage.</span>
<span>v</span>
<span>」を読み込みます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000146.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000060.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000075.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Signals &amp; Interface</span>
<span>s</span>
<span>」ページに移動して</span>
<span>、</span>
<span>Erro</span>
<span>r、</span>
<span>Warnin</span>
<span>g</span>
<span>を解決します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000187.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>conduit_end_</span>
<span>0</span>
<span>」、</span>
<span>「</span>
<span>in</span>
<span>0</span>
<span>」、</span>
<span>「</span>
<span>s</span>
<span>0</span>
<span>」の</span>
<span>「</span>
<span>Associated Rese</span>
<span>t</span>
<span>」が</span>
<span>「</span>
<span>non</span>
<span>e</span>
<span>」になっているので</span>
<span>「</span>
<span>rese</span>
<span>t</span>
<span>」に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000166.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>in</span>
<span>0</span>
<span>」の</span>
<span>「</span>
<span>Data bits per symbo</span>
<span>l</span>
<span>」を</span>
<span>「</span>
<span>3</span>
<span>2</span>
<span>」に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000179.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Finish</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000057.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000149.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>8.4</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-39"><b>
<span><b>Platform Designer&nbsp;(Qsys</b></span>
<span><b>)</b></span>
<span><b>に追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>IP Catalo</span>
<span>g</span>
<span>に表示され</span>
<span>た</span>
<span>MyBasicStorag</span>
<span>e</span>
<span>コンポーネントを選択し、</span>
<span>「</span>
<span>Add</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000018.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000119.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>クロック、リセット</span>
<span>、</span>
<span>Avalon-M</span>
<span>M</span>
<span>バスの交点をクリックして接続します</span>
<span>。</span>
<span>3</span>
<span>2</span>
<span>ビット入力</span>
<span>の</span>
<span>Avalon-S</span>
<span>T</span>
<span>シンクと、メモリ全体にデータが書き込まれてこと示す信号線をダブルクリックして外部に公開します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000061.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>pi</span>
<span>o</span>
<span>」と</span>
<span>「</span>
<span>MyBasicStorag</span>
<span>e</span>
<span>」のアドレスがぶつかっているので、</span>
<span>「</span>
<span>MyBasicStorag</span>
<span>e</span>
<span>」のアドレスをダブルクリックし</span>
<span>て</span>
<span>0x0001 000</span>
<span>0</span>
<span>からに変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000036.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Generat</span>
<span>e</span>
<span>」メニューの</span>
<span>「</span>
<span>Show Instantiation Template</span>
<span>...</span>
<span>」をクリックして、テンプレートをメモ帳にコピーしておきます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000107.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Generate HDL</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000136.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000150.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000024.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000168.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>top.</span>
<span>v</span>
<span>」を次のように変更します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>`timescale 1 ps / 1 ps</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>module top</span>
 &nbsp;</p>
<p>&nbsp;<span>(</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire CLK,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>input wire SPI_NSS,</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire SPI_MOSI,</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire SPI_MISO,</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire SPI_SCLK,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>output wire COMPLETE,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>output wire [7:0] LED</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg spi_mosi;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire adc_clk;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire clk;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire locked;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire [31:0] pio_0;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire sample_valid;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire [31:0] sample_data;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [11:0] ch1;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [11:0] ch2;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge SPI_SCLK) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>spi_mosi &lt;= SPI_MOSI;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>pll pll_inst (</span>
 &nbsp;</p>
<p>&nbsp;<span>.inclk0 (CLK),</span>
 &nbsp;</p>
<p>&nbsp;<span>.c0 (adc_clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.c1 (clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.locked (locked)</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>QsysCore QsysCore_inst (</span>
 &nbsp;</p>
<p>&nbsp;<span>.clk_clk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.reset_reset_n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (1'b1),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_mosi_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (spi_mosi),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_nss_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SPI_NSS),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_miso_to_and_from_the_spislave_inst_for_spichain (SPI_MISO),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_sclk_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SPI_SCLK),</span>
 &nbsp;</p>
<p>&nbsp;<span>.pio_0_external_connection_export&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (pio_0),</span>
 &nbsp;</p>
<p>&nbsp;<span>.mybasicstorage_0_in0_data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (sample_data),</span>
 &nbsp;</p>
<p>&nbsp;<span>.mybasicstorage_0_in0_valid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (sample_valid),</span>
 &nbsp;</p>
<p>&nbsp;<span>.mybasicstorage_0_conduit_end_0_export&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (COMPLETE)</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge clk) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>ch1 &lt;= ch1 + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>ch2 &lt;= ch2 + 16;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>assign sample_data = { 4'h0, ch2, 4'h0, ch1 };</span>
 &nbsp;</p>
<p>&nbsp;<span>assign sample_valid = 1'b1;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>assign LED = pio_0[7:0];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>endmodule</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Compile Desig</span>
<span>n</span>
<span>」を右クリックして、</span>
<span>「</span>
<span>Star</span>
<span>t</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000012.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Analysis &amp; Synthesi</span>
<span>s</span>
<span>」がエラー無く終了したことを確認します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000137.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>8.5</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-40"><b>
<span><b>ピン配置</b></span>
<span><b>（</b></span>
<span><b>COMPLET</b></span>
<span><b>E</b></span>
<span><b>）</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>評価ボー</span>
<span>ド</span>
<span>MAX100</span>
<span>0の</span>
<span>PMO</span>
<span>D</span>
<span>ソケット</span>
<span>を</span>
<span>COMPLET</span>
<span>E</span>
<span>で使用します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>COMPLETE (N3)</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000194.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Assignment</span>
<span>s</span>
<span>」メニューから</span>
<span>「</span>
<span>Pin Planne</span>
<span>r</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<span>追加し</span>
<span>た</span>
<span>SP</span>
<span>I</span>
<span>のピンの</span>
<span>「</span>
<span>Locatio</span>
<span>n</span>
<span>」と</span>
<span>「</span>
<span>I/O Standar</span>
<span>d</span>
<span>」を次のように入力して</span>
<span>「</span>
<span>Pin Planne</span>
<span>r</span>
<span>」を閉じます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000098.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>8.6</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-41"><b>
<span><b>書き込み</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>「</span>
<span>Compile Desig</span>
<span>n</span>
<span>」を右クリックして</span>
<span>「</span>
<span>Star</span>
<span>t</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000109.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Compile Desig</span>
<span>n</span>
<span>」がエラー無く終了したことを確認します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000079.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Program Device (Open Programmer</span>
<span>)</span>
<span>」を右クリックして</span>
<span>「</span>
<span>Ope</span>
<span>n</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000197.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Star</span>
<span>t</span>
<span>」をクリックし</span>
<span>て</span>
<span>FPG</span>
<span>A</span>
<span>に書き込みます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000049.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000112.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>以上でハードウェア側の準備が整いました。</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2><b>
<span><b>8.7</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-42"><b>
<span><b>アプリケーションを変更</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>FPG</span>
<span>Aの</span>
<span>COMPLET</span>
<span>E</span>
<span>ピンが「１」になるまで待って、メモリの内容を纏めて読み出しログ画面に表示します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading.Tasks;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Windows.Forms;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Max10Graph</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>partial</span>
<span>&nbsp;</span>
<span>class</span>
<span>&nbsp;</span>
<span>Form1</span>
<span>&nbsp;: Form</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;PigpiodIf pigpiodIf;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;AvalonMM avalonMM =&nbsp;</span>
<span>new</span>
<span>&nbsp;AvalonMM();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_1 = 12;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_2 = 13;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;COMPLETE = 26;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;NUM_SAMPLES = 512;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource cts;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;Form1()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>InitializeComponent();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;CloseConnection()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(cts !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.DoEvents();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(avalonMM.Stream !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream.Dispose();</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_stop();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf =&nbsp;</span>
<span>new</span>
<span>&nbsp;PigpiodIf();</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.StreamConnected&nbsp;+= (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo1_CheckedChanged(checkBoxServo1,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo2_CheckedChanged(checkBoxServo2,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// CS2, 20MHz, Auxiliary SPI + Mode1</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream =&nbsp;</span>
<span>new</span>
<span>&nbsp;SpiStream(pigpiodIf, 2, 20 * 1000000, 256 + 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(PigpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_FormClosing(</span>
<span>object</span>
<span>&nbsp;sender, FormClosingEventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonOpen_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_start(textBoxAddress.Text,&nbsp;</span>
<span>"8888"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonClose_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>bool</span>
<span>&nbsp;complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>PigpiodIf.Callback callback = pigpiodIf.callback(COMPLETE, PigpiodIf.RISING_EDGE, (gpio, level, tick, user) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>});</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = cts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;addr = 0x10000;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>DateTime lastAccessTime = DateTime.Now;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;deltaT = 1.0 / 50e6;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested &amp;&amp; !complete)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;leftInMS = (</span>
<span>int</span>
<span>)(deltaT * 1000 * NUM_SAMPLES) - (</span>
<span>int</span>
<span>)(DateTime.Now - lastAccessTime).TotalMilliseconds;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(leftInMS &lt;= 0)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(Math.Min(leftInMS, 10), ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>[] res;</span>
 &nbsp;</p>
<p>&nbsp;<span>lock</span>
<span>&nbsp;(avalonMM.LockObject)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>res = avalonMM.ReadUInt32Packet(NUM_SAMPLES, addr,&nbsp;</span>
<span>true</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>lastAccessTime = DateTime.Now;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(res.Length != NUM_SAMPLES)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>"the response size {0} not equal to the requested size {1}"</span>
<span>, res.Length, NUM_SAMPLES);</span>
 &nbsp;</p>
<p>&nbsp;<span>continue</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;i = 0; i &lt; res.Length; i++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;d1 = (</span>
<span>int</span>
<span>)(res[i] &amp; 0xffff);</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;d2 = (</span>
<span>int</span>
<span>)((res[i] &gt;&gt; 16) &amp; 0xffff);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>"{0,3}: {1:x4}, {2:x4}"</span>
<span>, i, d1, d2);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(callback !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.callback_cancel(callback);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;checkBoxServo1_CheckedChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo1.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, (UInt32)trackBarServo1.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo1_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo1.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, (UInt32)trackBarServo1.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo1.Checked =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;checkBoxServo2_CheckedChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo2.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, (UInt32)trackBarServo2.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo2_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo2.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, (UInt32)trackBarServo2.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo2.Checked =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ビルドして実行します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000000.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>9</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-43"><b>
<span><b>グラフ表示</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>メモリから読み出したデータをログ表示する代わりに、グラフ表示します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000176.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>9.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-44"><b>
<span><b>OxyPlot.WindowsForm</b></span>
<span><b>s</b></span>
<span><b>パッケージをインストール</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>NuGe</span>
<span>t</span>
<span>パッケージマネージャーを表示します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000035.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>OxyPlot.WindowsForm</span>
<span>s</span>
<span>パッケージを検索してインストールします</span>
<span>。</span>
<span>OxyPlot.Cor</span>
<span>e</span>
<span>パッケージも一緒にインストールされます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000193.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>OxyPlot.WindowsForm</span>
<span>s</span>
<span>パッケージをインストールすると、ツールボックス</span>
<span>に</span>
<span>PlotVie</span>
<span>w</span>
<span>コントロールが表示され、フォームに追加できるようになります。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000173.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>9.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-45"><b>
<span><b>PlotVie</b></span>
<span><b>w</b></span>
<span><b>を画面に追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>画面が狭いので</span>
<span>、</span>
<span>LoggingTextBo</span>
<span>xと</span>
<span>PlotVie</span>
<span>w</span>
<span>の表示をタブコントロールで切り替えることにします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>まず</span>
<span>、</span>
<span>LoggingTextBo</span>
<span>xの</span>
<span>Doc</span>
<span>k</span>
<span>プロパティ</span>
<span>を</span>
<span>Non</span>
<span>e</span>
<span>に変更して下側にどけておきます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000182.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000113.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>空いた場所にタブコントロールを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000117.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>どけておい</span>
<span>た</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>をタブコントロール</span>
<span>の</span>
<span>tabPage</span>
<span>1</span>
<span>にドラッグ＆ドロップして</span>
<span>、</span>
<span>LoggingTextBo</span>
<span>x</span>
<span>とタブコントロール</span>
<span>の</span>
<span>Doc</span>
<span>k</span>
<span>プロパティ</span>
<span>を</span>
<span>Fil</span>
<span>l</span>
<span>に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000052.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>tabPage</span>
<span>2</span>
<span>にツールボックスか</span>
<span>ら</span>
<span>PlotVie</span>
<span>w</span>
<span>を追加して</span>
<span>、</span>
<span>PlotView</span>
<span>&nbsp;の</span>
<span>Doc</span>
<span>k</span>
<span>プロパティ</span>
<span>を</span>
<span>Fil</span>
<span>l、</span>
<span>BackColo</span>
<span>r</span>
<span>プロパティ</span>
<span>を</span>
<span>Windo</span>
<span>w</span>
<span>に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000021.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000191.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>タブコントロールの各タブページの名前とタイトルを変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000158.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>表示され</span>
<span>た</span>
<span>TabPag</span>
<span>e</span>
<span>コレクションエディターで、タブページの名前とタイトルを変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000132.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span><b>(Name)</b></span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span><b>Text</b></span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>tabPageLog</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>Log</span>
 &nbsp;</p>
</td>
</tr>
<tr>
<td>
<p>&nbsp;<span>tabPageGraph</span>
 &nbsp;</p>
</td>
<td>
<p>&nbsp;<span>Graph</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000099.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>9.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-46"><b>
<span><b>アプリケーションを変更</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>OxyPlo</span>
<span>tの</span>
<span>PlotVie</span>
<span>w</span>
<span>を使ってグラフ表示します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;OxyPlot;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;OxyPlot.Axes;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;OxyPlot.Series;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Collections.Generic;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading.Tasks;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Windows.Forms;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Max10Graph</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>partial</span>
<span>&nbsp;</span>
<span>class</span>
<span>&nbsp;</span>
<span>Form1</span>
<span>&nbsp;: Form</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;PigpiodIf pigpiodIf;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;AvalonMM avalonMM =&nbsp;</span>
<span>new</span>
<span>&nbsp;AvalonMM();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_1 = 12;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_2 = 13;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;COMPLETE = 26;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;NUM_CHANNELS = 2;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;NUM_SAMPLES = 512;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource cts;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;PlotModel plotModel;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;LineSeries[] series;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;Form1()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>InitializeComponent();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;CloseConnection()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(cts !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.DoEvents();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(avalonMM.Stream !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream.Dispose();</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_stop();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf =&nbsp;</span>
<span>new</span>
<span>&nbsp;PigpiodIf();</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.StreamConnected&nbsp;+= (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo1_CheckedChanged(checkBoxServo1,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo2_CheckedChanged(checkBoxServo2,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// CS2, 20MHz, Auxiliary SPI + Mode1</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream =&nbsp;</span>
<span>new</span>
<span>&nbsp;SpiStream(pigpiodIf, 2, 20 * 1000000, 256 + 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(PigpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel =&nbsp;</span>
<span>new</span>
<span>&nbsp;PlotModel();</span>
 &nbsp;</p>
<p>&nbsp;<span>series =&nbsp;</span>
<span>new</span>
<span>&nbsp;LineSeries[NUM_CHANNELS];</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch] =&nbsp;</span>
<span>new</span>
<span>&nbsp;LineSeries();</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch].Title =&nbsp;</span>
<span>string</span>
<span>.Format(</span>
<span>"CH{0}"</span>
<span>, ch);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Series.Add(series[ch]);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;fullScale = 4096;</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;margin = fullScale * 0.05;</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Axes.Add(</span>
 &nbsp;</p>
<p>&nbsp;<span>new</span>
<span>&nbsp;LinearAxis() { Position = AxisPosition.Left, Minimum = 0 - margin, Maximum = fullScale + margin }</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_FormClosing(</span>
<span>object</span>
<span>&nbsp;sender, FormClosingEventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonOpen_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_start(textBoxAddress.Text,&nbsp;</span>
<span>"8888"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonClose_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>bool</span>
<span>&nbsp;complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>PigpiodIf.Callback callback = pigpiodIf.callback(COMPLETE, PigpiodIf.RISING_EDGE, (gpio, level, tick, user) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>});</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = cts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;addr = 0x10000;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>DateTime lastAccessTime = DateTime.Now;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>List&lt;DataPoint&gt;[] dataPoints =&nbsp;</span>
<span>new</span>
<span>&nbsp;List&lt;DataPoint&gt;[NUM_CHANNELS];</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[ch] =&nbsp;</span>
<span>new</span>
<span>&nbsp;List&lt;DataPoint&gt;();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;deltaT = 1.0 / 50e6;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested &amp;&amp; !complete)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;leftInMS = (</span>
<span>int</span>
<span>)(deltaT * 1000 * NUM_SAMPLES) - (</span>
<span>int</span>
<span>)(DateTime.Now - lastAccessTime).TotalMilliseconds;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(leftInMS &lt;= 0)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(Math.Min(leftInMS, 10), ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>[] res;</span>
 &nbsp;</p>
<p>&nbsp;<span>lock</span>
<span>&nbsp;(avalonMM.LockObject)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>res = avalonMM.ReadUInt32Packet(NUM_SAMPLES, addr,&nbsp;</span>
<span>true</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>lastAccessTime = DateTime.Now;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(res.Length != NUM_SAMPLES)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>"the response size {0} not equal to the requested size {1}"</span>
<span>, res.Length, NUM_SAMPLES);</span>
 &nbsp;</p>
<p>&nbsp;<span>continue</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[ch].Clear();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;i = 0; i &lt; res.Length; i++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;d1 = (</span>
<span>int</span>
<span>)(res[i] &amp; 0xffff);</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;d2 = (</span>
<span>int</span>
<span>)((res[i] &gt;&gt; 16) &amp; 0xffff);</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[0].Add(</span>
<span>new</span>
<span>&nbsp;DataPoint(deltaT * i, d1));</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[1].Add(</span>
<span>new</span>
<span>&nbsp;DataPoint(deltaT * i, d2));</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch].Points.Clear();</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch].Points.AddRange(dataPoints[ch]);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.InvalidatePlot(</span>
<span>true</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(plotView1.Model != plotModel)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Model = plotModel;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Invalidate();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(callback !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.callback_cancel(callback);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;checkBoxServo1_CheckedChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo1.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, (UInt32)trackBarServo1.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo1_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo1.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, (UInt32)trackBarServo1.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo1.Checked =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;checkBoxServo2_CheckedChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo2.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, (UInt32)trackBarServo2.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo2_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo2.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, (UInt32)trackBarServo2.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo2.Checked =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Task.Run(</span>
<span>)</span>
<span>の内側はアプリケーション</span>
<span>の</span>
<span>GU</span>
<span>I</span>
<span>スレッドとは異なるスレッドで動いています。グラフの表示更新</span>
<span>は</span>
<span>GU</span>
<span>I</span>
<span>を変更するので</span>
<span>、</span>
<span>Invoke(</span>
<span>)</span>
<span>を使っ</span>
<span>て</span>
<span>GU</span>
<span>I</span>
<span>スレッドにして実行します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>データ取得</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>グラフ表示更新</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ビルドして実行します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000176.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>10</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-47"><b>
<span><b>MyTriggeredStorag</b></span>
<span><b>e</b></span>
<span><b>コンポーネント</b></span>
</b></a>
</b></h1>
<p>&nbsp;<span>MyTriggeredStorag</span>
<span>e</span>
<span>コンポーネントは</span>
<span>、</span>
<span>Window</span>
<span>s</span>
<span>フォームアプリケーションから、サンプリング周期、トリガーポジション、トリガーソース、トリガースロープ、トリガーレベルを設定できます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000069.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>10.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-48"><b>
<span><b>コンポーネントを作成</b></span>
</b></a>
</b></h2>
<p>&nbsp;<img src="images/000037.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>MyTriggeredStorag</span>
<span>e</span>
<span>コンポーネントのインターフェースは</span>
<span>、</span>
<span>MyBasicStorag</span>
<span>e</span>
<span>コンポーネントと同じです。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Fil</span>
<span>e</span>
<span>」メニューの</span>
<span>「</span>
<span>Open</span>
<span>...</span>
<span>」をクリックして</span>
<span>「</span>
<span>MyBasicStorage.</span>
<span>v</span>
<span>」を開き、</span>
<span>「</span>
<span>Save As</span>
<span>...</span>
<span>」をクリックして、</span>
<span>「</span>
<span>MyTriggeredStorage.</span>
<span>v</span>
<span>」という名前で保存します。</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>MyTriggeredStorage.</span>
<span>v</span>
<span>」の内容を次のように変更します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>`timescale 1 ps / 1 ps</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>module MyTriggeredStorage (</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; csi_clk,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp; csi.clk</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rsi_reset,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp; rsi.reset</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [9:0]&nbsp; avs_s0_address,&nbsp;&nbsp; //&nbsp; avs_s0.address</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; avs_s0_read,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .read</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire [31:0] avs_s0_readdata,&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .readdata</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; avs_s0_write,&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .write</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [31:0] avs_s0_writedata, //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .writedata</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [31:0] asi_in0_data,&nbsp;&nbsp;&nbsp;&nbsp; // asi_in0.data</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asi_in0_valid,&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .valid</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>output reg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; coe_complete</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>localparam ADDR_SIZE = 512;</span>
 &nbsp;</p>
<p>&nbsp;<span>localparam ADDR_WIDTH = 9;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>localparam STATE_IDLE = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>localparam STATE_ARMING = 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>localparam STATE_WAITING1 = 2;</span>
 &nbsp;</p>
<p>&nbsp;<span>localparam STATE_WAITING2 = 3;</span>
 &nbsp;</p>
<p>&nbsp;<span>localparam STATE_TRIGGERED = 4;</span>
 &nbsp;</p>
<p>&nbsp;<span>localparam STATE_COMPLETED = 5;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>reg run;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [31:0] div;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [ADDR_WIDTH-1:0] pre;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [4:0] source;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg slope;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [15:0] level;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [15:0] div_count;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire divided_valid;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>reg [2:0] state;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [31:0] sample;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire wren;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [ADDR_WIDTH-1:0] addr;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire [31:0] q;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge csi_clk) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (rsi_reset) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>run &lt;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>div &lt;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>pre &lt;= ADDR_SIZE &gt;&gt; 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>level &lt;= 128;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (avs_s0_write &amp;&amp; avs_s0_address == 10'h200)</span>
 &nbsp;</p>
<p>&nbsp;<span>run &lt;= avs_s0_writedata[0];</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (avs_s0_write &amp;&amp; avs_s0_address == 10'h201)</span>
 &nbsp;</p>
<p>&nbsp;<span>div &lt;= avs_s0_writedata[31:0];</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (avs_s0_write &amp;&amp; avs_s0_address == 10'h202)</span>
 &nbsp;</p>
<p>&nbsp;<span>pre &lt;= avs_s0_writedata[ADDR_WIDTH-1:0];</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (avs_s0_write &amp;&amp; avs_s0_address == 10'h203)</span>
 &nbsp;</p>
<p>&nbsp;<span>source &lt;= avs_s0_writedata[4:0];</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (avs_s0_write &amp;&amp; avs_s0_address == 10'h204)</span>
 &nbsp;</p>
<p>&nbsp;<span>slope &lt;= avs_s0_writedata[0];</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (avs_s0_write &amp;&amp; avs_s0_address == 10'h205)</span>
 &nbsp;</p>
<p>&nbsp;<span>level &lt;= avs_s0_writedata[15:0];</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>assign avs_s0_readdata = (avs_s0_address == 10'h200) ? state :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(avs_s0_address == 10'h201) ? sample :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;q;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>always @(posedge csi_clk) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (rsi_reset) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>div_count &lt;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else if (asi_in0_valid) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (div_count == div - 1)</span>
 &nbsp;</p>
<p>&nbsp;<span>div_count &lt;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>div_count &lt;= div_count + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>assign divided_valid = asi_in0_valid &amp;&amp; (div_count == 0);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge csi_clk) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (rsi_reset) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_IDLE;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else begin</span>
 &nbsp;</p>
<p>&nbsp;<span>case (state)</span>
 &nbsp;</p>
<p>&nbsp;<span>STATE_IDLE : begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (run) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (pre == 0)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_WAITING1;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_ARMING;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>sample &lt;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>coe_complete &lt;= 1'b0;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>STATE_ARMING : begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (run == 1'b0)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_IDLE;</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (sample == pre)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_WAITING1;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if (divided_valid)</span>
 &nbsp;</p>
<p>&nbsp;<span>sample &lt;= sample + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>STATE_WAITING1 : begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (run == 1'b0)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_IDLE;</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (source == 5'd0 &amp;&amp; slope == 1'b0) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (asi_in0_valid &amp;&amp; (asi_in0_data &amp; 16'hffff) &lt; level)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_WAITING2;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else if (source == 5'd0 &amp;&amp; slope == 1'b1) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (asi_in0_valid &amp;&amp; (asi_in0_data &amp; 16'hffff) &gt; level)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_WAITING2;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else if (source == 5'd1 &amp;&amp; slope == 1'b0) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (asi_in0_valid &amp;&amp; (asi_in0_data &gt;&gt; 16) &lt; level)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_WAITING2;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else if (source == 5'd1 &amp;&amp; slope == 1'b1) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (asi_in0_valid &amp;&amp; (asi_in0_data &gt;&gt; 16) &gt; level)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_WAITING2;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>STATE_WAITING2 : begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (run == 1'b0)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_IDLE;</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (source == 5'd0 &amp;&amp; slope == 1'b0) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (asi_in0_valid &amp;&amp; (asi_in0_data &amp; 16'hffff) &gt; level)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_TRIGGERED;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else if (source == 5'd0 &amp;&amp; slope == 1'b1) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (asi_in0_valid &amp;&amp; (asi_in0_data &amp; 16'hffff) &lt; level)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_TRIGGERED;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else if (source == 5'd1 &amp;&amp; slope == 1'b0) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (asi_in0_valid &amp;&amp; (asi_in0_data &gt;&gt; 16) &gt; level)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_TRIGGERED;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else if (source == 5'd1 &amp;&amp; slope == 1'b1) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (asi_in0_valid &amp;&amp; (asi_in0_data &gt;&gt; 16) &lt; level)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_TRIGGERED;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>STATE_TRIGGERED : begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (run == 1'b0)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_IDLE;</span>
 &nbsp;</p>
<p>&nbsp;<span>else if (sample == ADDR_SIZE)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_COMPLETED;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if (divided_valid)</span>
 &nbsp;</p>
<p>&nbsp;<span>sample &lt;= sample + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>STATE_COMPLETED : begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (run == 1'b0)</span>
 &nbsp;</p>
<p>&nbsp;<span>state &lt;= STATE_IDLE;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>coe_complete &lt;= 1'b1;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>endcase</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>assign wren = divided_valid &amp;&amp;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(state != STATE_IDLE &amp;&amp; state != STATE_COMPLETED);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge csi_clk) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (rsi_reset) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>addr &lt;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else if (wren) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>addr &lt;= addr + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>ram2_32x512 ram2_32x512_inst (</span>
 &nbsp;</p>
<p>&nbsp;<span>.clock(csi_clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.wraddress(addr),</span>
 &nbsp;</p>
<p>&nbsp;<span>.data(asi_in0_data),</span>
 &nbsp;</p>
<p>&nbsp;<span>.wren(wren),</span>
 &nbsp;</p>
<p>&nbsp;<span>.rdaddress(addr + avs_s0_address),</span>
 &nbsp;</p>
<p>&nbsp;<span>.q(q)</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>endmodule</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>QsysCore.qsy</span>
<span>s</span>
<span>」をダブルクリック</span>
<span>し</span>
<span>Platform Designe</span>
<span>r</span>
<span>を起動して、</span>
<span>「</span>
<span>IP Catalo</span>
<span>g</span>
<span>」の</span>
<span>「</span>
<span>New</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000008.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Nam</span>
<span>e</span>
<span>」と</span>
<span>「</span>
<span>Display nam</span>
<span>e</span>
<span>」を</span>
<span>「</span>
<span>MyTriggeredStorag</span>
<span>e</span>
<span>」に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000175.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>File</span>
<span>s</span>
<span>」ページで、作成した</span>
<span>「</span>
<span>MyTriggeredStorage.</span>
<span>v</span>
<span>」を読み込みます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>以降の操作</span>
<span>は</span>
<span>MyBasicStorag</span>
<span>e</span>
<span>コンポーネントのときと同じです。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>10.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-49"><b>
<span><b>Platform Designer&nbsp;(Qsys</b></span>
<span><b>)</b></span>
<span><b>に追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>配置済</span>
<span>の</span>
<span>MyBasicStorag</span>
<span>e</span>
<span>コンポーネントを削除し</span>
<span>、</span>
<span>MyTriggeredStorag</span>
<span>e</span>
<span>コンポーネントを追加します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>操作</span>
<span>は</span>
<span>MyBasicStorag</span>
<span>e</span>
<span>コンポーネントのときと同じです。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>top.</span>
<span>v</span>
<span>」を次のように変更します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>`timescale 1 ps / 1 ps</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>module top</span>
 &nbsp;</p>
<p>&nbsp;<span>(</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire CLK,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>input wire SPI_NSS,</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire SPI_MOSI,</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire SPI_MISO,</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire SPI_SCLK,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>output wire COMPLETE,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>output wire [7:0] LED</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg spi_mosi;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire adc_clk;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire clk;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire locked;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire [31:0] pio_0;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire sample_valid;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire [31:0] sample_data;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [11:0] ch1;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [11:0] ch2;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge SPI_SCLK) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>spi_mosi &lt;= SPI_MOSI;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>pll pll_inst (</span>
 &nbsp;</p>
<p>&nbsp;<span>.inclk0 (CLK),</span>
 &nbsp;</p>
<p>&nbsp;<span>.c0 (adc_clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.c1 (clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.locked (locked)</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>QsysCore QsysCore_inst (</span>
 &nbsp;</p>
<p>&nbsp;<span>.clk_clk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.reset_reset_n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (1'b1),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_mosi_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (spi_mosi),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_nss_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SPI_NSS),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_miso_to_and_from_the_spislave_inst_for_spichain (SPI_MISO),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_sclk_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SPI_SCLK),</span>
 &nbsp;</p>
<p>&nbsp;<span>.pio_0_external_connection_export&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(pio_0),</span>
 &nbsp;</p>
<p>&nbsp;<span>.</span>
<span>mytriggeredstorage</span>
<span>_0_in0_data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (sample_data),</span>
 &nbsp;</p>
<p>&nbsp;<span>.</span>
<span>mytriggeredstorage</span>
<span>_0_in0_valid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (sample_valid),</span>
 &nbsp;</p>
<p>&nbsp;<span>.</span>
<span>mytriggeredstorage</span>
<span>_0_conduit_end_0_export&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (COMPLETE)</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge clk) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>ch1 &lt;= ch1 + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>ch2 &lt;= ch2 + 16;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>assign sample_data = { 4'h0, ch2, 4'h0, ch1 };</span>
 &nbsp;</p>
<p>&nbsp;<span>assign sample_valid = 1'b1;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>assign LED = pio_0[7:0];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>endmodule</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>10.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-50"><b>
<span><b>書き込み</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>操作</span>
<span>は</span>
<span>MyBasicStorag</span>
<span>e</span>
<span>コンポーネントのときと同じです。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>10.4</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-51"><b>
<span><b>アプリケーションを変更</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>サンプリング周期、トリガーポジション、トリガーソース、トリガースロープ、トリガーレベルを設定できます。スタート後に画面の設定を変更すると、一度タスクを終了し、新しいタスク</span>
<span>で</span>
<span>FPG</span>
<span>A</span>
<span>を設定します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;OxyPlot;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;OxyPlot.Axes;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;OxyPlot.Series;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Collections.Generic;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading.Tasks;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Windows.Forms;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Max10Graph</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>partial</span>
<span>&nbsp;</span>
<span>class</span>
<span>&nbsp;</span>
<span>Form1</span>
<span>&nbsp;: Form</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;PigpiodIf pigpiodIf;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;AvalonMM avalonMM =&nbsp;</span>
<span>new</span>
<span>&nbsp;AvalonMM();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_1 = 12;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_2 = 13;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;COMPLETE = 26;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;NUM_CHANNELS = 2;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;NUM_SAMPLES = 512;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;AUTO_TRIGGER_MS = 100;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource cts;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>bool</span>
<span>&nbsp;repeatRequested;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;PlotModel plotModel;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;LineSeries[] series;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;horizontal = 9;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;positionPct = 50;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;source = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;polarity = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;levelPct = 50;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;Form1()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>InitializeComponent();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;CloseConnection()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(cts !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.DoEvents();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(avalonMM.Stream !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream.Dispose();</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_stop();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf =&nbsp;</span>
<span>new</span>
<span>&nbsp;PigpiodIf();</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.StreamConnected&nbsp;+= (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo1_CheckedChanged(checkBoxServo1,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo2_CheckedChanged(checkBoxServo2,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// CS2, 20MHz, Auxiliary SPI + Mode1</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream =&nbsp;</span>
<span>new</span>
<span>&nbsp;SpiStream(pigpiodIf, 2, 20 * 1000000, 256 + 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(PigpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel =&nbsp;</span>
<span>new</span>
<span>&nbsp;PlotModel();</span>
 &nbsp;</p>
<p>&nbsp;<span>series =&nbsp;</span>
<span>new</span>
<span>&nbsp;LineSeries[NUM_CHANNELS];</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch] =&nbsp;</span>
<span>new</span>
<span>&nbsp;LineSeries();</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch].Title =&nbsp;</span>
<span>string</span>
<span>.Format(</span>
<span>"CH{0}"</span>
<span>, ch);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Series.Add(series[ch]);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;fullScale = 4096;</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;margin = fullScale * 0.05;</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Axes.Add(</span>
 &nbsp;</p>
<p>&nbsp;<span>new</span>
<span>&nbsp;LinearAxis() { Position = AxisPosition.Left, Minimum = 0 - margin, Maximum = fullScale + margin }</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>trackBarHor.Value = horizontal;</span>
 &nbsp;</p>
<p>&nbsp;<span>trackBarPos.Value = positionPct;</span>
 &nbsp;</p>
<p>&nbsp;<span>foreach</span>
<span>&nbsp;(var s&nbsp;</span>
<span>in</span>
<span>&nbsp;series)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>comboBoxSource.Items.Add(s.Title);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>comboBoxSource.SelectedIndex = source;</span>
 &nbsp;</p>
<p>&nbsp;<span>comboBoxPol.SelectedIndex = polarity;</span>
 &nbsp;</p>
<p>&nbsp;<span>trackBarLevel.Value = levelPct;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_FormClosing(</span>
<span>object</span>
<span>&nbsp;sender, FormClosingEventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonOpen_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_start(textBoxAddress.Text,&nbsp;</span>
<span>"8888"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonClose_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>do</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>bool</span>
<span>&nbsp;complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>PigpiodIf.Callback callback = pigpiodIf.callback(COMPLETE, PigpiodIf.RISING_EDGE, (gpio, level, tick, user) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>});</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = cts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;addr = 0x10000;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>[] divs =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>int</span>
<span>[] { 1000, 500, 200, 100, 50, 20, 10, 5, 2, 1 };</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;div = divs[horizontal];</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;position = ((NUM_SAMPLES - 1) * positionPct) / 100;</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;level = (4095 * levelPct) / 100;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x201 * 4, (</span>
<span>uint</span>
<span>)div);</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x202 * 4, (</span>
<span>uint</span>
<span>)position);</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x203 * 4, (</span>
<span>uint</span>
<span>)source);</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x204 * 4, (</span>
<span>uint</span>
<span>)polarity);</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x205 * 4, (</span>
<span>uint</span>
<span>)level);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>DateTime lastAccessTime = DateTime.Now;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>List&lt;DataPoint&gt;[] dataPoints =&nbsp;</span>
<span>new</span>
<span>&nbsp;List&lt;DataPoint&gt;[NUM_CHANNELS];</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[ch] =&nbsp;</span>
<span>new</span>
<span>&nbsp;List&lt;DataPoint&gt;();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;deltaT =&nbsp;(1.0 / 50e6)&nbsp;</span>
<span>* div</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested &amp;&amp; !complete)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;leftInMS = (</span>
<span>int</span>
<span>)(deltaT * 1000 * NUM_SAMPLES&nbsp;</span>
<span>+ AUTO_TRIGGER_MS</span>
<span>)&nbsp;- (</span>
<span>int</span>
<span>)(DateTime.Now - lastAccessTime).TotalMilliseconds;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(leftInMS &lt;= 0)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(Math.Min(leftInMS, 10), ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>[] res;</span>
 &nbsp;</p>
<p>&nbsp;<span>lock</span>
<span>&nbsp;(avalonMM.LockObject)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>res = avalonMM.ReadUInt32Packet(NUM_SAMPLES, addr,&nbsp;</span>
<span>true</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>lastAccessTime = DateTime.Now;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(res.Length != NUM_SAMPLES)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>"the response size {0} not equal to the requested size {1}"</span>
<span>, res.Length, NUM_SAMPLES);</span>
 &nbsp;</p>
<p>&nbsp;<span>continue</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[ch].Clear();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;i = 0; i &lt; res.Length; i++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;d1 = (</span>
<span>int</span>
<span>)(res[i] &amp; 0xffff);</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;d2 = (</span>
<span>int</span>
<span>)((res[i] &gt;&gt; 16) &amp; 0xffff);</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[0].Add(</span>
<span>new</span>
<span>&nbsp;DataPoint(deltaT *&nbsp;</span>
<span>(i - position)</span>
<span>, d1));</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[1].Add(</span>
<span>new</span>
<span>&nbsp;DataPoint(deltaT *&nbsp;</span>
<span>(i - position)</span>
<span>, d2));</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch].Points.Clear();</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch].Points.AddRange(dataPoints[ch]);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.InvalidatePlot(</span>
<span>true</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(plotView1.Model != plotModel)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Model = plotModel;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Invalidate();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(callback !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.callback_cancel(callback);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}&nbsp;</span>
<span>while</span>
<span>&nbsp;(repeatRequested);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;checkBoxServo1_CheckedChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo1.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, (UInt32)trackBarServo1.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo1_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo1.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, (UInt32)trackBarServo1.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo1.Checked =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;checkBoxServo2_CheckedChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo2.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, (UInt32)trackBarServo2.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo2_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo2.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, (UInt32)trackBarServo2.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo2.Checked =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarHor_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts ==&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>horizontal = trackBarHor.Value;</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarPos_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts ==&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>positionPct = trackBarPos.Value;</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;comboBoxSource_SelectedIndexChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts ==&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>source = comboBoxSource.SelectedIndex;</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;comboBoxPol_SelectedIndexChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts ==&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>polarity = comboBoxPol.SelectedIndex;</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarLevel_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts ==&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>levelPct = trackBarLevel.Value;</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ビルドして実行します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000069.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>11</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-52"><b>
<span><b>モジュラ</b></span>
<span><b>ー</b></span>
<span><b>ADC I</b></span>
<span><b>P</b></span>
<span><b>コア</b></span>
</b></a>
</b></h1>
<p>&nbsp;<img src="images/000148.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>MAX 1</span>
<span>0</span>
<span>内蔵</span>
<span>の</span>
<span>AD</span>
<span>C</span>
<span>、モジュラ</span>
<span>ー</span>
<span>ADC I</span>
<span>P</span>
<span>コア標準のサンプルストレージは、最大６４サンプルのデータを連続して取得できます。しかし本書で</span>
<span>は</span>
<span>51</span>
<span>2</span>
<span>サンプルのデータを連続して取得したいので、標準のサンプルストレージの代わりに作成し</span>
<span>た</span>
<span>MyTriggeredStorag</span>
<span>e</span>
<span>コンポーネントを使います。</span>
 &nbsp;</p>
<p>&nbsp;<span>モジュラ</span>
<span>ー</span>
<span>ADC I</span>
<span>P</span>
<span>コアの出力は多重化され</span>
<span>た</span>
<span>1</span>
<span>2</span>
<span>ビットデータ</span>
<span>、</span>
<span>MyTriggeredStorag</span>
<span>e</span>
<span>コンポーネントの入力は多重化されていな</span>
<span>い</span>
<span>3</span>
<span>2</span>
<span>ビットデータなので、アダプタを作成して接続します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>モジュラ</span>
<span>ー</span>
<span>ADC I</span>
<span>P</span>
<span>コアのアナログ入力のう</span>
<span>ち</span>
<span>CH</span>
<span>0と</span>
<span>CH</span>
<span>6</span>
<span>を使用します。モジュラ</span>
<span>ー</span>
<span>ADC I</span>
<span>P</span>
<span>コアの</span>
<span>各</span>
<span>C</span>
<span>H</span>
<span>はそれぞれ下図のように接続されています。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000115.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000130.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>11.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-53"><b>
<span><b>Platform Designer&nbsp;(Qsys</b></span>
<span><b>)</b></span>
<span><b>に追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>「</span>
<span>QsysCore.qsy</span>
<span>s</span>
<span>」をダブルクリックし</span>
<span>て</span>
<span>Platform Designe</span>
<span>r</span>
<span>を起動し</span>
<span>、</span>
<span>IP Catalo</span>
<span>g</span>
<span>に表示された</span>
<span>「</span>
<span>Modular ADC core Intel FPGA I</span>
<span>P</span>
<span>」を選択し、</span>
<span>「</span>
<span>Add</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000055.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>標準のサンプルストレージの代わりに作成し</span>
<span>た</span>
<span>MyTriggeredStorag</span>
<span>e</span>
<span>コンポーネントを使うので</span>
<span>「</span>
<span>Core Varian</span>
<span>t</span>
<span>」に</span>
<span>「</span>
<span>Standard sequenser with external sample storag</span>
<span>e</span>
<span>」を選択します。</span>
 &nbsp;</p>
<p>&nbsp;<span>内部リファレン</span>
<span>ス</span>
<span>3.3</span>
<span>V</span>
<span>を選択します。</span>
 &nbsp;</p>
<p>&nbsp;<span>CH</span>
<span>0と</span>
<span>CH</span>
<span>6</span>
<span>を有効にしてシーケンスに登録します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000053.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000088.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>pi</span>
<span>o</span>
<span>」と</span>
<span>「</span>
<span>sequence</span>
<span>r</span>
<span>」のアドレスがぶつかっているので、</span>
<span>「</span>
<span>sequence</span>
<span>r</span>
<span>」のアドレスをダブルクリックし</span>
<span>て</span>
<span>0x0000 001</span>
<span>0</span>
<span>からに変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000133.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>まだモジュラ</span>
<span>ー</span>
<span>ADC I</span>
<span>P</span>
<span>コアの出力</span>
<span>と</span>
<span>MyTriggeredStorag</span>
<span>e</span>
<span>コンポーネントの入力が未接続です。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000160.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>12</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-54"><b>
<span><b>MyAdcAdapte</b></span>
<span><b>r</b></span>
<span><b>コンポーネント</b></span>
</b></a>
</b></h1>
<p>&nbsp;<img src="images/000001.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>モジュラ</span>
<span>ー</span>
<span>ADC I</span>
<span>P</span>
<span>コアの多重化され</span>
<span>た</span>
<span>1</span>
<span>2</span>
<span>ビットデータを多重化されていな</span>
<span>い</span>
<span>3</span>
<span>2</span>
<span>ビットデータに纏め</span>
<span>る</span>
<span>MyAdcAdapte</span>
<span>r</span>
<span>コンポーネントを作成します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000103.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>12.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-55"><b>
<span><b>コンポーネントを作成</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>「</span>
<span>QsysCore.qsy</span>
<span>s</span>
<span>」をダブルクリック</span>
<span>し</span>
<span>Platform Designe</span>
<span>r</span>
<span>を起動して、テンプレートファイルを入手します。</span>
 &nbsp;</p>
<p>&nbsp;<span>Platform Designe</span>
<span>r</span>
<span>の</span>
<span>「</span>
<span>IP Catalo</span>
<span>g</span>
<span>」の</span>
<span>「</span>
<span>New</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000071.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>テンプレートファイルを入手するだけなので、</span>
<span>「</span>
<span>Nam</span>
<span>e</span>
<span>」などはそのままにします。</span>
 &nbsp;</p>
<p>&nbsp;<span>Component Edito</span>
<span>r</span>
<span>の</span>
<span>「</span>
<span>Template</span>
<span>s</span>
<span>」メニューの</span>
<span>「</span>
<span>Add Typical Avalon-ST Sin</span>
<span>k</span>
<span>」と</span>
<span>「</span>
<span>Add Typical Avalon-ST Sourc</span>
<span>e</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000041.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>File</span>
<span>s</span>
<span>」ページに移動して、</span>
<span>「</span>
<span>Create Synthesis File form Signal</span>
<span>s</span>
<span>」をクリックしてテンプレートファイルを保存します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000091.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000142.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Finish</span>
<span>...</span>
<span>」をクリックして</span>
<span>、</span>
<span>Component Edito</span>
<span>r</span>
<span>を閉じます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000027.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Platform Designe</span>
<span>r</span>
<span>を開いたまま</span>
<span>、</span>
<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>を操作します。</span>
 &nbsp;</p>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Fil</span>
<span>e</span>
<span>」メニューの</span>
<span>「</span>
<span>Open</span>
<span>...</span>
<span>」をクリックして、保存した</span>
<span>「</span>
<span>new_component.</span>
<span>v</span>
<span>」を表示します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>// new_component.v</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// This file was auto-generated as a prototype implementation of a module</span>
 &nbsp;</p>
<p>&nbsp;<span>// created in component editor.&nbsp; It ties off all outputs to ground and</span>
 &nbsp;</p>
<p>&nbsp;<span>// ignores all inputs.&nbsp; It needs to be edited to make it do something</span>
 &nbsp;</p>
<p>&nbsp;<span>// useful.</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// This file will not be automatically regenerated.&nbsp; You should check it in</span>
 &nbsp;</p>
<p>&nbsp;<span>// to your version control system if you want to keep it.</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>`timescale 1 ps / 1 ps</span>
 &nbsp;</p>
<p>&nbsp;<span>module new_component (</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [31:0] asi_in0_data,&nbsp;&nbsp; //&nbsp; asi_in0.data</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asi_in0_ready,&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .ready</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asi_in0_valid,&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .valid</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; clock_clk,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; clock.clk</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reset_reset,&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; reset.reset</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire [31:0] aso_out0_data,&nbsp; // aso_out0.data</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aso_out0_ready, //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .ready</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aso_out0_valid&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .valid</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// TODO: Auto-generated HDL template</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>assign asi_in0_ready = 1'b0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>assign aso_out0_valid = 1'b0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>assign aso_out0_data = 32'b00000000000000000000000000000000;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>endmodule</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Quartus Prime Lite Editio</span>
<span>n</span>
<span>の</span>
<span>「</span>
<span>Fil</span>
<span>e</span>
<span>」メニューの</span>
<span>「</span>
<span>Save As</span>
<span>...</span>
<span>」をクリックして、</span>
<span>「</span>
<span>MyAdcAdapter.</span>
<span>v</span>
<span>」という名前で保存します。テンプレートの</span>
<span>「</span>
<span>clock_cl</span>
<span>k</span>
<span>」、</span>
<span>「</span>
<span>reset_rese</span>
<span>t</span>
<span>」はそれぞれ</span>
<span>「</span>
<span>csi_cl</span>
<span>k</span>
<span>」、</span>
<span>「</span>
<span>rsi_rese</span>
<span>t</span>
<span>」と変更する</span>
<span>と</span>
<span>Component Eddito</span>
<span>r</span>
<span>に読み込んだときクロック、リセットと認識してもらえます。</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>MyAdcAdapter.</span>
<span>v</span>
<span>」の内容を次のように変更します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>`timescale 1 ps / 1 ps</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>module MyAdcAdapter (</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; csi_clk,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; csi.clk</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rsi_reset,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rsi.reset</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [11:0] asi_in0_data,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; asi_in0.data</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asi_in0_valid,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .valid</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire [4:0]&nbsp; asi_in0_channel,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .channel</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asi_in0_startofpacket,&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .startofpacket</span>
 &nbsp;</p>
<p>&nbsp;<span>input&nbsp; wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asi_in0_endofpacket,&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .endofpacket</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>output wire [31:0] aso_out0_data,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // aso_out0.data</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aso_out0_valid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .valid</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg [11:0] asi_in0_data_d;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge csi_clk) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (rsi_reset) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>asi_in0_data_d &lt;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>end else begin</span>
 &nbsp;</p>
<p>&nbsp;<span>if (asi_in0_startofpacket)</span>
 &nbsp;</p>
<p>&nbsp;<span>asi_in0_data_d &lt;= asi_in0_data;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>assign aso_out0_data = { 4'b0000, asi_in0_data, 4'b0000, asi_in0_data_d };</span>
 &nbsp;</p>
<p>&nbsp;<span>assign aso_out0_valid = asi_in0_endofpacket;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>endmodule</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Platform Designe</span>
<span>r</span>
<span>に戻って</span>
<span>「</span>
<span>IP Catalo</span>
<span>g</span>
<span>」の</span>
<span>「</span>
<span>New</span>
<span>...</span>
<span>」をクリックし</span>
<span>、</span>
<span>Component Edito</span>
<span>r</span>
<span>を起動します。</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Nam</span>
<span>e</span>
<span>」と</span>
<span>「</span>
<span>Display nam</span>
<span>e</span>
<span>」を</span>
<span>「</span>
<span>MyAdcAdapte</span>
<span>r</span>
<span>」に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000190.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>File</span>
<span>s</span>
<span>」ページで、作成した</span>
<span>「</span>
<span>MyAdcAdapter.</span>
<span>v</span>
<span>」を読み込みます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000135.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000019.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000026.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Signals &amp; Interface</span>
<span>s</span>
<span>」ページに移動して</span>
<span>、</span>
<span>Erro</span>
<span>r、</span>
<span>Warnin</span>
<span>g</span>
<span>を解決します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000047.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>in</span>
<span>0</span>
<span>」、</span>
<span>「</span>
<span>out</span>
<span>0</span>
<span>」の</span>
<span>「</span>
<span>Associated Rese</span>
<span>t</span>
<span>」が</span>
<span>「</span>
<span>non</span>
<span>e</span>
<span>」になっているので</span>
<span>「</span>
<span>rese</span>
<span>t</span>
<span>」に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000164.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>in</span>
<span>0</span>
<span>」の</span>
<span>「</span>
<span>Data bits per symbo</span>
<span>l</span>
<span>」を</span>
<span>「</span>
<span>1</span>
<span>2</span>
<span>」に、</span>
<span>「</span>
<span>Maximum channe</span>
<span>l</span>
<span>」を</span>
<span>「</span>
<span>3</span>
<span>1</span>
<span>」変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000144.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>out</span>
<span>0</span>
<span>」の</span>
<span>「</span>
<span>Data bits per symbo</span>
<span>l</span>
<span>」を</span>
<span>「</span>
<span>3</span>
<span>2</span>
<span>」に変更します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000106.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Finish</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000057.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000108.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>12.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-56"><b>
<span><b>Platform Designer&nbsp;(Qsys</b></span>
<span><b>)</b></span>
<span><b>に追加</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>IP Catalo</span>
<span>g</span>
<span>に表示され</span>
<span>た</span>
<span>MyAdcAdapte</span>
<span>r</span>
<span>コンポーネントを選択し、</span>
<span>「</span>
<span>Add</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000118.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000067.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>クロック、リセット、モジュラ</span>
<span>ー</span>
<span>ADC I</span>
<span>P</span>
<span>コアの出力</span>
<span>、</span>
<span>MyTriggeredStorag</span>
<span>e</span>
<span>コンポーネントの入力の交点をクリックして接続します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000080.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Generat</span>
<span>e</span>
<span>」メニューの</span>
<span>「</span>
<span>Show Instantiation Template</span>
<span>...</span>
<span>」をクリックして、テンプレートをメモ帳にコピーしておきます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000101.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Generate HDL</span>
<span>...</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000030.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000150.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000024.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000168.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>top.</span>
<span>v</span>
<span>」を次のように変更します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>`timescale 1 ps / 1 ps</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>module top</span>
 &nbsp;</p>
<p>&nbsp;<span>(</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire CLK,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>input wire SPI_NSS,</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire SPI_MOSI,</span>
 &nbsp;</p>
<p>&nbsp;<span>output wire SPI_MISO,</span>
 &nbsp;</p>
<p>&nbsp;<span>input wire SPI_SCLK,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>output wire COMPLETE,</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>output wire [7:0] LED</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>reg spi_mosi;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire adc_clk;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire clk;</span>
 &nbsp;</p>
<p>&nbsp;<span>wire locked;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>wire [31:0] pio_0;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>always @(posedge SPI_SCLK) begin</span>
 &nbsp;</p>
<p>&nbsp;<span>spi_mosi &lt;= SPI_MOSI;</span>
 &nbsp;</p>
<p>&nbsp;<span>end</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>pll pll_inst (</span>
 &nbsp;</p>
<p>&nbsp;<span>.inclk0 (CLK),</span>
 &nbsp;</p>
<p>&nbsp;<span>.c0 (adc_clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.c1 (clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.locked (locked)</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>QsysCore QsysCore_inst (</span>
 &nbsp;</p>
<p>&nbsp;<span>.clk_clk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.reset_reset_n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (1'b1),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_mosi_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (spi_mosi),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_nss_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SPI_NSS),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_miso_to_and_from_the_spislave_inst_for_spichain (SPI_MISO),</span>
 &nbsp;</p>
<p>&nbsp;<span>.spi_slave_to_avalon_mm_master_bridge_0_export_0_sclk_to_the_spislave_inst_for_spichain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(SPI_SCLK),</span>
 &nbsp;</p>
<p>&nbsp;<span>.pio_0_external_connection_export&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (pio_0),</span>
 &nbsp;</p>
<p>&nbsp;<span>.modular_adc_0_adc_pll_clock_clk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (adc_clk),</span>
 &nbsp;</p>
<p>&nbsp;<span>.modular_adc_0_adc_pll_locked_export&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (locked),</span>
 &nbsp;</p>
<p>&nbsp;<span>.mytriggeredstorage_0_conduit_end_0_export&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (COMPLETE)</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>assign LED = pio_0[7:0];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>endmodule</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>12.3</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-57"><b>
<span><b>書き込み</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>「</span>
<span>Compile Desig</span>
<span>n</span>
<span>」を右クリックして</span>
<span>「</span>
<span>Star</span>
<span>t</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000109.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Compile Desig</span>
<span>n</span>
<span>」がエラー無く終了したことを確認します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000079.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Program Device (Open Programmer</span>
<span>)</span>
<span>」を右クリックして</span>
<span>「</span>
<span>Ope</span>
<span>n</span>
<span>」をクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000197.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>「</span>
<span>Star</span>
<span>t</span>
<span>」をクリックし</span>
<span>て</span>
<span>FPG</span>
<span>A</span>
<span>に書き込みます。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000049.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000112.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>以上でハードウェア側の準備が整いました。</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2><b>
<span><b>12.4</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-58"><b>
<span><b>アプリケーションを変更</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>Raspberry P</span>
<span>iと</span>
<span>FPG</span>
<span>A</span>
<span>が接続されたときモジュラ</span>
<span>ー</span>
<span>ADC I</span>
<span>P</span>
<span>コアのシーケンサーをスタートさせます。</span>
 &nbsp;</p>
<p>&nbsp;<span>CH</span>
<span>0と</span>
<span>CH</span>
<span>6の2</span>
<span>チャンネルのデータを取得するの</span>
<span>に</span>
<span>2u</span>
<span>s</span>
<span>掛かるので、アプリケーションのサンプル周期</span>
<span>を</span>
<span>2u</span>
<span>s</span>
<span>に変更します</span>
<span>。</span>
<span>CH</span>
<span>6は</span>
<span>CH</span>
<span>0</span>
<span>よ</span>
<span>り</span>
<span>1u</span>
<span>s</span>
<span>遅れてサンプリングされるので、グラフ上で</span>
<span>も</span>
<span>1u</span>
<span>s</span>
<span>遅れた位置にプロットされるようにします。</span>
 &nbsp;</p>
<p>&nbsp;<span>縦軸は電圧に換算して表示します。</span>
 &nbsp;</p>
<div>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td>
<p>&nbsp;<span>using</span>
<span>&nbsp;OxyPlot;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;OxyPlot.Axes;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;OxyPlot.Series;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;Rapidnack.Net;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Collections.Generic;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Threading.Tasks;</span>
 &nbsp;</p>
<p>&nbsp;<span>using</span>
<span>&nbsp;System.Windows.Forms;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>namespace</span>
<span>&nbsp;Max10Graph</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;</span>
<span>partial</span>
<span>&nbsp;</span>
<span>class</span>
<span>&nbsp;</span>
<span>Form1</span>
<span>&nbsp;: Form</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;PigpiodIf pigpiodIf;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;AvalonMM avalonMM =&nbsp;</span>
<span>new</span>
<span>&nbsp;AvalonMM();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_1 = 12;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;SERVO_2 = 13;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;COMPLETE = 26;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;NUM_CHANNELS = 2;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;NUM_SAMPLES = 512;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>const</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;AUTO_TRIGGER_MS = 100;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;CancellationTokenSource cts;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>bool</span>
<span>&nbsp;repeatRequested;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;PlotModel plotModel;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;LineSeries[] series;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;horizontal = 9;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;positionPct = 50;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;source = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;polarity = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>int</span>
<span>&nbsp;levelPct = 50;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>public</span>
<span>&nbsp;Form1()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>InitializeComponent();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;CloseConnection()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(cts !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Application.DoEvents();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(avalonMM.Stream !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(0x10, 0);&nbsp;&nbsp;</span>
<span>// Stop sequencer</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream.Dispose();</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_stop();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_Load(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf =&nbsp;</span>
<span>new</span>
<span>&nbsp;PigpiodIf();</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.StreamConnected&nbsp;+= (s, evt) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo1_CheckedChanged(checkBoxServo1,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo2_CheckedChanged(checkBoxServo2,&nbsp;</span>
<span>new</span>
<span>&nbsp;EventArgs());</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// CS2, 20MHz, Auxiliary SPI + Mode1</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.Stream =&nbsp;</span>
<span>new</span>
<span>&nbsp;SpiStream(pigpiodIf, 2, 20 * 1000000, 256 + 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(0x10, 1);&nbsp;</span>
<span>// Start sequencer</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(PigpiodIfException ex)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(ex.Message);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel =&nbsp;</span>
<span>new</span>
<span>&nbsp;PlotModel();</span>
 &nbsp;</p>
<p>&nbsp;<span>series =&nbsp;</span>
<span>new</span>
<span>&nbsp;LineSeries[NUM_CHANNELS];</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch] =&nbsp;</span>
<span>new</span>
<span>&nbsp;LineSeries();</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch].Title =&nbsp;</span>
<span>string</span>
<span>.Format(</span>
<span>"CH{0}"</span>
<span>, ch);</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Series.Add(series[ch]);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;fullScale = 3.3;</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;margin = fullScale * 0.05;</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.Axes.Add(</span>
 &nbsp;</p>
<p>&nbsp;<span>new</span>
<span>&nbsp;LinearAxis() { Position = AxisPosition.Left, Minimum = 0 - margin, Maximum = fullScale + margin }</span>
 &nbsp;</p>
<p>&nbsp;<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>trackBarHor.Value = horizontal;</span>
 &nbsp;</p>
<p>&nbsp;<span>trackBarPos.Value = positionPct;</span>
 &nbsp;</p>
<p>&nbsp;<span>foreach</span>
<span>&nbsp;(var s&nbsp;</span>
<span>in</span>
<span>&nbsp;series)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>comboBoxSource.Items.Add(s.Title);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>comboBoxSource.SelectedIndex = source;</span>
 &nbsp;</p>
<p>&nbsp;<span>comboBoxPol.SelectedIndex = polarity;</span>
 &nbsp;</p>
<p>&nbsp;<span>trackBarLevel.Value = levelPct;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;Form1_FormClosing(</span>
<span>object</span>
<span>&nbsp;sender, FormClosingEventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonOpen_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.pigpio_start(textBoxAddress.Text,&nbsp;</span>
<span>"8888"</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonClose_Click(</span>
<span>object</span>
<span>&nbsp;sender, System.EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>CloseConnection();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>panelOperation.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonOpen.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonClose.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>async</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStart_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>do</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>bool</span>
<span>&nbsp;complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>PigpiodIf.Callback callback = pigpiodIf.callback(COMPLETE, PigpiodIf.RISING_EDGE, (gpio, level, tick, user) =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>});</span>
 &nbsp;</p>
<p>&nbsp;<span>try</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>new</span>
<span>&nbsp;CancellationTokenSource();</span>
 &nbsp;</p>
<p>&nbsp;<span>var</span>
<span>&nbsp;ct = cts.Token;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Run(</span>
<span>async</span>
<span>&nbsp;() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>&nbsp;addr = 0x10000;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>[] divs =&nbsp;</span>
<span>new</span>
<span>&nbsp;</span>
<span>int</span>
<span>[] { 1000, 500, 200, 100, 50, 20, 10, 5, 2, 1 };</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;div = divs[horizontal];</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;position = ((NUM_SAMPLES - 1) * positionPct) / 100;</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;level = (4095 * levelPct) / 100;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x201 * 4, (</span>
<span>uint</span>
<span>)div);</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x202 * 4, (</span>
<span>uint</span>
<span>)position);</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x203 * 4, (</span>
<span>uint</span>
<span>)source);</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x204 * 4, (</span>
<span>uint</span>
<span>)polarity);</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x205 * 4, (</span>
<span>uint</span>
<span>)level);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>DateTime lastAccessTime = DateTime.Now;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>List&lt;DataPoint&gt;[] dataPoints =&nbsp;</span>
<span>new</span>
<span>&nbsp;List&lt;DataPoint&gt;[NUM_CHANNELS];</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[ch] =&nbsp;</span>
<span>new</span>
<span>&nbsp;List&lt;DataPoint&gt;();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;deltaT = (1.0 /&nbsp;</span>
<span>0.5e6</span>
<span>) * div;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>while</span>
<span>&nbsp;(!ct.IsCancellationRequested &amp;&amp; !complete)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;leftInMS = (</span>
<span>int</span>
<span>)(deltaT * 1000 * NUM_SAMPLES + AUTO_TRIGGER_MS) - (</span>
<span>int</span>
<span>)(DateTime.Now - lastAccessTime).TotalMilliseconds;</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(leftInMS &lt;= 0)</span>
 &nbsp;</p>
<p>&nbsp;<span>break</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>await</span>
<span>&nbsp;Task.Delay(Math.Min(leftInMS, 10), ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>uint</span>
<span>[] res;</span>
 &nbsp;</p>
<p>&nbsp;<span>lock</span>
<span>&nbsp;(avalonMM.LockObject)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>res = avalonMM.ReadUInt32Packet(NUM_SAMPLES, addr,&nbsp;</span>
<span>true</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>complete =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>avalonMM.WriteUInt32Packet(addr + 0x200 * 4, 1);</span>
 &nbsp;</p>
<p>&nbsp;<span>lastAccessTime = DateTime.Now;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(res.Length != NUM_SAMPLES)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>Console.WriteLine(</span>
<span>"the response size {0} not equal to the requested size {1}"</span>
<span>, res.Length, NUM_SAMPLES);</span>
 &nbsp;</p>
<p>&nbsp;<span>continue</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[ch].Clear();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;i = 0; i &lt; res.Length; i++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;d1 = (</span>
<span>int</span>
<span>)(res[i] &amp; 0xffff);</span>
 &nbsp;</p>
<p>&nbsp;<span>int</span>
<span>&nbsp;d2 = (</span>
<span>int</span>
<span>)((res[i] &gt;&gt; 16) &amp; 0xffff);</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;v1 = 3.3 * (d1 / 4096.0);</span>
 &nbsp;</p>
<p>&nbsp;<span>double</span>
<span>&nbsp;v2 = 3.3 * (d2 / 4096.0);</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[0].Add(</span>
<span>new</span>
<span>&nbsp;DataPoint(deltaT * (i - position),&nbsp;</span>
<span>v1</span>
<span>));</span>
 &nbsp;</p>
<p>&nbsp;<span>dataPoints[1].Add(</span>
<span>new</span>
<span>&nbsp;DataPoint(deltaT * (i - position)&nbsp;</span>
<span>+ 1e-6</span>
<span>,&nbsp;</span>
<span>v2</span>
<span>));</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>Invoke(</span>
<span>new</span>
<span>&nbsp;Action(() =&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>for</span>
<span>&nbsp;(</span>
<span>int</span>
<span>&nbsp;ch = 0; ch &lt; NUM_CHANNELS; ch++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch].Points.Clear();</span>
 &nbsp;</p>
<p>&nbsp;<span>series[ch].Points.AddRange(dataPoints[ch]);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>plotModel.InvalidatePlot(</span>
<span>true</span>
<span>);</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(plotView1.Model != plotModel)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Model = plotModel;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>plotView1.Invalidate();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}));</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}, ct);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>catch</span>
<span>&nbsp;(OperationCanceledException)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>// nothing to do</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>finally</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(callback !=&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.callback_cancel(callback);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts =&nbsp;</span>
<span>null</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStart.Enabled =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>buttonStop.Enabled =&nbsp;</span>
<span>false</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}&nbsp;</span>
<span>while</span>
<span>&nbsp;(repeatRequested);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;buttonStop_Click(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;checkBoxServo1_CheckedChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo1.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, (UInt32)trackBarServo1.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo1_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo1.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_1, (UInt32)trackBarServo1.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo1.Checked =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;checkBoxServo2_CheckedChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo2.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, (UInt32)trackBarServo2.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, 0);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarServo2_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(checkBoxServo2.Checked)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pigpiodIf.set_servo_pulsewidth(SERVO_2, (UInt32)trackBarServo2.Value);</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>checkBoxServo2.Checked =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarHor_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts ==&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>horizontal = trackBarHor.Value;</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarPos_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts ==&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>positionPct = trackBarPos.Value;</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;comboBoxSource_SelectedIndexChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts ==&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>source = comboBoxSource.SelectedIndex;</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;comboBoxPol_SelectedIndexChanged(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts ==&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>polarity = comboBoxPol.SelectedIndex;</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>private</span>
<span>&nbsp;</span>
<span>void</span>
<span>&nbsp;trackBarLevel_Scroll(</span>
<span>object</span>
<span>&nbsp;sender, EventArgs e)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if</span>
<span>&nbsp;(cts ==&nbsp;</span>
<span>null</span>
<span>)</span>
 &nbsp;</p>
<p>&nbsp;<span>return</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>levelPct = trackBarLevel.Value;</span>
 &nbsp;</p>
<p>&nbsp;<span>repeatRequested =&nbsp;</span>
<span>true</span>
<span>;</span>
 &nbsp;</p>
<p>&nbsp;<span>cts.Cancel();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ビルドして実行します。</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000130.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1><b>
<span><b>13</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-59"><b>
<span><b>Raspberry P</b></span>
<span><b>i</b></span>
<span><b>で実行</b></span>
</b></a>
</b></h1>
<h2><b>
<span><b>13.1</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-60"><b>
<span><b>Raspberry P</b></span>
<span><b>i</b></span>
<span><b>で実行（リモートデスクトップ）</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>Raspberry P</span>
<span>i</span>
<span>に接続し</span>
<span>た</span>
<span>LC</span>
<span>D</span>
<span>と同様に、リモートデスクトップを開いたときもアプリケーションが全画面で実行されます</span>
<span>。</span>
<span><b>Alt+F1</b></span>
<span><b>1</b></span>
<span>キーで全画面表示を解除できます。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ソリューショ</span>
<span>ン</span>
<span>Max10Grap</span>
<span>hを</span>
<span>ZI</span>
<span>P</span>
<span>ファイルに纏め</span>
<span>て</span>
<span>Raspberry P</span>
<span>i</span>
<span>のリモートデスクトップのファイルマネージャにコピー＆ペーストして解凍します。解凍したディレクトリ</span>
<span>の</span>
<span>Max10Graph/Max10Graph/bin/Debu</span>
<span>g</span>
<span>に移動し</span>
<span>、</span>
<span>Max10Graph.ex</span>
<span>e</span>
<span>をダブルクリックします。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>詳しい手順は、前々作</span>
<span>「</span>
<span>Visual Studio C</span>
<span>#で</span>
<span>Raspberry Pi</span>
<span>&nbsp;</span>
<span>リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>導入編」をご覧ください。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000082.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><b>
<span><b>13.2</b></span>
<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<a id="calibre_link-61"><b>
<span><b>Raspberry P</b></span>
<span><b>i</b></span>
<span><b>で実行（小</b></span>
<span><b>型</b></span>
<span><b>LC</b></span>
<span><b>D</b></span>
<span><b>）</b></span>
</b></a>
</b></h2>
<p>&nbsp;<span>リモートデスクトップで動作を確認できたので、リモートデスクトップ</span>
<span>の</span>
<span>LXTermina</span>
<span>l</span>
<span>から</span>
<span>「</span>
<span>sudo reboo</span>
<span>t</span>
<span>」を入力して再起動します</span>
<span>。</span>
<span>Raspberry P</span>
<span>iの</span>
<span>LC</span>
<span>D</span>
<span>に全画面表示されるアプリケーションも更新されるので動作を確認します。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>詳しい手順は、前々作</span>
<span>「</span>
<span>Visual Studio C</span>
<span>#で</span>
<span>Raspberry Pi</span>
<span>&nbsp;</span>
<span>リモー</span>
<span>ト</span>
<span>GPI</span>
<span>O</span>
<span>導入編」をご覧ください。</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000181.jpg" alt="" />
</p>
</div>
</div>


<script>function myFunction(){document.getElementById("tateyoko").classList.toggle("tateread")}</script></body></html>