<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Embedded System Advanced 4ã€€æ—¥æœ¬èªç‰ˆ: Training material for engineer Discover! How? (NGO TAMA)</title>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/css/mainday.css" title="default">
<link rel="alternate stylesheet" href="/css/mainnight.css" title="alternate">
<script type="text/javascript" src="/js/styleswitcher.js"></script>
<script type="text/javascript" src="/js/global.js"></script>
</head>
<body>
<div class="novelpage">
<div class="novelbody">
<div id="tateyoko">
<div id="_top"></div>
<a href="/">ğŸ </a>&emsp;
<a href="#" onclick="setActiveStyleSheet('default'); return false;">æ—¥</a>&emsp;
<a href="#" onclick="setActiveStyleSheet('alternate'); return false;">æœˆ</a>&emsp;
<a href="#_top" onclick="myFunction()" style="cursor: pointer;">ç¸¦æ›¸ãï¼æ¨ªæ›¸ã</a>
<div id="calibre_link-33">
<div>
<div>
<table class="noveltitle">
<tr>
<td colspan="2"><i><span><i>Embedded System Advanced 4ã€€æ—¥æœ¬èªç‰ˆ: Training material for engineer Discover! How? (NGO TAMA)</i></span></i></td>
</tr>
<tr>
                    
                    
      </tr>
<tr>
<td colspan="2">NGO TAMA</td>
</tr>
<tr>
<td colspan="2">ENUJIHOH TAMA (2017)</td>
</tr>
<tr>
<td colspan="2"></td>
</tr>
</table>
<div></div>
</div>
<div></div>
</div>
</div>



<div id="calibre_link-0">
<div>
<p>&nbsp;<span>ç›®æ¬¡</span>
 &nbsp;</p>
<p>&nbsp;<a id="calibre_link-34"></a>
<a href="#calibre_link-1">
<span><u>[1]&nbsp;äº¤æµæ³¢å½¢ã®ä½œæˆ</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-2">
<span><u>[2]&nbsp;ä½ç›¸èª¿æ•´</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-3">
<span><u>[3]&nbsp;å‘¨æ³¢æ•°å¤‰æ›´</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-4">
<span><u>[4]&nbsp;ä¸‰ç›¸äº¤æµæ³¢å½¢</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-5">
<span><u>[5]&nbsp;é«˜é€Ÿã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-6">
<span><u>(1)&nbsp;ä¸‰ç›¸äº¤æµæ³¢å½¢ã®å–å¾—</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-7">
<span><u>(2)&nbsp;äº¤æµæ³¢å½¢ã®ä¿å­˜</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-8">
<span><u>(3)&nbsp;å‡¦ç†çŠ¶æ³è¡¨ç¤º</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-9">
<span><u>[6]&nbsp;ä¸å…·åˆã®ç™ºç”Ÿ</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-10">
<span><u>[7]&nbsp;é–“å¼•ã</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-11">
<span><u>(1)&nbsp;ç›¸é–“ã®é–“éš”</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-12">
<span><u>(2)&nbsp;å®Ÿç”¨è¨ˆç®—</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-13">
<span><u>[8]&nbsp;å›è»¢æ•°è¨ˆç®—ã®å†è€ƒ</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-14">
<span><u>[9]&nbsp;å‘¨æœŸã®è¨ˆç®—</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-15">
<span><u>(1)&nbsp;å‘¨æœŸã®ç¢ºèª</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-16">
<span><u>[10]&nbsp;é›»åœ§ã€é›»æµã®è¨ˆç®—</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-17">
<span><u>(1)&nbsp;é›»åœ§ã€é›»æµã®ç¢ºèª</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-18">
<span><u>[11]&nbsp;é›»åŠ›ã®è¨ˆç®—</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-19">
<span><u>(1)&nbsp;é›»åŠ›ã€åŠ›ç‡ã®ç¢ºèª</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-20">
<span><u>[12]&nbsp;å¾®èª¿æ•´</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-21">
<span><u>(1)&nbsp;è¨ˆç®—é–‹å§‹</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-22">
<span><u>(2)&nbsp;æ³¢å½¢ç”Ÿæˆ</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-23">
<span><u>(3)&nbsp;åœæ­¢å¾Œã®å‡¦ç½®</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-24">
<span><u>(4)&nbsp;æ™‚åˆ†å‰²</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-25">
<span><u>[13]&nbsp;ãƒ‘ã‚½ã‚³ãƒ³ãƒ¢ãƒ‹ã‚¿ãƒ¼</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-26">
<span><u>(1)&nbsp;èª­å‡ºã—æŒ‡ç¤º</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-27">
<span><u>(2)&nbsp;èª­å‡ºã—æŒ‡ç¤ºå¿œç­”</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-28">
<span><u>(3)&nbsp;æ›¸ãè¾¼ã¿æŒ‡ç¤ºå¿œç­”</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-29">
<span><u>[14]&nbsp;å®Ÿæ©Ÿç”¨ã«å¤‰æ›´</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-30">
<span><u>(1)&nbsp;å®Ÿæ©Ÿç”¨ã«å®Ÿè£…</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-31">
<span><u>(2)&nbsp;å‹•ä½œç¢ºèª</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;<a href="#calibre_link-32">
<span><u>[15]&nbsp;ã‚ã¨ãŒã</u></span>
</a>
 &nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<p>&nbsp;<span>[æ¦‚è¦]</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®ç« ã§ã¯ã€ç™ºé›»ã—ãŸé›»åœ§ã¨é›»æµã‚’æ¸¬å®šã™ã‚‹æ–¹æ³•ã‚’å–ã‚Šä¸Šã’ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã•ã‚‰ã«å®Ÿç”¨ã‚·ã‚¹ãƒ†ãƒ ã«ã¨ã£ã¦å¿…è¦ãªãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚‚æ‰±ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h1>
<a id="calibre_link-1">
<span>[1]&nbsp;äº¤æµæ³¢å½¢ã®ä½œæˆ</span>
</a>
</h1>
<p>&nbsp;<span>ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä½œæˆæ®µéšã§ã¯ã€ç™ºé›»æ©Ÿã‚’å‹•ä½œã•ã›ãªã„ã§ã€å¤–éƒ¨ã‹ã‚‰äº¤æµæ³¢å½¢ã‚’å…¥ã‚Œã¦æ¨¡æ“¬ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®MPUã«ã¯ã€2ãƒãƒ£ãƒ³ãƒãƒ«ã®ï¼˜ãƒ“ãƒƒãƒˆDAå¤‰æ›å™¨ãŒã‚ã‚‹ã®ã§ã€å…ˆãšã€ã“ã‚Œã‚’ä½¿ã„äº¤æµé›»åœ§ã¨ä½ç›¸ã®ãšã‚ŒãŸäº¤æµé›»æµã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000017.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>200usã®å‰²ã‚Šè¾¼ã¿ã§ã€50Hzã®æ³¢å½¢ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;hwsetup.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//Interrupt priority</span>
 &nbsp;</p>
<p>&nbsp;<span>//-----------------------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>INTC.IPR11.BIT._MTU25 =&nbsp;10&nbsp;;</span>
<span>//MTU25.TIER.BIT.TGIU_5 DAC</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//Multifunction timer</span>
 &nbsp;</p>
<p>&nbsp;<span>//-----------------------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>//The DA conversion trigger using the MTU2 channel 5U</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU25.TCRU.BIT.TPSC = 2 ;&nbsp;&nbsp; //MTU2 clock :PÏ†/16&nbsp; = 0.32us</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU25.TIORU.BIT.IOC = 0 ;&nbsp;&nbsp; //TIC5U&nbsp; compare match&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU25.TIER.BIT.TGIEU = 1 ;&nbsp; //1ï¼šCMFU5&nbsp; interrupt</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU25.TCCR.BIT.CLRU = 1 ;&nbsp; //1ï¼šTCNTU_5 clear</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU25.TCNTU = 0 ;&nbsp;</span>
<span>&nbsp;// Timer counter</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU25.TGRU = 625 ;&nbsp;</span>
<span>&nbsp;// 625 * 0.32us =200us</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//-----------------------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>//DAC</span>
 &nbsp;</p>
<p>&nbsp;<span>DAC.DADR0 = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>DAC.DADR1 = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>DAC.DACR.BYTE = 0xFF ;</span>
<span>//1111 1111 ãƒãƒ£ãƒãƒ« 0,1 ã® D/A å¤‰æ›ã‚’è¨±å¯</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>æ–°è¦ã«DAå¤‰æ›ç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>é–‹ç™ºç’°å¢ƒã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã«math.hã‚’å«ã‚ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Dac.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; FILE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Dac.cpp</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; DESCRIPTION : Digital to Analog Conversion</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; CPU TYPE&nbsp;&nbsp;&nbsp; : SH7286</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; DATE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Nov 01, 2016</span>
 &nbsp;</p>
<p>&nbsp;<span>//&nbsp; VERSION ï¼š1.0&nbsp;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•</span>
 &nbsp;</p>
<p>&nbsp;<span>#include &lt;math.h&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "iodefine.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>extern "C" {</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "vect.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "common.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "proto.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>#define PI&nbsp;&nbsp;&nbsp; 3.14159265</span>
 &nbsp;</p>
<p>&nbsp;<span>static int&nbsp;pitch&nbsp;;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//--------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>// Functions</span>
 &nbsp;</p>
<p>&nbsp;<span>//--------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitDac()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pitch&nbsp;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU25.TSTR.BIT.CSTU = 1 ;</span>
<span>//MTU25U&nbsp; ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//200uså‰²ã‚Šè¾¼ã¿æ¯ã«ã€SINå€¤ã‚’è¨ˆç®—ã—ã¦å‡ºåŠ›ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>// 196 MTU2 MTU5 TGIU5</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2_MTU5_TGIU5(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( MTU25.TSR.BIT.CMFU == 1 )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU25.TSR.BIT.CMFU = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>double angle = (2*PI*pitch&nbsp;) / 100 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>double val = sin(angle) * 127 + 127;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DAC.DADR0 = (unsigned char )val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>angle -= PI / 6 ;</span>
<span>//-30deg</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sin(angle) * 127 + 127;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DAC.DADR1 = (unsigned char )val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++pitch&nbsp;&gt;= 100 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>pitch&nbsp;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Main.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void main(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>InitDac();</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>while ( 1 )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å¦‚ä½•ã§ã™ã‹ï¼Ÿã€€æ­£ã—ã50Hzã®äº¤æµæ³¢å½¢ãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000008.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h1>
<a id="calibre_link-2">
<span>[2]&nbsp;ä½ç›¸èª¿æ•´</span>
</a>
</h1>
<p>&nbsp;<span>ã§ã¯æ¬¡ã«ã€é›»æµã®é…ã‚Œä½ç›¸ã‚’èª¿æ•´å‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã¯ã€å¾Œã§åŠ›ç‡ã‚’ç¢ºèªã™ã‚‹æ™‚ã«å½¹ç«‹ã¡ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ†ã‚¹ãƒˆã§ã¯ã€æ°´æ¸©ã®å…¥åŠ›ç«¯å­ã«å¯å¤‰æŠµæŠ—å™¨ã‚’ä»˜ã‘ã¦è¡Œã„ã¾ã™ã€‚å®Ÿæ¸¬ã—ãŸå…¥åŠ›ã®æœ€å¤§ADå€¤ã¯ç´„3800ã§ã™ã€‚ã“ã®ç¯„å›²ã§ï¼ã‹ã‚‰90åº¦ï¼ˆPI/2ï¼‰ã¾ã§ä½ç›¸ã‚’å¤‰åŒ–ã•ã›ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¾ãŸã€DAå¤‰æ›å™¨ã¯é«˜é€Ÿã§å‹•ä½œã—ã¦ã„ã‚‹ã®ã§ã€ä½ç›¸å€¤ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦æ¸¡ã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>#define TEST</span>
<span>1</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>// Global data</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>extern double g_delay ;</span>
<span>//ä½ç›¸é…ã‚Œ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void Analog()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>#ifdef TEST</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ä½ç›¸é…ã‚Œ</span>
 &nbsp;</p>
<p>&nbsp;<span>g_delay = ( adcVal[P_Ai03] * 1.570) / 3800 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>#endif</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Dac.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>// Global data</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>double g_delay ;</span>
<span>//ä½ç›¸é…ã‚Œ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitDac()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>g_delay = 0.0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2_MTU5_TGIU5(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DAC.DADR0 = (unsigned char )val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>angle&nbsp;-=&nbsp;g_delay&nbsp;;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sin(angle) * 127 + 127;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã‚Œã§VRã‚’å›ã™ã¨ä½ç›¸ãŒå¤‰åŒ–ã™ã‚‹ã®ãŒç¢ºèªå‡ºæ¥ã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-3">
<span>[3</span>
<span>]</span>
<span>&nbsp;å‘¨æ³¢æ•°å¤‰æ›´</span>
</a>
</h1>
<p>&nbsp;<span>ä»Šåº¦ã¯ã€å‘¨æ³¢æ•°ã‚’å¤‰æ›´å‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å‘¨æ³¢æ•°ã¯ãƒ†ã‚¹ãƒˆç”¨å›è»¢æ•°å¤‰æ›´VRã¨é€£å‹•ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å›è»¢æ•°ã¯Rotate.cppå†…ã®ChangeRotation()ãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ã§å¾—ã‚‰ã‚Œã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å›è»¢æ•°(R rpm)ã¨å‘¨æ³¢æ•°(F Hz)ã®é–¢ä¿‚ã¯</span>
 &nbsp;</p>
<p>&nbsp;<span>F(Hz) = R(rpm) / 30 ;&nbsp;</span>
<span>(1)</span>
 &nbsp;</p>
<p>&nbsp;<span>DAå¤‰æ›ã®å‘¨æœŸ(P)ã¨å‘¨æ³¢æ•°(F)ã®é–¢ä¿‚ã¯ã€0.32usã®ã‚¯ãƒ­ãƒƒã‚¯ã‚’ä½¿ã„ã€æ³¢å½¢ã‚’100åˆ†å‰²ã—ã¦ã„ã‚‹ã®ã§</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼° = 1000000 / ( F * 0.32 * 100 )</span>
 &nbsp;</p>
<p>&nbsp;<span>= 1000 / ( F * 0.32 )</span>
 &nbsp;</p>
<p>&nbsp;<span>= 300000 / ( R * 0.32 )</span>
 &nbsp;</p>
<p>&nbsp;<span>= 937500 / R</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ç¾åœ¨ã¯R=1500ã§P=625ã‚’ã‚»ãƒƒãƒˆã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å›è»¢æ•°(R)ã‚’ChangeRotation()ã‹ã‚‰DAå´ã«é€ã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Rotate.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//å›è»¢æ•°å¤‰æ›´</span>
 &nbsp;</p>
<p>&nbsp;<span>void ChangeRotation(int val)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if (( oldSet &gt;&gt; 2 ) != ( val &gt;&gt; 2 ))</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>newSet = NUMERATOR3 / y;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ChangeHelz( y );</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å›è»¢æ•°ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã«ã€DAå´ã§å¤‰æ›å‘¨æœŸã‚’å¤‰æ›´ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Dac.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>#define NUMERATOR</span>
<span>937500L</span>
 &nbsp;</p>
<p>&nbsp;<span>static short nowRpm ;</span>
<span>//ç¾åœ¨å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>static short oldRpm ;</span>
<span>//å‰å›å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitDac()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>nowRpm = 400;</span>
 &nbsp;</p>
<p>&nbsp;<span>oldRpm = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2_MTU5_TGIU5(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( MTU25.TSR.BIT.CMFU == 1 )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++pitch &gt;= 100 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>pitch = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm != oldRpm )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>oldRpm = nowRpm ;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU25.TGRU = NUMERATOR / nowRpm ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void ChangeHelz( int rpm )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( rpm &lt; 400 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>nowRpm = 400 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( rpm &gt; 2700 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>nowRpm = 2700 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>nowRpm = rpm ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>æ³¢å½¢ã‚’è¦³æ¸¬ã—ã¦ã€å‘¨æ³¢æ•°ã®å¤‰åŒ–ã‚’ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000010.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>Period = 25ms, Frequency=40Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000012.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>Period = 20ms, Frequency=50Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000005.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>Period = 15ms, Frequency=67Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®æ™‚ç‚¹ã§ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å¹³å‡&nbsp;&nbsp;30us</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰æœ€å¤§&nbsp;&nbsp;4.4ms</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰æœ€å°&nbsp; 20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã—ãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-4">
<span>[4</span>
<span>]</span>
<span>&nbsp;ä¸‰ç›¸äº¤æµæ³¢å½¢</span>
</a>
</h1>
<p>&nbsp;<span>å®Ÿéš›ã®å•é¡Œã¨ã—ã¦ã€è£…ç½®ã®äº¤æµæ³¢å½¢ã®ã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›ç«¯å­ã¯é«˜é›»åœ§ã‚’å…¥åŠ›ã™ã‚‹ã‚ˆã†ã«ä½œã‚‰ã‚Œã¦ã„ã‚‹ã®ã§ã€DAå‡ºåŠ›é›»åœ§ã‚’ç›´æ¥ã«å…¥åŠ›ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã›ã‚“ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ãã“ã§ãƒ†ã‚¹ãƒˆæ™‚ç‚¹ã§ã¯ã€é›»ç·šã§æ¥ç¶šã‚’ã—ãªã„ã§ã€DAå´ã§è¨ˆç®—ã—ãŸå€¤ã‚’ADå´ã§å—ã‘å–ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›ç«¯å­ã®æœ€å¤§å…¥åŠ›é›»åœ§å€¤ã¯425Vã§ã™ã€‚325VãŒå…¥åŠ›ã•ã‚ŒãŸæ™‚ã«ã€å®ŸåŠ¹é›»åœ§å€¤230Vã«ãªã‚‹ã‚ˆã†ã«æ³¢é«˜å€¤ã‚’èª¿æ•´ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>DAå´ã§ä¸‰ç›¸äº¤æµæ³¢å½¢å€¤ã‚’ç”Ÿæˆã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Dac.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>#define TEST</span>
<span>1</span>
<span>//ç–‘ä¼¼é›»åœ§ã€é›»æµãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>// Global data</span>
 &nbsp;</p>
<p>&nbsp;<span>// ------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned int g_voltage[3] ;</span>
<span>//é›»åœ§</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned int g_current[3] ;</span>
<span>//é›»æµ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>//300vã®æœ€å¤§å€¤425V</span>
 &nbsp;</p>
<p>&nbsp;<span>//230Vã®æœ€å¤§å€¤325V</span>
 &nbsp;</p>
<p>&nbsp;<span>//æ¯”ç‡ã€€325/425=0.76</span>
 &nbsp;</p>
<p>&nbsp;<span>//è¨ˆç®—ã®ç°¡ç•¥åŒ–ã®ãŸã‚ã« 0.76 * 2047 = 1565.35</span>
 &nbsp;</p>
<p>&nbsp;<span>#define RATE</span>
<span>1565.35</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitDac()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_voltage[n] = 0 ;</span>
<span>//é›»åœ§</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_current[n] = 0 ;</span>
<span>//é›»æµ</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU25.TSTR.BIT.CSTU = 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2_MTU5_TGIU5(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( MTU25.TSR.BIT.CMFU == 1 )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU25.TSR.BIT.CMFU = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add&nbsp;ï¼† modify&nbsp;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>#ifdef TEST</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//U phase</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>double angleA = (2*PI*pitch&nbsp;) / 100 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>double val = sin(angleA) * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_voltage[0] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DAC.DADR0 = g_voltage[0] &gt;&gt; 4 ;</span>
<span>//12bit =&gt; 8 bit</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>double angleB = angleA&nbsp;-&nbsp;g_delay ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sin(angleB) * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_current[0] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DAC.DADR1 = g_current[0] &gt;&gt; 4 ;//12bit =&gt; 8 bit</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//V phase</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>angleA -= ( 2 * PI ) / 3 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sin(angleA) * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_voltage[1] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>DAC.DADR1 = g_voltage[1] &gt;&gt; 4 ;</span>
<span>//12bit =&gt; 8 bit</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>angleB = angleA&nbsp;-&nbsp;g_delay ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sin(angleB) * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_current[1] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//W phase</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>angleA -= ( 2 * PI ) / 3 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sin(angleA) * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_voltage[2] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>DAC.DADR1 = g_voltage[2] &gt;&gt; 4 ;</span>
<span>//12bit =&gt; 8 bit</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>angleB = angleA&nbsp;-&nbsp;g_delay ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sin(angleB) * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_current[2] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>#else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>double angle = (2*PI*pitch&nbsp;) / 100 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DAC.DADR1 = (unsigned char )val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>#endif</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++pitch &gt;= 100 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>pitch = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã‚Œã§ã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›å´ã«æ¸¡ã™å€¤ã®æº–å‚™ãŒå‡ºæ¥ã¾ã—ãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>æ³¢å½¢ã‚’è¦³æ¸¬ã—ã¦ã€ä¸‰ç›¸äº¤æµã®ä½ç›¸ã®ã‚ºãƒ¬ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰Uç›¸ã¨Vç›¸é›»åœ§ã®ä½ç›¸å·®ã€€6.72msï¼120.96åº¦</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000020.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰Uç›¸ã¨Wç›¸é›»åœ§ã®ä½ç›¸å·®ã€€13.34msï¼240.12åº¦</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000000.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-5">
<span>[5</span>
<span>]</span>
<span>&nbsp;é«˜é€Ÿã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°</span>
</a>
</h1>
<p>&nbsp;<span>ä¸‰ç›¸äº¤æµæ³¢å½¢ã‚’é«˜é€Ÿã§ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‡ºæ¥ã‚‹ã‚ˆã†ã«ã€ã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›å´ã‚’å¤‰æ›´ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›ãƒãƒ¼ãƒˆã¯ä¸‹å›³ã®ã‚ˆã†ã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000015.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å®ŸåŠ¹å€¤ã§+/-300Vã®é›»åœ§ãŒã€é€”ä¸­ã®å›è·¯ã§+/-5Vã«å¤‰æ›ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸã€é›»æµã‚‚å®ŸåŠ¹å€¤ã§+/-100AãŒã€+/-5Vã«å¤‰æ›ã•ã‚Œã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼¡ï¼¤å¤‰æ›ã¯ãƒãƒ«ãƒãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼MTU20ã‚’ä½¿ã£ã¦ã€50Hzã®äº¤æµæ³¢å½¢ã‚’200usã§ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-6">
<span>(1) ä¸‰ç›¸äº¤æµæ³¢å½¢ã®å–å¾—</span>
</a>
</h2>
<p>&nbsp;<span>ã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›ãƒãƒ¼ãƒˆã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;hwsetup.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒãƒ«ãƒãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>//-----------------------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>//The AD conversion trigger using the MTU2 channel 0</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU20.TCR.BIT.CKEG = 1 ;</span>
<span>//01ï¼šç«‹ã¡ä¸‹ãŒã‚Šã‚¨ãƒƒã‚¸ã§ã‚«ã‚¦ãƒ³ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU20.TCR.BIT.TPSC = 1 ;</span>
<span>&nbsp;//å†…éƒ¨ã‚¯ãƒ­ãƒƒã‚¯ï¼šPÏ†ï¼4 ã§ã‚«ã‚¦ãƒ³ãƒˆ 4/50MHz&nbsp; = 0.08us</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU20.TMDR.BYTE = 0 ;</span>
<span>//é€šå¸¸å‹•ä½œ</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU20.TCNT = 0 ;</span>
<span>// Timer counter</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU20.TGRA = 2500 ;</span>
<span>// 2500 * 0.08us = 200us</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ†ã‚¹ãƒˆæ™‚ã«ã¯ã€DACå´ã§ç”Ÿæˆã—ãŸå€¤ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>#define TEST</span>
<span>1</span>
<span>//DAå´ã§ç”Ÿæˆã—ãŸå€¤ã‚’èª­ã‚€</span>
 &nbsp;</p>
<p>&nbsp;<span>// Global data</span>
 &nbsp;</p>
<p>&nbsp;<span>extern unsigned int g_voltage[3] ;</span>
<span>//é›»åœ§</span>
 &nbsp;</p>
<p>&nbsp;<span>extern unsigned int g_current[3] ;</span>
<span>//é›»æµ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI1(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC1.ADSR.BIT.ADF = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &amp; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>#ifdef TEST</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[4] = g_voltage[0] ;</span>
<span>// ç™ºé›»é›»åœ§(U)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[5] = g_current[0] ;</span>
<span>// ç™ºé›»é›»æµ(U)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[6] = g_voltage[1] ;</span>
<span>// ç™ºé›»é›»åœ§(V)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[7] = g_current[1] ;</span>
<span>// ç™ºé›»é›»æµ(V)</span>
 &nbsp;</p>
<p>&nbsp;<span>#else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[4] = ADC1.ADDR4 ;</span>
<span>//&nbsp;ç™ºé›»é›»åœ§(U)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[7] = ADC1.ADDR7 ;</span>
<span>//&nbsp;ç™ºé›»é›»æµ(V)</span>
 &nbsp;</p>
<p>&nbsp;<span>#endif</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC2.ADCR.BIT.ADST = 1 ;</span>
<span>//ADC2å¤‰æ›ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI2(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC2.ADSR.BIT.ADF = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>#ifdef TEST</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[8] = g_voltage[2] ;</span>
<span>// ç™ºé›»é›»åœ§(W)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[9] = g_current[2] ;</span>
<span>// ç™ºé›»é›»æµ(W)</span>
 &nbsp;</p>
<p>&nbsp;<span>#else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[8] = ADC2.ADDR8 ;</span>
<span>//&nbsp;ç™ºé›»é›»åœ§(W)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[9] = ADC2.ADDR9 ;</span>
<span>//&nbsp;ç™ºé›»é›»æµ(W)</span>
 &nbsp;</p>
<p>&nbsp;<span>#endif</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[10] = ADC2.ADDR10 ;</span>
<span>// è¡¨ç¤ºé¸æŠVR</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-7">
<span>(2) äº¤æµæ³¢å½¢ã®ä¿å­˜</span>
</a>
</h2>
<p>&nbsp;<span>ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã—ãŸäº¤æµæ³¢å½¢ã‚’ä¿å­˜ã—ã¦ã€å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãŒæƒã£ãŸæ™‚ç‚¹ã§è¨ˆç®—ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ãªãŠã€äº¤æµæ³¢å½¢ã®é›»åœ§å€¤ã®è¨ˆç®—æ–¹æ³•ã¯ã€ã“ã®ã€ŒDiscover! How?ã€ã‚·ãƒªãƒ¼ã‚ºã®ã€ŒFrequency+Voltage&amp;Current+VisualC#ã€ã«è©³ã—ãæ²è¼‰ã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>#define HALFBUF</span>
<span>120</span>
 &nbsp;</p>
<p>&nbsp;<span>#define MIDVAL</span>
<span>2047</span>
<span>//2.50V</span>
 &nbsp;</p>
<p>&nbsp;<span>#define LOWVAL</span>
<span>1640</span>
<span>//2.00V</span>
 &nbsp;</p>
<p>&nbsp;<span>#define MANY</span>
<span>5</span>
 &nbsp;</p>
<p>&nbsp;<span>#define XPITCH</span>
<span>200</span>
<span>//200us</span>
 &nbsp;</p>
<p>&nbsp;<span>#define HEAD</span>
<span>30</span>
 &nbsp;</p>
<p>&nbsp;<span>#define TAIL</span>
<span>50</span>
 &nbsp;</p>
<p>&nbsp;<span>#define MAXVOLT</span>
<span>425</span>
<span>//300Vã®æœ€å¤§å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>#define MAXCURR</span>
<span>100</span>
<span>//70Aã®æœ€å¤§å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//äº¤æµæ³¢å½¢æ§‹é€ ä½“</span>
 &nbsp;</p>
<p>&nbsp;<span>struct WAVEBUF {</span>
 &nbsp;</p>
<p>&nbsp;<span>short waveStep ;</span>
<span>//å–å¾—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>short voltBuf[HALFBUF] ;</span>
<span>//é›»åœ§ãƒãƒƒãƒ•ã‚¡</span>
 &nbsp;</p>
<p>&nbsp;<span>short currBuf[HALFBUF] ;</span>
<span>//é›»æµãƒãƒƒãƒ•ã‚¡</span>
 &nbsp;</p>
<p>&nbsp;<span>short wavePtr ;</span>
<span>//ãƒã‚¤ãƒ³ã‚¿</span>
 &nbsp;</p>
<p>&nbsp;<span>bool ready ;</span>
<span>//ãƒ‡ãƒ¼ã‚¿æº–å‚™å‡ºæ¥ãŸ</span>
 &nbsp;</p>
<p>&nbsp;<span>short helz ;</span>
<span>//0.1Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>short volt ;</span>
<span>//0.1V</span>
 &nbsp;</p>
<p>&nbsp;<span>short peak ;</span>
<span>//V</span>
 &nbsp;</p>
<p>&nbsp;<span>short curr ;</span>
<span>//0.1A</span>
 &nbsp;</p>
<p>&nbsp;<span>short&nbsp;theta ;</span>
<span>//ä½ç›¸å·®</span>
 &nbsp;</p>
<p>&nbsp;<span>short result[6];</span>
<span>//è¨ˆç®—çµæœ</span>
 &nbsp;</p>
<p>&nbsp;<span>short check[6] ;</span>
<span>//çŠ¶æ³ç›£è¦–</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>static struct WAVEBUF U_WB ;</span>
<span>//ï¼µç›¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static struct WAVEBUF V_WB ;</span>
<span>//ï¼¶ç›¸</span>
 &nbsp;</p>
<p>&nbsp;<span>static struct WAVEBUF W_WB ;</span>
<span>//ï¼·ç›¸</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private function</span>
 &nbsp;</p>
<p>&nbsp;<span>static void InitWaveBuf( struct WAVEBUF *sp );</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool Prepare( struct WAVEBUF *sp, int volt, int curr );</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool CalcHelz( struct WAVEBUF *sp );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>/åˆæœŸåŒ–</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitAdc()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>InitWaveBuf( &amp;U_WB );</span>
<span>//ï¼µç›¸</span>
 &nbsp;</p>
<p>&nbsp;<span>InitWaveBuf( &amp;V_WB );</span>
<span>//ï¼¶ç›¸</span>
 &nbsp;</p>
<p>&nbsp;<span>InitWaveBuf( &amp;W_WB );</span>
<span>//ï¼·ç›¸</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU2.TSTR.BIT.CST0 = 1 ;</span>
<span>//MTU20 ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//é›»åœ§é›»æµæ¸¬å®šç”¨ãƒãƒƒãƒ•ã‚¡ã®åˆæœŸåŒ–</span>
 &nbsp;</p>
<p>&nbsp;<span>static void InitWaveBuf( struct WAVEBUF *sp )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>sp-&gt;waveStep = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; HALFBUF ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;voltBuf[n] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;currBuf[n] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>sp-&gt;wavePtr = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>sp-&gt;ready = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>sp-&gt;helz = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>sp-&gt;volt = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>sp-&gt;peak = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>sp-&gt;curr = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>sp-&gt;theta = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 6 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;result[n] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt;&nbsp;6&nbsp;; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;check[n] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI1(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[7] = ADC1.ADDR7 ;</span>
<span>//&nbsp;é›»æµ(V)</span>
 &nbsp;</p>
<p>&nbsp;<span>#endif</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>Prepare( &amp;U_WB, adcRaw[4], adcRaw[5] );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>Prepare( &amp;V_WB, adcRaw[6], adcRaw[7] );</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC2.ADCR.BIT.ADST = 1 ;</span>
<span>//å¤‰æ›ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI2(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[11] = ADC2.ADDR11 ;</span>
<span>//&nbsp;å›è»¢æ•°å¤‰æ›´VR</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>Prepare( &amp;W_WB, adcRaw[8], adcRaw[9] );</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( int n = 10 ; n &lt; 12 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//é›»åœ§ã€é›»æµå€¤ä¿å­˜ï¼ˆå‰²ã‚Šè¾¼ã¿å°‚ç”¨ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool Prepare( struct WAVEBUF *sp, int volt, int curr )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int n, ptr ;</span>
 &nbsp;</p>
<p>&nbsp;<span>bool end = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( sp-&gt;waveStep )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>case 0: //ï¼•å€‹ä»¥ä¸Šãƒã‚¤ãƒŠã‚¹å´ã«ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;voltBuf[sp-&gt;wavePtr] = volt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;currBuf[sp-&gt;wavePtr] = curr;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( volt &gt;= LOWVAL )</span>
<span>//2.0Vä»¥ä¸‹ã«ãªã£ã¦ã‹ã‚‰é–‹å§‹ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;wavePtr = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++sp-&gt;wavePtr &gt;= MANY )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;waveStep++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>case 1: //ãƒ—ãƒ©ã‚¹å´ã«ãªã‚‹ã®ã‚’å¾…ã¤</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;voltBuf[sp-&gt;wavePtr] = volt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;currBuf[sp-&gt;wavePtr] = curr;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( volt &lt; MIDVAL )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ã¾ã ã€ãƒã‚¤ãƒŠã‚¹å´ãªã‚‰ã‚·ãƒ•ãƒˆã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ptr = sp-&gt;wavePtr;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( n = MANY-1 ; n &gt;= 0 ; n-- )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;voltBuf[ptr-n-1] = sp-&gt;voltBuf[ptr-n];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;currBuf[ptr-n-1] = sp-&gt;currBuf[ptr-n];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ãƒ—ãƒ©ã‚¹ã«ãªã£ãŸå¾Œã¯é †ã«ãƒãƒƒãƒ•ã‚¡ã«å…¥ã‚Œã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;waveStep++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;check[0] += 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>case 2 :&nbsp;//ãƒãƒƒãƒ•ã‚¡ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ãªãŒã‚‰å†ã³ãƒã‚¤ãƒŠã‚¹å´ã«ãªã£ãŸã®ã‚’æ¤œçŸ¥ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++sp-&gt;wavePtr &lt; HALFBUF )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;voltBuf[sp-&gt;wavePtr] = volt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;currBuf[sp-&gt;wavePtr] = curr;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( volt &lt; MIDVAL )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//å€¤ãŒãƒã‚¤ãƒŠã‚¹é ˜åŸŸã«å…¥ã£ãŸå¾Œã«ã€å°‘ã—ã ã‘ãƒãƒƒãƒ•ã‚¡ã«å…¥ã‚Œã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>ptr = sp-&gt;wavePtr;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>for ( n = 0; n &lt; MANY; n++)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if (sp-&gt;voltBuf[--ptr] &gt;= MIDVAL)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( n &gt;= MANY )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;ready = true;</span>
<span>//è¨ˆç®—æº–å‚™OKï¼</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;check[1] += 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;waveStep++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ç•°å¸¸</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;wavePtr = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;waveStep = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>end = true ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>case 3 :</span>
<span>//è¨ˆç®—å®Œäº†å¾…ã¡</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( sp-&gt;ready == false )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;wavePtr = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;waveStep = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;check[2] += 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>end = true ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( sp-&gt;check[0] &gt; 9999 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>for ( n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;check[n] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>return end;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void Analog()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>g_delay = ( adcVal[P_Ai03] * 1.570) / 3800 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>#endif</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>//å‘¨æœŸã®è¨ˆç®—ã‚’è¡Œã†</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( U_WB.ready == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>CalcHelz( &amp;U_WB );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>U_WB.ready = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( V_WB.ready == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>CalcHelz( &amp;V_WB );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>V_WB.ready = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( W_WB.ready == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>CalcHelz( &amp;W_WB );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>W_WB.ready = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//å‘¨æœŸã®è¨ˆç®—</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool CalcHelz( struct WAVEBUF *sp )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return true ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-8">
<span>(3)&nbsp;å‡¦ç†çŠ¶æ³è¡¨ç¤º</span>
</a>
</h2>
<p>&nbsp;<span>Prepareãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ãŒå‹•ä½œã—ã¦ã„ã‚‹ã‹ã‚’ã€LCDç”»é¢ã§ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>çŠ¶æ³ç›£è¦–ã®ãŸã‚ã«ç”¨æ„ã—ãŸcheckãƒ‡ãƒ¼ã‚¿ã‚’èª¿ã¹ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char scProcess[][21] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>{"U&nbsp; 0000&nbsp; 0000&nbsp; 0000 "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"V&nbsp; 0000&nbsp; 0000&nbsp; 0000 "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"W&nbsp; 0000&nbsp; 0000&nbsp; 0000 "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"u0000&nbsp; v0000&nbsp; w0000 "}};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//é€²è¡ŒçŠ¶æ³ for LCD</span>
 &nbsp;</p>
<p>&nbsp;<span>int&nbsp;GetProcess(int val[])</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = U_WB.check[0] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[1] = V_WB.check[0] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[2] = W_WB.check[0] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[3] = U_WB.check[1] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[4] = V_WB.check[1] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[5] = W_WB.check[1] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[6] = U_WB.check[2] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[7] = V_WB.check[2] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[8] = W_WB.check[2] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[9] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[10] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[11] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return 12 ;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//LCD</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetProcessMsg( int val[], char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[22], temp[8] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scProcess[n], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 4, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[3], temp, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n+3], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 4, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[9], temp, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n+6], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 4, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[15], temp, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( line, scProcess[3], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int k = val[n] - val[n+6];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( k, temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 4, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[1+n*7], temp, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Display.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void DispLCD()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;D_Process&nbsp;:</span>
<span>//å‡¦ç†çŠ¶æ³</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DispFunc( GetProcess,&nbsp; GetProcessMsg );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>selectLED = L_ADC ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã“ã¾ã§ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã€å®Ÿè¡Œã—ã¦LCDç”»é¢ã§ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å¤‰æ•°checkã®æ•°å€¤ã¯å¢—ãˆã¦ã„ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®æ™‚ç‚¹ã§ã€å¾…æ©ŸçŠ¶æ…‹ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å¹³å‡</span>
<span>31us</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰æœ€å¤§</span>
<span>4.4ms</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰æœ€å°</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã—ã‹ã—ã€é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å¹³å‡</span>
<span>1.1ms</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰æœ€å¤§</span>
<span>46.4ms</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰æœ€å°</span>
<span>225us</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¨ã€æ ¼æ®µã«å‡¦ç†ã«æ™‚é–“ãŒæ›ã‹ã£ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã•ã‚‰ã«å¤§ããªå•é¡ŒãŒèµ·ãã¾ã—ãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å›è»¢æ•°ã‚’1510rpmä»¥ä¸Šã«ä¸Šã’ã‚‹ã¨ã€ã‚·ã‚¹ãƒ†ãƒ ãŒåœæ­¢ã—ã¦ã—ã¾ã„ã¾ã™</span>
 &nbsp;</p>
<p>&nbsp;<span>å…ˆãšã€ã“ã‚Œã‚’è§£æ±ºã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-9">
<span>[6] ä¸å…·åˆã®ç™ºç”Ÿ</span>
</a>
</h1>
<p>&nbsp;<span>ã“ã®ã‚ãŸã‚Šã‹ã‚‰å‡¦ç†ãŒå¤šããªã‚Šã€å›è»¢æ•°ã‚’1500rpmä»¥ä¸Šã«ä¸Šã’ã€å‘¨æ³¢æ•°ã‚’å¤‰ãˆã‚‹ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæ­¢ã¾ã£ã¦ã—ã¾ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å°‘ã—éå»ã«æˆ»ã‚Šã€èª¿æŸ»ã™ã‚‹ã¨DACã§ã®æ³¢å½¢ç”Ÿæˆã«çªãå½“ãŸã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>æœ€åˆã¯ä¸€ã¤ã®ç›¸ã®æ³¢å½¢ã§ã—ãŸãŒã€é€”ä¸­ã‹ã‚‰ä¸‰ç›¸ã®æ³¢å½¢ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®MPUã¯æ•°å€¤æ¼”ç®—ãƒ¦ãƒ‹ãƒƒãƒˆã‚’å†…è”µã—ã¦ã„ãªã„ã®ã§ã€SINã®è¨ˆç®—ã«æ™‚é–“ãŒæ›ã‹ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>200usã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã§å‰²ã‚Šè¾¼ã‚“ã§è¨ˆç®—å‡¦ç†ã‚’ã—ã¦ã„ã‚‹æ¬¡ã®é–¢æ•°ã®å‡¦ç†æ™‚é–“ã‚’è¨ˆã‚‹ã¨ã€1500rpmã‚’è¶ŠãˆãŸæ™‚ç‚¹ã§184usã§ã—ãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>INT_MTU2_MTU5_TGIU5(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>çµ„è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ ã®å¸¸å¥—æ‰‹æ®µã¨ã—ã¦ã€SINã®è¨ˆç®—ã‚’ã—ãªã„ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‚ç…§ã™ã‚‹æ–¹æ³•ã‚’ä½¿ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ä¸‹è¨˜ã®ã‚ˆã†ã«ï¼åº¦ã‹ã‚‰360åº¦ã¾ã§ã‚’100ç­‰åˆ†ã—ã¦è¨ˆç®—ã—ãŸSINå€¤ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== sinTbl.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>const float sinTbl[] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>0,0.06279052,0.1253332,0.1873813,0.2486899,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.309017,0.3681245,0.4257793,0.4817537,0.5358268,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.5877852,0.637424,0.6845471,0.7289686,0.7705132,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.809017,0.8443279,0.8763067,0.9048271,0.9297765,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.9510565,0.9685832,0.9822872,0.9921147,0.9980267,</span>
 &nbsp;</p>
<p>&nbsp;<span>1,0.9980267,0.9921147,0.9822872,0.9685832,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.9510565,0.9297765,0.9048271,0.8763067,0.8443279,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.809017,0.7705132,0.7289686,0.6845471,0.637424,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.5877852,0.5358268,0.4817537,0.4257793,0.3681245,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.309017,0.2486899,0.1873813,0.1253332,0.06279052,</span>
 &nbsp;</p>
<p>&nbsp;<span>0,-0.06279052,-0.1253332,-0.1873813,-0.2486899,</span>
 &nbsp;</p>
<p>&nbsp;<span>-0.309017,-0.3681245,-0.4257793,-0.4817537,-0.5358268,</span>
 &nbsp;</p>
<p>&nbsp;<span>-0.5877852,-0.637424,-0.6845471,-0.7289686,-0.7705132,</span>
 &nbsp;</p>
<p>&nbsp;<span>-0.809017,-0.8443279,-0.8763067,-0.9048271,-0.9297765,</span>
 &nbsp;</p>
<p>&nbsp;<span>-0.9510565,-0.9685832,-0.9822872,-0.9921147,-0.9980267,</span>
 &nbsp;</p>
<p>&nbsp;<span>-1,-0.9980267,-0.9921147,-0.9822872,-0.9685832,</span>
 &nbsp;</p>
<p>&nbsp;<span>-0.9510565,-0.9297765,-0.9048271,-0.8763067,-0.8443279,</span>
 &nbsp;</p>
<p>&nbsp;<span>-0.809017,-0.7705132,-0.7289686,-0.6845471,-0.637424,</span>
 &nbsp;</p>
<p>&nbsp;<span>-0.5877852,-0.5358268,-0.4817537,-0.4257793,-0.3681245,</span>
 &nbsp;</p>
<p>&nbsp;<span>-0.309017,-0.2486899,-0.1873813,-0.1253332,-0.06279052</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¾ãŸã€ä½ç›¸é…ã‚Œã‚’è§’åº¦ã§ã¯ãªãã¦ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚ªãƒ•ã‚»ãƒƒãƒˆã«å¤‰æ›´ã—ã¾ã—ãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ä½ç›¸é…ã‚Œç”¨VRã§ï¼åº¦ã‹ã‚‰72åº¦ã«ç›¸å½“ã™ã‚‹ï¼ã‹ã‚‰20ã«ã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Global data</span>
 &nbsp;</p>
<p>&nbsp;<span>//extern double g_delay ;</span>
<span>//ä½ç›¸é…ã‚Œï¼ˆè§’åº¦ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>extern int g_delay ;</span>
<span>//ä½ç›¸é…ã‚Œï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void Analog()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//&nbsp;ä½ç›¸é…ã‚Œ</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>g_delay = ( adcVal[P_Ai03] * 1.570) / 3800 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>g_delay = adcVal[P_Ai03] / 190 ;</span>
<span>//0..72degree</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Dac.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//#include &lt;math.h&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "sinTbl.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// Global data</span>
 &nbsp;</p>
<p>&nbsp;<span>//double g_delay ;</span>
<span>//ä½ç›¸é…ã‚Œï¼ˆè§’åº¦ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>int g_delay ;</span>
<span>//ä½ç›¸é…ã‚Œï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitDac()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>g_delay = 0.0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>g_delay = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2_MTU5_TGIU5(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( MTU25.TSR.BIT.CMFU == 1 )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU25.TSR.BIT.CMFU = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//U phase</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int step1 = pitch ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>double val = sinTbl[step1] * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_voltage[0] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DAC.DADR0 = g_voltage[0] &gt;&gt; 4 ;</span>
<span>//12bit =&gt; 8 bit</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int step2 = step1 - g_delay ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( step2 &lt; 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>step2 += 100 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sinTbl[step2] * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_current[0] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DAC.DADR1 = g_current[0] &gt;&gt; 4 ;//12bit =&gt; 8 bit</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//V phase</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>step1 += 33 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( step1 &gt;= 100 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>step1 -= 100 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sinTbl[step1] * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_voltage[1] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>DAC.DADR1 = g_voltage[1] &gt;&gt; 4 ;</span>
<span>//12bit =&gt; 8 bit</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>step2 = step1 - g_delay ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( step2 &lt; 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>step2 += 100 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sinTbl[step2] * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_current[1] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//W phase</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>step1 += 33 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( step1 &gt;= 100 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>step1 -= 100 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sinTbl[step1] * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_voltage[2] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>DAC.DADR1 = g_voltage[2] &gt;&gt; 4 ;</span>
<span>//12bit =&gt; 8 bit</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>step2 = step1 - g_delay ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( step2 &lt; 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>step2 += 100 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>val = sinTbl[step2] * RATE + 2047;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>g_current[2] = (unsigned int)val ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++pitch &gt;= 100 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>pitch = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( nowRpm != oldRpm )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>oldRpm = nowRpm ;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU25.TGRU = NUMERATOR / nowRpm ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ†ãƒ¼ãƒ–ãƒ«å‚ç…§ã«åˆ‡ã‚Šæ›¿ãˆãŸã®ã§ã€ã“ã®å‰²ã‚Šè¾¼ã¿ã®å‡¦ç†æ™‚é–“ã¯ã€184us ã‹ã‚‰30usã¾ã§æ¸›å°‘ã—ã¾ã—ãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯ã€æ ¼æ®µã¨æ”¹è‰¯ã•ã‚Œã¾ã—ãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å¹³å‡</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰æœ€å¤§</span>
<span>3.5ms</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰æœ€å°</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å›è»¢æ•°ã‚’2000rpmä»¥ä¸Šã«ä¸Šã’ã¦ã‚‚ã€ã‚·ã‚¹ãƒ†ãƒ ã¯ã‚‚ã†åœæ­¢ã—ã¾ã›ã‚“ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-10">
<span>[7]&nbsp;é–“å¼•ã</span>
</a>
</h1>
<p>&nbsp;<span>ç¾åœ¨ã¯ä¸‹å›³ã®ã‚ˆã†ã«ã€ä¸‰ç›¸äº¤æµã®æ³¢å½¢ã‚’åŒæ™‚ã«ã€æ¯ã‚µã‚¤ã‚¯ãƒ«è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000029.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã—ã‹ã—ã€éš£ã‚Šåˆã†æ³¢å½¢ã«å¤§ããªç›¸é•ã¯ãªã„ã®ã§ã€æ¯ã‚µã‚¤ã‚¯ãƒ«è¨ˆç®—ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>æ¬¡å›³ã®ã‚ˆã†ã«ã€å„ç›¸ã‚’é †ã«è¨ˆç®—ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000011.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>enum { U_PHASE, V_PHASE, W_PHASE };</span>
 &nbsp;</p>
<p>&nbsp;<span>static short order ;</span>
<span>//è¨ˆç®—é †åº</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitAdc()</span>
<span>/*åˆæœŸåŒ–éƒ¨*/</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>order = U_PHASE;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI1(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &amp; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( order == U_PHASE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( Prepare( &amp;U_WB, adcRaw[4], adcRaw[5] ) == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>order = V_PHASE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( order == V_PHASE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( Prepare( &amp;V_WB, adcRaw[6], adcRaw[7] ) == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>order = W_PHASE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC2.ADCR.BIT.ADST = 1 ;</span>
<span>//ADC2å¤‰æ›ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI2(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[11] = ADC2.ADDR11 ;</span>
<span>//å›è»¢æ•°å¤‰æ›´VR</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &amp; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( order == W_PHASE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( Prepare( &amp;W_WB, adcRaw[8], adcRaw[9] ) == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>order = U_PHASE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( int n = 10 ; n &lt; 12 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®æ™‚ç‚¹ã§é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯ã€ã»ã¨ã‚“ã©å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã•ã‚‰ã«ã€æ”¹è‰¯å‡ºæ¥ãªã„ã‹ã€èª¿ã¹ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2>
<a id="calibre_link-11">
<span>(1)&nbsp;ç›¸é–“ã®é–“éš”</span>
</a>
</h2>
<p>&nbsp;<span>ç¾çŠ¶ã§ã¯ã€æ¯å›200usã®å‰²ã‚Šè¾¼ã¿ãŒæ›ã‹ã£ã¦ã„ã‚‹ã®ã§ã€ä»–ã®å‹•ä½œã«ã‚„ã‚„æ”¯éšœãŒå‡ºã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ä¸€ã¤ã®ç›¸ã®è¨ˆç®—ãŒçµ‚ã‚ã£ã¦ã‹ã‚‰ã€å°‘ãªãã¨ã‚‚10msã¯ä½•ã‚‚ã—ãªã„åŒºé–“ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>200usã®å‰²ã‚Šè¾¼ã¿ã‚’ã€ã“ã®åŒºé–“ã ã‘æ­¢ã‚ã‚‹ã®ã¯å¦‚ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000027.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¾ãŸã€å‘¨æœŸã€é›»åœ§ã€é›»æµã€é›»åŠ›ã¯åˆ¶å¾¡ã«ç›´æ¥ã«ä½¿ã£ã¦ã¯ã„ãªã„ã®ã§ã€çŸ­å‘¨æœŸã§è¨ˆç®—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã“ã§ã¯10msã§ã¯ãªãã¦50msã®é–“éš”ã‚’ç©ºã‘ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ã“ã®åŒºé–“ã‚’ä½œæˆã™ã‚‹ã®ã«ã€ã‚¿ã‚¤ãƒãƒ¼MTU2S5ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;hwsetup.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//Interrupt priority</span>
 &nbsp;</p>
<p>&nbsp;<span>//-----------------------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>INTC.IPR13.BIT._MTU2S5 =&nbsp;8&nbsp;;</span>
<span>//MTU2S5.TIER.BIT.TGIEA ç›¸é–“é–“éš”ã«ä½¿ç”¨</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//Multifunction timer</span>
 &nbsp;</p>
<p>&nbsp;<span>//-----------------------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>//using the MTU2S channel 5U</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU2S5.TCRU.BIT.TPSC = 3 ;</span>
<span>//MTU2S clock :64/50MHz = 1.28us</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU2S5.TIORU.BIT.IOC = 0 ;</span>
<span>//TIC5U&nbsp; compare match&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU2S5.TIER.BIT.TGIEU = 1 ;</span>
<span>//1ï¼šCMFU5&nbsp; interrupt</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU2S5.TCCR.BIT.CLRU = 1 ;</span>
<span>//1ï¼šTCNTU_5 clear</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU2S5.TCNTU = 0 ;</span>
<span>// Timer counter</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>MTU2S5.TGRU = 7813 ;</span>
<span>// 7813 * 1.28us = 10ms</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU2S5.TGRU = 39063 ;</span>
<span>// 39063 * 1.28us = 50ms</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ä¸€ã¤ã®ç›¸ã®è¨ˆç®—ãŒçµ‚ã‚ã£ãŸã‚‰ã€å‰²ã‚Šè¾¼ã¿ç”¨ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’æ­¢ã‚ã¦ã€ç›¸é–“é–“éš”ç”¨ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI1(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( order == U_PHASE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( Prepare( &amp;U_WB, adcRaw[4], adcRaw[5] ) == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add&nbsp;&amp; modify&nbsp;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>MTU2.TSTR.BIT.CST0 = 0 ;</span>
<span>//MTU20ã‚¹ãƒˆãƒƒãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>MTU2S5.TSTR.BIT.CSTU = 1 ;</span>
<span>//MTU2S5Uã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>order = V_PHASE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( order == V_PHASE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( Prepare( &amp;V_WB, adcRaw[6], adcRaw[7] ) == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add&nbsp;&amp; modify&nbsp;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>MTU2.TSTR.BIT.CST0 = 0 ;</span>
<span>//MTU20ã‚¹ãƒˆãƒƒãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>MTU2S5.TSTR.BIT.CSTU = 1 ;</span>
<span>//MTU2S5Uã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>order = W_PHASE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI2(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( order == W_PHASE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( Prepare( &amp;W_WB, adcRaw[8], adcRaw[9] ) == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add&nbsp;&amp; modify&nbsp;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>MTU2.TSTR.BIT.CST0 = 0 ;</span>
<span>//MTU20ã‚¹ãƒˆãƒƒãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>MTU2S5.TSTR.BIT.CSTU = 1 ;</span>
<span>//MTU2S5Uã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>order = U_PHASE ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>// 220 MTU2S MTU5S TGIU5</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2S_MTU5S_TGIU5(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( MTU2S5.TSR.BIT.CMFU == 1 )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU2S5.TSR.BIT.CMFU = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU2.TSTR.BIT.CST0 = 1 ;</span>
<span>//MTU20ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU2S5.TSTR.BIT.CSTU = 0 ;</span>
<span>//MTU2S5Uã‚¹ãƒˆãƒƒãƒ—</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®æ™‚ç‚¹ã§ã‚‚é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯ã€ä»¥å‰ã¨ã»ã¨ã‚“ã©åŒã˜ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-12">
<span>(2)&nbsp;å®Ÿç”¨è¨ˆç®—</span>
</a>
</h2>
<p>&nbsp;<span>ã•ã‚‰ã«ã€äº¤æµæ³¢å½¢ä»¥å¤–ã®ã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã¯é«˜é€Ÿã§å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ä»Šã¾ã§200msã®å‰²ã‚Šè¾¼ã¿ãŒ200usã«ãªã‚Šã€ç„¡é§„ãªè¨ˆç®—ã‚’ã—ã¦ã„ã‚‹ã®ã§ã€ã“ã‚Œã‚’å¤‰æ›´ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>static short count ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitAdc()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>count = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI0(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( count == 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( int n = 2 ; n &lt; 4 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>adcBuf[n] -= (long)adAve[n][adPtr] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>adAve[n][adPtr] = adcRaw[n] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>adcBuf[n] += (long)adcRaw[n] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC1.ADCR.BIT.ADST = 1 ;</span>
<span>//ADC1å¤‰æ›ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI2(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &amp; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( count == 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( int n = 10 ; n &lt; 12 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>adcBuf[n] -= (long)adAve[n][adPtr] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>adAve[n][adPtr] = adcRaw[n] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>adcBuf[n] += (long)adcRaw[n] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++adPtr &gt;= AVEMAX )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>adPtr = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC0.ADANSR.BIT.ANS2 = 0 ;</span>
<span>// 2 ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãƒã‚¸ã‚·ãƒ§ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC0.ADANSR.BIT.ANS3 = 0 ;</span>
<span>// 3 å†·å´æ°´æ¸©</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC2.ADANSR.BIT.ANS2 = 0 ;</span>
<span>//10 è¡¨ç¤ºé¸æŠVR</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC2.ADANSR.BIT.ANS3 = 0 ;</span>
<span>//11 å›è»¢æ•°å¤‰æ›´VR</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++count &gt;= 100 )</span>
<span>//20ms/200us = 100</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>count = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC0.ADANSR.BIT.ANS2 = 1 ;</span>
<span>// 2 ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãƒã‚¸ã‚·ãƒ§ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC0.ADANSR.BIT.ANS3 = 1 ;</span>
<span>// 3 å†·å´æ°´æ¸©</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC2.ADANSR.BIT.ANS2 = 1 ;</span>
<span>//10 è¡¨ç¤ºé¸æŠVR</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC2.ADANSR.BIT.ANS3 = 1 ;</span>
<span>//11 å›è»¢æ•°å¤‰æ›´VR</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã‚Œã¯å¤§ããªæ™‚é–“ã®ç¯€ç´„ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>æ¬¡ã«ã€å›è»¢æ•°ã®è¨ˆæ¸¬ã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-13">
<span>[8]&nbsp;å›è»¢æ•°è¨ˆç®—ã®å†è€ƒ</span>
</a>
</h1>
<p>&nbsp;<span>ç¾åœ¨ã§ã¯ã€ã™ã¹ã¦ã®ã‚¯ãƒ©ãƒ³ã‚¯ãƒ‘ãƒ«ã‚¹å…¥åŠ›ã§è¨ˆç®—å‡¦ç†ã‚’ã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚‚éš£ã‚Šåˆã†ã‚¯ãƒ©ãƒ³ã‚¯ãƒ‘ãƒ«ã‚¹ã§å¤§ããå¤‰åŒ–ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ä¾‹ãˆã°ã€é–“å¼•ãã—ã¦å……åˆ†ã¨æ€ã„ã¾ã™ã®ã§ã€2ãƒ‘ãƒ«ã‚¹ã«ï¼‘å›è¨ˆç®—ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000007.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã•ã‚‰ã«å›è»¢æ•°ãŒ2000rpmã‚’è¶Šãˆã‚‹ã¨ã€é«˜å›è»¢ç•°å¸¸ã«ãªã‚‹ã®ã§ã€2000rpmã‚’è¶Šãˆã‚‹è¨ˆç®—ã¯ä¸è¦ã¨ã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Rotate.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {STOP, MEDIUM, HIGH };</span>
 &nbsp;</p>
<p>&nbsp;<span>static short speedFlag ;</span>
<span>//å›è»¢ç¢ºèª</span>
 &nbsp;</p>
<p>&nbsp;<span>static short working ;</span>
<span>//ãƒ‡ãƒ¼ã‚¿é–“å¼•ãç”¨</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitRotate()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>speedFlag = STOP ;</span>
 &nbsp;</p>
<p>&nbsp;<span>working&nbsp; = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2_MTU2_TGIA2(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( MTU22.TSR.BIT.TGFA )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if (( ctrBuf[0] &gt; 0 ) &amp;&amp; ( newCount &gt;= ( ctrBuf[1] + ctrBuf[2] )))</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &amp; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>working = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( speedFlag &lt;= MEDIUM )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++working &amp; 0x01 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//ä¸­å¤®å€¤ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>ctrBuf[0] = ctrBuf[1] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>rpmPtr = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void WatchRotation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( sure &gt;= MAXSURE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( speedFlag != STOP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>InitRotate();</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sure = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sure++;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>oldPtr = rpmPtr ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &amp; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( newCount &lt; HIGHCTR )</span>
<span>//2000rpm</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>speedFlag = HIGH ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetError(ERR_7&nbsp;);</span>
<span>//é«˜å›è»¢</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>speedFlag = MEDIUM ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sure = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int&nbsp;GetRotation( int val[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = speedFlag ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[1] = nowRpm;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã‚Œã§ä»–ã®å‡¦ç†ã«å¹¾åˆ†ã‹ã®MPUæ™‚é–“ã‚’å›ã›ã‚‹ã¨æ€ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®æ™‚ç‚¹ã§é‹è»¢ã—ã¦ã„ãªã„æ™‚ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å¹³å‡</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰æœ€å¤§</span>
<span>3.4ms</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰æœ€å°</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã€1500rpmã§ã®é€šå¸¸é‹è»¢æ™‚ã«ã¯</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å¹³å‡</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰æœ€å¤§</span>
<span>3.5ms</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰æœ€å°</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-14">
<span>[9]&nbsp;å‘¨æœŸã®è¨ˆç®—</span>
</a>
</h1>
<p>&nbsp;<span>æ¬¡ã¯å‘¨æœŸã‚’æ±‚ã‚ã¦ã€æ­£ã—ã„å‘¨æ³¢æ•°ã®äº¤æµã‚’ç™ºé›»ã—ã¦ã„ã‚‹ã‹ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€å‘¨æœŸãŒåˆ†ã‹ã‚Œã°ã€é›»åœ§ã‚„é›»æµã®è¨ˆç®—ç¯„å›²ã‚’å¾—ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//å‘¨æœŸã®è¨ˆç®—</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool CalcHelz( struct WAVEBUF *sp )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//æœ€åˆã‹ã‚‰ä¸Šã‚Šå‹¾é…</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>int m, x, y1, y2;</span>
 &nbsp;</p>
<p>&nbsp;<span>for (m = 0; m &lt; HEAD; m++)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>y1 = sp-&gt;voltBuf[m];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>y2 = sp-&gt;voltBuf[m + 1];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ((y1 &lt; MIDVAL) &amp;&amp; (y2 &gt;= MIDVAL))</span>
<span>//ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹ã‚’è¶ŠãˆãŸ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//xa-x1=(ya-y1)*(x2-x1)/(y2-y1) ã‚’æ±‚ã‚ã‚‹&nbsp; ya=MIDVAL</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>x = (MIDVAL - y1) * XPITCH;</span>
<span>// x2-x1 = XPITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>x /= (y2 - y1);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;result[0] = m + 1;</span>
<span>//x2: ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;result[1] = x;</span>
<span>//xa-x1 è¨ˆç®—å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if (m &gt;= HEAD)</span>
<span>//è¦‹ã¤ã‹ã‚‰ãªã„</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false;</span>
 &nbsp;</p>
<p>&nbsp;<span>//calcPtrã‹ã‚‰æˆ»ã‚‹æ–¹å‘ã§ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹ã‚’æ¢ã™</span>
 &nbsp;</p>
<p>&nbsp;<span>for (m = sp-&gt;wavePtr - 1; m &gt; TAIL; m--)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>y1 = sp-&gt;voltBuf[m - 1];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>y2 = sp-&gt;voltBuf[m];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ((y1 &gt; MIDVAL) &amp;&amp; (y2 &lt;= MIDVAL)) //ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//d3=xb-x1=(yb-y1)*(x2-x1)/(y2-y1) ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//x1=m, x2=m+1</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>x = (MIDVAL - y1) * XPITCH;</span>
<span>//x2-x1 = XPITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>x /= (y2 - y1);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;result[2] = m;</span>
<span>//x4: ï¼’å›ç›®ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;result[3] = x;</span>
<span>//d3 = xb-x3è¨ˆç®—å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//Period=d1+d2+d3</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//Period=(x4-x2)*XPITCH-(xa-x1) + (xb-x3)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;result[4] = (sp-&gt;result[2] -&nbsp;sp-&gt;result[0]) * XPITCH -&nbsp;sp-&gt;result[1] +&nbsp;sp-&gt;result[3];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//å‘¨æœŸ at 200us</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if (sp-&gt;result[4] &gt; 1000)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;helz = (int)(5000000L /&nbsp;sp-&gt;result[4]);</span>
<span>//å‘¨æœŸ us =&gt;0.1Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-15">
<span>(1)&nbsp;å‘¨æœŸã®ç¢ºèª</span>
</a>
</h2>
<p>&nbsp;<span>æ±‚ã‚ãŸå‘¨æœŸã‚’LCDç”»é¢ã«è¡¨ç¤ºã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char scGene2[][21] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>{"U&nbsp; 00.0 Hz&nbsp;&nbsp;&nbsp; 000 pV"},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"V&nbsp; 00.0 Hz&nbsp;&nbsp;&nbsp; 000 pV"},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"W&nbsp; 00.0 Hz&nbsp;&nbsp;&nbsp; 000 pV"},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Cw 000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "}};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç™ºé›»å‡ºåŠ› for LCD</span>
 &nbsp;</p>
<p>&nbsp;<span>int&nbsp;GetGenerate2( int val[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = U_WB.helz ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[1] = V_WB.helz ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[2] = W_WB.helz ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[3] = U_WB.peak ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[4] = V_WB.peak ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[5] = W_WB.peak ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[6] = W_WB.check[3] ;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[7] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return 8 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//LCD</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetGeneMsg2( int val[], char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[22], temp[8], temp2[4]&nbsp; ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scGene2[n], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n] / 10, temp );</span>
<span>&nbsp;//Frequency 00Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 2, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( temp, "." );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n] % 10, temp2 ); // Frequency 0.1Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( temp, temp2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[3], temp, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n+3], temp );//Peak voltage 000V</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 3, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[14], temp, 3 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( line, scGene2[3], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoa2( val[6], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>adjust( temp, 6, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[3], temp, 6 );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoa2( val[7], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>adjust( temp, 6, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[14], temp, 6 );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>è¡¨ç¤ºã™ã‚‹é …ç›®ãŒå¢—ãˆã¦ããŸã®ã§ã€å„ªå…ˆåº¦ã®ä½ã„ã‚‚ã®ã¯ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦èª¿æ•´ã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Display.cpp&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void DispLCD()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;D_Generate2&nbsp;:</span>
<span>//ç™ºé›»å‡ºåŠ›2</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DispFunc( GetGenerate2, GetGeneMsg2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>selectLED = L_ADC ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã¯å®Ÿè¡Œã—ã¦ä¸‹ã•ã„ã€‚å›è»¢æ•°ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€å‘¨æœŸãŒå¤‰ã‚ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®æ™‚ç‚¹ã§ã€é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å¹³å‡</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰æœ€å¤§</span>
<span>3.6ms</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰æœ€å°</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ä¾ç„¶ã¨ã—ã¦é«˜é€Ÿã«ç¶­æŒã•ã‚Œã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<span>&nbsp;</span>
<a id="calibre_link-16">
<span>[10]&nbsp;é›»åœ§ã€é›»æµã®è¨ˆç®—</span>
</a>
</h1>
<p>&nbsp;<span>å‘¨æœŸãŒæ­£ã—ãæ±‚ã‚ã‚‰ã‚ŒãŸã‚‰ã€ãã‚Œã«åŸºã¥ã„ã¦é›»åœ§ã¨é›»æµãŒè¨ˆç®—å‡ºæ¥ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å®Ÿéš›ã®å…¥åŠ›æ³¢å½¢ã¯æ­£å¼¦æ³¢ã§ã¯ãªãã€ãƒã‚¤ã‚ºãŒå«ã¾ã‚Œã¦ã„ã¦ã€æ­ªã¿ã®ã‚ã‚‹æ³¢å½¢ã§ã™ã‹ã‚‰ã€æ³¢é«˜å€¤ã‹ã‚‰å®ŸåŠ¹å€¤ã‚’æ±‚ã‚ã‚‹ã“ã¨ã¯å‡ºæ¥ã¾ã›ã‚“ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã“ã§ã¯åŸç†çš„ãªæ–¹æ³•ã§ã€å…¥åŠ›æ³¢å½¢ã‚’å¾®å°éƒ¨åˆ†ã«åˆ†ã‘ã¦ã€é¢ç©ã‚’æ±‚ã‚ã‚‹æ–¹æ³•ã§è¡Œã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å‘¨æœŸã‚’æ±‚ã‚ãŸç›´å¾Œã«ã€é›»åœ§ã¨é›»æµã®è¨ˆç®—ã‚’è¿½åŠ ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool CalcHelz( struct WAVEBUF *sp )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>if (sp-&gt;result[4] &gt; 1000)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;helz = (int)(5000000L /&nbsp;sp-&gt;result[4]);</span>
<span>//å‘¨æœŸ us =&gt;0.1Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é›»åœ§ã®ç©åˆ†ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>double sum = 0.0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>double temp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int top = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//åŠå‘¨æœŸåˆ†</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for (m =&nbsp;sp-&gt;result[0]; m &lt;=&nbsp;sp-&gt;result[2]; m++)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>temp = sp-&gt;voltBuf[m] - MIDVAL;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sum += temp * temp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if (sp-&gt;voltBuf[m] &gt; top)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>top = sp-&gt;voltBuf[m];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m =&nbsp;sp-&gt;result[2] -&nbsp;sp-&gt;result[0] + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>temp = sqrt(sum / m);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//å®Ÿéš›ã®å€¤ã«å¤‰æ›ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//&nbsp; 0&nbsp;&nbsp; --- 2047 --- 4095</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//&nbsp; 0&nbsp;&nbsp; --- 2.5V --- 5V</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//-500V --- 0V&nbsp;&nbsp; --- 500V</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//volt = (int)((temp * MAXVOLT) / MIDVAL);</span>
<span>//V, temp=0...2047</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;volt = (int)((temp * MAXVOLT * 10) / MIDVAL);</span>
<span>//0.1V, temp=0...2047</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;peak = (int)(((top - MIDVAL) * MAXVOLT) / MIDVAL);</span>
<span>//V, top=0...4095</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é›»æµã®ç©åˆ†ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sum = 0.0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//åŠå‘¨æœŸåˆ†</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for (m =&nbsp;sp-&gt;result[0]; m &lt;=&nbsp;sp-&gt;result[2]; m++)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>temp = sp-&gt;currBuf[m] - MIDVAL;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sum += temp * temp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m =&nbsp;sp-&gt;result[2] -&nbsp;sp-&gt;result[0] + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>temp = sqrt(sum / m);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//å®Ÿéš›ã®å€¤ã«å¤‰æ›ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//&nbsp; 0&nbsp;&nbsp; --- 2047 --- 4095</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//&nbsp; 0&nbsp;&nbsp; --- 2.5V --- 5V</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//-100A --- 0V&nbsp;&nbsp; ---&nbsp;100A</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;curr = (int)((temp * MAXCURR * 10) / MIDVAL);</span>
<span>//0.1A, temp=0...2047</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-17">
<span>(1)&nbsp;é›»åœ§ã€é›»æµã®ç¢ºèª</span>
</a>
</h2>
<p>&nbsp;<span>ã§ã¯è¨ˆç®—ã—ãŸå€¤ã‚’LCDç”»é¢ã§ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char scGene[][21] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>{"U&nbsp; 000.0 V&nbsp;&nbsp; 00.0 A "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"V&nbsp; 000.0 V&nbsp;&nbsp; 00.0 A "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"W&nbsp; 000.0 V&nbsp;&nbsp; 00.0 A "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Cu 000000&nbsp; Cv 000000"}};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç™ºé›»å‡ºåŠ› for LCD</span>
 &nbsp;</p>
<p>&nbsp;<span>int&nbsp;GetGenerate( int val[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = U_WB.volt ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[1] = V_WB.volt ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[2] = W_WB.volt ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[3] = U_WB.curr ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[4] = V_WB.curr ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[5] = W_WB.curr ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[6] =&nbsp;U_WB.check[3] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[7] = V_WB.check[3] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return 8 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//LCD</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetGeneMsg( int val[], char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[22], temp[8], temp2[4]&nbsp; ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scGene[n], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n] / 10, temp );</span>
<span>//Voltage 000V</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 3, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( temp, "." );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n] % 10, temp2 );</span>
<span>// Voltage 0.1V</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( temp, temp2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[3], temp, 5 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n+3] / 10, temp );</span>
<span>//Current 00A</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 2, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( temp, "." );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n+3] % 10, temp2 );</span>
<span>// Current 0.1A</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( temp, temp2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[13], temp, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( line, scGene[3], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 2 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n+6], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 6, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[3+n*11], temp, 6 );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//For LCD display</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetAllVal( int val[])</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = adcVal[P_Ai02] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[1] = adcVal[P_Ai03] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[2] = adcVal[P_Ai10] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[3] = adcVal[P_Ai11] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[4] = U_WB.currBuf[0] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[5] = U_WB.currBuf[10] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[6] = U_WB.currBuf[20] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[7] = U_WB.currBuf[30] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>return 8 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Display.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void DispLCD()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;D_Generate&nbsp;:</span>
<span>//ç™ºé›»å‡ºåŠ›1</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DispFunc( GetGenerate, GetGeneMsg );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>selectLED = L_ADC ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã¯ã€å®Ÿè¡Œã—ã¦LCDç”»é¢ã§ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®æ™‚ç‚¹ã§ã€1500rpmã§é‹è»¢æ™‚ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å¹³å‡</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰æœ€å¤§</span>
<span>3.5ms</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰æœ€å°</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-18">
<span>[11]&nbsp;é›»åŠ›ã®è¨ˆç®—</span>
</a>
</h1>
<p>&nbsp;<span>æ¬¡ã¯ã€é›»åœ§ã¨é›»æµã®ä½ç›¸å·®ã‚’æ±‚ã‚ã¦ã€æœ‰åŠ¹é›»åŠ›ã‚’è¨ˆç®—ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>åŠ›ç‡ã®è¨ˆç®—ã§ã¯ã€cosã®è¨ˆç®—ã®ä»£ã‚ã‚Šã«0åº¦ã‹ã‚‰90åº¦ã¾ã§ã‚’1.8åº¦æ¯ã«è¨ˆç®—ã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½¿ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== cosTbl.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>const float cosTbl[] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>1,0.9995065,0.9980267,0.995562,0.9921147,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.9876884,0.9822872,0.9759167,0.9685832,0.9602937,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.9510565,0.9408808,0.9297765,0.9177547,0.9048271,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.8910065,0.8763067,0.860742,0.8443279,0.8270805,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.809017,0.790155,0.7705132,0.750111,0.7289686,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.7071068,0.6845471,0.6613119,0.637424,0.6129071,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.5877852,0.5620834,0.5358268,0.5090414,0.4817537,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.4539905,0.4257793,0.3971479,0.3681245,0.3387379,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.309017,0.2789911,0.2486899,0.2181432,0.1873813,</span>
 &nbsp;</p>
<p>&nbsp;<span>0.1564345,0.1253332,0.09410831,0.06279052,0.03141076</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>#include "cosTbl.h"</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>#define PI&nbsp;&nbsp;&nbsp; 3.14159265</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool CalcHelz( struct WAVEBUF *sp )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;curr = (int)((temp * MAXCURR * 10) / MIDVAL);</span>
<span>//0.1A, temp=0...2047</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é›»æµã®ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int n =&nbsp;sp-&gt;result[0] + HEAD ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for (m =&nbsp;sp-&gt;result[0]; m &lt; n ; m++)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>y1 = sp-&gt;currBuf[m];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>y2 = sp-&gt;currBuf[m + 1];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ((y1 &lt; MIDVAL) &amp;&amp; (y2 &gt;= MIDVAL))</span>
<span>//ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹ã‚’è¶ŠãˆãŸ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//xa-x1=(ya-y1)*(x2-x1)/(y2-y1) ã‚’æ±‚ã‚ã‚‹&nbsp; ya=MIDVAL</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>x = (MIDVAL - y1) * XPITCH;</span>
<span>// x2-x1 = XPITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>x /= (y2 - y1);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;result[5] = m + 1;</span>
<span>//x2: ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( m &lt; n )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é›»åœ§ã¨é›»æµã®ä½ç›¸å·®ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m = sp-&gt;result[2] - sp-&gt;result[0] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( m &gt; 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;theta = ((sp-&gt;result[5] - sp-&gt;result[0] ) * 100 ) /&nbsp;m&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//offset</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( sp-&gt;theta &lt; 50 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;check[3] += 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;theta = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;theta = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;theta = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;check[4] =&nbsp;sp-&gt;result[0];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;check[5] =&nbsp;sp-&gt;result[2];</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-19">
<span>(1) é›»åŠ›ã€åŠ›ç‡ã®ç¢ºèª</span>
</a>
</h2>
<p>&nbsp;<span>LCDç”»é¢ã§ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char scGene3[][21] = {</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Upf&nbsp; 0.000&nbsp;&nbsp; 00.0 KW"},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Vpf&nbsp; 0.000&nbsp;&nbsp; 00.0 KW"},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"Wpf&nbsp; 0.000&nbsp;&nbsp; 00.0 KW"},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 000000&nbsp; "}};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç™ºé›»å‡ºåŠ› for LCD</span>
 &nbsp;</p>
<p>&nbsp;<span>int&nbsp;GetGenerate3( int val[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>double pf =&nbsp;cosTbl[U_WB.theta];</span>
<span>//Power factor</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//åŠ›ç‡</span>
 &nbsp;</p>
<p>&nbsp;<span>val[0] = (int)( pf * 1000.0 );&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é›»åŠ›ï¼é›»åœ§ï¼Šé›»æµï¼ŠåŠ›ç‡</span>
 &nbsp;</p>
<p>&nbsp;<span>val[3] = (int)(( U_WB.volt * U_WB.curr * pf ) / 10000.0 );</span>
<span>//0.1KW</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>pf =&nbsp;cosTbl[V_WB.theta];</span>
<span>//Power factor</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//åŠ›ç‡</span>
 &nbsp;</p>
<p>&nbsp;<span>val[1] = (int)( pf * 1000.0 );&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é›»åŠ›ï¼é›»åœ§ï¼Šé›»æµï¼ŠåŠ›ç‡</span>
 &nbsp;</p>
<p>&nbsp;<span>val[4] = (int)(( V_WB.volt * V_WB.curr * pf ) / 10000.0 );</span>
<span>//0.1KW</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>pf =&nbsp;cosTbl[W_WB.theta];</span>
<span>//Power factor</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//åŠ›ç‡</span>
 &nbsp;</p>
<p>&nbsp;<span>val[2] = (int)( pf * 1000.0 );&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é›»åŠ›ï¼é›»åœ§ï¼Šé›»æµï¼ŠåŠ›ç‡</span>
 &nbsp;</p>
<p>&nbsp;<span>val[5] = (int)(( W_WB.volt * W_WB.curr * pf ) / 10000.0 );</span>
<span>//0.1KW</span>
 &nbsp;</p>
<p>&nbsp;<span>val[6] = U_WB.check[4] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>val[7] = U_WB.check[5] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return 8 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//LCD</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetGeneMsg3( int val[], char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[22], temp[8], temp2[4]&nbsp; ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scGene3[n], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n] / 1000, temp );</span>
<span>&nbsp;//pf</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( temp, "." );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n] % 1000, temp2 );</span>
<span>&nbsp;//pf 0.000</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp2, 3, '0' );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( temp, temp2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[5], temp, 5 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n+3] / 10, temp );//Power 0.1KW</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( temp, "." );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoa2( val[n+3] % 10, temp2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( temp, temp2 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adjust( temp, 4, ' ' );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( &amp;line[13], temp, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( line, scGene3[3], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoa2( val[6], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>adjust( temp, 6, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[0], temp, 6 );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoa2( val[7], temp );</span>
 &nbsp;</p>
<p>&nbsp;<span>adjust( temp, 6, ' ');</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( &amp;line[12], temp, 6 );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Display.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void DispLCD()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>case&nbsp;D_Generate3&nbsp;:</span>
<span>//ç™ºé›»å‡ºåŠ›3</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>DispFunc( GetGenerate3, GetGeneMsg3 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>selectLED = L_ADC ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>LCDç”»é¢ã§åŠ›ç‡ã¨é›»åŠ›ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®æ™‚ç‚¹ã§ã€1500rpmã§é‹è»¢æ™‚ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å¹³å‡</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰æœ€å¤§</span>
<span>3.5ms</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰æœ€å°</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>é›»åœ§ã€é›»æµã¨é›»åŠ›ã®è¨ˆç®—ã‚’å…¥ã‚Œã¦ã‚‚ã€ãªãŠã‚‚é«˜é€Ÿã«ç¶­æŒã•ã‚Œã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-20">
<span>[12]&nbsp;å¾®èª¿æ•´</span>
</a>
</h1>
<p>&nbsp;<span>æ¬¡ã«ç§»ã‚‹å‰ã«ã€ç´°ã‹ãªèª¿æ•´ã‚’ã—ã¦ç½®ãã¾ã™ã€‚</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-21">
<span>(1) è¨ˆç®—é–‹å§‹</span>
</a>
</h2>
<p>&nbsp;<span>å‘¨æœŸã‚„é›»åœ§ã€é›»æµã®è¨ˆç®—ã¯ã€å§‹å‹•å¾Œã«è¡Œã†ã‚ˆã†ã«ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã¾ãŸã€ç™ºé›»é›»åœ§ãŒæ‰€å®šã®é›»åœ§ã®90%ä»¥ä¸Šã«ãªã£ã¦ã„ã‚‹ã‹ã‚‚èª¿ã¹ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool running ;</span>
<span>//é‹è»¢ä¸­</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitAdc()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>running = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI1(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[7] = g_current[1] ;</span>
<span>// 7 ç™ºé›»é›»æµ(V)</span>
 &nbsp;</p>
<p>&nbsp;<span>#endif</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( running == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( order == U_PHASE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ADC2.ADCR.BIT.ADST = 1 ;</span>
<span>//ADC2å¤‰æ›ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_ADC_ADI2(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>adcRaw[11] = ADC2.ADDR11 ;</span>
<span>//&nbsp;å›è»¢æ•°å¤‰æ›´VR</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( running == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( order == W_PHASE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( count == 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void Analog()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>running = IsRunning();</span>
<span>//é‹è»¢ä¸­ã‹</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( running == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//å‘¨æœŸã®è¨ˆç®—ã‚’è¡Œã†</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( U_WB.ready == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>W_WB.ready = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç™ºé›»é›»åœ§ãŒå……åˆ†ã‹èª¿ã¹ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsGeneVolt()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int val = ( U_WB.volt + V_WB.volt + W_WB.volt ) / 3 ;</span>
<span>//0.1V</span>
 &nbsp;</p>
<p>&nbsp;<span>int val2 = ( 2200 * 90 ) / 100 ;</span>
<span>//198.0V</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( val &gt;= val2 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true ;</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetVoltage()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return ( U_WB.volt + V_WB.volt + W_WB.volt ) / 3 ;</span>
<span>//0.1V</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetCurrent()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return ( U_WB.curr + V_WB.curr + W_WB.curr ) / 3 ;</span>
<span>//0.1A</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetHelz()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>return ( U_WB.helz + V_WB.helz + W_WB.helz ) / 3 ;</span>
<span>//0.1Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-22">
<span>(2)&nbsp;æ³¢å½¢ç”Ÿæˆ</span>
</a>
</h2>
<p>&nbsp;<span>DACã«ã‚ˆã‚‹æ³¢å½¢ç”Ÿæˆã¯ã€ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒå›ã‚Šã€å›è»¢æ•°ãŒ400rpmã‚’è¶ŠãˆãŸæ™‚ã«é–‹å§‹ã—ã¦ã€é‹è»¢åœæ­¢æŒ‡ç¤ºã‚’å—ã‘ãŸå¾Œã«ã€æ³¢å½¢ãŒ0Vã«ãªã£ãŸæ™‚ã«çµ‚äº†ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Dac.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>static bool stopFlag ;</span>
<span>//é›»åœ§ãŒ0Vã«ãªã£ã¦ã‹ã‚‰å‡ºåŠ›ã‚’åœæ­¢ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>void InitDac()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>stopFlag = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2_MTU5_TGIU5(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++pitch&nbsp;&gt;= 100 )</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &amp; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>pitch&nbsp;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( stopFlag == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>MTU25.TSTR.BIT.CSTU = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//DACå‡ºåŠ›ã‚’é–‹å§‹ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>void StartDAC()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>pitch&nbsp;= 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>stopFlag = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU25.TSTR.BIT.CSTU = 1 ;</span>
<span>//MTU25U&nbsp; ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//å‡ºåŠ›åœæ­¢</span>
 &nbsp;</p>
<p>&nbsp;<span>void StopDAC()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>stopFlag = true;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-23">
<span>(3) åœæ­¢å¾Œã®å‡¦ç½®</span>
</a>
</h2>
<p>&nbsp;<span>ã¾ãŸåœæ­¢å¾Œã¯ã€äº¤æµæ³¢å½¢ã®å…¥åŠ›ã¯ãªã„ã®ã§ã€å€¤ãŒæ›´æ–°ã•ã‚Œãšã«è¡¨ç¤ºãŒæ®‹ã£ãŸã¾ã¾ã«ãªã‚‹ã®ã‚’é˜²æ­¢ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Rotate.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void WatchRotation()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( sure &gt;= MAXSURE )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( speedFlag != STOP )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>InitRotate();</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>ClearAdcData();</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sure = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//åœæ­¢å¾Œã«è¡¨ç¤ºãŒæ®‹ã‚‹ã®ã‚’é˜²ã</span>
 &nbsp;</p>
<p>&nbsp;<span>void ClearAdcData()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>InitWaveBuf( &amp;U_WB );</span>
<span>//ï¼µç›¸</span>
 &nbsp;</p>
<p>&nbsp;<span>InitWaveBuf( &amp;V_WB );</span>
<span>//ï¼¶ç›¸</span>
 &nbsp;</p>
<p>&nbsp;<span>InitWaveBuf( &amp;W_WB );</span>
<span>//ï¼·ç›¸</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ä½ç›¸é…ã‚Œ</span>
 &nbsp;</p>
<p>&nbsp;<span>g_delay = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>order = U_PHASE;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h2>
<a id="calibre_link-24">
<span>(4)&nbsp;æ™‚åˆ†å‰²</span>
</a>
</h2>
<p>&nbsp;<span>å‘¨æœŸã®è¨ˆç®—éƒ¨ã§ã€å¤šãã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€å‘¨æœŸã‚„é›»åœ§ã€é›»æµã®è¨ˆç®—ã¯åˆ¶å¾¡ã«ã¯ç›´æ¥ã«é–¢ã‚ã£ã¦ãŠã‚‰ãšã€é«˜é€Ÿã«å€¤ã‚’æ±‚ã‚ã‚‹å¿…è¦ã¯ãªã„ã®ã§ã€ã“ã®è¨ˆç®—éƒ¨åˆ†ã‚’æ™‚åˆ†å‰²ã§è¡Œã†ã‚ˆã†ã«ã—ã¦ã¿ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>äº¤æµæ³¢å½¢æ§‹é€ ä½“ã®ä¸­ã«ã€æ™‚åˆ†å‰²ç”¨ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’è¿½åŠ ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>//äº¤æµæ³¢å½¢æ§‹é€ ä½“</span>
 &nbsp;</p>
<p>&nbsp;<span>struct WAVEBUF {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>short sequence ;</span>
<span>//CalcHelz ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>static void InitWaveBuf( struct WAVEBUF *sp )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>sp-&gt;sequence = 0 ;</span>
<span>//CalcHelz ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å‘¨æœŸã®è¨ˆç®—éƒ¨ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’æ™‚åˆ†å‰²ã«ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private data</span>
 &nbsp;</p>
<p>&nbsp;<span>enum { H_HEAD,H_TAIL,H_VOLT,H_CURR,H_PHASE,H_END };</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private function</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>static int CalcHelz( struct WAVEBUF *sp );</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//å‘¨æœŸã®è¨ˆç®—</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; change &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>static int CalcHelz( struct WAVEBUF *sp )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//æœ€åˆã‹ã‚‰ä¸Šã‚Šå‹¾é…</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>int m, n, x, y1, y2, top;</span>
 &nbsp;</p>
<p>&nbsp;<span>double sum, temp;</span>
 &nbsp;</p>
<p>&nbsp;<span>switch ( sp-&gt;sequence )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case H_HEAD :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for (m = 0; m &lt; HEAD; m++)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>y1 = sp-&gt;voltBuf[m];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>y2 = sp-&gt;voltBuf[m + 1];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ((y1 &lt; MIDVAL) &amp;&amp; (y2 &gt;= MIDVAL))</span>
<span>//ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹ã‚’è¶ŠãˆãŸ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//xa-x1=(ya-y1)*(x2-x1)/(y2-y1), ya=MIDVAL</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>x = (MIDVAL - y1) * XPITCH;</span>
<span>// x2-x1 = XPITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>x /= (y2 - y1);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;result[0] = m + 1;</span>
<span>//x2:&nbsp;ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;result[1] = x;</span>
<span>//xa-x1&nbsp;è¨ˆç®—å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;result[4] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if (m &gt;= HEAD)</span>
<span>//è¦‹ã¤ã‹ã‚‰ãªã„</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;sequence = H_END ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;sequence++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case H_TAIL :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//&nbsp;calcPtrã‹ã‚‰æˆ»ã‚‹æ–¹å‘ã§ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹ã‚’æ¢ã™</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for (m = sp-&gt;wavePtr - 1; m &gt; TAIL; m--)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>y1 = sp-&gt;voltBuf[m - 1];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>y2 = sp-&gt;voltBuf[m];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ((y1 &gt; MIDVAL) &amp;&amp; (y2 &lt;= MIDVAL)) //ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//d3=xb-x1=(yb-y1)*(x2-x1)/(y2-y1)&nbsp;ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//x1=m, x2=m+1</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>x = (MIDVAL - y1) * XPITCH;</span>
<span>//x2-x1 = XPITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>x /= (y2 - y1);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;result[2] = m;</span>
<span>//x4:&nbsp;ï¼’å›ç›®ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;result[3] = x;</span>
<span>//d3 = xb-x3è¨ˆç®—å€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//Period=d1+d2+d3</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//Period=(x4-x2)*XPITCH-(xa-x1) + (xb-x3)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;result[4] = (sp-&gt;result[2] - sp-&gt;result[0]) * XPITCH - sp-&gt;result[1] + sp-&gt;result[3];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//å‘¨æœŸat 200us</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if (sp-&gt;result[4] &lt;= 1000)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;sequence = H_END ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;helz = (int)(5000000L / sp-&gt;result[4]);</span>
<span>//å‘¨æœŸ us =&gt;0.1Hz</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;sequence++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case H_VOLT :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é›»åœ§ã®ç©åˆ†ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sum = 0.0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>temp = 0.0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>top= 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//åŠå‘¨æœŸåˆ†</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for (m = sp-&gt;result[0]; m &lt;= sp-&gt;result[2]; m++)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>temp = sp-&gt;voltBuf[m] - MIDVAL;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sum += temp * temp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if (sp-&gt;voltBuf[m] &gt; top)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>top = sp-&gt;voltBuf[m];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m = sp-&gt;result[2] - sp-&gt;result[0] + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>temp = sqrt(sum / m);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//å®Ÿéš›ã®å€¤ã«å¤‰æ›ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//&nbsp; 0&nbsp;&nbsp; --- 2047 --- 4095</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//&nbsp; 0&nbsp;&nbsp; --- 2.5V --- 5V</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//-500V --- 0V&nbsp;&nbsp; --- 500V</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//volt = (int)((temp * MAXVOLT) / MIDVAL);</span>
<span>//V, temp=0...2047</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;volt = (int)((temp * MAXVOLT * 10) / MIDVAL);</span>
<span>//0.1V, temp=0...2047</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;peak = (int)(((top - MIDVAL) * MAXVOLT) / MIDVAL);</span>
<span>//V, top=0...4095</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;sequence++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case H_CURR :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é›»æµã®ç©åˆ†ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sum = 0.0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//åŠå‘¨æœŸåˆ†</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for (m = sp-&gt;result[0]; m &lt;= sp-&gt;result[2]; m++)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>temp = sp-&gt;currBuf[m] - MIDVAL;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sum += temp * temp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m = sp-&gt;result[2] - sp-&gt;result[0] + 1;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>temp = sqrt(sum / m);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//å®Ÿéš›ã®å€¤ã«å¤‰æ›ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//&nbsp; 0&nbsp;&nbsp; --- 2047 --- 4095</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//&nbsp; 0&nbsp;&nbsp; --- 2.5V --- 5V</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//-100A --- 0V&nbsp;&nbsp; --- 100A</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;curr = (int)((temp * MAXCURR * 10) / MIDVAL);</span>
<span>//0.1A, temp=0...2047</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;sequence++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case H_PHASE :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//é›»æµã®ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n = sp-&gt;result[0] + HEAD ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for (m = sp-&gt;result[0]; m &lt; n ; m++)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>y1 = sp-&gt;currBuf[m];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>y2 = sp-&gt;currBuf[m + 1];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ((y1 &lt; MIDVAL) &amp;&amp; (y2 &gt;= MIDVAL))</span>
<span>//ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹ã‚’è¶ŠãˆãŸ</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//xa-x1=(ya-y1)*(x2-x1)/(y2-y1), ya=MIDVAL</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>x = (MIDVAL - y1) * XPITCH;</span>
<span>// x2-x1 = XPITCH</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>x /= (y2 - y1);</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;result[5] = m + 1;</span>
<span>//x2:&nbsp;ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>break;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( m &lt; n )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//é›»åœ§ã¨é›»æµã®ä½ç›¸å·®ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>m = sp-&gt;result[2] - sp-&gt;result[0] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( m &gt; 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;theta = ((sp-&gt;result[5] - sp-&gt;result[0] ) * PI ) / m ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//radian</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;theta = ((sp-&gt;result[5] - sp-&gt;result[0] ) * 100 ) / m ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//offset</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( sp-&gt;theta &lt; 50 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;check[3] += 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;theta = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;theta = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;theta = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;check[4] = sp-&gt;result[0];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;check[5] = sp-&gt;result[2];</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;sequence++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case H_END :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;sequence = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>default :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;sequence = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>return sp-&gt;sequence&nbsp; ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®å‘¨æœŸã®è¨ˆç®—ã‚’å‘¼ã³å‡ºã™éƒ¨åˆ†ã‚’ã€ä¸‹è¨˜ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>void Analog()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//å‘¨æœŸã®è¨ˆç®—ã‚’è¡Œã†</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &amp; modify &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( U_WB.ready == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( CalcHelz( &amp;U_WB ) == H_END )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>U_WB.ready = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>U_WB.sequence = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( V_WB.ready == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( CalcHelz( &amp;V_WB ) == H_END )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>V_WB.ready = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>V_WB.sequence = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( W_WB.ready == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( CalcHelz( &amp;W_WB ) == H_END )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>W_WB.ready = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>W_WB.sequence = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã‚’ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®æ™‚ç‚¹ã§ã€1500rpmã§é‹è»¢æ™‚ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰å¹³å‡</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰æœ€å¤§</span>
<span>3.8ms</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰æœ€å°</span>
<span>20us</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã—ãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>æ¸¬å®šèª¤å·®ç¯„å›²ã«å…¥ã£ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-25">
<span>[13]&nbsp;ãƒ‘ã‚½ã‚³ãƒ³ãƒ¢ãƒ‹ã‚¿ãƒ¼</span>
</a>
</h1>
<p>&nbsp;<span>å®Ÿæ©Ÿã®ãƒ‡ãƒãƒƒã‚°ãŒã»ã¼çµ‚äº†ã—å‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‰ã€ãƒ‘ã‚½ã‚³ãƒ³ã§ãƒ¢ãƒ‹ã‚¿ãƒ¼ã™ã‚‹ã“ã¨ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ãã‚Œã¯é‹è»¢çŠ¶æ…‹ã‚’é€£ç¶šã—ã¦è¨˜éŒ²ã™ã‚‹ã¨ã‹ã€æºå¸¯ãªã©ã®é éš”ã‚·ã‚¹ãƒ†ãƒ ã«ç•°å¸¸ç™ºç”Ÿã‚’çŸ¥ã‚‰ã›ã‚‹ãŸã‚ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ‘ã‚½ã‚³ãƒ³ãƒ¢ãƒ‹ã‚¿ãƒ¼ã«ã¤ã„ã¦ã¯ã€ä¸‹è¨˜ã®æœ¬ã«è©³ã—ãè¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>"Discover! How?"ã‚·ãƒªãƒ¼ã‚ºã®ä¸­ã®"Monitor+Equipment+Visual C#"ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚‚ã¡ã‚ã‚“ã€ã‚ãªãŸãŒãŠå¾—æ„ã®è¨€èªã§ä½œæˆã—ã¦ä¸‹ã•ã‚Œã°å……åˆ†ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã‚Œã‹ã‚‰ãƒ‘ã‚½ã‚³ãƒ³ãƒ¢ãƒ‹ã‚¿ãƒ¼ã«å¯¾ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã®åˆ¶å¾¡ã‚½ãƒ•ãƒˆã¯ã€ãƒ‘ã‚½ã‚³ãƒ³å´ã‹ã‚‰æŒ‡ç¤ºãŒæ¥ãŸæ™‚ã«ã ã‘å¿œç­”ã™ã‚‹æ–¹å¼ã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ‘ã‚½ã‚³ãƒ³ã‹ã‚‰ã¯2ç¨®é¡ã®æŒ‡ç¤ºãŒé€ã‚‰ã‚Œã¦æ¥ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰æŒ‡å®šã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿èª­å‡ºã—æŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰æŒ‡å®šã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ã®æ›¸ãè¾¼ã¿æŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>æŒ‡å®šã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ãƒ‘ã‚½ã‚³ãƒ³ãƒ¢ãƒ‹ã‚¿ãƒ¼ã¨ã®å–ã‚Šæ±ºã‚ã§ã€ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;pasodef.h&nbsp;======================</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
<span>//&nbsp;ã‚¢ãƒ‰ãƒ¬ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_STATE=0,</span>
<span>//State&nbsp;(25)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_HISTORY=DM_STATE+25,</span>
<span>//å±¥æ­´ (12)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_ADC=&nbsp;DM_HISTORY+12,</span>
<span>//A/D&nbsp;(16)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_DAC=&nbsp;DM_ADC+16,</span>
<span>//D/A&nbsp;(8)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_CTRL=DM_DAC+8,</span>
<span>//åˆ¶å¾¡å€¤&nbsp;(25)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_CALC=DM_CTRL+25,</span>
<span>//è¨ˆç®—å€¤ (25)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_INOUT=DM_CALC+25,</span>
<span>//DI/DO&nbsp;(6)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_OUTCLR=DM_INOUT+6,</span>
<span>//å‡ºåŠ›ã‚¯ãƒªã‚¢å‘½ä»¤(1)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_REMO=DM_OUTCLR+1,</span>
<span>//ãƒªãƒ¢ãƒ¼ãƒˆ&nbsp;(20)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_TMRNUM=&nbsp;DM_REMO+20,</span>
<span>//ã‚¿ã‚¤ãƒãƒ¼ã®æ•°(1)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_CNTLNUM=DM_TMRNUM+1,</span>
<span>//åˆ¶å¾¡å®šæ•°ã®æ•°(1)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_TMRTBL=DM_CNTLNUM+1,</span>
<span>//ã‚¿ã‚¤ãƒãƒ¼æ™‚é–“ãƒ†ãƒ¼ãƒ–ãƒ«(100)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_TMSTAT=DM_TMRTBL+100,</span>
<span>//ã‚¿ã‚¤ãƒãƒ¼ã®çŠ¶æ…‹(40)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_CTRLTBL=DM_TMSTAT+40,</span>
<span>//åˆ¶å¾¡å®šæ•°ãƒ†ãƒ¼ãƒ–ãƒ«(100)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_TMSET=DM_CTRLTBL+100,</span>
<span>//å†…è”µæ™‚è¨ˆã®è¨­å®š(10)</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_REAL=DM_TMSET+10,</span>
<span>//å®Ÿæ¸¬å€¤(25)</span>
 &nbsp;</p>
<p>&nbsp;<span>MAXDATA=DM_REAL+25</span>
 &nbsp;</p>
<p>&nbsp;<span>};</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ‘ã‚½ã‚³ãƒ³ã¨ã®é€šä¿¡è¦ç´„ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000023.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ä¸€èˆ¬çš„ãªé€šä¿¡ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000003.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000018.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(1)&nbsp;èª­å‡ºã—æŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000031.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(2)&nbsp;æ›¸ãè¾¼ã¿æŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000014.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å…ˆãšã€ã“ã“ã¾ã§ã®ç¯„å›²ã§é€šä¿¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å¤§æ ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-26">
<span>(1) èª­å‡ºã—æŒ‡ç¤º</span>
</a>
</h2>
<p>&nbsp;<span>ãƒ‘ã‚½ã‚³ãƒ³ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‹ã‚‰ã®èª­å‡ºã—æŒ‡ç¤ºã«å¯¾ã—ã¦ä¸‹è¨˜ã®ã‚ˆã†ã«å¿œç­”ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Sci_1.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// Private function</span>
 &nbsp;</p>
<p>&nbsp;<span>static int GetHappen( char *s&nbsp; );</span>
 &nbsp;</p>
<p>&nbsp;<span>static int GetHistory( char *s );</span>
 &nbsp;</p>
<p>&nbsp;<span>static int GetGroup2( char *s );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// ãƒ¢ãƒ‹ã‚¿ãƒ¼èª­ã¿å‡ºã—æŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>//[@01ssRDaaaaddddff*Â¥r]</span>
 &nbsp;</p>
<p>&nbsp;<span>static void ReadMonitor( char *s )</span>
<span>//aaaadddd</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char buff[6] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( buff, s, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[4] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int addr = htoi4( buff );</span>
<span>// èª­ã¿å‡ºã—é–‹å§‹ã‚¢ãƒ‰ãƒ¬ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>s += 4;</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( buff, s, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[4] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int size = htoi4( buff );</span>
<span>// èª­ã¿å‡ºã—ï¼·ï¼¯ï¼²ï¼¤æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>strcpy( txBuf,"@" );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh2( query, buff );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( txBuf, buff );</span>
 &nbsp;</p>
<p>&nbsp;<span>//@01ssRDaaaa%%%%</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( txBuf,"00RD" );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh4( addr, buff );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( txBuf, buff );</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = txBuf + 11 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int n1, n2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( addr &gt;= DM_STATE &amp;&amp; addr &lt;&nbsp;DM_HISTORY&nbsp;)</span>
<span>//è£…ç½®æ¦‚è¦ï¼ˆç¬¬ï¼‘ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n1 = GetGroup1( t );</span>
<span>//å›è»¢æ•°ã€ç™ºé›»é›»åœ§ã€é›»æµã€é›»åŠ›</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += n1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;=&nbsp;&nbsp;DM_HISTORY&nbsp;&amp;&amp; addr &lt; DM_ADC )</span>
<span>//æ•…éšœå±¥æ­´</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>switch ( addr -&nbsp;DM_HISTORY&nbsp;)</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 0 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 1 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n1 = GetHappen( t );</span>
<span>//ç•°å¸¸å±¥æ­´çŠ¶æ…‹èª­å‡ºã—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 2 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n1 = GetHistory( t );</span>
<span>//ç•°å¸¸å±¥æ­´è©³ç´°èª­å‡ºã—</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += n1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_ADC &amp;&amp; addr &lt;&nbsp;DM_DAC&nbsp;)</span>
<span>//ã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›é›»åœ§</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n1 = GetAdcData( t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += n1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_CTRL &amp;&amp; addr &lt; DM_CALC )</span>
<span>//é‹è»¢é–¢ä¿‚ï¼ˆç¬¬2ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n1 = GetGroup2( t );</span>
<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += n1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_INOUT &amp;&amp; addr &lt; DM_OUTCLR )</span>
<span>//ãƒ‡ã‚¸ã‚¿ãƒ«å…¥å‡ºåŠ›</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n1 = GetInData( t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += n1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n2 = GetOutData( t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += n2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_TMRNUM &amp;&amp; addr &lt; DM_TMRTBL )</span>
<span>//ãƒ†ï¼ãƒ–ãƒ«ã®æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>switch ( addr - DM_TMRNUM )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 0 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( TMRNUM, t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>case 1 :</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( CTRLNUM, t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>break ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_TMRTBL &amp;&amp; addr &lt; DM_TMSTAT )</span>
<span>//ã‚¿ã‚¤ãƒï¼æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n1 = TimerTime( addr - DM_TMRTBL, size, t ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += n1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_TMSTAT &amp;&amp; addr &lt; DM_CTRLTBL )</span>
<span>//ã‚¿ã‚¤ãƒï¼ã®çŠ¶æ…‹</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n2 = TimerState( t ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += n2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_CTRLTBL &amp;&amp; addr &lt; DM_TMSET )</span>
<span>//åˆ¶å¾¡å®šæ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n1 = ReadCtrl( addr - DM_CTRLTBL, size, t ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += n1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_TMSET &amp;&amp; addr &lt; DM_REAL )</span>
<span>//å†…è”µæ™‚è¨ˆã®èª­ã¿å‡ºã—</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>unsigned char caleTbl[7] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ReadTimeRTC( caleTbl );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ConvertFromRTC( caleTbl );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( n1 = 0 ; n1 &lt; 7 ; n1++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( caleTbl[n1], t ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>n1 = strlen( txBuf ) + 3;</span>
<span>//3= FCS(2) + *(1)</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh2( n1, buff );</span>
 &nbsp;</p>
<p>&nbsp;<span>//@01ssRDaaaa%%%%</span>
 &nbsp;</p>
<p>&nbsp;<span>txBuf[3] = buff[0];</span>
 &nbsp;</p>
<p>&nbsp;<span>txBuf[4] = buff[1];</span>
 &nbsp;</p>
<p>&nbsp;<span>n2 = strlen( txBuf );</span>
 &nbsp;</p>
<p>&nbsp;<span>t = txBuf +n2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ï¼¦ï¼£ï¼³ã‚’è¨ˆç®—ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>char *r = txBuf ;</span>
 &nbsp;</p>
<p>&nbsp;<span>char c = *r++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>while ( r &lt; t )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>c ^= *r++ ;</span>
<span>//ï¼¥ï¼¯ï¼²</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh2( c, t );</span>
 &nbsp;</p>
<p>&nbsp;<span>t += 2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>*t++ = '*' ;</span>
<span>//ã‚¿ãƒ¼ãƒŸãƒãƒ¼ã‚¿ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>*t++ = 'Â¥r' ;</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-27">
<span>(2) èª­å‡ºã—æŒ‡ç¤ºå¿œç­”</span>
</a>
</h2>
<p>&nbsp;<span>èª­å‡ºã—æŒ‡ç¤ºã«å¯¾ã™ã‚‹å¿œç­”ãƒ‡ãƒ¼ã‚¿ã®å†…å®¹ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(1)&nbsp;è£…ç½®ã®çŠ¶æ…‹ã‚’æŠŠæ¡ã™ã‚‹é …ç›®</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000004.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Sci_1.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//è£…ç½®ã®çŠ¶æ…‹</span>
 &nbsp;</p>
<p>&nbsp;<span>static int GetGroup1( char *s )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh4( GetRpm(), t );</span>
<span>//ç¾åœ¨å›è»¢æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int data[16] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>GetDetails( data );</span>
<span>//å„ç›¸è¨ˆç®—å€¤è©³ç´°</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 15 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( data[n], t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return t - s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//å„ç›¸è¨ˆç®—å€¤è©³ç´° for PC</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetDetails( int data[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int val[8];</span>
 &nbsp;</p>
<p>&nbsp;<span>GetGenerate3( val );</span>
 &nbsp;</p>
<p>&nbsp;<span>data[0] = U_WB.volt ;</span>
 &nbsp;</p>
<p>&nbsp;<span>data[1] = U_WB.curr ;</span>
 &nbsp;</p>
<p>&nbsp;<span>data[2] = val[3] ;</span>
<span>//é›»åŠ›</span>
 &nbsp;</p>
<p>&nbsp;<span>data[3] = val[0] ;</span>
<span>//åŠ›ç‡</span>
 &nbsp;</p>
<p>&nbsp;<span>data[4] = U_WB.helz ;</span>
 &nbsp;</p>
<p>&nbsp;<span>data[5] = V_WB.volt ;</span>
 &nbsp;</p>
<p>&nbsp;<span>data[6] = V_WB.curr ;</span>
 &nbsp;</p>
<p>&nbsp;<span>data[7] = val[4] ;</span>
<span>//é›»åŠ›</span>
 &nbsp;</p>
<p>&nbsp;<span>data[8] = val[1] ;</span>
<span>//åŠ›ç‡</span>
 &nbsp;</p>
<p>&nbsp;<span>data[9] = V_WB.helz ;</span>
 &nbsp;</p>
<p>&nbsp;<span>data[10] = W_WB.volt ;</span>
 &nbsp;</p>
<p>&nbsp;<span>data[11] = W_WB.curr ;</span>
 &nbsp;</p>
<p>&nbsp;<span>data[12] = val[5] ;</span>
<span>//é›»åŠ›</span>
 &nbsp;</p>
<p>&nbsp;<span>data[13] = val[2] ;</span>
<span>//åŠ›ç‡</span>
 &nbsp;</p>
<p>&nbsp;<span>data[14] = W_WB.helz ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(2)&nbsp;é‹è»¢é–¢ä¿‚ã®è©³ç´°é …ç›®</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000025.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Sci_1.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã€ã‚¹ãƒ­ãƒƒãƒˆãƒ«ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ for PC</span>
 &nbsp;</p>
<p>&nbsp;<span>//DM_CTRL</span>
 &nbsp;</p>
<p>&nbsp;<span>static int GetGroup2( char *s )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int data[10];</span>
 &nbsp;</p>
<p>&nbsp;<span>GetOperation( data );</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 9 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( data[n], t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>GetThrottle( data );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh4( data[0], t );</span>
<span>//ã‚¹ãƒ­ãƒƒãƒˆãƒ«ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 3 ; n &lt; 6 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( data[n], t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return t - s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Operation.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸ã€é‹è»¢ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
<span>For PC</span>
 &nbsp;</p>
<p>&nbsp;<span>void GetOperation( int data[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>data[0] = runStage ;</span>
<span>//é‹è»¢ã‚¹ãƒ†ãƒ¼ã‚¸</span>
 &nbsp;</p>
<p>&nbsp;<span>data[1] = runSeq ;</span>
<span>//é‹è»¢ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>data[2] = engCmd ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³é‹è»¢æŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>data[3] = engStep ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³åˆ¶å¾¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</span>
 &nbsp;</p>
<p>&nbsp;<span>data[4] = engState ;</span>
<span>//ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹</span>
 &nbsp;</p>
<p>&nbsp;<span>data[5] = reason ;</span>
<span>//èµ·å‹•æº–å‚™</span>
 &nbsp;</p>
<p>&nbsp;<span>data[6] = loadIndex ;</span>
<span>//æŠ•å…¥è² è·</span>
 &nbsp;</p>
<p>&nbsp;<span>data[7] = tryCtr ;</span>
<span>//ãƒªãƒˆãƒ©ã‚¤ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>data[8] =&nbsp;restart&nbsp;;</span>
<span>//å†èµ·å‹•ãƒ•ãƒ©ã‚°</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(3)&nbsp;RTCã®èª­å‡ºã—</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000024.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Sci_1.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//RTCãƒ¬ã‚¸ã‚¹ã‚¿ã®é…åˆ—ã‚’ã€ã“ã®RTCãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç”¨ã«å¤‰æ›ãŒå¿…è¦</span>
 &nbsp;</p>
<p>&nbsp;<span>//é€šä¿¡ã‹ã‚‰ã®é…åˆ—ï¼š</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç§’ã€åˆ†ã€æ™‚ã€æ—¥ã€æœˆã€å¹´ã€é€±</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã“ã®RTCãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é…åˆ—ï¼š</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç§’ã€åˆ†ã€æ™‚ã€æ—¥ã€é€±ã€æœˆã€å¹´</span>
 &nbsp;</p>
<p>&nbsp;<span>//é€šä¿¡ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿é…åˆ—ã‚’ã€ã“ã®RTCãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç”¨ã«å¤‰æ›</span>
 &nbsp;</p>
<p>&nbsp;<span>static void ConvertToRTC( unsigned char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned char temp[3];</span>
 &nbsp;</p>
<p>&nbsp;<span>temp[0] = buff[4];</span>
<span>//æœˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>temp[1] = buff[5];</span>
<span>//å¹´</span>
 &nbsp;</p>
<p>&nbsp;<span>temp[2] = buff[6];</span>
<span>//é€±</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[4] = temp[2] ;</span>
<span>//é€±</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[5] = temp[0] ;</span>
<span>//æœˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[6] = temp[1] ;</span>
<span>//å¹´</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã“ã®RTCãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é…åˆ—ã‚’ã€é€šä¿¡ç”¨ã«å¤‰æ›</span>
 &nbsp;</p>
<p>&nbsp;<span>static void ConvertFromRTC( unsigned char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned char temp[3];</span>
 &nbsp;</p>
<p>&nbsp;<span>temp[0] = buff[4];</span>
<span>//é€±</span>
 &nbsp;</p>
<p>&nbsp;<span>temp[1] = buff[5];</span>
<span>//æœˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>temp[2] = buff[6];</span>
<span>//å¹´</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[4] = temp[1] ;</span>
<span>//æœˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[5] = temp[2] ;</span>
<span>//å¹´</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[6] = temp[0] ;</span>
<span>//é€±</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(4)&nbsp;ç•°å¸¸çŠ¶æ…‹</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000032.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Sci_1.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç•°å¸¸å±¥æ­´çŠ¶æ…‹</span>
 &nbsp;</p>
<p>&nbsp;<span>static int GetHappen( char *s&nbsp; )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh4( GetErrorCode(), t );</span>
<span>//ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰</span>
 &nbsp;</p>
<p>&nbsp;<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh4( GetRecCount(), t );</span>
<span>//å±¥æ­´ä¿å­˜æ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return t - s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//ç•°å¸¸å±¥æ­´è©³ç´°</span>
 &nbsp;</p>
<p>&nbsp;<span>static int GetHistory( char *s )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int data[10] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( GetRecord( data ) == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( int n = 0 ; n &lt; 9 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( data[n], t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return t - s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(5)ã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000009.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Analog.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒ‘ã‚½ã‚³ãƒ³ã«é€ã‚‹ãƒ‡ãƒ¼ã‚¿</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetAdcData( char *s )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh4( adcVal[P_Ai02], t );</span>
<span>// 2 ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãƒã‚¸ã‚·ãƒ§ãƒ³</span>
 &nbsp;</p>
<p>&nbsp;<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh4( adcVal[P_Ai03], t );</span>
<span>// 3 å†·å´æ°´æ¸©</span>
 &nbsp;</p>
<p>&nbsp;<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh4( adcVal[P_Ai10], t );</span>
<span>//10 è¡¨ç¤ºé¸æŠVR</span>
 &nbsp;</p>
<p>&nbsp;<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh4( adcVal[P_Ai11], t );</span>
<span>//11 å›è»¢æ•°å¤‰æ›´VRï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return t - s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(6)ãƒ‡ã‚¸ã‚¿ãƒ«å…¥å‡ºåŠ›</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000019.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000028.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Input.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒ‘ã‚½ã‚³ãƒ³ã¸ã®ãƒ¢ãƒ‹ã‚¿ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetInData( char *s )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>struct inCtr *sp ;</span>
 &nbsp;</p>
<p>&nbsp;<span>const bool *sq ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned short mask = 0x0001 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned short buff[3];</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[0] =&nbsp;</span>
<span>0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = P_Di00 ; n &lt;= P_Di15 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp = &amp;inTbl[n] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sq = &amp;logic[n] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( sp-&gt;on &gt; MANY )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( *sq == POS )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>buff[0] |= mask ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( sp-&gt;off &gt; MANY )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( *sq == NEG )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>buff[0] |= mask ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>mask &lt;&lt;= 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[1] = buff[2] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( buff[n], t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return t - s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000002.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Output.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒ‘ã‚½ã‚³ãƒ³ã¸ã®ãƒ¢ãƒ‹ã‚¿</span>
 &nbsp;</p>
<p>&nbsp;<span>int GetOutData( char *s )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned short mask ;</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned short buff[3] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int n1, n2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int k = 0 ; k &lt; 3 ; k++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n1 = k * 16 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n2 = n1 + 16 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>buff[k] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>mask = 0x0001 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for (int&nbsp; n = n1 ; n &lt; n2 &amp;&amp; n &lt; OUTNUM ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( BitCheck( n ) == ON )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>buff[k] |= mask ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>mask &lt;&lt;= 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( buff[n], t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return t - s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(7)ã‚¿ã‚¤ãƒãƒ¼ã®çŠ¶æ…‹</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000013.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000022.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Timer.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒ‘ã‚½ã‚³ãƒ³ã‹ã‚‰å…¨ã¦ã®ã‚¿ã‚¤ãƒï¼ã®çŠ¶æ…‹ã‚’èª­ã¿å‡ºã™</span>
 &nbsp;</p>
<p>&nbsp;<span>int TimerState( char *s )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>int j, k, m, n ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>j = m = 0 ;&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>for (n = 0 ; n &lt; TMRNUM ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>k = timeTbl[n].stat ;</span>
<span>//ï¼’ãƒ“ãƒƒãƒˆã§ï¼‘ã‚¿ã‚¤ãƒãƒ¼çŠ¶æ…‹ã‚’ä½œã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>k &lt;&lt;= m ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j |= k ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m += 2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( m &gt;= 16 )</span>
<span>//ï¼‘ï¼·ï¼¯ï¼²ï¼¤åˆ†ãŸã¾ã£ãŸã‚‰æ›¸ãè¾¼ã‚€</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( j, t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>j = m = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( m != 0 )</span>
<span>//ãã£ã¡ã‚Šï¼‘ï¼·ï¼¯ï¼²ï¼¤åˆ†ã§çµ‚ã‚ã£ã¦ã„ãªã„ã¨ãã¯æ®‹ã‚Šã‚’æ›¸ãè¾¼ã‚€</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( j, t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return t - s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(8)ä¸‹è¨˜ã¯æŒ‡å®šã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰25shortä»¥å†…ã§èª­ã¿å‡ºã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_TMRTBL</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Timer.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒ‘ã‚½ã‚³ãƒ³ã‹ã‚‰æŒ‡å®šã—ãŸç¯„å›²ã®ã‚¿ã‚¤ãƒï¼è¨­å®šæ™‚é–“ã‚’èª­ã¿å‡ºã™</span>
 &nbsp;</p>
<p>&nbsp;<span>int TimerTime( int m, int n, char *s )</span>
<span>// ï½ã‹ã‚‰ï½å€‹</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int j = 0 ; j &lt; n &amp;&amp; m &lt; TMRNUM ; m++, j++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( timeTbl[m].time, t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return t - s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>DM_CTRLTBL</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Eeprom.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒ‘ã‚½ã‚³ãƒ³ã‹ã‚‰æŒ‡å®šã—ãŸç¯„å›²ã®åˆ¶å¾¡å®šæ•°ã‚’èª­ã¿å‡ºã™</span>
 &nbsp;</p>
<p>&nbsp;<span>int ReadCtrl( int m, int n, char *s )</span>
<span>// ï½ã‹ã‚‰ï½å€‹</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int j = 0 ; j &lt; n &amp;&amp; m &lt; CTRLNUM ; m++, j++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>itoh4( ctrlTbl[m], t );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>t += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>return t - s ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-28">
<span>(3) æ›¸ãè¾¼ã¿æŒ‡ç¤ºå¿œç­”</span>
</a>
</h2>
<p>&nbsp;<span>ãƒ‘ã‚½ã‚³ãƒ³ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‹ã‚‰ã®æ›¸ãè¾¼ã¿æŒ‡ç¤ºã«å¯¾ã—ã¦ä¸‹è¨˜ã®ã‚ˆã†ã«å¿œç­”ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====Sci_1.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// ãƒ¢ãƒ‹ã‚¿ãƒ¼æ›¸ãè¾¼ã¿å‘½ä»¤</span>
 &nbsp;</p>
<p>&nbsp;<span>//[@01ssWTaaaadddd..ff*Â¥r]</span>
 &nbsp;</p>
<p>&nbsp;<span>static void WriteMonitor( char *s, int size )</span>
<span>//aaaadddd....dddd</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char buff[6] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int m, n ;</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned short wd ;</span>
 &nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;<span>//s=aaaadddd....</span>
 &nbsp;</p>
<p>&nbsp;<span>strncpy( buff, s, 4 );</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[4] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int addr = htoi4( buff );</span>
 &nbsp;</p>
<p>&nbsp;<span>s += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( addr &gt;=&nbsp;DM_HISTORY&nbsp;&amp;&amp; addr &lt;&nbsp;DM_ADC&nbsp;)</span>
<span>//å±¥æ­´èª­å‡ºã—ç•ªå·</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if (( addr -&nbsp;DM_HISTORY&nbsp;) == 2 )</span>
<span>//å±¥æ­´èª­å‡ºã—ç•ªå·</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n = htoi4( s ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetHistory( n );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_CTRL &amp;&amp; addr &lt; DM_CALC )</span>
<span>//åˆ¶å¾¡æŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n = htoi4( s ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//DM_CTRL+0=èµ·å‹•=1ã€åœæ­¢=2ã€ãƒªã‚»ãƒƒãƒˆ=3ã€éå¸¸åœæ­¢=4</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetRunKey( n );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_INOUT &amp;&amp; addr &lt; DM_OUTCLR )</span>
<span>//ãƒ‡ã‚¸ã‚¿ãƒ«å‡ºåŠ›æŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkInp( P_Di04 ) == ON )</span>
<span>// 4 è‡ªå‹•=OFFï¼æ‰‹å‹•=ON</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m = ( addr - DM_INOUT - 3 ) * 2 ;</span>
<span>// Input = 3 Byte</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( m &gt;= 0 &amp;&amp; m &lt;= 4 )</span>
<span>//0,2,4</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>wd = htoi4( s ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>manuOut[m] = wd ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>s += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>wd = htoi4( s ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>manuOut[m+1] = wd ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>Mainte( manuOut );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( m = 0 ; m &lt; 6 ; m++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>manuOut[m] = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_OUTCLR &amp;&amp; addr &lt; DM_REMO )</span>
<span>//å…¨ãƒ‡ã‚¸ã‚¿ãƒ«å‡ºåŠ›OFFæŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ChkInp( P_Di04 ) == ON )</span>
<span>// 4 è‡ªå‹•=OFFï¼æ‰‹å‹•=ON</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OffOutAll();</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_TMRTBL &amp;&amp; addr &lt; DM_TMSTAT )</span>
<span>//ã‚¿ã‚¤ãƒï¼æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m = addr - DM_TMRTBL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>while ( size-- &gt; 0 )</span>
<span>//size!</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>wd = htoi4( s ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>s += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>PutTime( m, wd );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>writeTimeEEPROM( m, wd );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_CTRLTBL &amp;&amp; addr &lt; DM_TMSET )</span>
<span>//åˆ¶å¾¡å®šæ•°</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m = addr - DM_CTRLTBL ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>while ( size-- &gt; 0 )</span>
<span>//size!</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>wd = htoi4( s ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>s += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>SetCtrl( m, wd );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>writeCtrlEEPROM( m, wd );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>m++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else if ( addr &gt;= DM_TMSET &amp;&amp; addr &lt; DM_REAL )</span>
<span>//å†…è”µæ™‚è¨ˆã®è¨­å®š</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>unsigned char caleTbl[7] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( n = 0 ; n &lt; 7 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>wd = htoi4( s ) ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>s += 4 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>caleTbl[n] = (unsigned char)wd ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ConvertToRTC( caleTbl );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>WriteTimeRTC( caleTbl );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>strcpy( txBuf,"@" );</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh2( query, txBuf+1 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//@01ssWTff* = 10char</span>
 &nbsp;</p>
<p>&nbsp;<span>n = 10;</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh2( n, buff );</span>
 &nbsp;</p>
<p>&nbsp;<span>buff[2] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( txBuf, buff );</span>
 &nbsp;</p>
<p>&nbsp;<span>strcat( txBuf, "WT" );</span>
 &nbsp;</p>
<p>&nbsp;<span>char *t = txBuf + 7 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//ï¼¦ï¼£ï¼³ã‚’è¨ˆç®—ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>char *r = txBuf ;</span>
 &nbsp;</p>
<p>&nbsp;<span>char c = *r++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>while ( r &lt; t )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>c ^= *r++ ;</span>
<span>//ï¼¥ï¼¯ï¼²</span>
 &nbsp;</p>
<p>&nbsp;<span>itoh2( c, t );</span>
 &nbsp;</p>
<p>&nbsp;<span>t += 2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>*t++ = '*' ;</span>
<span>//ã‚¿ãƒ¼ãƒŸãƒãƒ¼ã‚¿ãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>*t++ = 'Â¥r' ;</span>
 &nbsp;</p>
<p>&nbsp;<span>*t = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000030.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(1)&nbsp;ç•°å¸¸å±¥æ­´</span>
 &nbsp;</p>
<p>&nbsp;<span>èª­ã¿å‡ºã—ãŸã„ç•ªå·ã‚’DM_HISTORYã®ã€Œç•°å¸¸å±¥æ­´èª­ã¿å‡ºã—ç•ªå·ã€ã«æ›¸ãè¾¼ã‚“ã å¾Œã«ã€ã€Œç•°å¸¸å±¥æ­´èª­ã¿å‡ºã—ç•ªå·ã€ã®èª­å‡ºã—æŒ‡ç¤ºã‚’ã™ã‚‹ã¨ã€è©²å½“ã™ã‚‹å±¥æ­´ãŒé€ã‚‰ã‚Œã¦æ¥ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000006.gif" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(2)&nbsp;æŠ¼ã—ãƒœã‚¿ãƒ³æ“ä½œ</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ‘ãƒãƒ«ã®æŠ¼ã—ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ä»£ã‚ã‚Šã«ã€ãƒ‘ã‚½ã‚³ãƒ³ã‹ã‚‰ã®æŒ‡ç¤ºã§ãƒœã‚¿ãƒ³ã‚’æ“ä½œã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Input.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒ‘ã‚½ã‚³ãƒ³ã‹ã‚‰ã®ãƒœã‚¿ãƒ³æ“ä½œæŒ‡ç¤º</span>
 &nbsp;</p>
<p>&nbsp;<span>//èµ·å‹•=1ã€åœæ­¢=2ã€ãƒªã‚»ãƒƒãƒˆ=3ã€éå¸¸åœæ­¢=4</span>
 &nbsp;</p>
<p>&nbsp;<span>void SetRunKey( int n )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( n &gt;= 1 &amp;&amp; n &lt;= 4 )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>struct inCtr *sp ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n += P_Di11 ;</span>
<span>//P_Di12..P_Di15</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp = &amp;inTbl[n] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;on = LIMIT * 20 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp-&gt;off = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>OnTimer(TM22);</span>
<span>//ãƒ‘ã‚½ã‚³ãƒ³ã‚­ãƒ¼æœ‰åŠ¹æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>void Input()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp++ ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&gt;&gt;&gt; add &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( ChkTimer(TM22) != ON )&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( n = P_Di12 ; n &lt;= P_Di15 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>sp = &amp;inTbl[n] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( sp-&gt;on &gt; 0 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>sp-&gt;on-- ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//&lt;&lt;&lt; end &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== common.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//Timer</span>
 &nbsp;</p>
<p>&nbsp;<span>enum {</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>TM22,</span>
<span>//ãƒ‘ã‚½ã‚³ãƒ³ã‚­ãƒ¼æœ‰åŠ¹æ™‚é–“</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== timer.h ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>const unsigned short timeBase[TMRNUM] = {</span>
<span>//100ms</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>10,</span>
<span>//TM22</span>
 &nbsp;</p>
<p>&nbsp;<span>:</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000016.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(3)&nbsp;ãƒ‡ã‚¸ã‚¿ãƒ«å‡ºåŠ›</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Output.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>// ãƒ¡ã‚¤ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰</span>
 &nbsp;</p>
<p>&nbsp;<span>void Mainte( unsigned short *p )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned short&nbsp;indicate, onoff, mask ;</span>
 &nbsp;</p>
<p>&nbsp;<span>int n1, n2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>// ï¼‘ï¼–å€‹æ¯ã«å‡¦ç†ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>for ( int k = 0 ; k &lt; 3 ; k++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n1 = k * 16 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>n2 = n1 + 16 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>indicate&nbsp;= *p++ ;</span>
<span>// æŒ‡ç¤ºæœ‰ã‚Š</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>onoff = *p++ ;</span>
<span>// ï¼¯ï¼®ï¼ï¼¯ï¼¦ï¼¦æƒ…å ±</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>mask = 0x0001 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if (&nbsp;indicate&nbsp;)</span>
<span>// ä½•ã‹ã®æŒ‡ç¤ºæœ‰ã‚Šãªã‚‰</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( int n = n1 ; n &lt; n2 &amp;&amp; n &lt; OUTNUM ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if (&nbsp;indicate&nbsp;&amp; mask )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( onoff &amp; mask )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OnOut( n );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>OffOut( n );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>mask &lt;&lt;= 1 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>(4)&nbsp;æ™‚é–“ã€å®šæ•°ãƒ‡ãƒ¼ã‚¿ã®æ›¸ãè¾¼ã¿</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Eeprom.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//æ™‚é–“ãƒ‡ãƒ¼ã‚¿ã‚’EEPROMã«æ›¸ãè¾¼ã‚€</span>
 &nbsp;</p>
<p>&nbsp;<span>bool writeTimeEEPROM( int n, short wd )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( alive == false )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>if (!( n &gt;= 0 &amp;&amp; n &lt; TMRNUM ))</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned short adrs = EETIME + n * 2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned short val = wd ;</span>
 &nbsp;</p>
<p>&nbsp;<span>bool flag = WriteEEPROM(adrs, (unsigned char*)&amp;val, 2);</span>
 &nbsp;</p>
<p>&nbsp;<span>//EEPROMã®æ›¸ãè¾¼ã¿æ™‚é–“ã ã‘å¾…ã¤</span>
 &nbsp;</p>
<p>&nbsp;<span>Wait( 10000 );</span>
<span>//10ms</span>
 &nbsp;</p>
<p>&nbsp;<span>//è­˜åˆ¥ã‚³ãƒ¼ãƒ‰ã‚’è¨ˆç®—ã—ã¦æ›¸ãè¾¼ã‚€</span>
 &nbsp;</p>
<p>&nbsp;<span>return CalcEEPROM();&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//å®šæ•°ãƒ‡ãƒ¼ã‚¿ã‚’EEPROMã«æ›¸ãè¾¼ã‚€</span>
 &nbsp;</p>
<p>&nbsp;<span>bool writeCtrlEEPROM( int n, short nVal )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( alive == false )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>if (!( n &gt;= 0 &amp;&amp; n &lt; CTRLNUM ))</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false ;</span>
 &nbsp;</p>
<p>&nbsp;<span>unsigned short adrs = EECTRL + n * 2 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>short val = nVal ;</span>
 &nbsp;</p>
<p>&nbsp;<span>bool flag = WriteEEPROM(adrs, (unsigned char*)&amp;val, 2);</span>
 &nbsp;</p>
<p>&nbsp;<span>//EEPROMã®æ›¸ãè¾¼ã¿æ™‚é–“ã ã‘å¾…ã¤</span>
 &nbsp;</p>
<p>&nbsp;<span>Wait( 10000 );</span>
<span>//10ms</span>
 &nbsp;</p>
<p>&nbsp;<span>//è­˜åˆ¥ã‚³ãƒ¼ãƒ‰ã‚’è¨ˆç®—ã—ã¦æ›¸ãè¾¼ã‚€</span>
 &nbsp;</p>
<p>&nbsp;<span>return CalcEEPROM();&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚ã«ã€ãƒ‘ã‚½ã‚³ãƒ³ã‹ã‚‰é€ã‚‰ã‚Œã¦ããŸæŒ‡ç¤ºã‚’LCDç”»é¢ã«è¡¨ç¤ºå‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Sci_1.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>static const char&nbsp;scSCI1[][21] = {</span>
<span>//RS232Cé€šä¿¡1</span>
 &nbsp;</p>
<p>&nbsp;<span>{"SCI1&nbsp; 19200&nbsp; 8odd1&nbsp; "},</span>
 &nbsp;</p>
<p>&nbsp;<span>{"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "}};</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//LCDã‹ã‚‰ã®å•ã„åˆã‚ã›ã«å¿œç­”ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>bool IsRecvData1( bool flag, char buff[] )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>char line[22] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( flag == false )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( buff, scSCI1[0], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( int n = 0 ; n &lt; 3 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scSCI1[1], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( dspOK == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//1st line</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( buff, scSCI1[0], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int n = strlen( lcdBuf );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( n &lt;= 20 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//2nd line</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcpy( line, lcdBuf );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int m = strlen( line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( n = m ; n &lt; 20 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>strcat( &amp;line[n], " " );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//3rd line</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scSCI1[1], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//2nd line</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, lcdBuf, 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//3rd line</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcpy( line, &amp;lcdBuf[20] );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>int m = strlen( line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>for ( n = m ; n &lt; 20 ; n++ )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>strcat( &amp;line[n], " " );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//4th line</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strncpy( line, scSCI1[1], 20 );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, line );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>strcat( buff, "," );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>dspOK = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return true;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>buff[0] = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return false;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>===== Display.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//RS232C&nbsp;é€šä¿¡&nbsp;1</span>
 &nbsp;</p>
<p>&nbsp;<span>static void DispSCI_1()</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( first == true)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>first = false;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>IsRecvData1( false, lcdBuff );</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ShowLcdBuff( 4, 1 );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( IsRecvData1( true, lcdBuff ) == true )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>ShowLcdBuff( 4, 1 );</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000026.jpg" alt="" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã§ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã€å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ‘ã‚½ã‚³ãƒ³ãƒ¢ãƒ‹ã‚¿ãƒ¼ã¨æ¥ç¶šã—ã¦ã€å„ç¨®ã®æƒ…å ±ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>é€šå¸¸é‹è»¢æ™‚ã®ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ã‚¯ãƒ«æ™‚é–“ã¯ã€æœ€å¤§ã§ã‚‚3.8msç¨‹åº¦ã§ã—ãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<img src="images/000001.jpg" alt="monitorImage" />
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-29">
<span>[14]&nbsp;å®Ÿæ©Ÿç”¨ã«å¤‰æ›´</span>
</a>
</h1>
<p>&nbsp;<span>ã•ã¦ã€ã„ã‚ˆã„ã‚ˆä½œæˆã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿéš›ã®æ©Ÿæ¢°ã§å®Ÿè¡Œã™ã‚‹æœ€çµ‚æ®µéšã«å…¥ã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å®Ÿæ©Ÿã‚’é‹è»¢ã™ã‚‹æ™‚ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰ãƒ†ã‚¹ãƒˆç”¨ã®å‰²ã‚Šè¾¼ã¿ã‚’åœæ­¢ã™ã‚‹ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰å®Ÿæ©Ÿç”¨ã®ã‚¯ãƒ©ãƒ³ã‚¯ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚µãƒ¼ã‚½ãƒ•ãƒˆã«å¤‰æ›´ã™ã‚‹ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰ä¸‹è¨˜ã®åˆ¶å¾¡å®šæ•°å€¤ã‚’å®Ÿæ©Ÿã§æ¸¬å®šã—ã¦è¨­å®šã™ã‚‹ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(1)&nbsp;ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼èµ·å‹•æ™‚ã®ã‚¹ãƒ­ãƒƒãƒˆãƒ«é–‹åº¦ï¼ˆãƒ‘ãƒ«ã‚¹å€¤ï¼‰=&gt;C00</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(2)&nbsp;è² è·æŠ•å…¥é–‹å§‹æ™‚ã®ã‚¹ãƒ­ãƒƒãƒˆãƒ«é–‹åº¦ï¼ˆãƒ‘ãƒ«ã‚¹å€¤ï¼‰=&gt;C01</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(3)&nbsp;ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãƒã‚¸ã‚·ãƒ§ãƒ³æœ€å°å€¤ï¼ˆADå€¤ï¼‰=&gt;C02</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;(4)&nbsp;ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãƒã‚¸ã‚·ãƒ§ãƒ³æœ€å¤§å€¤ï¼ˆADå€¤ï¼‰=&gt;C03</span>
 &nbsp;</p>
<p>&nbsp;<span>(5) ã‚¹ãƒ­ãƒƒãƒˆãƒ«å¯å‹•ç¯„å›²ã®æœ€å¤§ãƒ‘ãƒ«ã‚¹æ•°&nbsp;=&gt;C11</span>
 &nbsp;</p>
<p>&nbsp;<span>(6) å†·å´æ°´æ¸©ç•°å¸¸å€¤&nbsp;=&gt;C10</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2>
<a id="calibre_link-30">
<span>(1) å®Ÿæ©Ÿç”¨ã«å®Ÿè£…</span>
</a>
</h2>
<p>&nbsp;<span>ã§ã¯ã€å®Ÿæ©Ÿç”¨ã®ã‚¯ãƒ©ãƒ³ã‚¯ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚µãƒ¼éƒ¨ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ†ã‚¹ãƒˆã§ä½¿ã£ãŸã‚‚ã®ã¨å½¢å¼ã¯åŒæ§˜ã§ã™ãŒã€ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ¬ã‚¸ã‚¹ã‚¿è¨˜å·ãŒç•°ãªã‚Šã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;hwsetup.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//Interrupt priority</span>
 &nbsp;</p>
<p>&nbsp;<span>//-----------------------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>INTC.IPR09.BIT._MTU21G = 15&nbsp;;</span>
<span>//MTU21.TIER.BIT.TGIEA</span>
 &nbsp;</p>
<p>&nbsp;<span>INTC.IPR09.BIT._MTU21C = 14&nbsp;;</span>
<span>//MTU21.TIER.BIT.TCIEV</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>INTC.IPR10.BIT._MTU22G = 15&nbsp;;</span>
<span>//MTU22.TIER.BIT.TGIEA</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>INTC.IPR10.BIT._MTU22C = 14&nbsp;;</span>
<span>//MTU22.TIER.BIT.TCIEV</span>
 &nbsp;</p>
<p>&nbsp;<span>//</span>
<span>INTC.IPR11.BIT._MTU24G =&nbsp;9&nbsp;;</span>
<span>//MTU24.TIER.BIT.TGIEA&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒãƒ«ãƒãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>//-----------------------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>//MTU2 ãƒãƒ£ãƒãƒ«ï¼‘ã‚’ã‚¯ãƒ©ãƒ³ã‚¯ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚µãƒ¼ã«ä½¿ç”¨ PE4/TIOC1A</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£ã§å›è»¢æ•°ã‚’è¨ˆæ¸¬ã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>//PE4/TIOC1A</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU21.TMDR.BYTE = 0 ;</span>
<span>//é€šå¸¸å‹•ä½œ</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU21.TCR.BIT.CCLR = 1 ;</span>
<span>//TGRA ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£ã§TCNT ã‚¯ãƒªã‚¢</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU21.TCR.BIT.CKEG = 1 ;</span>
<span>//01ï¼šç«‹ã¡ä¸‹ãŒã‚Šã‚¨ãƒƒã‚¸ã§ã‚«ã‚¦ãƒ³ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU21.TCR.BIT.TPSC = 3 ;</span>
<span>//å‘¨è¾ºã‚¯ãƒ­ãƒƒã‚¯ï¼šPÏ†ï¼64 ã§ã‚«ã‚¦ãƒ³ãƒˆ 64/50MHz = 1.28us</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU21.TIOR.BIT.IOA = 9 ;</span>
<span>//TIOC1A ç«¯å­ 01ï¼šç«‹ã¡ä¸‹ãŒã‚Šã‚¨ãƒƒã‚¸ã§ã‚«ã‚¦ãƒ³ãƒˆ</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU21.TIER.BIT.TGIEA = 1 ;</span>
<span>//1ï¼šTGFAãƒ“ãƒƒãƒˆã«ã‚ˆã‚‹å‰²ã‚Šè¾¼ã¿è¦æ±‚ï¼ˆTGIAï¼‰ã‚’è¨±å¯&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TGR ã‚¤ãƒ³ã‚¿ãƒ©ãƒ—ãƒˆã‚¤ãƒãƒ¼ãƒ–ãƒ« A&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>MTU21.TIER.BIT.TCIEV = 1 ;</span>
<span>//1ï¼šTCFVãƒ“ãƒƒãƒˆã«ã‚ˆã‚‹å‰²ã‚Šè¾¼ã¿è¦æ±‚ï¼ˆTCIVï¼‰ã‚’è¨±å¯&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ã‚ªãƒ¼ãƒãƒ•ãƒ­ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ãƒ—ãƒˆã‚¤ãƒãƒ¼ãƒ–ãƒ«</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>//ãƒãƒ¼ãƒˆæ©Ÿèƒ½è¨­å®š</span>
 &nbsp;</p>
<p>&nbsp;<span>//E port --------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¯ãƒ©ãƒ³ã‚¯ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚µãƒ¼</span>
 &nbsp;</p>
<p>&nbsp;<span>PFC.PEIORL.BIT.B4 = 0 ;</span>
<span>//PE4 TIOC1A å…¥åŠ›&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>PFC.PECRL2.BIT.PE4MD = 6 ;</span>
<span>//PE4 110ï¼šTIOC1A å…¥åŠ›ï¼ˆMTU2ï¼‰</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>å®Ÿæ©Ÿç”¨ã®ã‚¯ãƒ©ãƒ³ã‚¯ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚µãƒ¼å‰²ã‚Šè¾¼ã¿ã‚’è¿½åŠ ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>=====&nbsp;Rotate.cpp ======================</span>
 &nbsp;</p>
<p>&nbsp;<span>//ã‚¯ãƒ©ãƒ³ã‚¯ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚µãƒ¼ã€€MTU2ãƒãƒ£ãƒãƒ«ï¼‘</span>
 &nbsp;</p>
<p>&nbsp;<span>// 164 MTU2 MTU1 TGIA1</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2_MTU1_TGIA1(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( MTU21.TSR.BIT.TGFA )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU21.TSR.BIT.TGFA = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( newCtr &lt; 36 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>newCtr++;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>return ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU21.TCNT = 0 ;</span>
<span>//ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¯ãƒªã‚¢</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>newCount = MTU21.TGRA ;</span>
<span>//ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼ã—ãŸå€¤</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>//æ¬ æ­¯ã‚’åˆ¤å®šã™ã‚‹ï¼å‰å›ã®å€¤ã®ï¼“å€è¿‘ã„ï¼ï¼’å€ã‚’è¶Šãˆã¦ã„ã‚‹ãªã‚‰æ¬ æ­¯</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if (( ctrBuf[0] &gt; 0 ) &amp;&amp; ( newCount &gt;= ( ctrBuf[1] + ctrBuf[2] )))</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>working = 0;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>else if ( speedFlag &lt;= MEDIUM )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>if ( ++working &amp; 0x01 )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>//ä¸­å¤®å€¤ã‚’æ±‚ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>ctrBuf[0] = ctrBuf[1] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>ctrBuf[1] = ctrBuf[2] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>ctrBuf[2] = newCount ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( newCount &gt; ctrBuf[1] )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( ctrBuf[1] &gt; ctrBuf[0] )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>center = ctrBuf[1] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>else if ( newCount &gt; ctrBuf[0] )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>center = ctrBuf[0] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>center = newCount ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( newCount &gt; ctrBuf[0] )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>center = newCount ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>else if ( ctrBuf[1] &gt; ctrBuf[0] )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>center = ctrBuf[0] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>else</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>&nbsp;</span>
<span>center = ctrBuf[1] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>// ç·å’Œã‹ã‚‰ç¾åœ¨ãƒã‚¤ãƒ³ãƒˆå€¤ã‚’å¼•ã</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>rpmSum -= rpmAve[rpmPtr] ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>// å…¥åŠ›å€¤ã‚’ãƒã‚¤ãƒ³ãƒˆéƒ¨ã¸å…¥ã‚Œã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>rpmAve[rpmPtr] = center ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>// ç·å’Œã«å…¥åŠ›å€¤ã‚’åŠ ãˆã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>rpmSum += center ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>// ãƒã‚¤ãƒ³ã‚¿ã‚’æ¬¡ã«é€²ã‚ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>if ( ++rpmPtr &gt;= AVENUM )</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>&nbsp;</span>
<span>rpmPtr = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>//84msã§overflowã™ã‚‹</span>
 &nbsp;</p>
<p>&nbsp;<span>// 168 MTU2 MTU1 TCIV1</span>
 &nbsp;</p>
<p>&nbsp;<span>void INT_MTU2_MTU1_TCIV1(void)</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>if ( MTU21.TSR.BIT.TCFV )</span>
 &nbsp;</p>
<p>&nbsp;<span>{</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>MTU21.TSR.BIT.TCFV = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
<span>newCtr = 0 ;</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>}</span>
 &nbsp;</p>
<p>&nbsp;<span>===========================</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<h2><a id="calibre_link-35"></a>
<a id="calibre_link-31">
<span>(2) å‹•ä½œç¢ºèª</span>
</a>
</h2>
<p>&nbsp;<span>ã§ã¯ã€å®Ÿæ©Ÿã§å®Ÿè¡Œã—ã¦ã€æ¬¡ã®æ‰‹é †ã§ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ç•°å¸¸ã‚’æ„Ÿã˜ãŸã‚‰ã€ã™ãã«ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã€ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã‚’è½ã¨ã™ãªã©ã€å®‰å…¨å¯¾ç­–ã‚’ç¢ºèªã—ã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ä¸‹ã•ã„ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‰ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã™å‰ã«ã€ã‚¹ãƒ­ãƒƒãƒˆãƒ«ã®åŸç‚¹å¾©å¸°ãŒæ­£ã—ãè¡Œã‚ã‚Œã¾ã—ãŸã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼’ï¼‰ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãŒå°‘ã—é–‹ãã€ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãŒå‹•ä½œã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼“ï¼‰ç‚¹ç«ã—ãªã„æ™‚ã¯ã€ä½•åº¦ã‹ç¹°ã‚Šè¿”ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼”ï¼‰ç‚¹ç«ã—ãŸæ™‚ã¯ã€ã•ã‚‰ã«ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãŒé–‹ãå›è»¢æ•°ãŒä¸Šæ˜‡ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼•ï¼‰è² è·æŠ•å…¥ã”ã¨ã«ä½ä¸‹ã™ã‚‹å›è»¢æ•°ã‚’ã€å›å¾©ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼–ï¼‰å…¨è² è·æŠ•å…¥å¾Œã‚‚ç›®æ¨™ã®1500rpmè¿‘è¾ºã§å›è»¢æ•°ãŒå®‰å®šã—ã¦ã„ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼—ï¼‰ã“ã“ã§æ•…æ„ã«ç‡ƒæ–™ã‚’æ­¢ã‚ãŸã‚‰ã€ã‚¨ãƒ³ã‚¹ãƒˆã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼˜ï¼‰ã‚¨ãƒ³ã‚¹ãƒˆã—ãŸã‚‰è‡ªå‹•çš„ã«å†èµ·å‹•ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼™ï¼‰åˆ¶é™å›æ•°ã‚’è¶Šãˆã‚‹ã‚¨ãƒ³ã‚¹ãƒˆã§ã¯ç•°å¸¸åœæ­¢ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼ï¼‰å§‹å‹•æ™‚ã§ã®èµ·å‹•ã«å¤±æ•—ã—ãŸæ™‚ã‚‚ã€å†èµ·å‹•ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼‘ï¼‰é‹è»¢ä¸­ã«ã€éå¸¸åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ç•°å¸¸åœæ­¢ã—ã€ç‡ƒæ–™é®æ–­å¼ãŒé–‰ã˜ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼’ï¼‰é‹è»¢ä¸­ã«ã€ã‚µãƒ¼ãƒãƒ«ãƒˆãƒªãƒƒãƒ—ã•ã›ã‚‹ã¨ç•°å¸¸åœæ­¢ã—ã€ç‡ƒæ–™é®æ–­å¼ãŒé–‰ã˜ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼“ï¼‰å…¨è² è·æŠ•å…¥å¾Œã€å‘¨æ³¢æ•°ãŒä¸€å®šæ™‚é–“ä»¥ä¸Šã«ã‚ãŸã£ã¦è¨±å®¹ç¯„å›²ã‚’é€¸è„±ã—ã¦ã„ã‚‹æ™‚ã«ã€ç•°å¸¸åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>ï¼‘ï¼”ï¼‰åŒæ§˜ã«ã€é›»åœ§ãŒä¸€å®šæ™‚é–“ä»¥ä¸Šã«ã‚ãŸã£ã¦è¨±å®¹ç¯„å›²ã‚’é€¸è„±ã—ã¦ã„ã‚‹æ™‚ã«ã€ç•°å¸¸åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ</span>
 &nbsp;</p>
<p>&nbsp;<span>------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ã™ã¹ã¦ãŒå•é¡Œãªãæ©Ÿèƒ½ã—ã¦ã„ãŸã‚‰ã€å®Œæˆã§ã™ï¼</span>
 &nbsp;</p>
<p>&nbsp;<span>ã‚ãªãŸã¯ã€ã¤ã„ã«ç›®æ¨™ã«åˆ°é”ã—ã¾ã—ãŸï¼</span>
 &nbsp;</p>
<p>&nbsp;<span>ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</span>
 &nbsp;</p>
<p>&nbsp;<span>ãƒ—ãƒ­ã¨ã—ã¦ã®å®ŸåŠ›ã‚’ã—ã£ã‹ã‚Šã¨èº«ã«ä»˜ã‘ã‚‰ã‚ŒãŸã“ã¨ã¨æ€ã„ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã‚Œã‹ã‚‰ã¯ã€ã”è‡ªåˆ†ã®åŠ›ã§æœªæ¥ã‚’åˆ‡ã‚Šé–‹ãã€äººã®ãŸã‚ã«å½¹ç«‹ã¤ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã•ã‚Œã‚‹ã“ã¨ã‚’</span>
 &nbsp;</p>
<p>&nbsp;<span>å¿ƒã‹ã‚‰æœŸå¾…ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;</p>
<div></div>
<br />
&nbsp;<h1>
<a id="calibre_link-32">
<span>[15]&nbsp;ã‚ã¨ãŒã</span>
</a>
</h1>
<p>&nbsp;<span>å¿œç”¨èª²ç¨‹ã®èª¬æ˜ã¯ä»¥ä¸Šã§ã™ãŒã€ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã€è‰²ã€…ãªæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ä½œæˆèƒ½åŠ›ã‚’ã•ã‚‰ã«å‘ä¸Šã•ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>ã“ã“ã¾ã§ã®é•·ã„é“ã®ã‚Šã‚’ã€ãã£ã¨è‹¦ã—ã¿ãªãŒã‚‰å…±ã«æ­©ã‚“ã§ä¸‹ã•ã‚Šã€æ·±ãæ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>------------------------------</span>
 &nbsp;</p>
<p>&nbsp;<span>ã€Œç­†è€…ã®ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã€</span>
 &nbsp;</p>
<p>&nbsp;<span>è‡ªåˆ†ã®é•·ã„äººç”Ÿã®ä¸­ã§ã¯ã€æ€ã„å‡ºã—ãŸããªã„äº‹æŸ„ã‚‚ãŸãã•ã‚“ã‚ã‚Šã¾ã—ãŸã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>å°ã•ãã¦ã‚‚è‡ªåˆ†ã«ã¨ã£ã¦æ„Ÿå‹•çš„ã§ã‚ã£ãŸäº‹ã ã‘ã‚’å¿ƒã«æŠ±ãã€æ¬¡ã®å±±ã‚’æ¥µã‚ã¾ã™ï¼</span>
 &nbsp;</p>
<p>&nbsp;<span>ã€ä¸€ç”Ÿã‚’è³­ã—ã¦ã‚„ã‚Œã°ã€é‚ã’ã‚‰ã‚Œã¬ã“ã¨ã¯ã‚ã‚‹ã¾ã„ã€ã¨ã„ã†è±Šç”°ä½å‰ã®è¨€è‘‰ã‚’åº§å³ã«ã—ã¦...</span>
 &nbsp;</p>
<p>&nbsp;<span>&nbsp;</span>
 &nbsp;</p>
<p>&nbsp;<span>ä»Šå¾Œã¾ã™ã¾ã™ã®ã”æˆåŠŸã¨ã”å¥åº·ã‚’ãŠç¥ˆã‚Šç”³ã—ä¸Šã’ã¾ã™ã€‚</span>
 &nbsp;</p>
<p>&nbsp;<span>æœ‰é›£ã†ã”ã–ã„ã¾ã—ãŸã€‚</span>
</p>
</div>
</div>


<script>function myFunction(){document.getElementById("tateyoko").classList.toggle("tateread")}</script></body></html>