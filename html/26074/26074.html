<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Photoshop自動化基本編 (Adobe JavaScriptシリーズ（NextPublishing）)</title>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/css/mainday.css" title="default">
<link rel="alternate stylesheet" href="/css/mainnight.css" title="alternate">
<script type="text/javascript" src="/js/styleswitcher.js"></script>
<script type="text/javascript" src="/js/global.js"></script>
</head>
<body>
<div class="novelpage">
<div class="novelbody">
<div id="tateyoko">
<div id="_top"></div>
<a href="/">🏠</a>&emsp;
<a href="#" onclick="setActiveStyleSheet('default'); return false;">日</a>&emsp;
<a href="#" onclick="setActiveStyleSheet('alternate'); return false;">月</a>&emsp;
<a href="#_top" onclick="myFunction()" style="cursor: pointer;">縦書き／横書き</a>
<div id="calibre_link-439">
<div>
<div>
<table class="noveltitle">
<tr>
<td colspan="2"><i><span><i>Photoshop自動化基本編 (Adobe JavaScriptシリーズ（NextPublishing）)</i></span></i></td>
</tr>
<tr>
                    
                    
      </tr>
<tr>
<td colspan="2">古籏 一浩</td>
</tr>
<tr>
<td colspan="2"> (2015)</td>
</tr>
<tr>
<td colspan="2"></td>
</tr>
</table>
<div></div>
</div>
<div>
<p>Photoshopを自動化しよう</p>
</div>
</div>
</div>



<div id="calibre_link-460">
<section>
<div>
<h1 id="calibre_link-56"><b>はじめに</b></h1>
</div>
<p>　本書はAdobe Photoshopを制御する際に必要となる基本的な自動化のプログラムを逆引きの形で掲載しています。</p>
<p>　Photoshopのアクションは強力でバージョンCC以降であれば標準で条件分岐もできるようになっています。まず、自動化するのであればPhotoshopのアクションとバッチ処理で行うのが妥当です。JavaScriptを使用する場面は、より複雑な条件判断を求められる処理になるでしょう。</p>
<p>　PhotoshopにはアクションをJavaScriptのプログラムとして生成することができるScripting Listenerプラグインがあります。このプラグインを利用することで、1からプログラムを作成しなくても必要な部分だけ作成すれば目的の処理を実現することができます。PhotoshopのJavaScriptに用意されている標準機能だけではPhotoshopのすべての機能を利用できません。このため、どうしてもScripting Listenerによる自動生成されたプログラムが必要になります。本書に掲載しているプログラムのいくつかにも自動生成された内容が使われています。</p>
<p>　Photoshopを制御するプログラム言語としてはAppleScript、VBScript、JavaScriptがあります。AppleScriptはMac OS X/OS Xのみで動作、VBScriptはWindowsのみで動作、JavaScriptはMac OS X/OS XとWindowsの両方で動作します。本書ではMacでもWindowsでも動作させることができるJavaScriptを使っています。また、実行結果の画面はMacになっていますが、Windowsでも動作は変わりません。</p>
<p>　Photoshopのスクリプト開発に必要なツールであるESTKやJavaScriptの基本的な文法やプログラムの考え方（アルゴリズム）については解説していません。Adobeアプリケーションで共通して使える機能に関しても一部を除いて掲載していません。これらについて知りたい方は以下の書籍を参照してください。</p>
<p>
<br />
</p>
<p>・ExtendScript Toolkit（ESTK）基本編</p>
<p>ISBN：9784844396130</p>
<p>
<br />
</p>
<p>・Adobe JavaScriptリファレンス</p>
<p>ISBN：9784844395959</p>
<p>
<br />
</p>
<p>　基本編のためPhotoshop CS以降で使用できるGUIおよびCC 2014で使用できるCEP（Common Extensibility Platform・共通拡張プラットフォーム）やGeneratorおよびInDesignやIllustrator、Bridgeなど他アプリケーションとの連携については解説していません。なお、Illustratorの場合は基本編の書籍がありますので参考にしてみてください。</p>
<p>
<br />
</p>
<p>・Illustrator自動化基本編</p>
<p>ISBN：9784844396499</p>
<p>
<br />
</p>
<p>　本書がPhotoshopで自動化しようと考えている方々の役に立てば幸いです。</p>
<p>
<br />
</p>
<p>2015年4月　古籏一浩</p>
</section>
</div>
<div id="calibre_link-616">
<section>
<h2 id="calibre_link-57"><b>注意事項と免責事項</b></h2>
<p>　サンプルを実行した結果生じるトラブルに関しては一切の責任を負いません。MacではMac OS X(10.6.8)/OS X (10.8.5/10.10.1)のPhotoshop CS6、CC、CC 2014、WindowsではWindows 7上のPhotoshop CS6、CC 2014をベースにしています。このため、これ以外でのOS XのバージョンおよびWindows 8.1以降での動作保証は行っていません。また、Photoshop CC以降に関してはアップデートにより動作が変わってしまう可能性もあります。アップデートによる動作の不具合に関しては対処しかねるので、あらかじめご了解ください。</p>
<p>　Photoshopには非常に多くのオブジェクトと機能がありますが、それらすべてについて逆引きの形式で掲載しているわけではありません。代表的な機能に関してのみ掲載しています。より詳しい機能についてはAdobe社が提供しているWeb上にあるPhotoshopのJavaScriptリファレンス（英語）などを参照してください。リファレンスの基本的な読み方について「第1章　イントロダクション」にて説明しています。</p>
<p>　本書で使用しているプログラム（【sample】と記載のあるもの）を、以下のページからサンプルとしてダウンロードすることができます。</p>
<p>
<br />
</p>
<p>
<a href="http://www.openspc2.org/download/PS/">http://www.openspc2.org/download/PS/</a>
</p>
<p>
<br />
</p>
<p>　サンプルの場所は、本書の章番号および節番号に対応しています。</p>
<p>　例えば、第2章の第3節、「2-3　スクリプトエンジンのバージョンを求める」のサンプルは、「chapter02」フォルダ内の「0003」フォルダに「sample.jsx」として用意しています。</p>
<p>　1つの節で複数のサンプルを使用している場合は、対応するフォルダ内に個別のファイル名で格納しています。それぞれのファイル名は、本書内の該当する箇所に記載しています。</p>
<p>　なお、このダウンロードサービスはあくまで読者サービスの一環として実施するもので、利用期間を保証できません。</p>
</section>
</div>
<div id="calibre_link-479">
<section>
<div>
<h1 id="calibre_link-58"><b>電子書籍閲覧に関するご注意</b></h1>
</div>
<p>　本書では、プログラムリストに専用の等幅フォントを使用しています。ビューアによって以下の作業が必要になります。</p>
<p>・Kindle Paperwhiteの場合：フォント設定画面で「出版者のフォント」を選択</p>
<p>・kobo Androidアプリの場合：フォント画面で「オリジナル」を選択</p>
</section>
</div>
<div id="calibre_link-55">
<h1 id="calibre_link-712"><b>目次</b></h1><ol><li value="1"><a href="#calibre_link-56">はじめに</a><ol><li value="1"><a href="#calibre_link-57">注意事項と免責事項</a></li></ol></li><li value="2"><a href="#calibre_link-58">電子書籍閲覧に関するご注意</a></li><li value="3"><a href="#calibre_link-59">第1章　イントロダクション</a><ol><li value="1"><a href="#calibre_link-60">1-1　本書掲載プログラムについての注意事項</a></li><li value="2"><a href="#calibre_link-61">1-2　プログラム（JavaScript）を実行するには</a></li><li value="3"><a href="#calibre_link-62">1-3　プログラムが動かない場合の対処方法</a></li><li value="4"><a href="#calibre_link-63">1-4　自動的にスクリプトを生成するScripting Listenerについて</a></li><li value="5"><a href="#calibre_link-64">1-5　より手軽に自動化するにはどうしたらよいか</a></li><li value="6"><a href="#calibre_link-65">1-6　JavaScriptをプラグインのように機能させる</a></li><li value="7"><a href="#calibre_link-66">1-7　Photoshopリファレンスおよびスクリプティングガイドについて</a></li><li value="8"><a href="#calibre_link-67">1-8　プログラムを修正して目的の処理を行うには</a></li></ol></li><li value="4"><a href="#calibre_link-68">第2章　アプリケーション</a><ol><li value="1"><a href="#calibre_link-69">2-1　アプリケーション名を求める</a></li><li value="2"><a href="#calibre_link-70">2-2　バージョンを求める／指定バージョン以上でしか動作しないようにする</a></li><li value="3"><a href="#calibre_link-71">2-3　スクリプトエンジンのバージョンを求める</a></li><li value="4"><a href="#calibre_link-72">2-4　ビープ音（警告音）を鳴らす</a></li><li value="5"><a href="#calibre_link-73">2-5　Photoshopを終了させる</a></li><li value="6"><a href="#calibre_link-74">2-6　空きメモリを求める／メモリを解放する</a></li><li value="7"><a href="#calibre_link-75">2-7　QuickTimeが有効かどうか調べる</a></li><li value="8"><a href="#calibre_link-76">2-8　実行中の環境の言語を調べる</a></li><li value="9"><a href="#calibre_link-77">2-9　カラー設定を取得する</a></li><li value="10"><a href="#calibre_link-78">2-10　実行されているスクリプトのファイル名を求める</a></li><li value="11"><a href="#calibre_link-79">2-11　ダイアログモードを指定する</a></li><li value="12"><a href="#calibre_link-80">2-12　単位を読み出す／変更する</a></li></ol></li><li value="5"><a href="#calibre_link-81">第3章　ドキュメント</a><ol><li value="1"><a href="#calibre_link-82">3-1　新規にドキュメントを作成する</a></li><li value="2"><a href="#calibre_link-83">3-2　ドキュメント数を求める</a></li><li value="3"><a href="#calibre_link-84">3-3　ドキュメント名を求める</a></li><li value="4"><a href="#calibre_link-85">3-4　ドキュメントのパスを求める</a></li><li value="5"><a href="#calibre_link-86">3-5　ドキュメントの横幅と縦幅を求める</a></li><li value="6"><a href="#calibre_link-87">3-6　ドキュメントのカラーモードを求める</a></li><li value="7"><a href="#calibre_link-88">3-7　ドキュメントの色深度を求める</a></li><li value="8"><a href="#calibre_link-89">3-8　ドキュメントのカラープロファイル名を求める</a></li><li value="9"><a href="#calibre_link-90">3-9　ドキュメントが保存済みかどうか調べる</a></li><li value="10"><a href="#calibre_link-91">3-10　ピクセルの縦横比を求める／設定する</a></li><li value="11"><a href="#calibre_link-92">3-11　クイックマスクモードかどうか調べる</a></li><li value="12"><a href="#calibre_link-93">3-12　ドキュメント情報を求める</a></li><li value="13"><a href="#calibre_link-94">3-13　ドキュメントを閉じる</a></li><li value="14"><a href="#calibre_link-95">3-14　ドキュメントを保存する</a></li><li value="15"><a href="#calibre_link-96">3-15　ドキュメントを別名で保存する</a></li><li value="16"><a href="#calibre_link-97">3-16　1枚だけ印刷する</a></li><li value="17"><a href="#calibre_link-98">3-17　印刷する／印刷設定を行う</a></li><li value="18"><a href="#calibre_link-99">3-18　取り消し（アンドゥ）／再実行（リドゥ）処理を行う</a></li><li value="19"><a href="#calibre_link-100">3-19　すでに開かれているドキュメント全体に対して処理を行う</a></li></ol></li><li value="6"><a href="#calibre_link-101">第4章　画像／イメージ</a><ol><li value="1"><a href="#calibre_link-102">4-1　画像のサイズや解像度を変更する</a></li><li value="2"><a href="#calibre_link-103">4-2　カンバスサイズを変更する</a></li><li value="3"><a href="#calibre_link-104">4-3　画像をトリミングする</a></li><li value="4"><a href="#calibre_link-105">4-4　全ての領域を表示する</a></li><li value="5"><a href="#calibre_link-106">4-5　画像を統合（フラット化）する</a></li><li value="6"><a href="#calibre_link-107">4-6　画像をペースト（貼り付け）する</a></li><li value="7"><a href="#calibre_link-108">4-7　画像を回転させる</a></li><li value="8"><a href="#calibre_link-109">4-8　画像を左右変転・上下反転させる</a></li><li value="9"><a href="#calibre_link-110">4-9　画像を切り抜く</a></li><li value="10"><a href="#calibre_link-111">4-10　画像を複製する</a></li><li value="11"><a href="#calibre_link-112">4-11　チャンネルを分割する</a></li><li value="12"><a href="#calibre_link-113">4-12　トラッピングを設定する</a></li><li value="13"><a href="#calibre_link-114">4-13　レイヤーをラスタライズする</a></li><li value="14"><a href="#calibre_link-115">4-14　指定した位置と色で１ピクセル描画する</a></li><li value="15"><a href="#calibre_link-116">4-15　連番を振った画像を生成する</a></li><li value="16"><a href="#calibre_link-117">4-16　Macでキャプチャーしたスクリーンショットの透明部分を削除する</a></li><li value="17"><a href="#calibre_link-118">4-17　複数の画像を読み込み加算平均コンポジットを行う</a></li><li value="18"><a href="#calibre_link-119">4-18　画像の縦横比を考慮してリサイズする</a></li><li value="19"><a href="#calibre_link-120">4-19　画像の縦横の大きい方にカンバスサイズを合わせる</a></li></ol></li><li value="7"><a href="#calibre_link-121">第5章　レイヤー</a><ol><li value="1"><a href="#calibre_link-122">5-1　レイヤーの総数を求める</a></li><li value="2"><a href="#calibre_link-123">5-2　レイヤーの種類を調べる</a></li><li value="3"><a href="#calibre_link-124">5-3　アクティブ（選択されている）レイヤーを調べる</a></li><li value="4"><a href="#calibre_link-125">5-4　選択されている複数のレイヤーを取得する</a></li><li value="5"><a href="#calibre_link-126">5-5　アクティブにするレイヤーを指定する</a></li><li value="6"><a href="#calibre_link-127">5-6　複数のレイヤー／レイヤーセットを選択する</a></li><li value="7"><a href="#calibre_link-128">5-7　レイヤー名を取得する</a></li><li value="8"><a href="#calibre_link-129">5-8　レイヤー名を変更する</a></li><li value="9"><a href="#calibre_link-130">5-9　レイヤーを追加する／新規にレイヤーを作成する</a></li><li value="10"><a href="#calibre_link-131">5-10　新規にサブレイヤーを追加する</a></li><li value="11"><a href="#calibre_link-132">5-11　調整レイヤーを追加する</a></li><li value="12"><a href="#calibre_link-133">5-12　レイヤーを複製する</a></li><li value="13"><a href="#calibre_link-134">5-13　レイヤーが背景かどうか調べる</a></li><li value="14"><a href="#calibre_link-135">5-14　レイヤーを背景にする</a></li><li value="15"><a href="#calibre_link-136">5-15　背景をレイヤーに変換する</a></li><li value="16"><a href="#calibre_link-137">5-16　レイヤーを表示／非表示にする</a></li><li value="17"><a href="#calibre_link-138">5-17　特定の種類のレイヤーだけ非表示にする</a></li><li value="18"><a href="#calibre_link-139">5-18　レイヤーを移動する</a></li><li value="19"><a href="#calibre_link-140">5-19　レイヤーを削除する</a></li><li value="20"><a href="#calibre_link-141">5-20　テキストレイヤーだけ削除する</a></li><li value="21"><a href="#calibre_link-142">5-21　レイヤーが空っぽかどうか調べる</a></li><li value="22"><a href="#calibre_link-143">5-22　空っぽのレイヤーを削除する</a></li><li value="23"><a href="#calibre_link-144">5-23　レイヤーの画像を消去する</a></li><li value="24"><a href="#calibre_link-145">5-24　レイヤーの画像をカットする</a></li><li value="25"><a href="#calibre_link-146">5-25　レイヤーの画像をコピーする</a></li><li value="26"><a href="#calibre_link-147">5-26　レイヤーに画像をペーストする</a></li><li value="27"><a href="#calibre_link-148">5-27　レイヤーの画像の位置を変更する</a></li><li value="28"><a href="#calibre_link-149">5-28　レイヤーの画像を指定した座標に移動する</a></li><li value="29"><a href="#calibre_link-150">5-29　レイヤーの画像のサイズを変更する（リサイズ）</a></li><li value="30"><a href="#calibre_link-151">5-30　レイヤーの画像を回転させる</a></li><li value="31"><a href="#calibre_link-152">5-31　レイヤーが移動しないようにロックする／解除する（位置ロック）</a></li><li value="32"><a href="#calibre_link-153">5-32　レイヤーをロックする／ロックを解除する</a></li><li value="33"><a href="#calibre_link-154">5-33　レイヤーのピクセルをロックする／解除する</a></li><li value="34"><a href="#calibre_link-155">5-34　レイヤーの透明ピクセルをロックする／解除する</a></li><li value="35"><a href="#calibre_link-156">5-35　レイヤーの矩形サイズを取得する</a></li><li value="36"><a href="#calibre_link-157">5-36　レイヤーの合成モードを変更する</a></li><li value="37"><a href="#calibre_link-158">5-37　レイヤーがクリッピングされているかどうか調べる</a></li><li value="38"><a href="#calibre_link-159">5-38　レイヤー全体の不透明度を変更する</a></li><li value="39"><a href="#calibre_link-160">5-39　レイヤーの塗りの不透明度を変更する</a></li><li value="40"><a href="#calibre_link-161">5-40　レイヤーマスクの不透明度を指定する</a></li><li value="41"><a href="#calibre_link-162">5-41　レイヤーマスクのぼかし幅を指定する</a></li><li value="42"><a href="#calibre_link-163">5-42　レイヤーをリンクする</a></li><li value="43"><a href="#calibre_link-164">5-43　レイヤーのリンクを解除する</a></li><li value="44"><a href="#calibre_link-165">5-44　レイヤーのリンク先を調べる</a></li><li value="45"><a href="#calibre_link-166">5-45　レイヤーをラスタライズする</a></li><li value="46"><a href="#calibre_link-167">5-46　表示されているレイヤーを結合する</a></li><li value="47"><a href="#calibre_link-168">5-47　全てのレイヤーを統合する</a></li><li value="48"><a href="#calibre_link-169">5-48　指定した名前のレイヤーが複数ある場合に配列として返す</a></li><li value="49"><a href="#calibre_link-170">5-49　テキストの内容にテキストレイヤーの名前をあわせる</a></li><li value="50"><a href="#calibre_link-171">5-50　全てのレイヤー名をファイルに書き出す（レイヤーセットは含まない）</a></li><li value="51"><a href="#calibre_link-172">5-51　全てのレイヤーセットとレイヤー名をファイルに書き出す</a></li><li value="52"><a href="#calibre_link-173">5-52　全てのレイヤーセットとレイヤーの階層を保持したままファイルに書き出す</a></li><li value="53"><a href="#calibre_link-174">5-53　全てのレイヤーの不透明度や矩形サイズをファイルに書き出す</a></li><li value="54"><a href="#calibre_link-175">5-54　レイヤーのラベルカラーを設定する</a></li></ol></li><li value="8"><a href="#calibre_link-176">第6章　レイヤーセット</a><ol><li value="1"><a href="#calibre_link-177">6-1　レイヤーセットの総数を求める</a></li><li value="2"><a href="#calibre_link-178">6-2　レイヤーセット内にあるレイヤーの数を求める</a></li><li value="3"><a href="#calibre_link-179">6-3　該当する名前のレイヤーセットがあるか調べる</a></li><li value="4"><a href="#calibre_link-180">6-4　レイヤーセットを追加する</a></li><li value="5"><a href="#calibre_link-181">6-5　レイヤーセットを複製する</a></li><li value="6"><a href="#calibre_link-182">6-6　レイヤーセットを削除する</a></li><li value="7"><a href="#calibre_link-183">6-7　レイヤーセットを全て削除する</a></li><li value="8"><a href="#calibre_link-184">6-8　レイヤーセットが第一階層かどうか調べる</a></li><li value="9"><a href="#calibre_link-185">6-9　レイヤーセットを統合する（マージ）</a></li><li value="10"><a href="#calibre_link-186">6-10　レイヤーセットを移動する</a></li><li value="11"><a href="#calibre_link-187">6-11　レイヤーセット全体の不透明度を変更する</a></li><li value="12"><a href="#calibre_link-188">6-12　レイヤーセットを表示／非表示にする</a></li><li value="13"><a href="#calibre_link-189">6-13　レイヤーセットをロックする／ロックを解除する</a></li><li value="14"><a href="#calibre_link-190">6-14　レイヤーセット全体の合成モードを変更する</a></li><li value="15"><a href="#calibre_link-191">6-15　レイヤーセットをリンクする</a></li><li value="16"><a href="#calibre_link-192">6-16　レイヤーセットのリンク先を調べる</a></li><li value="17"><a href="#calibre_link-193">6-17　レイヤーセットのリンクを解除する</a></li><li value="18"><a href="#calibre_link-194">6-18　レイヤーセット内の画像の位置を変更する</a></li><li value="19"><a href="#calibre_link-195">6-19　レイヤーセット内の画像のサイズを変更する（リサイズ）</a></li><li value="20"><a href="#calibre_link-196">6-20　レイヤーセット内の画像を回転させる</a></li><li value="21"><a href="#calibre_link-197">6-21　レイヤーセットの矩形サイズを取得する</a></li><li value="22"><a href="#calibre_link-198">6-22　アクティブにするレイヤーセットを指定する</a></li></ol></li><li value="9"><a href="#calibre_link-199">第7章　標準エフェクト/フィルター</a><ol><li value="1"><a href="#calibre_link-200">7-1　コントラストを自動調整する</a></li><li value="2"><a href="#calibre_link-201">7-2　明るさとコントラストを調整する</a></li><li value="3"><a href="#calibre_link-202">7-3　画像の色調を変える（レンズフィルター）</a></li><li value="4"><a href="#calibre_link-203">7-4　カラーバランスを調整する</a></li><li value="5"><a href="#calibre_link-204">7-5　自動トーン補正を行う</a></li><li value="6"><a href="#calibre_link-205">7-6　画像をトーンカーブで調整する</a></li><li value="7"><a href="#calibre_link-206">7-7　彩度を下げる</a></li><li value="8"><a href="#calibre_link-207">7-8　階調（色）を反転させる</a></li><li value="9"><a href="#calibre_link-208">7-9　ポスタリゼーション（階調の段階を設定）</a></li><li value="10"><a href="#calibre_link-209">7-10　白黒画像にする（2階調化）</a></li><li value="11"><a href="#calibre_link-210">7-11　平均にする</a></li><li value="12"><a href="#calibre_link-211">7-12　平均化する（イコライズ）</a></li><li value="13"><a href="#calibre_link-212">7-13　画像のレベル補正を行う</a></li><li value="14"><a href="#calibre_link-213">7-14　画像の明るい部分を拡大する（明るさの最大値）</a></li><li value="15"><a href="#calibre_link-214">7-15　画像の暗い部分を拡大する（明るさの最小値）</a></li><li value="16"><a href="#calibre_link-215">7-16　ノイズを加える</a></li><li value="17"><a href="#calibre_link-216">7-17　ノイズを軽減する（明るさの中間値）</a></li><li value="18"><a href="#calibre_link-217">7-18　ダスト＆スクラッチ</a></li><li value="19"><a href="#calibre_link-218">7-19　画像をぼかす</a></li><li value="20"><a href="#calibre_link-219">7-20　画像を強くぼかす</a></li><li value="21"><a href="#calibre_link-220">7-21　画像をぼかす（ガウス）</a></li><li value="22"><a href="#calibre_link-221">7-22　画像をぼかす（レンズ）</a></li><li value="23"><a href="#calibre_link-222">7-23　画像をぼかす（移動／モーションブラー）</a></li><li value="24"><a href="#calibre_link-223">7-24　画像をぼかす（詳細）</a></li><li value="25"><a href="#calibre_link-224">7-25　画像をぼかす（放射状）</a></li><li value="26"><a href="#calibre_link-225">7-26　輪郭以外をぼかす</a></li><li value="27"><a href="#calibre_link-226">7-27　アンシャープマスク</a></li><li value="28"><a href="#calibre_link-227">7-28　画像を鮮明（シャープ）にする</a></li><li value="29"><a href="#calibre_link-228">7-29　画像を強力に鮮明（シャープ）にする</a></li><li value="30"><a href="#calibre_link-229">7-30　画像の輪郭を鮮明（シャープ）にする</a></li><li value="31"><a href="#calibre_link-230">7-31　画像をスクロールさせる</a></li><li value="32"><a href="#calibre_link-231">7-32　画像をつまむ</a></li><li value="33"><a href="#calibre_link-232">7-33　球面にする</a></li><li value="34"><a href="#calibre_link-233">7-34　画像を傾斜させる（シアー）</a></li><li value="35"><a href="#calibre_link-234">7-35　画像をジグザグ（波面）にする</a></li><li value="36"><a href="#calibre_link-235">7-36　画像を波紋のようにする</a></li><li value="37"><a href="#calibre_link-236">7-37　海の波紋</a></li><li value="38"><a href="#calibre_link-237">7-38　波形にする</a></li><li value="39"><a href="#calibre_link-238">7-39　渦巻き状にする</a></li><li value="40"><a href="#calibre_link-239">7-40　置き換え（ディスプレイスメントマップ）</a></li><li value="41"><a href="#calibre_link-240">7-41　ガラス効果</a></li><li value="42"><a href="#calibre_link-241">7-42　極座標／直交座標を変換する</a></li><li value="43"><a href="#calibre_link-242">7-43　NTSCカラーにする</a></li><li value="44"><a href="#calibre_link-243">7-44　インターレースを解除する</a></li><li value="45"><a href="#calibre_link-244">7-45　逆光効果を適用する</a></li><li value="46"><a href="#calibre_link-245">7-46　光彩拡散を加える</a></li><li value="47"><a href="#calibre_link-246">7-47　ハイパスを適用する</a></li><li value="48"><a href="#calibre_link-247">7-48　雲模様1を描く</a></li><li value="49"><a href="#calibre_link-248">7-49　雲模様2を描く</a></li><li value="50"><a href="#calibre_link-249">7-50　カスタムフィルターを設定する</a></li></ol></li><li value="10"><a href="#calibre_link-250">第8章　チャンネル</a><ol><li value="1"><a href="#calibre_link-251">8-1　チャンネル数を求める</a></li><li value="2"><a href="#calibre_link-252">8-2　チャンネルを追加する</a></li><li value="3"><a href="#calibre_link-253">8-3　チャンネルを複製する</a></li><li value="4"><a href="#calibre_link-254">8-4　スポットカラーチャンネルをマージ（統合）する</a></li><li value="5"><a href="#calibre_link-255">8-5　チャンネルを削除する</a></li></ol></li><li value="11"><a href="#calibre_link-256">第9章　カラー／カラーサンプル／カラーモード変換</a><ol><li value="1"><a href="#calibre_link-257">9-1　RGBカラーで指定する</a></li><li value="2"><a href="#calibre_link-258">9-2　CMYKカラーで指定する</a></li><li value="3"><a href="#calibre_link-259">9-3　HSBカラーで指定する</a></li><li value="4"><a href="#calibre_link-260">9-4　グレースケールで指定する</a></li><li value="5"><a href="#calibre_link-261">9-5　Labカラーで指定する</a></li><li value="6"><a href="#calibre_link-262">9-6　カラーを相互変換する</a></li><li value="7"><a href="#calibre_link-263">9-7　カラーピッカーを表示する</a></li><li value="8"><a href="#calibre_link-264">9-8　カラーサンプルの総数を求める</a></li><li value="9"><a href="#calibre_link-265">9-9　カラーサンプルを追加する</a></li><li value="10"><a href="#calibre_link-266">9-10　カラーサンプルの座標値を変更する</a></li><li value="11"><a href="#calibre_link-267">9-11　カラーサンプルのカラーを取得する</a></li><li value="12"><a href="#calibre_link-268">9-12　カラーサンプルを削除する</a></li><li value="13"><a href="#calibre_link-269">9-13　カラーサンプルを全て削除する</a></li><li value="14"><a href="#calibre_link-270">9-14　ドキュメントのカラーモードを変更する</a></li><li value="15"><a href="#calibre_link-271">9-15　インデックスカラーモードにする</a></li><li value="16"><a href="#calibre_link-272">9-16　白黒画像に変換する</a></li><li value="17"><a href="#calibre_link-273">9-17　カラープロファイルを変換する</a></li></ol></li><li value="12"><a href="#calibre_link-274">第10章　選択</a><ol><li value="1"><a href="#calibre_link-275">10-1　選択範囲を解除する</a></li><li value="2"><a href="#calibre_link-276">10-2　全てを選択する</a></li><li value="3"><a href="#calibre_link-277">10-3　選択範囲を反転させる</a></li><li value="4"><a href="#calibre_link-278">10-4　座標を指定して選択範囲にする</a></li><li value="5"><a href="#calibre_link-279">10-5　選択範囲をパスに変換する</a></li><li value="6"><a href="#calibre_link-280">10-6　選択範囲をαチャンネルに保存する</a></li><li value="7"><a href="#calibre_link-281">10-7　αチャンネルを選択範囲にする</a></li><li value="8"><a href="#calibre_link-282">10-8　境界線を選択する</a></li><li value="9"><a href="#calibre_link-283">10-9　近似色を選択する</a></li><li value="10"><a href="#calibre_link-284">10-10　選択範囲のサイズを取得する</a></li><li value="11"><a href="#calibre_link-285">10-11　選択範囲のサイズを変更する（リサイズ）</a></li><li value="12"><a href="#calibre_link-286">10-12　選択範囲を変更（拡張）する</a></li><li value="13"><a href="#calibre_link-287">10-13　選択範囲を変更（縮小）する</a></li><li value="14"><a href="#calibre_link-288">10-14　選択範囲を移動させる</a></li><li value="15"><a href="#calibre_link-289">10-15　選択範囲を拡張する</a></li><li value="16"><a href="#calibre_link-290">10-16　選択範囲を滑らかにする</a></li><li value="17"><a href="#calibre_link-291">10-17　選択範囲のぼかし幅を指定する</a></li><li value="18"><a href="#calibre_link-292">10-18　選択範囲の境界線を描画する</a></li><li value="19"><a href="#calibre_link-293">10-19　選択範囲を塗り潰す</a></li><li value="20"><a href="#calibre_link-294">10-20　選択範囲を消去する</a></li><li value="21"><a href="#calibre_link-295">10-21　選択範囲をカットする</a></li><li value="22"><a href="#calibre_link-296">10-22　選択範囲をコピーする</a></li><li value="23"><a href="#calibre_link-297">10-23　選択範囲内の画像を移動させる</a></li><li value="24"><a href="#calibre_link-298">10-24　選択範囲内の画像のスケールを変更する（リサイズ）</a></li><li value="25"><a href="#calibre_link-299">10-25　選択範囲内の画像を回転させる</a></li><li value="26"><a href="#calibre_link-300">10-26　選択範囲があるかどうか調べる</a></li><li value="27"><a href="#calibre_link-301">10-27　選択範囲が矩形かどうか調べる</a></li></ol></li><li value="13"><a href="#calibre_link-302">第11章　パス</a></li><li value="14"><a href="#calibre_link-303">11-1　パスの総数を求める</a><ol><li value="1"><a href="#calibre_link-304">11-2　新規にパスを作成する</a></li><li value="2"><a href="#calibre_link-305">11-3　指定したパスを複製する</a></li><li value="3"><a href="#calibre_link-306">11-4　指定したパスをクリッピングパスにする</a></li><li value="4"><a href="#calibre_link-307">11-5　指定したパスを削除する</a></li><li value="5"><a href="#calibre_link-308">11-6　パスを全て削除する</a></li><li value="6"><a href="#calibre_link-309">11-7　指定したパスを選択する</a></li><li value="7"><a href="#calibre_link-310">11-8　指定したパスの選択を解除する</a></li><li value="8"><a href="#calibre_link-311">11-9　指定したパスを選択範囲にする</a></li><li value="9"><a href="#calibre_link-312">11-10　指定したパスを塗り潰す</a></li><li value="10"><a href="#calibre_link-313">11-11　指定したパスの境界線を描画する</a></li></ol></li><li value="15"><a href="#calibre_link-314">第12章　テキスト／文字／フォント</a><ol><li value="1"><a href="#calibre_link-315">12-1　インストールされているフォント数を取得する</a></li><li value="2"><a href="#calibre_link-316">12-2　フォント一覧を出力する</a></li><li value="3"><a href="#calibre_link-317">12-3　指定したレイヤーの文字を表示する</a></li><li value="4"><a href="#calibre_link-318">12-4　テキスト全体のフォントを変更する</a></li><li value="5"><a href="#calibre_link-319">12-5　アクティブレイヤーの文字を表示する</a></li><li value="6"><a href="#calibre_link-320">12-6　アクティブレイヤーの文字を変更する</a></li><li value="7"><a href="#calibre_link-321">12-7　テキストレイヤーの位置を表示する</a></li><li value="8"><a href="#calibre_link-322">12-8　テキストレイヤーの位置を変更する</a></li><li value="9"><a href="#calibre_link-323">12-9　テキスト全体の水平比率を変更する（長体・平体）</a></li><li value="10"><a href="#calibre_link-324">12-10　テキスト全体の文字カラーを変更する</a></li><li value="11"><a href="#calibre_link-325">12-11　テキスト全体の文字サイズを変更する</a></li><li value="12"><a href="#calibre_link-326">12-12　行揃えを指定する</a></li><li value="13"><a href="#calibre_link-327">12-13　段落テキストの横幅と縦幅を表示する</a></li><li value="14"><a href="#calibre_link-328">12-14　段落テキストの横幅と縦幅を変更する</a></li><li value="15"><a href="#calibre_link-329">12-15　段落テキストを縦書きにする</a></li><li value="16"><a href="#calibre_link-330">12-16　文字をパスに変換する</a></li><li value="17"><a href="#calibre_link-331">12-17　文字をシェイプに変換する</a></li><li value="18"><a href="#calibre_link-332">12-18　特定の文字列を含むレイヤーを配列として返す</a></li><li value="19"><a href="#calibre_link-333">12-19　選択されているテキストレイヤーに現在の日付を入れる</a></li></ol></li><li value="16"><a href="#calibre_link-334">第13章　ファイル保存</a><ol><li value="1"><a href="#calibre_link-335">13-1　BMP形式で保存する</a></li><li value="2"><a href="#calibre_link-336">13-2　EPS形式で保存する</a></li><li value="3"><a href="#calibre_link-337">13-3　GIF形式で保存する</a></li><li value="4"><a href="#calibre_link-338">13-4　JPEG形式で保存する</a></li><li value="5"><a href="#calibre_link-339">13-5　PDF形式で保存する</a></li><li value="6"><a href="#calibre_link-340">13-6　Photoshop形式で保存する</a></li><li value="7"><a href="#calibre_link-341">13-7　Pixer形式で保存する</a></li><li value="8"><a href="#calibre_link-342">13-8　PNG形式で保存する</a></li><li value="9"><a href="#calibre_link-343">13-9　RAW形式で保存する</a></li><li value="10"><a href="#calibre_link-344">13-10　Targa形式で保存する</a></li><li value="11"><a href="#calibre_link-345">13-11　TIFF形式で保存する</a></li></ol></li><li value="17"><a href="#calibre_link-346">第14章　ファイル処理</a><ol><li value="1"><a href="#calibre_link-347">14-1　ファイルを開く</a></li><li value="2"><a href="#calibre_link-348">14-2　PDFファイルを開く</a></li><li value="3"><a href="#calibre_link-349">14-3　EPSファイルを開く</a></li><li value="4"><a href="#calibre_link-350">14-4　RAW（汎用）形式のファイルを開く</a></li><li value="5"><a href="#calibre_link-351">14-5　カメラRAWファイルを開く</a></li><li value="6"><a href="#calibre_link-352">14-6　最近使用したファイルの数を求める</a></li><li value="7"><a href="#calibre_link-353">14-7　現在実行しているスクリプトのファイル名を求める</a></li><li value="8"><a href="#calibre_link-354">14-8　フォルダにある画像ファイルをまとめて開く</a></li><li value="9"><a href="#calibre_link-355">14-9　フォルダにある異なる形式の画像ファイルをまとめて開く</a></li><li value="10"><a href="#calibre_link-356">14-10　サブフォルダ内にある画像ファイルをまとめて開く</a></li></ol></li><li value="18"><a href="#calibre_link-357">第15章　ガイド</a><ol><li value="1"><a href="#calibre_link-358">15-1　ガイドの総数を求める</a></li><li value="2"><a href="#calibre_link-359">15-2　横方向と縦方向のガイド数を求める</a></li><li value="3"><a href="#calibre_link-360">15-3　ガイドの座標値を求める</a></li><li value="4"><a href="#calibre_link-361">15-4　ガイドを追加する</a></li><li value="5"><a href="#calibre_link-362">15-5　ガイドを削除する</a></li><li value="6"><a href="#calibre_link-363">15-6　ガイドを全て削除する</a></li></ol></li><li value="19"><a href="#calibre_link-364">第16章　ヒストリー</a><ol><li value="1"><a href="#calibre_link-365">16-1　ヒストリーの総数を求める</a></li><li value="2"><a href="#calibre_link-366">16-2　ヒストリー名を取得する</a></li><li value="3"><a href="#calibre_link-367">16-3　ヒストリーがスナップショットかどうか調べる</a></li><li value="4"><a href="#calibre_link-368">16-4　アクティブになっているヒストリー名を求める</a></li><li value="5"><a href="#calibre_link-369">16-5　スクリプトの処理をヒストリーに記録しないようにする</a></li><li value="6"><a href="#calibre_link-370">16-6　ヒストリーを全て消す</a></li><li value="7"><a href="#calibre_link-371">16-7　特定のヒストリーに戻す</a></li><li value="8"><a href="#calibre_link-372">16-8　ヒストリー項目を１つずつPhotoshop形式のファイルに書き出す</a></li></ol></li><li value="20"><a href="#calibre_link-373">第17章　レイヤーカンプ</a><ol><li value="1"><a href="#calibre_link-374">17-1　レイヤーカンプの総数を求める</a></li><li value="2"><a href="#calibre_link-375">17-2　レイヤーカンプの名前を取得する</a></li><li value="3"><a href="#calibre_link-376">17-3　レイヤーカンプを追加する</a></li><li value="4"><a href="#calibre_link-377">17-4　レイヤーカンプを削除する</a></li><li value="5"><a href="#calibre_link-378">17-5　レイヤーカンプを全て削除する</a></li><li value="6"><a href="#calibre_link-379">17-6　レイヤーカンプが選択されているか調べる</a></li><li value="7"><a href="#calibre_link-380">17-7　選択されているレイヤーカンプを取得する</a></li><li value="8"><a href="#calibre_link-381">17-8　選択されているレイヤーカンプのコメントに現在の日時を追加する</a></li></ol></li><li value="21"><a href="#calibre_link-382">第18章　計測</a><ol><li value="1"><a href="#calibre_link-383">18-1　計測スケールを設定する／取得する</a></li><li value="2"><a href="#calibre_link-384">18-2　計測結果を記録する</a></li><li value="3"><a href="#calibre_link-385">18-3　計測結果を保存する</a></li><li value="4"><a href="#calibre_link-386">18-4　計測結果を削除する</a></li></ol></li><li value="22"><a href="#calibre_link-387">第19章　カウント</a><ol><li value="1"><a href="#calibre_link-388">19-1　カウントの総数を求める</a></li><li value="2"><a href="#calibre_link-389">19-2　カウントを追加する</a></li><li value="3"><a href="#calibre_link-390">19-3　カウントを1つ削除する</a></li><li value="4"><a href="#calibre_link-391">19-4　カウントを全て削除する</a></li><li value="5"><a href="#calibre_link-392">19-5　カウントの座標を求める</a></li></ol></li><li value="23"><a href="#calibre_link-393">第20章　イベント処理</a><ol><li value="1"><a href="#calibre_link-394">20-1　イベント発生時の処理が有効になっているか調べる</a></li><li value="2"><a href="#calibre_link-395">20-2　イベント発生時に処理を追加する</a></li><li value="3"><a href="#calibre_link-396">20-3　全てのイベント処理を削除する</a></li></ol></li><li value="24"><a href="#calibre_link-397">第21章　アクション／バッチ</a><ol><li value="1"><a href="#calibre_link-398">21-1　アクションを実行する</a></li><li value="2"><a href="#calibre_link-399">21-2　バッチ処理を実行する</a></li><li value="3"><a href="#calibre_link-400">21-3　オプションを指定してバッチ処理を実行する</a></li><li value="4"><a href="#calibre_link-401">21-4　メニューを実行する</a></li></ol></li><li value="25"><a href="#calibre_link-402">第22章　映像／ビデオ</a><ol><li value="1"><a href="#calibre_link-403">22-1　ビデオファイル（映像ファイル）を読み込む</a></li><li value="2"><a href="#calibre_link-404">22-2　タイムラインの時間インジケーターを指定した秒数に移動する</a></li></ol></li><li value="26"><a href="#calibre_link-405">著者紹介</a></li></ol>
</div>
<div id="calibre_link-536">
<section>
<div>
<h1 id="calibre_link-59"><b>第1章　イントロダクション</b></h1>
</div>
</section>
</div>
<div id="calibre_link-662">
<section>
<h2 id="calibre_link-60"><b>1-1　本書掲載プログラムについての注意事項</b></h2>
<p>　本書に掲載されているプログラム（スクリプト）は個人使用、商用利用とも自由に使用することができます。掲載しているプログラムを改変して配布しても問題ありません。無償、有償問わずAdobe Exchangeで配布する際のプログラムに組み込んで使用しても構いません。ただし、本書に掲載されているプログラムを利用した際に発生する不具合などに関しては責任を負わないものとします。</p>
<p>　本書ではCS6以降のバージョンをベースにしたプログラムを掲載／解説していますが、掲載しているプログラムの多くはPhotoshop CS3～CS5でも動作させることができます。プログラムはカラーモードや解像度、選択されているレイヤーなどによって動作が異なることがあります。ほとんどのプログラムはRGB8ビットのカラーモードで解像度72dpiを前提としています。カラーモードや選択されているレイヤーが異なるとエラーが発生することがあります。</p>
<p>　PhotoshopではJavaScript、AppleScript、VBScriptによって制御することができますが、本書で扱っているのはJavaScriptのみです。自動化処理においては、JavaScriptのみでの対応が難しいことがあり、AppleScriptやVBScriptおよびシェルスクリプトやOSの機能が必要になる場合があります。本書では基本編ということでJavaScriptと他のスクリプトやOSの機能に関してのサンプルおよび解説はありません。</p>
<p>　Photoshop CS以降ではAdobeアプリケーションで利用できる共通のGUIがあります。また、Photoshop CC以降ではCEP（Common Extensibility Platform）によりHTML5を利用した高度なGUIと連携させることができます。本書ではCEPに限らずGUIに関しては解説していません。CEP5に関しては以下のページに日本語での解説がありますので参照してみてください。</p>
<p>
<a href="http://aphall.com/2014/08/cep-mega-guide/">http://aphall.com/2014/08/cep-mega-guide/</a>
</p>
</section>
</div>
<div id="calibre_link-643">
<section>
<h2 id="calibre_link-61"><b>1-2　プログラム（JavaScript）を実行するには</b></h2>
<p>　Photoshopで動作するプログラムであるJavaScriptを実行する方法はいくつかあります。代表的な方法としては2つあります。いずれもWindows、Macとも同じメニュー項目、同じ階層のフォルダとフォルダ名です。</p>
<p>　まず、Photoshopのメニューから実行する方法です。バージョンに関わらず「ファイル」メニューから「スクリプト」を選択すると実行できるスクリプトの一覧が表示されます。表示されるメニュー項目のスクリプトはPhotoshopのアプリケーションがあるフォルダの中にある「Presets」/「Scripts」フォルダにプログラムが書かれている.jsxファイルを入れておきます。頻繁に使うプログラムは、このようにスクリプトフォルダに入れておくとよいでしょう。</p>
<p>　ときどき使うスクリプトの場合や、一度しか実行しないような場合は「ファイル」メニューから「スクリプト」を選択し表示される「その他のスクリプト...」の項目を選択します。選択すると実行するプログラムを選択するダイアログが表示されます。プログラムを選択すると実行されます。</p>
<figure>
<figcaption>【図】Photoshop CC 2014 (Windows)の場合</figcaption>
<img src="images/00614.jpeg" />
</figure>
<figure>
<figcaption>【図】Photoshop CC 2014 (Mac)の場合</figcaption>
<img src="images/00234.jpeg" />
</figure>
<p>　もう1つの実行する方法としては、開発ツールであるESTK（ExtendScript Toolkit）を使うことです。これはプログラムの開発時に欠かせないツールで、Adobe社が開発者向けに用意したエディタ＆デバッグを行うアプリケーションです。実行対象アプリケーションでPhotoshopを選択した後、ESTKでプログラムを入力し実行ボタンを押すことで、Photoshopでプログラムを動作させることができます。ESTKの場合、間違ってプログラムが止まらなくなってしまった場合でも強制的に停止させることができます。また、内部の状況がどうなっているのか一時停止させ確認することもできます。</p>
<p>　ESTKについて詳しく知りたい方は以下の書籍を参照してください。</p>
<p>
<strong><b>ExtendScript Toolkit（ESTK）基本編 ― Adobe JavaScriptシリーズ（NextPublishing刊）</b></strong>
</p>
<figure>
<figcaption>【図】ESTK CC (Windows)の場合</figcaption>
<img src="images/00185.jpeg" />
</figure>
<figure>
<figcaption>【図】ESTK CC (Mac)の場合</figcaption>
<img src="images/00395.jpeg" />
</figure>
<p>　この他にもOSのシェルからPhotoshopのプログラムを実行したり、Adobe Bridge経由でプログラムを実行させることもできます。また、本書では解説していませんが、CEPを使ってPhotoshopの拡張パネルからプログラムを呼び出して実行することもできます。</p>
</section>
</div>
<div id="calibre_link-486">
<section>
<h2 id="calibre_link-62"><b>1-3　プログラムが動かない場合の対処方法</b></h2>
<p>　本書に掲載されているプログラムは、そのまま動作するものもありますが、多くは動作させるための前提条件があります。前提条件と言っても複雑なことではなく、レイヤーが選択されている、ドキュメントが開かれている、といったことです。プログラムによっては前提条件が揃っていないとエラーで動作しないものもあります。何を選択しておけばよいかなどは、各項目の解説および図の直前の説明文に書かれています。</p>
<p>　プログラムが動かない場合の対処方法はいくつかあります。プログラムを自分で入力した／書いた／変更した場合も含めると、以下のような部分をチェックすることで解決への糸口が見つかることがあります。</p>
<p>
<br />
</p>
<p>
<strong><b>1. プログラムを見直す</b></strong>
</p>
<p>　基本的に動作しないのはプログラムが間違っているのが主な原因です。半角文字が全角文字になっていたり、値を間違えている、文法的に間違っている、動きそうなプログラムをコピー＆ペーストして利用しているなど原因はさまざまです。ESTKのデバッグ機能を利用してプログラムの不具合を修正してください。</p>
<p>　プログラムが動かない原因を2つに分けると「入力ミス・文法ミス」と「アルゴリズム（手順）のミス」があります。前者はESTKがエラーを出してくれますので割と早期発見が可能です。問題は後者で、アルゴリズム（手順）が悪い場合はエラーにならなくても目的の処理を行うことができないことがあります。これは、手順が正しいかどうか自分で考えて確認し、地道に実行していくしかありません。</p>
<p>　また、Photoshopの場合、全ての処理を用意されているオブジェクトで実現することはできません。例えば1文字だけ色を変える、といった処理は標準で用意されているPhotoshopのオブジェクトではできません。このため、Scripting Listenerを使わなければならない場面が多くあります。Scripting Listenerで記録されたスクリプトが正しく動作するかなどの確認作業も必要になります。</p>
<p>
<br />
</p>
<p>
<strong><b>2. 動作条件を調べる</b></strong>
</p>
<p>　Photoshopは他のAdobeアプリケーションと比べてもプログラム（オブジェクトのメソッド）の動作条件がシビアな部分があります。例えば通常のレイヤーでは問題なく動作するのにテキストレイヤーでは突如エラーになることがあります。また、レイヤーがロックされているかどうかでエラーになる場合があります。</p>
<p>　また、滅多にありませんが古いバージョンで作成されたスクリプトを利用すると機能が削除されていたり変更されているためエラーになったり予期せぬ動作になることがあります。</p>
<p>
<br />
</p>
<p>
<strong><b>3. 他のユーザーアカウントで実行する</b></strong>
</p>
<p>　動作が不安定な場合は、現在のユーザーアカウントではなく、新たにアカウントを作成します。新しく作成したアカウント上でプログラムを実行することで解決できることもあります。</p>
<p>
<br />
</p>
<p>
<strong><b>4. Adobe関係のアプリケーションを全部終了させる</b></strong>
</p>
<p>　PhotoshopではIllustratorやInDesignなどで実行されたプログラムの影響を受けることがあります。特にグローバル変数・関数を利用した場合は動作が変わってしまうことがあります。このため、従来動いていたプログラムが動作しなくなったりエラーになるような場合は、実行しているAdobe関係のアプリケーションを全て終了した後でPhotoshopを起動してください。その後、ESTKを起動しデバッグメニューから「リセット」の項目を選択してからプログラムを実行してください。</p>
<p>　なお、このような不具合が発生する場合はPhotoshopで動かすプログラムを他のアプリケーションの影響を受けないように変更する方法もあります。</p>
<p>
<br />
</p>
<p>
<strong><b>5. Photoshop/ESTKを再起動する</b></strong>
</p>
<p>　以前は動いていたプログラムが動かなくなった、プログラム実行中に原因不明のエラーが発生する、Photoshopが落ちてしまった（勝手に終了してしまった）場合はPhotoshopを再起動してみてください。なお、ESTKも併用して利用している場合はESTKも再起動させてください。</p>
<p>
<br />
</p>
<p>
<strong><b>6. OSを再起動する</b></strong>
</p>
<p>　ファイルの書き込みができない、ESTKとPhotoshopの組み合わせがうまく動作しないといった場合はOS（Windows/Mac OS X）を再起動してみてください。OSの再起動は最終的な手段の1つです。</p>
<p>
<br />
</p>
<p>
<strong><b>7. Photoshopを一度アンインストールし再度インストールする</b></strong>
</p>
<p>　OSの再起動でも直らない場合はPhotoshopを一度アンインストールし再度インストールしてみてください。もし、可能であれば新たなマシンや環境を用意し、そこに新規にPhotoshopをインストールし、その上でプログラムを実行させてみてください。</p>
<p>
<br />
</p>
<p>
<strong><b>8. あきらめる</b></strong>
</p>
<p>　一旦あきらめるのも1つの方法です。もしかしたらPhotoshopのバージョンアップ、マイナーアップデートで直ってしまうこともあるためです。ただ、確実に不具合（バグ）ならばAdobeフォーラムに不具合の情報を書き込むことで、いずれ解決される可能性もあります。</p>
<p>
<br />
</p>
<p>　プログラムの作成は派手なものではなく地道に作っていくものです。すぐに自動化プログラムが作れて便利になるというものでもありません。ただ、一度動き始めてしまえば非常に強力なものになります。不具合が発生しても、あきらめずに頑張ってプログラムを作成してみてください。</p>
<p>　以下は、実際に作成時に遭遇したエラーをリストアップしたものです。エラーで動作しない場合に参考にしてください。</p>
<p>
<br />
</p>
<p>・ドキュメントがアクティブになっていないためエラー（処理内容によりけり）</p>
<p>・対象がアクティブレイヤーになっていることが暗黙の了解になっている処理でエラー</p>
<p>・UnitValue形式で指定するところを数値で指定し何らかの原因でエラー</p>
<p>・layerオブジェクトのフィルタでパラメーターの個数や形式が違うとエラー</p>
<p>・保存先のフォルダが存在しないとエラー</p>
<p>・保存先のフォルダに書き込み権限がないとエラー</p>
<p>・存在しないファイルを指定して読み出し／書き込みエラー</p>
<p>・ファイル／フォルダが存在するのに文字コードの関係でエラー（Mac OS Xで発生）</p>
<p>・同じファイルがあり、ロックされていて削除できずエラー</p>
<p>・カラープロファイル変換でdisplayDialogs = DialogModes.NO;が指定されているとエラー</p>
<p>・複数レイヤー選択でも単独レイヤー処理しかできないため、想定とは違う動作になりエラー</p>
<p>・Photoshop CC以降で追加された命令なのにCS6など古いバージョンで動作させようとしてエラー</p>
<p>・Photoshop CCで削除された命令を実行しようとしてエラー（古いバージョンのPhotoshopで動作していたスクリプトなど）</p>
<p>・背景は別途処理が必要なのにレイヤーと同等の処理を行ったためエラー</p>
<p>・カットできないレイヤーをカットしようとしてエラー（テキストレイヤーなど）</p>
<p>・同じ名前のレイヤーがあり正常に動作せずエラー</p>
<p>・入力ミスで存在しないプロパティに代入し動作不良。app.activeDocument.actveLayer = ～のような場合、エラーは発生しない。微妙なスペルミスでエラーが発生しないのは発見が難しい。</p>
<p>・ファイルに書き込めない。この場合、再起動すれば書き込み可能になる。</p>
<p>・レイヤーがアクティブになっているよいうに見えてアクティブになっておらずエラー。例えばactiveLayerを使った場合、テキストボックスでブラシサイズを入力する状態になっているなど完全にレイヤーそのものがアクティブでないと処理されない。</p>
<p>・プログラムの先頭で#target "photoshop"が指定されておらず異なるアプリケーションで実行されエラー。</p>
</section>
</div>
<div id="calibre_link-564">
<section>
<h2 id="calibre_link-63"><b>1-4　自動的にスクリプトを生成するScripting Listenerについて</b></h2>
<p>　Photoshopには、プログラムを書かなくても自動的にスクリプトを生成するScripting Listenerが用意されています。以下のページにScripting Listenerの説明とダウンロード方法、インストール方法が記載されています。</p>
<p>
<br />
</p>
<p>
<strong><b>Photoshop - Scripting Listenerの説明とダウンロード</b></strong>
</p>
<p>
<a href="https://helpx.adobe.com/jp/photoshop/kb/plug-ins-photoshop-cs61.html#id_68969">https://helpx.adobe.com/jp/photoshop/kb/plug-ins-photoshop-cs61.html#id_68969</a>
</p>
<p>
<br />
</p>
<p>　ダウンロードすると以下のフォルダ構成になります。WindowsとMacで若干異なります。Macの場合はUtilitiesフォルダ内にあるScriptingListener.pluginをアプリケーションがあるフォルダ内のPlug-insフォルダにドラッグドロップします。Windowsの場合は使用しているOSが32ビットか64ビットかでフォルダが分かれています。使用しているOSを確認し対応するフォルダを開きます。Scripting UtilitiesフォルダにあるScriptingListenerをアプリケーションがあるフォルダ内のPlug-insフォルダにドラッグドロップします。</p>
<figure>
<figcaption>【図】Mac版の場合</figcaption>
<img src="images/00453.jpeg" />
</figure>
<figure>
<figcaption>【図】Windows版の場合</figcaption>
<img src="images/00222.jpeg" />
</figure>
<p>　Photoshopで何か操作すると自動的にファイルに記録されていきます。記録されたプログラムはデスクトップにScriptingListenerJS.logというファイル名で保存されます。内容を消去しない限り、操作した内容がどんどん追加されていきます。</p>
<p>　Scripting Listenerは基本的にアクションで記録するのと変わりません。アクションに記録するかスクリプトとして記録するかの違いです。このため、マウスで描いた絵などは記録することができません。マウス座標などを取得して描いた絵を再現するようなことはできません。Scripting Listenerはアクション記録以上のことはできないのです。ただし、記録されたスクリプトと自分で作成するスクリプトを組み合わせると非常に大きな威力を発揮します。特にPhotoshopの多くの機能を使用するにはScripting Listenerでプログラムを生成するしかないためです。</p>
<p>　例えばScripting Listenerで記録される内容は以下のようになります。これは新規ドキュメントを作成するスクリプトです（作成するドキュメントによっては異なる内容になります）。</p>
<p>　Scripting Listenerで記録される処理はアクションの単位と同じです。どこで区切られているかは、コメントで分かります。// =======となっている部分から次の// =======までが1セットになります。この1セットをコピーして利用することになります。以下に1セットの例を示します。</p>
<pre><code>// =======================================================
var idMk = charIDToTypeID( "Mk  " );
    var desc1 = new ActionDescriptor();
    var idNw = charIDToTypeID( "Nw  " );
        var desc2 = new ActionDescriptor();
        var idMd = charIDToTypeID( "Md  " );
        var idRGBM = charIDToTypeID( "RGBM" );
        desc2.putClass( idMd, idRGBM );
        var idWdth = charIDToTypeID( "Wdth" );
        var idRlt = charIDToTypeID( "#Rlt" );
        desc2.putUnitDouble( idWdth, idRlt, 640.000000 );
        var idHght = charIDToTypeID( "Hght" );
        var idRlt = charIDToTypeID( "#Rlt" );
        desc2.putUnitDouble( idHght, idRlt, 480.000000 );
        var idRslt = charIDToTypeID( "Rslt" );
        var idRsl = charIDToTypeID( "#Rsl" );
        desc2.putUnitDouble( idRslt, idRsl, 72.000000 );
        var idpixelScaleFactor = stringIDToTypeID( "pixelScaleFactor" );
        desc2.putDouble( idpixelScaleFactor, 1.000000 );
        var idFl = charIDToTypeID( "Fl  " );
        var idFl = charIDToTypeID( "Fl  " );
        var idWht = charIDToTypeID( "Wht " );
        desc2.putEnumerated( idFl, idFl, idWht );
        var idDpth = charIDToTypeID( "Dpth" );
        desc2.putInteger( idDpth, 8 );
        var idprofile = stringIDToTypeID( "profile" );
        desc2.putString( idprofile, "sRGB IEC61966-2.1" );
    var idDcmn = charIDToTypeID( "Dcmn" );
    desc1.putObject( idNw, idDcmn, desc2 );
executeAction( idMk, desc1, DialogModes.NO );</code></pre>
<p>　Scripting Listenerで生成されたプログラムはいつも同じ動作しかできませんが、一部を書き換えることによって汎用性を持たせることができます。例えば以下の行は作成するドキュメントの横幅を設定しています。640.000000が横幅を示しています。この部分を変数にすることによって汎用性を持たせることができます。</p>
<pre><code>desc2.putUnitDouble( idWdth, idRlt, 640.000000 );</code></pre>
<p>　また、Scripting Listenerで記録した部分を関数にすることによって、再利用も可能になります。上記のプログラムを改良し汎用性を持たせると以下のようになります。newDocという関数名にし、作成するドキュメントの横幅と縦幅を自由に設定できるようにしました。</p>
<pre><code>// 新規ドキュメントを作成する
newDoc(320, 240);
newDoc(128, 90);
// =======================================================
function newDoc(w, h){
    var idMk = charIDToTypeID( "Mk  " );
    var desc1 = new ActionDescriptor();
    var idNw = charIDToTypeID( "Nw  " );
        var desc2 = new ActionDescriptor();
        var idMd = charIDToTypeID( "Md  " );
        var idRGBM = charIDToTypeID( "RGBM" );
        desc2.putClass( idMd, idRGBM );
        var idWdth = charIDToTypeID( "Wdth" );
        var idRlt = charIDToTypeID( "#Rlt" );
        desc2.putUnitDouble( idWdth, idRlt, w );    // ●変更
        var idHght = charIDToTypeID( "Hght" );
        var idRlt = charIDToTypeID( "#Rlt" );
        desc2.putUnitDouble( idHght, idRlt, h );    // ●変更
        var idRslt = charIDToTypeID( "Rslt" );
        var idRsl = charIDToTypeID( "#Rsl" );
        desc2.putUnitDouble( idRslt, idRsl, 72.000000 );
        var idpixelScaleFactor = stringIDToTypeID( "pixelScaleFactor" );
        desc2.putDouble( idpixelScaleFactor, 1.000000 );
        var idFl = charIDToTypeID( "Fl  " );
        var idFl = charIDToTypeID( "Fl  " );
        var idWht = charIDToTypeID( "Wht " );
        desc2.putEnumerated( idFl, idFl, idWht );
        var idDpth = charIDToTypeID( "Dpth" );
        desc2.putInteger( idDpth, 8 );
        var idprofile = stringIDToTypeID( "profile" );
        desc2.putString( idprofile, "sRGB IEC61966-2.1" );
    var idDcmn = charIDToTypeID( "Dcmn" );
    desc1.putObject( idNw, idDcmn, desc2 );
    executeAction( idMk, desc1, DialogModes.NO );
}</code></pre>
<p>　Scripting Listenerを使って記録したスクリプトも、まとめておけば立派なライブラリになります。ライブラリを増やすことで、プログラムの開発効率も向上していくはずです。</p>
</section>
</div>
<div id="calibre_link-1">
<section>
<h2 id="calibre_link-64"><b>1-5　より手軽に自動化するにはどうしたらよいか</b></h2>
<p>　自動化は簡単にできそうでできない処理もあります。全てをスクリプトを使って自動化するというのは、手慣れた人であれば可能かもしれませんが、そうでない場合、予想以上に時間がかかることがあります。基本的には手作業では難しい、時間がかかる部分を自動化するのが最も効率的です。全てを完全に自動化しなくてもよいのです。</p>
<p>　Photoshopでスクリプトを使って自動化する前に以下のことを検討してみてください。</p>
<p>
<br />
</p>
<p>
<strong><b>1. 標準機能でできないか確認する</b></strong>
</p>
<p>　Photoshopの全機能を把握している人は大変少ないでしょう。Photoshopの標準機能でもできる場合が結構あります。バージョンCC以降であればアクションによる条件分岐もできます。複雑な条件が絡まなければPhotoshopの機能であるアクションとバッチ機能を使って効率化できます。</p>
<p>　また、スクリプトも標準で便利なものが入っています。あらかじめ用意されているのに、わざわざ作る必要はありません。</p>
<p>
<strong><b>2. Add-on（アドオン）を使う</b></strong>
</p>
<p>　Photoshopでは以下のページからAdd-onをダウンロードして機能を追加することができます。手作業では面倒な処理もAdd-onを追加することで簡単にできることもあります。</p>
<p>
<br />
</p>
<p>
<strong><b>Photoshop Add-ons</b></strong>
</p>
<p>
<a href="https://creative.adobe.com/addons?pp=PHSP">https://creative.adobe.com/addons?pp=PHSP</a>
</p>
<p>
<br />
</p>
<p>
<strong><b>3. Webで検索する／プラグインを使う</b></strong>
</p>
<p>　Photoshopには大変長い歴史があります。省力化／自動化するためのノウハウもWebに掲載されていることがあります。自分で作る前に検索して実現したい機能を持つプラグインやスクリプトなどがないか確認しましょう。市販もしくはフリーのプラグインで自動化できる、効率アップするならそれでも十分でしょう。</p>
<p>
<br />
</p>
<p>
<strong><b>4. Scripting Listenerを使う</b></strong>
</p>
<p>　自動化のスクリプトを1から作るのは時間がかかります。Scripting Listenerを使って記録し、最低限作らなければならない部分だけに注力するのがよいでしょう。Scripting Listenerを使って記録した部分は関数にしておくと不具合の発生も減り、再利用することもできます。</p>
<p>
<br />
</p>
<p>
<strong><b>5. 操作を記録するアプリケーション（キーマクロ・キーバッチ）を使う</b></strong>
</p>
<p>　メニュー操作やパネル操作が絡むとアクションだけではできないことがあります。そのような場合は、キー操作を記録するアプリケーションを利用する方法もあります。</p>
<p>
<br />
</p>
<p>
<strong><b>6. 外注する</b></strong>
</p>
<p>　自動化の種類にもよりますが、トータルの時間・コストを考えた場合、外注した方が安い場合もあります。</p>
<p>
<br />
</p>
<p>　上記のいずれも駄目だった場合にはPhotoshopのJavaScriptを使って自動化しましょう。なお、Photoshopの場合、Scripting Listenerを使わないと実現できない機能が多くありますので、上手に活用しましょう。</p>
<p>　プログラムは一度作成してしまえば、安定して高速に動作してくれます。本書では基本編ということで、複数の機能を組み合わせたサンプルはあまりありませんが、基本的な処理だけでも役立つはずです。</p>
</section>
</div>
<div id="calibre_link-504">
<section>
<h2 id="calibre_link-65"><b>1-6　JavaScriptをプラグインのように機能させる</b></h2>
<p>　スクリプトがPhotoshopのアプリケーションフォルダの「Presets」/「Scripts」フォルダに入っている場合、コメントに特別なタグを記述することでフィルタメニューの項目として表示させたり、カテゴリ別に分けて表示することができます。これはPhotoshopのJavaScriptリファレンスの「JavaScript Resource」に詳しく書かれています。ここでは主なタグと概要を説明します。</p>
<p>　まず、プログラムの先頭で/*と*/の複数行コメントにタグを記述します。タグは&lt;javascriptresource&gt;で始まり、&lt;/javascriptresource&gt;で終わります。この間に必要なタグを記述します。主なタグを以下の表に示します。</p>
<table>
<caption>【表】タグの種類</caption>
<tbody>
<tr>
  <td>
    <span>タグ</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>&lt;name&gt;</td>
  <td>スクリプトの名前を指定します。</td>
</tr>
<tr>
  <td>&lt;category&gt;</td>
  <td>ファイルメニューのスクリプトで表示されるメニューのカテゴリを指定します。同じカテゴリ名の場合、スクリプトは同じブロックに入ります。</td>
</tr>
<tr>
  <td>&lt;about&gt;</td>
  <td>Photoshopのプラグインについて表示されるダイアログに表示される文字になります。</td>
</tr>
<tr>
  <td>&lt;menu&gt;</td>
  <td>どのメニュー項目に入れるか（表示するか）を指定します。filterを指定するとフィルタメニューに作成したスクリプトが表示されます。automateを指定すると自動処理メニューに表示されます。helpを指定するとヘルプメニューに表示されます。このタグがない場合はスクリプトメニューに組み込まれます。また、任意のテキストを指定した場合、メニューに表示されなくなるので注意が必要です。</td>
</tr>
<tr>
  <td>&lt;enableinfo&gt;</td>
  <td>このタグを指定すると、最低でも１つのドキュメントがないと有効になりません。ドキュメントが全くない状態でも動作するスクリプトの場合は、このタグを使用しないでください。</td>
</tr>
</tbody>
</table>
<p>　実際のプログラムは以下のようになります。この場合、ファイルメニューのスクリプトメニューに組み込まれます。</p>
<pre><code>/*
&lt;javascriptresource&gt;
&lt;name&gt;背景をレイヤーに変換する&lt;/name&gt;
&lt;about&gt;JavaScriptで背景をレイヤーに変換します&lt;/about&gt;
&lt;category&gt;Layer&lt;/category&gt;
&lt;enableinfo&gt;true&lt;/enableinfo&gt;
&lt;/javascriptresource&gt;
*/
// 背景をレイヤーに変換する
var ptr = app.activeDocument.layers.length;
app.activeDocument.layers[ptr - 1].isBackgroundLayer = false;</code></pre>
<p>　タグを記述しない場合や&lt;menu&gt;タグを記述しない場合は、ファイルメニューのスクリプトメニューに表示されます（Mac版の図はCS6、Windows版の図はCC 2014）。</p>
<figure>
<figcaption>【図】タグを記述しない場合や&lt;menu&gt;タグを記述しない場合（Mac版CS6）</figcaption>
<img src="images/00144.jpeg" />
</figure>
<figure>
<figcaption>【図】タグを記述しない場合や&lt;menu&gt;タグを記述しない場合（Windows版CC 2014）</figcaption>
<img src="images/00594.jpeg" />
</figure>
<p>　ファイルメニューの自動処理メニューに表示する場合は以下のように&lt;menu&gt;タグにautomateを指定します。</p>
<pre><code>/*
&lt;javascriptresource&gt;
&lt;name&gt;背景をレイヤーに変換する&lt;/name&gt;
&lt;menu&gt;automate&lt;/menu&gt;
&lt;about&gt;JavaScriptで背景をレイヤーに変換します&lt;/about&gt;
&lt;category&gt;Layer&lt;/category&gt;
&lt;enableinfo&gt;true&lt;/enableinfo&gt;
&lt;/javascriptresource&gt;
*/
// 背景をレイヤーに変換する
var ptr = app.activeDocument.layers.length;
app.activeDocument.layers[ptr - 1].isBackgroundLayer = false;</code></pre>
<p>　&lt;menu&gt;タグにautomateを記述するとファイルメニューの自動処理メニューに表示されます（Mac版の図はCS6、Windows版の図はCC 2014）。</p>
<figure>
<figcaption>【図】&lt;menu&gt;タグにautomateを記述（Mac版CS6）</figcaption>
<img src="images/00357.jpeg" />
</figure>
<figure>
<figcaption>【図】&lt;menu&gt;タグにautomateを記述（Windows版CC 2014）</figcaption>
<img src="images/00492.jpeg" />
</figure>
<p>　フィルタメニューに表示する場合は&lt;menu&gt;タグにfilterを指定します。</p>
<pre><code>/*
&lt;javascriptresource&gt;
&lt;name&gt;背景をレイヤーに変換する(2)&lt;/name&gt;
&lt;menu&gt;filter&lt;/menu&gt;
&lt;about&gt;JavaScriptで背景をレイヤーに変換します&lt;/about&gt;
&lt;category&gt;Layer&lt;/category&gt;
&lt;enableinfo&gt;true&lt;/enableinfo&gt;
&lt;/javascriptresource&gt;
*/
// 背景をレイヤーに変換する
var ptr = app.activeDocument.layers.length;
app.activeDocument.layers[ptr - 1].isBackgroundLayer = false;</code></pre>
<p>　&lt;menu&gt;タグにfilterを記述するとフィルタメニューに表示されます（Mac版の図はCS6、Windows版の図はCC 2014）。</p>
<figure>
<figcaption>【図】&lt;menu&gt;タグにfilterを記述（Mac版CS6）</figcaption>
<img src="images/00355.jpeg" />
</figure>
<figure>
<figcaption>【図】&lt;menu&gt;タグにfilterを記述（Windows版CC 2014）</figcaption>
<img src="images/00121.jpeg" />
</figure>
<p>　ヘルプメニューに表示する場合は&lt;menu&gt;タグにhelpを指定します。</p>
<pre><code>/*
&lt;javascriptresource&gt;
&lt;name&gt;背景をレイヤーに変換する(3)&lt;/name&gt;
&lt;menu&gt;help&lt;/menu&gt;
&lt;about&gt;JavaScriptで背景をレイヤーに変換します&lt;/about&gt;
&lt;category&gt;Layer&lt;/category&gt;
&lt;enableinfo&gt;true&lt;/enableinfo&gt;
&lt;/javascriptresource&gt;
*/
// 背景をレイヤーに変換する
var ptr = app.activeDocument.layers.length;
app.activeDocument.layers[ptr - 1].isBackgroundLayer = false;</code></pre>
<p>　&lt;menu&gt;タグにhelpを記述するとヘルプメニューに表示されます（Mac版の図はCS6、Windows版の図はCC 2014）。</p>
<figure>
<figcaption>【図】&lt;menu&gt;タグにhelpを記述（Mac版CS6）</figcaption>
<img src="images/00485.jpeg" />
</figure>
<figure>
<figcaption>【図】&lt;menu&gt;タグにhelpを記述（Windows版CC 2014）</figcaption>
<img src="images/00315.jpeg" />
</figure>
<p>　&lt;about&gt;タグで記述されたテキストは以下のようにプラグインについての項目を選択するとダイアログに内容が表示されます。</p>
<p>　MacではPhotoshopメニューからプラグインについて、のメニューWindowsではヘルプメニューからプラグインについてから選択します。</p>
<figure>
<figcaption>【図】MacはPhotoshopメニューからプラグインについて（Mac版CS6）</figcaption>
<img src="images/00532.jpeg" />
</figure>
<figure>
<figcaption>【図】Windowsはヘルプメニューからプラグインについて（Windows版CC 2014）</figcaption>
<img src="images/00589.jpeg" />
</figure>
<p>　ダイアログに&lt;about&gt;タグの内容が表示されます。</p>
<figure>
<figcaption>【図】&lt;about&gt;タグの内容（Mac版CS6）</figcaption>
<img src="images/00160.jpeg" />
</figure>
<figure>
<figcaption>【図】&lt;about&gt;タグの内容（Windows版CC 2014）</figcaption>
<img src="images/00301.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-666">
<section>
<h2 id="calibre_link-66"><b>1-7　Photoshopリファレンスおよびスクリプティングガイドについて</b></h2>
<p>　Photoshopでのスクリプト作成に必要なドキュメントは、以下のURLにあります。Scripting Guideは、初めてPhotoshopでプログラムを作成する場合は一読しておくとよいでしょう。</p>
<p>　実際にプログラムを作成する場合には辞書となるリファレンスが必要になります。スクリプティングガイドおよびリファレンスとも英語で書かれています。日本語のサンプルと解説が必要な場合は本書と併用するのがよいでしょう。</p>
<p>
<br />
</p>
<p>
<strong><b>・Photoshop CC 2014 - JavaScript Scripting Reference</b></strong>
</p>
<p>
<a href="http://wwwimages.adobe.com/content/dam/Adobe/en/devnet/photoshop/pdfs/photoshop_scriptref_js.pdf">http://wwwimages.adobe.com/content/dam/Adobe/en/devnet/photoshop/pdfs/photoshop_scriptref_js.pdf</a>
</p>
<p>
<strong><b>・Photoshop CC 2014 - Scripting Guide</b></strong>
</p>
<p>
<a href="http://wwwimages.adobe.com/content/dam/Adobe/en/devnet/photoshop/pdfs/photoshop_scripting_guide.pdf">http://wwwimages.adobe.com/content/dam/Adobe/en/devnet/photoshop/pdfs/photoshop_scripting_guide.pdf</a>
</p>
<p>
<strong><b>・Photoshop CC - JavaScript Scripting Reference</b></strong>
</p>
<p>
<a href="http://wwwimages.adobe.com/content/dam/Adobe/en/devnet/photoshop/pdfs/photoshop-cc-javascript-ref.pdf">http://wwwimages.adobe.com/content/dam/Adobe/en/devnet/photoshop/pdfs/photoshop-cc-javascript-ref.pdf</a>
</p>
<p>
<strong><b>・Photoshop CC - Scripting Guide</b></strong>
</p>
<p>
<a href="http://wwwimages.adobe.com/content/dam/Adobe/en/devnet/photoshop/pdfs/photoshop-cc-scripting-guide.pdf">http://wwwimages.adobe.com/content/dam/Adobe/en/devnet/photoshop/pdfs/photoshop-cc-scripting-guide.pdf</a>
</p>
<p>
<strong><b>・Photoshop CS6 - JavaScript Scripting Reference</b></strong>
</p>
<p>
<a href="http://wwwimages.adobe.com/content/dam/Adobe/en/products/photoshop/pdfs/cs6/Photoshop-CS6-JavaScript-Ref.pdf">http://wwwimages.adobe.com/content/dam/Adobe/en/products/photoshop/pdfs/cs6/Photoshop-CS6-JavaScript-Ref.pdf</a>
</p>
<p>
<strong><b>・Photoshop CS6 - Scripting Guide</b></strong>
</p>
<p>
<a href="http://wwwimages.adobe.com/content/dam/Adobe/en/products/photoshop/pdfs/cs6/Photoshop-CS6-Scripting-Guide.pdf">http://wwwimages.adobe.com/content/dam/Adobe/en/products/photoshop/pdfs/cs6/Photoshop-CS6-Scripting-Guide.pdf</a>
</p>
<p>
<br />
</p>
<p>　これ以前のバージョンのリファレンス、スクリプティングガイドについては以下のページからダウンロードすることができます。</p>
<p>
<br />
</p>
<p>
<strong><b>・Adobe Photoshop Scripting</b></strong>
</p>
<p>
<a href="http://www.adobe.com/jp/devnet/photoshop/scripting.html">http://www.adobe.com/jp/devnet/photoshop/scripting.html</a>
</p>
<p>
<br />
</p>
<p>　CS3など古いスクリプティングガイドには日本語版がありましたが、CC 2014では英文ドキュメントになっています。また、リファレンスは全て英語になっています。ここではPhotoshop CC 2014 - JavaScript Scripting Referenceの見方について説明します。</p>
<p>　プログラムを作成する際にScripting Referenceは欠かせません。Scripting Referenceを見ればどのようなオブジェクトがあるか、そしてそのオブジェクトにメソッドやプロパティがあるかがわかります。またメソッドやプロパティにどのような値を設定できるか、読み出せるかがわかります。</p>
<p>　ここでは一般的なレイヤーを扱うArtLayerオブジェクトを見てみましょう。リファレンスを見ると以下の図のようになっています。</p>
<figure>
<figcaption>【図】ArtLayerオブジェクト部分のリファレンス</figcaption>
<img src="images/00347.jpeg" />
</figure>
<p>　オブジェクトのプロパティは表の「Property」の欄に書かれています。allLockedやblendModeがプロパティ名になります。どのような値が読み出せるか、書き込めるかは表の「Value type」の欄に書かれています。allLockedプロパティの行にはbooleanと書かれています。booleanはtrueまたはfalseのどちらかを設定できます。読み出せる値もtrueかfalseになっています。主な値の種類を表に示します。</p>
<table>
<caption>【表】主な値の種類</caption>
<tbody>
<tr>
  <td>boolean</td>
  <td>trueかfalseの値</td>
</tr>
<tr>
  <td>array</td>
  <td>配列</td>
</tr>
<tr>
  <td>array of number</td>
  <td>数値が格納された配列</td>
</tr>
<tr>
  <td>array of UnitValue</td>
  <td>UnitValue形式で示される単付きの値が格納された配列</td>
</tr>
<tr>
  <td>array of 4 UnitValue</td>
  <td>UnitValue形式で示される単付きの値が4つ格納された配列</td>
</tr>
<tr>
  <td>array of array of number</td>
  <td>数値が格納された二次元配列（配列内に配列を格納）</td>
</tr>
<tr>
  <td>array of string</td>
  <td>文字列が格納された配列</td>
</tr>
<tr>
  <td>array of ★</td>
  <td>★オブジェクトで示される配列</td>
</tr>
<tr>
  <td>number</td>
  <td>数値</td>
</tr>
<tr>
  <td>number [0.0..100]</td>
  <td>[～]の範囲内での数値</td>
</tr>
<tr>
  <td>double</td>
  <td>小数値。設定できる値の範囲は「What it is」の欄を参照</td>
</tr>
<tr>
  <td>string</td>
  <td>文字列</td>
</tr>
<tr>
  <td>UnitValue</td>
  <td>UnitValue形式で示される単付きの値</td>
</tr>
</tbody>
</table>
<p>　プロパティによっては読み出しのみで書き込みしかできないものもあります。これを確認するには「What it is」の欄を見ます。文章の最初に「Read-write」と書かれていれば読み出し、書き込みとも可能です。「Read-only」と書かれていれば読み出しのみで書き込むことはできません。</p>
<p>　メソッドの場合は複数のパラメーターを持ち、結果を返します。メソッドの場合、どのようなパラメーターが必要かは「Method」の欄に書かれています。パラメーターには、数値を指定すればよいのか、文字列を指定すればよいのかは「Method」と「Parameter type」の欄の2カ所を確認します。例えばadjustColorBalanceメソッドは以下のようになっています。</p>
<figure>
<figcaption>【図】adjustColorBalanceメソッドのパラメーター</figcaption>
<img src="images/00218.jpeg" />
</figure>
<p>　最初のパラメーターには[shadow]と書かれています。パラメーターに[ ]がついている場合は、そのパラメーターは省略できます。パラメーターにどの種類を指定するかは「Parameter type」に書かれており、「array of number」となっています。これはさきほどの表を見ると「数値が格納された配列」となっています。つまり[0, -10, 80]のようなパラメーターを指定します。</p>
<p>　adjustColorBalanceメソッドの最後のパラメーターを見てみましょう。preserveLuminosityとあり、「Parameter type」はbooleanとなっています。この場合はtrueまたはfalseを指定します。</p>
<p>　メソッドによっては全くパラメーターがないものもあります。</p>
<p>　メソッドによっては結果を返すものもあります。何が返されるかは「Returns」の欄を見ます。空欄の場合は何も結果を返しません。何か書かれている場合は、その値やオブジェクトを返します。例えばArtLayerと書かれていればメソッドが返す値はArtLayerオブジェクトになります。</p>
</section>
</div>
<div id="calibre_link-704">
<section>
<h2 id="calibre_link-67"><b>1-8　プログラムを修正して目的の処理を行うには</b></h2>
<p>　本書には数多くの基本的なスクリプトが掲載されていますが、全てのユーザーが行いたい処理に応えることはできません。例えばデスクトップにある特定の名前のファイルを読み込んで処理するスクリプトがあるものとします。しかし、特定の名前のファイルではなく実行するたびに任意のファイルを選択するようにしたいとします。この場合、少し変更するだけで目的の動作に変更することができます。</p>
<p>　実際のスクリプトを見てみましょう。以下のスクリプトはデスクトップにある0001.jpgをPhotoshopで開いて表示します。</p>
<p>【sample】ファイルを開く 1（sample1.jsx）</p>
<pre><code>// ファイルを開く
var fileObj = new File("～/Desktop/0001.png");
if(fileObj){
    app.open(fileObj);
    // 以後、何らかの処理
}</code></pre>
<p>　書籍のサンプルとしては問題ありませんが、実用的かどうかとなると話は違います。常に同じファイルを開いて処理をするような場合は完全に自動化するような時であり、多くの場合は任意のファイルを選択したいでしょう。</p>
<p>　この場合、「var fileObj～」の行を以下のように変更するだけでファイル選択ダイアログを表示して任意のファイルを選択できるようになります。</p>
<p>【sample】ファイルを開く 2（sample2.jsx）</p>
<pre><code>// ファイルを開く
var fileObj = File.openDialog("ファイルを選択してください");
if(fileObj){
    app.open(fileObj);
    // 以後、何らかの処理
}</code></pre>
<p>　他の例も見てみましょう。本書のサンプルではアクティブレイヤーを対象にしたものが多くあります。例えば以下のスクリプトはアクティブレイヤーにガウスぼかしを適用します。</p>
<p>【sample】レイヤーにエフェクトを設定する 1（sample3.jsx）</p>
<pre><code>// レイヤーにエフェクトを設定する
var layObj = app.activeDocument.activeLayer;
layObj.applyGaussianBlur(4);</code></pre>
<p>　しかし、処理によっては決まった位置にあるレイヤーを対象にしたいことがあります。この場合も「var layObj～」の行を変更することで対応できます。以下の場合は先頭のレイヤー（前後関係では最も手前にあるレイヤー）が処理対象になりガウスぼかしが適用されます。</p>
<p>【sample】レイヤーにエフェクトを設定する 2（sample4.jsx）</p>
<pre><code>// レイヤーにエフェクトを設定する
var layObj = app.activeDocument.artLayers[0];
layObj.applyGaussianBlur(4);</code></pre>
<p>　ただ、全ての画像ファイルが同じレイヤー構成であるとは限りません。このような場合、エフェクトを適用するレイヤー名を決めておけば同じスクリプトで処理することができます。例えば以下のスクリプトではjsTextという名前のレイヤーに対してガウスぼかしを適用します。</p>
<p>【sample】レイヤーにエフェクトを設定する 3（sample5.jsx）</p>
<pre><code>// レイヤーにエフェクトを設定する
var layObj = app.activeDocument.artLayers["jsText"];
layObj.applyGaussianBlur(4);</code></pre>
<p>　さまざまな画像ファイルを処理したい場合には、存在しないレイヤーにアクセスしてしまいエラーになることがあります。先ほどのスクリプトもjsTextという名前のレイヤーがあれば処理されますが、なければエラーになります。このような場合は以下のようにtry...catchを使ってエラーを回避します。これは存在しないレイヤー名を指定した時点でエラーになってしまうためです。</p>
<p>【sample】レイヤーにエフェクトを設定する 4（sample6.jsx）</p>
<pre><code>// レイヤーにエフェクトを設定する
try{
    var layObj = app.activeDocument.artLayers["telop"];
    layObj.applyGaussianBlur(4);
}catch(e){}</code></pre>
<p>　他にも、これらのサンプルを少し修正することで、多くの利用シーンに対応することができます。</p>
</section>
</div>
<div id="calibre_link-30">
<section>
<div>
<h1 id="calibre_link-68"><b>第2章　アプリケーション</b></h1>
</div>
</section>
</div>
<div id="calibre_link-42">
<section>
<h2 id="calibre_link-69"><b>2-1　アプリケーション名を求める</b></h2>
<p>　アプリケーション名を求めるにはappオブジェクトのnameプロパティを参照します。Adobe Photoshopの場合、バージョン名などは含まれず「Adobe Photoshop」の文字になります。スクリプトが必ずPhotoshop上で動作するようにしたい場合や、他のAdobeアプリケーションと共通で処理し、一部だけPhotoshop独自の処理を行うような場合に利用します。なお、返される文字列は統一されておらず下表のようになります。</p>
<table>
<caption>【表】app.nameで返される文字列</caption>
<tbody>
<tr>
  <td>
    <span>返される文字列</span>
  </td>
  <td>
    <span>アプリケーション名</span>
  </td>
</tr>
<tr>
  <td>Adobe Photoshop</td>
  <td>フォトショップ</td>
</tr>
<tr>
  <td>Adobe Illustrator</td>
  <td>イラストレーター</td>
</tr>
<tr>
  <td>Adobe InDesign</td>
  <td>インデザイン</td>
</tr>
<tr>
  <td>bridge</td>
  <td>ブリッジ</td>
</tr>
<tr>
  <td>ExtendScript Toolkit</td>
  <td>ESTK</td>
</tr>
<tr>
  <td>undefined</td>
  <td>アフターエフェクツ（アプリケーション名は返さない）</td>
</tr>
<tr>
  <td>undefined</td>
  <td>プレミア（アプリケーション名は返さない）</td>
</tr>
<tr>
  <td>undefined</td>
  <td>メディアエンコーダー（アプリケーション名は返さない）</td>
</tr>
</tbody>
</table>
<p>【sample】アプリケーション名を求める</p>
<pre><code>// フォトショップのみ動作させる
var aName = app.name;
alert(aName);
if (aName.indexOf("Photoshop") &gt; -1){
    alert("フォトショップなので自動処理を行います");
}else{
    alert(aName+"では動作しません");
}</code></pre>
<p>　アラートダイアログにapp.nameの内容が表示されます。</p>
<figure>
<figcaption>【図】app.nameの内容が表示される</figcaption>
<img src="images/00053.jpeg" />
</figure>
<p>　スクリプトを実行しているアプリケーションがPhotoshopの場合は、実行を行う旨のメッセージがダイアログに表示されます。</p>
<figure>
<figcaption>【図】アプリケーションがPhotoshopの場合、実行を行う旨のメッセージが表示される</figcaption>
<img src="images/00336.jpeg" />
</figure>
<p>　Illustratorで実行すると動作しない、という旨のメッセージが表示されます。</p>
<figure>
<figcaption>【図】Illustratorで実行すると動作しない、という旨のメッセージが表示される</figcaption>
<img src="images/00547.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-549">
<section>
<h2 id="calibre_link-70"><b>2-2　バージョンを求める／指定バージョン以上でしか動作しないようにする</b></h2>
<p>　バージョンを求めるにはappオブジェクトのversionプロパティを参照します。バージョン番号は数値ではなく文字列で返されます。CCの場合は14.2.0といった文字列が返されます。マイナーバージョンなど一部だけを知りたい場合はサンプルのようにsplit()メソッドを使って(.ドット)ごとに切り分けます。split()メソッドで取り出されたものは文字列になるので、数値として比較したい場合にはparseInt()を使って整数値にしてから処理を行います。</p>
<p>　バージョン別に処理を分ける場合はメジャーバージョンなどを取り出しif命令を使って判別します。</p>
<p>　app.versionで返されるメジャーバージョンとPhotoshopの名称の対応を以下の表に示します。</p>
<table>
<caption>【表】バージョン番号との対応</caption>
<tbody>
<tr>
  <td>
    <span>バージョン番号</span>
  </td>
  <td>
    <span>Photoshopの名称</span>
  </td>
</tr>
<tr>
  <td>10</td>
  <td>Photoshop CS3</td>
</tr>
<tr>
  <td>11</td>
  <td>Photoshop CS4</td>
</tr>
<tr>
  <td>12</td>
  <td>Photoshop CS5</td>
</tr>
<tr>
  <td>13</td>
  <td>Photoshop CS6</td>
</tr>
<tr>
  <td>14</td>
  <td>Photoshop CC</td>
</tr>
<tr>
  <td>15</td>
  <td>Photoshop CC 2014</td>
</tr>
</tbody>
</table>
<p>【sample】バージョンを求める／指定バージョン以上でしか動作しないようにする</p>
<pre><code>// バージョンを表示しCC以降でしか動作しないようにする
var ver = app.version;
alert(ver);
var verList = ver.split(".");
alert("メジャーバージョン："+verList[0] + "\n" +
    "マイナーバージョン："+verList[1] + "\n" +
    "リビジョン番号："+verList[2]);
if (parseInt(verList[0]) &gt;= 14){
    alert("バージョンCC以上なので処理を行います");
}else{
    alert("バージョンCCより前のバージョンでは動作しません");
}</code></pre>
<p>　バージョンに応じたメッセージがアラートダイアログに表示されます。Photoshop CS6の場合、以下のように3つのダイアログが表示されます。</p>
<figure>
<figcaption>【図】Photoshop CS6の場合</figcaption>
<img src="images/00583.jpeg" />
</figure>
<figure>
<img src="images/00264.jpeg" />
</figure>
<figure>
<img src="images/00118.jpeg" />
</figure>
<p>　Photoshop CCの場合は以下のように3つのダイアログが表示されます。</p>
<figure>
<figcaption>【図】Photoshop CCの場合</figcaption>
<img src="images/00096.jpeg" />
</figure>
<figure>
<img src="images/00370.jpeg" />
</figure>
<figure>
<img src="images/00066.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-512">
<section>
<h2 id="calibre_link-71"><b>2-3　スクリプトエンジンのバージョンを求める</b></h2>
<p>　スクリプトエンジンのバージョンを求めるにはappオブジェクトのscriptingVersionプロパティを参照します。バージョン番号は数値ではなく文字列で返されます。CC2014の場合は15.2.2といった文字列が返されます。基本的にはスクリプトバージョンもapp.versionと同じメジャーバージョンになっていますが、将来的にも同じになるという保証はありません。（他のアプリケーションではアプリケーションとバージョンとスクリプトエンジンのバージョンが違っているものがあります）</p>
<p>　また、スクリプトエンジンの情報をより細かく知りたい場合にはappオブジェクトのscriptingBuildDateプロパティを参照します。スクリプトエンジンが構築された日時やビルド番号を取得することができます。</p>
<table>
<caption>【表】スクリプトエンジンのバージョン番号との対応</caption>
<tbody>
<tr>
  <td>
    <span>バージョン番号</span>
  </td>
  <td>
    <span>Photoshopの名称</span>
  </td>
</tr>
<tr>
  <td>10</td>
  <td>Photoshop CS3</td>
</tr>
<tr>
  <td>11</td>
  <td>Photoshop CS4</td>
</tr>
<tr>
  <td>12</td>
  <td>Photoshop CS5</td>
</tr>
<tr>
  <td>13</td>
  <td>Photoshop CS6</td>
</tr>
<tr>
  <td>14</td>
  <td>Photoshop CC</td>
</tr>
<tr>
  <td>15</td>
  <td>Photoshop CC 2014</td>
</tr>
</tbody>
</table>
<p>【sample】スクリプトエンジンのバージョンを求める</p>
<pre><code>// スクリプトエンジンのバージョンを表示する
var ver = app.scriptingVersion;
var build = app.scriptingBuildDate;
alert(ver+"\n"+build);</code></pre>
<p>　Photoshop CS6のスクリプトエンジンとビルド番号がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】Photoshop CS6のスクリプトエンジンとビルド番号が表示される</figcaption>
<img src="images/00002.jpeg" />
</figure>
<p>　Photoshop CCのスクリプトエンジンとビルド番号がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】Photoshop CCのスクリプトエンジンとビルド番号が表示される</figcaption>
<img src="images/00134.jpeg" />
</figure>
<p>　Photoshop CC 2014のスクリプトエンジンとビルド番号がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】Photoshop CC 2014のスクリプトエンジンとビルド番号が表示される</figcaption>
<img src="images/00023.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-493">
<section>
<h2 id="calibre_link-72"><b>2-4　ビープ音（警告音）を鳴らす</b></h2>
<p>　ビープ音（警告音）を鳴らすにはappオブジェクトのbeep()メソッドを使います。beep()メソッドを実行するとシステム(OS)で設定されている警告音が鳴ります。なお、連続してbeep()メソッドを実行した場合、それらはまとめられ1回しか音は鳴りません。</p>
<p>【sample】ビープ音（警告音）を鳴らす</p>
<pre><code>// ビープ音（警告音）を鳴らす
app.beep();</code></pre>
</section>
</div>
<div id="calibre_link-649">
<section>
<h2 id="calibre_link-73"><b>2-5　Photoshopを終了させる</b></h2>
<p>　Photoshopを終了させるにはアクション機能を利用します。他のアプリケーションではappオブジェクトのquit()メソッドで終了させることができますが、Photoshopではquit()メソッドがありません。このため、executeAction()メソッドを使って実行するアクションを指定します。スクリプトのみでアクションを実行するにはexecuteAction()メソッドの最初のパラメーターに実行するコマンドを指定し、2番目のパラメーターにActionDescriptor（アクションデスクプリター）を指定します。3番目のパラメーターにはアクション実行に対してダイアログを表示するかどうかを指定します。終了処理の場合、DialogModes.NOでなくDialogModes.ALLやDialogModes.ERRORを指定してもダイアログが表示されることなくPhotoshopは終了します。</p>
<p>【sample】Photoshopを終了させる</p>
<pre><code>// Photoshopを終了させる
var desc = new ActionDescriptor();
var quitID = charIDToTypeID("quit");
executeAction(quitID, desc, DialogModes.NO);</code></pre>
</section>
</div>
<div id="calibre_link-434">
<section>
<h2 id="calibre_link-74"><b>2-6　空きメモリを求める／メモリを解放する</b></h2>
<p>　Photoshopで使用している空きメモリのサイズを求めるにはappオブジェクトのfreeMemoryプロパティを参照します。また、メモリ（キャッシュ）には、クリップボード、ヒストリー、取り消し、ビデオがあります。このうちビデオキャッシュ以外のメモリはappオブジェクトのpurge()メソッドを使ってクリア（解放／消去）することができます。purge()メソッドには以下の表に示す値を指定することで特定のメモリキャッシュをクリアすることができます。</p>
<table>
<caption>【表】purge()メソッドに指定できる値</caption>
<tbody>
<tr>
  <td>
    <span>値</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>PurgeTarget.ALLCACHES</td>
  <td>全て</td>
</tr>
<tr>
  <td>PurgeTarget.CLIPBOARDCACHE</td>
  <td>クリップボード</td>
</tr>
<tr>
  <td>PurgeTarget.HISTORYCACHES</td>
  <td>ヒストリー</td>
</tr>
<tr>
  <td>PurgeTarget.UNDOCACHES</td>
  <td>取り消し（アンドゥ）</td>
</tr>
</tbody>
</table>
<p>【sample】空きメモリを求める／メモリを解放する</p>
<pre><code>// 空きメモリを表示する／メモリを解放する
app.purge(PurgeTarget.ALLCACHES); 
var mem = app.freeMemory;
alert(mem);</code></pre>
<p>　アラートダイアログにメモリキャッシュクリア後の空きメモリのサイズが表示されます。</p>
<figure>
<figcaption>【図】メモリキャッシュクリア後の空きメモリのサイズが表示される</figcaption>
<img src="images/00439.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-590">
<section>
<h2 id="calibre_link-75"><b>2-7　QuickTimeが有効かどうか調べる</b></h2>
<p>　QuickTimeが有効かどうか調べるにはappオブジェクトのisQuicktimeAvailable()メソッドを使います。戻り値がtrueならQuickTimeが有効、falseなら無効になっていることになります。Macintoshの場合は常にtrueを返します。</p>
<p>【sample】QuickTimeが有効かどうか調べる</p>
<pre><code>// QuickTimeが有効かどうか調べる
var flag = app.isQuicktimeAvailable();
alert(flag);</code></pre>
<p>　アラートダイアログにQuickTimeが有効かどうかの状態が表示されます。trueなら有効、falseなら無効です。</p>
<figure>
<figcaption>【図】QuickTimeが有効かどうかの状態が表示される</figcaption>
<img src="images/00546.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-26">
<section>
<h2 id="calibre_link-76"><b>2-8　実行中の環境の言語を調べる</b></h2>
<p>　実行中の環境の言語を調べるにはappオブジェクトのlocaleプロパティを参照します。日本語環境の場合はja_JPの文字列が返されます。他にも環境に応じて以下のような文字列が返されます。</p>
<table>
<caption>【表】言語を示す文字列</caption>
<tbody>
<tr>
  <td>
    <span>文字列</span>
  </td>
  <td>
    <span>言語</span>
  </td>
</tr>
<tr>
  <td>ja_JP</td>
  <td>日本語</td>
</tr>
<tr>
  <td>en_US</td>
  <td>アメリカ</td>
</tr>
<tr>
  <td>en_UK</td>
  <td>イギリス</td>
</tr>
<tr>
  <td>de_DE</td>
  <td>ドイツ</td>
</tr>
<tr>
  <td>fr_FR</td>
  <td>フランス</td>
</tr>
</tbody>
</table>
<p>【sample】実行中の環境の言語を調べる</p>
<pre><code>// 実行中の環境の言語を調べる
var lang = app.locale;
alert(lang);</code></pre>
<p>　アラートダイアログにQuickTimeが有効かどうかの状態が表示されます。trueなら有効、falseなら無効です。</p>
<figure>
<figcaption>【図】QuickTimeが有効かどうかの状態が表示される</figcaption>
<img src="images/00033.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-538">
<section>
<h2 id="calibre_link-77"><b>2-9　カラー設定を取得する</b></h2>
<p>　カラー設定を取得するにはappオブジェクトのcolorSettingsプロパティを参照します。いずれの場合もCustomの文字列が返され正しいカラー設定情報を得ることはできません。多分、不具合だと思われます。なお、colorSettingsプロパティは編集メニューのカラー設定を選択した際に設定するカラーになります。</p>
<p>【sample】カラー設定を取得する</p>
<pre><code>// カラー設定を取得する
var color = app.colorSettings;
alert(color);</code></pre>
<p>　アラートダイアログにカラー設定を示す文字列が表示されます。</p>
<figure>
<figcaption>【図】カラー設定を示す文字列が表示される</figcaption>
<img src="images/00176.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-691">
<section>
<h2 id="calibre_link-78"><b>2-10　実行されているスクリプトのファイル名を求める</b></h2>
<p>　実行されているスクリプトのファイル名を求めるには$オブジェクトのfileNameプロパティを参照します。</p>
<p>【sample】実行されているスクリプトのファイル名を求める</p>
<pre><code>// 実行されているスクリプトのファイル名を表示する
var currentScriptFile = $.fileName;
alert(File.decode(currentScriptFile));</code></pre>
<p>　アラートダイアログに実行されているスクリプトのファイル名が表示されます。</p>
<figure>
<figcaption>【図】実行されているスクリプトのファイル名が表示される</figcaption>
<img src="images/00318.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-478">
<section>
<h2 id="calibre_link-79"><b>2-11　ダイアログモードを指定する</b></h2>
<p>　スクリプト実行時に不要なダイアログが表示されてしまうのを回避する際にダイアログモードを指定することができます。ダイアログモードの指定はappオブジェクトのdisplayDialogsプロパティに以下の表に示す値を指定します。</p>
<table>
<caption>【表】ダイアログモードの種類</caption>
<tbody>
<tr>
  <td>
    <span>ダイアログモード</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>DialogModesALL</td>
  <td>アラートダイアログ・ダイアログとも表示する</td>
</tr>
<tr>
  <td>DialogModes.NO</td>
  <td>アラートダイアログ・ダイアログとも表示しない</td>
</tr>
<tr>
  <td>DialogModes.ERROR</td>
  <td>アラートダイアログは表示するがダイアログは表示しない</td>
</tr>
</tbody>
</table>
<p>【sample】ダイアログモードを指定する</p>
<pre><code>// ダイアログモードを指定する
app.displayDialogs = DialogModes.NO;</code></pre>
</section>
</div>
<div id="calibre_link-595">
<section>
<h2 id="calibre_link-80"><b>2-12　単位を読み出す／変更する</b></h2>
<p>　Photoshopの単位はappオブジェクトのpreferencesオブジェクトのrulerUnitsプロパティとtypeUnitsプロパティに格納されています。rulerUnitsは文字以外の単位、typeUnitsは文字の単位を示しています。これらのプロパティは読み出すだけでなく設定することもできます。設定できる単位は表に示す値になります。</p>
<table>
<caption>【表】単位</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>単位</span>
  </td>
</tr>
<tr>
  <td>Units.CM</td>
  <td>センチメートル</td>
</tr>
<tr>
  <td>Units.INCHES</td>
  <td>インチ</td>
</tr>
<tr>
  <td>Units.MM</td>
  <td>ミリメートル</td>
</tr>
<tr>
  <td>Units.PERCENT</td>
  <td>パーセント</td>
</tr>
<tr>
  <td>Units.PICAS</td>
  <td>パイカ</td>
</tr>
<tr>
  <td>Units.PIXELS</td>
  <td>ピクセル</td>
</tr>
<tr>
  <td>Units.POINTS</td>
  <td>ポイント</td>
</tr>
</tbody>
</table>
<p>【sample】単位を読み出す／変更する</p>
<pre><code>// 単位を読み出す／変更する
var saveUnit = app.preferences.rulerUnits;
var savetypeUnit = app.preferences.typeUnits;
alert("単位："+saveUnit+"\n文字の単位；"+savetypeUnit);
app.preferences.rulerUnits = Units.PIXELS;
app.preferences.typeUnits = TypeUnits.MM;</code></pre>
<p>　アラートダイアログに現在の単位が表示されます。</p>
<figure>
<figcaption>【図】現在の単位が表示される</figcaption>
<img src="images/00219.jpeg" />
</figure>
<p>　単位が設定されます。設定された単位はルーラーや文字のサイズ指定を行うボックスで確認できます。</p>
<figure>
<figcaption>【図】単位が設定される</figcaption>
<img src="images/00068.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-31">
<section>
<div>
<h1 id="calibre_link-81"><b>第3章　ドキュメント</b></h1>
</div>
</section>
</div>
<div id="calibre_link-543">
<section>
<h2 id="calibre_link-82"><b>3-1　新規にドキュメントを作成する</b></h2>
<p>　新規にドキュメントを作成するにはdocumentsオブジェクトのadd()メソッドを使います。add()メソッドのパラメーターは9つあり、「【表】パラメーターの順番と意味」のようになっています。add()メソッドは全てのパラメーターを省略することができます。9番目のパラメーターはカラープロファイルの種類ではなくカラープロファイル名を示す文字列になります。設定後はdocumentオブジェクトのcolorProfileNameプロパティで読み出すことができます。</p>
<p>　add()メソッドの戻り値は新規に作成されたdocumentオブジェクトになります。</p>
<table>
<caption>【表】パラメーターの順番と意味</caption>
<tbody>
<tr>
  <td>
    <span>順番</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>1</td>
  <td>横幅。UnitValue形式で指定。</td>
</tr>
<tr>
  <td>2</td>
  <td>縦幅。UnitValue形式で指定。</td>
</tr>
<tr>
  <td>3</td>
  <td>解像度</td>
</tr>
<tr>
  <td>4</td>
  <td>ドキュメント名</td>
</tr>
<tr>
  <td>5</td>
  <td>カラーモード（【表】カラーモードを参照）</td>
</tr>
<tr>
  <td>6</td>
  <td>初期のカンバスカラー（【表】カンバスカラーを参照）</td>
</tr>
<tr>
  <td>7</td>
  <td>ピクセルの縦横比。0.1～10.00。</td>
</tr>
<tr>
  <td>8</td>
  <td>色深度（【表】色深度を参照）</td>
</tr>
<tr>
  <td>9</td>
  <td>カラープロファイル名</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】カラーモード</caption>
<tbody>
<tr>
  <td>
    <span>カラーモード</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>NewDocumentMode.BITMAP</td>
  <td>モノクロ2階調／白黒</td>
</tr>
<tr>
  <td>NewDocumentMode.CMYK</td>
  <td>CMYKカラー</td>
</tr>
<tr>
  <td>NewDocumentMode.GRAYSCALE</td>
  <td>グレースケールカラー</td>
</tr>
<tr>
  <td>NewDocumentMode.LAB</td>
  <td>Labカラー</td>
</tr>
<tr>
  <td>NewDocumentMode.RGB</td>
  <td>RGBカラー</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】カンバスカラー</caption>
<tbody>
<tr>
  <td>
    <span>カンバスカラー</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>DocumentFill.BACKGROUNDCOLOR</td>
  <td>背景色</td>
</tr>
<tr>
  <td>DocumentFill.TRANSPARENT</td>
  <td>透明</td>
</tr>
<tr>
  <td>DocumentFill.WHITE</td>
  <td>白色</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】色深度</caption>
<tbody>
<tr>
  <td>
    <span>色深度</span>
  </td>
  <td>
    <span>ビット</span>
  </td>
</tr>
<tr>
  <td>BitsPerChannelType.ONE</td>
  <td>1ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.EIGHT</td>
  <td>8ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.SIXTEEN</td>
  <td>16ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.THIRTYTWO</td>
  <td>32ビット</td>
</tr>
</tbody>
</table>
<p>【sample】新規にドキュメントを作成する</p>
<pre><code>// 新規にドキュメントを作成する
var docObj = app.documents.add(
    UnitValue(320, "px"),   // 横幅
    UnitValue(240, "px"),   // 縦幅
    300,    // 300dpi
    "サンプル", // ドキュメント名
    NewDocumentMode.RGB,    //カラーモード
    DocumentFill.TRANSPARENT,   // 背景は透明
    1.0,    // 縦横比
    BitsPerChannelType.THIRTYTWO,    // 32bit色深度
    "sRGB IEC61966-2.1"   // カラープロファイルは「sRGB」
);</code></pre>
<p>　指定されたパラメーターに応じて新規にドキュメントが作成されます。</p>
<figure>
<figcaption>【図】指定されたパラメーターに応じて新規にドキュメントが作成される</figcaption>
<img src="images/00214.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-694">
<section>
<h2 id="calibre_link-83"><b>3-2　ドキュメント数を求める</b></h2>
<p>　開かれているドキュメント数を求めるにはdocumentsオブジェクトの要素数を取得します。documentsオブジェクトには現在開かれているドキュメントの情報が配列形式で入っています。つまりdocuments.lengthとすることで開かれているドキュメント数を求めることができます。</p>
<p>【sample】ドキュメント数を求める</p>
<pre><code>//ドキュメント数を求める
var n = app.documents.length;
alert(n);</code></pre>
<p>　開かれているドキュメントの総数がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】2つのドキュメントが開かれている</figcaption>
<img src="images/00168.jpeg" />
</figure>
<figure>
<figcaption>【図】開かれているドキュメントの総数が表示される</figcaption>
<img src="images/00482.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-511">
<section>
<h2 id="calibre_link-84"><b>3-3　ドキュメント名を求める</b></h2>
<p>　ドキュメント名を求めるにはdocumentオブジェクトのnameプロパティを参照します。アクティブになっているドキュメント名はactiveDocument.nameとして取得することができます。また、開かれているドキュメントが複数あり、それらの名前を取得したい場合はdocumentsオブジェクト（配列）を参照します。documents[1].nameのようにdocuments[ ]の数値（添え字、参照番号）を変更することで開かれているドキュメントの名前を取得することができます。</p>
<p>【sample】ドキュメント名を求める</p>
<pre><code>// ドキュメント名を求める
var docName = app.activeDocument.name;
alert(docName);</code></pre>
<p>　アクティブになっているドキュメントの名前がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】アクティブなドキュメントの名前が表示される</figcaption>
<img src="images/00354.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-639">
<section>
<h2 id="calibre_link-85"><b>3-4　ドキュメントのパスを求める</b></h2>
<p>　ドキュメントのパスを求めるにはdocumentオブジェクトのpathプロパティを参照します。pathプロパティにはfileオブジェクトが格納されているためfileオブジェクトのメソッドやプロパティを利用することができます。</p>
<p>【sample】ドキュメントのパスを求める</p>
<pre><code>// ドキュメントのパスを求める
var fileObj = app.activeDocument.path;
alert(fileObj.path+"\n"+fileObj.fullName);</code></pre>
<p>　アクティブになっているドキュメントのパスがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】アクティブなドキュメントのパスがアラートダイアログに表示される</figcaption>
<img src="images/00109.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-425">
<section>
<h2 id="calibre_link-86"><b>3-5　ドキュメントの横幅と縦幅を求める</b></h2>
<p>　ドキュメントの横幅と縦幅を求めるにはdocumentオブジェクトのwidthプロパティとheightプロパティを参照します。widthプロパティ、heightプロパティともUnitValueオブジェクトとして値が格納されているため単位付きで返されます。単位なしで取得したい場合は読み出したUnitValueのvalueプロパティを参照します。また、単位変換したい場合はUnitValueオブジェクトのas()メソッドを使います。</p>
<table>
<caption>【表】UnitValueのas()メソッドに指定できる単位</caption>
<tbody>
<tr>
  <td>
    <span>指定値</span>
  </td>
  <td>
    <span>単位</span>
  </td>
</tr>
<tr>
  <td>in</td>
  <td>インチ</td>
</tr>
<tr>
  <td>ft</td>
  <td>フィート</td>
</tr>
<tr>
  <td>yd</td>
  <td>ヤード</td>
</tr>
<tr>
  <td>mi</td>
  <td>マイル</td>
</tr>
<tr>
  <td>mm</td>
  <td>ミリメートル</td>
</tr>
<tr>
  <td>cm</td>
  <td>センチメートル</td>
</tr>
<tr>
  <td>m</td>
  <td>メートル</td>
</tr>
<tr>
  <td>km</td>
  <td>キロメートル</td>
</tr>
<tr>
  <td>pt</td>
  <td>ポイント</td>
</tr>
<tr>
  <td>pc</td>
  <td>パイカ</td>
</tr>
<tr>
  <td>tpt</td>
  <td>ポイント（古いポイントの数値を基準にした値）</td>
</tr>
<tr>
  <td>tpc</td>
  <td>パイカ（古いパイカの数値を基準にした値）</td>
</tr>
<tr>
  <td>ci</td>
  <td>シセロ</td>
</tr>
<tr>
  <td>px</td>
  <td>ピクセル</td>
</tr>
<tr>
  <td>%</td>
  <td>パーセンテージ（割合／百分率）</td>
</tr>
</tbody>
</table>
<p>【sample】ドキュメントの横幅と縦幅を求める</p>
<pre><code>// ドキュメントの横幅と縦幅を求める
var docObj = app.activeDocument;
var wU = docObj.width;  // 単位付き横幅
var hU = docObj.height; // 単位付き縦幅
var w = docObj.width.value; // 単位なし横幅
var h = docObj.height.value;    // 単位なし縦幅
var wCM = docObj.width.as("cm");
var hCM = docObj.width.as("cm");
alert(wU+"×"+hU+"\n"+w+"×"+h+"\n"+wCM+"×"+hCM);</code></pre>
<p>　アクティブになっているドキュメントの横幅と縦幅がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】アクティブなドキュメントの横幅と縦幅が表示される</figcaption>
<img src="images/00165.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-582">
<section>
<h2 id="calibre_link-87"><b>3-6　ドキュメントのカラーモードを求める</b></h2>
<p>　ドキュメントのカラーモードを求めるにはdocumentオブジェクトのmodeプロパティを参照します。以下の表に示すカラーモードが返されます。</p>
<table>
<caption>【表】カラーモード</caption>
<tbody>
<tr>
  <td>
    <span>カラーモード</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>DocumentMode.BITMAP</td>
  <td>白黒</td>
</tr>
<tr>
  <td>DocumentMode.CMYK</td>
  <td>CMYKカラー</td>
</tr>
<tr>
  <td>DocumentMode.DUOTONE</td>
  <td>ダブルトーン</td>
</tr>
<tr>
  <td>DocumentMode.GRAYSCALE</td>
  <td>グレースケール</td>
</tr>
<tr>
  <td>DocumentMode.INDEXEDCOLOR</td>
  <td>インデックスカラー</td>
</tr>
<tr>
  <td>DocumentMode.LAB</td>
  <td>Labカラー</td>
</tr>
<tr>
  <td>DocumentMode. MULTICHANNEL</td>
  <td>マルチチャンネル</td>
</tr>
<tr>
  <td>DocumentMode.RGB</td>
  <td>RGBカラー</td>
</tr>
</tbody>
</table>
<p>【sample】ドキュメントのカラーモードを求める</p>
<pre><code>// ドキュメントのカラーモードを求める
var cMode = app.activeDocument.mode;
alert(cMode);</code></pre>
<p>　アクティブになっているドキュメントのカラーモードがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】アクティブなドキュメントのカラーモードが表示される</figcaption>
<img src="images/00386.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-17">
<section>
<h2 id="calibre_link-88"><b>3-7　ドキュメントの色深度を求める</b></h2>
<p>　ドキュメントの色深度を求めるにはdocumentオブジェクトのbitsPerChannelプロパティを参照します。色深度に応じて表に示す値が返されます。</p>
<table>
<caption>【表】色深度を示す値</caption>
<tbody>
<tr>
  <td>
    <span>値</span>
  </td>
  <td>
    <span>ビット</span>
  </td>
</tr>
<tr>
  <td>BitsPerChannelType. ONE</td>
  <td>1ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.EIGHT</td>
  <td>8ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.SIXTEEN</td>
  <td>16ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.THIRTYTWO</td>
  <td>32ビット</td>
</tr>
</tbody>
</table>
<p>【sample】ドキュメントの色深度を求める</p>
<pre><code>// ドキュメントの色深度を求める
var depth = app.activeDocument.bitsPerChannel;
alert(depth);</code></pre>
<p>　ドキュメントの色深度がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】ドキュメントの色深度が表示される</figcaption>
<img src="images/00519.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-524">
<section>
<h2 id="calibre_link-89"><b>3-8　ドキュメントのカラープロファイル名を求める</b></h2>
<p>　ドキュメントのカラープロファイル名を求めるにはdocumentオブジェクトのcolorProfileNameプロパティを参照します。colorProfileNameプロパティはdocumentオブジェクトのcolorProfileTypeプロパティの内容がColorProfileType&gt;CUSTOMまたはColorProfileType.WORKINGの場合に有効になります。</p>
<p>【sample】ドキュメントのカラープロファイル名を求める</p>
<pre><code>// カラープロファイル名を求める
var colName = app.activeDocument.colorProfileName;
var colType = app.activeDocument.colorProfileType;
alert(colType+"\n"+colName);</code></pre>
<p>　アクティブになっているドキュメントのカラープロファイルの種類と名前がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】アクティブなドキュメントのカラープロファイルの種類と名前が表示される</figcaption>
<img src="images/00154.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-52">
<section>
<h2 id="calibre_link-90"><b>3-9　ドキュメントが保存済みかどうか調べる</b></h2>
<p>　ドキュメントが保存済みかどうか調べるにはdocumentオブジェクトのsavedプロパティを参照します。savedプロパティがtrueの場合は保存済み、falseの場合は保存されていないことになります。</p>
<p>【sample】ドキュメントが保存済みかどうか調べる</p>
<pre><code>// ドキュメントが保存済みかどうか調べる
var flag = app.activeDocument.saved;
if(flag === true){
    alert("保存済みです");
}else{
    alert("保存されていません");
}</code></pre>
<p>　ドキュメントが保存されていない場合は図のようなメッセージがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】ドキュメントが保存されていない場合のメッセージ</figcaption>
<img src="images/00147.jpeg" />
</figure>
<p>　保存済みの場合は図のようなメッセージがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】保存済みの場合のメッセージ</figcaption>
<img src="images/00024.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-467">
<section>
<h2 id="calibre_link-91"><b>3-10　ピクセルの縦横比を求める／設定する</b></h2>
<p>　ピクセルの縦横比を求めるにはdocumentオブジェクトのpixelAspectRatioプロパティを参照します。縦横比を示す0.1～10.0までの数値が返されます。縦横比は1.0の場合、正方形ピクセルとなります。</p>
<p>　また、縦横比を設定する場合はpixelAspectRatioプロパティに0.1～10.0までの数値を設定します。</p>
<p>【sample】ピクセルの縦横比を求める／設定する</p>
<pre><code>// ピクセルの縦横比を求める／設定する
var ratio = app.activeDocument.pixelAspectRatio;
alert(ratio);
// 縦横比を1.0にする
app.activeDocument.pixelAspectRatio = 1.0;
var ratio = app.activeDocument.pixelAspectRatio;
alert(ratio);</code></pre>
<p>　アクティブになっているドキュメントの縦横比がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】アクティブなドキュメントの縦横比が表示される</figcaption>
<img src="images/00440.jpeg" />
</figure>
<p>　縦横比が設定されると表示されている画像が変わり、その後アラートダイアログに縦横比が表示されます（表示メニューでピクセルの縦横比を確認にチェックが入っていない場合は画像は変化しません）。</p>
<figure>
<figcaption>【図】縦横比が設定されると画像が変わり、縦横比が表示される</figcaption>
<img src="images/00557.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-485">
<section>
<h2 id="calibre_link-92"><b>3-11　クイックマスクモードかどうか調べる</b></h2>
<p>　クイックマスクモードかどうか調べるにはdocumentオブジェクトのquickMaskModeプロパティを参照します。quickMaskModeプロパティがtrueの場合はクイックマスクモードになっています。falseの場合はクイックマスクモードになっていません。また、quickMaskModeにfalseを設定することでクイックマスクモードを解除することができます。逆にtrueを設定すればクイックマスクモードになります。</p>
<p>【sample】クイックマスクモードかどうか調べる</p>
<pre><code>// クイックマスクモードかどうか調べる
var flag = app.activeDocument.quickMaskMode;
if(flag === true){
    alert("クイックマスクモードです");
}else{
    alert("クイックマスクモードではありません");
}</code></pre>
<p>　ドキュメントがクイックマスクモードの場合は図のようなメッセージがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】ドキュメントがクイックマスクモードの場合</figcaption>
<img src="images/00042.jpeg" />
</figure>
<p>　クイックマスクモードになっていない場合は図のようなメッセージがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】クイックマスクモードになっていない場合</figcaption>
<img src="images/00191.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-415">
<section>
<h2 id="calibre_link-93"><b>3-12　ドキュメント情報を求める</b></h2>
<p>　ドキュメント情報を求めるにはdocumentsオブジェクトのinfoオブジェクトの各プロパティを参照します。以下の表に示すプロパティがあります。これらのプロパティはファイルメニューの「ファイル情報...」で表示されるダイアログに入力されている項目になります。</p>
<table>
<caption>【表】ドキュメント情報のプロパティ</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>author</td>
  <td>作成者</td>
</tr>
<tr>
  <td>authorPosition</td>
  <td>作成者の役職</td>
</tr>
<tr>
  <td>caption</td>
  <td>説明</td>
</tr>
<tr>
  <td>captionWriter</td>
  <td>説明記入者</td>
</tr>
<tr>
  <td>category</td>
  <td>カテゴリ</td>
</tr>
<tr>
  <td>city</td>
  <td>市町村名</td>
</tr>
<tr>
  <td>copyrighted</td>
  <td>著作権のステータス（【表】著作権の種類を参照）</td>
</tr>
<tr>
  <td>copyrightNotice</td>
  <td>著作権情報</td>
</tr>
<tr>
  <td>country</td>
  <td>国名</td>
</tr>
<tr>
  <td>creationDate</td>
  <td>作成日</td>
</tr>
<tr>
  <td>credit</td>
  <td>クレジット／認証</td>
</tr>
<tr>
  <td>exif</td>
  <td>EXIF（撮影時情報）を格納している配列</td>
</tr>
<tr>
  <td>headline</td>
  <td>ヘッドライン</td>
</tr>
<tr>
  <td>instructions</td>
  <td>説明（IPTCステータス）</td>
</tr>
<tr>
  <td>jobName</td>
  <td>ジョブ名</td>
</tr>
<tr>
  <td>keywords</td>
  <td>キーワード</td>
</tr>
<tr>
  <td>ownerUrl</td>
  <td>著作権情報URL</td>
</tr>
<tr>
  <td>parent</td>
  <td>親オブジェクト。documentオブジェクトを示す。</td>
</tr>
<tr>
  <td>provinceState</td>
  <td>都道府県名</td>
</tr>
<tr>
  <td>source</td>
  <td>所有者又は著作権保有者</td>
</tr>
<tr>
  <td>supplementalCategories</td>
  <td>補足カテゴリ</td>
</tr>
<tr>
  <td>title</td>
  <td>ドキュメントタイトル</td>
</tr>
<tr>
  <td>transmissionReference</td>
  <td>ジョブ識別子</td>
</tr>
<tr>
  <td>urgency</td>
  <td>重要度（【表】重要度を参照）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】著作権の種類</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>CopyrightedType.COPYRIGHTEDWORK</td>
  <td>著作権取得済み</td>
</tr>
<tr>
  <td>CopyrightedType.PUBLICDOMAIN</td>
  <td>著作権フリー</td>
</tr>
<tr>
  <td>CopyrightedType.UNMARKED</td>
  <td>不明</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】重要度</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Urgency.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Urgency.HIGH</td>
  <td>高</td>
</tr>
<tr>
  <td>Urgency.TWO</td>
  <td>2</td>
</tr>
<tr>
  <td>Urgency.THREE</td>
  <td>3</td>
</tr>
<tr>
  <td>Urgency.FOUR</td>
  <td>4</td>
</tr>
<tr>
  <td>Urgency.NORMAL</td>
  <td>標準</td>
</tr>
<tr>
  <td>Urgency.SIX</td>
  <td>6</td>
</tr>
<tr>
  <td>Urgency.SEVEN</td>
  <td>7</td>
</tr>
<tr>
  <td>Urgency.LOW</td>
  <td>低</td>
</tr>
</tbody>
</table>
<p>【sample】ドキュメント情報を求める</p>
<pre><code>// ドキュメント情報を求める
var docInfo = app.activeDocument.info;
alert(
    "作　者 : "+docInfo.author+"\n"+
    "作成日："+docInfo.creationDate+"\n"+
    "タイトル："+docInfo.title
);</code></pre>
<p>　ドキュメント情報がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】ドキュメント情報が表示される</figcaption>
<img src="images/00163.jpeg" />
</figure>
<p>　主なドキュメント情報は図のようになっています。</p>
<figure>
<figcaption>【図】主なドキュメント情報</figcaption>
<img src="images/00577.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-573">
<section>
<h2 id="calibre_link-94"><b>3-13　ドキュメントを閉じる</b></h2>
<p>　ドキュメントを閉じるにはdocumentオブジェクトのclose()メソッドを使います。close()メソッドのパラメーターには以下の表に示すドキュメントの処理方法を指定します。なお、close()メソッドのパラメーターは省略することができます。省略した場合、SaveOptionsType.PROMPTTOSAVECHANGESを指定したものとして処理されます。</p>
<table>
<caption>【表】処理方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>SaveOptions.DONOTSAVECHANGES</td>
  <td>保存しない</td>
</tr>
<tr>
  <td>SaveOptions.SAVECHANGES</td>
  <td>保存する</td>
</tr>
<tr>
  <td>SaveOptions.PROMPTTOSAVECHANGES</td>
  <td>ダイアログを表示してユーザーに確認する</td>
</tr>
</tbody>
</table>
<p>【sample】ドキュメントを閉じる</p>
<pre><code>// ドキュメントを閉じる
app.activeDocument.close(SaveOptions.DONOTSAVECHANGES); // 変更を保存しない</code></pre>
<p>　保存されていないドキュメントがありますが、スクリプトを実行すると保存せず強制的に閉じられます。</p>
<figure>
<figcaption>【図1】スクリプトを実行すると保存せず強制的に閉じられる</figcaption>
<img src="images/00123.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-8">
<section>
<h2 id="calibre_link-95"><b>3-14　ドキュメントを保存する</b></h2>
<p>　ドキュメントを保存するにはdocumentオブジェクトのsave()メソッドを使います。save()メソッドのパラメーターはありません。すでに保存済みの場合でもエラーにはなりません。</p>
<p>【sample】ドキュメントを保存する</p>
<pre><code>// ドキュメントを保存する
app.activeDocument.save();</code></pre>
<p>　保存されていないドキュメントがあります。</p>
<figure>
<figcaption>【図】保存されていないドキュメントがある</figcaption>
<img src="images/00113.jpeg" />
</figure>
<p>スクリプトを実行するとドキュメントが保存される</p>
<figure>
<figcaption>【図】スクリプトを実行するとドキュメントが保存される</figcaption>
<img src="images/00224.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-513">
<section>
<h2 id="calibre_link-96"><b>3-15　ドキュメントを別名で保存する</b></h2>
<p>　ドキュメントを別名で保存するにはdocumentオブジェクトのsaveAs()メソッドを使います。saveAs()メソッドにはいくつかパラメーターがあり、「【表】保存パラメーター」のようになっています。また、2番目以降のパラメーターは省略することができます。異なる画像形式で保存する場合については「第13章　ファイル保存」を参照してください。</p>
<table>
<caption>【表】保存パラメーター</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>保存する情報を持ったファイルオブジェクト</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>オプション（画像形式によって異なる）</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>コピーを保存するかどうか（true：する、false：しない）</td>
</tr>
<tr>
  <td>4番目のパラメーター</td>
  <td>拡張子の指定（【表】拡張子の指定を参照）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】拡張子の指定</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>変更なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】ドキュメントを別名で保存する</p>
<pre><code>// ドキュメントを別名で保存する
var fileObj = new File("～/Desktop/上高地.psd");
app.activeDocument.saveAs(fileObj);</code></pre>
<p>　ドキュメントがあります。</p>
<figure>
<figcaption>【図】ドキュメントがある</figcaption>
<img src="images/00303.jpeg" />
</figure>
<p>　スクリプトを実行すると別名でドキュメントが保存されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると別名でドキュメントが保存される</figcaption>
<img src="images/00495.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-700">
<section>
<h2 id="calibre_link-97"><b>3-16　1枚だけ印刷する</b></h2>
<p>　ドキュメントを1枚だけ印刷するにはdocumentオブジェクトのprintOneCopy()メソッドを使います。printOneCopy()メソッドにはパラメーターはありません。また、直前に設定された印刷情報にもとづいて処理される点には注意が必要です。</p>
<p>【sample】1枚だけ印刷する</p>
<pre><code>// 1枚だけ印刷する
app.activeDocument.printOneCopy();</code></pre>
<p>　ドキュメントがあります。スクリプトを実行すると1枚だけ印刷されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると1枚だけ印刷される</figcaption>
<img src="images/00632.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-410">
<section>
<h2 id="calibre_link-98"><b>3-17　印刷する／印刷設定を行う</b></h2>
<p>　ドキュメントを印刷するにはdocumentオブジェクトのprint()メソッドかprintOneCopy()メソッドを使います。printOneCopy()メソッドにはパラメーターはありません。print()メソッドはエラーで動作しないことがあり、その場合は印刷設定を行った後にprintOneCopy()メソッドを使って印刷を行います。printOneCopy()メソッドを使用した場合、印刷枚数の設定は1になるので、数枚必要な場合はfor命令を使って繰り返し処理します。</p>
<p>　print()メソッドには「【表】print()メソッドのパラメーター」に示す4つのパラメーターがあります。また、印刷設定を行う場合はdocumentオブジェクトのprintSettingsオブジェクトの各プロパティに値を設定します。設定できる値を「【表】印刷設定可能なパラメーター」にします。なお、プリンタによっては必ずしも全ての設定が反映されるとは限らないので注意が必要です。</p>
<table>
<caption>【表】print()メソッドのパラメーター</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>ドキュメントの色空間／カラースペースの指定（【表】ドキュメントの色空間／カラースペースの指定を参照）</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>印刷時の色空間を示す名前</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>マッチング方法（【表】黒点の補正を参照）</td>
</tr>
<tr>
  <td>4番目のパラメーター</td>
  <td>黒点の補正。（true：補正する、false：補正しない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】ドキュメントの色空間／カラースペースの指定</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>SourceSpaceType.DOCUMENT</td>
  <td>通常プリント</td>
</tr>
<tr>
  <td>SourceSpaceType.PROOF</td>
  <td>ハードプルーフ</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】黒点の補正</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Intent.ABSOLUTECOLORIMETRIC</td>
  <td>絶対的な色域を維持</td>
</tr>
<tr>
  <td>Intent.RELATIVECOLORIMETRIC</td>
  <td>相対的な色域を維持</td>
</tr>
<tr>
  <td>Intent.PERCEPTUAL</td>
  <td>知覚的</td>
</tr>
<tr>
  <td>Intent.SATURATION</td>
  <td>彩度</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】印刷設定可能なパラメーター</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>backgroundColor</td>
  <td>背景色。SolidColorオブジェクトを指定。</td>
</tr>
<tr>
  <td>bleedWidth</td>
  <td>裁ち落とし幅。UnitValue形式で指定。</td>
</tr>
<tr>
  <td>caption</td>
  <td>キャプション（true：あり、false：なし）</td>
</tr>
<tr>
  <td>centerCropMarks</td>
  <td>センタートンボ（true：あり、false：なし）</td>
</tr>
<tr>
  <td>colorBars</td>
  <td>カラーバー（true：あり、false：なし）</td>
</tr>
<tr>
  <td>copies</td>
  <td>印刷枚数</td>
</tr>
<tr>
  <td>cornerCropMarks</td>
  <td>コーナートンボ（true：あり、false：なし）</td>
</tr>
<tr>
  <td>colorHandling</td>
  <td>カラーマネジメント（【表】カラーマネジメントを参照）</td>
</tr>
<tr>
  <td>activePrinter</td>
  <td>アクティブプリンタ名を文字列で指定</td>
</tr>
<tr>
  <td>flip</td>
  <td>左右反転（true：あり、false：なし）</td>
</tr>
<tr>
  <td>hardProof</td>
  <td>ハードプルーフ（校正刷り）（true：する、false：しない）</td>
</tr>
<tr>
  <td>interpolate</td>
  <td>不明（trueかfalseを指定）</td>
</tr>
<tr>
  <td>labels</td>
  <td>ラベル（true：あり、false：なし）</td>
</tr>
<tr>
  <td>mapBlack</td>
  <td>黒点の補正（true：行う、false：行わない）</td>
</tr>
<tr>
  <td>negative</td>
  <td>ネガ出力（true：する、false：しない）</td>
</tr>
<tr>
  <td>renderIntent</td>
  <td>マッチング方法（【表】黒点の補正を参照）</td>
</tr>
<tr>
  <td>posX</td>
  <td>印刷位置（左からの距離）をUnitValue形式で指定</td>
</tr>
<tr>
  <td>posY</td>
  <td>印刷位置（上からの距離）をUnitValue形式で指定</td>
</tr>
<tr>
  <td>printBorder</td>
  <td>枠線をUnitValue形式で指定</td>
</tr>
<tr>
  <td>printerName</td>
  <td>プリンタ名を文字列で指定</td>
</tr>
<tr>
  <td>printSpace</td>
  <td>カラースペース名を文字列で指定</td>
</tr>
<tr>
  <td>registrationMarks</td>
  <td>レジストレーションマーク（true：あり、false：なし）</td>
</tr>
<tr>
  <td>scale</td>
  <td>印刷スケール</td>
</tr>
<tr>
  <td>vectorData</td>
  <td>ベクトルデータ（true：含む、false：含まない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】カラーマネジメント</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>PrintColorHandling.PRINTERMANAGED</td>
  <td>プリンタによるカラー管理</td>
</tr>
<tr>
  <td>PrintColorHandling.PHOTOSHOPMANAGED</td>
  <td>Photoshopによるカラー管理</td>
</tr>
<tr>
  <td>PrintColorHandling.SEPARATIONS</td>
  <td>色分解</td>
</tr>
</tbody>
</table>
<p>【sample】印刷する／印刷設定を行う</p>
<pre><code>// 印刷する
// 最初に印刷設定を行う
var ps = app.activeDocument.printSettings;
var bgColor = new SolidColor();  // 背景色は白にする
bgColor.rgb.red = 255;
bgColor.rgb.green = 255;
bgColor.rgb.blue = 255;
ps.backgroundColor = bgColor;   // 背景色の設定
ps.bleedWidth = UnitValue("0mm");   // 裁ち落とし
ps.caption  = false;    // キャプションなし
ps.centerCropMarks = false;  // センタートンボなし
ps.colorBars = true;    // カラーバーあり
ps.copies = 1;  // 印刷枚数
ps.cornerCropMarks = false; // コーナートンボなし
ps.colorHandling = PrintColorHandling.PHOTOSHOPMANAGED; // Photoshopによるカラー管理
//ps.activePrinter = "EPSON PX-1004"; // アクティブプリンタ名
ps.flip = false;    // 左右反転しない
ps.hardProof = false;   // ハードプルーフ（校正刷り）なし
ps.interpolate = true; // 
ps.labels = false;  // ラベルは印刷しない
ps.mapBlack = true; // 黒点の補正を行う
ps.negative = false;    // ネガ出力しない
ps.renderIntent = Intent.PERCEPTUAL; // マッチング方法は知覚的
ps.posX = UnitValue("0mm"); // 印刷位置（左からの距離）
ps.posY = UnitValue("0mm"); // 印刷位置（上からの距離）
ps.printBorder = UnitValue("0mm");  // 枠線
ps.printerName = "EPSON PX-1004";   // プリンタ名
ps.printSpace = "sRGB IEC61966-2.1"; // カラースペース名
ps.registrationMarks = false;   // レジストレーションマーク
ps.scale = 100; // スケール
ps.vectorData = false;  // ベクトルデータは含まない
// 印刷処理。print()が動かない場合はprintOneCopy()を使う
app.activeDocument.printOneCopy();</code></pre>
<p>　ドキュメントがあります。スクリプトを実行すると指定した設定で印刷されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると指定した設定で印刷される</figcaption>
<img src="images/00333.jpeg" />
</figure>
<p>　スクリプトで設定した内容は、そのまま印刷設定として残った状態になります。</p>
<figure>
<figcaption>【図】スクリプトで設定した内容は、印刷設定として残る</figcaption>
<img src="images/00019.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-607">
<section>
<h2 id="calibre_link-99"><b>3-18　取り消し（アンドゥ）／再実行（リドゥ）処理を行う</b></h2>
<p>　取り消し（アンドゥ）処理を行うにはexecuteAction()メソッドを使います。executeAction()メソッドの最初のパラメーターには取り消しを示すUndo機能を示すcharIDToTypeID("undo")を指定します。charIDToTypeID()メソッドに指定する文字列についてはPhotoshopのScripting Reference.pdfの付録Event ID Codesを参照してください。</p>
<p>　executeAction()メソッドの2番目のパラメーターにはundefinedを指定します。""やnullを指定するとエラーになるので必ずundefinedを指定してください。executeAction()メソッドの3番目のパラメーターにはDialogModes.NOを指定します。</p>
<p>　なお、この手法では実行するたびに取り消し（アンドゥ）と再実行（リドゥ）を繰り返すことになります。</p>
<p>【sample】取り消し（アンドゥ）／再実行（リドゥ）処理を行う</p>
<pre><code>// 取り消し（アンドゥ）
executeAction(charIDToTypeID("undo"), undefined, DialogModes.NO);</code></pre>
<p>　文字を入力後、文字を移動させた画像があります。</p>
<figure>
<figcaption>【図】文字を入力し、移動させた画像</figcaption>
<img src="images/00398.jpeg" />
</figure>
<p>　スクリプトを実行すると直前に行った処理が取り消され文字の位置が1つ前の状態になります。</p>
<figure>
<figcaption>【図】直前に行った処理が取り消され文字の位置が1つ前の状態になる</figcaption>
<img src="images/00208.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-9">
<section>
<h2 id="calibre_link-100"><b>3-19　すでに開かれているドキュメント全体に対して処理を行う</b></h2>
<p>　すでに開かれているドキュメント全体に対して処理を行うにはdocuments配列の数だけ繰り返し処理します。documents配列にはdocumentオブジェクトが入っています。処理によりますが、処理対象にするドキュメントをアクティブにしないとエラーになることがあります。</p>
<p>【sample】すでに開かれているドキュメント全体に対して処理を行う</p>
<pre><code>// 全てのドキュメントの右下に文字を入れる
for(var i=0; i&lt;app.documents.length; i++){
    var docObj = app.documents[i];
    app.activeDocument = docObj;    // アクティブにしないと動作しない機能があるため
    var layObj = docObj.artLayers.add(); // 新規レイヤーを追加
    layObj.kind = LayerKind.TEXT;
    layObj.textItem.font = "Times-Bold";    // フォント
    layObj.textItem.size = UnitValue("18pt");   // 文字サイズ
    layObj.textItem.justification = Justification.RIGHT;    // 右よせ
    layObj.textItem.color = setColor(255, 0, 0);    // 赤色
    layObj.textItem.contents = "(c) 2015 K.F";  // 表示する文字
    var w = docObj.width;  // ドキュメントの横幅
    var h = docObj.height; // ドキュメントの縦幅
    var x = layObj.bounds[2];   // 右座標
    var y = layObj.bounds[3];   // 下座標
    layObj.translate(UnitValue(w-x-10, "px"), UnitValue(h-y-5, "px"));   // 右下に移動
}
// 指定された色を返す関数
function setColor(r, g, b){
    var color = new SolidColor();
    color.rgb.red = r;
    color.rgb.green = g;
    color.rgb.blue = b;
    return color;
}</code></pre>
<p>　3つのドキュメントがあります。</p>
<figure>
<figcaption>【図】3つのドキュメント</figcaption>
<img src="images/00025.jpeg" />
</figure>
<p>　スクリプトを実行すると全てのドキュメントにテキストレイヤーが追加され、右下に文字が表示されます。</p>
<figure>
<figcaption>【図】全てのドキュメントにテキストレイヤーが追加され、右下に文字が表示される</figcaption>
<img src="images/00390.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-492">
<section>
<div>
<h1 id="calibre_link-101"><b>第4章　画像／イメージ</b></h1>
</div>
</section>
</div>
<div id="calibre_link-670">
<section>
<h2 id="calibre_link-102"><b>4-1　画像のサイズや解像度を変更する</b></h2>
<p>　画像のサイズや解像度を変更するにはdocumentオブジェクトのresizeImage()メソッドを使います。最初のパラメーターには横幅を、2番目のパラメーターには縦幅をUnitValue形式で指定します。3番目のパラメーターは解像度を指定します。4番目のパラメーターは画像の補完方法を指定します。補完方法は以下の表に示す値を指定できます。5番目のパラメーターはノイズ量で0～100までの数値になります。resizeImage()メソッドは全てのパラメーターを省略することができます。</p>
<p>　画像サイズでなく解像度のみを変更したい場合はresizeImage(undefined, undefined, 300, ResampleMethod.NONE)のように指定します。</p>
<table>
<caption>【表】補完方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>ResampleMethod.BICUBIC</td>
  <td>バイキュービック法（滑らかなグラデーションに最適）</td>
</tr>
<tr>
  <td>ResampleMethod.BICUBICAUTOMATIC</td>
  <td>バイキュービック自動</td>
</tr>
<tr>
  <td>ResampleMethod.BICUBICSHARPER</td>
  <td>バイキュービック法 - シャープ（縮小に最適）</td>
</tr>
<tr>
  <td>ResampleMethod.BICUBICSMOOTHER</td>
  <td>バイキュービック法 - 滑らか（拡大に最適）</td>
</tr>
<tr>
  <td>ResampleMethod.BILINEAR</td>
  <td>バイリニア法</td>
</tr>
<tr>
  <td>ResampleMethod.NEARESTNEIGHBOR</td>
  <td>ニアレストネイバー法（ハードな輪郭を維持）</td>
</tr>
<tr>
  <td>ResampleMethod.NONE</td>
  <td>なし</td>
</tr>
</tbody>
</table>
<p>【sample】画像のサイズや解像度を変更する</p>
<pre><code>// 画像のサイズを変更する
app.activeDocument.resizeImage(
    UnitValue("100px"), // 横幅100px
    UnitValue("80px"), // 縦幅 80px
    300, // 解像度
    ResampleMethod.BICUBICAUTOMATIC,  // 自動
    100
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図1】スクリプトを実行する前の状態</figcaption>
<img src="images/00157.jpeg" />
</figure>
<p>　画像のサイズや解像度が変更されます。</p>
<figure>
<figcaption>【図2】画像のサイズや解像度が変更される</figcaption>
<img src="images/00436.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-48">
<section>
<h2 id="calibre_link-103"><b>4-2　カンバスサイズを変更する</b></h2>
<p>　カンバスサイズを変更するにはdocumentオブジェクトのresizeCanvas()メソッドを使います。最初のパラメーターには横幅を、2番目のパラメーターには縦幅をUnitValue形式で指定します。3番目のパラメーターは基準位置（アンカーポイント）で以下の表に示す位置を指定できます。なお、resizeCanvas()メソッドのパラメーターは全て省略することができます。</p>
<p>　カンバスを拡大した場合、余白部分は背景色になるため、必要であればapp.backgroundColorプロパティにカラーを設定してください。</p>
<table>
<caption>【表】基準位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMCENTER</td>
  <td>中央下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMLEFT</td>
  <td>左下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMRIGHT</td>
  <td>右下</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLECENTER</td>
  <td>中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLELEFT</td>
  <td>左中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLERIGHT</td>
  <td>右中央</td>
</tr>
<tr>
  <td>AnchorPosition.TOPCENTER</td>
  <td>中央上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPLEFT</td>
  <td>左上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPRIGHT</td>
  <td>右上</td>
</tr>
</tbody>
</table>
<p>【sample】カンバスサイズを変更する</p>
<pre><code>// カンバスサイズを変更する
app.activeDocument.resizeCanvas(
    UnitValue("480px"), // 横幅480px
    UnitValue("280px"), // 縦幅 280px
    AnchorPosition.TOPLEFT   // 左上基準
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図1】スクリプトを実行する前の状態</figcaption>
<img src="images/00611.jpeg" />
</figure>
<p>　カンバスサイズが変更されます。</p>
<figure>
<figcaption>【図2】カンバスサイズが変更される</figcaption>
<img src="images/00059.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-440">
<section>
<h2 id="calibre_link-104"><b>4-3　画像をトリミングする</b></h2>
<p>　画像をトリミングするにはdocumentオブジェクトのtrim()メソッドを使います。最初のパラメーターには表に示すトリミング対象カラーを指定します。2～5番目のパラメーターはトリミング対象にするかどうかをフラグで指定します。trueならトリミング対象にする、falseならトリミング対象になりません。2～5番目のパラメーターが示すトリミング対象位置は「上、左、下、右」の順番になっています。</p>
<p>　trim()メソッドのパラメーターは全て省略することができます。</p>
<table>
<caption>【表】トリミング対象カラー</caption>
<tbody>
<tr>
  <td>
    <span>パラーメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>TrimType.BOTTOMRIGHT</td>
  <td>右下のピクセルカラー</td>
</tr>
<tr>
  <td>TrimType.TOPLEFT</td>
  <td>左上のピクセルカラー</td>
</tr>
<tr>
  <td>TrimType.TRANSPARENT</td>
  <td>透明ピクセル</td>
</tr>
</tbody>
</table>
<p>【sample】画像をトリミングする</p>
<pre><code>// 画像をトリミングする
app.activeDocument.trim(
    TrimType.TRANSPARENT,   // 透明部分を切り抜く
    true,   // 上をトリミング対象にする
    true,   // 左をトリミング対象にする
    true,   // 下をトリミング対象にする
    true   // 右をトリミング対象にする
);</code></pre>
<p>　トリミングする前の状態です。</p>
<figure>
<figcaption>【図】トリミングする前の状態</figcaption>
<img src="images/00524.jpeg" />
</figure>
<p>　透明部分がトリミングされます。</p>
<figure>
<figcaption>【図】透明部分がトリミングされる</figcaption>
<img src="images/00092.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-483">
<section>
<h2 id="calibre_link-105"><b>4-4　全ての領域を表示する</b></h2>
<p>　全ての領域を表示するにはdocumentオブジェクトのrevealAll()メソッドを使います。revealAll()メソッドにはパラメーターはありません。</p>
<p>【sample】全ての領域を表示する</p>
<pre><code>// 全ての領域を表示する
app.activeDocument.revealAll();</code></pre>
<p>　スクリプトを実行する前の状態です。テキストの右側がはみだしています。</p>
<figure>
<figcaption>【図】スクリプトを実行する前はテキストの右側がはみだしている</figcaption>
<img src="images/00205.jpeg" />
</figure>
<p>　テキストが収まるようにカンバスサイズが変更されます。</p>
<figure>
<figcaption>【図】テキストが収まるようにカンバスサイズが変更される</figcaption>
<img src="images/00032.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-559">
<section>
<h2 id="calibre_link-106"><b>4-5　画像を統合（フラット化）する</b></h2>
<p>　画像を統合するにはdocumentオブジェクトのflatten()メソッドを使います。flatten()メソッドにはパラメーターはありません。</p>
<p>【sample】画像を統合（フラット化）する</p>
<pre><code>// 画像を統合する
app.activeDocument.flatten();</code></pre>
<p>　画像を統合する前の状態です。複数のレイヤーに分かれています。</p>
<figure>
<figcaption>【図】画像を統合する前は複数のレイヤーに分かれている</figcaption>
<img src="images/00471.jpeg" />
</figure>
<p>　画像が統合され1つの背景のみになります。</p>
<figure>
<figcaption>【図】画像が統合され1つの背景のみになる</figcaption>
<img src="images/00217.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-710">
<section>
<h2 id="calibre_link-107"><b>4-6　画像をペースト（貼り付け）する</b></h2>
<p>　画像をペーストするにはdocumentオブジェクトのpaste()メソッドを使います。paste()メソッドには指定できるパラメーターはありません。</p>
<p>【sample】画像をペースト（貼り付け）する</p>
<pre><code>// 画像をペーストする
app.activeDocument.paste();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00629.jpeg" />
</figure>
<p>　コピーしておいた画像がペースト（貼り付け）されます。</p>
<figure>
<figcaption>【図】コピーしておいた画像がペーストされる</figcaption>
<img src="images/00242.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-503">
<section>
<h2 id="calibre_link-108"><b>4-7　画像を回転させる</b></h2>
<p>　画像を回転させるにはdocumentオブジェクトのrotateCanvas()メソッドを使います。パラメーターには回転角度を指定します。正数を指定すると時計回りに回転します。負数を指定すると反時計回りに回転します。</p>
<p>【sample】画像を回転させる</p>
<pre><code>// 画像を回転させる
app.activeDocument.rotateCanvas(25);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00172.jpeg" />
</figure>
<p>　画像が時計回りに25度回転します。</p>
<figure>
<figcaption>【図】画像が時計回りに25度回転する</figcaption>
<img src="images/00513.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-656">
<section>
<h2 id="calibre_link-109"><b>4-8　画像を左右変転・上下反転させる</b></h2>
<p>　画像を左右変転・上下反転させるにはdocumentオブジェクトのflipCanvas()メソッドを使います。パラメーターには以下の表に示す反転方向を指定します。</p>
<table>
<caption>【表】反転方向</caption>
<tbody>
<tr>
  <td>
    <span>パラーメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Direction.HORIZONTAL</td>
  <td>左右反転</td>
</tr>
<tr>
  <td>Direction.VERTICAL</td>
  <td>上下反転</td>
</tr>
</tbody>
</table>
<p>【sample】画像を左右変転・上下反転させる</p>
<pre><code>// 画像を上下反転させる
app.activeDocument.flipCanvas(Direction.VERTICAL);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00005.jpeg" />
</figure>
<p>　画像が上下反転します。</p>
<figure>
<figcaption>【図】画像が上下反転する</figcaption>
<img src="images/00140.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-447">
<section>
<h2 id="calibre_link-110"><b>4-9　画像を切り抜く</b></h2>
<p>　画像を切り抜くにはdocumentオブジェクトのcrop()メソッドを使います。最初のパラメーターには配列形式で切り抜く画像の座標値をUnitValue形式で指定します。配列で指定する座標は[左, 上, 右, 下]の順序になります。crop()メソッドの2番目のパラメーターは角度になります。切り抜く角度を指定します。3番目のパラメーターは切り抜いた後の横幅をUnitvalue形式で指定します。4番目のパラメーターは切り抜いた後の縦幅をUnitvalue形式で指定します。なお、crop()メソッドは2番目以降のパラメーターは省略することができます。</p>
<p>【sample】画像を切り抜く</p>
<pre><code>// 画像を切り抜く
app.activeDocument.crop([
        UnitValue("20px"),
        UnitValue("30px"),
        UnitValue("250px"),
        UnitValue("180px")
    ],
    45,  // 45度でくり抜き
    UnitValue("300px"), // 横幅
    UnitValue("300px")  // 縦幅
);</code></pre>
<p>　切り抜く前の状態です。</p>
<figure>
<figcaption>【図】切り抜く前の状態</figcaption>
<img src="images/00541.jpeg" />
</figure>
<p>　指定した範囲が指定した角度で切り抜かれた後、指定したサイズに調整されます。</p>
<figure>
<figcaption>【図】指定した範囲が指定した角度で切り抜かれ、指定したサイズに調整される</figcaption>
<img src="images/00416.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-603">
<section>
<h2 id="calibre_link-111"><b>4-10　画像を複製する</b></h2>
<p>　画像を複製するにはdocumentオブジェクトのduplicate()メソッドを使います。最初のパラメーターには複製後のドキュメント名を指定します。2番目のパラメーターは複製時にレイヤーを統合するかどうかを指定します。trueなら統合する、falseなら統合しません。</p>
<p>　duplicate()メソッドのパラメーターは全て省略することができます。</p>
<p>【sample】画像を複製する</p>
<pre><code>// 画像を複製する
app.activeDocument.duplicate(
    "新富士山",
    true   // レイヤーを統合する
);</code></pre>
<p>　複製する前の状態です。</p>
<figure>
<figcaption>【図】複製する前の状態</figcaption>
<img src="images/00072.jpeg" />
</figure>
<p>　画像が複製されます。レイヤーは結合され1枚になります。</p>
<figure>
<figcaption>【図】画像が複製され、レイヤーは結合され1枚になる</figcaption>
<img src="images/00356.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-40">
<section>
<h2 id="calibre_link-112"><b>4-11　チャンネルを分割する</b></h2>
<p>　チャンネルを分割するにはdocumentオブジェクトのsplitChannels()メソッドを使います。パラメーターはありません。splitChannels()メソッドでチャンネルを分割すると、分割されたチャンネルの数だけdocumentオブジェクトが返されます。</p>
<p>【sample】チャンネルを分割する</p>
<pre><code>// チャンネルを分割する
var docList = app.activeDocument.splitChannels();
alert("チャンネルを"+docList.length + "個のドキュメントに分割しました");</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00565.jpeg" />
</figure>
<p>　チャンネルの数だけ分割され、新たなドキュメントが生成されます。生成された数がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】チャンネルの数で分割され、新たなドキュメントが生成される</figcaption>
<img src="images/00322.jpeg" />
</figure>
<figure>
<figcaption>【図】生成された数が表示される</figcaption>
<img src="images/00445.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-548">
<section>
<h2 id="calibre_link-113"><b>4-12　トラッピングを設定する</b></h2>
<p>　トラッピングを設定するにはdocumentオブジェクトのtrap()メソッドを使います。パラメーターにはトラッピング幅を指定します。単位はpxになります。UnitValue形式で指定しても単位は反映されません。</p>
<p>【sample】トラッピングを設定する</p>
<pre><code>// トラッピングを設定する
app.activeDocument.trap(2);</code></pre>
<p>　スクリプトを実行するとトラッピング幅が設定されます。トラッピング幅はイメージメニューの「トラッピング...」で確認できます。なお、単位はピクセルに設定しておきます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとトラッピング幅が設定される</figcaption>
<img src="images/00555.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-699">
<section>
<h2 id="calibre_link-114"><b>4-13　レイヤーをラスタライズする</b></h2>
<p>　レイヤーをラスタライズするにはdocumentオブジェクトのrasterizeAllLayers()メソッドを使います。ラスタライズするとベクトルデータのレイヤーはピクセルデータに変換されます。</p>
<p>【sample】レイヤーをラスタライズする</p>
<pre><code>// レイヤーをラスタライズする
app.activeDocument.rasterizeAllLayers();</code></pre>
<p>　レイヤーをラスタライズする前の状態です。</p>
<figure>
<figcaption>【図】レイヤーをラスタライズする前の状態</figcaption>
<img src="images/00075.jpeg" />
</figure>
<p>　テキストやシェイプレイヤーがラスタライズされます。</p>
<figure>
<figcaption>【図】テキストやシェイプレイヤーがラスタライズされる</figcaption>
<img src="images/00221.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-489">
<section>
<h2 id="calibre_link-115"><b>4-14　指定した位置と色で１ピクセル描画する</b></h2>
<p>　指定した位置と色で１ピクセル描画するには1ピクセル×1ピクセルの選択範囲を作成し、そこを塗り潰します。選択範囲の設定はselectionオブジェクトのselect()メソッドを使います。色の指定はSolidColorオブジェクトを利用します。サンプルでは1ピクセル描画するsetPixel関数を用意し、その関数に渡されたパラメーターに従って描画します。色を設定する関数はsetPixel関数内で定義し使用しています。関数内に関数を定義することで、不要なグローバルな関数名を使用せずにすみます。</p>
<p>　ここで説明した方法を使用した場合、ヒストリー項目が大量に増えてしまい古いヒストリーが消えてしまいます。これを回避するためにはサンプルのようにdocumentオブジェクトのsuspendHistory()メソッドを使います。なお、ロックされたレイヤーへの書き込みなどを行うとエラーになるので注意してください。また、場合によってはダイアログが表示されることがありますので、より確実に処理するならapp.displayDialogs = DialogModes.NO;を指定しておくとよいでしょう。</p>
<p>【sample】指定した位置と色で１ピクセル描画する</p>
<pre><code>// 指定した位置とカラーで１ピクセル描画する
app.activeDocument.suspendHistory("1pixel描画", "drawPixels()");
// 4つのピクセルを描画
function drawPixels(){
    setPixel(0, 0, 255, 0, 0);
    setPixel(15, 0, 255, 255, 0);
    setPixel(0, 15, 0, 255, 0);
    setPixel(15, 15, 0, 0, 255);
}
// 1ピクセルを指定した座標、指定した色で描く関数
function setPixel(x, y, r, g, b){
    var saveUnit = preferences.rulerUnits;
    preferences.rulerUnits = Units.PIXELS;  // 単位をピクセルに変更
    var region = [
        [x, y],  // XY座標(1)
        [x+1, y],  // XY座標(2)
        [x+1, y+1],  // XY座標(3)
        [x, y+1]  // XY座標(4)
    ];
    app.activeDocument.selection.select(region, SelectionType.REPLACE, 0, true);
    app.activeDocument.selection.fill(setColor(r, g, b));
    preferences.rulerUnits = saveUnit;  // 元の単位に戻す
    app.activeDocument.selection.deselect();
    // RGBカラーを設定しSolidColorオブジェクトを返す
    function setColor(r, g, b){
        var color = new SolidColor();
        color.rgb.red = r;
        color.rgb.green = g;
        color.rgb.blue = b;
        return color;
    }
}</code></pre>
<p>　スクリプトを実行する前の状態です。画像は16×16ピクセルで拡大表示してあります。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00195.jpeg" />
</figure>
<p>　四隅に指定した色で1ピクセル描画されます。</p>
<figure>
<figcaption>【図】四隅に指定した色で1ピクセル描画される</figcaption>
<img src="images/00229.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-46">
<section>
<h2 id="calibre_link-116"><b>4-15　連番を振った画像を生成する</b></h2>
<p>　連番を振った画像を生成するには指定した範囲の数値をテキストレイヤーとして生成し保存します。連番ファイルにするためにはfor命令で使うループ用の変数をファイル名として利用します。保存するファイル形式はPhotoshopでサポートしているものであれば可能です。サンプルではJPEG画像として保存しています。画像を保存するサンプルおよび解説については「第13章　ファイル保存」を参照してください。</p>
<p>　サンプルでは数値を4桁になるように調整していますが、数値の先頭に0を付加しないのであれば「var n = (pfx + i).slice(-d);」の行を「var n = i;」に変更してください。</p>
<p>【sample】連番を振った画像を生成する</p>
<pre><code>// 連番を振った画像を生成する
(function(){
    var startNo = prompt("開始番号", 1);
    if (!startNo){ return; }    // キャンセルされた場合は内もしない
    var endNo = prompt("終了番号", 10);
    if (!endNo){ return; }    // キャンセルされた場合は内もしない
    var folderObj = Folder.selectDialog("保存先フォルダを指定してください");
    if (!folderObj){ return; } // キャンセルされた場合は内もしない
    saveMultiImage(folderObj, startNo, endNo, 80, 64, 4, 48);    // 80x64画像、桁数、文字サイズ
})();
// 連番画像ファイルを生成する関数
function saveMultiImage(folderObj, startNo, endNo, w, h, d, fontSize){
    startNo = parseFloat(startNo);    // 文字列を小数値に変換する
    endNo = parseFloat(endNo);
    step = 1;   // もし小数値の場合なら0.1とかにする
    var pfx = "";
    for(var i=0; i&lt;d; i++){ pfx = pfx + "0"; }
    for(var i=startNo; i&lt;=endNo; i+=step){
        var n = (pfx + i).slice(-d);
        var filename = folderObj.fsName + "/" + n + ".jpg";
        // 新規ドキュメントを作成する
        var docObj = app.documents.add(
            UnitValue(w, "px"),   // 横幅
            UnitValue(h, "px"),   // 縦幅
            72,    // ●72dpi
            "", // ドキュメント名
            NewDocumentMode.RGB,    //カラーモード
            DocumentFill.WHITE,   // 背景は白色
            1.0,    // 縦横比
            BitsPerChannelType.EIGHT    // 8bit色深度
        );
        // テキストレイヤーを作成し番号を表示する
        var layObj = docObj.artLayers.add();   // レイヤーを追加する
        layObj.kind = LayerKind.TEXT;   // テキストレイヤーにする
        layObj.textItem.font = "Times-Bold";
        layObj.textItem.contents = i;   // 表示する番号（文字）
        layObj.textItem.size = UnitValue(fontSize, "pt");;  // 文字サイズを設定
        //layObj.textItem.justification = Justification.LEFT;   // 左揃え
        var left = parseInt(layObj.bounds[0]);
        var top = parseInt(layObj.bounds[1]);
        var right = parseInt(layObj.bounds[2]);
        var bottom = parseInt(layObj.bounds[3]);
        var tw = right - left;   // 横幅
        var th = bottom - top;  // 縦幅
        var offsetX = 0;    // ●微調整用のオフセット（横）
        var offsetY = 0;   // ●微調整用のオフセット（縦）
        var centerX = w/2-tw/2+offsetX;
        var centerY = h/2-th/2+offsetY;
        layObj.translate(centerX - left, centerY - top);   // レイヤーを移動
        layObj.textItem.color = setRGBColor(255, 0, 0);  // ●赤色で描画
        saveJPEG(filename); // JPEG形式で保存する関数を呼び出す
    }
}
// JPEG形式で保存する
function saveJPEG(filename){
    var fileObj = new File(filename);
    var jpegOpt = new JPEGSaveOptions();
    jpegOpt.embedColorProfile = true;   // カラープロファイルを埋め込む
    jpegOpt.quality = 8;    // 品質は8
    jpegOpt.formatOptions = FormatOptions.PROGRESSIVE;  // プログレッシブにする
    jpegOpt.scans = 3;  // スキャンラインは3
    jpegOpt.matte = MatteType.NONE; // カラーマットなし
    activeDocument.saveAs(fileObj, jpegOpt, true, Extension.LOWERCASE);
    app.activeDocument.close(SaveOptions.DONOTSAVECHANGES); // 何もせず閉じる
}
// カラーを定義しSolidColorオブジェクトを返す
function setRGBColor(r, g, b){
    var color = new SolidColor();
    color.rgb.red = r;
    color.rgb.green = g;
    color.rgb.blue = b;
    return color;
}</code></pre>
<p>　開始番号を入れます。</p>
<figure>
<figcaption>【図】開始番号を入れる</figcaption>
<img src="images/00625.jpeg" />
</figure>
<p>　終了番号を入れます。</p>
<figure>
<figcaption>【図】終了番号を入れる</figcaption>
<img src="images/00117.jpeg" />
</figure>
<p>　保存先のフォルダを指定します。</p>
<figure>
<figcaption>【図】保存先のフォルダを指定する</figcaption>
<img src="images/00535.jpeg" />
</figure>
<p>指定した範囲の連番JPEGファイルが生成されます。</p>
<figure>
<figcaption>【図】指定した範囲の連番JPEGファイルが生成される</figcaption>
<img src="images/00309.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-45">
<section>
<h2 id="calibre_link-117"><b>4-16　Macでキャプチャーしたスクリーンショットの透明部分を削除する</b></h2>
<p>　Mac OS X/OS Xでは画面キャプチャーを行うとウィンドウのまわりの透明部分も含まれてしまいます。新しいOS Xのバージョンでは透明部分をキャプチャーしないキーコンビネーションがありますが、古いMac OSではそのようなキーコンビネーションがありません。また、キャプチャー対象のウィンドウやパネルによって透明部分の幅が異なるため、アクションを使用した場合は特定のウィンドウにしか対応できません。</p>
<p>　Photoshopのスクリプトではピクセルの色情報は取得できますが、そこに透明情報は含まれていません。そこで、画像をコピーし新しいチャンネルにペーストします。透明部分は完全な黒になります。あとは、画像の端から中央に向かってチャンネル内のピクセル値が黒かどうかしらべます。黒でなくなったら、その座標で切り抜きます。なお、透明部分が画像の半分以上ある場合はアルゴリズム的に失敗するので、その場合は元の画像に復帰させた後、エラーであることを呼び出し元に返します。</p>
<p>　サンプルでは透明情報を完全にコピーするために左上と右下の1ピクセルを1%の不透明度で塗り潰しています。塗り潰す色は前景色を指定していますが、気になる場合はSolidColorオブジェクトを使って処理してください。</p>
<p>【sample】Macでキャプチャーしたスクリーンショットの透明部分を削除する</p>
<pre><code>//  Macでキャプチャーしたスクリーンショットの透明部分を削除する
app.activeDocument.suspendHistory("透明カット", "tempFunc()");
function tempFunc(){    // ヒストリーを記録しないための関数定義
    if (cropTransparent() == false){
        alert("透明部分が画像の半分以上あると切り抜けません");
    }
}
// 透明部分をくり抜く関数
// 戻り値がfalseなら失敗。trueなら成功
function cropTransparent(){
    var doc = app.activeDocument;
    var ds = doc.selection;
    // 横幅や縦幅を取得する。また、中央座標を計算する
    var docW = parseInt(doc.width.as("px"));
    var docH = parseInt(doc.height.as("px"));
    var cx = docW/2;
    var cy = docH/2;
    // 左上と右下に前景色を1%の半透明で描画する（完全コピーを行うため）
    ds.select([ [0, 0], [1, 0], [1, 1], [0, 1] ]);
    ds.fill(app.foregroundColor, ColorBlendMode.NORMAL, 1);
    ds.select([ [docW-1, docH-1], [docW, docH-1], [docW, docH], [docW-1, docH] ]);
    ds.fill(app.foregroundColor, ColorBlendMode.NORMAL, 1);
    // 透明部分を含む画像をキャプチャーし新しいチャンネルにペーストする
    doc.activeLayer.copy(); // コピー
    doc.channels.add(); // チャンネル追加
    doc.paste();    // 新規チャンネルにペースト
    var ch = doc.channels[3];
    // 上からの位置を求める
    for(var top=0; top&lt;docH; top++){
        ds.select([
            [cx+0, top+0], [cx+1, top+0], [cx+1, top+1], [cx+0, top+1]
        ]);
        if (ch.histogram[0] != 1){ break; } // 透明部分がなくなったらループ終了
    }
    // 左からの位置を求める
    for(var left=0; left&lt;docW; left++){
        ds.select([
            [left+0, cy+0], [left+1, cy+0], [left+1, cy+1], [left+0, cy+1]
        ]);
        if (ch.histogram[0] != 1){ break; } // 透明部分がなくなったらループ終了
    }
    // 下からの位置を求める
    for(var bottom=docH-1; bottom&gt;0; bottom--){
        ds.select([
            [cx+0, bottom+0], [cx+1, bottom+0], [cx+1, bottom+1], [cx+0, bottom+1]
        ]);
        if (ch.histogram[0] != 1){ break; } // 透明部分がなくなったらループ終了
    }
    // 右からの位置を求める
    for(var right=docW-1; right&gt;0; right--){
        ds.select([
            [right+0, cy+0], [right+1, cy+0], [right+1, cy+1], [right+0, cy+1]
        ]);
        if (ch.histogram[0] != 1){ break; } // 透明部分がなくなったらループ終了
    }
    // 切り抜く
    try{
        app.activeDocument.crop([
            UnitValue(left, "px"),
            UnitValue(top, "px"),
            UnitValue(right+1, "px"),
            UnitValue(bottom+1, "px")
        ]);
        ch.remove();   // チャンネルを削除する
        return true;
    }catch(e){
        // 失敗した場合は元の画像に復帰する
        var desc = new ActionDescriptor();
        var revertID = charIDToTypeID("Rvrt");
        executeAction(revertID, desc, DialogModes.NO);
        return false;
    }
}</code></pre>
<p>　スクリプトを実行する前の画像です。ウィンドウのまわりには透明部分があります。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態。透明部分がある。</figcaption>
<img src="images/00529.jpeg" />
</figure>
<p>　スクリプトを実行すると透明部分がカットされます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると透明部分がカットされる</figcaption>
<img src="images/00441.jpeg" />
</figure>
<p>　透明部分が異なる画像です。</p>
<figure>
<figcaption>【図】透明部分が異なる画像</figcaption>
<img src="images/00257.jpeg" />
</figure>
<p>　スクリプトを実行すると透明部分がカットされます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると透明部分がカットされる</figcaption>
<img src="images/00515.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-550">
<section>
<h2 id="calibre_link-118"><b>4-17　複数の画像を読み込み加算平均コンポジットを行う</b></h2>
<p>　ノイズが多い画像を複数重ねてノイズを軽減する方法の1つとして加算平均コンポジットがあります。天体写真などで利用されることもある方法です。これは、1枚目の画像の上に2枚目の画像を不透明度50%で重ねます。枚数の数だけ重ねますが、この場合不透明度は100÷n枚目で計算します。1枚目は100÷1=100%、2枚目は100÷2=50%、3枚目は100÷3=33%、4枚目は100÷4=25%となります。</p>
<p>　サンプルでは合成する画像の枚数は固定せずに指定されたフォルダ内にある画像の枚数から自動的に不透明度を計算し合成します。最終的には1枚の画像に複数のレイヤーが重なります。これは、星などを合成する際に微調整が必要になるためです。</p>
<p>　JPEG画像でなく全ての画像形式に対応したい場合はfolderObj.getFiles("*.jpg")をfolderObj.getFiles()に変更してください。</p>
<p>【sample】複数の画像を読み込み加算平均コンポジットを行う</p>
<pre><code>//  複数の画像を読み込み加算平均コンポジットを行う
aaComposite();
// 加算平均コンポジット処理
function aaComposite(){
    var folderObj = Folder.selectDialog("画像があるフォルダを選択してください");
    if (!folderObj){ return; }  // キャンセルされた場合は何もしない
    var fileList = folderObj.getFiles("*.jpg"); // JPEG画像
    app.open(fileList[0]);  // 1枚目の画像を開く
    for(var i=1; i&lt;fileList.length; i++){
        app.open(fileList[i]);  // ファイルを開く
        app.activeDocument.activeLayer.copy();  // コピーする
        app.activeDocument.close(SaveOptions.DONOTSAVECHANGES);
        app.activeDocument.paste(); // ペーストする
        app.activeDocument.activeLayer.opacity = 100 / (i+1);   // 不透明度を自動計算
    }
}</code></pre>
<p>　画像があるフォルダを選択します。</p>
<figure>
<figcaption>【図】画像があるフォルダを選択する</figcaption>
<img src="images/00427.jpeg" />
</figure>
<p>　画像が合成されます。ファイルは基本的にアルファベット順、番号順に読み込まれレイヤーとして合成されます。</p>
<figure>
<figcaption>【図】画像が合成される</figcaption>
<img src="images/00299.jpeg" />
</figure>
<p>　加算平均コンポジットを行わないと画像はノイジーになります。</p>
<figure>
<figcaption>【図】加算平均コンポジットを行わないと画像はノイジーになる</figcaption>
<img src="images/00621.jpeg" />
</figure>
<p>　異なる枚数の画像も自動的に読み込まれ合成されます。</p>
<figure>
<figcaption>【図】異なる枚数の画像も自動的に読み込まれ合成される</figcaption>
<img src="images/00007.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-701">
<section>
<h2 id="calibre_link-119"><b>4-18　画像の縦横比を考慮してリサイズする</b></h2>
<p>　画像の縦横比を考慮してリサイズするには、画像の横幅と縦幅を読み出します。縦幅より横幅が大きい場合と、縦幅が横幅が小さい場合で処理を分けます。横長の場合はresizeImage()メソッドの最初のパラメーターに変更後のサイズを指定します。縦長の場合は最初のパラメーターにundefinedを指定し2番目のパラメーターに変更後のサイズを指定します。</p>
<p>【sample】画像の縦横比を考慮してリサイズする</p>
<pre><code>//  画像の縦横比を考慮してリサイズする
resizeAR(400);
function resizeAR(size){
    var doc = app.activeDocument;
    var docW = parseFloat(doc.width.as("px"));  // 横幅を読み出す
    var docH = parseFloat(doc.height.as("px")); // 縦幅を読み出す
    if (docW &gt; docH){   // 横長の画像の場合
        doc.resizeImage(UnitValue(size, "px"));
    }else{
        doc.resizeImage(undefined, UnitValue(size, "px"),);
    }
}</code></pre>
<p>　横長の画像です。</p>
<figure>
<figcaption>【図1】横長の画像</figcaption>
<img src="images/00036.jpeg" />
</figure>
<p>　スクリプトを実行すると縦横比を保ったまま画像サイズが変化します。</p>
<figure>
<figcaption>【図2】スクリプトを実行すると縦横比を保ったまま画像サイズが変化する</figcaption>
<img src="images/00173.jpeg" />
</figure>
<p>　縦長の画像です。</p>
<figure>
<figcaption>【図3】縦長の画像</figcaption>
<img src="images/00186.jpeg" />
</figure>
<p>　スクリプトを実行すると縦横比を保ったまま画像サイズが変化します。縦長の場合でも正しくリサイズされます。</p>
<figure>
<figcaption>【図4】スクリプトを実行すると縦横比を保ったまま画像サイズが変化する</figcaption>
<img src="images/00358.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-496">
<section>
<h2 id="calibre_link-120"><b>4-19　画像の縦横の大きい方にカンバスサイズを合わせる</b></h2>
<p>　画像の縦横の大きい方にカンバスサイズを合わせるには、画像の横幅と縦幅を読み出します。横幅と縦幅のどちらが大きいかを調べ、大きい方の幅をresizeCanvas()メソッドの最初と2番目のパラメーターに指定します。これにより画像は正方形になります。必要に応じてrewsizeImage()メソッドと組み合わせると画像サイズを変更することもできます。</p>
<p>【sample】画像の縦横の大きい方にカンバスサイズを合わせる</p>
<pre><code>//  画像の縦横の大きい方にカンバスサイズを合わせる
resizeARC();
function resizeARC(){
    var doc = app.activeDocument;
    var docW = parseFloat(doc.width.as("px"));  // 横幅を読み出す
    var docH = parseFloat(doc.height.as("px")); // 縦幅を読み出す
    if (docW &gt; docH){   // 横長の画像の場合
        doc.resizeCanvas(UnitValue(docW, "px"), UnitValue(docW, "px"));
    }else{
        doc.resizeCanvas(UnitValue(docH, "px"), UnitValue(docH, "px"));
    }
}</code></pre>
<p>　横長の画像です。</p>
<figure>
<figcaption>【図】横長の画像</figcaption>
<img src="images/00602.jpeg" />
</figure>
<p>　スクリプトを実行すると画像サイズが変化し縦幅が横幅と同じになります。</p>
<figure>
<figcaption>【図】画像サイズが変化し縦幅が横幅と同じになる</figcaption>
<img src="images/00542.jpeg" />
</figure>
<p>　縦長の画像です。</p>
<figure>
<figcaption>【図】縦長の画像</figcaption>
<img src="images/00317.jpeg" />
</figure>
<p>　スクリプトを実行すると画像サイズが変化し横幅が縦幅と同じになります。</p>
<figure>
<figcaption>【図】画像サイズが変化し横幅が縦幅と同じになる</figcaption>
<img src="images/00074.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-651">
<section>
<div>
<h1 id="calibre_link-121"><b>第5章　レイヤー</b></h1>
</div>
</section>
</div>
<div id="calibre_link-437">
<section>
<h2 id="calibre_link-122"><b>5-1　レイヤーの総数を求める</b></h2>
<p>　レイヤーの総数はlayers配列の要素数を取得することで求めることができます。layers配列にはドキュメント上の全てのレイヤーの情報が入っています。なお、背景も1つのレイヤーとしてみなされるため、背景しかない場合でもレイヤーの数は1になります。また、layers配列にはレイヤーをまとめるグループフォルダは含まれません。グループフォルダ内にあるレイヤーも深い階層をたどることなくlayers配列を使って参照することができます。</p>
<p>【sample】レイヤーの総数を求める</p>
<pre><code>// レイヤーの総数を求める
var n = app.activeDocument.layers.length;
alert(n+"個あります");</code></pre>
<p>　アラートダイアログに現在のドキュメントにあるレイヤーの総数が表示されます。</p>
<figure>
<figcaption>【図】現在のドキュメントにあるレイヤーの総数が表示される</figcaption>
<img src="images/00491.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-593">
<section>
<h2 id="calibre_link-123"><b>5-2　レイヤーの種類を調べる</b></h2>
<p>　レイヤーの種類を調べるにはlayerオブジェクトのkindプロパティを読み出します。kindプロパティは以下の表に示す値になります。</p>
<table>
<caption>【表】レイヤーの種類</caption>
<tbody>
<tr>
  <td>
    <span>種類</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>LayerKind.BLACKANDWHITE</td>
  <td>白黒</td>
</tr>
<tr>
  <td>LayerKind.BRIGHTNESSCONTRAST</td>
  <td>明るさコントラスト</td>
</tr>
<tr>
  <td>LayerKind.CHANNELMIXER</td>
  <td>チャンネルミキサー</td>
</tr>
<tr>
  <td>LayerKind.COLORBALANCE</td>
  <td>カラーバランス</td>
</tr>
<tr>
  <td>LayerKind.CURVES</td>
  <td>トーンカーブ</td>
</tr>
<tr>
  <td>LayerKind.EXPOSURE</td>
  <td>露光量</td>
</tr>
<tr>
  <td>LayerKind.GRADIENTFILL</td>
  <td>グラデーション（塗りつぶしレイヤー）</td>
</tr>
<tr>
  <td>LayerKind.GRADIENTMAP</td>
  <td>グラデーションマップ</td>
</tr>
<tr>
  <td>LayerKind.HUESATURATION</td>
  <td>色相・彩度</td>
</tr>
<tr>
  <td>LayerKind.INVERSION</td>
  <td>階調の反転</td>
</tr>
<tr>
  <td>LayerKind.LEVELS</td>
  <td>レベル補正</td>
</tr>
<tr>
  <td>LayerKind.NORMAL</td>
  <td>通常のレイヤー</td>
</tr>
<tr>
  <td>LayerKind.PATTERNFILL</td>
  <td>パターン（塗りつぶしレイヤー）</td>
</tr>
<tr>
  <td>LayerKind.PHOTOFILTER</td>
  <td>フィルター</td>
</tr>
<tr>
  <td>LayerKind.POSTERIZE</td>
  <td>ポスタライズ</td>
</tr>
<tr>
  <td>LayerKind.SELECTIVECOLOR</td>
  <td>特定色域の選択</td>
</tr>
<tr>
  <td>LayerKind.SMARTOBJECT</td>
  <td>スマートオブジェクト</td>
</tr>
<tr>
  <td>LayerKind.SOLIDFILL</td>
  <td>べた塗り（塗りつぶしレイヤー）</td>
</tr>
<tr>
  <td>LayerKind.TEXT</td>
  <td>テキストレイヤー</td>
</tr>
<tr>
  <td>LayerKind.THRESHOLD</td>
  <td>しきい値</td>
</tr>
<tr>
  <td>LayerKind.LAYER3D</td>
  <td>3Dレイヤー</td>
</tr>
<tr>
  <td>LayerKind.VIBRANCE</td>
  <td>自然な彩度</td>
</tr>
<tr>
  <td>LayerKind.VIDEO</td>
  <td>ビデオレイヤー</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーの種類を調べる</p>
<pre><code>// レイヤーの種類を調べる
var layerType = app.activeDocument.activeLayer.kind;
alert(layerType);</code></pre>
<p>　アクティブになっているレイヤーの種類がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】アクティブなレイヤーの種類が表示される</figcaption>
<img src="images/00263.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-28">
<section>
<h2 id="calibre_link-124"><b>5-3　アクティブ（選択されている）レイヤーを調べる</b></h2>
<p>　アクティブ（選択されている）レイヤーを調べるレイヤーを調べるにはdocumentオブジェクトのactiveLayerプロパティを読み出します。レイヤーでなくレイヤーセットが選択されている場合はレイヤーセットオブジェクトが格納されています。</p>
<p>　Photoshop CS2以降では複数のレイヤーを同時に選択することができます。この状態でactiveLayerプロパティを読み出した場合、最も上（前後関係では手前）にあるLayerまたはLayerSetのオブジェクトが返されます。複数選択されている場合は配列に格納されるというようなことはありません。このため、選択されている複数のレイヤーを調べる場合は別途スクリプトを作成する必要があります。</p>
<p>【sample】アクティブ（選択されている）レイヤーを調べる</p>
<pre><code>// アクティブになっているレイヤー名を表示する
var layObj = app.activeDocument.activeLayer;
alert(layObj.name);</code></pre>
<p>　アクティブになっているレイヤー名がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】アクティブなレイヤー名が表示される</figcaption>
<img src="images/00414.jpeg" />
</figure>
<p>　レイヤーセットがアクティブになっている場合はレイヤーセット名がアラートダイアログが表示されます。</p>
<figure>
<figcaption>【図】レイヤーセットがアクティブな場合、レイヤーセット名が表示される</figcaption>
<img src="images/00447.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-542">
<section>
<h2 id="calibre_link-125"><b>5-4　選択されている複数のレイヤーを取得する</b></h2>
<p>　選択されている複数のレイヤーを取得するにはレイヤーからレイヤーからの新規グループにする機能を利用します。選択されているレイヤーがある状態で新規グループを作成すると、そのグループ内（レイヤーセット内）に選択されたレイヤーが入ります。これはレイヤーメニューの「新規」＞「レイヤーからのグループ...」と同じです。</p>
<p>　あとはレイヤーセット内にあるレイヤーを読み出します。読み出し後はUndo（アンドゥ）機能で元に戻せば選択した複数のレイヤー情報を取得することができます。なお、以下のサンプルではレイヤーセットが選択されていると正しく機能しないことがあります。特にレイヤーセット内にレイヤーセットがあると全てのレイヤー情報が取得できないことがあります。また、背景が選択されている場合は正しく機能しないため、getSelectLayer()関数はnullを返します。</p>
<p>【sample】選択されている複数のレイヤーを取得する</p>
<pre><code>// 選択されているレイヤー一覧を表示する
var layerList = getSelectLayer();
if(layerList == null){
    alert("背景が選択されていると処理できません");
}else{
    alert(layerList);
}
// 選択された複数のレイヤー／レイヤーセットを配列で返す
function getSelectLayer(){
    // 選択されたレイヤー／レイヤーセットをレイヤーセットに入れる
    var idMk = charIDToTypeID( "Mk  " );
        var desc1 = new ActionDescriptor();
        var idnull = charIDToTypeID( "null" );
            var ref1 = new ActionReference();
            var idlayerSection = stringIDToTypeID( "layerSection" );
            ref1.putClass( idlayerSection );
        desc1.putReference( idnull, ref1 );
        var idFrom = charIDToTypeID( "From" );
            var ref2 = new ActionReference();
            var idLyr = charIDToTypeID( "Lyr " );
            var idOrdn = charIDToTypeID( "Ordn" );
            var idTrgt = charIDToTypeID( "Trgt" );
            ref2.putEnumerated( idLyr, idOrdn, idTrgt );
        desc1.putReference( idFrom, ref2 );
        var idUsng = charIDToTypeID( "Usng" );
            var desc2 = new ActionDescriptor();
            var idNm = charIDToTypeID( "Nm  " );
            desc2.putString( idNm, "tempLayer" );
        var idlayerSection = stringIDToTypeID( "layerSection" );
        desc1.putObject( idUsng, idlayerSection, desc2 );
    try{
        executeAction( idMk, desc1, DialogModes.NO );
    }catch(e){
        return null;    // 背景ならnullを返す
    }
    // 選択されたレイヤーを配列に入れる
    var result = [];
    var ls = app.activeDocument.activeLayer;
    for(var i=0; i&lt;ls.layers.length; i++){
        result.push(ls.layers[i]);
    }
    // 元に戻す
    executeAction(charIDToTypeID("undo"), undefined, DialogModes.NO);
    return result;
}</code></pre>
<p>　選択された複数のレイヤーの情報がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】選択された複数のレイヤーの情報が表示される</figcaption>
<img src="images/00220.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-461">
<section>
<h2 id="calibre_link-126"><b>5-5　アクティブにするレイヤーを指定する</b></h2>
<p>　アクティブにするレイヤーを指定するにはdocumentオブジェクトのactiveLayerプロパティにアクティブにしたいlayerオブジェクトを指定します。なお、レイヤーパネルで何もレイヤーが選択されていない場合、スクリプトでアクティブレイヤーを指定してもハイライトされないことがあります。ハイライトはされませんが、指定したレイヤーはアクティブになっています。</p>
<p>【sample】アクティブにするレイヤーを指定する</p>
<pre><code>// 一番上のレイヤーをアクティブにする
app.activeDocument.activeLayer = app.activeDocument.layers[0];</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00628.jpeg" />
</figure>
<p>　スクリプトを実行すると一番上のレイヤーがアクティブになります。</p>
<figure>
<figcaption>【図】スクリプトを実行すると一番上のレイヤーがアクティブになる</figcaption>
<img src="images/00400.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-482">
<section>
<h2 id="calibre_link-127"><b>5-6　複数のレイヤー／レイヤーセットを選択する</b></h2>
<p>　複数のレイヤー／レイヤーセットを選択するためのメソッドはPhotoshopでは標準メソッドとしては用意されていません。単独での選択であればdocumentオブジェクトのactiveLayerプロパティに設定しますが、複数の場合はScripting Listenerを使う必要があります。Scripting Listenerを使って複数のレイヤーを選択したコードを利用し、選択するレイヤー名の部分だけ変数に置き換えます。以下のサンプルではselectMultiLayer関数が該当します。selectMultiLayer関数にレイヤー名やレイヤーセット名をパラメーターとして渡せば該当するレイヤーが選択状態になります。</p>
<p>　また、存在しないレイヤー／レイヤーセット名を指定するとエラーになります。これを回避するためselectMultiLayer関数ではtry...catchを使っています。</p>
<p>【sample】複数のレイヤー／レイヤーセットを選択する</p>
<pre><code>// 複数のレイヤーを選択する
selectMultiLayer("バー");
selectMultiLayer("レイヤー 2");
selectMultiLayer("マット");    // レイヤーセットも選択できる
selectMultiLayer("桃源郷"); // 存在しないレイヤー名があってもエラーにはならない
selectMultiLayer("テロップ");   // 同じレイヤー名の場合は下にあるものが選択される
// 指定された名前のレイヤーを選択する
function selectMultiLayer(layerName){
    var idslct = charIDToTypeID( "slct" );
        var desc1 = new ActionDescriptor();
        var idnull = charIDToTypeID( "null" );
            var ref1 = new ActionReference();
            var idLyr = charIDToTypeID( "Lyr " );
            ref1.putName( idLyr, layerName );
        desc1.putReference( idnull, ref1 );
        var idselectionModifier = stringIDToTypeID( "selectionModifier" );
        var idselectionModifierType = stringIDToTypeID( "selectionModifierType" );
        var idaddToSelection = stringIDToTypeID( "addToSelection" );
        desc1.putEnumerated( idselectionModifier, idselectionModifierType, idaddToSelection );
        var idMkVs = charIDToTypeID( "MkVs" );
        desc1.putBoolean( idMkVs, false );
    try{
        executeAction( idslct, desc1, DialogModes.NO );
    }catch(e){} // 存在しないレイヤーがあってもエラーにはしない
}</code></pre>
<p>　この時点ではどのレイヤーも選択されていません。</p>
<figure>
<figcaption>【図】どのレイヤーも選択されていない</figcaption>
<img src="images/00170.jpeg" />
</figure>
<p>　スクリプトを実行すると指定したレイヤーが選択されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると指定したレイヤーが選択される</figcaption>
<img src="images/00585.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-638">
<section>
<h2 id="calibre_link-128"><b>5-7　レイヤー名を取得する</b></h2>
<p>　レイヤー名を取得するにはlayerオブジェクトのnameプロパティを読み出します。レイヤー名は同じ名前が存在することもあるのでlayers["テキスト"]のように連想配列／ハッシュで指定する際には注意が必要です。同じ名前のレイヤーがある場合にlayers["レイヤー名"]のように連想配列／ハッシュで指定した場合、上の方にあるレイヤーがアクセス対象になります。</p>
<p>【sample】レイヤー名を取得する</p>
<pre><code>// 第一階層（ルート）にある全てのレイヤー名を表示する
var layObj = app.activeDocument.layers;
var text = "";
for(var i=0; i&lt;layObj.length; i++){ // レイヤーの数だけ繰り返す
    text = text + layObj[i].name + "\n";    // 名前を読み出す
}
alert(text);</code></pre>
<p>　第一階層にある全てのレイヤーの名前がアラートダイアログに表示されます。レイヤーセットもレイヤーとして処理されるため、レイヤーセットの名前もアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】第一階層にある全てのレイヤーの名前が表示される</figcaption>
<img src="images/00018.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-424">
<section>
<h2 id="calibre_link-129"><b>5-8　レイヤー名を変更する</b></h2>
<p>　レイヤー名を変更するにはlayerオブジェクトのnameプロパティに文字を設定します。すでに同じ名前のレイヤーがある場合でもエラーにはなりません。</p>
<p>【sample】レイヤー名を変更する</p>
<pre><code>// 一番最初のレイヤー名を変更する
app.activeDocument.layers[0].name = "撮影場所";</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00120.jpeg" />
</figure>
<p>　一番上にあるレイヤーの名前が変更されます。</p>
<figure>
<figcaption>【図】一番上にあるレイヤーの名前が変更される</figcaption>
<img src="images/00538.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-579">
<section>
<h2 id="calibre_link-130"><b>5-9　レイヤーを追加する／新規にレイヤーを作成する</b></h2>
<p>　レイヤーを追加する／新規にレイヤーを作成するにはartLayersオブジェクトのadd()メソッドを使います。add()メソッドには指定できるパラメーターがありません。生成したレイヤーの種類を変更するには、layerオブジェクトのkindプロパティに以下の表に示す値を指定します。なお、レイヤーの種類は多数ありますが、指定できるのは以下の表に示す2種類のみです。</p>
<p>　なお、調整レイヤーを生成するためのメソッドは用意されていません。調整レイヤーを生成する場合はScripting Listenerを使って記録する必要があります。</p>
<table>
<caption>【表】kindプロパティに指定できる値</caption>
<tbody>
<tr>
  <td>
    <span>値</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>LayerKind.NORMAL</td>
  <td>通常のレイヤー</td>
</tr>
<tr>
  <td>LayerKind.TEXT</td>
  <td>テキストレイヤー</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーを追加する／新規にレイヤーを作成する</p>
<pre><code>// レイヤーを追加する
var layerObj = app.activeDocument.artLayers.add();
// テキストレイヤーを追加する
var textLayerObj = app.activeDocument.artLayers.add();
textLayerObj.kind = LayerKind.TEXT;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00312.jpeg" />
</figure>
<p>　通常のレイヤーとテキストレイヤーが追加されます。</p>
<figure>
<figcaption>【図】通常のレイヤーとテキストレイヤーが追加される</figcaption>
<img src="images/00070.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-674">
<section>
<h2 id="calibre_link-131"><b>5-10　新規にサブレイヤーを追加する</b></h2>
<p>　新規にサブレイヤーを追加するにはlayerSetsオブジェクトのartLayersオブジェクトのadd()メソッドを使います。add()メソッドは通常のレイヤーと同様の使い方になります。レイヤーの種類などの指定については他のレイヤーに関する項目を参照してください。</p>
<p>【sample】新規にサブレイヤーを追加する</p>
<pre><code>// レイヤーセット内にレイヤーを追加する（サブレイヤーの追加）
var laySet = app.activeDocument.layerSets["テキスト"];
var layerObj = laySet.artLayers.add();  // レイヤー追加
layerObj.kind = LayerKind.TEXT; // テキストレイヤー
layerObj.textItem.font = "HiraMinPro-W6";   // フォント
layerObj.textItem.contents = "諏訪湖"; // 表示する文字
layerObj.textItem.size = UnitValue("24pt"); // 文字サイズ</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00488.jpeg" />
</figure>
<p>　レイヤーセット"テキスト"内にテキストレイヤーが追加されます。</p>
<figure>
<figcaption>【図】レイヤーセット"テキスト"内にテキストレイヤーが追加される</figcaption>
<img src="images/00112.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-0">
<section>
<h2 id="calibre_link-132"><b>5-11　調整レイヤーを追加する</b></h2>
<p>　Photoshopでは標準で調整レイヤーを追加するメソッドは用意されていません。このため、Scripting Listenerを使って調整レイヤーを生成するスクリプトを記録します。以下の表に示す調整レイヤーは、いずれも同じパターンで生成することができます。どの調整レイヤーを生成するかは4文字のIDで指定します。IDと調整レイヤーの対応を「【表】調整レイヤーとIDの対応」に示します。なお、以下のコードが期待通りに動作しない場合はScripting Listenerを使って調整レイヤーを生成し、そのコードを利用してください。</p>
<table>
<caption>【表】調整レイヤーとIDの対応</caption>
<tbody>
<tr>
  <td>
    <span>ID</span>
  </td>
  <td>
    <span>調整レイヤーの種類</span>
  </td>
</tr>
<tr>
  <td>BrgC</td>
  <td>明るさ・コントラスト</td>
</tr>
<tr>
  <td>Lvls</td>
  <td>レベル補正</td>
</tr>
<tr>
  <td>Crvs</td>
  <td>トーンカーブ</td>
</tr>
<tr>
  <td>Exps</td>
  <td>露光量</td>
</tr>
<tr>
  <td>HStr</td>
  <td>色相・彩度</td>
</tr>
</tbody>
</table>
<p>【sample】調整レイヤーを追加する</p>
<pre><code>// 調整レイヤーを追加する
addAdjustLayer("Lvls");
addAdjustLayer("Crvs");
// 指定された種類の調整レイヤーをアクティブレイヤーの前に追加する
function addAdjustLayer(layerType){
    var idMk = charIDToTypeID( "Mk  " );
        var desc1 = new ActionDescriptor();
        var idnull = charIDToTypeID( "null" );
            var ref1 = new ActionReference();
            var idAdjL = charIDToTypeID( "AdjL" );
            ref1.putClass( idAdjL );
        desc1.putReference( idnull, ref1 );
        var idUsng = charIDToTypeID( "Usng" );
            var desc2 = new ActionDescriptor();
            var idType = charIDToTypeID( "Type" );
                var desc3 = new ActionDescriptor();
                var idpresetKind = stringIDToTypeID( "presetKind" );
                var idpresetKindType = stringIDToTypeID( "presetKindType" );
                var idpresetKindDefault = stringIDToTypeID( "presetKindDefault" );
                desc3.putEnumerated( idpresetKind, idpresetKindType, idpresetKindDefault );
            var idLvls = charIDToTypeID(layerType);
            desc2.putObject( idType, idLvls, desc3 );
        var idAdjL = charIDToTypeID( "AdjL" );
        desc1.putObject( idUsng, idAdjL, desc2 );
    executeAction( idMk, desc1, DialogModes.NO );
}</code></pre>
<p>　背景の上に調整レイヤーを生成するため、背景を選択しアクティブにしておきます。</p>
<figure>
<figcaption>【図】背景を選択しアクティブにしておく</figcaption>
<img src="images/00027.jpeg" />
</figure>
<p>　スクリプトを実行するとトーンカーブとレベル補正の調整レイヤーが生成されます。</p>
<figure>
<figcaption>【図】トーンカーブとレベル補正の調整レイヤーが生成される</figcaption>
<img src="images/00442.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-29">
<section>
<h2 id="calibre_link-133"><b>5-12　レイヤーを複製する</b></h2>
<p>　レイヤーを複製するにはlayerオブジェクトのduplicate()メソッドを使用します。duplicate()メソッドの最初のパラメーターには複製後のレイヤーをどこに配置するか示す基準となるlayerオブジェクトまたはlayerSetオブジェクトを指定します。2番目のパラメーターには、複製したレイヤーを基準レイヤーより上に配置するか下に配置するかなどを指定します。指定できる値は表のようになります。</p>
<p>　duplicate()メソッドのパラメーターは全て省略することができます。パラメーターを省略した場合、複製されたレイヤーは複製元のレイヤーの1つ上に配置されます。</p>
<table>
<caption>【表】配置する位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>位置</span>
  </td>
</tr>
<tr>
  <td>ElementPlacement.INSIDE</td>
  <td>内側</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEATBEGINNING</td>
  <td>最初</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEATEND</td>
  <td>最後</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEBEFORE</td>
  <td>前</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEAFTER</td>
  <td>後</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーを複製する</p>
<pre><code>// レイヤーを複製する
var baseLayer = app.activeDocument.layers[0];   // 一番上のレイヤー
app.activeDocument.layers["白マット"].duplicate(
    baseLayer,  // 基準レイヤー
    ElementPlacement.PLACEBEFORE    // 基準レイヤーの上にする
);</code></pre>
<p>　複数のレイヤーがあります。</p>
<figure>
<figcaption>【図】複数のレイヤーがある</figcaption>
<img src="images/00215.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤー名"白マット"のレイヤーが複製されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤー名"白マット"のレイヤーが複製される</figcaption>
<img src="images/00623.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-426">
<section>
<h2 id="calibre_link-134"><b>5-13　レイヤーが背景かどうか調べる</b></h2>
<p>　レイヤーが背景かどうか調べるにはlayerオブジェクトのisBackgroundLayerプロパティを参照します。値がtrueの場合は背景、falseの場合は通常のレイヤーになります。</p>
<p>【sample】レイヤーが背景かどうか調べる</p>
<pre><code>// アクティブレイヤーが背景かどうか調べる
var flag = app.activeDocument.activeLayer.isBackgroundLayer;
alert(flag);</code></pre>
<p>　背景がアクティブになっている状態です。</p>
<figure>
<figcaption>【図】背景がアクティブな状態</figcaption>
<img src="images/00526.jpeg" />
</figure>
<p>　背景が選択されているためスクリプトを実行するとアラートダイアログにはtrueが表示されます。</p>
<figure>
<figcaption>【図】背景が選択されているためtrueが表示される</figcaption>
<img src="images/00087.jpeg" />
</figure>
<p>　テキストレイヤーがアクティブになっている状態です。</p>
<figure>
<figcaption>【図】テキストレイヤーがアクティブな状態</figcaption>
<img src="images/00580.jpeg" />
</figure>
<p>　背景ではないレイヤーが選択されているためスクリプトを実行するとアラートダイアログにはfalseが表示されます。</p>
<figure>
<figcaption>【図】背景ではないレイヤーが選択されているため、falseが表示される</figcaption>
<img src="images/00351.jpeg" />
</figure>
<p>　レイヤーセットがアクティブになっている状態です。</p>
<figure>
<figcaption>【図】レイヤーセットがアクティブな状態</figcaption>
<img src="images/00115.jpeg" />
</figure>
<p>　レイヤーセットが選択されているためスクリプトを実行するとアラートダイアログにはundefinedが表示されます。これはlayerSetオブジェクトにisBackgroundLayerプロパティがないため、このように表示されます。</p>
<figure>
<figcaption>【図】レイヤーセットが選択されているため、undefinedが表示される</figcaption>
<img src="images/00533.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-630">
<section>
<h2 id="calibre_link-135"><b>5-14　レイヤーを背景にする</b></h2>
<p>　レイヤーを背景にするにはlayerオブジェクトのisBackgroundLayerプロパティにtrueを指定します。この場合、レイヤーの位置やフォルダに入っているかどうかには関係なく背景として設定されます。ただし、すでに背景がある場合はエラーで停止します。</p>
<p>【sample】レイヤーを背景にする</p>
<pre><code>// アクティブレイヤーを背景にする
app.activeDocument.activeLayer.isBackgroundLayer = true;</code></pre>
<p>　背景にするレイヤーを選択します。</p>
<figure>
<figcaption>【図】背景にするレイヤーを選択する</figcaption>
<img src="images/00306.jpeg" />
</figure>
<p>　スクリプトを実行すると選択したレイヤーが背景として設定され、レイヤーパネルの一番下に移動します。</p>
<figure>
<figcaption>【図】選択したレイヤーが背景として設定され、レイヤーパネルの一番下に移動する</figcaption>
<img src="images/00069.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-419">
<section>
<h2 id="calibre_link-136"><b>5-15　背景をレイヤーに変換する</b></h2>
<p>　背景をレイヤーに変換するには背景のlayerオブジェクトのisBackgroundLayerプロパティにfalseを指定します。これにより背景が通常のレイヤーに変換されます。変換されると背景レイヤーの名前は「レイヤー 0」になります。なお、背景レイヤーを指定する際にapp.activeDocument.layers["背景"]のように指定しないでください。他のレイヤー名が"背景"の場合、正しく処理されなくなります。</p>
<p>【sample】背景をレイヤーに変換する</p>
<pre><code>// 背景をレイヤーに変換する
var ptr = app.activeDocument.layers.length;
app.activeDocument.layers[ptr - 1].isBackgroundLayer = false;</code></pre>
<p>　背景を選択します。</p>
<figure>
<figcaption>【図】背景を選択する</figcaption>
<img src="images/00483.jpeg" />
</figure>
<p>　スクリプトを実行すると選択した背景がレイヤーに変換されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択した背景がレイヤーに変換される</figcaption>
<img src="images/00494.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-23">
<section>
<h2 id="calibre_link-137"><b>5-16　レイヤーを表示／非表示にする</b></h2>
<p>　レイヤーを表示／非表示にするにはlayerオブジェクトのvisibleプロパティにtrueまたはfalseを設定します。trueを指定すると表示され、falseを指定すると表示されなくなります。</p>
<p>【sample】レイヤーを表示／非表示にする</p>
<pre><code>// レイヤーを表示／非表示にする
app.activeDocument.layers[0].visible = true;    // 一番上のレイヤーを表示
app.activeDocument.layers["ローマ字"].visible = false;    // "ローマ字"レイヤーを非表示
app.activeDocument.layerSets["グループ 1"].layers["マット"].visible = true;    // グループ内のレイヤーを表示</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00267.jpeg" />
</figure>
<p>　スクリプトを実行すると一番上のレイヤーとレイヤーセット名"グループ 1"にあるレイヤー名"マット"が表示されます。レイヤー名"ローマ字"のレイヤーは非表示になります。</p>
<figure>
<figcaption>【図】一番上のレイヤーとレイヤーセット名"グループ 1"にあるレイヤー名"マット"が表示される</figcaption>
<img src="images/00360.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-480">
<section>
<h2 id="calibre_link-138"><b>5-17　特定の種類のレイヤーだけ非表示にする</b></h2>
<p>　特定の種類のレイヤーだけ非表示にするには、いくつか方法があります。ここでは全てのレイヤーを取得する関数を用意します。（詳細については「テキストレイヤーだけ削除する」の項目を参照してください）　また、レイヤーが空っぽかどうか調べる関数も用意します。（詳細については「レイヤーが空っぽかどうか調べる」の項目を参照してください）</p>
<p>　関数で得られた全てのレイヤー情報をもとにレイヤーの種類を調べます（表参照）。該当する種類の場合、visibleプロパティにfalseを設定します。これで特定のレイヤーが非表示になります。逆にtrueを設定すれば特定のレイヤーを表示することができます。</p>
<table>
<caption>【表】レイヤーの種類</caption>
<tbody>
<tr>
  <td>
    <span>種類</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>LayerKind.BLACKANDWHITE</td>
  <td>白黒</td>
</tr>
<tr>
  <td>LayerKind.BRIGHTNESSCONTRAST</td>
  <td>明るさコントラスト</td>
</tr>
<tr>
  <td>LayerKind.CHANNELMIXER</td>
  <td>チャンネルミキサー</td>
</tr>
<tr>
  <td>LayerKind.COLORBALANCE</td>
  <td>カラーバランス</td>
</tr>
<tr>
  <td>LayerKind.CURVES</td>
  <td>トーンカーブ</td>
</tr>
<tr>
  <td>LayerKind.EXPOSURE</td>
  <td>露光量</td>
</tr>
<tr>
  <td>LayerKind.GRADIENTFILL</td>
  <td>グラデーション（塗りつぶしレイヤー）</td>
</tr>
<tr>
  <td>LayerKind.GRADIENTMAP</td>
  <td>グラデーションマップ</td>
</tr>
<tr>
  <td>LayerKind.HUESATURATION</td>
  <td>色相・彩度</td>
</tr>
<tr>
  <td>LayerKind.INVERSION</td>
  <td>階調の反転</td>
</tr>
<tr>
  <td>LayerKind.LEVELS</td>
  <td>レベル補正</td>
</tr>
<tr>
  <td>LayerKind.NORMAL</td>
  <td>通常のレイヤー</td>
</tr>
<tr>
  <td>LayerKind.PATTERNFILL</td>
  <td>パターン（塗りつぶしレイヤー）</td>
</tr>
<tr>
  <td>LayerKind.PHOTOFILTER</td>
  <td>フィルター</td>
</tr>
<tr>
  <td>LayerKind.POSTERIZE</td>
  <td>ポスタライズ</td>
</tr>
<tr>
  <td>LayerKind.SELECTIVECOLOR</td>
  <td>特定色域の選択</td>
</tr>
<tr>
  <td>LayerKind.SMARTOBJECT</td>
  <td>スマートオブジェクト</td>
</tr>
<tr>
  <td>LayerKind.SOLIDFILL</td>
  <td>べた塗り（塗りつぶしレイヤー）</td>
</tr>
<tr>
  <td>LayerKind.TEXT</td>
  <td>テキストレイヤー</td>
</tr>
<tr>
  <td>LayerKind.THRESHOLD</td>
  <td>しきい値</td>
</tr>
<tr>
  <td>LayerKind.LAYER3D</td>
  <td>3Dレイヤー</td>
</tr>
<tr>
  <td>LayerKind.VIBRANCE</td>
  <td>自然な彩度</td>
</tr>
<tr>
  <td>LayerKind.VIDEO</td>
  <td>ビデオレイヤー</td>
</tr>
</tbody>
</table>
<p>【sample】特定の種類のレイヤーだけ非表示にする</p>
<pre><code>// テキストレイヤーを非表示にする
var list = getAllLayer(app.activeDocument, []);
for(var i=0; i&lt;list.length; i++){
    if (list[i].kind == LayerKind.TEXT){
        list[i].visible = false;   // 非表示にする
    }
}
// レイヤーセットを除く全てのレイヤーオブジェクトを取得する
// IN : レイヤーオブジェクト, 配列オブジェクト
// OUT : レイヤーオブジェクトを格納した配列オブジェクト
function getAllLayer(obj, ary){
    for(var i=0; i&lt;obj.layers.length; i++){
        if (obj.layers[i].kind){    // レイヤーセット以外の場合
            ary.push(obj.layers[i]);
        }else{  // レイヤーセットなので再帰
            getAllLayer(obj.layers[i], ary);
        }
    }
    return ary; // 結果は配列で返す
}</code></pre>
<p>　複数のレイヤーがあります。</p>
<figure>
<figcaption>【図】複数のレイヤーがある</figcaption>
<img src="images/00448.jpeg" />
</figure>
<p>　スクリプトを実行するとテキストレイヤーが非表示になります。</p>
<figure>
<figcaption>【図】スクリプトを実行するとテキストレイヤーが非表示になる</figcaption>
<img src="images/00630.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-585">
<section>
<h2 id="calibre_link-139"><b>5-18　レイヤーを移動する</b></h2>
<p>　レイヤーを移動するにはlayerオブジェクトのmove()メソッドを使います。move()メソッドの最初のパラメーターは移動の基準となるレイヤーまたはレイヤーセットを指定します。2番目のパラメーターは以下の表に示す移動するレイヤー／レイヤーセット間の位置を指定します。なお、移動先の位置指定によってはエラーが発生することがあります。</p>
<table>
<caption>【表】移動先の位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>移動先</span>
  </td>
</tr>
<tr>
  <td>ElementPlacement.INSIDE</td>
  <td>内側</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEATBEGINNING</td>
  <td>先頭</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEATEND</td>
  <td>末尾</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEBEFORE</td>
  <td>前</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEAFTER</td>
  <td>後ろ</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーを移動する</p>
<pre><code>// レイヤーを移動する
var srcLayerSetObj = app.activeDocument.layerSets["図形"].layers["レイヤー 1"];    // 移動するレイヤー
var dstLayerSetObj = app.activeDocument.layers[0];    // 基準となるレイヤー（一番上）
srcLayerSetObj.move(dstLayerSetObj, ElementPlacement.PLACEBEFORE);   // 一番上に移動</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00124.jpeg" />
</figure>
<p>　レイヤーセット"図形"内にあるレイヤー"レイヤー 1"が一番上に移動します。</p>
<figure>
<figcaption>【図】レイヤーセット"図形"内にあるレイヤー"レイヤー 1"が一番上に移動する</figcaption>
<img src="images/00403.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-687">
<section>
<h2 id="calibre_link-140"><b>5-19　レイヤーを削除する</b></h2>
<p>　レイヤーを削除するにはlayerオブジェクトのremove()メソッドを使用します。remove()メソッドにはパラメーターはありません。layers配列でレイヤー番号を指定する場合、layers[0]とするとレイヤーパネルの一番上のレイヤーを示すことになります。</p>
<p>【sample】レイヤーを削除する</p>
<pre><code>// レイヤーを削除する
app.activeDocument.layers[0].remove();</code></pre>
<p>　複数のレイヤーがあります。</p>
<figure>
<figcaption>【図】複数のレイヤーがある</figcaption>
<img src="images/00423.jpeg" />
</figure>
<p>　スクリプトを実行すると一番上のレイヤーが削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると一番上のレイヤーが削除される</figcaption>
<img src="images/00587.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-416">
<section>
<h2 id="calibre_link-141"><b>5-20　テキストレイヤーだけ削除する</b></h2>
<p>　テキストレイヤーだけ削除するには、いくつか方法があります。ここではレイヤーの種類に関係なく一度にまとめて全てのレイヤーを取得する関数を作成し利用します。全てのレイヤーを取得するには再帰を使ってlayerオブジェクトを取得します。その際、layerSets配列の数だけ繰り返し処理を行います。取得したレイヤーを配列に入れていき関数の最後で呼び出し元に返します。</p>
<p>　次に得られたレイヤー情報をもとに種類を調べます。レイヤーの種類はkindプロパティに格納されています。レイヤーの種類は表に示すものがあり、テキストレイヤーの場合は、kindプロパティはLayerKind.TEXTの値になります。レイヤーを削除する場合は先頭からではなく末尾から行います。これはレイヤーを削除するremove()メソッドを実行すると動的にレイヤー構成が変化してしまうためです。</p>
<p>　また、ドキュメントにテキストレイヤーが1つしかない場合は削除することができません。この場合、テキストレイヤーを削除するremove()メソッドを実行するとエラーが発生します。これを回避するためtry...catchを使います。</p>
<table>
<caption>【表】レイヤーの種類</caption>
<tbody>
<tr>
  <td>
    <span>種類</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>LayerKind.BLACKANDWHITE</td>
  <td>白黒</td>
</tr>
<tr>
  <td>LayerKind.BRIGHTNESSCONTRAST</td>
  <td>明るさコントラスト</td>
</tr>
<tr>
  <td>LayerKind.CHANNELMIXER</td>
  <td>チャンネルミキサー</td>
</tr>
<tr>
  <td>LayerKind.COLORBALANCE</td>
  <td>カラーバランス</td>
</tr>
<tr>
  <td>LayerKind.CURVES</td>
  <td>トーンカーブ</td>
</tr>
<tr>
  <td>LayerKind.EXPOSURE</td>
  <td>露光量</td>
</tr>
<tr>
  <td>LayerKind.GRADIENTFILL</td>
  <td>グラデーション（塗りつぶしレイヤー）</td>
</tr>
<tr>
  <td>LayerKind.GRADIENTMAP</td>
  <td>グラデーションマップ</td>
</tr>
<tr>
  <td>LayerKind.HUESATURATION</td>
  <td>色相・彩度</td>
</tr>
<tr>
  <td>LayerKind.INVERSION</td>
  <td>階調の反転</td>
</tr>
<tr>
  <td>LayerKind.LEVELS</td>
  <td>レベル補正</td>
</tr>
<tr>
  <td>LayerKind.NORMAL</td>
  <td>通常のレイヤー</td>
</tr>
<tr>
  <td>LayerKind.PATTERNFILL</td>
  <td>パターン（塗りつぶしレイヤー）</td>
</tr>
<tr>
  <td>LayerKind.PHOTOFILTER</td>
  <td>フィルター</td>
</tr>
<tr>
  <td>LayerKind.POSTERIZE</td>
  <td>ポスタライズ</td>
</tr>
<tr>
  <td>LayerKind.SELECTIVECOLOR</td>
  <td>特定色域の選択</td>
</tr>
<tr>
  <td>LayerKind.SMARTOBJECT</td>
  <td>スマートオブジェクト</td>
</tr>
<tr>
  <td>LayerKind.SOLIDFILL</td>
  <td>べた塗り（塗りつぶしレイヤー）</td>
</tr>
<tr>
  <td>LayerKind.TEXT</td>
  <td>テキストレイヤー</td>
</tr>
<tr>
  <td>LayerKind.THRESHOLD</td>
  <td>しきい値</td>
</tr>
<tr>
  <td>LayerKind.LAYER3D</td>
  <td>3Dレイヤー</td>
</tr>
<tr>
  <td>LayerKind.VIBRANCE</td>
  <td>自然な彩度</td>
</tr>
<tr>
  <td>LayerKind.VIDEO</td>
  <td>ビデオレイヤー</td>
</tr>
</tbody>
</table>
<p>【sample】テキストレイヤーだけ削除する</p>
<pre><code>// テキストレイヤーだけ削除する
var list = getAllLayer(app.activeDocument, []);
for(var i=list.length-1; i&gt;=0; i--){
    try{    // 背景がなくテキストレイヤーのみの場合はエラーになるので回避
        if (list[i].kind == LayerKind.TEXT){
            list[i].remove();   // 削除する
        }
    }catch(e){}
}
// レイヤーセットを除く全てのレイヤーオブジェクトを取得する
// IN : レイヤーオブジェクト, 配列オブジェクト
// OUT : レイヤーオブジェクトを格納した配列オブジェクト
function getAllLayer(obj, ary){
    for(var i=0; i&lt;obj.layers.length; i++){
        if (obj.layers[i].kind){    // レイヤーセット以外の場合
            ary.push(obj.layers[i]);
        }else{  // レイヤーセットなので再帰
            getAllLayer(obj.layers[i], ary);
        }
    }
    return ary; // 結果は配列で返す
}</code></pre>
<p>　複数のテキストレイヤーがあります。</p>
<figure>
<figcaption>【図】複数のテキストレイヤーがある</figcaption>
<img src="images/00588.jpeg" />
</figure>
<p>　スクリプトを実行するとテキストレイヤーだけが削除されます。なお、レイヤーセットは残ったままになります。</p>
<figure>
<figcaption>【図】スクリプトを実行するとテキストレイヤーだけが削除される</figcaption>
<img src="images/00125.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-530">
<section>
<h2 id="calibre_link-142"><b>5-21　レイヤーが空っぽかどうか調べる</b></h2>
<p>　レイヤーが空っぽかどうか調べるにはlayerオブジェクトの矩形サイズを利用します。レイヤーに何も描かれていない場合、矩形サイズは左、上、右、下の座標とも全て0になります。サンプルでは念のためUnitValue()で単位をピクセルにした後に単位をカットした後で全ての座標値が0かどうか調べています。なお、レイヤーの座標値は負数の場合もあるので、全て合算した値が0の場合に空っぽのレイヤーだと判断する方法では失敗することがあります。</p>
<p>【sample】レイヤーが空っぽかどうか調べる</p>
<pre><code>// 選択されたレイヤーが空っぽかどうか調べる
var layObj = app.activeDocument.activeLayer;
var rect = layObj.bounds;
var left = parseFloat(UnitValue(rect[0], "px"));
var top = parseFloat(UnitValue(rect[1], "px"));
var right = parseFloat(UnitValue(rect[2], "px"));
var bottom = parseFloat(UnitValue(rect[3], "px"));
if ((left == 0) &amp;&amp; (top == 0) &amp;&amp; (right == 0) &amp;&amp; (bottom == 0)){
    alert("レイヤーは空っぽです");
}else{
    alert("レイヤーには何か描かれています");
}</code></pre>
<p>　空っぽのレイヤーを選択した後にスクリプトを実行するとアラートダイアログには"レイヤーは空っぽです"と表示されます。</p>
<figure>
<figcaption>【図】空っぽのレイヤーを選択した場合</figcaption>
<img src="images/00302.jpeg" />
</figure>
<p>　何か描かれているレイヤーやテキストレイヤーを選択してからスクリプトを実行するとアラートダイアログには"レイヤーには何か描かれています"と表示されます。</p>
<figure>
<figcaption>【図】何か描かれているレイヤーやテキストレイヤーを選択した場合</figcaption>
<img src="images/00435.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-635">
<section>
<h2 id="calibre_link-143"><b>5-22　空っぽのレイヤーを削除する</b></h2>
<p>　空っぽのレイヤーを削除するには、いくつか方法があります。ここでは全てのレイヤーを取得する関数を用意します（詳細については「テキストレイヤーだけ削除する」の項目を参照してください）。また、レイヤーが空っぽかどうか調べる関数も用意します（詳細については「レイヤーが空っぽかどうか調べる」の項目を参照してください）。</p>
<p>　関数で得られた全てのレイヤー情報をもとにレイヤーが空っぽかどうかを調べます。空っぽの場合はレイヤーを削除します。レイヤーを削除する際、先頭からではなく末尾から行います。これはレイヤーを削除するremove()メソッドを実行すると動的にレイヤー構成が変化してしまうためです。また、ドキュメントにレイヤーだけになった場合は削除することができません。この場合、remove()メソッドを実行するとエラーが発生するためtry...catchを使いエラーを回避します。</p>
<p>【sample】空っぽのレイヤーを削除する</p>
<pre><code>// 空っぽのレイヤーを削除する
var list = getAllLayer(app.activeDocument, []);
for(var i=list.length-1; i&gt;=0; i--){
    try{    // 背景がなくレイヤーが1つになった場合はエラーになるので回避
        if (checkEmptyLayer(list[i])){
            list[i].remove();   // 削除
        }
    }catch(e){}
}
// レイヤーセットを除く全てのレイヤーオブジェクトを取得する関数
// IN : レイヤーオブジェクト, 配列オブジェクト
// OUT : レイヤーオブジェクトを格納した配列オブジェクト
function getAllLayer(obj, ary){
    for(var i=0; i&lt;obj.layers.length; i++){
        if (obj.layers[i].kind){    // レイヤーセット以外の場合
            ary.push(obj.layers[i]);
        }else{  // レイヤーセットなので再帰
            getAllLayer(obj.layers[i], ary);
        }
    }
    return ary; // 結果は配列で返す
}
// レイヤーが空っぽかどうか調べる関数
// IN : レイヤーオブジェクト
// OUT : trueなら空っぽ、falseなら画像がある
function checkEmptyLayer(layObj){
    // 選択されたレイヤーが空っぽかどうか調べる
    var rect = layObj.bounds;
    var left = parseFloat(UnitValue(rect[0], "px"));
    var top = parseFloat(UnitValue(rect[1], "px"));
    var right = parseFloat(UnitValue(rect[2], "px"));
    var bottom = parseFloat(UnitValue(rect[3], "px"));
    if ((left == 0) &amp;&amp; (top == 0) &amp;&amp; (right == 0) &amp;&amp; (bottom == 0)){
        return true;    // 空っぽならtrueを返す
    }
    return false;   // レイヤーに何か描かれている場合はfalseを返す
}</code></pre>
<p>　空っぽのレイヤーが3つあります。赤色で示すレイヤーです。</p>
<figure>
<figcaption>【図】空っぽのレイヤーが3つある状態</figcaption>
<img src="images/00570.jpeg" />
</figure>
<p>　スクリプトを実行すると空っぽのレイヤーだけが削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると空っぽのレイヤーだけが削除される</figcaption>
<img src="images/00490.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-19">
<section>
<h2 id="calibre_link-144"><b>5-23　レイヤーの画像を消去する</b></h2>
<p>　レイヤーに表示されている画像を消去するにはlayerオブジェクトのclear()メソッドを使用します。clear()メソッドは指定できるパラメーターはありません。</p>
<p>【sample】レイヤーの画像を消去する</p>
<pre><code>// レイヤー画像を消去する
app.activeDocument.layers["雪の壁"].clear();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00260.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤー名"雪の壁"の画像が消去されます。レイヤー自体は消去されず、そのままになります。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤー名"雪の壁"の画像が消去される</figcaption>
<img src="images/00030.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-589">
<section>
<h2 id="calibre_link-145"><b>5-24　レイヤーの画像をカットする</b></h2>
<p>　レイヤーの画像をカットするにはlayerオブジェクトのcut()メソッドを使います。cut()メソッドには指定できるパラメーターはありません。また、レイヤーの種類によってはカットできず（テキストレイヤーなど）、エラーになることがあります。</p>
<p>【sample】レイヤーの画像をカットする</p>
<pre><code>// レイヤー画像をカットする
app.activeDocument.layers["マット"].cut();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00467.jpeg" />
</figure>
<p>　レイヤー名"マット"の画像がカットされます。</p>
<figure>
<figcaption>【図】レイヤー名"マット"の画像がカットされる</figcaption>
<img src="images/00080.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-506">
<section>
<h2 id="calibre_link-146"><b>5-25　レイヤーの画像をコピーする</b></h2>
<p>　レイヤーの画像をコピーするにはlayerオブジェクトのcopy()メソッドを使います。copy()メソッドのパラメーターに何も指定しないかfalseを指定すると指定されたレイヤー画像だけがコピーされます。trueを指定すると表示レイヤーを結合した状態での画像がコピーされます。</p>
<p>【sample】レイヤーの画像をコピーする</p>
<pre><code>// レイヤー画像をコピーする
app.activeDocument.layers[0].copy();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00626.jpeg" />
</figure>
<p>　スクリプトを実行すると一番上のレイヤーがコピーされます。コピーされた結果は図のようになります。</p>
<figure>
<figcaption>【図】スクリプトを実行すると一番上のレイヤーがコピーされる</figcaption>
<img src="images/00396.jpeg" />
</figure>
<p>　copy()メソッドのパラメーターにtrueを指定した場合、コピーされる内容は図のようになります。</p>
<figure>
<figcaption>【図】copy()メソッドのパラメーターにtrueを指定した場合</figcaption>
<img src="images/00167.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-684">
<section>
<h2 id="calibre_link-147"><b>5-26　レイヤーに画像をペーストする</b></h2>
<p>　レイヤーに画像をペーストするには、あらかじめペーストする場所を指定しておきます。これはアクティブレイヤーを設定すればよく、app.activeDocument.activeLayerに対象となるlayerオブジェクトを設定します。次にapp.activeDocument.paste()としてペーストします。Photoshopでペースト可能ではない画像の場合、エラーで停止します。エラーで停止させたくない場合はサンプルのようにtry...catchを使って回避します。</p>
<p>【sample】レイヤーに画像をペーストする</p>
<pre><code>// 指定したレイヤーに画像をペーストする
app.activeDocument.activeLayer = app.activeDocument.layerSets["マット"].layers["ベース"];
try{
    app.activeDocument.paste();
}catch(e){
    alert("ペーストできません。画像データがコピーされていない可能性があります");
}</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00508.jpeg" />
</figure>
<p>　スクリプトを実行すると指定したレイヤーに画像がペーストされます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると指定したレイヤーに画像がペーストされる</figcaption>
<img src="images/00353.jpeg" />
</figure>
<p>　ペーストできない形式の場合はアラートダイアログが表示されます。</p>
<figure>
<figcaption>【図】ペーストできない形式の場合はアラートダイアログが表示される</figcaption>
<img src="images/00136.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-450">
<section>
<h2 id="calibre_link-148"><b>5-27　レイヤーの画像の位置を変更する</b></h2>
<p>　レイヤーの画像の位置を変更するにはlayerオブジェクトのtranslate()メソッドを使います。translate()メソッドの最初のパラメーターに水平方向の移動量を、2番目のパラメーターに垂直方向の移動量を指定します。指定できる値はUnitValue形式なのでUnitValue(10, "cm")とすると10cmになります。</p>
<p>【sample】レイヤーの画像の位置を変更する</p>
<pre><code>// レイヤー画像を移動する
var dx = UnitValue(100, "px");   // 100px
var dy = UnitValue(3, "cm");    // 3cm
app.activeDocument.layers["マット"].translate(dx, dy);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00273.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤー名"マット"の画像が中央に移動します。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤー名"マット"の画像が中央に移動する</figcaption>
<img src="images/00411.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-526">
<section>
<h2 id="calibre_link-149"><b>5-28　レイヤーの画像を指定した座標に移動する</b></h2>
<p>　レイヤーの画像を指定した座標に移動するには現在のレイヤー座標を取得して原点に移動させます。これはtranslate()メソッドを使って行います。現在のレイヤーの座標値はlayerオブジェクトのbounds配列に入っています。配列と座標の対応は「【表】bounds配列と座標の対応」のようになります。原点に移動させた後に再度translate()メソッドを使って指定された座標に移動させます。なお、単位が同じ場合はtranslate()メソッドの処理を1つにした方が高速です。</p>
<table>
<caption>【表】bounds配列と座標の対応</caption>
<tbody>
<tr>
  <td>
    <span>値</span>
  </td>
  <td>
    <span>座標</span>
  </td>
</tr>
<tr>
  <td>0</td>
  <td>左座標/Left（UnitValue形式）</td>
</tr>
<tr>
  <td>1</td>
  <td>上座標/Top（UnitValue形式）</td>
</tr>
<tr>
  <td>2</td>
  <td>右座標/Right（UnitValue形式）</td>
</tr>
<tr>
  <td>3</td>
  <td>下座標/Bottom（UnitValue形式）</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーの画像を指定した座標に移動する</p>
<pre><code>// レイヤーの画像を指定した座標に移動する
var textLayer = app.activeDocument.artLayers["テロップ"];
moveLayerToXY(textLayer, "2.95cm", "100px");
// 指定した座標に移動する関数
// 単位はUnitValueで自動計算
function moveLayerToXY(layObj, x, y){
    var cx = layObj.bounds[0];   // 左座標。単位付き
    var cy = layObj.bounds[1];   // 上座標。単位付き
    layObj.translate( -cx, -cy ); // 原点に移動
    layObj.translate( UnitValue(x), UnitValue(y) ); // 指定座標に移動
}</code></pre>
<p>　一番上にあるテキストレイヤー（レイヤー名"テロップ"）を指定した座標に移動させます。</p>
<figure>
<figcaption>【図】一番上にあるテキストレイヤーを指定した座標に移動させる</figcaption>
<img src="images/00548.jpeg" />
</figure>
<p>　テキストレイヤーが指定した座標に移動します。</p>
<figure>
<figcaption>【図】テキストレイヤーが指定した座標に移動する</figcaption>
<img src="images/00486.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-633">
<section>
<h2 id="calibre_link-150"><b>5-29　レイヤーの画像のサイズを変更する（リサイズ）</b></h2>
<p>　レイヤーの画像のサイズを変更するにはlayerオブジェクトのresize()メソッドを使います。resize()メソッドの最初のパラメーターに水平方向の倍率を、2番目のパラメーターに垂直方向の倍率を指定します。100を指定すると100%で等倍になります。50であれば50%で半分のサイズになります。水平方向、垂直方向のパラメーターは省略できますが、省略した場合は何も変化しません。</p>
<p>　resize()メソッドの3番目のパラメーターにはサイズ変更時の基準位置を指定します。指定できる値を表に示します。なお、resize()メソッドの3番目のパラメーターは省略することができます。</p>
<table>
<caption>【表】サイズ調整時の基準位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>基準位置</span>
  </td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMCENTER</td>
  <td>中央下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMLEFT</td>
  <td>左下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMRIGHT</td>
  <td>右下</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLECENTER</td>
  <td>中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLELEFT</td>
  <td>左辺中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLERIGHT</td>
  <td>右辺中央</td>
</tr>
<tr>
  <td>AnchorPosition.TOPCENTER</td>
  <td>中央上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPLEFT</td>
  <td>左上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPRIGHT</td>
  <td>右上</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーの画像のサイズを変更する（リサイズ）</p>
<pre><code>// レイヤー画像の大きさを変更する（リサイズ）
app.activeDocument.layers["マット"].resize(
    300,    // 水平方向のスケール
    80, // 垂直方向のスケール
    AnchorPosition.MIDDLECENTER // 基準位置
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00177.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤー名"マット"の画像のサイズが変わります。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤー名"マット"の画像のサイズが変わる</figcaption>
<img src="images/00319.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-16">
<section>
<h2 id="calibre_link-151"><b>5-30　レイヤーの画像を回転させる</b></h2>
<p>　レイヤーの画像を回転させるにはlayerオブジェクトのrotate()メソッドを使います。rotate()メソッドの最初のパラメーターに回転角度を指定します。正数の場合は時計回りに回転し、負数の場合は反時計回りに回転します。rotate()メソッドの2番目のパラメーターには回転の基準位置を指定します。指定できる値を表に示します。なお、rotate()メソッドの2番目のパラメーターは省略することができます。</p>
<table>
<caption>【表】回転の基準位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>基準位置</span>
  </td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMCENTER</td>
  <td>中央下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMLEFT</td>
  <td>左下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMRIGHT</td>
  <td>右下</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLECENTER</td>
  <td>中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLELEFT</td>
  <td>左辺中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLERIGHT</td>
  <td>右辺中央</td>
</tr>
<tr>
  <td>AnchorPosition.TOPCENTER</td>
  <td>中央上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPLEFT</td>
  <td>左上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPRIGHT</td>
  <td>右上</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーの画像を回転させる</p>
<pre><code>// レイヤー画像を回転する
app.activeDocument.layers["雪の壁"].rotate(
    45, // 回転角度
    AnchorPosition.MIDDLECENTER // 回転の基準位置
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00449.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤー名"雪の壁"の画像が時計回りに45度回転します。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤー名"雪の壁"の画像が時計回りに45度回転する</figcaption>
<img src="images/00212.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-613">
<section>
<h2 id="calibre_link-152"><b>5-31　レイヤーが移動しないようにロックする／解除する（位置ロック）</b></h2>
<p>　レイヤーがマウス操作で間違って移動しないようにロックするにはlayerオブジェクトのpositionLockedプロパティにtrueを指定します。逆にロックを解除する場合はfalseを指定します。</p>
<p>【sample】レイヤーが移動しないようにロックする／解除する（位置ロック）</p>
<pre><code>// レイヤーの位置をロック
app.activeDocument.layers["マット"].positionLocked = true;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00073.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤー名"マット"のレイヤーの位置ロックが設定されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤー名"マット"のレイヤーの位置ロックが設定される</figcaption>
<img src="images/00392.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-456">
<section>
<h2 id="calibre_link-153"><b>5-32　レイヤーをロックする／ロックを解除する</b></h2>
<p>　レイヤーをロックするにはlayerオブジェクトのallLockedプロパティにtrueを指定します。逆にロックを解除する場合はfalseを指定します。</p>
<p>【sample】レイヤーをロックする／ロックを解除する</p>
<pre><code>// レイヤーをロックする
app.activeDocument.layers["白マット"].allLocked = true;</code></pre>
<p>　レイヤー名"白マット"のレイヤーはロックされていない状態です。</p>
<figure>
<figcaption>【図】レイヤー名"白マット"のレイヤーはロックされていない</figcaption>
<img src="images/00162.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤー名"白マット"のレイヤーがロックされます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤー名"白マット"のレイヤーがロックされる</figcaption>
<img src="images/00620.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-457">
<section>
<h2 id="calibre_link-154"><b>5-33　レイヤーのピクセルをロックする／解除する</b></h2>
<p>　レイヤーのピクセルをロックするにはlayerオブジェクトのpixelsLockedプロパティにtrueを設定します。ピクセルのロックを解除する場合はpixelsLockedプロパティにfalseを設定します。</p>
<p>【sample】レイヤーのピクセルをロックする／解除する</p>
<pre><code>// レイヤーのピクセルをロックする
app.activeDocument.layers["マット"].pixelsLocked = true;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00111.jpeg" />
</figure>
<p>　レイヤー名"マット"のピクセルがロックされます。</p>
<figure>
<figcaption>【図】レイヤー名"マット"のピクセルがロックされる</figcaption>
<img src="images/00252.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-558">
<section>
<h2 id="calibre_link-155"><b>5-34　レイヤーの透明ピクセルをロックする／解除する</b></h2>
<p>　レイヤーの透明ピクセルをロックするにはlayerオブジェクトのtransparentPixelsLockedプロパティにtrueを設定します。透明ピクセルのロックを解除する場合はtransparentPixelsLockedプロパティにfalseを設定します。</p>
<p>【sample】レイヤーの透明ピクセルをロックする／解除する</p>
<pre><code>// レイヤーの透明ピクセルをロックする
app.activeDocument.layers["マット"].transparentPixelsLocked = true;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00389.jpeg" />
</figure>
<p>　レイヤー名"マット"の透明ピクセルがロックされます。</p>
<figure>
<figcaption>【図】レイヤー名"マット"の透明ピクセルがロックされる</figcaption>
<img src="images/00523.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-663">
<section>
<h2 id="calibre_link-156"><b>5-35　レイヤーの矩形サイズを取得する</b></h2>
<p>　レイヤーの矩形サイズを取得するにはlayerオブジェクトのbounds配列を参照します。配列にはエフェクト効果を含めた座標値が「左、上、右、下」の順番で格納されています。格納されている値はUnitValue形式になっています。</p>
<p>　Photoshop CC以降ではレイヤーのエフェクトを含まない矩形サイズを取得することができます。この場合、boundsNoEffects配列を読み出します。bounds配列同様に座標値は「左、上、右、下」の順番で格納されており、UnitValue形式になっています。</p>
<p>【sample】レイヤーの矩形サイズを取得する</p>
<pre><code>// レイヤーの矩形サイズを表示する
var layObj = app.activeDocument.layers["御射鹿池"];
var rect = layObj.bounds;
var rectFx = layObj.boundsNoEffects;
alert(rect);
alert(rectFx);</code></pre>
<p>　レイヤー名"御射鹿池"のレイヤーサイズを取得します。</p>
<figure>
<figcaption>【図】レイヤー名"御射鹿池"のレイヤーサイズを取得する</figcaption>
<img src="images/00272.jpeg" />
</figure>
<p>　Photoshop CS6でスクリプトを実行するとエフェクトを含むレイヤーサイズがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】Photoshop CS6で実行するとエフェクトを含むレイヤーサイズが表示される</figcaption>
<img src="images/00151.jpeg" />
</figure>
<p>　続いてアラートダイアログが表示されますが、Photoshop CS6ではboundsNoEffectsが存在しないためundefinedと表示されます。</p>
<figure>
<figcaption>【図】Photoshop CS6ではboundsNoEffectsが存在しないためundefinedと表示される</figcaption>
<img src="images/00536.jpeg" />
</figure>
<p>　同じスクリプトをPhotoshop CC/CC2014で実行するとレイヤーエフェクトを含まない状態のサイズがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】Photoshop CC/CC2014で実行するとレイヤーエフェクトを含まない状態のサイズが表示される</figcaption>
<img src="images/00562.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-706">
<section>
<h2 id="calibre_link-157"><b>5-36　レイヤーの合成モードを変更する</b></h2>
<p>　レイヤーの合成モードを変更するにはlayerオブジェクトのblendModeプロパティに以下の表に示す値を指定します。</p>
<table>
<caption>【表】合成モードの種類</caption>
<tbody>
<tr>
  <td>
    <span>値</span>
  </td>
  <td>
    <span>モード</span>
  </td>
</tr>
<tr>
  <td>BlendMode.COLORBLEND</td>
  <td>カラー</td>
</tr>
<tr>
  <td>BlendMode.COLORBURN</td>
  <td>焼き込みカラー</td>
</tr>
<tr>
  <td>BlendMode.COLORDODGE</td>
  <td>覆焼きカラー</td>
</tr>
<tr>
  <td>BlendMode.DARKEN</td>
  <td>比較（暗）</td>
</tr>
<tr>
  <td>BlendMode.DIFFERENCE</td>
  <td>差の絶対値</td>
</tr>
<tr>
  <td>BlendMode.DISSOLVE</td>
  <td>ディザ合成</td>
</tr>
<tr>
  <td>BlendMode.DIVIDE</td>
  <td>除算</td>
</tr>
<tr>
  <td>BlendMode.EXCLUSION</td>
  <td>除外</td>
</tr>
<tr>
  <td>BlendMode.HARDLIGHT</td>
  <td>ハードライト</td>
</tr>
<tr>
  <td>BlendMode.HARDMIX</td>
  <td>ハードミックス</td>
</tr>
<tr>
  <td>BlendMode.HUE</td>
  <td>色相</td>
</tr>
<tr>
  <td>BlendMode.LIGHTEN</td>
  <td>比較（明）</td>
</tr>
<tr>
  <td>BlendMode.LINEARBURN</td>
  <td>焼き込み（リニア）</td>
</tr>
<tr>
  <td>BlendMode.LINEARDODGE</td>
  <td>覆焼き（リニア）-加算</td>
</tr>
<tr>
  <td>BlendMode.LINEARLIGHT</td>
  <td>リニアライト</td>
</tr>
<tr>
  <td>BlendMode.LUMINOSITY</td>
  <td>輝度</td>
</tr>
<tr>
  <td>BlendMode.MULTIPLY</td>
  <td>乗算</td>
</tr>
<tr>
  <td>BlendMode.NORMAL</td>
  <td>通常</td>
</tr>
<tr>
  <td>BlendMode.OVERLAY</td>
  <td>オーバーレイ</td>
</tr>
<tr>
  <td>BlendMode.PASSTHROUGH</td>
  <td>通過</td>
</tr>
<tr>
  <td>BlendMode.PINLIGHT</td>
  <td>ピンライト</td>
</tr>
<tr>
  <td>BlendMode.SATURATION</td>
  <td>彩度</td>
</tr>
<tr>
  <td>BlendMode.SCREEN</td>
  <td>スクリーン</td>
</tr>
<tr>
  <td>BlendMode.SOFTLIGHT</td>
  <td>ソフトライト</td>
</tr>
<tr>
  <td>BlendMode.SUBTRACT</td>
  <td>減算</td>
</tr>
<tr>
  <td>BlendMode.VIVIDLIGHT</td>
  <td>ビビッドライト</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーの合成モードを変更する</p>
<pre><code>// レイヤーの合成モードを指定する
app.activeDocument.layers[0].blendMode = BlendMode.MULTIPLY; // 乗算モード</code></pre>
<p>　スクリプトを実行する前の状態です。一番上のテキストレイヤーの合成モードは「通常」になっています。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00067.jpeg" />
</figure>
<p>　スクリプトを実行すると一番上のレイヤーの合成モードが「乗算」になります。</p>
<figure>
<figcaption>【図】スクリプトを実行すると一番上のレイヤーの合成モードが「乗算」になる</figcaption>
<img src="images/00450.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-499">
<section>
<h2 id="calibre_link-158"><b>5-37　レイヤーがクリッピングされているかどうか調べる</b></h2>
<p>　レイヤーがクリッピングされている（下の画像とのクリッピングマスク）かどうか調べるにはlayerオブジェクトのgroupedプロパティを参照します。値がtrueの場合はクリッピングされている、falseの場合はクリッピングされていないレイヤーになります。</p>
<p>【sample】レイヤーがクリッピングされているかどうか調べる</p>
<pre><code>// アクティブレイヤーがクリッピングされているかどうか調べる
var flag = app.activeDocument.activeLayer.grouped;
alert(flag);</code></pre>
<p>　写真のレイヤーがアクティブになっておりクリッピングマスクされています。</p>
<figure>
<figcaption>【図】写真のレイヤーがアクティブで、クリッピングマスクされている</figcaption>
<img src="images/00192.jpeg" />
</figure>
<p>　スクリプトを実行するとアラートダイアログにはtrueが表示されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとアラートダイアログにはtrueが表示される</figcaption>
<img src="images/00579.jpeg" />
</figure>
<p>　通常のレイヤーがアクティブになっている状態です。</p>
<figure>
<figcaption>【図】通常のレイヤーがアクティブな状態</figcaption>
<img src="images/00142.jpeg" />
</figure>
<p>　このレイヤーはクリッピングマスクされてないためスクリプトを実行するとアラートダイアログにはfalseが表示されます。</p>
<figure>
<figcaption>【図】このレイヤーはクリッピングマスクされてないため、falseが表示される</figcaption>
<img src="images/00596.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-610">
<section>
<h2 id="calibre_link-159"><b>5-38　レイヤー全体の不透明度を変更する</b></h2>
<p>　レイヤー全体の不透明度を変更するにはlayerオブジェクトのopacityプロパティに値を設定します。設定できる値は0～100までになります。80を指定した場合、不透明度は80%に設定されます。</p>
<p>【sample】レイヤー全体の不透明度を変更する</p>
<pre><code>// レイヤー全体の不透明度を指定する
app.activeDocument.layers["富士山画像"].opacity = 20;</code></pre>
<p>　ここではレイヤー名"富士山画像"の不透明度を変えます。スクリプトを実行する前の状態では100%になっています。</p>
<figure>
<figcaption>【図】スクリプト実行前の状態では100%になっている</figcaption>
<img src="images/00083.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤー名"富士山画像"のレイヤー全体の不透明度が20%になります。</p>
<figure>
<figcaption>【図】レイヤー名"富士山画像"のレイヤー全体の不透明度が20%になる</figcaption>
<img src="images/00393.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-709">
<section>
<h2 id="calibre_link-160"><b>5-39　レイヤーの塗りの不透明度を変更する</b></h2>
<p>　レイヤーの塗りの不透明度を変更するにはlayerオブジェクトのfillOpacityプロパティに0～100までの数値を指定します。0を指定すると完全な透明に、100を指定すると完全な不透明になります。塗りの不透明度を変更してもレイヤーエフェクトの不透明度などは影響されません。</p>
<p>【sample】レイヤーの塗りの不透明度を変更する</p>
<pre><code>// 塗りの不透明度を変更する
app.activeDocument.layers["タイトル文字"].fillOpacity = 20;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00045.jpeg" />
</figure>
<p>　スクリプトを実行すると文字が表示されているレイヤーの塗りの不透明度が変わります。なお、レイヤー効果の不透明度は変化しません。</p>
<figure>
<figcaption>【図】スクリプトを実行すると文字が表示されているレイヤーの塗りの不透明度が変わる</figcaption>
<img src="images/00498.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-452">
<section>
<h2 id="calibre_link-161"><b>5-40　レイヤーマスクの不透明度を指定する</b></h2>
<p>　レイヤーマスクの不透明度を指定するにはlayerオブジェクトのlayerMaskDensityプロパティに0～100までの数値を指定します。0を指定するとレイヤーマスクが完全な透明に、100を指定すると完全な不透明になります。</p>
<p>【sample】レイヤーマスクの不透明度を指定する</p>
<pre><code>// レイヤーマスクの不透明度を変更する
app.activeDocument.layers["節分草"].layerMaskDensity = 30;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00122.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤーマスクの不透明度が変わります。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤーマスクの不透明度が変わる</figcaption>
<img src="images/00127.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-34">
<section>
<h2 id="calibre_link-162"><b>5-41　レイヤーマスクのぼかし幅を指定する</b></h2>
<p>　レイヤーマスクのぼかし幅を指定するにはlayerオブジェクトのlayerMaskFeatherプロパティに数値を指定します。数値が大きいほどぼかし具合が大きくなります。</p>
<p>【sample】レイヤーマスクのぼかし幅を指定する</p>
<pre><code>// レイヤーマスクのぼかし幅を変更する
app.activeDocument.layers["チューリップ"].layerMaskFeather = 10;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00266.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤーマスクのぼかし幅が変わります。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤーマスクのぼかし幅が変わる</figcaption>
<img src="images/00402.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-657">
<section>
<h2 id="calibre_link-163"><b>5-42　レイヤーをリンクする</b></h2>
<p>　レイヤーをリンクするにはlayerオブジェクトのlink()メソッドを使います。link()メソッドのパラメーターにリンクしたいlayerオブジェクトまたはLayerSetオブジェクトを指定します。</p>
<p>【sample】レイヤーをリンクする</p>
<pre><code>// レイヤーをリンクする
var docObj = app.activeDocument;
var layer1 = docObj.layers["白マット1"];
var layer2 = docObj.layers["白マット2"];
layer1.link(layer2);    // 2つのレイヤーをリンク</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00062.jpeg" />
</figure>
<p>　レイヤーセット"白マット1"と"白マット2"がリンクされます。</p>
<figure>
<figcaption>【図】レイヤーセット"白マット1"と"白マット2"がリンクされる</figcaption>
<img src="images/00540.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-695">
<section>
<h2 id="calibre_link-164"><b>5-43　レイヤーのリンクを解除する</b></h2>
<p>　レイヤーのリンクを解除するにはlayerオブジェクトのunlink()メソッドを使います。unlink()メソッドを使うとリンクされているレイヤーセットおよびレイヤーが全てリンク解除されます。unlink()メソッドにはパラメーターがなく、指定したレイヤーセットおよびレイヤーだけリンク解除することはできません。</p>
<p>【sample】レイヤーのリンクを解除する</p>
<pre><code>// レイヤーのリンクを解除する
app.activeDocument.layers["白マット1"].unlink();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00253.jpeg" />
</figure>
<p>　レイヤーセット"白マット1"のリンクが解除されます。</p>
<figure>
<figcaption>【図】レイヤーセット"白マット1"のリンクが解除される</figcaption>
<img src="images/00321.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-502">
<section>
<h2 id="calibre_link-165"><b>5-44　レイヤーのリンク先を調べる</b></h2>
<p>　レイヤーのリンク先を調べるにはlayerオブジェクトのlinkedLayers配列を参照します。linkedLayers配列にはリンクされているLayerSetオブジェクトおよびlayerオブジェクトへの参照が入っています。リンクされているレイヤーセットおよびレイヤー名を表示したい場合はlinkedLayers配列の内容を1つずつ読み出しnameプロパティを参照します。</p>
<p>【sample】レイヤーのリンク先を調べる</p>
<pre><code>// レイヤーのリンク先を調べる
var text = "";
var targetLayer = app.activeDocument.layerSets["グループ 1"].layers["ホワイトバー"].linkedLayers;
for(var i=0; i&lt;targetLayer.length; i++){
    text = text + targetLayer[i].name+"\n"; // リンク先レイヤー名を取得
}
alert(text);</code></pre>
<p>　レイヤーセット"テキスト"でリンクされているレイヤーセットおよびレイヤー名がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】レイヤーセット"テキスト"でリンクされているレイヤーセットおよびレイヤー名が表示される</figcaption>
<img src="images/00438.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-608">
<section>
<h2 id="calibre_link-166"><b>5-45　レイヤーをラスタライズする</b></h2>
<p>　レイヤーをラスタライズするにはlayerオブジェクトのrasterize()メソッドを使います。rasterize()メソッドのパラメーターには以下の表に示す値を指定します。なお、ラスタライズするレイヤーで処理可能な値が指定されていない場合はエラーになります。エラーを回避するにはtry...catchを使います。</p>
<table>
<caption>【表】ラスタライズする種類</caption>
<tbody>
<tr>
  <td>
    <span>値</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>RasterizeType.ENTIRELAYER</td>
  <td>レイヤー</td>
</tr>
<tr>
  <td>RasterizeType.FILLCONTENT</td>
  <td>塗りつぶし内容</td>
</tr>
<tr>
  <td>RasterizeType.LAYERCLIPPINGPATH</td>
  <td>クリッピングパス</td>
</tr>
<tr>
  <td>RasterizeType.LINKEDLAYERS</td>
  <td>リンクレイヤー</td>
</tr>
<tr>
  <td>RasterizeType.SHAPE</td>
  <td>シェイプ</td>
</tr>
<tr>
  <td>RasterizeType.TEXTCONTENTS</td>
  <td>テキスト</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーをラスタライズする</p>
<pre><code>// テキストレイヤーをラスタライズする（レイヤーセットは考慮しない）
var layerList = app.activeDocument.layers;
for(var i=layerList.length-1; i&gt;=0; i--){
    try{    // レイヤーの種類によってエラーになるのでtry...catchで回避
        layerList[i].rasterize(RasterizeType.TEXTCONTENTS);
    }catch(e){}
}</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00576.jpeg" />
</figure>
<p>　スクリプトを実行するとテキストレイヤーだけがラスタライズされます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとテキストレイヤーだけがラスタライズされる</figcaption>
<img src="images/00616.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-707">
<section>
<h2 id="calibre_link-167"><b>5-46　表示されているレイヤーを結合する</b></h2>
<p>　表示されているレイヤーを結合するにはdocumentオブジェクトのmergeVisibleLayers()メソッドを使います。mergeVisibleLayers()メソッドは表示されているレイヤーのみ結合し、表示されていないレイヤーはそのまま残します。また、mergeVisibleLayers()メソッド実行時に非表示のレイヤーが選択されているとエラーになります。なお、mergeVisibleLayers()メソッドにはパラメーターはありません。</p>
<p>【sample】表示されているレイヤーを結合する</p>
<pre><code>// 表示レイヤーを統合する
app.activeDocument.mergeVisibleLayers();</code></pre>
<p>　画像を統合する前の状態です。表示されているレイヤーと表示されていないレイヤーがあります。実行前に表示されているレイヤーを選択しておきます。</p>
<figure>
<figcaption>【図】画像を統合する前の状態</figcaption>
<img src="images/00207.jpeg" />
</figure>
<p>　表示されているレイヤーだけが結合されます。</p>
<figure>
<figcaption>【図】表示されているレイヤーだけが結合される</figcaption>
<img src="images/00545.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-448">
<section>
<h2 id="calibre_link-168"><b>5-47　全てのレイヤーを統合する</b></h2>
<p>　全てのレイヤーを統合するにはdocumentオブジェクトのflatten()メソッドを使います。flatten()メソッドにはパラメーターはありません。</p>
<p>【sample】全てのレイヤーを統合する</p>
<pre><code>// 全てのレイヤーを統合する
app.activeDocument.flatten();</code></pre>
<p>　全てのレイヤーを統合する前の状態です。</p>
<figure>
<figcaption>【図】全てのレイヤーを統合する前の状態</figcaption>
<img src="images/00571.jpeg" />
</figure>
<p>　全てのレイヤーが統合され1つの背景のみになります。</p>
<figure>
<figcaption>【図】全てのレイヤーが統合され1つの背景のみになる</figcaption>
<img src="images/00608.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-555">
<section>
<h2 id="calibre_link-169"><b>5-48　指定した名前のレイヤーが複数ある場合に配列として返す</b></h2>
<p>　指定した名前のレイヤーが複数ある場合に配列として返すには、いくつか方法があります。ここでは全てのレイヤーを取得する関数を用意します。（詳細については「テキストレイヤーだけ削除する」の項目を参照してください）　</p>
<p>　関数で得られた全てのレイヤー情報をもとにレイヤーの名前を調べます。一致する名前の場合、layerオブジェクトを配列にpush()メソッドを使って入れておきます。全てのレイヤーを調べ終われば配列には指定した名前のレイヤー情報が入ります。サンプルではgetLayerNameList()関数を作成し指定した名前を持つレイヤーを配列で返すようにしています。</p>
<p>【sample】指定した名前のレイヤーが複数ある場合に配列として返す</p>
<pre><code>// 指定した名前のレイヤーを取得する
var lay1 = getLayerNameList("テロップ");
alert("テロップという名前のレイヤーは"+lay1.length+"個ありました");
var lay2 = getLayerNameList("背景");
alert("背景という名前のレイヤーは"+lay2.length+"個ありました");
var lay3 = getLayerNameList("タイトル");
alert("タイトルという名前のレイヤーは"+lay3.length+"個ありました");
// 指定した名前のレイヤーオブジェクトを配列で返す
// IN : 取得するレイヤー名（文字列）
// OUT : 指定した名前を持つレイヤーオブジェクトを格納した配列
function getLayerNameList(layerName){
    var list = getAllLayer(app.activeDocument, []);
    var result = [];    // 結果を入れる配列
    for(var i=0; i&lt;list.length; i++){
        if (list[i].name == layerName){
            result.push(list[i]);
        }
    }
    return result;
    // レイヤーセットを除く全てのレイヤーオブジェクトを取得する
    // IN : レイヤーオブジェクト, 配列オブジェクト
    // OUT : レイヤーオブジェクトを格納した配列オブジェクト
    function getAllLayer(obj, ary){
        for(var i=0; i&lt;obj.layers.length; i++){
            if (obj.layers[i].kind){    // レイヤーセット以外の場合
                ary.push(obj.layers[i]);
            }else{  // レイヤーセットなので再帰
                getAllLayer(obj.layers[i], ary);
            }
        }
        return ary; // 結果は配列で返す
    }
}</code></pre>
<p>　複数のレイヤーがあります。同じ名前のレイヤーもいくつかあります（テロップ、背景）。</p>
<figure>
<figcaption>【図】複数のレイヤーがあり、同じ名前のレイヤーもある</figcaption>
<img src="images/00100.jpeg" />
</figure>
<p>　スクリプトを実行すると指定した名前のレイヤーの個数が表示されます。</p>
<figure>
<figcaption>【図】指定した名前のレイヤーの個数が表示される（テロップという名前）</figcaption>
<img src="images/00243.jpeg" />
</figure>
<figure>
<figcaption>【図】指定した名前のレイヤーの個数が表示される（背景という名前）</figcaption>
<img src="images/00086.jpeg" />
</figure>
<figure>
<figcaption>【図】指定した名前のレイヤーの個数が表示される（タイトルという名前）</figcaption>
<img src="images/00130.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-488">
<section>
<h2 id="calibre_link-170"><b>5-49　テキストの内容にテキストレイヤーの名前をあわせる</b></h2>
<p>　テキストの内容にテキストレイヤーの名前をあわせるには、いくつかの方法があります。ここでは、全てのレイヤーをまとめて取得した後にテキストレイヤーのみ名前を変更します。テキストレイヤーに表示されている文字（内容）はtextItem.contentsプロパティに入っています。この内容をlayerオブジェクトのnameプロパティに入れます。</p>
<p>　内容が長い場合に、先頭の8文字だけを名前にしたい場合はtextItem.contents.substr(0, 8)をnameプロパティに入れます。</p>
<p>【sample】テキストの内容にテキストレイヤーの名前をあわせる</p>
<pre><code>// テキストの内容にテキストレイヤーの名前をあわせる
var list = getAllLayer(app.activeDocument, []);
for(var i=0; i&lt;list.length; i++){
    if (list[i].kind == LayerKind.TEXT){
        list[i].name = list[i].textItem.contents;    // 内容をそのまま名前にする
    }
}
// レイヤーセットを除く全てのレイヤーオブジェクトを取得する
// IN : レイヤーオブジェクト, 配列オブジェクト
// OUT : レイヤーオブジェクトを格納した配列オブジェクト
function getAllLayer(obj, ary){
    for(var i=0; i&lt;obj.layers.length; i++){
        if (obj.layers[i].kind){    // レイヤーセット以外の場合
            ary.push(obj.layers[i]);
        }else{  // レイヤーセットなので再帰
            getAllLayer(obj.layers[i], ary);
        }
    }
    return ary; // 結果は配列で返す
}</code></pre>
<p>　複数のテキストレイヤーがあります。</p>
<figure>
<figcaption>【図】複数のテキストレイヤーがある</figcaption>
<img src="images/00275.jpeg" />
</figure>
<p>　スクリプトを実行するとテキストレイヤーの名前がテキスト内容と同じになります。</p>
<figure>
<figcaption>【図】スクリプトを実行するとテキストレイヤーの名前がテキスト内容と同じになる</figcaption>
<img src="images/00039.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-642">
<section>
<h2 id="calibre_link-171"><b>5-50　全てのレイヤー名をファイルに書き出す（レイヤーセットは含まない）</b></h2>
<p>　全てのレイヤー名をファイルに書き出すには、File.saveDialog()メソッドまたはFileオブジェクトを利用して保存先と保存ファイル名を指定します。次に全てのレイヤーを取得する関数を用意します。（詳細については「テキストレイヤーだけ削除する」の項目を参照してください）</p>
<p>　関数で得られた全てのレイヤー名をファイルに書き出すには、まずopen()メソッドを使って書き込めるかどうか調べます。open()の戻り値がtrueなら書き込み可能、falseなら書き込めないことになります。書き込みが可能な場合はFileオブジェクトのwriteln()メソッドを使ってレイヤー名を書き出します。レイヤー名はwriteln()メソッドのパラメーターとして指定します。</p>
<p>　全てのレイヤー名を書き出すにはfor命令を使います。書き出しが終わったらFileオブジェクトのclose()メソッドを使ってファイルの書き込みを終了します。なお、close()メソッドを使用しなくても処理が終了すると自動的にファイルは閉じられますので書き忘れても動作には影響はありません。</p>
<p>　サンプルでは「var fileObj = File.saveDialog("保存ファイル名を指定してください", "result.txt");」としてユーザーに保存するファイル名を指定するようにしていますが、ダイアログを表示せずに特定のフォルダに保存したい場合は「var fileObj = new File("～/Desktop/result.txt")」のようにFileオブジェクトを使って処理します。</p>
<p>【sample】全てのレイヤー名をファイルに書き出す（レイヤーセットは含まない）</p>
<pre><code>// 全てのレイヤー名をファイルに書き出す
var fileObj = File.saveDialog("保存ファイル名を指定してください", "result.txt");
if (fileObj != null){  // 保存先が指定された
    var flag = fileObj.open("w");   // 書き込みモードで開く
    if (flag){  // 書き込める状態の場合は以下の処理を行う
        var list = getAllLayer(app.activeDocument, []); // 全てのレイヤーを取得する
        for(var i=0; i&lt;list.length; i++){
            fileObj.writeln(list[i].name);  // レイヤー名を書き出す
        }
        fileObj.close();    // ファイルを閉じる
    }else{
        alert("ファイルが開けません。書き込み禁止になっていないか確認してください");
    }
}
 // レイヤーセットを除く全てのレイヤーオブジェクトを取得する
// IN : レイヤーオブジェクト, 配列オブジェクト
// OUT : レイヤーオブジェクトを格納した配列オブジェクト
function getAllLayer(obj, ary){
    for(var i=0; i&lt;obj.layers.length; i++){
        if (obj.layers[i].kind){    // レイヤーセット以外の場合
            ary.push(obj.layers[i]);
        }else{  // レイヤーセットなので再帰
            getAllLayer(obj.layers[i], ary);
        }
    }
    return ary; // 結果は配列で返す
}</code></pre>
<p>　レイヤー／レイヤーセットが複数あります。</p>
<figure>
<figcaption>【図】レイヤー／レイヤーセットが複数ある</figcaption>
<img src="images/00239.jpeg" />
</figure>
<p>　ファイル保存ダイアログが表示されるので保存先のフォルダとファイル名を入力します。</p>
<figure>
<figcaption>【図】保存先のフォルダとファイル名を入力する</figcaption>
<img src="images/00231.jpeg" />
</figure>
<p>　ファイルが保存されます。内容はレイヤー名がフラットに書き出されます。</p>
<figure>
<figcaption>【図】ファイルが保存され、内容はレイヤー名がフラットに書き出される</figcaption>
<img src="images/00316.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-430">
<section>
<h2 id="calibre_link-172"><b>5-51　全てのレイヤーセットとレイヤー名をファイルに書き出す</b></h2>
<p>　全てのレイヤーセットとレイヤー名をファイルに書き出すには、File.saveDialog()メソッドまたはFileオブジェクトを利用して保存先と保存ファイル名を指定します。次に全てのレイヤーとレイヤーセットを取得する関数を用意します（詳細については「テキストレイヤーだけ削除する」の項目を参照してください）。</p>
<p>　関数で得られた全てのレイヤーとレイヤーセット名をファイルに書き出すには、まずopen()メソッドを使って書き込めるかどうか調べます。open()の戻り値がtrueなら書き込み可能、falseなら書き込めないことになります。書き込みが可能な場合はFileオブジェクトのwriteln()メソッドを使ってレイヤー名を書き出します。レイヤー名はwriteln()メソッドのパラメーターとして指定します。レイヤーセットの場合は通常のレイヤーと区別するためレイヤーセット名の前に　を書き出します。改行せずに書き出すにはwrite()メソッドを使います。レイヤーセットかどうかはkindプロパティがあるかないかで調べます。</p>
<p>　全てのレイヤーとレイヤーセット名を書き出すにはfor命令を使います。書き出しが終わったらFileオブジェクトのclose()メソッドを使ってファイルの書き込みを終了します。なお、close()メソッドを使用しなくても処理が終了すると自動的にファイルは閉じられますので書き忘れても動作には影響はありません。</p>
<p>　サンプルでは「var fileObj = File.saveDialog("保存ファイル名を指定してください", "result.txt");」としてユーザーに保存するファイル名を指定するようにしていますが、ダイアログを表示せずに特定のフォルダに保存したい場合は「var fileObj = new File("～/Desktop/result.txt")」のようにFileオブジェクトを使って指定します。</p>
<p>【sample】全てのレイヤーセットとレイヤー名をファイルに書き出す</p>
<pre><code>// 全てのレイヤー／レイヤーセット名をファイルに書き出す
var fileObj = File.saveDialog("保存ファイル名を指定してください", "result.txt");
if (fileObj != null){  // 保存先が指定された
    var flag = fileObj.open("w");   // 書き込みモードで開く
    if (flag){  // 書き込める状態の場合は以下の処理を行う
        var list = getAllLayerAndLayerSet(app.activeDocument, []); // 全てのレイヤーを取得する
        for(var i=0; i&lt;list.length; i++){
            if (!list[i].kind){ // レイヤーセットの場合は先頭に　マークを付加する
                fileObj.write("　");
            }
            fileObj.writeln(list[i].name);  // レイヤー名を書き出す
        }
        fileObj.close();    // ファイルを閉じる
    }else{
        alert("ファイルが開けません。書き込み禁止になっていないか確認してください");
    }
}
 // 全てのレイヤー／レイヤーセットオブジェクトを取得する
// IN : レイヤー／レイヤーセットオブジェクト, 配列オブジェクト
// OUT : レイヤー／レイヤーセットオブジェクトを格納した配列オブジェクト
function getAllLayerAndLayerSet(obj, ary){
    for(var i=0; i&lt;obj.layers.length; i++){
        ary.push(obj.layers[i]);
        if (!obj.layers[i].kind){    // レイヤーセットの場合
            getAllLayerAndLayerSet(obj.layers[i], ary);
        }
    }
    return ary; // 結果は配列で返す
}</code></pre>
<p>　レイヤー／レイヤーセットが複数あります。</p>
<figure>
<figcaption>【図】レイヤー／レイヤーセットが複数ある</figcaption>
<img src="images/00412.jpeg" />
</figure>
<p>　ファイル保存ダイアログが表示されるので保存先のフォルダとファイル名を入力します。</p>
<figure>
<figcaption>【図】保存先のフォルダとファイル名を入力する</figcaption>
<img src="images/00374.jpeg" />
</figure>
<p>　ファイルが保存されます。内容はレイヤーとレイヤーセット名がフラットに書き出されます。レイヤーセットの場合は名前の前に■が付加されます。</p>
<figure>
<figcaption>【図】ファイルが保存される</figcaption>
<img src="images/00593.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-588">
<section>
<h2 id="calibre_link-173"><b>5-52　全てのレイヤーセットとレイヤーの階層を保持したままファイルに書き出す</b></h2>
<p>　全てのレイヤーセットとレイヤーの階層を保持したままファイルに書き出すには「全てのレイヤー名をファイルに書き出す（レイヤーセットは含まない）」とほぼ同じなので異なる部分だけを解説します。まず、レイヤー情報とともに階層レベルの情報を返す関数を用意します。この関数は「全てのレイヤー名をファイルに書き出す（レイヤーセットは含まない）」の項目で使用されている関数を流用します。関数ではlayerオブジェクトとともに以下のように階層レベルも返すようにします。</p>
<pre><code>ary.push({
    layer : obj.layers[i],  // レイヤー情報
    level : level   // 階層レベル
});</code></pre>
<p>　あとはファイルに書き出す際に階層レベルの数だけ全角空白を書き出します。ファイルに書き出すには以下のようにwrite()メソッドを使います。処理速度が問題になるような場合はあらかじめ変数に階層レベルの数だけ全角空白を連結した後にwrite()メソッドを使って一括で書き出します。</p>
<pre><code>for(var j=0; j&lt;list[i].level; j++){
    fileObj.write("　");
}</code></pre>
<p>【sample】全てのレイヤーセットとレイヤーの階層を保持したままファイルに書き出す</p>
<pre><code>// 全てのレイヤーセットとレイヤーの階層を保持したままファイルに書き出す
var fileObj = File.saveDialog("保存ファイル名を指定してください", "result.txt");
if (fileObj != null){  // 保存先が指定された
    var flag = fileObj.open("w");   // 書き込みモードで開く
    if (flag){  // 書き込める状態の場合は以下の処理を行う
        var list = getAllLayerInfo(app.activeDocument, [], 0); // 全てのレイヤーを取得する
        for(var i=0; i&lt;list.length; i++){
            // 階層のレベルだけ全角空白を入れる
            for(var j=0; j&lt;list[i].level; j++){
                fileObj.write("　");
            }
            if (!list[i].layer.kind){ // レイヤーセットの場合は先頭に　マークを付加する
                fileObj.write("　");
            }
            fileObj.writeln(list[i].layer.name);  // レイヤー名を書き出す
        }
        fileObj.close();    // ファイルを閉じる
    }else{
        alert("ファイルが開けません。書き込み禁止になっていないか確認してください");
    }
}
 // 全てのレイヤー／レイヤーセットオブジェクト情報を取得する
// IN : レイヤー／レイヤーセットオブジェクト, 配列オブジェクト
// OUT : レイヤー／レイヤーセットオブジェクト情報を格納した配列オブジェクト
function getAllLayerInfo(obj, ary, level){
    for(var i=0; i&lt;obj.layers.length; i++){
        ary.push({
            layer : obj.layers[i],  // レイヤー情報
            level : level   // 階層レベル
        });
        if (!obj.layers[i].kind){    // レイヤーセットの場合
            getAllLayerInfo(obj.layers[i], ary, level+1);
        }
    }
    return ary; // 結果は配列で返す
}</code></pre>
<p>　レイヤー／レイヤーセットがあります。いくつかのレイヤーはレイヤーセット内に含まれています。</p>
<figure>
<figcaption>【図】レイヤー／レイヤーセットがある</figcaption>
<img src="images/00365.jpeg" />
</figure>
<p>　ファイル保存ダイアログが表示されるので保存先のフォルダとファイル名を入力します。</p>
<figure>
<figcaption>【図】保存先のフォルダとファイル名を入力する</figcaption>
<img src="images/00133.jpeg" />
</figure>
<p>　ファイルが保存されます。内容はレイヤーとレイヤーセット名が階層レベルを保持したまま書き出されます。</p>
<figure>
<figcaption>【図】ファイルが保存される</figcaption>
<img src="images/00550.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-24">
<section>
<h2 id="calibre_link-174"><b>5-53　全てのレイヤーの不透明度や矩形サイズをファイルに書き出す</b></h2>
<p>　全てのレイヤーの不透明度や矩形サイズをファイルに書き出す処理は基本的には「全てのレイヤーセットとレイヤー名をファイルに書き出す」と同じなのでここでは異なる部分のみ解説します。</p>
<p>　最初に全てのレイヤー情報を取得します。取得したらlayerオブジェクトのopacityから不透明度を、bounds配列から座標値を読み出しファイルに書き出します。座標に関してはbounds配列の値を読み出すとPhotoshop全体で設定されている単位が使用され書き出されます。ピクセルやmmなどの単位で書き出す場合はサンプルのようにUnitValueオブジェクトのas()メソッドを使って単位を変換します。</p>
<p>【sample】全てのレイヤーの不透明度や矩形サイズをファイルに書き出す</p>
<pre><code>// 全てのレイヤーの不透明度や矩形サイズをファイルに書き出す
var fileObj = File.saveDialog("保存ファイル名を指定してください", "result.txt");
if (fileObj != null){  // 保存先が指定された
    var flag = fileObj.open("w");   // 書き込みモードで開く
    if (flag){  // 書き込める状態の場合は以下の処理を行う
        var list = getAllLayer(app.activeDocument, []); // 全てのレイヤーを取得する
        for(var i=0; i&lt;list.length; i++){
            fileObj.write(list[i].name+"　");  // レイヤー名を書き出す
            var opac = list[i].opacity; // 不透明度
            var left = list[i].bounds[0];   // 左
            var top = list[i].bounds[1];   // 上
            var right = list[i].bounds[2];   // 右
            var bottom = list[i].bounds[3];   // 下
            left = left.as("px");   // ピクセル単位に変換
            top = top.as("px");   // ピクセル単位に変換
            right = right.as("px");   // ピクセル単位に変換
            bottom = bottom.as("px");   // ピクセル単位に変換
            fileObj.writeln("不透明度："+opac+"%　("+left+"-"+top+")-("+right+"-"+bottom+")");
        }
        fileObj.close();    // ファイルを閉じる
    }else{
        alert("ファイルが開けません。書き込み禁止になっていないか確認してください");
    }
}
 // レイヤーセットを除く全てのレイヤーオブジェクトを取得する
// IN : レイヤーオブジェクト, 配列オブジェクト
// OUT : レイヤーオブジェクトを格納した配列オブジェクト
function getAllLayer(obj, ary){
    for(var i=0; i&lt;obj.layers.length; i++){
        if (obj.layers[i].kind){    // レイヤーセット以外の場合
            ary.push(obj.layers[i]);
        }else{  // レイヤーセットなので再帰
            getAllLayer(obj.layers[i], ary);
        }
    }
    return ary; // 結果は配列で返す
}</code></pre>
<p>　レイヤーが複数あります。</p>
<figure>
<figcaption>【図】レイヤーが複数ある</figcaption>
<img src="images/00553.jpeg" />
</figure>
<p>　ファイル保存ダイアログが表示されるので保存先のフォルダとファイル名を入力します。</p>
<figure>
<figcaption>【図】保存先のフォルダとファイル名を入力する</figcaption>
<img src="images/00082.jpeg" />
</figure>
<p>　ファイルが保存され、レイヤー名と不透明度、レイヤー座標が書き出されます。</p>
<figure>
<figcaption>【図】ファイルが保存され、レイヤー名と不透明度、レイヤー座標が書き出される</figcaption>
<img src="images/00501.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-531">
<section>
<h2 id="calibre_link-175"><b>5-54　レイヤーのラベルカラーを設定する</b></h2>
<p>　レイヤーのラベルカラーを設定するには専用のプロパティやメソッドが用意されていないためScripting Listenerを使って操作を記録します。ラベルカラーを設定するには記録した処理を関数化して利用します。なお、ラベルカラーを設定するにはレイヤーパネルで何かレイヤーを選択しておく必要があります。選択していない状態で実行するとエラーで停止します。</p>
<p>【sample】レイヤーのラベルカラーを設定する</p>
<pre><code>// テキストレイヤーのラベルカラーを赤色にする
var list = getAllLayer(app.activeDocument, []); // すべてのレイヤーを取得する
for(var i=0; i&lt;list.length; i++){
    if (list[i].kind == LayerKind.TEXT){
        app.activeDocument.activeLayer = list[i];   // レイヤーをアクティブにする
        setLayerColor("赤色");
    }
}
// レイヤーセットを除くすべてのレイヤーオブジェクトを取得する
// IN : レイヤーオブジェクト, 配列オブジェクト
// OUT : レイヤーオブジェクトを格納した配列オブジェクト
function getAllLayer(obj, ary){
    for(var i=0; i&lt;obj.layers.length; i++){
        if (obj.layers[i].kind){    // レイヤーセット以外の場合
            ary.push(obj.layers[i]);
        }else{  // レイヤーセットなので再帰
            getAllLayer(obj.layers[i], ary);
        }
    }
    return ary; // 結果は配列で返す
}
// レイヤーのラベルカラーを設定する
function setLayerColor(colorName){
    var list = [
        { name : "なし", value: "None" },
        { name : "レッド", value: "Rd  " },
        { name : "オレンジ", value: "Orng" },
        { name : "イエロー", value: "Ylw " },
        { name : "グリーン", value: "Grn " },
        { name : "ブルー", value: "Bl  " },
        { name : "バイオレット", value: "Vlt " },
        { name : "グレー", value: "Gry " },
        { name : "無色", value: "None" },
        { name : "赤色", value: "Rd  " },
        { name : "橙色", value: "Orng" },
        { name : "黄色", value: "Ylw " },
        { name : "緑色", value: "Grn " },
        { name : "青色", value: "Bl  " },
        { name : "紫色", value: "Vlt " },
        { name : "灰色", value: "Gry " }
    ];
    var cName = "None"; // 無色に設定
    for(var i=0; i&lt;list.length; i++){
        if (list[i].name == colorName){
            cName = list[i].value;
            break;
        }
    }
    var idsetd = charIDToTypeID( "setd" );
        var desc1 = new ActionDescriptor();
        var idnull = charIDToTypeID( "null" );
            var ref1 = new ActionReference();
            var idLyr = charIDToTypeID( "Lyr " );
            var idOrdn = charIDToTypeID( "Ordn" );
            var idTrgt = charIDToTypeID( "Trgt" );
            ref1.putEnumerated( idLyr, idOrdn, idTrgt );
        desc1.putReference( idnull, ref1 );
        var idT = charIDToTypeID( "T   " );
            var desc2 = new ActionDescriptor();
            var idClr = charIDToTypeID( "Clr " );
            var idClr = charIDToTypeID( "Clr " );
            var idRd = charIDToTypeID( cName ); // 色を設定
            desc2.putEnumerated( idClr, idClr, idRd );
        var idLyr = charIDToTypeID( "Lyr " );
        desc1.putObject( idT, idLyr, desc2 );
    try{
        executeAction( idsetd, desc1, DialogModes.NO );
    }catch(e){
        alert("レイヤーパネルで何かレイヤーを選択してから実行してください");
    }
}</code></pre>
<p>　テキストレイヤーなど様々なレイヤー／レイヤーセットが複数あります。スクリプトを実行する前にレイヤーパネルで何かレイヤーをクリックして選択しておきます。</p>
<figure>
<figcaption>【図】様々なレイヤー／レイヤーセットからレイヤーを選択する</figcaption>
<img src="images/00271.jpeg" />
</figure>
<p>　スクリプトを実行するとテキストレイヤーだけ赤色のラベルになります。</p>
<figure>
<figcaption>【図】スクリプトを実行するとテキストレイヤーだけ赤色のラベルになる</figcaption>
<img src="images/00035.jpeg" />
</figure>
<p>　レイヤーパネルでレイヤーを選択していない場合は図のようなアラートダイアログが表示されます。</p>
<figure>
<figcaption>【図】レイヤーパネルでレイヤーを選択していない状態</figcaption>
<img src="images/00472.jpeg" />
</figure>
<figure>
<figcaption>【図】レイヤーパネルでレイヤーを選択していないとアラートダイアログが表示される</figcaption>
<img src="images/00226.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-568">
<section>
<div>
<h1 id="calibre_link-176"><b>第6章　レイヤーセット</b></h1>
</div>
</section>
</div>
<div id="calibre_link-473">
<section>
<h2 id="calibre_link-177"><b>6-1　レイヤーセットの総数を求める</b></h2>
<p>　レイヤーセットの総数を求めるにはlayerSets配列のlengthプロパティを参照します。レイヤーセット配列には各レイヤーセットの情報が格納されています。レイヤーセットが入れ子になっている場合は、入れ子になっている最初の階層の数になります。内包されているレイヤーセットの数まではカウントされません。</p>
<p>【sample】レイヤーセットの総数を求める</p>
<pre><code>// レイヤーセットの総数を求める
var n = app.activeDocument.layerSets.length;
alert(n);</code></pre>
<p>　ドキュメントのレイヤーセットの総数がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】ドキュメントのレイヤーセットの総数が表示される</figcaption>
<img src="images/00159.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-519">
<section>
<h2 id="calibre_link-178"><b>6-2　レイヤーセット内にあるレイヤーの数を求める</b></h2>
<p>　レイヤーセット内にあるレイヤーの数を求めるにはlayerSetオブジェクトのlayers配列の要素数を求めます。ただし、この場合レイヤーだけでなくレイヤーセットも含まれます。このため、レイヤー数のみを求める場合はサンプルのようにレイヤーセット数の数を減算する必要があります。</p>
<p>【sample】レイヤーセット内にあるレイヤーの数を求める</p>
<pre><code>// レイヤーセット内にあるレイヤーの数を求める
var n1 = app.activeDocument.layerSets[0].layers.length; // レイヤー総数
var s1 = app.activeDocument.layerSets[0].layerSets.length;  // レイヤーセット総数
var n2 = app.activeDocument.layerSets[0].layerSets[0].layers.length;    // レイヤー総数
var s2 = app.activeDocument.layerSets[0].layerSets[0].layerSets.length; // レイヤーセット総数
alert((n1-s1)+"\n"+(n2-s2));</code></pre>
<p>　ドキュメントのレイヤーの総数と、最初のレイヤーセット内にあるレイヤーの総数がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】ドキュメントのレイヤーの総数と、最初のレイヤーセット内にあるレイヤーの総数が表示される</figcaption>
<img src="images/00409.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-547">
<section>
<h2 id="calibre_link-179"><b>6-3　該当する名前のレイヤーセットがあるか調べる</b></h2>
<p>　該当する名前のレイヤーセットがあるか調べるにはlayerSetオブジェクトのnameプロパティを参照します。レイヤーセットは入れ子になっている場合があるので再帰を使って全ての階層にわたって名前を調べます。</p>
<p>【sample】該当する名前のレイヤーセットがあるか調べる</p>
<pre><code>// 該当する名前のレイヤーセットがあるか調べる
var flag1 = getLayerSetsName(app.activeDocument, "ぼかし枠");
var flag2 = getLayerSetsName(app.activeDocument, "テロップ");
alert("ぼかし枠："+flag1+"\nテロップ："+flag2);
// 名前を調べる関数。見つかった場合はtrue、そうでない場合はfalseを返す
function getLayerSetsName(obj, checkName){
    for(var i=0; i&lt;obj.layerSets.length; i++){
    $.writeln(obj.layerSets[i].name);
        if (checkName == obj.layerSets[i].name){
            return true;    // 一致した名前がある場合
        }
        // 内包されているレイヤーセットの総数を求める
        var n = obj.layerSets[i].layerSets.length;
        if (n &gt; 0){ // レイヤーセットが内包されていれば再帰で削除する
            var flag = getLayerSetsName(obj.layerSets[i], checkName);
            if (flag == true){ return true; }
        }
    }
    return false;
}</code></pre>
<p>　該当する名前のレイヤーセットがあるかどうかがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】該当する名前のレイヤーセットの有無が表示される</figcaption>
<img src="images/00179.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-604">
<section>
<h2 id="calibre_link-180"><b>6-4　レイヤーセットを追加する</b></h2>
<p>　レイヤーセットを追加するにはlayerSetsオブジェクトのadd()メソッドを使います。add()メソッドは戻り値として追加されたレイヤーセットオブジェクトを返します。</p>
<p>　レイヤーセット内にレイヤーセットを追加することもできます。この場合、レイヤーセットオブジェクトでlayerSets.add()のように使用することで追加することができます。</p>
<p>【sample】レイヤーセットを追加する</p>
<pre><code>// レイヤーセットを追加する
var lsObj = app.activeDocument.layerSets.add();
lsObj.name = "パーツ部分";
var textLayerSetObj = app.activeDocument.layerSets["テキスト"];
var newLayerSet = textLayerSetObj.layerSets.add();
newLayerSet.name = "サブタイトル";</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00590.jpeg" />
</figure>
<p>　最初の階層に新たなレイヤーセットが追加されます。また、レイヤーセット名テキストの中に新たにレイヤーセットが作成されます。</p>
<figure>
<figcaption>【図】最初の階層に新たなレイヤーセットが追加され、レイヤーセット名テキストの中に新たにレイヤーセットが作成される</figcaption>
<img src="images/00361.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-647">
<section>
<h2 id="calibre_link-181"><b>6-5　レイヤーセットを複製する</b></h2>
<p>　レイヤーセットを複製するにはlayerSetオブジェクトのduplicate()メソッドを使います。duplicate()メソッドの最初のパラメーターに複製後に配置する基準位置を指定します。2番目のパラメーターには以下の表に示す複製後に配置する位置を指定します。</p>
<table>
<caption>【表】配置する位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>基準位置</span>
  </td>
</tr>
<tr>
  <td>ElementPlacement.INSIDE</td>
  <td>内側</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEATBEGINNING</td>
  <td>最初</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEATEND</td>
  <td>最後</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEBEFORE</td>
  <td>前</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEAFTER</td>
  <td>後</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーセットを複製する</p>
<pre><code>// レイヤーセットを複製する
var lsObj = app.activeDocument.layerSets["紅葉"];
var dupLsObj = lsObj.duplicate(
    app.activeDocument.layerSets[0],    // 最初のレイヤーセットを基準
    ElementPlacement.PLACEBEFORE);  // 一番上に配置</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00129.jpeg" />
</figure>
<p>　指定したレイヤーセットが複製されます。</p>
<figure>
<figcaption>【図】指定したレイヤーセットが複製される</figcaption>
<img src="images/00544.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-518">
<section>
<h2 id="calibre_link-182"><b>6-6　レイヤーセットを削除する</b></h2>
<p>　レイヤーセットを削除するにはlayerSetオブジェクトのremove()メソッドを使います。入れ子になっているレイヤーセットを削除する場合は名前を指定しremove()メソッドを使います。レイヤーセットの名前を指定する場合はlayerSets["名前"]のようにするかlayerSets.getByName("名前")のようにします。指定した名前がない場合はエラーになるので、回避したい場合はtry...catchを使います。また、名前でなくlayerSets[2]のように参照番号を使って指定することもできます。レイヤーパネルで一番上にあるレイヤーセットがlayerSets[0]になり、下に行くに従って数字が1つずつ大きくなります。</p>
<p>【sample】レイヤーセットを削除する</p>
<pre><code>// レイヤーセットを削除する
app.activeDocument.layerSets[0].remove();   // 最初のレイヤーセット
app.activeDocument.layerSets["外枠"].layerSets[0].remove();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00320.jpeg" />
</figure>
<p>　スクリプトを実行すると指定したレイヤーセットが削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると指定したレイヤーセットが削除される</figcaption>
<img src="images/00078.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-673">
<section>
<h2 id="calibre_link-183"><b>6-7　レイヤーセットを全て削除する</b></h2>
<p>　レイヤーセットを全て削除するにはlayerSetオブジェクトのremove()メソッドかlayerSetsオブジェクトのremoveAll()メソッドを使います。layerSetsオブジェクトには全てのレイヤーセットを削除するremoveAll()メソッドがありますが、多重の入れ子になっておりレイヤーなどが内包されているとエラーで停止する場合があります。エラーを起こさない条件を満たしている場合はremoveAll()メソッドを使用してください。</p>
<p>　レイヤーセットにレイヤーセットが含まれている場合、再帰を使ってレイヤーセットを1つずつremove()メソッドを使って削除していきます。</p>
<p>【sample】レイヤーセットを全て削除する</p>
<pre><code>// レイヤーセットを全て削除する
removeLayer(app.activeDocument);
function removeLayer(obj){
    for(var i=obj.layerSets.length-1; i&gt;=0; i--){
        // 内包されているレイヤーセットの総数を求める
        var n = obj.layerSets[i].layerSets.length;
        if (n &gt; 0){ // レイヤーセットが内包されていれば再帰で削除する
            removeLayer(obj.layerSets[i]);
        }
        obj.layerSets[i].remove();  // レイヤーセットを削除する
    }
}</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00470.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤーセットが全て削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤーセットが全て削除される</figcaption>
<img src="images/00269.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-463">
<section>
<h2 id="calibre_link-184"><b>6-8　レイヤーセットが第一階層かどうか調べる</b></h2>
<p>　レイヤーセットが第一階層かどうか調べるにはlayerSetオブジェクトの親オブジェクトの種類を調べます。親オブジェクトはparentプロパティで参照することができます。レイヤーかドキュメントかなどの種類はtypenameプロパティを参照することで調べることができます。レイヤーセットが第一階層の場合、親オブジェクトはDocumentになります。レイヤーセット内にあるレイヤーセットの場合は、親オブジェクトはLayerSetになります。つまり親オブジェクトがDocumentか、そうでないかで第一階層かどうか判断することができます。</p>
<p>【sample】レイヤーセットが第一階層かどうか調べる</p>
<pre><code>// レイヤーセットが第一階層かどうか調べる
var docObj = app.activeDocument;
var lsObj1 = docObj.layerSets["紅葉"];
var lsObj2 = docObj.layerSets["紅葉"].layerSets["グループ 2"]
var p1 = lsObj1.parent.typename;      // 親オブジェクトの種類を取得
var p2 = lsObj2.parent.typename;      // 親オブジェクトの種類を取得
alert(p1+"\n"+p2);</code></pre>
<p>　レイヤーセット"紅葉"は第一階層なのでDocument、レイヤーセット"グループ 2"は第一階層にないのでLayerSetとアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】"紅葉"は第一階層なのでDocument、"グループ 2"は第一階層にないのでLayerSetと表示される</figcaption>
<img src="images/00077.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-618">
<section>
<h2 id="calibre_link-185"><b>6-9　レイヤーセットを統合する（マージ）</b></h2>
<p>　レイヤーセットを統合するにはlayerSetオブジェクトのmerge()メソッドを使います。merge()メソッドにはパラメーターはありません。merge()メソッドを実行するとレイヤーセット内の画像が全て統合され、新たなレイヤーが1つ作成されます。merge()メソッドは、この新しく統合されたlayerオブジェクトを返します。</p>
<p>【sample】レイヤーセットを統合する（マージ）</p>
<pre><code>// レイヤーセットを統合する
var lsObj = app.activeDocument.layerSets["紅葉"];
lsObj.merge();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00451.jpeg" />
</figure>
<p>　指定したレイヤーセットが統合（マージ）され1つのレイヤーになります。</p>
<figure>
<figcaption>【図】指定したレイヤーセットが統合され1つのレイヤーになる</figcaption>
<img src="images/00223.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-408">
<section>
<h2 id="calibre_link-186"><b>6-10　レイヤーセットを移動する</b></h2>
<p>　レイヤーセットを移動するにはlayerSetオブジェクトのmove()メソッドを使います。move()メソッドの最初のパラメーターは移動の基準となるレイヤーまたはレイヤーセットを指定します。2番目のパラメーターは以下の表に示す移動するレイヤー／レイヤーセット間の位置を指定します。なお、移動先の位置指定によってはエラーが発生することがあります。</p>
<table>
<caption>【表】移動先の位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>移動先</span>
  </td>
</tr>
<tr>
  <td>ElementPlacement.INSIDE</td>
  <td>内側</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEATBEGINNING</td>
  <td>先頭</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEATEND</td>
  <td>末尾</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEBEFORE</td>
  <td>前</td>
</tr>
<tr>
  <td>ElementPlacement.PLACEAFTER</td>
  <td>後ろ</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーセットを移動する</p>
<pre><code>// レイヤーセットを移動する
var srcLayerSetObj = app.activeDocument.layerSets["紅葉"].layerSets["グループ 2"];    // 移動するレイヤーセット
var dstLayerSetObj = app.activeDocument.layerSets["外枠"];    // 基準となるレイヤーセット
srcLayerSetObj.move(dstLayerSetObj, ElementPlacement.PLACEAFTER);   // 後ろに移動</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00076.jpeg" />
</figure>
<p>　レイヤーセット"グループ 2"がレイヤーセット"外枠"の後に移動します。</p>
<figure>
<figcaption>【図】レイヤーセット"グループ 2"がレイヤーセット"外枠"の後に移動する</figcaption>
<img src="images/00405.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-563">
<section>
<h2 id="calibre_link-187"><b>6-11　レイヤーセット全体の不透明度を変更する</b></h2>
<p>　レイヤーセット全体の不透明度を変更するにはlayerSetオブジェクトのopacityプロパティに0.0～100.0までの値を設定します。0を指定すると0%、100なら100%の不透明度になります。範囲外の数値を指定するとエラーになります。</p>
<p>【sample】レイヤーセット全体の不透明度を変更する</p>
<pre><code>// レイヤーセットの不透明度を指定する
app.activeDocument.layerSets["紅葉"].opacity = 45; // 45%</code></pre>
<p>　スクリプトを実行する前の状態です。レイヤーセット"紅葉"の不透明度は100%になっています。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00560.jpeg" />
</figure>
<p>　レイヤーセット"紅葉"の不透明度が45%に変更されます。</p>
<figure>
<figcaption>【図】レイヤーセット"紅葉"の不透明度が45%に変更される</figcaption>
<img src="images/00627.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-35">
<section>
<h2 id="calibre_link-188"><b>6-12　レイヤーセットを表示／非表示にする</b></h2>
<p>　レイヤーセットを表示したり非表示にするにはlayerSetオブジェクトのvisibleプロパティを操作します。visibleプロパティにtrueを指定すると表示され、falseを指定すると表示されなくなります。また、レイヤーセット内にレイヤーセットがある場合、表示されるかどうかは親のレイヤーセットの状態と同じになります。つまり、親のレイヤーセットが非表示になった場合、その中に含まれるレイヤーセットおよびレイヤーも表示されなくなります。</p>
<p>【sample】レイヤーセットを表示／非表示にする</p>
<pre><code>// レイヤーセットの表示／非表示
app.activeDocument.layerSets["紅葉"].visible = true;  // 表示する
app.activeDocument.layerSets["テキスト"].visible = false;   // 表示しない</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00397.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤーセット"紅葉"が表示状態になり、レイヤーセット"テキスト"が表示されなくなります。</p>
<figure>
<figcaption>【図】"紅葉"が表示状態になり、"テキスト"が表示されなくなる</figcaption>
<img src="images/00328.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-539">
<section>
<h2 id="calibre_link-189"><b>6-13　レイヤーセットをロックする／ロックを解除する</b></h2>
<p>　レイヤーセットをロックしたりロックを解除するにはlayerSetオブジェクトのallLockedプロパティを操作します。allLockedプロパティにtrueを指定するとロックされ、falseを指定するとロックが解除されます。注意しないといけないのは、このロック操作は対象となるレイヤーセットのロックだけです。内包されるレイヤーセットおよびレイヤーのロック状態は操作前の状態が保持されています。このためレイヤーセットをロック後、再びロックを解除した場合、内包されるレイヤーセットおよびレイヤーは元のロック状態に戻ります。</p>
<p>　全てのレイヤーセットおよびレイヤーセットのロックを解除する場合は、繰り返しと再帰を使って処理する必要があります。</p>
<p>【sample】レイヤーセットをロックする／ロックを解除する</p>
<pre><code>// レイヤーセットのロックと解除
app.activeDocument.layerSets["紅葉"].allLocked = true;  // ロックする
app.activeDocument.layerSets["テキスト"].allLocked = false;   // ロック解除
app.activeDocument.layerSets["外枠"].allLocked = false;  // ロック解除</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00459.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤーセット"紅葉"がロックされ、レイヤーセット"テキスト"と"外枠"のロックが解除されます。</p>
<figure>
<figcaption>【図】"紅葉"がロックされ、"テキスト"と"外枠"のロックが解除される</figcaption>
<img src="images/00595.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-622">
<section>
<h2 id="calibre_link-190"><b>6-14　レイヤーセット全体の合成モードを変更する</b></h2>
<p>　レイヤーセット全体の合成モードを変更するにはlayerSetオブジェクトのblendModeプロパティに以下の表に示す値を指定します。</p>
<table>
<caption>【表】合成モードの種類</caption>
<tbody>
<tr>
  <td>
    <span>値</span>
  </td>
  <td>
    <span>モード</span>
  </td>
</tr>
<tr>
  <td>BlendMode.COLORBLEND</td>
  <td>カラー</td>
</tr>
<tr>
  <td>BlendMode.COLORBURN</td>
  <td>焼き込みカラー</td>
</tr>
<tr>
  <td>BlendMode.COLORDODGE</td>
  <td>覆焼きカラー</td>
</tr>
<tr>
  <td>BlendMode.DARKEN</td>
  <td>比較（暗）</td>
</tr>
<tr>
  <td>BlendMode.DIFFERENCE</td>
  <td>差の絶対値</td>
</tr>
<tr>
  <td>BlendMode.DISSOLVE</td>
  <td>ディザ合成</td>
</tr>
<tr>
  <td>BlendMode.DIVIDE</td>
  <td>除算</td>
</tr>
<tr>
  <td>BlendMode.EXCLUSION</td>
  <td>除外</td>
</tr>
<tr>
  <td>BlendMode.HARDLIGHT</td>
  <td>ハードライト</td>
</tr>
<tr>
  <td>BlendMode.HARDMIX</td>
  <td>ハードミックス</td>
</tr>
<tr>
  <td>BlendMode.HUE</td>
  <td>色相</td>
</tr>
<tr>
  <td>BlendMode.LIGHTEN</td>
  <td>比較（明）</td>
</tr>
<tr>
  <td>BlendMode.LINEARBURN</td>
  <td>焼き込み（リニア）</td>
</tr>
<tr>
  <td>BlendMode.LINEARDODGE</td>
  <td>覆焼き（リニア）-加算</td>
</tr>
<tr>
  <td>BlendMode.LINEARLIGHT</td>
  <td>リニアライト</td>
</tr>
<tr>
  <td>BlendMode.LUMINOSITY</td>
  <td>輝度</td>
</tr>
<tr>
  <td>BlendMode.MULTIPLY</td>
  <td>乗算</td>
</tr>
<tr>
  <td>BlendMode.NORMAL</td>
  <td>通常</td>
</tr>
<tr>
  <td>BlendMode.OVERLAY</td>
  <td>オーバーレイ</td>
</tr>
<tr>
  <td>BlendMode.PASSTHROUGH</td>
  <td>通過</td>
</tr>
<tr>
  <td>BlendMode.PINLIGHT</td>
  <td>ピンライト</td>
</tr>
<tr>
  <td>BlendMode.SATURATION</td>
  <td>彩度</td>
</tr>
<tr>
  <td>BlendMode.SCREEN</td>
  <td>スクリーン</td>
</tr>
<tr>
  <td>BlendMode.SOFTLIGHT</td>
  <td>ソフトライト</td>
</tr>
<tr>
  <td>BlendMode.SUBTRACT</td>
  <td>減算</td>
</tr>
<tr>
  <td>BlendMode.VIVIDLIGHT</td>
  <td>ビビッドライト</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーセット全体の合成モードを変更する</p>
<pre><code>// レイヤーセットの合成モードを指定する
app.activeDocument.layerSets["紅葉"].blendMode = BlendMode.MULTIPLY; // 乗算モード</code></pre>
<p>　スクリプトを実行する前の状態です。レイヤーセット"紅葉"の合成モードは「通常」になっています。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00119.jpeg" />
</figure>
<p>　レイヤーセット"紅葉"の合成モードが「乗算」に変更されます。</p>
<figure>
<figcaption>【図】レイヤーセット"紅葉"の合成モードが「乗算」に変更される</figcaption>
<img src="images/00346.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-412">
<section>
<h2 id="calibre_link-191"><b>6-15　レイヤーセットをリンクする</b></h2>
<p>　レイヤーセットをリンクするにはlayerSetオブジェクトのlink()メソッドを使います。link()メソッドのパラメーターにリンクしたいレイヤーセットオブジェクトまたはlayerオブジェクトを指定します。</p>
<p>【sample】レイヤーセットをリンクする</p>
<pre><code>// レイヤーセットをリンクする
var docObj = app.activeDocument;
var layerSetObj1 = docObj.layerSets["テキスト"];
var layerSetObj2 = docObj.layerSets["外枠"];
var layerObj = docObj.layerSets["紅葉"].layers["leaf"];
layerSetObj1.link(layerSetObj2);    // レイヤーセット"外枠"とリンク
layerSetObj1.link(layerObj);    // レイヤー"leaf"とリンク</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00310.jpeg" />
</figure>
<p>　レイヤーセット"テキスト"と"外枠"がリンクされます。また、レイヤーセット"紅葉"の中にある通常レイヤー"leaf"もリンクされます。</p>
<figure>
<figcaption>【図】"テキスト"と"外枠"がリンクされ、"紅葉"の中にある通常レイヤー"leaf"もリンクされる</figcaption>
<img src="images/00497.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-570">
<section>
<h2 id="calibre_link-192"><b>6-16　レイヤーセットのリンク先を調べる</b></h2>
<p>　レイヤーセットのリンク先を調べるにはlayerSetオブジェクトのlinkedLayers配列を参照します。linkedLayers配列にはリンクされているLayerSetオブジェクトおよびlayerオブジェクトへの参照が入っています。リンクされているレイヤーセットおよびレイヤー名を表示したい場合はサンプルのgetLinkedLayerName関数内で処理しているようにlinkedLayers配列の内容を1つずつ読み出しnameプロパティを参照します。</p>
<p>【sample】レイヤーセットのリンク先を調べる</p>
<pre><code>// レイヤーセットのリンク先を調べる
var targetLayerSet = app.activeDocument.layerSets["テキスト"].linkedLayers;
var linkName = getLinkedLayerName(targetLayerSet);
alert(linkName);    // 結果を表示
var targetLayerSet = app.activeDocument.layerSets["紅葉"].linkedLayers;
var linkName = getLinkedLayerName(targetLayerSet);
alert(linkName);    // 結果を表示
// リンクされているレイヤーセット一覧を名前で返す
function getLinkedLayerName(lay){
    var text = "";
    for(var i=0; i&lt;lay.length; i++){
        text = text + lay[i].name+"\n";
    }
    return text;
}</code></pre>
<p>　レイヤーセット"テキスト"でリンクされているレイヤーセットおよびレイヤー名がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】"テキスト"でリンクされているレイヤーセットおよびレイヤー名が表示される</figcaption>
<img src="images/00487.jpeg" />
</figure>
<p>　レイヤーセット"紅葉"でリンクされているレイヤーセットはないのでアラートダイアログには何も表示されません。</p>
<figure>
<figcaption>【図】"紅葉"でリンクされているレイヤーセットはないので何も表示されない</figcaption>
<img src="images/00258.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-6">
<section>
<h2 id="calibre_link-193"><b>6-17　レイヤーセットのリンクを解除する</b></h2>
<p>　レイヤーセットのリンクを解除するにはlayerSetオブジェクトのunlink()メソッドを使います。unlink()メソッドを使うとリンクされているレイヤーセットおよびレイヤーが全てリンク解除されます。unlink()メソッドにはパラメーターがなく、指定したレイヤーセットおよびレイヤーだけリンク解除することはできません。</p>
<p>【sample】レイヤーセットのリンクを解除する</p>
<pre><code>// レイヤーセットのリンクを解除する
app.activeDocument.layerSets["テキスト"].unlink();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00268.jpeg" />
</figure>
<p>　レイヤーセット"テキスト"でリンクされている全てのレイヤーセットおよびレイヤーへのリンクが解除されます。</p>
<figure>
<figcaption>【図】"テキスト"でリンクされている全てのレイヤーセットおよびレイヤーへのリンクが解除される</figcaption>
<img src="images/00401.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-509">
<section>
<h2 id="calibre_link-194"><b>6-18　レイヤーセット内の画像の位置を変更する</b></h2>
<p>　レイヤーセット内の画像の位置を変更するにはlayerSetオブジェクトのtranslate()メソッドを使います。translate()メソッドの最初のパラメーターに水平方向の移動量を、2番目のパラメーターに垂直方向の移動量を指定します。指定できる値はUnitValue形式なのでUnitValue(10, "cm")とすると10cmになります。なお、UnitValue("10cm")のように数値と単位を1つの文字列でまとめて指定することもできます。</p>
<p>【sample】レイヤーセット内の画像の位置を変更する</p>
<pre><code>// レイヤーセット内の画像の位置を変更する
var lsObj = app.activeDocument.layerSets["紅葉"];
var dx = UnitValue(20, "px");   // 20px
var dy = UnitValue(3, "cm");    // 3cm
lsObj.translate(dx, dy);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00213.jpeg" />
</figure>
<p>　指定したレイヤーセットの内容が移動します。</p>
<figure>
<figcaption>【図】指定したレイヤーセットの内容が移動する</figcaption>
<img src="images/00622.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-664">
<section>
<h2 id="calibre_link-195"><b>6-19　レイヤーセット内の画像のサイズを変更する（リサイズ）</b></h2>
<p>　レイヤーセット内の画像のサイズを変更するにはlayerSetオブジェクトのresize()メソッドを使います。resize()メソッドの最初のパラメーターに水平方向の倍率を、2番目のパラメーターに垂直方向の倍率を指定します。100を指定すると100%で等倍になります。50であれば50%で半分のサイズになります。水平方向、垂直方向のパラメーターは省略できますが、省略した場合は何も変化しません。</p>
<p>　resize()メソッドの3番目のパラメーターにはサイズ変更時の基準位置を指定します。指定できる値を表に示します。なお、resize()メソッドの3番目のパラメーターは省略することができます。</p>
<table>
<caption>【表】サイズ調整時の基準位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>基準位置</span>
  </td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMCENTER</td>
  <td>中央下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMLEFT</td>
  <td>左下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMRIGHT</td>
  <td>右下</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLECENTER</td>
  <td>中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLELEFT</td>
  <td>左辺中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLERIGHT</td>
  <td>右辺中央</td>
</tr>
<tr>
  <td>AnchorPosition.TOPCENTER</td>
  <td>中央上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPLEFT</td>
  <td>左上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPRIGHT</td>
  <td>右上</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーセット内の画像のサイズを変更する（リサイズ）</p>
<pre><code>// レイヤーセット内の画像のサイズを変更する
var lsObj = app.activeDocument.layerSets["紅葉"];
lsObj.resize(120, 40, AnchorPosition.MIDDLECENTER);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00131.jpeg" />
</figure>
<p>　指定したレイヤーセットの内容がリサイズされます。</p>
<figure>
<figcaption>【図】指定したレイヤーセットの内容がリサイズされる</figcaption>
<img src="images/00308.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-453">
<section>
<h2 id="calibre_link-196"><b>6-20　レイヤーセット内の画像を回転させる</b></h2>
<p>　レイヤーセット内の画像を回転させるにはlayerSetオブジェクトのrotate()メソッドを使います。rotate()メソッドの最初のパラメーターに回転角度を指定します。正数の場合は時計回りに回転し、負数の場合は反時計回りに回転します。rotate()メソッドの2番目のパラメーターには回転の基準位置を指定します。指定できる値を表に示します。なお、rotate()メソッドの2番目のパラメーターは省略することができます。</p>
<table>
<caption>【表】回転の基準位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>基準位置</span>
  </td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMCENTER</td>
  <td>中央下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMLEFT</td>
  <td>左下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMRIGHT</td>
  <td>右下</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLECENTER</td>
  <td>中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLELEFT</td>
  <td>左辺中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLERIGHT</td>
  <td>右辺中央</td>
</tr>
<tr>
  <td>AnchorPosition.TOPCENTER</td>
  <td>中央上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPLEFT</td>
  <td>左上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPRIGHT</td>
  <td>右上</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーセット内の画像を回転させる</p>
<pre><code>// レイヤーセット内の画像を回転させる
var lsObj = app.activeDocument.layerSets["紅葉"];
lsObj.rotate(45, AnchorPosition.MIDDLECENTER);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00615.jpeg" />
</figure>
<p>　指定したレイヤーセットの内容が時計回りに45度回転します。</p>
<figure>
<figcaption>【図】指定したレイヤーセットの内容が時計回りに45度回転する</figcaption>
<img src="images/00348.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-609">
<section>
<h2 id="calibre_link-197"><b>6-21　レイヤーセットの矩形サイズを取得する</b></h2>
<p>　レイヤーセットの矩形サイズを取得するにはlayerSetオブジェクトのbounds配列を読み出します。bounds配列にはUnitValue形式で以下の順番に座標が格納されています。この場合、レイヤーセット内に含まれる全ての画像を統合した場合のドキュメント内での座標がbounds配列に格納されています。</p>
<table>
<caption>【表】bounds配列と座標</caption>
<tbody>
<tr>
  <td>
    <span>bounds配列</span>
  </td>
  <td>
    <span>座標</span>
  </td>
</tr>
<tr>
  <td>bounds[0]</td>
  <td>左端</td>
</tr>
<tr>
  <td>bounds[1]</td>
  <td>上端</td>
</tr>
<tr>
  <td>bounds[2]</td>
  <td>右端</td>
</tr>
<tr>
  <td>bounds[3]</td>
  <td>下端</td>
</tr>
</tbody>
</table>
<p>【sample】レイヤーセットの矩形サイズを取得する</p>
<pre><code>// レイヤーセットの矩形サイズを表示する
var rect = app.activeDocument.layerSets["紅葉"].bounds;
var left = rect[0]; // 左座標
var top = rect[1];  // 上座標
var right = rect[2];    // 右座標
var bottom = rect[3];   // 下座標
alert("("+left+", "+top+")-("+right+", "+bottom+")");</code></pre>
<p>　レイヤーセット"紅葉"に含まれる画像全てを合わせた場合の画像の矩形サイズがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】"紅葉"に含まれる画像全てを合わせた場合の画像の矩形サイズが表示される</figcaption>
<img src="images/00063.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-47">
<section>
<h2 id="calibre_link-198"><b>6-22　アクティブにするレイヤーセットを指定する</b></h2>
<p>　アクティブにするレイヤーセットを指定するにはdocumentオブジェクトのactiveLayerプロパティにlayerSetオブジェクトを設定します。</p>
<p>【sample】アクティブにするレイヤーセットを指定する</p>
<pre><code>// アクティブにするレイヤーセットを指定する
app.activeDocument.activeLayer = app.activeDocument.layerSets["紅葉"];</code></pre>
<p>　スクリプトを実行する前の状態です。どのレイヤーもレイヤーセットもアクティブになっていません。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00530.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤーセット"紅葉"がアクティブになります。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤーセット"紅葉"がアクティブになる</figcaption>
<img src="images/00343.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-551">
<section>
<div>
<h1 id="calibre_link-199"><b>第7章　標準エフェクト/フィルター</b></h1>
</div>
</section>
</div>
<div id="calibre_link-702">
<section>
<h2 id="calibre_link-200"><b>7-1　コントラストを自動調整する</b></h2>
<p>　画像のコントラストを自動調整するにはlayerオブジェクトのautoContrast()メソッドを使います。autoContrast()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはイメージメニューの「自動コントラスト」と同じです。</p>
<p>【sample】コントラストを自動調整する</p>
<pre><code>// コントラストを自動調整する（イメージ＞自動コントラスト）
app.activeDocument.activeLayer.autoContrast();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00473.jpeg" />
</figure>
<p>　画像のコントラストが自動調整されます。</p>
<figure>
<figcaption>【図】画像のコントラストが自動調整される</figcaption>
<img src="images/00480.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-497">
<section>
<h2 id="calibre_link-201"><b>7-2　明るさとコントラストを調整する</b></h2>
<p>　明るさとコントラストを調整するにはlayerオブジェクトのadjustBrightnessContrast()メソッドを使います。最初のパラメーターに輝度を-100～100までの数値で指定します。2番目のパラメーターにはコントラストを-100～100までの数値で指定します。</p>
<p>　このメソッドはイメージメニューの「色調補正」＞「明るさ・コントラスト...」と同じです。</p>
<p>【sample】明るさとコントラストを調整する</p>
<pre><code>// 明るさとコントラストを調整する
app.activeDocument.activeLayer.adjustBrightnessContrast(-20, 80);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00099.jpeg" />
</figure>
<p>　明るさとコントラストが変わります。</p>
<figure>
<figcaption>【図】明るさとコントラストが変わる</figcaption>
<img src="images/00245.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-652">
<section>
<h2 id="calibre_link-202"><b>7-3　画像の色調を変える（レンズフィルター）</b></h2>
<p>　画像の色調を変える（レンズフィルター。昔のゼラチンフィルター）にはlayerオブジェクトのphotoFilter()メソッドを使います。photoFilter()メソッドの最初のパラメーターにはレンズフィルターの色をSolidColorで指定します。2番目のパラメータには的容量を（0～100）指定します。3番目のパラメーターには輝度を保持するかどうかを指定します。</p>
<p>　このメソッドはイメージメニューの「色調補正」＞「レンズフィルター」と同じです。</p>
<p>【sample】画像の色調を変える（レンズフィルター）</p>
<pre><code>// レンズフィルター（イメージ＞色調補正＞レンズフィルター）
var color = new SolidColor();   // 橙色
color.rgb.red = 250;
color.rgb.green = 120;
color.rgb.blue = 0;
app.activeDocument.activeLayer.photoFilter(
    color,
    100,
    true
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00433.jpeg" />
</figure>
<p>　輪郭以外がぼかされます。</p>
<figure>
<figcaption>【図】輪郭以外がぼかされる</figcaption>
<img src="images/00514.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-438">
<section>
<h2 id="calibre_link-203"><b>7-4　カラーバランスを調整する</b></h2>
<p>　画像のカラーバランスを調整するにはlayerオブジェクトのadjustColorBalance()メソッドを使います。adjustColorBalance()メソッドのパラメーターと指定できる内容／値を「【表】パラメーターと意味」に示します。いずれのパラメーターも省略することができます。</p>
<p>　このメソッドはイメージメニューの「色調補正」＞「カラーバランス」と同じです。</p>
<table>
<caption>【表】パラメーターと意味</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>意味</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>シャドウ部分の値。配列形式で3つの値を指定。※省略可能</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>中間調部分の値。配列形式で3つの値を指定。※省略可能</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>ハイライト部分の値。配列形式で3つの値を指定。※省略可能</td>
</tr>
<tr>
  <td>4番目のパラメーター</td>
  <td>輝度の保持（true：保持する、false：保持しない）※省略可能</td>
</tr>
</tbody>
</table>
<p>【sample】カラーバランスを調整する</p>
<pre><code>// カラーバランスを調整（イメージ＞色調補正＞カラーバランス）
app.activeDocument.activeLayer.adjustColorBalance(
    [0, -10, 80],   // シャドウ部分
    [1, -5, 5], // 中間調部分
    [2, -7, 7], // ハイライト部分
    true    // 輝度を保持
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00311.jpeg" />
</figure>
<p>　画像のカラーバランスが調整されます。</p>
<figure>
<figcaption>【図】画像のカラーバランスが調整される</figcaption>
<img src="images/00507.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-703">
<section>
<h2 id="calibre_link-204"><b>7-5　自動トーン補正を行う</b></h2>
<p>　画像のトーンを自動で補正するにはlayerオブジェクトのautoLevels()メソッドを使います。autoLevels()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはイメージメニューの「自動トーン補正」と同じです。</p>
<p>【sample】自動トーン補正を行う</p>
<pre><code>// 自動トーン補正を行う（イメージ＞自動トーン補正）
app.activeDocument.activeLayer.autoLevels();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00280.jpeg" />
</figure>
<p>　画像のトーンが自動調整されます。</p>
<figure>
<figcaption>【図】画像のトーンが自動調整される</figcaption>
<img src="images/00584.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-679">
<section>
<h2 id="calibre_link-205"><b>7-6　画像をトーンカーブで調整する</b></h2>
<p>　画像をトーンカーブで調整するにはlayerオブジェクトのadjustCurves()メソッドを使います。adjustCurves()メソッドのパラメーターには配列内にさらにカーブの座標となるX, Y座標を指定します。最もシンプルな直線のトーンカーブの場合、[[ 0, 0 ], [ 255, 255 ]]となります。</p>
<p>　このメソッドはイメージメニューの「色調補正」＞「トーンカーブ」と同じです。</p>
<p>【sample】画像をトーンカーブで調整する</p>
<pre><code>// トーンカーブ（イメージ＞色調補正＞トーンカーブ）
app.activeDocument.activeLayer.adjustCurves(
   [[ 0, 0 ], [ 128, 10 ], [ 255, 255 ]]
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00342.jpeg" />
</figure>
<p>　画像の明るさなど（トーン）が変化します。</p>
<figure>
<figcaption>【図】画像の明るさなど（トーン）が変化する</figcaption>
<img src="images/00107.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-501">
<section>
<h2 id="calibre_link-206"><b>7-7　彩度を下げる</b></h2>
<p>　画像の彩度を下げるにはlayerオブジェクトのdesaturate()メソッドを使います。desaturate()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはイメージメニューの「色調補正」＞「彩度を下げる」と同じです。</p>
<p>【sample】彩度を下げる</p>
<pre><code>// 彩度を下げる（イメージ＞色調補正＞彩度を下げる）
app.activeDocument.activeLayer.desaturate();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00287.jpeg" />
</figure>
<p>　画像の彩度が下がり、色がなくなりグレーになります。</p>
<figure>
<figcaption>【図】画像の彩度が下がり、色がなくなりグレーになる</figcaption>
<img src="images/00539.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-654">
<section>
<h2 id="calibre_link-207"><b>7-8　階調（色）を反転させる</b></h2>
<p>　階調（色）を反転させるにはlayerオブジェクトのinvert()メソッドを使います。invert()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはイメージメニューの「色調補正」＞「階調の反転」と同じです。</p>
<p>【sample】階調（色）を反転させる</p>
<pre><code>// 階調（色）を反転させる（イメージ＞色調補正＞階調の反転）
app.activeDocument.activeLayer.invert();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00313.jpeg" />
</figure>
<p>　画像の階調が反転します。</p>
<figure>
<figcaption>【図】画像の階調が反転する</figcaption>
<img src="images/00071.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-442">
<section>
<h2 id="calibre_link-208"><b>7-9　ポスタリゼーション（階調の段階を設定）</b></h2>
<p>　画像をポスタリゼーション（階調の段階を設定）するにはlayerオブジェクトのposterize()メソッドを使います。パラメーターには階調を2～225の数値で指定します。数値が多いほど階調が増えるため、色数が多くなります。</p>
<p>　このメソッドはイメージメニューの「色調補正」＞「ポスタリゼーション」と同じです。</p>
<p>【sample】ポスタリゼーション（階調の段階を設定）</p>
<pre><code>// ポスタリゼーション（イメージ＞色調補正＞ポスタリゼーション）
app.activeDocument.activeLayer.posterize(4);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00489.jpeg" />
</figure>
<p>　画像の階調が減り、フラットな表現になります。</p>
<figure>
<figcaption>【図】画像の階調が減り、フラットな表現になる</figcaption>
<img src="images/00259.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-598">
<section>
<h2 id="calibre_link-209"><b>7-10　白黒画像にする（2階調化）</b></h2>
<p>　画像を2階調化し白黒画像にするにはlayerオブジェクトのthreshold()メソッドを使います。threshold()メソッドのパラメーターには閾値を1～255までの数値で指定します。画像の1ピクセルの色の輝度が閾値より低い場合は黒色に、高い場合は白色に変換されます。</p>
<p>　このメソッドはイメージメニューの「色調補正」＞「2 階調化」と同じです。</p>
<p>【sample】ポスタリゼーション（階調の段階を設定）</p>
<pre><code>// 白黒画像にする（イメージ＞色調補正＞2 階調化）
app.activeDocument.activeLayer.threshold(128);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00028.jpeg" />
</figure>
<p>　画像が白と黒の2色になります。</p>
<figure>
<figcaption>【図】画像が白と黒の2色になる</figcaption>
<img src="images/00443.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-36">
<section>
<h2 id="calibre_link-210"><b>7-11　平均にする</b></h2>
<p>　画像を平均にするにはlayerオブジェクトのapplyAverage()メソッドを使います。applyAverage()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはフィルターメニューの「ぼかし」＞「平均」と同じです。</p>
<p>【sample】平均にする</p>
<pre><code>// 平均にする（フィルター＞ぼかし＞平均）
app.activeDocument.activeLayer.applyAverage();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00216.jpeg" />
</figure>
<p>　画像の平均値の色で塗り潰されます。範囲が選択されている場合は、その範囲内の画像の平均値で塗り潰されます。</p>
<figure>
<figcaption>【図】画像の平均値の色で塗り潰される</figcaption>
<img src="images/00379.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-545">
<section>
<h2 id="calibre_link-211"><b>7-12　平均化する（イコライズ）</b></h2>
<p>　画像を平均化（イコライズ）するにはlayerオブジェクトのequalize()メソッドを使います。equalize()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはイメージメニューの「色調補正」＞「平均化(イコライズ)」と同じです。</p>
<p>【sample】平均化する（イコライズ）</p>
<pre><code>// 平均化する（イメージ＞色調補正＞平均化(イコライズ)）
app.activeDocument.activeLayer.equalize();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00394.jpeg" />
</figure>
<p>　画像が平均化され、明るさの分布の偏りが補正されます。</p>
<figure>
<figcaption>【図】画像が平均化され、明るさの分布の偏りが補正される</figcaption>
<img src="images/00166.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-697">
<section>
<h2 id="calibre_link-212"><b>7-13　画像のレベル補正を行う</b></h2>
<p>　画像のレベル補正を行うにはlayerオブジェクトのadjustLevels()メソッドを使います。adjustLevels()メソッドのパラメーターと指定できる内容／値は表を参照してください。いずれのパラメーターも省略することはできません。</p>
<p>　このメソッドはイメージメニューの「色調補正」＞「レベル補正」と同じです。</p>
<table>
<caption>【表】パラメーターと意味</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>意味</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>入力レベル開始値</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>入力レベル終了値（入力レベル開始値より2以上多いこと）</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>ガンマ値（0.1～9.99）</td>
</tr>
<tr>
  <td>4番目のパラメーター</td>
  <td>出力レベル開始値</td>
</tr>
<tr>
  <td>5番目のパラメーター</td>
  <td>出力レベル終了値（出力レベル開始値より2以上多いこと）</td>
</tr>
</tbody>
</table>
<p>【sample】画像のレベル補正を行う</p>
<pre><code>// レベル補正（イメージ＞色調補正＞レベル補正）
app.activeDocument.activeLayer.adjustLevels(
   50, 152, // 入力レベル（50～152）
   0.55,    // ガンマ値（0.55）
   70, 220  // 出力レベル（70～220）
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00581.jpeg" />
</figure>
<p>　画像のレベルが調整されます。</p>
<figure>
<figcaption>【図】画像のレベルが調整される</figcaption>
<img src="images/00352.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-533">
<section>
<h2 id="calibre_link-213"><b>7-14　画像の明るい部分を拡大する（明るさの最大値）</b></h2>
<p>　画像の明るい部分を拡大する（明るさの最大値）にはlayerオブジェクトのapplyMaximum()メソッドを使います。applyMaximum()メソッドのパラメーターには半径（1～100）を指定します。</p>
<p>　このメソッドはフィルターメニューの「その他」＞「明るさの最大値」と同じです。</p>
<p>【sample】画像の明るい部分を拡大する（明るさの最大値）</p>
<pre><code>// 明るさの最大値（フィルター＞その他＞明るさの最大値）
app.activeDocument.activeLayer.applyMaximum(3);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00116.jpeg" />
</figure>
<p>　画像の明るい部分が拡大されます。</p>
<figure>
<figcaption>【図】画像の明るい部分が拡大される</figcaption>
<img src="images/00534.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-640">
<section>
<h2 id="calibre_link-214"><b>7-15　画像の暗い部分を拡大する（明るさの最小値）</b></h2>
<p>　画像の暗い部分を拡大する（明るさの最小値）にはlayerオブジェクトのapplyMinimum()メソッドを使います。applyMinimum()メソッドのパラメーターには半径（1～100）を指定します。</p>
<p>　このメソッドはフィルターメニューの「その他」＞「明るさの最小値」と同じです。</p>
<p>【sample】画像の暗い部分を拡大する（明るさの最小値）</p>
<pre><code>// 明るさの最小値（フィルター＞その他＞明るさの最小値）
app.activeDocument.activeLayer.applyMinimum(3);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00307.jpeg" />
</figure>
<p>　画像の暗い部分が拡大されます。</p>
<figure>
<figcaption>【図】画像の暗い部分が拡大される</figcaption>
<img src="images/00064.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-33">
<section>
<h2 id="calibre_link-215"><b>7-16　ノイズを加える</b></h2>
<p>　画像にノイズを加えるにはlayerオブジェクトのapplyAddNoise()メソッドを使います。applyAddNoise()メソッドのパラメーターと指定できる内容／値を「【表】パラメーターと意味」に示します。</p>
<p>　このメソッドはフィルターメニューの「ノイズ」＞「ノイズを加える」と同じです。</p>
<table>
<caption>【表】パラメーターと意味</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>意味-</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>量（0.1～400）</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>分布方法（【表】分布方法を参照）</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>グレースケールノイズにするかどうか（true：する、false：しない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】分布方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>ノイズの分布方法</span>
  </td>
</tr>
<tr>
  <td>NoiseDistribution.GAUSSIAN</td>
  <td>ガウス分布</td>
</tr>
<tr>
  <td>NoiseDistribution.UNIFORM</td>
  <td>均等に分布</td>
</tr>
</tbody>
</table>
<p>【sample】ノイズを加える</p>
<pre><code>// ノイズを加える（フィルター＞ノイズ＞ノイズを加える）
app.activeDocument.activeLayer.applyAddNoise(
    29,    // 量
    NoiseDistribution.GAUSSIAN, // ガウス分布
    true    // グレースケールノイズ
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00484.jpeg" />
</figure>
<p>　画像にノイズが追加されます。</p>
<figure>
<figcaption>【図】画像にノイズが追加される</figcaption>
<img src="images/00255.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-659">
<section>
<h2 id="calibre_link-216"><b>7-17　ノイズを軽減する（明るさの中間値）</b></h2>
<p>　ノイズを軽減する（明るさの中間値）にはlayerオブジェクトのapplyMedianNoise()メソッドを使います。applyMedianNoise()メソッドのパラメーターには半径（1～100）を指定します。</p>
<p>　このメソッドはフィルターメニューの「ノイズ」＞「明るさの中間値」と同じです。</p>
<p>【sample】ノイズを軽減する（明るさの中間値）</p>
<pre><code>// 明るさの中間値（フィルター＞ノイズ＞明るさの中間値）
app.activeDocument.activeLayer.applyMedianNoise(1);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00021.jpeg" />
</figure>
<p>　画像のノイズが軽減されます。</p>
<figure>
<figcaption>【図】画像のノイズが軽減される</figcaption>
<img src="images/00437.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-20">
<section>
<h2 id="calibre_link-217"><b>7-18　ダスト＆スクラッチ</b></h2>
<p>　画像にダスト＆スクラッチを適用するにはlayerオブジェクトのapplyDustAndScratches()メソッドを使います。applyDustAndScratches()メソッドの最初のパラメーターには半径（1～100）を指定します。2番目のパラメーターには閾値（0～255）を指定します。</p>
<p>　このメソッドはフィルターメニューの「ノイズ」＞「ダスト＆スクラッチ」と同じです。</p>
<p>【sample】ダスト＆スクラッチ</p>
<pre><code>// ダスト＆スクラッチ（フィルター＞ノイズ＞ダスト＆スクラッチ）
app.activeDocument.activeLayer.applyDustAndScratches(15, 10);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00210.jpeg" />
</figure>
<p>　画像にダスト＆スクラッチが適用されます。</p>
<figure>
<figcaption>【図】画像にダスト＆スクラッチが適用される</figcaption>
<img src="images/00619.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-527">
<section>
<h2 id="calibre_link-218"><b>7-19　画像をぼかす</b></h2>
<p>　画像をぼかすにはlayerオブジェクトのapplyBlur()メソッドを使います。applyBlur()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはフィルターメニューの「ぼかし」＞「ぼかし」と同じです。</p>
<p>【sample】画像をぼかす</p>
<pre><code>// ぼかす（フィルター＞ぼかし＞ぼかし）
app.activeDocument.activeLayer.applyBlur();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00326.jpeg" />
</figure>
<p>　画像がぼかされます。</p>
<figure>
<figcaption>【図】画像がぼかされる</figcaption>
<img src="images/00304.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-681">
<section>
<h2 id="calibre_link-219"><b>7-20　画像を強くぼかす</b></h2>
<p>　画像を強くぼかすにはlayerオブジェクトのapplyBlurMore()メソッドを使います。applyBlurMore()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはフィルターメニューの「ぼかし」＞「ぼかし(強)」と同じです。</p>
<p>【sample】画像を強くぼかす</p>
<pre><code>// ぼかす（フィルター＞ぼかし＞ぼかし(強)）
app.activeDocument.activeLayer.applyBlurMore();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00574.jpeg" />
</figure>
<p>　画像がより強力にぼかされます。</p>
<figure>
<figcaption>【図】画像がより強力にぼかされる</figcaption>
<img src="images/00368.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-469">
<section>
<h2 id="calibre_link-220"><b>7-21　画像をぼかす（ガウス）</b></h2>
<p>　ぼかし（ガウス）を画像に適用するにはlayerオブジェクトのapplyGaussianBlur()メソッドを使います。applyGaussianBlur()メソッドのパラメーターには半径（0.1～250）を指定します。</p>
<p>　このメソッドはフィルターメニューの「ぼかし」＞「ぼかし(ガウス)」と同じです。</p>
<p>【sample】画像をぼかす（ガウス）</p>
<pre><code>// ぼかす（フィルター＞ぼかし＞ぼかし(ガウス)）
app.activeDocument.activeLayer.applyGaussianBlur(3);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00406.jpeg" />
</figure>
<p>　画像がぼかされます。</p>
<figure>
<figcaption>【図】画像がぼかされる</figcaption>
<img src="images/00527.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-627">
<section>
<h2 id="calibre_link-221"><b>7-22　画像をぼかす（レンズ）</b></h2>
<p>　画像にレンズぼかし効果を適用するにはlayerオブジェクトのapplyLensBlur()メソッドを使います。applyLensBlur()メソッドのパラメーターと指定できる内容／値を「【表】パラメーターと意味」に示します。いずれのパラメーターも省略することができます。</p>
<p>　このメソッドはフィルターメニューの「ぼかし」＞「ぼかし(レンズ)」と同じです。</p>
<table>
<caption>【表】パラメーターと意味</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>意味</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>ソースの種類（【表】ソースの種類を参照）</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>ぼかしの焦点距離</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>反転（true：反転する、false：反転しない）</td>
</tr>
<tr>
  <td>4番目のパラメーター</td>
  <td>絞りの形状（【表】パラメーターと意味を参照）</td>
</tr>
<tr>
  <td>5番目のパラメーター</td>
  <td>半径</td>
</tr>
<tr>
  <td>6番目のパラメーター</td>
  <td>絞りの円形度</td>
</tr>
<tr>
  <td>7番目のパラメーター</td>
  <td>回転</td>
</tr>
<tr>
  <td>8番目のパラメーター</td>
  <td>明るさ</td>
</tr>
<tr>
  <td>9番目のパラメーター</td>
  <td>閾値</td>
</tr>
<tr>
  <td>10番目のパラメーター</td>
  <td>ノイズの量</td>
</tr>
<tr>
  <td>11番目のパラメーター</td>
  <td>ノイズの分布方法（【表】ノイズの分布方法を参照）</td>
</tr>
<tr>
  <td>12番目のパラメーター</td>
  <td>グレースケールノイズ（true：グレースケールノイズにする、false：しない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】ソースの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>ソースの種類</span>
  </td>
</tr>
<tr>
  <td>DepthMapSource.IMAGEHIGHLIGHT</td>
  <td>画像ハイライト</td>
</tr>
<tr>
  <td>DepthMapSource.LAYERMASK</td>
  <td>レイヤーマスク</td>
</tr>
<tr>
  <td>DepthMapSource.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>DepthMapSource.TRANSPARENCYCHANNEL</td>
  <td>透明部分</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】絞りの形状</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>絞りの形状</span>
  </td>
</tr>
<tr>
  <td>Geometry.OCTAGON</td>
  <td>八角形</td>
</tr>
<tr>
  <td>Geometry.HEPTAGON</td>
  <td>七角形</td>
</tr>
<tr>
  <td>Geometry.HEXAGON</td>
  <td>六角形</td>
</tr>
<tr>
  <td>Geometry.PENTAGON</td>
  <td>五角形</td>
</tr>
<tr>
  <td>Geometry.SQUARE</td>
  <td>四角形</td>
</tr>
<tr>
  <td>Geometry.TRIANGLE</td>
  <td>三角形</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】ノイズの分布方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>ノイズの分布方法</span>
  </td>
</tr>
<tr>
  <td>NoiseDistribution.GAUSSIAN</td>
  <td>ガウス分布</td>
</tr>
<tr>
  <td>NoiseDistribution.UNIFORM</td>
  <td>均等に分布</td>
</tr>
</tbody>
</table>
<p>【sample】画像をぼかす（レンズ）</p>
<pre><code>// レンズぼかし（フィルター＞ぼかし＞ぼかし(レンズ)）
app.activeDocument.activeLayer.applyLensBlur(
    DepthMapSource.NONE,    // ソース「なし」
    0,  // ぼかしの焦点距離
    false,  // 反転しない
    Geometry.HEXAGON,   // 形状は六角形
    8,  // 半径
    0,  // 絞りの円形度
    7,  // 回転
    5,  // 明るさ
    150,    // 閾値
    0,  // ノイズの量
    NoiseDistribution.UNIFORM,  // 均等に分布
    false   // グレースケールノイズにしない
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00300.jpeg" />
</figure>
<p>　画像にレンズぼかし効果が施されます。</p>
<figure>
<figcaption>【図】画像にレンズぼかし効果が施される</figcaption>
<img src="images/00060.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-418">
<section>
<h2 id="calibre_link-222"><b>7-23　画像をぼかす（移動／モーションブラー）</b></h2>
<p>　画像を移動させたようにぼかす（モーションブラー）にはlayerオブジェクトのapplyMotionBlur()メソッドを使います。applyMotionBlur()メソッドの最初のパラメーターは角度（-360～360）を指定し、2番目のパラメーターには距離（1～999）を指定します。いずれのパラメーターも省略することはできません。</p>
<p>　このメソッドはフィルターメニューの「ぼかし」＞「ぼかし(移動)」と同じです。</p>
<p>【sample】画像をぼかす（移動／モーションブラー）</p>
<pre><code>// ぼかす（フィルター＞ぼかし＞ぼかし(移動)）
app.activeDocument.activeLayer.applyMotionBlur(45, 50);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00476.jpeg" />
</figure>
<p>　画像が斜め方向に移動したような感じでぼかされます。</p>
<figure>
<figcaption>【図】画像が斜め方向に移動したような感じでぼかされる</figcaption>
<img src="images/00250.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-572">
<section>
<h2 id="calibre_link-223"><b>7-24　画像をぼかす（詳細）</b></h2>
<p>　画像をぼかす際により細かく設定するにはlayerオブジェクトのapplySmartBlur()メソッドを使います。applySmartBlur()メソッドのパラメーターは「【表】パラメーターと意味」のようになります。いずれのパラメーターも省略することはできません。</p>
<p>　このメソッドはフィルターメニューの「ぼかし」＞「ぼかし(強)」と同じです。</p>
<table>
<caption>【表】パラメーターと意味</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>意味</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>半径</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>閾値</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>画質（【表】画質を参照）</td>
</tr>
<tr>
  <td>4番目のパラメーター</td>
  <td>モード（【表】モードを参照）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】画質</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>SmartBlurQuality.HIGH</td>
  <td>高</td>
</tr>
<tr>
  <td>SmartBlurQuality.MEDIUM</td>
  <td>中</td>
</tr>
<tr>
  <td>SmartBlurQuality.LOW</td>
  <td>低</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】モード</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>SmartBlurMode.NORMAL</td>
  <td>標準</td>
</tr>
<tr>
  <td>SmartBlurMode.EDGEONLY</td>
  <td>エッジのみ</td>
</tr>
<tr>
  <td>SmartBlurMode.OVERLAYEDGE</td>
  <td>エッジのオーバーレイ</td>
</tr>
</tbody>
</table>
<p>【sample】画像をぼかす（詳細）</p>
<pre><code>// ぼかす（フィルター＞ぼかし＞ぼかし(詳細)）
app.activeDocument.activeLayer.applySmartBlur(
    10, // 半径
    50, // 閾値
    SmartBlurQuality.HIGH,  // 高画質
    SmartBlurMode.NORMAL    // 標準
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00503.jpeg" />
</figure>
<p>　パラメーターに従って画像がぼかされます。</p>
<figure>
<figcaption>【図】パラメーターに従って画像がぼかされる</figcaption>
<img src="images/00430.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-41">
<section>
<h2 id="calibre_link-224"><b>7-25　画像をぼかす（放射状）</b></h2>
<p>　画像を放射状にぼかすにはlayerオブジェクトのapplyRadialBlur()メソッドを使います。applyRadialBlur()メソッドの最初のパラメーターには量（1～100）を指定します。2番目のパラメーターには「【表】ぼかしの方法」に示す方法を指定します。3番目のパラメーターには「【表】ぼかしの品質」に示す品質を指定します。</p>
<p>　このメソッドはフィルターメニューの「ぼかし」＞「ぼかし(放射状)」と同じです。</p>
<table>
<caption>【表】ぼかしの方法</caption>
<tbody>
<tr>
  <td>
    <span>パラーメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>RadialBlurMethod.SPIN</td>
  <td>回転</td>
</tr>
<tr>
  <td>RadialBlurMethod.ZOOM</td>
  <td>ズーム</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】ぼかしの品質</caption>
<tbody>
<tr>
  <td>
    <span>パラーメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>RadialBlurQuality.BEST</td>
  <td>高い</td>
</tr>
<tr>
  <td>RadialBlurQuality.DRAFT</td>
  <td>低い</td>
</tr>
<tr>
  <td>RadialBlurQuality.GOOD</td>
  <td>標準</td>
</tr>
</tbody>
</table>
<p>【sample】画像をぼかす（放射状）</p>
<pre><code>// ぼかす（フィルター＞ぼかし＞ぼかし(放射状)）
app.activeDocument.activeLayer.applyRadialBlur(
    30,
    RadialBlurMethod.ZOOM,  // ズーム
    RadialBlurQuality.BEST  // 高品質
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00203.jpeg" />
</figure>
<p>　画像がズームしたような感じになります。</p>
<figure>
<figcaption>【図】画像がズームしたような感じになる</figcaption>
<img src="images/00256.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-414">
<section>
<h2 id="calibre_link-225"><b>7-26　輪郭以外をぼかす</b></h2>
<p>　画像の輪郭以外をぼかすにはlayerオブジェクトのapplyDespeckle()メソッドを使います。applyDespeckle()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはフィルターメニューの「ノイズ」＞「輪郭以外をぼかす」と同じです。</p>
<p>【sample】輪郭以外をぼかす</p>
<pre><code>// ぼかす（フィルター＞ノイズ＞輪郭以外をぼかす）
app.activeDocument.activeLayer.applyDespeckle();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00022.jpeg" />
</figure>
<p>　輪郭以外がぼかされます。</p>
<figure>
<figcaption>【図】輪郭以外がぼかされる</figcaption>
<img src="images/00169.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-431">
<section>
<h2 id="calibre_link-226"><b>7-27　アンシャープマスク</b></h2>
<p>　画像にアンシャープマスクを適用するにはlayerオブジェクトのapplyUnSharpMask()メソッドを使います。applyUnSharpMask()メソッドの最初のパラメーターには量（1～500）を、2番目のパラメーターには半径（0.1～250.0）を、3番目のパラメーターには閾値（0～255）を指定します。</p>
<p>　このメソッドはフィルターメニューの「シャープ」＞「アンシャープマスク」と同じです。</p>
<p>【sample】アンシャープマスク</p>
<pre><code>// アンシャープマスク（フィルター＞シャープ＞アンシャープマスク）
app.activeDocument.activeLayer.applyUnSharpMask(512, 7.65, 64);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00206.jpeg" />
</figure>
<p>　画像の輪郭が鮮明（シャープ）になります。</p>
<figure>
<figcaption>【図】画像の輪郭が鮮明（シャープ）になる</figcaption>
<img src="images/00174.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-455">
<section>
<h2 id="calibre_link-227"><b>7-28　画像を鮮明（シャープ）にする</b></h2>
<p>　画像を鮮明（シャープ）にするにはlayerオブジェクトのapplySharpen()メソッドを使います。applySharpen()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはフィルターメニューの「シャープ」＞「シャープ」と同じです。</p>
<p>【sample】画像を鮮明（シャープ）にする</p>
<pre><code>// シャープにする（フィルター＞シャープ＞シャープ）
app.activeDocument.activeLayer.applySharpen();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00387.jpeg" />
</figure>
<p>　画像が鮮明（シャープ）になります。</p>
<figure>
<figcaption>【図】画像が鮮明（シャープ）になる</figcaption>
<img src="images/00161.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-523">
<section>
<h2 id="calibre_link-228"><b>7-29　画像を強力に鮮明（シャープ）にする</b></h2>
<p>　画像を強力に鮮明（シャープ）にするにはlayerオブジェクトのapplySharpenMore()メソッドを使います。applySharpenMore()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはフィルターメニューの「シャープ」＞「シャープ(強)」と同じです。</p>
<p>【sample】画像を強力に鮮明（シャープ）にする</p>
<pre><code>// シャープにする（フィルター＞シャープ＞シャープ(強)）
app.activeDocument.activeLayer.applySharpenMore();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00575.jpeg" />
</figure>
<p>　画像が強力に鮮明化（シャープ）されます。</p>
<figure>
<figcaption>【図】画像が強力に鮮明化（シャープ）される</figcaption>
<img src="images/00344.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-495">
<section>
<h2 id="calibre_link-229"><b>7-30　画像の輪郭を鮮明（シャープ）にする</b></h2>
<p>　画像の輪郭を鮮明（シャープ）にするにはlayerオブジェクトのapplySharpenEdges()メソッドを使います。applySharpenEdges()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはフィルターメニューの「シャープ」＞「シャープ(輪郭のみ)」と同じです。</p>
<p>【sample】画像の輪郭を鮮明（シャープ）にする</p>
<pre><code>// シャープにする（フィルター＞シャープ＞シャープ(輪郭のみ)）
app.activeDocument.activeLayer.applySharpenEdges();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00110.jpeg" />
</figure>
<p>　画像の輪郭が鮮明（シャープ）になります。</p>
<figure>
<figcaption>【図】画像の輪郭が鮮明（シャープ）になる</figcaption>
<img src="images/00528.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-514">
<section>
<h2 id="calibre_link-230"><b>7-31　画像をスクロールさせる</b></h2>
<p>　画像をスクロールさせるにはlayerオブジェクトのapplyOffset()メソッドを使います。applyOffset()メソッドの最初のパラメーターには水平方向の移動量を指定します。2番目のパラメーターには垂直方向の移動量を指定します。3番目のパラメーターはスクロール後の領域（未定義領域）をどのように処理するかを指定します。指定できる値を表に示します。</p>
<p>　このメソッドはフィルターメニューの「その他」＞「スクロール」と同じです。</p>
<table>
<caption>【表】未定義領域の処理</caption>
<tbody>
<tr>
  <td>
    <span>パラーメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>OffsetUndefinedAreas.REPEATEDGEPIXELS</td>
  <td>端のピクセルを繰り返して埋める</td>
</tr>
<tr>
  <td>OffsetUndefinedAreas.SETTOBACKGROUND</td>
  <td>背景に設定</td>
</tr>
<tr>
  <td>OffsetUndefinedAreas.WRAPAROUND</td>
  <td>ラップアラウンド（巻き戻す）</td>
</tr>
</tbody>
</table>
<p>【sample】画像をスクロールさせる</p>
<pre><code>// スクロール（フィルター＞その他＞スクロール）
app.activeDocument.activeLayer.applyOffset(
    150, // 水平方向の移動量
    -70,    // 垂直方向の移動量
    OffsetUndefinedAreas.WRAPAROUND
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00363.jpeg" />
</figure>
<p>　画像が指定した量だけスクロールします。</p>
<figure>
<figcaption>【図】画像が指定した量だけスクロールする</figcaption>
<img src="images/00520.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-535">
<section>
<h2 id="calibre_link-231"><b>7-32　画像をつまむ</b></h2>
<p>　画像をつまんで変形させるにはlayerオブジェクトのapplyPinch()メソッドを使います。applyPinch()メソッドのパラメーターには変形割合を-100～100の範囲で指定します。</p>
<p>　このメソッドはフィルターメニューの「変形」＞「つまむ」と同じです。</p>
<p>【sample】画像をつまむ</p>
<pre><code>// 画像をつまむ（フィルター＞変形＞つまむ）
app.activeDocument.activeLayer.applyPinch(100);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00477.jpeg" />
</figure>
<p>　画像の中央部がへこみます。</p>
<figure>
<figcaption>【図】画像の中央部がへこむ</figcaption>
<img src="images/00251.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-554">
<section>
<h2 id="calibre_link-232"><b>7-33　球面にする</b></h2>
<p>　画像を球面にするにはlayerオブジェクトのapplySpherize()メソッドを使います。applySpherize()メソッドの最初のパラメーターには量（-100～100）を、2番目のパラメーターにはモードを指定します。モードは以下の表に示す値を指定できます。</p>
<p>　このメソッドはフィルターメニューの「変形」＞「球面」と同じです。</p>
<table>
<caption>【表】モード</caption>
<tbody>
<tr>
  <td>
    <span>パラーメーター</span>
  </td>
  <td>
    <span>モード</span>
  </td>
</tr>
<tr>
  <td>SpherizeMode.NORMAL</td>
  <td>標準</td>
</tr>
<tr>
  <td>SpherizeMode.HORIZONTAL</td>
  <td>水平方向のみ</td>
</tr>
<tr>
  <td>SpherizeMode.VERTICAL</td>
  <td>垂直方向のみ</td>
</tr>
</tbody>
</table>
<p>【sample】球面にする</p>
<pre><code>// 球面（フィルター＞変形＞球面）
app.activeDocument.activeLayer.applySpherize(90, SpherizeMode.NORMAL);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00624.jpeg" />
</figure>
<p>　画像が球面のようになります。</p>
<figure>
<figcaption>【図】画像が球面のようになる</figcaption>
<img src="images/00431.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-574">
<section>
<h2 id="calibre_link-233"><b>7-34　画像を傾斜させる（シアー）</b></h2>
<p>　画像を傾斜させる（シアー）にはlayerオブジェクトのapplyShear()メソッドを使います。applyShear()メソッドの最初のパラメーターには傾斜に必要な曲線の座標を配列形式で指定します。その配列要素として[X座標, Y座標]を必要な数だけ記述します。2番目のパラメーターには未定義領域の処理方法を指定します。表に示す値を指定できます。</p>
<p>　このメソッドはフィルターメニューの「変形」＞「シアー」と同じです。</p>
<table>
<caption>【表】未定義領域の処理</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>処理</span>
  </td>
</tr>
<tr>
  <td>REPEATEDGEPIXELS</td>
  <td>端のピクセルを繰り返して埋める</td>
</tr>
<tr>
  <td>UndefinedAreas.WRAPAROUND</td>
  <td>ラップアラウンド（巻き戻す）</td>
</tr>
</tbody>
</table>
<p>【sample】画像を傾斜させる（シアー）</p>
<pre><code>// シアー（フィルター＞変形＞シアー）
app.activeDocument.activeLayer.applyShear(
    [[0,0] , [28,28], [0,216]],
    UndefinedAreas.WRAPAROUND
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00204.jpeg" />
</figure>
<p>　画像の中央が右方向に傾きます。</p>
<figure>
<figcaption>【図】画像の中央が右方向に傾く</figcaption>
<img src="images/00612.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-592">
<section>
<h2 id="calibre_link-234"><b>7-35　画像をジグザグ（波面）にする</b></h2>
<p>　画像をジグザグ（波面）にするにはlayerオブジェクトのapplyZigZag()メソッドを使います。applyZigZag()メソッドの最初のパラメーターには量（-100～100）を、2番目のパラメーターには折り返し数（0～20）、3番目のパラメーターにはスタイルを指定します。スタイルは以下の表に示す値を指定できます。</p>
<p>　このメソッドはフィルターメニューの「変形」＞「ジグザグ」と同じです。</p>
<table>
<caption>【表】スタイル</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>スタイル</span>
  </td>
</tr>
<tr>
  <td>ZigZagType.OUTFROMCENTER</td>
  <td>中心方向</td>
</tr>
<tr>
  <td>ZigZagType.PONDRIPPLES</td>
  <td>左上、右下方向</td>
</tr>
<tr>
  <td>ZigZagType.AROUNDCENTER</td>
  <td>回転</td>
</tr>
</tbody>
</table>
<p>【sample】画像をジグザグ（波面）にする</p>
<pre><code>// ジグザグ（フィルター＞変形＞ジグザグ）
app.activeDocument.activeLayer.applyZigZag(50, 10, ZigZagType.AROUNDCENTER);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00388.jpeg" />
</figure>
<p>　画像が波面のようになります。</p>
<figure>
<figcaption>【図】画像が波面のようになる</figcaption>
<img src="images/00155.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-615">
<section>
<h2 id="calibre_link-235"><b>7-36　画像を波紋のようにする</b></h2>
<p>　画像を波紋のようにするにはlayerオブジェクトのapplyRipple()メソッドを使います。applyRipple()メソッドの最初のパラメーターには量（-999～999）を指定します。2番目のパラメーターは振幅数を指定します。表に示す値を指定できます。</p>
<p>　このメソッドはフィルターメニューの「変形」＞「波紋」と同じです。</p>
<table>
<caption>【表】振幅数</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>振幅の大きさ</span>
  </td>
</tr>
<tr>
  <td>RippleSize.SMALL</td>
  <td>小</td>
</tr>
<tr>
  <td>RippleSize.MEDIUM</td>
  <td>中</td>
</tr>
<tr>
  <td>RippleSize.LARGE</td>
  <td>大</td>
</tr>
</tbody>
</table>
<p>【sample】画像を波紋のようにする</p>
<pre><code>// 波紋にする（フィルター＞変形＞波紋）
app.activeDocument.activeLayer.applyRipple(700, RippleSize.MEDIUM);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00568.jpeg" />
</figure>
<p>　画像が波紋のようになります。</p>
<figure>
<figcaption>【図】画像が波紋のようになる</figcaption>
<img src="images/00340.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-634">
<section>
<h2 id="calibre_link-236"><b>7-37　海の波紋</b></h2>
<p>　画像に海の波紋のような効果を適用するにはlayerオブジェクトのapplyOceanRipple()メソッドを使います。applyOceanRipple()メソッドの最初のパラメーターには波紋の振幅数（1～15）、波紋の大きさ（0～20）を指定します。</p>
<p>　このメソッドはフィルターメニューの「変形」＞「海の波紋」と同じです。（フィルターギャラリーから選択しないと出てこないこともあります）</p>
<p>【sample】海の波紋</p>
<pre><code>// 海の波紋（フィルター＞変形＞海の波紋）
app.activeDocument.activeLayer.applyOceanRipple(10, 20);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00103.jpeg" />
</figure>
<p>　画像に海の波のような効果が適用されます。</p>
<figure>
<figcaption>【図】画像に海の波のような効果が適用される</figcaption>
<img src="images/00521.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-645">
<section>
<h2 id="calibre_link-237"><b>7-38　波形にする</b></h2>
<p>　画像を波形にするにはlayerオブジェクトのapplyWave()メソッドを使います。applyWave()メソッドには多くのパラメータがあります。パラメーターと指定できる内容／値は「【表】パラメーターと意味」を参照してください。いずれのパラメーターも省略することはできません。</p>
<p>　このメソッドはフィルターメニューの「変形」＞「波形」と同じです。</p>
<table>
<caption>【表】パラメーターと意味</caption>
<tbody>
<tr>
  <td>
    <span>パラーメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>波数</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>波長の最小値</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>波長の最大値</td>
</tr>
<tr>
  <td>4番目のパラメーター</td>
  <td>振幅の最小値</td>
</tr>
<tr>
  <td>5番目のパラメーター</td>
  <td>波長の最大値</td>
</tr>
<tr>
  <td>6番目のパラメーター</td>
  <td>水平比率</td>
</tr>
<tr>
  <td>7番目のパラメーター</td>
  <td>垂直比率</td>
</tr>
<tr>
  <td>8番目のパラメーター</td>
  <td>波形の種類（【表】波形の種類を参照）</td>
</tr>
<tr>
  <td>9番目のパラメーター</td>
  <td>未定義領域部分の処理（【表】未定義領域部分の処理方法を参照）</td>
</tr>
<tr>
  <td>10番目のパラメーター</td>
  <td>乱数値</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】波形の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>波形</span>
  </td>
</tr>
<tr>
  <td>WaveType.SINE</td>
  <td>正弦波</td>
</tr>
<tr>
  <td>WaveType.SQUARE</td>
  <td>矩形波</td>
</tr>
<tr>
  <td>WaveType.TRIANGULAR</td>
  <td>三角波</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】未定義領域部分の処理方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>処理</span>
  </td>
</tr>
<tr>
  <td>UndefinedAreas.WRAPAROUND</td>
  <td>ラップアラウンド（巻き戻す）</td>
</tr>
<tr>
  <td>UndefinedAreas.REPEATEDGEPIXELS</td>
  <td>端のピクセルを繰り返して埋める</td>
</tr>
</tbody>
</table>
<p>【sample】波形にする</p>
<pre><code>// 波形（フィルター＞変形＞波形）
app.activeDocument.activeLayer.applyWave(
    1,  // 波数
    5,  // 波長・最小
    50, // 波長・最大
    3,  // 振幅・最小
    30, // 振幅・最大
    100,    // 水平比率
    80, // 垂直比率
    WaveType.SINE,  // 波形の種類は正弦波
    UndefinedAreas.WRAPAROUND,  // 未定義領域部分は巻き戻す
    10 // 乱数値
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00295.jpeg" />
</figure>
<p>　画像が波形になります。</p>
<figure>
<figcaption>【図】画像が波形になる</figcaption>
<img src="images/00054.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-675">
<section>
<h2 id="calibre_link-238"><b>7-39　渦巻き状にする</b></h2>
<p>　画像を渦巻き状にするにはlayerオブジェクトのapplyTwirl()メソッドを使います。applyTwirl()メソッドのパラメーターには回転角度を指定します。回転角度は-999～999までの数値で指定します。</p>
<p>　このメソッドはフィルタメニューの「変形」＞「渦巻き...」と同じです。</p>
<p>【sample】渦巻き状にする</p>
<pre><code>// 渦巻き状にする（フィルタ＞変形＞渦巻き）
app.activeDocument.activeLayer.applyTwirl(360);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00598.jpeg" />
</figure>
<p>　画像が渦巻き状になります。</p>
<figure>
<figcaption>【図】画像が渦巻き状になる</figcaption>
<img src="images/00246.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-581">
<section>
<h2 id="calibre_link-239"><b>7-40　置き換え（ディスプレイスメントマップ）</b></h2>
<p>　画像に置き換えフィルタを適用するにはlayerオブジェクトのapplyDisplace()メソッドを使います。applyDisplace()メソッドのパラメーターと指定できる内容／値を「【表】パラメーターと意味」に示します。</p>
<p>　このメソッドはフィルターメニューの「変形」＞「置き換え」と同じです。</p>
<table>
<caption>【表】パラメーターと意味</caption>
<tbody>
<tr>
  <td>
    <span>パラーメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>水平比率（0～10）</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>垂直比率（0～20）</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>置き換えマップデータの処理方法（【表】置き換えマップデータの処理方法を参照）</td>
</tr>
<tr>
  <td>4番目のパラメーター</td>
  <td>未定義領域部分の処理方法（【表】未定義領域部分の処理方法を参照）</td>
</tr>
<tr>
  <td>5番目のパラメーター</td>
  <td>置き換えマップファイルオブジェクト</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】置き換えマップデータの処理方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>処理</span>
  </td>
</tr>
<tr>
  <td>DisplacementMapType.STRETCHTOFIT</td>
  <td>同一サイズに拡大/縮小</td>
</tr>
<tr>
  <td>DisplacementMapType.TILE</td>
  <td>並べて表示</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】未定義領域部分の処理方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>処理</span>
  </td>
</tr>
<tr>
  <td>UndefinedAreas.WRAPAROUND</td>
  <td>ラップアラウンド（巻き戻す）</td>
</tr>
<tr>
  <td>UndefinedAreas.REPEATEDGEPIXELS</td>
  <td>端のピクセルを繰り返して埋める</td>
</tr>
</tbody>
</table>
<p>【sample】置き換え（ディスプレイスメントマップ）</p>
<pre><code>// 置き換え（フィルター＞変形＞置き換え）
var fileObj = new File("～/Desktop/text.psd");   // デスクトップ上にあるtext.psdファイル
app.activeDocument.activeLayer.applyDisplace(
    10,    // 水平比率
    10,    // 垂直比率
    DisplacementMapType.STRETCHTOFIT,   // 同一サイズに調整
    UndefinedAreas.REPEATEDGEPIXELS,    // 端のピクセルを繰り返して埋める
    fileObj // ファイルオブジェクト
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00015.jpeg" />
</figure>
<p>　指定されたファイル内容に応じて画像のピクセル位置が変わります。</p>
<figure>
<figcaption>【図】指定されたファイル内容に応じて画像のピクセル位置が変わる</figcaption>
<img src="images/00425.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-708">
<section>
<h2 id="calibre_link-240"><b>7-41　ガラス効果</b></h2>
<p>　画像にガラス効果を適用するにはlayerオブジェクトのapplyGlassEffect()メソッドを使います。applyGlassEffect()メソッドのパラメーターと指定できる内容／値を「【表】パラメーターと意味」に示します。なお、4番目から5番目のパラメーターは省略することができます。6番目のパラメーターは5番目のパラメーターでTextureType.FILEが指定された場合には必須になります。</p>
<p>　このメソッドはフィルターメニューの「変形」＞「ガラス効果」と同じです。（フィルターギャラリーから選択しないと出てこないこともあります）</p>
<table>
<caption>【表】パラメーターと意味</caption>
<tbody>
<tr>
  <td>
    <span>パラーメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>ゆがみ（0～20）</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>滑らかさ（1～15）</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>拡大縮小率／スケーリング（50～200）</td>
</tr>
<tr>
  <td>4番目のパラメーター</td>
  <td>階調の反転（true：反転する、false：反転しない）※省略可能</td>
</tr>
<tr>
  <td>5番目のパラメーター</td>
  <td>テクスチャの種類（【表】テクスチャの種類を参照）※省略可能</td>
</tr>
<tr>
  <td>6番目のパラメーター</td>
  <td>テクスチャファイルオブジェクト。5番目のパラメーターでTextureType.FILEが指定された場合。※省略可能</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】テクスチャの種類</caption>
<tbody>
<tr>
  <td>パラメーター</td>
  <td>種類</td>
</tr>
<tr>
  <td>TextureType.BLOCKS</td>
  <td>ブロック</td>
</tr>
<tr>
  <td>TextureType.CANVAS</td>
  <td>カンバス</td>
</tr>
<tr>
  <td>TextureType.FILE</td>
  <td>指定されたテクスチャファイル</td>
</tr>
<tr>
  <td>TextureType.FROSTED</td>
  <td>霜付き</td>
</tr>
<tr>
  <td>TextureType.TINYLENS</td>
  <td>型板ガラス</td>
</tr>
</tbody>
</table>
<p>【sample】ガラス効果</p>
<pre><code>// ガラス効果（フィルター＞変形＞ガラス）
var fileObj = new File("～/Desktop/text.psd");   // デスクトップ上にあるtext.psdファイル
app.activeDocument.activeLayer.applyGlassEffect(
    10,    // ゆがみ
    5,    // 滑らかさ
    100,    // 拡大縮小／スケールは100%
    false,  // 階調は反転しない
    TextureType.FILE,   // テクスチャファイルを使用
    fileObj // テクスチャファイルオブジェクト
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00198.jpeg" />
</figure>
<p>　画像にガラス効果が施されます。</p>
<figure>
<figcaption>【図】画像にガラス効果が施される</figcaption>
<img src="images/00606.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-15">
<section>
<h2 id="calibre_link-241"><b>7-42　極座標／直交座標を変換する</b></h2>
<p>　画像を極座標から直交座標、直交座標から極座標に変換するにはlayerオブジェクトのapplyPolarCoordinates()メソッドを使います。applyPolarCoordinates()メソッドのパラメーターには以下の表に示す値を指定します。</p>
<p>　このメソッドはフィルターメニューの「変形」＞「極座標」と同じです。</p>
<table>
<caption>【表】変換方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>返還方法</span>
  </td>
</tr>
<tr>
  <td>PolarConversionType.RECTANGULARTOPOLAR</td>
  <td>直交座標を極座標にする</td>
</tr>
<tr>
  <td>PolarConversionType.POLARTORECTANGULAR</td>
  <td>極座標を直交座標にする</td>
</tr>
</tbody>
</table>
<p>【sample】極座標／直交座標変換を返還する</p>
<pre><code>// 極座標（フィルター＞変形＞極座標）
app.activeDocument.activeLayer.applyPolarCoordinates(
    PolarConversionType.RECTANGULARTOPOLAR
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00380.jpeg" />
</figure>
<p>　画像が極座標に変換されます。</p>
<figure>
<figcaption>【図】画像が極座標に変換される</figcaption>
<img src="images/00149.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-584">
<section>
<h2 id="calibre_link-242"><b>7-43　NTSCカラーにする</b></h2>
<p>　画像をNTSCカラーにするにはlayerオブジェクトのapplyNTSC()メソッドを使います。applyNTSC()メソッドには指定できるパラメーターはありません。</p>
<p>　このメソッドはフィルターメニューの「ビデオ」＞「NTSC カラー」と同じです。</p>
<p>【sample】NTSCカラーにする</p>
<pre><code>// NTSCカラーにする（フィルター＞ビデオ＞NTSC カラー）
app.activeDocument.activeLayer.applyNTSC();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00563.jpeg" />
</figure>
<p>　画像のカラーがNTSCカラーになります。</p>
<figure>
<figcaption>【図】画像のカラーがNTSCカラーになる</figcaption>
<img src="images/00578.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-686">
<section>
<h2 id="calibre_link-243"><b>7-44　インターレースを解除する</b></h2>
<p>　画像のインターレースを解除するにはlayerオブジェクトのapplyDeInterlace()メソッドを使います。applyDeInterlace()メソッドの最初のパラメーターには削除するラインを指定します。指定できるラインの種類を「【表】削除するラインの種類」に示します。2番目のパラメーターには新規ラインの追加方法を指定します。指定できる方法を「【表】新規ラインの追加方法」に示します。</p>
<p>　このメソッドはフィルターメニューの「ビデオ」＞「インターレース解除...」と同じです。</p>
<table>
<caption>【表】削除するラインの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>種類</span>
  </td>
</tr>
<tr>
  <td>EliminateFields.EVENFIELDS</td>
  <td>偶数ライン</td>
</tr>
<tr>
  <td>EliminateFields.ODDFIELDS</td>
  <td>奇数ライン</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】新規ラインの追加方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>追加方法</span>
  </td>
</tr>
<tr>
  <td>CreateFields.DUPLICATION</td>
  <td>複製</td>
</tr>
<tr>
  <td>CreateFields.INTERPOLATION</td>
  <td>補間</td>
</tr>
</tbody>
</table>
<p>【sample】インターレースを解除する</p>
<pre><code>// インターレース解除（フィルター＞ビデオ＞インターレース解除...）
app.activeDocument.activeLayer.applyDeInterlace(
    EliminateFields.ODDFIELDS,  // 奇数フィールド
    CreateFields.INTERPOLATION  // 新規ラインは補間する
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00349.jpeg" />
</figure>
<p>　画像のインターレースが解除されます。</p>
<figure>
<figcaption>【図】画像のインターレースが解除される</figcaption>
<img src="images/00114.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-476">
<section>
<h2 id="calibre_link-244"><b>7-45　逆光効果を適用する</b></h2>
<p>　画像に逆光効果を適用するにはlayerオブジェクトのapplyLensFlare()メソッドを使います。applyLensFlare()メソッドの最初パラメーターには明るさ（0～300）の割合を指定します。2番目のパラメーターには逆光の基準位置を[X座標, Y座標]の配列形式で指定します。座標値はUnitValue形式で指定します。3番目のパラメーターはレンズの種類で表に示す値を指定できます。</p>
<p>　このメソッドはフィルターメニューの「描画」＞「逆光」と同じです。</p>
<table>
<caption>【表】レンズの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>種類</span>
  </td>
</tr>
<tr>
  <td>LensType.ZOOMLENS</td>
  <td>50mm-300mmズーム</td>
</tr>
<tr>
  <td>LensType.PRIME35</td>
  <td>35mm</td>
</tr>
<tr>
  <td>LensType.PRIME105</td>
  <td>105mm</td>
</tr>
<tr>
  <td>LensType.MOVIEPRIME</td>
  <td>ムービープライム</td>
</tr>
</tbody>
</table>
<p>【sample】逆光効果</p>
<pre><code>// 逆光効果（フィルター＞描画＞逆光）
app.activeDocument.activeLayer.applyLensFlare(
    100,    // 100%
    [UnitValue("60px"), UnitValue("100px")],    // 座標(60px, 100px)
    LensType.PRIME105   // 105mmレンズ
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00531.jpeg" />
</figure>
<p>　画像に逆光効果が施されます。</p>
<figure>
<figcaption>【図】画像に逆光効果が施される</figcaption>
<img src="images/00372.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-632">
<section>
<h2 id="calibre_link-245"><b>7-46　光彩拡散を加える</b></h2>
<p>　画像に光彩拡散を加えるにはlayerオブジェクトのapplyDiffuseGlow()メソッドを使います。applyDiffuseGlow()メソッドのパラメーターと指定できる内容／値を「【表】パラメーターと意味」に示します。</p>
<p>　このメソッドはフィルターメニューの「変形」＞「光彩拡散」と同じです。（フィルターギャラリーから選択しないと出てこないこともあります）</p>
<table>
<caption>【表】パラメーターと意味</caption>
<tbody>
<tr>
  <td>
    <span>パラーメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>きめの度合い（0～10）</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>光彩度（0～20）</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>透明度（0～20）</td>
</tr>
</tbody>
</table>
<p>【sample】光彩拡散を加える</p>
<pre><code>// 光彩拡散（フィルター＞変形＞光彩拡散）
app.activeDocument.activeLayer.applyDiffuseGlow(
    7,  // きめの度合い
    2,  // 光彩度
    10  // 透明度
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00506.jpeg" />
</figure>
<p>　画像に光彩が拡散したような効果が施されます。</p>
<figure>
<figcaption>【図】画像に光彩が拡散したような効果が施される</figcaption>
<img src="images/00481.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-421">
<section>
<h2 id="calibre_link-246"><b>7-47　ハイパスを適用する</b></h2>
<p>　画像にハイパスフィルタを適用するにはlayerオブジェクトのapplyHighPass()メソッドを使います。applyHighPass()メソッドのパラメーターには半径（0.1～250.0）を指定します。</p>
<p>　このメソッドはフィルターメニューの「その他」＞「ハイパス」と同じです。</p>
<p>【sample】ハイパスを適用する</p>
<pre><code>// ハイパス（フィルター＞その他＞ハイパス）
app.activeDocument.activeLayer.applyHighPass(10);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00254.jpeg" />
</figure>
<p>　画像にハイパスフィルタが適用されます。</p>
<figure>
<figcaption>【図】画像にハイパスフィルタが適用される</figcaption>
<img src="images/00020.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-577">
<section>
<h2 id="calibre_link-247"><b>7-48　雲模様1を描く</b></h2>
<p>　雲模様1を描くにはlayerオブジェクトのapplyClouds()メソッドを使います。applyClouds()メソッドには指定できるパラメーターはありません。雲模様で使用される色はドキュメントの前景色と背景色がベースになります。</p>
<p>　このメソッドはフィルターメニューの「描画」＞「雲模様1」と同じです。</p>
<p>【sample】雲模様1を描く</p>
<pre><code>// 雲模様を描く（フィルター＞描画＞雲模様1）
app.activeDocument.activeLayer.applyClouds();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00434.jpeg" />
</figure>
<p>　雲模様が描かれます。</p>
<figure>
<figcaption>【図】雲模様が描かれる</figcaption>
<img src="images/00209.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-13">
<section>
<h2 id="calibre_link-248"><b>7-49　雲模様2を描く</b></h2>
<p>　雲模様2を描くにはlayerオブジェクトのapplyDifferenceClouds()メソッドを使います。applyDifferenceClouds()メソッドには指定できるパラメーターはありません。雲模様で使用される色はドキュメントの前景色と背景色がベースになります。</p>
<p>　このメソッドはフィルターメニューの「描画」＞「雲模様2」と同じです。</p>
<p>【sample】雲模様2を描く</p>
<pre><code>// 雲模様を描く（フィルター＞描画＞雲模様2）
app.activeDocument.activeLayer.applyDifferenceClouds();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00617.jpeg" />
</figure>
<p>　雲模様が描かれます。</p>
<figure>
<figcaption>【図】雲模様が描かれる</figcaption>
<img src="images/00391.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-521">
<section>
<h2 id="calibre_link-249"><b>7-50　カスタムフィルターを設定する</b></h2>
<p>　PhotoshopではapplyCustomFilter()メソッドを使うことでカスタムフィルターを設定することができます。ここでいうカスタムフィルターは5×5の行列（フィルターカーネル）によって演算されるものを言います。画像の1ピクセルを5×5の行列と計算した結果が画像に反映されます。applyCustomFilter()メソッドの最初のパラメーターに配列形式で5×5、合計25個の数値を指定します。2番目のパラメーターにはスケールを指定します。3番目のパラメーターにはオフセットを指定します。</p>
<p>　フィルターカーネルの値を変えることでぼかし効果やエンボス効果、輪郭抽出などさまざまな効果を施すことができます。代表的な設定値を表に示します。なお、この値だけでなく同時にスケールやオフセットも設定しないと期待通りの結果になりません。</p>
<p>　このメソッドはフィルターメニューの「その他」＞「カスタム」と同じです。</p>
<table>
<caption>【表】代表的なカスタムフィルター設定値</caption>
<tbody>
<tr>
  <td>
    <span>フィルター</span>
  </td>
  <td>
    <span>設定値</span>
  </td>
</tr>
<tr>
  <td>［ぼかし］</td>
  <td>
    <span>0, 0, 0, 0, 0</span><br />
<span>0, 1, 1, 1, 0</span><br />
<span>0, 1, 1, 1, 0</span><br />
<span>0, 1, 1, 1, 0</span><br />
<span>0, 0, 0, 0, 0</span>
  </td>
</tr>
<tr>
  <td>［シャープ］</td>
  <td>
    <span>0, 0, 0, 0, 0</span><br />
<span>0, 0,-1, 0, 0</span><br />
<span>0,-1, 5,-1, 0</span><br />
<span>0, 0,-1, 0, 0</span><br />
<span>0, 0, 0, 0, 0</span>
  </td>
</tr>
<tr>
  <td>［輪郭を強調］</td>
  <td>
    <span>0, 0, 0, 0, 0</span><br />
<span>0, 0, 0, 0, 0</span><br />
<span>0,-1, 1, 0, 0</span><br />
<span>0, 0, 0, 0, 0</span><br />
<span>0, 0, 0, 0, 0</span>
  </td>
</tr>
<tr>
  <td>［輪郭抽出］</td>
  <td>
    <span>0, 0, 0, 0, 0</span><br />
<span>0, 0, 1, 0, 0</span><br />
<span>0, 1,-4, 1, 0</span><br />
<span>0, 0, 1, 0, 0</span><br />
<span>0, 0, 0, 0, 0</span>
  </td>
</tr>
<tr>
  <td>［エンボス］</td>
  <td>
    <span>0, 0, 0, 0, 0</span><br />
<span>0,-2,-1, 0, 0</span><br />
<span>0,-1, 1, 1, 0</span><br />
<span>0, 0, 1, 2, 0</span><br />
<span>0, 0, 0, 0, 0</span>
  </td>
</tr>
</tbody>
</table>
<p>【sample】カスタムフィルターを設定する</p>
<pre><code>// カスタムフィルター（フィルター＞その他＞カスタム）
app.activeDocument.activeLayer.applyCustomFilter(
   [   0, 0, 0, 0, 0,  // フィルターカーネル（5×5）
        0, -2, -1, 1, 0,
        0,  -1,  1, 1, 0,
        0,  0,  1, 2, 0,
        0,  0,  0, 0, 0
   ],
   2,   // スケール
   16    // オフセット
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00158.jpeg" />
</figure>
<p>　画像がエンボス加工されます。</p>
<figure>
<figcaption>【図】画像がエンボス加工される</figcaption>
<img src="images/00572.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-677">
<section>
<div>
<h1 id="calibre_link-250"><b>第8章　チャンネル</b></h1>
</div>
</section>
</div>
<div id="calibre_link-464">
<section>
<h2 id="calibre_link-251"><b>8-1　チャンネル数を求める</b></h2>
<p>　チャンネル数を求めるにはdocumentオブジェクトのchannels配列の要素数を取得します。channels配列なのでchannels.lengthとすることでドキュメントのチャンネル数を求めることができます。</p>
<p>【sample】チャンネル数を求める</p>
<pre><code>//チャンネル数を求める
var n = app.activeDocument.channels.length;
alert(n);</code></pre>
<p>　開かれているドキュメントのチャンネル数がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】開かれているドキュメントのチャンネル数が表示される</figcaption>
<img src="images/00586.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-429">
<section>
<h2 id="calibre_link-252"><b>8-2　チャンネルを追加する</b></h2>
<p>　チャンネルを追加するにはdocumentオブジェクトのchannelsオブジェクトのadd()メソッドを使います。戻り値は新規に追加したチャンネル(channel)オブジェクトになります。チャンネルオブジェクトには以下の「【表】チャンネルオブジェクトのプロパティ」に示すプロパティを設定することができます。設定した後は読み出しも可能です。</p>
<table>
<caption>【表】チャンネルオブジェクトのプロパティ</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>color</td>
  <td>チャンネルの表示色。SolidColorで指定。</td>
</tr>
<tr>
  <td>kind</td>
  <td>チャンネルの種類（【表】チャンネルの種類を参照）</td>
</tr>
<tr>
  <td>name</td>
  <td>チャンネルの名前</td>
</tr>
<tr>
  <td>opacity</td>
  <td>チャンネルの不透明度（0～100）。kindプロパティがChannelType.MASKEDAREAかChannelType.SELECTEDAREAの場合のみ有効。</td>
</tr>
<tr>
  <td>visible</td>
  <td>チャンネルを表示するかどうか。trueなら表示する、falseなら表示しない。</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】チャンネルの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>チャンネルの種類</span>
  </td>
</tr>
<tr>
  <td>ChannelType.COMPONENT</td>
  <td>コンポーネント</td>
</tr>
<tr>
  <td>ChannelType.MASKEDAREA</td>
  <td>マスク領域（アルファチャネル）</td>
</tr>
<tr>
  <td>ChannelType.SELECTEDAREA</td>
  <td>選択領域（アルファチャネル）</td>
</tr>
<tr>
  <td>ChannelType.SPOTCOLOR</td>
  <td>スポットカラー（アルファチャネル）</td>
</tr>
</tbody>
</table>
<p>【sample】チャンネルを追加する</p>
<pre><code>// チャンネルを追加する
var chObj = app.activeDocument.channels.add();
chObj.name = "背景切り抜き用チャンネル";    // チャンネル名を指定
chObj.opacity = 75;    // 不透明度を75%
chObj.visible = true;   // チャンネルを表示
chObj.color = (function(){   // チャンネルカラーをオレンジ色に指定
    var color = new SolidColor();
    color.rgb.red = 255;
    color.rgb.green = 128;
    color.rgb.blue = 10;
    return color;
})();</code></pre>
<p>　スクリプト実行前のチャンネルの状態です。チャンネルはR,G,Bの3つです。</p>
<figure>
<figcaption>【図】スクリプト実行前のチャンネルの状態</figcaption>
<img src="images/00108.jpeg" />
</figure>
<p>　スクリプトを実行すると新規に1つチャンネルが追加されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると新規に1つチャンネルが追加される</figcaption>
<img src="images/00525.jpeg" />
</figure>
<p>　不透明度や表示色はチャンネルパネルのチャンネルオプションでも確認できます。スクリプトで設定した値になっているのが確認できます。</p>
<figure>
<figcaption>【図】不透明度や表示色はチャンネルパネルのチャンネルオプションでも確認できる</figcaption>
<img src="images/00297.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-587">
<section>
<h2 id="calibre_link-253"><b>8-3　チャンネルを複製する</b></h2>
<p>　チャンネルを複製するにはdocumentオブジェクトのchannelsオブジェクトのduplicate()メソッドを使います。戻り値は複製したチャンネル(channel)オブジェクトになります。また、duplicate()メソッドのパラメーターにdocumentオブジェクトを指定すると指定したドキュメントのチャンネルを複製した内容がコピーされます。</p>
<p>【sample】チャンネルを複製する</p>
<pre><code>// チャンネルを複製する
var chObj = app.activeDocument.channels["レッド"];
chObj.duplicate();</code></pre>
<p>　スクリプト実行前のチャンネルの状態です。チャンネルはR,G,Bの3つです。</p>
<figure>
<figcaption>【図】スクリプト実行前のチャンネルの状態</figcaption>
<img src="images/00056.jpeg" />
</figure>
<p>　スクリプトを実行するとレッドのチャンネルが複製されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレッドのチャンネルが複製される</figcaption>
<img src="images/00474.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-22">
<section>
<h2 id="calibre_link-254"><b>8-4　スポットカラーチャンネルをマージ（統合）する</b></h2>
<p>　スポットカラーチャンネルをマージ（統合）するにはdocumentオブジェクトのchannelsオブジェクトのmerge()メソッドを使います。merge()メソッドはRGBカラーまたはCMYKカラーモードの場合に有効です。Labカラーやマルチチャンネルモードではエラーとなり動作しません。</p>
<p>【sample】スポットカラーチャンネルをマージ（統合）する</p>
<pre><code>// チャンネルをマージ（統合）する
var chObj = app.activeDocument.channels["spot1"];
chObj.merge();</code></pre>
<p>　スクリプト実行前のチャンネルの状態です。マージ（統合）するためのαチャンネルが1つあります。</p>
<figure>
<figcaption>【図】スクリプト実行前のチャンネルの状態</figcaption>
<img src="images/00248.jpeg" />
</figure>
<p>　スクリプトを実行するとαチャンネルがR,G,Bチャンネルにマージ（統合）されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとαチャンネルがR,G,Bチャンネルにマージ（統合）される</figcaption>
<img src="images/00017.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-528">
<section>
<h2 id="calibre_link-255"><b>8-5　チャンネルを削除する</b></h2>
<p>　チャンネルを削除するにはdocumentオブジェクトのchannelsオブジェクトのremove()メソッドを使います。</p>
<p>【sample】チャンネルを削除する</p>
<pre><code>// チャンネルを削除する
app.activeDocument.channels["人物用"].remove();</code></pre>
<p>　スクリプト実行前のチャンネルの状態です。αチャンネルは2つあります。</p>
<figure>
<figcaption>【図】スクリプト実行前のチャンネルの状態</figcaption>
<img src="images/00428.jpeg" />
</figure>
<p>　スクリプトを実行すると指定した名前のチャンネルが削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると指定した名前のチャンネルが削除される</figcaption>
<img src="images/00200.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-683">
<section>
<div>
<h1 id="calibre_link-256"><b>第9章　カラー／カラーサンプル／カラーモード変換</b></h1>
</div>
</section>
</div>
<div id="calibre_link-472">
<section>
<h2 id="calibre_link-257"><b>9-1　RGBカラーで指定する</b></h2>
<p>　RGBカラーはSolidColorオブジェクトのrgbオブジェクトの各プロパティに格納されています。以下の表に示すプロパティと値の範囲になります。輝度の値は数値が大きくなるほど明るくなります。なお、場合によっては色域調整されるためプログラムで指定した値にならないこともあります。</p>
<table>
<caption>【表】RGBカラーのプロパティ</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>指定できる値</span>
  </td>
</tr>
<tr>
  <td>red</td>
  <td>赤の輝度（0～255）</td>
</tr>
<tr>
  <td>green</td>
  <td>緑の輝度（0～255）</td>
</tr>
<tr>
  <td>blue</td>
  <td>青の輝度（0～255）</td>
</tr>
</tbody>
</table>
<p>【sample】RGBカラーで指定する</p>
<pre><code>// RGBカラーで指定する
var color = new SolidColor();
color.rgb.red = 196;    // 赤の輝度
color.rgb.green = 10;   // 緑の輝度
color.rgb.blue = 32;    // 青の輝度
// 新規のドキュメントを作成し指定した色で塗り潰す
documents.add(320, 240, 72, "Sample", NewDocumentMode.RGB);
activeDocument.selection.selectAll();
activeDocument.selection.fill(color,ColorBlendMode.NORMAL, 100, false);
activeDocument.selection.deselect();</code></pre>
<p>　指定したRGBカラー値で塗り潰されます。</p>
<figure>
<figcaption>【図】指定したRGBカラー値で塗り潰される</figcaption>
<img src="images/00609.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-629">
<section>
<h2 id="calibre_link-258"><b>9-2　CMYKカラーで指定する</b></h2>
<p>　CMYKカラーはSolidColorオブジェクトのcmykオブジェクトの各プロパティに格納されています。以下の表に示すプロパティと値の範囲になります。値が大きくなるほど濃くなります。</p>
<table>
<caption>【表】CMYKカラーのプロパティ</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>指定できる値</span>
  </td>
</tr>
<tr>
  <td>cyan</td>
  <td>シアン（水色）の割合（0～100.0）</td>
</tr>
<tr>
  <td>magenta</td>
  <td>マゼンダ（紫色）の割合（0～100.0）</td>
</tr>
<tr>
  <td>yellow</td>
  <td>イエロー（黄色）の割合（0～100.0）</td>
</tr>
<tr>
  <td>black</td>
  <td>ブラック（黒／スミ）の割合（0～100.0）</td>
</tr>
</tbody>
</table>
<p>【sample】CMYKカラーで指定する</p>
<pre><code>// CMYKカラーで指定する
var color = new SolidColor();
color.cmyk.cyan= 80.5;    // 赤の割合
color.cmyk.magenta = 60.1;   // 緑の割合
color.cmyk.yellow = 50;    // 青の割合
color.cmyk.black = 12.5;    // 黒の割合
// 新規のドキュメントを作成し指定した色で塗り潰す
documents.add(320, 240, 72, "Sample", NewDocumentMode.CMYK);
activeDocument.selection.selectAll();
activeDocument.selection.fill(color,ColorBlendMode.NORMAL, 100, false);
activeDocument.selection.deselect();</code></pre>
<p>　指定したCMYKカラー値で塗り潰されます。</p>
<figure>
<figcaption>【図】指定したCMYKカラー値で塗り潰される</figcaption>
<img src="images/00384.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-417">
<section>
<h2 id="calibre_link-259"><b>9-3　HSBカラーで指定する</b></h2>
<p>　HSBカラーはSolidColorオブジェクトのhsbオブジェクトの各プロパティに格納されています。以下の表に示すプロパティと値の範囲になります。なお、場合によっては色域調整されるためプログラムで指定した値にならないこともあります。</p>
<table>
<caption>【表】HSBカラーのプロパティ</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>指定できる値</span>
  </td>
</tr>
<tr>
  <td>hue</td>
  <td>色相（0～360.0）</td>
</tr>
<tr>
  <td>saturation</td>
  <td>彩度（0～100.0）</td>
</tr>
<tr>
  <td>brightness</td>
  <td>輝度（0～100.0）</td>
</tr>
</tbody>
</table>
<p>【sample】HSBカラーで指定する</p>
<pre><code>// HSBカラーで指定する
var color = new SolidColor();
color.hsb.hue = 120.8;    // 色相
color.hsb.saturation = 80.4;   // 彩度
color.hsb.brightness = 65.5;    // 輝度
// 新規のドキュメントを作成し指定した色で塗り潰す
documents.add(320, 240, 72, "Sample", NewDocumentMode.RGB);
activeDocument.selection.selectAll();
activeDocument.selection.fill(color,ColorBlendMode.NORMAL, 100, false);
activeDocument.selection.deselect();</code></pre>
<p>　指定したHSBカラー値で塗り潰されます。</p>
<figure>
<figcaption>【図】指定したHSBカラー値で塗り潰される</figcaption>
<img src="images/00152.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-655">
<section>
<h2 id="calibre_link-260"><b>9-4　グレースケールで指定する</b></h2>
<p>　グレースケールのカラーはSolidColorオブジェクトのgrayオブジェクトのgrayプロパティに格納されています。grayプロパティは以下の表に示す値の範囲になります。なお、場合によっては色域調整されるためプログラムで指定した値にならないこともあります。</p>
<table>
<caption>【表】グレースケールのプロパティ</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>指定できる値</span>
  </td>
</tr>
<tr>
  <td>gray</td>
  <td>輝度（0～100.0）</td>
</tr>
</tbody>
</table>
<p>【sample】グレースケールで指定する</p>
<pre><code>// グレースケールで指定する
var color = new SolidColor();
color.gray.gray = 50.8;    // 輝度
// 新規のドキュメントを作成し指定した色で塗り潰す
documents.add(320, 240, 72, "Sample", NewDocumentMode.GRAYSCALE);
activeDocument.selection.selectAll();
activeDocument.selection.fill(color,ColorBlendMode.NORMAL, 100, false);
activeDocument.selection.deselect();</code></pre>
<p>　指定したグレースケールの値で塗り潰されます。</p>
<figure>
<figcaption>【図】指定したグレースケールの値で塗り潰される</figcaption>
<img src="images/00566.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-10">
<section>
<h2 id="calibre_link-261"><b>9-5　Labカラーで指定する</b></h2>
<p>　LabカラーはSolidColorオブジェクトのlabオブジェクトの各プロパティに格納されています。以下の表に示すプロパティと値の範囲になります。</p>
<table>
<caption>【表】Labカラーのプロパティ</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>指定できる値</span>
  </td>
</tr>
<tr>
  <td>l</td>
  <td>明度（0～100.0）</td>
</tr>
<tr>
  <td>a</td>
  <td>赤～緑（-128～127.0）</td>
</tr>
<tr>
  <td>b</td>
  <td>青～黄（-128～127.0）</td>
</tr>
</tbody>
</table>
<p>【sample】Labカラーで指定する</p>
<pre><code>// Labカラーで指定する
var color = new SolidColor();
color.lab.l = 34;    // 明度
color.lab.a = 54;   // 赤～緑
color.lab.b = -104;    // 青～黄
// 新規のドキュメントを作成し指定した色で塗り潰す
documents.add(320, 240, 72, "Sample", NewDocumentMode.RGB);
activeDocument.selection.selectAll();
activeDocument.selection.fill(color,ColorBlendMode.NORMAL, 100, false);
activeDocument.selection.deselect();</code></pre>
<p>　指定したLabカラー値で塗り潰されます。</p>
<figure>
<figcaption>【図】指定したLabカラー値で塗り潰される</figcaption>
<img src="images/00337.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-517">
<section>
<h2 id="calibre_link-262"><b>9-6　カラーを相互変換する</b></h2>
<p>　PhotoshopではSolidColorオブジェクトを利用することで相互にカラーの値を変換することができます。SolidColorのカラーを示すオブジェクト、例えばrgbオブジェクトの各プロパティに輝度を設定すると、他のCMYKカラーやLabカラーのオブジェクトの各プロパティにも自動的に値が設定されます。このため、以下のサンプルのように求めたいカラーモードのプロパティを読み出すだけでよく、複雑な変換式を使う必要はありません。</p>
<p>【sample】カラーを相互変換する</p>
<pre><code>// カラーを相互変換する
var color = new SolidColor();
var R = color.rgb.red = 196;    // 赤の輝度
var G = color.rgb.green = 10;   // 緑の輝度
var B = color.rgb.blue = 32;    // 青の輝度
var c = color.cmyk.cyan;    // シアン
var m = color.cmyk.magenta;
var y = color.cmyk.yellow;
var k = color.cmyk.black;
var L = color.lab.l;
var a = color.lab.a;
var b = color.lab.b;
alert("RGB："+R+", "+G+", "+B+"\n"+
    "CMYK："+c+", "+m+", "+y+" ,"+k+"\n"+
    "Lab："+L+", "+a+", "+b);</code></pre>
<p>　相互変換した結果がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】相互変換した結果が表示される</figcaption>
<img src="images/00101.jpeg" />
</figure>
<p>　スクリプトと同じ値をPhotoshopのカラーピッカーに代入するとスクリプトとほぼ同じ値が表示されます。ダイアログでは四捨五入した値になりますが、プログラムでは四捨五入されないため、より細かい値になります。</p>
<figure>
<figcaption>【図】スクリプトと同じ値をカラーピッカーに代入すると、ほぼ同じ値が表示される</figcaption>
<img src="images/00518.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-671">
<section>
<h2 id="calibre_link-263"><b>9-7　カラーピッカーを表示する</b></h2>
<p>　PhotoshopではshowColorPicker()メソッドによりカラーピッカーを表示することができます。ただし、このカラーピッカーで選択したカラーをプログラムで取得することはできません。また、Scripting Listenerを使って記録した場合、カラーピッカーで選択した値は得ることができますが、カラーピッカー自体は表示されません。</p>
<p>　カラーピッカーを表示させ、なおかつ取得されたカラー値が必要な場合はESTK（ExtendScript Toolkit）で扱えるカラーピッカーを利用する方法もあります。これは$.colorPicker()としてメソッドを実行すると選択したカラーが0xRRGGBBの値で返されます。数値になるため各RGBに分解するにはサンプルのように論理積とシフト演算を使います。</p>
<p>【sample】カラーピッカーを表示する</p>
<pre><code>// Photoshopのカラーピッカーを表示する
var flag = showColorPicker();
alert(flag);
// 開発ツールESTKでのカラーピッカーを表示する
var color = $.colorPicker(0xFF0000);
var R = (color &amp; 0xFF0000) &gt;&gt; 16;
var G = (color &amp; 0xFF00) &gt;&gt; 8;
var B = color &amp; 0xFF;
alert(R+", "+G+", "+B);</code></pre>
<p>　Photoshopのカラーピッカーが表示されます。</p>
<figure>
<figcaption>【図】Photoshopのカラーピッカーが表示される</figcaption>
<img src="images/00293.jpeg" />
</figure>
<p>　OKボタンがクリックされるとtrueが表示されます。キャンセルボタンが押された場合はfalseが表示されます。</p>
<figure>
<figcaption>【図】OKボタンがクリックされるとtrueが表示され、キャンセルボタンが押された場合はfalseが表示される</figcaption>
<img src="images/00051.jpeg" />
</figure>
<p>　ESTK（ExtendScript Toolkit）でのカラーピッカーが表示されます。このカラーピッカーはOSに依存したものになります。Macの場合は図のようなダイアログになりスライダー等で色を調整できます。</p>
<figure>
<figcaption>【図】ESTKでのカラーピッカーが表示される</figcaption>
<img src="images/00468.jpeg" />
</figure>
<p>　カラーピッカーで色を調整します。</p>
<figure>
<figcaption>【図】カラーピッカーで色を調整する</figcaption>
<img src="images/00244.jpeg" />
</figure>
<p>　カラーピッカーを閉じると選択した色のRGB値がダイアログに表示されます。</p>
<figure>
<figcaption>【図】カラーピッカーを閉じると選択した色のRGB値がダイアログに表示される</figcaption>
<img src="images/00298.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-462">
<section>
<h2 id="calibre_link-264"><b>9-8　カラーサンプルの総数を求める</b></h2>
<p>　カラーサンプルの総数を求めるにはdocumentオブジェクトのcolorSamplers配列の要素数を調べます。要素数はlengthプロパティで取得することができるため、app.activeDocument.colorSamplers.lengthとすることでアクティブになっているドキュメントのカラーサンプル総数を求めることができます。</p>
<p>【sample】カラーサンプルの総数を求める</p>
<pre><code>// カラーサンプルの総数を表示する
var n = app.activeDocument.colorSamplers.length;
alert(n);</code></pre>
<p>　カラーサンプルの総数がアラートダイアログに表示されます。カラーサンプルに関しては情報パネルに最大4つまで表示されます。</p>
<figure>
<figcaption>【図】カラーサンプルの総数が表示される</figcaption>
<img src="images/00057.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-617">
<section>
<h2 id="calibre_link-265"><b>9-9　カラーサンプルを追加する</b></h2>
<p>　カラーサンプルを追加するにはdocumentオブジェクトのcolorSamplersオブジェクトのadd()メソッドを使います。add()メソッドに色を取得したい座標を配列形式で指定します。これはadd([X座標, Y座標])のように指定します。座標値にはUnitValueを指定することができます。</p>
<p>　カラーサンプルは最大4つまでしか追加／登録できないため、すでに4つカラーサンプルが存在する場合にadd()メソッドを実行するとエラーになります。カラーサンプルを削除したい場合にはremove()メソッドを使ってください。</p>
<p>【sample】カラーサンプルを追加する</p>
<pre><code>// カラーサンプルを追加する
var x = UnitValue(10, "px");    // X座標を指定
var y = UnitValue(50, "px");    // Y座標を指定
var cs = app.activeDocument.colorSamplers.add([x, y]);</code></pre>
<p>　スクリプトを実行する前はカラーサンプルは2つあります。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00475.jpeg" />
</figure>
<p>　スクリプトを実行すると左上にカラーサンプルが1つ追加されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると左上にカラーサンプルが1つ追加される</figcaption>
<img src="images/00249.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-407">
<section>
<h2 id="calibre_link-266"><b>9-10　カラーサンプルの座標値を変更する</b></h2>
<p>　カラーサンプルの座標値を変更するにはdocumentオブジェクトのcolorSamplerオブジェクトのmove()メソッドを使います。move()メソッドに色を取得したい座標を配列形式で指定します。これはmove([X座標, Y座標])のように指定します。座標値にはUnitValueを指定することができます。</p>
<p>【sample】カラーサンプルの座標値を変更する</p>
<pre><code>// カラーサンプルの座標値を変更する
var x = UnitValue(30, "px");    // X座標を指定
var y = UnitValue(70, "px");    // Y座標を指定
app.activeDocument.colorSamplers[0].move([x, y]);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00265.jpeg" />
</figure>
<p>　スクリプトを実行すると#1のカラーサンプルの座標が変わります。</p>
<figure>
<figcaption>【図】スクリプトを実行すると#1のカラーサンプルの座標が変わる</figcaption>
<img src="images/00429.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-560">
<section>
<h2 id="calibre_link-267"><b>9-11　カラーサンプルのカラーを取得する</b></h2>
<p>　カラーサンプルで指定されている座標のカラーを取得するにはdocumentオブジェクトのcolorSamplerオブジェクトのcolorプロパティを参照します。colorプロパティにはSolidColorオブジェクトが格納されているため、RGB、CMYKなど各色情報を読み出すことができます。</p>
<p>【sample】カラーサンプルのカラーを取得する</p>
<pre><code>// カラーサンプルのカラーを表示する
var color = app.activeDocument.colorSamplers[0].color;
var R = color.rgb.red;
var G = color.rgb.green;
var B = color.rgb.blue;
alert(R+", "+G+", "+B); // RGB値を表示</code></pre>
<p>　#1のカラーサンプル座標にあるRGBカラー値がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】#1のカラーサンプル座標にあるRGBカラー値が表示される</figcaption>
<img src="images/00201.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-711">
<section>
<h2 id="calibre_link-268"><b>9-12　カラーサンプルを削除する</b></h2>
<p>　カラーサンプルを削除するにはdocumentオブジェクトのcolorSamplerオブジェクトのremove()メソッドを実行します。カラーサンプルが存在しない場合はエラーになります。エラーを回避する場合はあらかじめカラーサンプルの総数を調べるか、try...catchを使います。</p>
<p>【sample】カラーサンプルを削除する</p>
<pre><code>// 最初のカラーサンプルを削除する
app.activeDocument.colorSamplers[0].remove();</code></pre>
<p>　#1のカラーサンプルが削除される前の状態です。</p>
<figure>
<figcaption>【図】#1のカラーサンプルが削除される前の状態</figcaption>
<img src="images/00610.jpeg" />
</figure>
<p>　#1のカラーサンプルが削除されます。残ったカラーサンプルの番号は割り当て直されます。</p>
<figure>
<figcaption>【図】#1のカラーサンプルが削除される</figcaption>
<img src="images/00385.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-597">
<section>
<h2 id="calibre_link-269"><b>9-13　カラーサンプルを全て削除する</b></h2>
<p>　カラーサンプルを全て削除するにはdocumentオブジェクトのcolorSamplersオブジェクトのremoveAll()メソッドを実行します。removeAll()メソッドはカラーサンプルが存在しない場合でもエラーにはなりません。</p>
<p>【sample】カラーサンプルを全て削除する</p>
<pre><code>// カラーサンプルを全て削除する
app.activeDocument.colorSamplers.removeAll();</code></pre>
<p>　スクリプトを実行する前の状態です。カラーサンプルは4つあります。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00153.jpeg" />
</figure>
<p>　全てのカラーサンプルが削除されます。</p>
<figure>
<figcaption>【図】全てのカラーサンプルが削除される</figcaption>
<img src="images/00567.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-459">
<section>
<h2 id="calibre_link-270"><b>9-14　ドキュメントのカラーモードを変更する</b></h2>
<p>　ドキュメントのカラーモードを変更するにはdocumentオブジェクトのchangeMode()メソッドを使います。changeMode()メソッドの最初のパラメーターに変更したいモードを指定します。白黒変換とインデックスカラーに変換する場合はchangeMode()メソッドの2番目のパラメーターに変換オプションを指定することができます。</p>
<table>
<caption>【表】指定できるカラーモード</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>カラーモード</span>
  </td>
</tr>
<tr>
  <td>ChangeMode.BITMAP</td>
  <td>白黒</td>
</tr>
<tr>
  <td>ChangeMode.CMYK</td>
  <td>CMYKカラー</td>
</tr>
<tr>
  <td>ChangeMode.GRAYSCALE</td>
  <td>グレースケールカラー</td>
</tr>
<tr>
  <td>ChangeMode.INDEXEDCOLOR</td>
  <td>インデックスカラー</td>
</tr>
<tr>
  <td>ChangeMode.LAB</td>
  <td>Labカラー</td>
</tr>
<tr>
  <td>ChangeMode.MULTICHANNEL</td>
  <td>マルチチャンネルカラー</td>
</tr>
<tr>
  <td>ChangeMode.RGB</td>
  <td>RGBカラー</td>
</tr>
</tbody>
</table>
<p>【sample】ドキュメントのカラーモードを変更する</p>
<pre><code>// グレースケールモードにする
app.activeDocument.changeMode(ChangeMode.GRAYSCALE);</code></pre>
<p>　スクリプト実行前の画像はRGBカラーモードになっています。</p>
<figure>
<figcaption>【図】スクリプト実行前の画像</figcaption>
<img src="images/00338.jpeg" />
</figure>
<p>　スクリプトを実行すると画像がグレースケールカラーに変換されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると画像がグレースケールカラーに変換される</figcaption>
<img src="images/00102.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-566">
<section>
<h2 id="calibre_link-271"><b>9-15　インデックスカラーモードにする</b></h2>
<p>　インデックスカラーモードにするにはdocumentオブジェクトのchangeMode()メソッドを使います。changeMode()メソッドの最初のパラメーターにChangeMode.INDEXEDCOLORを指定します。2番目のパラメーターにはIndexedConversionOptionsオブジェクトを指定します。IndexedConversionOptionsオブジェクトには「【表】IndexedConversionOptionsのプロパティ」に示すプロパティがあります。</p>
<table>
<caption>【表】IndexedConversionOptionsのプロパティ</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>colors</td>
  <td>パレットで使用するカラー</td>
</tr>
<tr>
  <td>dither</td>
  <td>ディザの種類（【表】ディザの種類を参照）</td>
</tr>
<tr>
  <td>ditherAmount</td>
  <td>ディザの量（1～100）。値が多いとディザ部分が増える。</td>
</tr>
<tr>
  <td>forced</td>
  <td>特定のカラーを含めるかどうか（【表】forcedで指定できる種類を参照）</td>
</tr>
<tr>
  <td>matte</td>
  <td>カラーマット（【表】マットの種類を参照）</td>
</tr>
<tr>
  <td>palette</td>
  <td>パレット（【表】パレットの種類を参照）</td>
</tr>
<tr>
  <td>preserveExactColors</td>
  <td>同一色の保持。trueで保持、falseで保持しないditherでDither.DIFFUSIONが指定されている場合のみ有効。</td>
</tr>
<tr>
  <td>transparency</td>
  <td>透明にするかどうか。trueで透明を反映（※正常に処理されない場合もある）。</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】ディザの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Dither.DIFFUSION</td>
  <td>誤差拡散法</td>
</tr>
<tr>
  <td>Dither.NOISE</td>
  <td>ノイズ</td>
</tr>
<tr>
  <td>Dither.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Dither.PATTERN</td>
  <td>パターン</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】forcedで指定できる種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>ForcedColors.BLACKWHITE</td>
  <td>白黒</td>
</tr>
<tr>
  <td>ForcedColors.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>ForcedColors.PRIMARIES</td>
  <td>RGB色度座標</td>
</tr>
<tr>
  <td>ForcedColors.WEB</td>
  <td>Web</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】マットの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>MatteType.BACKGROUND</td>
  <td>背景色</td>
</tr>
<tr>
  <td>MatteType.BLACK</td>
  <td>黒</td>
</tr>
<tr>
  <td>MatteType.FOREGROUND</td>
  <td>描画色（前景色）</td>
</tr>
<tr>
  <td>MatteType.NETSCAPENONE</td>
  <td>Netscapeグレー</td>
</tr>
<tr>
  <td>MatteType.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>MatteType.SEMIGRAY</td>
  <td>50%グレー</td>
</tr>
<tr>
  <td>MatteType.WHITE</td>
  <td>白</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】パレットの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Palette.EXACT</td>
  <td>使用中の色を全て割り付ける</td>
</tr>
<tr>
  <td>Palette.LOCALADAPTIVE</td>
  <td>ローカル（割り付け）</td>
</tr>
<tr>
  <td>Palette.LOCALPERCEPTUAL</td>
  <td>ローカル（知覚的）</td>
</tr>
<tr>
  <td>Palette.LOCALSELECTIVE</td>
  <td>ローカル（特定）</td>
</tr>
<tr>
  <td>Palette.MACOSPALETTE</td>
  <td>システム（Macintosh）</td>
</tr>
<tr>
  <td>Palette.MASTERADAPTIVE</td>
  <td>マスター（割り付け）</td>
</tr>
<tr>
  <td>Palette.MASTERPERCEPTUAL</td>
  <td>マスター（知覚的）</td>
</tr>
<tr>
  <td>Palette.MASTERSELECTIVE</td>
  <td>マスター（特定）</td>
</tr>
<tr>
  <td>Palette.PREVIOUSPALETTE</td>
  <td>前回と同じパレットを使う</td>
</tr>
<tr>
  <td>Palette.UNIFORM</td>
  <td>RGBカラーを均等に割り付ける</td>
</tr>
<tr>
  <td>Palette.WEBPALETTE</td>
  <td>Web</td>
</tr>
<tr>
  <td>Palette.WINDOWSPALETTE</td>
  <td>システム（Windows）</td>
</tr>
</tbody>
</table>
<p>【sample】インデックスカラーモードにする</p>
<pre><code>// インデックスカラーモードにする
var opt = new IndexedConversionOptions();
opt.palette = Palette.UNIFORM;    // 指定した数のカラー
opt.colors = 8;  // 8色
opt.dither = Dither.PATTERN;    // パターンディザ
app.activeDocument.changeMode(ChangeMode.INDEXEDCOLOR, opt);</code></pre>
<p>　スクリプト実行前の画像はRGBカラーモードになっています。</p>
<figure>
<figcaption>【図】スクリプト実行前の画像</figcaption>
<img src="images/00029.jpeg" />
</figure>
<p>　スクリプトを実行すると画像がインデックスカラーモードに変換されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると画像がインデックスカラーモードに変換される</figcaption>
<img src="images/00294.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-668">
<section>
<h2 id="calibre_link-272"><b>9-16　白黒画像に変換する</b></h2>
<p>　画像を白黒にするにはdocumentオブジェクトのchangeMode()メソッドを使います。RGBカラーやCMYKカラー画像を直接白黒画像に変換することはできないため、changeMode()メソッドを使って一度グレースケールカラーに変換します。</p>
<p>　次にchangeMode()メソッドの最初のパラメーターにChangeMode.BITMAPを指定し白黒に変換します。2番目のパラメーターにはBitmapConversionOptionsオブジェクトを指定します。BitmapConversionOptionsオブジェクトには「【表】BitmapConversionOptionsのプロパティ」に示すプロパティがあります。</p>
<table>
<caption>【表】BitmapConversionOptionsのプロパティ</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>angle</td>
  <td>網点の角度。-180～180の値を指定。</td>
</tr>
<tr>
  <td>frequency</td>
  <td>線数。1.0～999.99の値を指定。</td>
</tr>
<tr>
  <td>method</td>
  <td>白黒への変換方法（【表】変換方法を参照）</td>
</tr>
<tr>
  <td>resolution</td>
  <td>解像度。初期値は72になっている。</td>
</tr>
<tr>
  <td>shape</td>
  <td>網点の形状（【表】網点形状を参照）。methodでBitmapConversionType.HALFTONESCREENが指定されている場合に有効。</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】変換方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>BitmapConversionType.CUSTOMPATTERN</td>
  <td>カスタムパターン</td>
</tr>
<tr>
  <td>BitmapConversionType.DIFFUSIONDITHER</td>
  <td>誤差拡散法（ディザ）</td>
</tr>
<tr>
  <td>BitmapConversionType.HALFTHRESHOLD</td>
  <td>50%を基準に2階調に分ける（2値化）</td>
</tr>
<tr>
  <td>BitmapConversionType.HALFTONESCREEN</td>
  <td>ハーフトーンスクリーン</td>
</tr>
<tr>
  <td>BitmapConversionType.PATTERNDITHER</td>
  <td>パターンディザ</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】網点形状</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>BitmapHalfToneType.CROSS</td>
  <td>クロス</td>
</tr>
<tr>
  <td>BitmapHalfToneType.DIAMOND</td>
  <td>菱形</td>
</tr>
<tr>
  <td>BitmapHalfToneType.ELLIPSE</td>
  <td>楕円</td>
</tr>
<tr>
  <td>BitmapHalfToneType.LINE</td>
  <td>ライン</td>
</tr>
<tr>
  <td>BitmapHalfToneType.ROUND</td>
  <td>円</td>
</tr>
<tr>
  <td>BitmapHalfToneType.SQUARE</td>
  <td>四角</td>
</tr>
</tbody>
</table>
<p>
<br />
</p>
<p>【sample】白黒画像に変換する</p>
<pre><code>// 白黒にする
var opt = new BitmapConversionOptions();
opt.angle = 45; // 網点の角度
opt.frequency = 20; // 線数
opt.method = BitmapConversionType.HALFTONESCREEN;   // ハーフトーンスクリーン
opt.resolution = 72;    // 解像度
opt.shape   = BitmapHalfToneType.LINE;  // 線で描画
app.activeDocument.changeMode(ChangeMode.GRAYSCALE);
app.activeDocument.changeMode(ChangeMode.BITMAP, opt);</code></pre>
<p>　スクリプト実行前の画像はRGBカラーモードになっています。</p>
<figure>
<figcaption>【図】スクリプト実行前の画像</figcaption>
<img src="images/00052.jpeg" />
</figure>
<p>　スクリプトを実行すると画像が白黒に変換されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると画像が白黒に変換される</figcaption>
<img src="images/00469.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-406">
<section>
<h2 id="calibre_link-273"><b>9-17　カラープロファイルを変換する</b></h2>
<p>　カラープロファイルを変換するにはdocumentオブジェクトのconvertProfile()メソッドを使います。convertProfile()メソッドのパラメーターは「【表】指定できるパラメーター」に示すものが指定できます。3番目以降のパラメーターは省略することができます。また、convertProfile()メソッド実行する際、displayDialogs = DialogModes.NOが指定されているとエラーで停止します。</p>
<table>
<caption>【表】指定できるパラメーター</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>1番目のパラメーター</td>
  <td>変換するプロファイル名を文字列で指定</td>
</tr>
<tr>
  <td>2番目のパラメーター</td>
  <td>マッチング方法（【表】マッチング方法を参照）</td>
</tr>
<tr>
  <td>3番目のパラメーター</td>
  <td>黒点補正（true：する、false：しない）※省略可能</td>
</tr>
<tr>
  <td>4番目のパラメーター</td>
  <td>ディザ処理（true：する、false：しない）※省略可能</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】マッチング方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Intent.ABSOLUTECOLORIMETRIC</td>
  <td>絶対的な色域を維持</td>
</tr>
<tr>
  <td>Intent.RELATIVECOLORIMETRIC</td>
  <td>相対的な色域を維持</td>
</tr>
<tr>
  <td>Intent.PERCEPTUAL</td>
  <td>知覚的</td>
</tr>
<tr>
  <td>Intent.SATURATION</td>
  <td>彩度</td>
</tr>
</tbody>
</table>
<p>【sample】カラープロファイルを変換する</p>
<pre><code>// カラープロファイルを変換する
app.activeDocument.convertProfile(
    "作業用 CMYK - Japan Color 2001 Coated", // 変換するプロファイル名
    Intent.PERCEPTUAL,  // 知覚的
    true,   // 黒点補正を行う
    false   // ディザ処理はしない
);</code></pre>
<p>　変換前のドキュメントです。カラープロファイルはsRGB IEC61966-2.1になっています。</p>
<figure>
<figcaption>【図】変換前のドキュメント</figcaption>
<img src="images/00097.jpeg" />
</figure>
<p>　スクリプトを実行するとカラープロファイル変換のダイアログが表示されます。OKボタンをクリックします。</p>
<figure>
<figcaption>【図】スクリプトを実行するとカラープロファイル変換のダイアログが表示される</figcaption>
<img src="images/00013.jpeg" />
</figure>
<p>　カラープロファイルが変換されます。</p>
<figure>
<figcaption>【図】カラープロファイルが変換される</figcaption>
<img src="images/00424.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-510">
<section>
<div>
<h1 id="calibre_link-274"><b>第10章　選択</b></h1>
</div>
</section>
</div>
<div id="calibre_link-491">
<section>
<h2 id="calibre_link-275"><b>10-1　選択範囲を解除する</b></h2>
<p>　選択範囲を解除するにはselectionオブジェクトのdeselect()メソッドを使います。</p>
<p>【sample】選択範囲を解除する</p>
<pre><code>// 選択範囲を解除する
app.activeDocument.selection.deselect();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00197.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲が解除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲が解除される</figcaption>
<img src="images/00605.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-3">
<section>
<h2 id="calibre_link-276"><b>10-2　全てを選択する</b></h2>
<p>　全てを選択するにはselectionオブジェクトのselectAll()メソッドを使います。</p>
<p>【sample】全てを選択する</p>
<pre><code>// 全てを選択する
app.activeDocument.selection.selectAll();</code></pre>
<p>　ドキュメントサイズにあわせて全ての範囲が選択されます。</p>
<figure>
<figcaption>【図】ドキュメントサイズにあわせて全ての範囲が選択される</figcaption>
<img src="images/00378.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-458">
<section>
<h2 id="calibre_link-277"><b>10-3　選択範囲を反転させる</b></h2>
<p>　選択範囲を反転させるにはselectionオブジェクトのinvert()メソッドを使います。</p>
<p>【sample】選択範囲を反転させる</p>
<pre><code>// 選択範囲を反転させる
app.activeDocument.selection.invert();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00277.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲が反転します。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲が反転する</figcaption>
<img src="images/00561.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-43">
<section>
<h2 id="calibre_link-278"><b>10-4　座標を指定して選択範囲にする</b></h2>
<p>　座標を指定して選択範囲にするにはselectionオブジェクトのselect()メソッドを使います。最初のパラメーターには選択範囲を示す座標を配列形式で指定します。この座標値は[[X1,Y1], [X2, Y2], [X3, Y3], ..., [Xn, Yn]]のように指定します。四角形なら4箇所の座標値が必要になります。円形で選択する場合は三角関数などで座標値を計算して座標値を配列に入れていきます。</p>
<p>　select()メソッドの2番目以降のパラメーターは省略することができます。2番目のパラメーターは以下の表に示す選択方法を指定します。3番目のパラメーターはぼかし幅になります。4番目のパラメーターはアンチエイリアスを有効にするかどうかのフラグです。trueを指定するとアンチエイリアシング処理され、falseを指定するとアンチエイリアシング処理されません。</p>
<table>
<caption>【表】選択方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>選択方法</span>
  </td>
</tr>
<tr>
  <td>SelectionType.DIMINISH</td>
  <td>現在の選択範囲から一部削除</td>
</tr>
<tr>
  <td>SelectionType.EXTEND</td>
  <td>選択範囲に追加</td>
</tr>
<tr>
  <td>SelectionType.INTERSECT</td>
  <td>現在の選択範囲との共通範囲</td>
</tr>
<tr>
  <td>SelectionType.REPLACE</td>
  <td>新規選択</td>
</tr>
</tbody>
</table>
<p>【sample】座標を指定して選択範囲にする</p>
<pre><code>// 座標を指定して選択範囲にする
var saveUnit = preferences.rulerUnits;
preferences.rulerUnits = Units.PIXELS;  // 単位をピクセルに変更
var region = [
    [20, 10],  // XY座標(1)
    [300, 90],  // XY座標(2)
    [50, 200]  // XY座標(3)
];
app.activeDocument.selection.select(region, SelectionType.REPLACE, 0, true);
preferences.rulerUnits = saveUnit;  // 元の単位に戻す</code></pre>
<p>　指定した座標に従って選択範囲が作成されます。</p>
<figure>
<figcaption>【図】指定した座標に従って選択範囲が作成される</figcaption>
<img src="images/00332.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-665">
<section>
<h2 id="calibre_link-279"><b>10-5　選択範囲をパスに変換する</b></h2>
<p>　選択範囲をパスに変換する（作業用パスを作成する）にはselectionオブジェクトのmakeWorkPath()メソッドを使います。パラメーターにはパスの精度・許容値を指定します。なお、パラメーターは省略することができます。</p>
<p>【sample】選択範囲をパスに変換する</p>
<pre><code>// 選択範囲をパスに変換する
app.activeDocument.selection.makeWorkPath();</code></pre>
<p>　選択範囲があります。</p>
<figure>
<figcaption>【図】選択範囲がある</figcaption>
<img src="images/00095.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲がパスに変換されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲がパスに変換される</figcaption>
<img src="images/00181.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-53">
<section>
<h2 id="calibre_link-280"><b>10-6　選択範囲をαチャンネルに保存する</b></h2>
<p>　選択範囲をαチャンネルに保存するにはselectionオブジェクトのstore()メソッドを使います。最初のパラメーターには保存先のチャンネルオブジェクトを指定します。2番目のパラメーターは以下の表に示す選択方法を指定します。なお、2番目のパラメーターは省略することができます。</p>
<table>
<caption>【表】選択方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>選択方法</span>
  </td>
</tr>
<tr>
  <td>SelectionType.DIMINISH</td>
  <td>現在の選択範囲から一部削除</td>
</tr>
<tr>
  <td>SelectionType.EXTEND</td>
  <td>選択範囲に追加</td>
</tr>
<tr>
  <td>SelectionType.INTERSECT</td>
  <td>現在の選択範囲との共通範囲</td>
</tr>
<tr>
  <td>SelectionType.REPLACE</td>
  <td>新規選択</td>
</tr>
</tbody>
</table>
<p>【sample】選択範囲をαチャンネルに保存する</p>
<pre><code>// 選択範囲をαチャンネルに保存する
var aCh = app.activeDocument.channels.add();    // 新規チャンネル
app.activeDocument.selection.store(aCh);</code></pre>
<p>　選択範囲があります。</p>
<figure>
<figcaption>【図】選択範囲がある</figcaption>
<img src="images/00288.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲がαチャンネルに保存されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲がαチャンネルに保存される</figcaption>
<img src="images/00048.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-507">
<section>
<h2 id="calibre_link-281"><b>10-7　αチャンネルを選択範囲にする</b></h2>
<p>　αチャンネルを選択範囲にするにはselectionオブジェクトのload()メソッドを使います。最初のパラメーターにはαチャンネルオブジェクトを指定します。2番目のパラメーターは以下の表に示す選択方法を指定します。3番目のパラメーターは選択範囲を反転させるかどうかのフラグを指定します。trueを指定すると白い部分が選択され（通常の選択）、falseを指定すると黒い部分が選択されます（選択範囲が反転）。なお、2番目と3番目のパラメーターは省略することができます。</p>
<table>
<caption>【表】選択方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>選択方法</span>
  </td>
</tr>
<tr>
  <td>SelectionType.DIMINISH</td>
  <td>現在の選択範囲から一部削除</td>
</tr>
<tr>
  <td>SelectionType.EXTEND</td>
  <td>選択範囲に追加</td>
</tr>
<tr>
  <td>SelectionType.INTERSECT</td>
  <td>現在の選択範囲との共通範囲</td>
</tr>
<tr>
  <td>SelectionType.REPLACE</td>
  <td>新規選択</td>
</tr>
</tbody>
</table>
<p>【sample】αチャンネルを選択範囲にする</p>
<pre><code>// αチャンネルを選択範囲にする
var aCh = app.activeDocument.channels[3];    // 4番目のチャンネル
app.activeDocument.selection.load(aCh, SelectionType.REPLACE, true);</code></pre>
<p>　チャンネルは4つあり、4番目が選択範囲にするαチャンネルです。</p>
<figure>
<figcaption>【図】チャンネルは4つあり、4番目が選択範囲にするαチャンネル</figcaption>
<img src="images/00464.jpeg" />
</figure>
<p>　スクリプトを実行するとαチャンネルの黒い部分が選択範囲になります。黒い部分が選択されるのはスクリプトで選択範囲を反転して選択するように指定しているためです。</p>
<figure>
<figcaption>【図】スクリプトを実行するとαチャンネルの黒い部分が選択範囲になる</figcaption>
<img src="images/00238.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-612">
<section>
<h2 id="calibre_link-282"><b>10-8　境界線を選択する</b></h2>
<p>　すでに存在する選択範囲の境界線を選択するにはselectionオブジェクトのselectBorder()メソッドを使います。selectBorder()メソッドのパラメーターには境界線の選択幅をUnitValue形式で指定します。何も選択されていない場合はエラーが発生します。もし、エラーを回避したい場合にはtry...catchを使用してください。</p>
<p>【sample】境界線を選択する</p>
<pre><code>// 境界線を選択する
app.activeDocument.selection.selectBorder(UnitValue("10px"));</code></pre>
<p>　選択範囲があります。</p>
<figure>
<figcaption>【図】選択範囲がある</figcaption>
<img src="images/00008.jpeg" />
</figure>
<p>　選択範囲の境界線にそって10px幅の選択範囲が作成されます。</p>
<figure>
<figcaption>【図】選択範囲の境界線にそって10px幅の選択範囲が作成される</figcaption>
<img src="images/00420.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-466">
<section>
<h2 id="calibre_link-283"><b>10-9　近似色を選択する</b></h2>
<p>　近似色を選択するにはselectionオブジェクトのsimilar()メソッドを使います。最初のパラメーターには許容値を指定します。2番目のパラメーターにはアンチエイリアシング処理するかどうかを指定します。trueを指定するとアンチエイリアシング処理され、falseを指定するとアンチエイリアシング処理されません。</p>
<p>【sample】近似色を選択する</p>
<pre><code>// 近似色を選択する
app.activeDocument.selection.similar(0, true);</code></pre>
<p>　中央の水色の狭い範囲が選択されています。</p>
<figure>
<figcaption>【図】中央の水色の狭い範囲が選択されている</figcaption>
<img src="images/00194.jpeg" />
</figure>
<p>　スクリプトを実行すると近似色が選択されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると近似色が選択される</figcaption>
<img src="images/00601.jpeg" />
</figure>
<p>　許容値を大きくすると選択される近似色の範囲がより広く選択されます。以下の図は許容値を60にした場合の結果です。</p>
<figure>
<figcaption>【図】許容値を大きくすると選択される近似色の範囲がより広く選択される</figcaption>
<img src="images/00613.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-454">
<section>
<h2 id="calibre_link-284"><b>10-10　選択範囲のサイズを取得する</b></h2>
<p>　選択範囲のサイズ（矩形範囲）を取得するにはselectionオブジェクトのbounds配列を参照します。boundsは選択範囲が存在する場合、以下の座標位置がUnitValue形式で格納されます。選択範囲が不定形であったり、もしくは複数ある場合は、それらを囲む矩形範囲になります。</p>
<table>
<caption>【表】bounds配列と座標</caption>
<tbody>
<tr>
  <td>
    <span>bounds配列</span>
  </td>
  <td>
    <span>座標</span>
  </td>
</tr>
<tr>
  <td>0</td>
  <td>左側の座標</td>
</tr>
<tr>
  <td>1</td>
  <td>上側の座標</td>
</tr>
<tr>
  <td>2</td>
  <td>右側の座標</td>
</tr>
<tr>
  <td>3</td>
  <td>下側の座標</td>
</tr>
</tbody>
</table>
<p>【sample】選択範囲のサイズを取得する</p>
<pre><code>// 選択範囲のサイズを表示する
var rect = app.activeDocument.selection.bounds;
var left = rect[0]; // 左側
var top = rect[1];  // 上側
var right = rect[2];    // 右側
var bottom = rect[3];   // 下側
alert(left+", "+top+", "+right+", "+bottom);</code></pre>
<p>　単純な四角形の選択範囲の場合は、四角形の左上と右下の座標値がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】単純な四角形の選択範囲の場合</figcaption>
<img src="images/00189.jpeg" />
</figure>
<figure>
<figcaption>【図】四角形の左上と右下の座標値がアラートダイアログに表示される</figcaption>
<img src="images/00156.jpeg" />
</figure>
<p>　選択範囲が不定形であったり、複数ある場合は、それら全体を囲む矩形範囲の左上と右下の座標値がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】不定形や複数の選択範囲の場合</figcaption>
<img src="images/00569.jpeg" />
</figure>
<figure>
<figcaption>【図】全体を囲む矩形の左上と右下の座標値が表示される</figcaption>
<img src="images/00341.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-557">
<section>
<h2 id="calibre_link-285"><b>10-11　選択範囲のサイズを変更する（リサイズ）</b></h2>
<p>　選択範囲のサイズを変更するにはselectionオブジェクトのresizeBoundary()メソッドを使います。resizeBoundary()メソッドの最初のパラメーターに横方向の縮尺、2番目のパラメーターに縦方向の縮尺を指定します。100を指定すると100%、50は50%、200なら200%にサイズが調整されます。3番目のパラメーターはサイズ調整時の基準位置を指定します。基準位置は以下の表に示す位置を指定できます。また、3番目のパラメーターは省略することができます。省略時、サイズ調整時の基準位置は中央（AnchorPosition.MIDDLECENTER）になります。</p>
<table>
<caption>【表】基準位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>基準位置</span>
  </td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMCENTER</td>
  <td>中央下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMLEFT</td>
  <td>左下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMRIGHT</td>
  <td>右下</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLECENTER</td>
  <td>中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLELEFT</td>
  <td>左中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLERIGHT</td>
  <td>右中央</td>
</tr>
<tr>
  <td>AnchorPosition.TOPCENTER</td>
  <td>中央上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPLEFT</td>
  <td>左上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPRIGHT</td>
  <td>右上</td>
</tr>
</tbody>
</table>
<p>【sample】選択範囲のサイズを変更する（リサイズ）</p>
<pre><code>// 選択範囲のサイズを変更する
app.activeDocument.selection.resizeBoundary(50, 120, AnchorPosition.MIDDLECENTER);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00104.jpeg" />
</figure>
<p>　選択範囲が横に50%、縦に120%サイズに調整されます。</p>
<figure>
<figcaption>【図】選択範囲が横に50%、縦に120%サイズに調整される</figcaption>
<img src="images/00522.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-660">
<section>
<h2 id="calibre_link-286"><b>10-12　選択範囲を変更（拡張）する</b></h2>
<p>　選択範囲を変更（拡張）するにはselectionオブジェクトのexpand()メソッドを使います。expand()メソッドのパラメーターにはUnitValue形式で拡張したいサイズを指定します。expand()メソッドはPhotoshopのメニューの「選択範囲＞選択範囲の変更＞拡張...」と同じです。</p>
<p>【sample】選択範囲を変更（拡張）する</p>
<pre><code>// 選択範囲を拡張する
app.activeDocument.selection.expand(UnitValue("30px"));</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00296.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲が全体に30px広がります。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲が全体に30px広がる</figcaption>
<img src="images/00055.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-50">
<section>
<h2 id="calibre_link-287"><b>10-13　選択範囲を変更（縮小）する</b></h2>
<p>　選択範囲を変更（縮小）するにはselectionオブジェクトのcontract()メソッドを使います。contract()メソッドのパラメーターにはUnitValue形式で縮小したいサイズを指定します。メソッドはPhotoshopのメニューの「選択範囲＞選択範囲の変更＞縮小...」と同じです。</p>
<p>【sample】選択範囲を変更（縮小）する</p>
<pre><code>// 選択範囲を縮小する
app.activeDocument.selection.contract(UnitValue("30px"));</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00631.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲が全体に30px狭くなります。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲が全体に30px狭くなる</figcaption>
<img src="images/00247.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-567">
<section>
<h2 id="calibre_link-288"><b>10-14　選択範囲を移動させる</b></h2>
<p>　選択範囲そのものを移動させるにはselectionオブジェクトのtranslateBoundary()メソッドを使います。translateBoundary()メソッドの最初のパラメーターに横方向の移動量を、2番目のパラメーターに縦方向の移動量を指定します。移動量はUnitValue形式で指定します。正数を指定した場合、右下に移動し負数を指定した場合は左上に移動します。</p>
<p>【sample】選択範囲を移動させる</p>
<pre><code>// 選択範囲を移動させる
var dx = UnitValue("-10px");
var dy = UnitValue("30px");
app.activeDocument.selection.translateBoundary(dx, dy);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00016.jpeg" />
</figure>
<p>　選択範囲そのものが移動します。</p>
<figure>
<figcaption>【図】選択範囲そのものが移動する</figcaption>
<img src="images/00426.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-443">
<section>
<h2 id="calibre_link-289"><b>10-15　選択範囲を拡張する</b></h2>
<p>　選択範囲を拡張するにはselectionオブジェクトのgrow()メソッドを使います。最初のパラメーターには許容値を指定します。2番目のパラメーターにはアンチエイリアシング処理するかどうかを指定します。trueを指定するとアンチエイリアシング処理され、falseを指定するとアンチエイリアシング処理されません。なお、このメソッドはPhotoshopのメニューの「選択範囲＞選択範囲を拡張」と同じ動作になります。</p>
<p>【sample】選択範囲を拡張する</p>
<pre><code>// 選択範囲を拡張する
app.activeDocument.selection.grow(0, true);</code></pre>
<p>　黄色い部分の一部が選択されています。</p>
<figure>
<figcaption>【図】黄色い部分の一部が選択されている</figcaption>
<img src="images/00199.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲が拡張されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲が拡張される</figcaption>
<img src="images/00607.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-599">
<section>
<h2 id="calibre_link-290"><b>10-16　選択範囲を滑らかにする</b></h2>
<p>　選択範囲を滑らかにするにはselectionオブジェクトのsmooth()メソッドを使います。パラメーターには滑らかにする半径を指定します。smooth()メソッドはPhotoshopのメニューの「選択範囲＞選択範囲の変更＞滑らかに...」と同じです。</p>
<p>【sample】選択範囲を滑らかにする</p>
<pre><code>// 選択範囲を滑らかにする
app.activeDocument.selection.smooth(20);</code></pre>
<p>　範囲が選択されています。選択範囲の角はとがった状態になっています。</p>
<figure>
<figcaption>【図】範囲が選択されており角はとがった状態になっている</figcaption>
<img src="images/00381.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲の角が滑らかになります。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲の角が滑らかになる</figcaption>
<img src="images/00150.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-37">
<section>
<h2 id="calibre_link-291"><b>10-17　選択範囲のぼかし幅を指定する</b></h2>
<p>　選択範囲のぼかし幅を指定するにはselectionオブジェクトのfeather()メソッドを使います。feather()メソッドのパラメーターにはUnitValue形式でぼかしたいサイズを指定します。</p>
<p>【sample】選択範囲のぼかし幅を指定する</p>
<pre><code>// 選択範囲のぼかし幅を指定する
app.activeDocument.selection.feather(UnitValue("20px"));</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00564.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲のぼかし幅が20pxに設定されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲のぼかし幅が20pxに設定される</figcaption>
<img src="images/00334.jpeg" />
</figure>
<p>　この段階で消去すると図のようにぼかした状態で切り抜かれます。</p>
<figure>
<figcaption>【図】この段階で消去すると、ぼかした状態で切り抜かれる</figcaption>
<img src="images/00058.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-546">
<section>
<h2 id="calibre_link-292"><b>10-18　選択範囲の境界線を描画する</b></h2>
<p>　選択範囲の境界線を描画するにはselectionオブジェクトのstroke()メソッドを使います。stroke()メソッドの最初のパラメーターに描画する線の色を指定します。色はSolidColorオブジェクトを使って指定します。また、前景色を示すapp.foregroundColor、背景色を示すapp.backgroundColorを指定することで前景色や背景色で線を描画することができます。</p>
<p>　stroke()メソッドの2番目のパラメーターには描画する線の幅を指定します。3番目以降のパラメーターは省略することができます。3番目のパラメーターには以下の表に示す線の描画位置を指定します。4番目のパラメーターには合成モードを指定します。5番目のパラメーターは不透明度で0～100の範囲で指定します。6番目のパラメーターには透明部分を保護するかどうかのフラグを指定します。trueなら保護する、falseなら保護しないことになります。</p>
<table>
<caption>【表】線の描画位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>線の描画位置</span>
  </td>
</tr>
<tr>
  <td>StrokeLocation.CENTER</td>
  <td>中央</td>
</tr>
<tr>
  <td>StrokeLocation.INSIDE</td>
  <td>内側</td>
</tr>
<tr>
  <td>StrokeLocation.OUTSIDE</td>
  <td>外側</td>
</tr>
</tbody>
</table>
<p>【sample】選択範囲の境界線を描画する</p>
<pre><code>// 選択範囲の境界線を描画する
var color = new SolidColor();   // 赤色を設定する
color.rgb.red = 255;
color.rgb.green = 0;
color.rgb.blue = 0;
app.activeDocument.selection.stroke(color, 3, StrokeLocation.INSIDE);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00516.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲の境界の内側にそって赤色の線が描画されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲の境界の内側にそって赤色の線が描画される</figcaption>
<img src="images/00290.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-698">
<section>
<h2 id="calibre_link-293"><b>10-19　選択範囲を塗り潰す</b></h2>
<p>　選択範囲を塗り潰すにはselectionオブジェクトのfill()メソッドを使います。fill()メソッドの最初のパラメーターに塗り潰したい色を指定します。色はSolidColorオブジェクトを使って指定します。また、前景色を示すapp.foregroundColor、背景色を示すapp.backgroundColorを指定することで前景色や背景色で塗り潰すことができます。</p>
<p>　fill()メソッドの2番目以降のパラメーターは省略することができます。2番目のパラメーターには以下の表に示す合成モードを指定します。3番目のパラメーターは不透明度で0～100の範囲で指定します。4番目のパラメーターには透明部分を保護するかどうかのフラグを指定します。trueなら保護する、falseなら保護しないことになります。</p>
<table>
<caption>【表】合成モードの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>合成モードの種類</span>
  </td>
</tr>
<tr>
  <td>BlendMode.COLORBLEND</td>
  <td>カラー</td>
</tr>
<tr>
  <td>BlendMode.COLORBURN</td>
  <td>焼き込みカラー</td>
</tr>
<tr>
  <td>BlendMode.COLORDODGE</td>
  <td>覆焼きカラー</td>
</tr>
<tr>
  <td>BlendMode.DARKEN</td>
  <td>比較（暗）</td>
</tr>
<tr>
  <td>BlendMode.DIFFERENCE</td>
  <td>差の絶対値</td>
</tr>
<tr>
  <td>BlendMode.DISSOLVE</td>
  <td>ディザ合成</td>
</tr>
<tr>
  <td>BlendMode.DIVIDE</td>
  <td>除算</td>
</tr>
<tr>
  <td>BlendMode.EXCLUSION</td>
  <td>除外</td>
</tr>
<tr>
  <td>BlendMode.HARDLIGHT</td>
  <td>ハードライト</td>
</tr>
<tr>
  <td>BlendMode.HARDMIX</td>
  <td>ハードミックス</td>
</tr>
<tr>
  <td>BlendMode.HUE</td>
  <td>色相</td>
</tr>
<tr>
  <td>BlendMode.LIGHTEN</td>
  <td>比較（明）</td>
</tr>
<tr>
  <td>BlendMode.LINEARBURN</td>
  <td>焼き込み（リニア）</td>
</tr>
<tr>
  <td>BlendMode.LINEARDODGE</td>
  <td>覆焼き（リニア）-加算</td>
</tr>
<tr>
  <td>BlendMode.LINEARLIGHT</td>
  <td>リニアライト</td>
</tr>
<tr>
  <td>BlendMode.LUMINOSITY</td>
  <td>輝度</td>
</tr>
<tr>
  <td>BlendMode.MULTIPLY</td>
  <td>乗算</td>
</tr>
<tr>
  <td>BlendMode.NORMAL</td>
  <td>通常</td>
</tr>
<tr>
  <td>BlendMode.OVERLAY</td>
  <td>オーバーレイ</td>
</tr>
<tr>
  <td>BlendMode.PASSTHROUGH</td>
  <td>通過</td>
</tr>
<tr>
  <td>BlendMode.PINLIGHT</td>
  <td>ピンライト</td>
</tr>
<tr>
  <td>BlendMode.SATURATION</td>
  <td>彩度</td>
</tr>
<tr>
  <td>BlendMode.SCREEN</td>
  <td>スクリーン</td>
</tr>
<tr>
  <td>BlendMode.SOFTLIGHT</td>
  <td>ソフトライト</td>
</tr>
<tr>
  <td>BlendMode.SUBTRACT</td>
  <td>減算</td>
</tr>
<tr>
  <td>BlendMode.VIVIDLIGHT</td>
  <td>ビビッドライト</td>
</tr>
</tbody>
</table>
<p>【sample】選択範囲を塗り潰す</p>
<pre><code>// 選択範囲を塗り潰す
var color = new SolidColor();   // 赤色を設定する
color.rgb.red = 255;
color.rgb.green = 0;
color.rgb.blue = 0;
app.activeDocument.selection.fill(color);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00049.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲が赤色で塗り潰されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲が赤色で塗り潰される</figcaption>
<img src="images/00465.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-487">
<section>
<h2 id="calibre_link-294"><b>10-20　選択範囲を消去する</b></h2>
<p>　選択範囲を消去するにはselectionオブジェクトのclear()メソッドを使います。clear()メソッドにはパラメーターはありません。</p>
<p>【sample】択範囲を消去する</p>
<pre><code>// 選択範囲内を消去する
app.activeDocument.selection.clear();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00240.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲が消去されます。このサンプルの場合、背景が選択されているため消去すると消去した部分は背景色で塗り潰されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲が消去される</figcaption>
<img src="images/00009.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-641">
<section>
<h2 id="calibre_link-295"><b>10-21　選択範囲をカットする</b></h2>
<p>　選択範囲をカットするにはselectionオブジェクトのcut()メソッドを使います。cut()メソッドにはパラメーターはありません。カットした画像データはクリップボードに入ります。カットした画像を貼り付けたい（ペーストしたい）場合はpaste()メソッドを使います。</p>
<p>【sample】選択範囲をカットする</p>
<pre><code>// 選択範囲をカットする
app.activeDocument.selection.cut();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00375.jpeg" />
</figure>
<p>　スクリプトを実行すると選択範囲がカットされます。このサンプルの場合、背景が選択されているためカットするとカットした部分は背景色で塗り潰されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると選択範囲がカットされる</figcaption>
<img src="images/00510.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-428">
<section>
<h2 id="calibre_link-296"><b>10-22　選択範囲をコピーする</b></h2>
<p>　選択範囲をコピーするにはselectionオブジェクトのcopy()メソッドを使います。copy()メソッドのパラメーターに何も指定しない場合は選択範囲のレイヤーの画像だけがコピーされます。copy()メソッドにtrueを指定すると選択範囲内にある表示されている全てのレイヤーの画像データがコピーされます。</p>
<p>【sample】選択範囲をコピーする</p>
<pre><code>// 選択範囲をコピーする
var docObj1 = app.activeDocument;
docObj1.selection.copy();    // 通常のコピー
// 新規ドキュメントを作成しペーストする
var docObj2 = app.documents.add();
docObj2.paste();
app.activeDocument = docObj1;    // アクティブドキュメントとして設定
docObj1.selection.copy(true);    // 結合部分をコピー
// 新規ドキュメントを作成しペーストする
var docObj3 = app.documents.add();
docObj3.paste();</code></pre>
<p>　スクリプトを実行する前の状態です。画像データは複数のレイヤーに分かれています。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00603.jpeg" />
</figure>
<p>　スクリプトを実行すると2つの新規ドキュメントが作成されます。最初に作成された新規ドキュメントにはレイヤーの画像データだけがペーストされます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると2つの新規ドキュメントが作成される</figcaption>
<img src="images/00376.jpeg" />
</figure>
<p>　2つ目のドキュメントには選択範囲内に含まれる全てのレイヤーの画像データがペーストされます。</p>
<figure>
<figcaption>【図】選択範囲内に含まれる全てのレイヤーの画像データがペーストされる</figcaption>
<img src="images/00145.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-586">
<section>
<h2 id="calibre_link-297"><b>10-23　選択範囲内の画像を移動させる</b></h2>
<p>　選択範囲内の画像を移動させるにはselectionオブジェクトのtranslate()メソッドを使います。translate()メソッドの最初のパラメーターに横方向の移動量を、2番目のパラメーターに縦方向の移動量を指定します。移動量はUnitValue形式で指定します。正数を指定した場合、右下に移動し負数を指定した場合は左上に移動します。なお、選択範囲内に画像が含まれていない場合はエラーになります。</p>
<p>【sample】選択範囲内の画像を移動させる</p>
<pre><code>// 選択範囲内の画像を移動させる
var dx = UnitValue("-10px");
var dy = UnitValue("30px");
app.activeDocument.selection.translate(dx, dy);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00558.jpeg" />
</figure>
<p>　選択範囲内の画像が移動します。</p>
<figure>
<figcaption>【図】選択範囲内の画像が移動する</figcaption>
<img src="images/00330.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-21">
<section>
<h2 id="calibre_link-298"><b>10-24　選択範囲内の画像のスケールを変更する（リサイズ）</b></h2>
<p>　選択範囲内の画像のスケールを変更するにはselectionオブジェクトのresize()メソッドを使います。resize()メソッドの最初のパラメーターに横方向のスケール、2番目のパラメーターに縦方向のスケールを指定します。100を指定すると100%、50は50%、200なら200%にサイズが調整されます。3番目のパラメーターはサイズ調整時の基準位置を指定します。基準位置は以下の表に示す位置を指定できます。また、3番目のパラメーターは省略することができます。省略時、サイズ調整時の基準位置は中央（AnchorPosition.MIDDLECENTER）になります。</p>
<table>
<caption>【表】基準位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>基準位置</span>
  </td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMCENTER</td>
  <td>中央下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMLEFT</td>
  <td>左下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMRIGHT</td>
  <td>右下</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLECENTER</td>
  <td>中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLELEFT</td>
  <td>左中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLERIGHT</td>
  <td>右中央</td>
</tr>
<tr>
  <td>AnchorPosition.TOPCENTER</td>
  <td>中央上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPLEFT</td>
  <td>左上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPRIGHT</td>
  <td>右上</td>
</tr>
</tbody>
</table>
<p>【sample】選択範囲内の画像のスケールを変更する（リサイズ）</p>
<pre><code>// 選択範囲内の画像のサイズを変更する
app.activeDocument.selection.resize(50, 120, AnchorPosition.MIDDLECENTER);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00093.jpeg" />
</figure>
<p>　選択範囲内の画像が横に50%、縦に120%サイズに調整されます。</p>
<figure>
<figcaption>【図】選択範囲内の画像が横に50%、縦に120%サイズに調整される</figcaption>
<img src="images/00511.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-669">
<section>
<h2 id="calibre_link-299"><b>10-25　選択範囲内の画像を回転させる</b></h2>
<p>　選択範囲内の画像を回転させるにはselectionオブジェクトのrotate()メソッドを使います。rotate()メソッドの最初のパラメーターに回転角度を指定します。正数であれば時計回りに回転し、負数であれば反時計回りに回転します。2番目のパラメーターは回転の基準位置を指定します。基準位置は以下の表に示す位置を指定できます。また、2番目のパラメーターは省略することができます。省略時、回転の基準位置は中央（AnchorPosition.MIDDLECENTER）になります。</p>
<table>
<caption>【表】回転の基準位置</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>回転の基準位置</span>
  </td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMCENTER</td>
  <td>中央下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMLEFT</td>
  <td>左下</td>
</tr>
<tr>
  <td>AnchorPosition.BOTTOMRIGHT</td>
  <td>右下</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLECENTER</td>
  <td>中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLELEFT</td>
  <td>左中央</td>
</tr>
<tr>
  <td>AnchorPosition.MIDDLERIGHT</td>
  <td>右中央</td>
</tr>
<tr>
  <td>AnchorPosition.TOPCENTER</td>
  <td>中央上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPLEFT</td>
  <td>左上</td>
</tr>
<tr>
  <td>AnchorPosition.TOPRIGHT</td>
  <td>右上</td>
</tr>
</tbody>
</table>
<p>【sample】選択範囲内の画像を回転させる</p>
<pre><code>// 選択範囲内の画像を回転させる
app.activeDocument.selection.rotate(20, AnchorPosition.MIDDLECENTER);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00282.jpeg" />
</figure>
<p>　選択範囲内の画像が時計回りに20度回転します。</p>
<figure>
<figcaption>【図】選択範囲内の画像が時計回りに20度回転する</figcaption>
<img src="images/00335.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-682">
<section>
<h2 id="calibre_link-300"><b>10-26　選択範囲があるかどうか調べる</b></h2>
<p>　選択範囲があるかどうか調べるにはselectionオブジェクトのbounds配列を参照します。選択範囲がある場合は、選択範囲サイズがbounds配列に格納されます。しかし、選択範囲がない場合はbounds配列が存在しないためエラーになります。これを利用してbounds配列を参照する時にエラーがなければ選択範囲がある、エラーなら選択範囲がないという判断を行います。これはtry...catchを使ってエラーをキャッチし選択範囲の有無を判断します。</p>
<p>【sample】選択範囲があるかどうか調べる</p>
<pre><code>// 選択範囲があるかどうか調べる
try{
    app.activeDocument.selection.bounds;
    alert("選択範囲があります");
}catch(e){
    alert("選択範囲はありません");
}</code></pre>
<p>　選択範囲がある場合にはアラートダイアログに選択範囲があります、と表示されます。</p>
<figure>
<figcaption>【図】選択範囲がある場合、選択範囲があります、と表示される</figcaption>
<img src="images/00098.jpeg" />
</figure>
<p>　選択範囲がない場合はアラートダイアログに選択範囲はありません、と表示されます。</p>
<figure>
<figcaption>【図】選択範囲がない場合、選択範囲はありません、と表示される</figcaption>
<img src="images/00517.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-470">
<section>
<h2 id="calibre_link-301"><b>10-27　選択範囲が矩形かどうか調べる</b></h2>
<p>　選択範囲があるかどうか調べるにはselectionオブジェクトのsolidプロパティを参照します。solidプロパティの値がtrueなら選択範囲は単純な矩形／四角形です。falseの場合は複数の選択範囲があるか不定形の選択範囲になります。</p>
<p>【sample】選択範囲が矩形かどうか調べる</p>
<pre><code>// 選択範囲が矩形かどうか調べる
var flag = app.activeDocument.selection.solid;
if (flag === true) {
    alert("選択範囲は矩形です");
}else{
    alert("選択範囲は矩形ではありません");
}</code></pre>
<p>　選択範囲が四角形の場合にはアラートダイアログに選択範囲は矩形です、と表示されます。</p>
<figure>
<figcaption>【図】選択範囲が四角形の場合、選択範囲は矩形です、と表示される</figcaption>
<img src="images/00291.jpeg" />
</figure>
<p>　選択範囲が四角形でない場合にはアラートダイアログに選択範囲は矩形ではありません、と表示されます。</p>
<figure>
<figcaption>【図】選択範囲が四角形でない場合、選択範囲は矩形ではありません、と表示される</figcaption>
<img src="images/00050.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-628">
<section>
<div>
<h1 id="calibre_link-302"><b>第11章　パス</b></h1>
</div>
</section>
</div>
<div id="calibre_link-471">
<section>
<h2 id="calibre_link-303"><b>11-1　パスの総数を求める</b></h2>
<p>　パスの総数を求めるにはpathItems配列のlengthプロパティを参照します。</p>
<p>【sample】パスの総数を求める</p>
<pre><code>// パスの総数を求める
var n = app.activeDocument.pathItems.length;
alert(n);</code></pre>
<p>　ドキュメントにはパスが3つあります。スクリプトを実行するとアラートダイアログにはパスの総数である3が表示されます。</p>
<figure>
<figcaption>【図】パスが3つあり、スクリプトを実行するとパスの総数「3」が表示される</figcaption>
<img src="images/00466.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-606">
<section>
<h2 id="calibre_link-304"><b>11-2　新規にパスを作成する</b></h2>
<p>　新規にパスを作成するには以下の手順になります。</p>
<p>（1）PathPointInfoオブジェクトを生成し1つのパスポイント座標を生成する</p>
<p>（2）必要な数だけ(1)の方法で座標を生成し配列に格納する</p>
<p>（3）SubPathInfoオブジェクトを生成し、新たな配列に格納する</p>
<p>（4）SubPathInfoオブジェクトのentireSubPathプロパティに（1）、（2）で生成した座標値を格納した配列を指定する</p>
<p>（5）pathItemsオブジェクトのadd()メソッドを使ってパスを作成する</p>
<p>
<br />
</p>
<p>（1）から順番に説明します。まず、PathPointInfoオブジェクトを生成したらkindプロパティにパスポイントの種類を指定します。パスポイントの種類は以下の表の値を指定できます。</p>
<table>
<caption>【表】パスポイントの種類</caption>
<tbody>
<tr>
  <td>
    <span>プロパティの指定</span>
  </td>
  <td>
    <span>パスポイントの種類</span>
  </td>
</tr>
<tr>
  <td>PointKind.CORNERPOINT</td>
  <td>コーナー</td>
</tr>
<tr>
  <td>PointKind.SMOOTHPOINT</td>
  <td>スムースコーナー</td>
</tr>
</tbody>
</table>
<p>　パスのアンカー座標をanchorに配列形式で[X座標, Y座標]の順に指定します。同様にベジエ曲線の左ハンドル座標をleftDirectionに、右ハンドル座標をrightDirectionに指定します。指定する座標形式はanchorと同様の配列形式、座標順になります。これをパス座標の数だけ用意し、配列に入れます。これが（2）の部分になります。</p>
<p>　次に（3）の手順であるSubPathInfoオブジェクトを生成します。生成したSubPathInfoオブジェクトのoperationプロパティに作成したパスを同処理するかを指定します。これはパスを追加するか、削除するかを指定します。以下の表に示す値を指定できます。</p>
<table>
<caption>【表】パスの処理方法</caption>
<tbody>
<tr>
  <td>
    <span>プロパティの指定</span>
  </td>
  <td>
    <span>パスの処理方法</span>
  </td>
</tr>
<tr>
  <td>ShapeOperation.SHAPEADD</td>
  <td>追加</td>
</tr>
<tr>
  <td>ShapeOperation.SHAPEINTERSECT</td>
  <td>共通範囲</td>
</tr>
<tr>
  <td>ShapeOperation.SHAPESUBTRACT</td>
  <td>一部削除</td>
</tr>
<tr>
  <td>ShapeOperation.SHAPEXOR</td>
  <td>除外</td>
</tr>
</tbody>
</table>
<p>　次にclosedプロパティにパスが閉じているか、開いているかをclosedプロパティに指定します。trueなら閉じたパス、falseなら開いたパスになります。</p>
<p>entireSubPathプロパティに（1）、（2）で生成したパス座標を格納した配列を指定します。これが（4）の手順になります。</p>
<p>　最後に（5）の手順になります。pathItemsオブジェクトのadd()メソッドを使ってパスを作成します。add()メソッドの最初のパラメーターには作成するパスの名前を指定します。2番目のパラメーターに（4）で生成した配列を指定します。これで、ドキュメント上にパスが作成されます。</p>
<p>【sample】新規にパスを作成する</p>
<pre><code>// 新規にパスを作成する
var p = [ ];    // 座標を格納する配列
var myPath = [ ];   // パスデータを格納する配列
p.push(pathXY(50, 60), pathXY(200, 100), pathXY(300, 200), pathXY(120, 180));
myPath[0] = new SubPathInfo(); // サブパスを生成
myPath[0].operation = ShapeOperation.SHAPEADD;  // 現在のパスに追加
myPath[0].closed = true;    // クローズパス
myPath[0].entireSubPath = p; // パス座標データ
app.activeDocument.pathItems.add("西湖パス", myPath);
// 直線のパスポイント座標を設定する関数
function pathXY(x, y){
    var pObj = new PathPointInfo(); // パス情報オブジェクトを作成
    pObj.kind = PointKind.CORNERPOINT;
    pObj.anchor = [x, y];   // アンカー座標
    pObj.leftDirection = [x, y];    // 左ハンドル部分のパス座標
    pObj.rightDirection = [x, y];   // 右ハンドル部分のパス座標
   return pObj;
}</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00241.jpeg" />
</figure>
<p>　スクリプトを実行すると4つの座標を結ぶパスが生成されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると4つの座標を結ぶパスが生成される</figcaption>
<img src="images/00010.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-561">
<section>
<h2 id="calibre_link-305"><b>11-3　指定したパスを複製する</b></h2>
<p>　指定したパスを複製するにはpathItemオブジェクトのduplicate()メソッドを使います。duplicate()メソッドのパラメーターには複製後のパスの名前を指定します。pathItemオブジェクトはpathItems配列の要素として格納されています。パスはpathItems[0]やpathItems["パス 2"]のように指定することができます。なお、作業用パスを複製しようとするとエラーになります。</p>
<p>【sample】指定したパスを複製する</p>
<pre><code>// 指定したパスを複製する
app.activeDocument.pathItems["パス 1"].duplicate("Octパス");</code></pre>
<p>　スクリプトを実行する前のパスの状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前のパスの状態</figcaption>
<img src="images/00422.jpeg" />
</figure>
<p>　スクリプトを実行すると"パス 1"が複製され、新たに"Octパス"が作成されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると"パス 1"が複製され、新たに"Octパス"が作成される</figcaption>
<img src="images/00196.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-650">
<section>
<h2 id="calibre_link-306"><b>11-4　指定したパスをクリッピングパスにする</b></h2>
<p>　指定したパスをクリッピングパスにするにはpathItemオブジェクトのmakeClippingPath()メソッドを使います。makeClippingPath()メソッドにはパラメーターには平滑度を指定します。平滑度はパス（曲線）の滑らかさを示すもので0.2から100までの数値を指定します。値が小さいほど滑らかな曲線になります。また、平滑度の値は省略することができます。</p>
<p>【sample】指定したパスをクリッピングパスにする</p>
<pre><code>// 指定したパスをクリッピングパスにする
app.activeDocument.pathItems["パス 2"].makeClippingPath(2);</code></pre>
<p>　スクリプトを実行する前のパスの状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前のパスの状態</figcaption>
<img src="images/00604.jpeg" />
</figure>
<p>　スクリプトを実行すると"パス 2"がクリッピングパスになります。</p>
<figure>
<figcaption>【図】スクリプトを実行すると"パス 2"がクリッピングパスになる</figcaption>
<img src="images/00377.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-436">
<section>
<h2 id="calibre_link-307"><b>11-5　指定したパスを削除する</b></h2>
<p>　指定したパスを削除するにはpathItemオブジェクトのremove()メソッドを使います。pathItemオブジェクトはpathItems配列の要素として格納されています。パスはpathItems[0]やpathItems["パス 2"]のように指定することができます。</p>
<p>【sample】指定したパスを削除する</p>
<pre><code>// 指定したパスを削除する
app.activeDocument.pathItems[0].remove();
app.activeDocument.pathItems["作業用パス"].remove();</code></pre>
<p>　ドキュメントにはパスが複数あります。</p>
<figure>
<figcaption>【図】ドキュメントにはパスが複数ある</figcaption>
<img src="images/00146.jpeg" />
</figure>
<p>　スクリプトを実行すると先頭にある"パス 1"と"作業用パス"が削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると先頭にある"パス 1"と"作業用パス"が削除される</figcaption>
<img src="images/00559.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-625">
<section>
<h2 id="calibre_link-308"><b>11-6　パスを全て削除する</b></h2>
<p>　パスを全て削除するにはpathItems配列のremoveAll()メソッドを使います。removeAll()メソッドはパスがない場合に実行してもエラーにはなりません。</p>
<p>【sample】パスを全て削除する</p>
<pre><code>// パスを全て削除する
app.activeDocument.pathItems.removeAll();</code></pre>
<p>　ドキュメントにはパスが3つあります。</p>
<figure>
<figcaption>【図】ドキュメントにはパスが3つある</figcaption>
<img src="images/00331.jpeg" />
</figure>
<p>　スクリプトを実行するとパスが全て削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとパスが全て削除される</figcaption>
<img src="images/00094.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-27">
<section>
<h2 id="calibre_link-309"><b>11-7　指定したパスを選択する</b></h2>
<p>　指定したパスを選択するにはpathItemオブジェクトのselect()メソッドを使います。pathItemオブジェクトはpathItems配列の要素として格納されています。パスはpathItems[0]やpathItems["パス 2"]のように指定することができます。</p>
<p>【sample】指定したパスを選択する</p>
<pre><code>// 指定したパスを選択する
app.activeDocument.pathItems["作業用パス"].select();</code></pre>
<p>　ドキュメントにはパスが複数あります。</p>
<figure>
<figcaption>【図】ドキュメントにはパスが複数ある</figcaption>
<img src="images/00512.jpeg" />
</figure>
<p>　スクリプトを実行すると"作業用パス"が選択されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると"作業用パス"が選択される</figcaption>
<img src="images/00283.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-541">
<section>
<h2 id="calibre_link-310"><b>11-8　指定したパスの選択を解除する</b></h2>
<p>　指定したパスの選択を解除するにはpathItemオブジェクトのdeselect()メソッドを使います。pathItemオブジェクトはpathItems配列の要素として格納されています。パスはpathItems[0]やpathItems["パス 2"]のように指定することができます。</p>
<p>【sample】指定したパスの選択を解除する</p>
<pre><code>// 指定したパスの選択を解除する
app.activeDocument.pathItems["パス 1"].deselect();</code></pre>
<p>　"パス 1"が選択されています。</p>
<figure>
<figcaption>【図】"パス 1"が選択されている</figcaption>
<img src="images/00046.jpeg" />
</figure>
<p>　スクリプトを実行すると"パス 1"の選択が解除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると"パス 1"の選択が解除される</figcaption>
<img src="images/00462.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-692">
<section>
<h2 id="calibre_link-311"><b>11-9　指定したパスを選択範囲にする</b></h2>
<p>　指定したパスを選択範囲にするにはpathItemオブジェクトのmakeSelection()メソッドを使います。makeSelection()メソッドにはパラメーターはありません。</p>
<p>【sample】指定したパスを選択範囲にする</p>
<pre><code>// 指定したパスを選択範囲にする
app.activeDocument.pathItems["パス 1"].makeSelection();</code></pre>
<p>　スクリプトを実行する前のパスの状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前のパスの状態</figcaption>
<img src="images/00236.jpeg" />
</figure>
<p>　スクリプトを実行すると"パス 1"にあるパスに沿って選択範囲が作成されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると"パス 1"にあるパスに沿って選択範囲が作成される</figcaption>
<img src="images/00228.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-481">
<section>
<h2 id="calibre_link-312"><b>11-10　指定したパスを塗り潰す</b></h2>
<p>　指定したパスを塗り潰すにはpathItemオブジェクトのmakeSelection()メソッドを使い選択範囲を作成します。次に選択範囲を塗り潰すfill()メソッドを使います。</p>
<p>【sample】指定したパスを塗り潰す</p>
<pre><code>// 指定したパスを塗り潰す
var color = new SolidColor();   // 赤色を設定する
color.rgb.red = 255;
color.rgb.green = 0;
color.rgb.blue = 0;
app.activeDocument.pathItems["パス 1"].makeSelection();   // パスを選択範囲にする
app.activeDocument.selection.fill(color);   // 塗り潰す</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00418.jpeg" />
</figure>
<p>　スクリプトを実行すると"パス 1"のパス形状でレイヤーが塗り潰されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると"パス 1"のパス形状でレイヤーが塗り潰される</figcaption>
<img src="images/00499.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-637">
<section>
<h2 id="calibre_link-313"><b>11-11　指定したパスの境界線を描画する</b></h2>
<p>　指定したパスの境界線を描画するにはpathItemオブジェクトのstrokePath()メソッドを使います。最初のパラメーターには、どの種類のツールで描画するかを指定します。表に示すツールを指定できます。2番目のパラメーターには筆圧をシミュレートするかどうかを指定します。falseを指定すると一定のブラシサイズで描画されます。trueを指定するとパスの最初と最後は筆圧が弱くなるような感じで描画されます。なお、strokePath()メソッドのパラメーターは全て省略することができます。</p>
<table>
<caption>【表】指定できるツール</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>指定できるツール</span>
  </td>
</tr>
<tr>
  <td>ToolType.ARTHISTORYBRUSH</td>
  <td>アートヒストリーブラシツール</td>
</tr>
<tr>
  <td>ToolType.BACKGROUNDERASER</td>
  <td>背景消しゴムツール</td>
</tr>
<tr>
  <td>ToolType.BLUR</td>
  <td>ぼかしツール</td>
</tr>
<tr>
  <td>ToolType.BRUSH</td>
  <td>ブラシツール</td>
</tr>
<tr>
  <td>ToolType.BURN</td>
  <td>焼き込みツール</td>
</tr>
<tr>
  <td>ToolType.CLONESTAMP</td>
  <td>コピースタンプツール</td>
</tr>
<tr>
  <td>ToolType.COLORREPLACEMENTTOOL</td>
  <td>色の置き換えツール</td>
</tr>
<tr>
  <td>ToolType.DODGE</td>
  <td>多い焼きツール</td>
</tr>
<tr>
  <td>ToolType.ERASER</td>
  <td>消しゴムツール</td>
</tr>
<tr>
  <td>ToolType.HEALINGBRUSH</td>
  <td>ヒーリングブラシツール</td>
</tr>
<tr>
  <td>ToolType.HISTORYBRUSH</td>
  <td>ヒストリーブラシツール</td>
</tr>
<tr>
  <td>ToolType.PATTERNSTAMP</td>
  <td>パターンスタンプツール</td>
</tr>
<tr>
  <td>ToolType.PENCIL</td>
  <td>鉛筆ツール</td>
</tr>
<tr>
  <td>ToolType.SHARPEN</td>
  <td>シャープペンシルツール</td>
</tr>
<tr>
  <td>ToolType.SMUDGE</td>
  <td>指先ツール</td>
</tr>
<tr>
  <td>ToolType.SPONGE</td>
  <td>スポンジツール</td>
</tr>
</tbody>
</table>
<p>【sample】指定したパスの境界線を描画する</p>
<pre><code>// 指定したパスの境界線を描画する
app.activeDocument.pathItems["パス 1"].strokePath(ToolType.BRUSH, false);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00599.jpeg" />
</figure>
<p>　スクリプトを実行すると"パス 1"のパスの境界線に沿って線が描画されます。線は現在選択しているブラシとサイズで描画されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると"パス 1"のパスの境界線に沿って線が描画される</figcaption>
<img src="images/00128.jpeg" />
</figure>
<p>　strokePath()メソッドの2番目のパラメーターがtrueの場合は筆圧シミュレートが行われるため、図のようにパスの開始点と終了点の描画部分は小さくなります。</p>
<figure>
<figcaption>【図】2番目のパラメーターがtrueの場合、筆圧シミュレートが行われる</figcaption>
<img src="images/00138.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-423">
<section>
<div>
<h1 id="calibre_link-314"><b>第12章　テキスト／文字／フォント</b></h1>
</div>
</section>
</div>
<div id="calibre_link-576">
<section>
<h2 id="calibre_link-315"><b>12-1　インストールされているフォント数を取得する</b></h2>
<p>　インストールされているフォント数を取得するにはfonts配列のlengthプロパティの値を読み出します。フォントの情報はfonts配列に各要素として格納されています。なお、フォントの情報を更新する場合はapp.refreshFonts()メソッドを使います。常に最新のフォント情報を取得したい場合にはapp.refreshFonts()メソッドを実行した後にfonts配列を参照します。</p>
<p>【sample】インストールされているフォント数を取得する</p>
<pre><code>// インストールされているフォント数を表示する
var n = app.fonts.length;
alert(n);</code></pre>
<p>　インストールされているフォントの総数がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】インストールされているフォントの総数が表示される</figcaption>
<img src="images/00404.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-474">
<section>
<h2 id="calibre_link-316"><b>12-2　フォント一覧を出力する</b></h2>
<p>　フォント一覧を出力するにはfonts配列に格納されている要素の数（フォント情報）だけ繰り返します。フォントにはname、family、style、postScriptNameのプロパティがあります。サンプルではESTK (ExtendScript ToolKit) のJavaScriptコンソールにフォント情報を出力しています。</p>
<p>【sample】フォント一覧を出力する</p>
<pre><code>// フォント一覧を出力する
var fontList = app.fonts;
for(var i=0; i&lt;fontList.length; i++){
    $.writeln("name : " + fontList[i].name);
    $.writeln("family : " + fontList[i].family);
    $.writeln("style : " + fontList[i].style);
    $.writeln("postScriptName : " + fontList[i].postScriptName);
    $.writeln("-------------------------------");
}</code></pre>
<p>　インストールされているフォントの名前などの情報がESTKのJavaScriptコンソールに表示されます。</p>
<figure>
<figcaption>【図】インストールされているフォントの名前などの情報が表示される</figcaption>
<img src="images/00327.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-644">
<section>
<h2 id="calibre_link-317"><b>12-3　指定したレイヤーの文字を表示する</b></h2>
<p>　指定したレイヤーの文字を表示するにはlayers配列で参照したいレイヤーを指定します。レイヤーの種類がテキストレイヤーの場合、textItemオブジェクトがあります。文字はcontentsプロパティを読み出すことで取得することができます。</p>
<p>【sample】指定したレイヤーの文字を表示する</p>
<pre><code>// 指定したレイヤーの文字を表示する
var text = app.activeDocument.layers[1].textItem.contents;
alert(text);</code></pre>
<p>　2番目のレイヤーの文字がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】2番目のレイヤーの文字が表示される</figcaption>
<img src="images/00089.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-689">
<section>
<h2 id="calibre_link-318"><b>12-4　テキスト全体のフォントを変更する</b></h2>
<p>　テキスト全体のフォントを変更するにはtextItemオブジェクトのfontプロパティにフォント名を指定します。このフォント名はPostScript名で指定する必要があります。これはapp.fontsで得られるフォント情報のpostScriptNameプロパティを参照することで確認することができます。</p>
<p>【sample】テキスト全体のフォントを変更する</p>
<pre><code>// アクティブレイヤーのフォントを変更する
app.activeDocument.activeLayer.textItem.font = "Times-BoldItalic";</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00505.jpeg" />
</figure>
<p>　アクティブレイヤーのフォントが変わります。</p>
<figure>
<figcaption>【図】アクティブレイヤーのフォントが変わる</figcaption>
<img src="images/00278.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-583">
<section>
<h2 id="calibre_link-319"><b>12-5　アクティブレイヤーの文字を表示する</b></h2>
<p>　アクティブレイヤーの文字を表示するにはlayers配列で参照したいレイヤーを指定します。レイヤーがテキストレイヤーかどうかはlayerオブジェクトのkindプロパティで調べることができます。LayerKind.TEXTの場合はテキストレイヤーになります。レイヤーの種類がテキストレイヤーの場合、textItemオブジェクトがあります。文字はcontentsプロパティを読み出すことで取得することができます。</p>
<p>【sample】アクティブレイヤーの文字を表示する</p>
<pre><code>// アクティブレイヤーの文字を表示する
var layObj = app.activeDocument.activeLayer;
if (layObj.kind == LayerKind.TEXT){ // レイヤーの種類がテキストの場合のみ処理
    var text = layObj.textItem.contents;    // 文字を読み出す
    alert(text);
}else{
    alert("テキストレイヤーではありません");
}</code></pre>
<p>　アクティブレイヤーの文字がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】アクティブレイヤーの文字が表示される</figcaption>
<img src="images/00040.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-624">
<section>
<h2 id="calibre_link-320"><b>12-6　アクティブレイヤーの文字を変更する</b></h2>
<p>　アクティブレイヤーの文字を変更するにはtextItemオブジェクトのcontentsプロパティに文字を入れます。</p>
<p>【sample】アクティブレイヤーの文字を変更する</p>
<pre><code>// アクティブレイヤーの文字を変更する
app.activeDocument.activeLayer.textItem.contents = "アドビ";</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00457.jpeg" />
</figure>
<p>　アクティブレイヤーの文字が変更されます。</p>
<figure>
<figcaption>【図】アクティブレイヤーの文字が変更される</figcaption>
<img src="images/00232.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-413">
<section>
<h2 id="calibre_link-321"><b>12-7　テキストレイヤーの位置を表示する</b></h2>
<p>　テキストレイヤーの位置を表示するにはtextItemオブジェクトのposition配列を参照します。position配列の最初の要素にX座標、2番目の要素にY座標が入っています。X, Y座標ともUnitValue形式になっています。</p>
<p>【sample】テキストレイヤーの位置を表示する</p>
<pre><code>// テキストレイヤーの位置を表示する
var layObj = app.activeDocument.activeLayer;
var x = layObj.textItem.position[0];    // X座標
var y = layObj.textItem.position[1];    // Y座標
alert(x+"×"+y);</code></pre>
<p>　アクティブになっているテキストレイヤーの左上の座標値がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】アクティブなテキストレイヤーの左上の座標値が表示される</figcaption>
<img src="images/00090.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-490">
<section>
<h2 id="calibre_link-322"><b>12-8　テキストレイヤーの位置を変更する</b></h2>
<p>　テキストレイヤーの位置を変更するにはtextItemオブジェクトのposition配列にX, Y座標の順番に値を設定します。値はUnitValue形式で指定する必要があります。また、position[0] = UnitValue("30px")のように個別に設定した場合は反映されません。必ずサンプルのように同時にXY座標を配列形式で設定してください。</p>
<p>【sample】テキストレイヤーの位置を変更する</p>
<pre><code>// テキストレイヤーの位置を変更する
var layObj = app.activeDocument.activeLayer;
layObj.textItem.position = [UnitValue(50, "px"), UnitValue(20, "px")];</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00047.jpeg" />
</figure>
<p>　テキストレイヤーの座標値が変更されます。</p>
<figure>
<figcaption>【図】テキストレイヤーの座標値が変更される</figcaption>
<img src="images/00463.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-7">
<section>
<h2 id="calibre_link-323"><b>12-9　テキスト全体の水平比率を変更する（長体・平体）</b></h2>
<p>　テキスト全体の水平比率を変更するにはtextItemオブジェクトのhorizontalScaleプロパティに値を設定します。horizontalScaleプロパティには0～1000までの数値を設定することができます。また、水平比率でなく垂直比率を変更する場合はverticalScaleプロパティに0～1000までの数値を設定します。</p>
<p>【sample】テキスト全体の水平比率を変更する（長体・平体）</p>
<pre><code>// アクティブレイヤーの水平比率を変更する
app.activeDocument.activeLayer.textItem.horizontalScale = 300;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00237.jpeg" />
</figure>
<p>　アクティブレイヤーの文字の幅が300%になります。</p>
<figure>
<figcaption>【図】アクティブレイヤーの文字の幅が300%になる</figcaption>
<img src="images/00006.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-696">
<section>
<h2 id="calibre_link-324"><b>12-10　テキスト全体の文字カラーを変更する</b></h2>
<p>　テキスト全体の文字カラーを変更するにはtextItemオブジェクトのcolorプロパティにカラーを設定します。カラーはSolidColorオブジェクトを使って指定します。</p>
<p>【sample】テキスト全体の文字カラーを変更する</p>
<pre><code>// アクティブレイヤーの文字カラーを変更する
var mColor = new SolidColor();  // 紫色にする
mColor.rgb.red = 192;
mColor.rgb.blue = 192;
mColor.rgb.green = 32;
app.activeDocument.activeLayer.textItem.color = mColor;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00419.jpeg" />
</figure>
<p>　アクティブレイヤーの文字カラーが赤色から紫色に変わります。</p>
<figure>
<figcaption>【図】アクティブレイヤーの文字カラーが赤色から紫色に変わる</figcaption>
<img src="images/00193.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-690">
<section>
<h2 id="calibre_link-325"><b>12-11　テキスト全体の文字サイズを変更する</b></h2>
<p>　テキスト全体の文字サイズを変更するにはtextItemオブジェクトのsizeプロパティに値を設定します。値はUnitValue形式で指定します。</p>
<p>【sample】テキスト全体の文字サイズを変更する</p>
<pre><code>// アクティブレイヤーの文字サイズを変更する
app.activeDocument.activeLayer.textItem.size = UnitValue("48pt");</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00600.jpeg" />
</figure>
<p>　アクティブレイヤーの文字サイズが変わります。</p>
<figure>
<figcaption>【図】アクティブレイヤーの文字サイズが変わる</figcaption>
<img src="images/00371.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-477">
<section>
<h2 id="calibre_link-326"><b>12-12　行揃えを指定する</b></h2>
<p>　行揃えを指定するにはtextItemオブジェクトのjustificationプロパティに以下の表に示す値を設定します。</p>
<table>
<caption>【表】行揃えの種類</caption>
<tbody>
<tr>
  <td>
    <span>値</span>
  </td>
  <td>
    <span>行揃えの種類</span>
  </td>
</tr>
<tr>
  <td>Justification.CENTER</td>
  <td>中央揃え（センタリング）</td>
</tr>
<tr>
  <td>Justification.CENTERJUSTIFIED</td>
  <td>均等配置（最終行中央揃え）</td>
</tr>
<tr>
  <td>Justification.FULLYJUSTIFIED</td>
  <td>両端揃え</td>
</tr>
<tr>
  <td>Justification.LEFT</td>
  <td>左揃え</td>
</tr>
<tr>
  <td>Justification.LEFTJUSTIFIED</td>
  <td>均等配置（最終行左揃え）</td>
</tr>
<tr>
  <td>Justification.RIGHT</td>
  <td>右揃え</td>
</tr>
<tr>
  <td>Justification.RIGHTJUSTIFIED</td>
  <td>均等配置（最終行右揃え）</td>
</tr>
</tbody>
</table>
<p>【sample】行揃えを指定する</p>
<pre><code>// 行揃えを指定する
layObj = app.activeDocument.activeLayer.textItem.justification = Justification.RIGHT;</code></pre>
<p>　スクリプトを実行する前の状態です。テキストは左揃えになっています。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態。テキストは左揃えになっている。</figcaption>
<img src="images/00139.jpeg" />
</figure>
<p>　スクリプトを実行すると右揃えになります。</p>
<figure>
<figcaption>【図】スクリプトを実行すると右揃えになる</figcaption>
<img src="images/00554.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-552">
<section>
<h2 id="calibre_link-327"><b>12-13　段落テキストの横幅と縦幅を表示する</b></h2>
<p>　段落テキストの横幅と縦幅を表示するには段落テキストである必要があります。段落テキストでない場合はエラーになります。テキストレイヤーのtextItem.kindプロパティがTextType.PARAGRAPHTEXTの場合、段落テキストになります。</p>
<p>　段落テキストの横幅はwidthプロパティ、縦幅はheightプロパティに格納されています。これらの値はUnitValue形式になります。</p>
<p>【sample】段落テキストの横幅と縦幅を表示する</p>
<pre><code>// 段落テキストの横幅と縦幅を表示する
var layObj = app.activeDocument.activeLayer;
if (layObj.textItem.kind == TextType.PARAGRAPHTEXT){
    var w = layObj.textItem.width;  // 横幅
    var h = layObj.textItem.height; // 縦幅
    alert(w+"×"+h);
}</code></pre>
<p>　アクティブレイヤーの横幅と縦幅がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】アクティブレイヤーの横幅と縦幅がアラートダイアログに表示される</figcaption>
<img src="images/00461.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-422">
<section>
<h2 id="calibre_link-328"><b>12-14　段落テキストの横幅と縦幅を変更する</b></h2>
<p>　段落テキストの横幅と縦幅を変更するにはtextItemオブジェクトのwidthプロパティとheightプロパティに値を設定します。設定する値はUnitValue形式になります。なお、段落テキストでない場合はエラーになります。</p>
<p>【sample】段落テキストの横幅と縦幅を変更する</p>
<pre><code>// 段落テキストの横幅と縦幅を変更する
var layObj = app.activeDocument.activeLayer;
if (layObj.textItem.kind == TextType.PARAGRAPHTEXT){
    layObj.textItem.width = UnitValue("120px");  // 横幅
    layObj.textItem.height = UnitValue("100px"); // 縦幅
}</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00452.jpeg" />
</figure>
<p>　スクリプトを実行すると段落テキストの横幅と縦幅が変更されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると段落テキストの横幅と縦幅が変更される</figcaption>
<img src="images/00493.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-578">
<section>
<h2 id="calibre_link-329"><b>12-15　段落テキストを縦書きにする</b></h2>
<p>　段落テキストを縦書きにするにはtextItemオブジェクトのdirectionプロパティにDirection.VERTICALを設定します。縦書きから横書きにしたい場合はDirection.HORIZONTALを設定します。</p>
<p>【sample】段落テキストを縦書きにする</p>
<pre><code>// 段落テキストを縦書きにする
app.activeDocument.activeLayer.textItem.direction = Direction.VERTICAL;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00279.jpeg" />
</figure>
<p>　スクリプトを実行すると段落テキストが縦書きになります。</p>
<figure>
<figcaption>【図】スクリプトを実行すると段落テキストが縦書きになる</figcaption>
<img src="images/00041.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-14">
<section>
<h2 id="calibre_link-330"><b>12-16　文字をパスに変換する</b></h2>
<p>　文字をパスに変換するにはcreatePath()メソッドを使います。createPath()メソッドには指定できるパラメーターはありません。</p>
<p>【sample】文字をパスに変換する</p>
<pre><code>// 文字をパスに変換する
app.activeDocument.activeLayer.textItem.createPath();</code></pre>
<p>　アクティブレイヤーの文字が全てパスに変換されます。</p>
<figure>
<figcaption>【図】アクティブレイヤーの文字が全てパスに変換される</figcaption>
<img src="images/00458.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-522">
<section>
<h2 id="calibre_link-331"><b>12-17　文字をシェイプに変換する</b></h2>
<p>　文字をシェイプに変換するにはconvertToShape()メソッドを使います。convertToShape()メソッドには指定できるパラメーターはありません。</p>
<p>【sample】文字をシェイプに変換する</p>
<pre><code>// 文字をシェイプに変換する
app.activeDocument.activeLayer.textItem.convertToShape();</code></pre>
<p>　アクティブレイヤーの文字がシェイプに変換されます。</p>
<figure>
<figcaption>【図】アクティブレイヤーの文字がシェイプに変換される</figcaption>
<img src="images/00233.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-678">
<section>
<h2 id="calibre_link-332"><b>12-18　特定の文字列を含むレイヤーを配列として返す</b></h2>
<p>　特定の文字列を含むレイヤーを配列として返すには、いくつか方法があります。ここでは全てのレイヤーを取得する関数を用意します。（詳細については「テキストレイヤーだけ削除する」の項目を参照してください）　</p>
<p>　関数で得られた全てのレイヤー情報をもとにレイヤーの種類を調べます。レイヤーの種類がテキストの場合はtextItems.contentsプロパティに表示されている文字列が入っています。この文字列から一致する文字列を調べるにはindexOf()メソッドを使います。パラメーターには検索する文字列を指定します。文字列が含まれている場合には文字列が見つかった位置を0以上の数値で返します。見つからなかった場合は-1を返します。つまり、indexOf()メソッドで検索した結果が0以上なら該当する文字列があったことになるので配列に入れます。これをレイヤーの数だけ繰り返します。</p>
<p>【sample】特定の文字列を含むレイヤーを配列として返す</p>
<pre><code>// テキスト内容に特定の文字列を含むレイヤーを返す
var lay1 = getLayerMatchText("Adobe");
alert("Adobeの文字を含むレイヤーは"+lay1.length+"個ありました");
var lay2 = getLayerMatchText("CC");
alert("CCの文字を含むレイヤーは"+lay2.length+"個ありました");
var lay3 = getLayerMatchText("CC 2014");
alert("CC 2014の文字を含むレイヤーは"+lay3.length+"個ありました");
// 特定の文字列を含むレイヤーオブジェクトを配列で返す
// IN : 検索対象となる文字列
// OUT : 指定した名前を持つレイヤーオブジェクトを格納した配列
function getLayerMatchText(macthText){
    var list = getAllLayer(app.activeDocument, []);
    var result = [];    // 結果を入れる配列
    for(var i=0; i&lt;list.length; i++){
        if (list[i].kind == LayerKind.TEXT){    // テキストの場合に処理
            // シリアル検索で先頭から該当する文字列が含まれるか調べる
            var s = list[i].textItem.contents.indexOf(macthText);
            if (s &gt; -1){    // 文字列が存在した場合
                result.push(list[i]);
            }
        }
    }
    return result;
    // レイヤーセットを除く全てのレイヤーオブジェクトを取得する
    // IN : レイヤーオブジェクト, 配列オブジェクト
    // OUT : レイヤーオブジェクトを格納した配列オブジェクト
    function getAllLayer(obj, ary){
        for(var i=0; i&lt;obj.layers.length; i++){
            if (obj.layers[i].kind){    // レイヤーセット以外の場合
                ary.push(obj.layers[i]);
            }else{  // レイヤーセットなので再帰
                getAllLayer(obj.layers[i], ary);
            }
        }
        return ary; // 結果は配列で返す
    }
}</code></pre>
<p>　テキストレイヤーが複数あり、さまざまな文字が表示されています。</p>
<figure>
<figcaption>【図】テキストレイヤーが複数あり、さまざまな文字が表示されている</figcaption>
<img src="images/00003.jpeg" />
</figure>
<p>　スクリプトを実行すると指定した文字列を含むレイヤーの数が表示されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると指定した文字列を含むレイヤーの数が表示される</figcaption>
<img src="images/00415.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-465">
<section>
<h2 id="calibre_link-333"><b>12-19　選択されているテキストレイヤーに現在の日付を入れる</b></h2>
<p>　選択されているテキストレイヤーに現在の日付を入れるには、まずDateオブジェクトを生成します。生成すると、その時点での日付、時間情報を持ったオブジェクトが生成されます。Dateオブジェクトには日付情報を取得するメソッドがあります。西暦4桁年はgetFullYear()メソッド、月はgetMonth()メソッド、日にちはgetDate()メソッドで取得することができます。いずれのメソッドパラメーターはありません。また、getMonth()は実際の月よりも1少ない数を返すので注意が必要です。</p>
<p>　あとは、表示したい日付と文字をテキストレイヤーのcontentsプロパティに入れます。アクティブになっているレイヤーがテキストレイヤーかどうか調べてから処理するのであればlayerオブジェクトのkindプロパティを調べます。kindプロパティの値がLayerKind.TEXTならばテキストレイヤーになります。</p>
<p>【sample】選択されているテキストレイヤーに現在の日付を入れる</p>
<pre><code>// 選択されているテキストレイヤーに現在の日付を入れる
var dateObj = new Date();   // 現在の日付を取得する
var Y = dateObj.getFullYear();  // 西暦４桁年を読み出す
var M = dateObj.getMonth()+1; // 月を詠み出す。実際より1少ない値になるので1を足す
var D = dateObj.getDate();  // 日を読み出す
var text = Y+"年"+M+"月"+D+"日";   // 表示する日付を生成
app.activeDocument.activeLayer.textItem.contents = text;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00187.jpeg" />
</figure>
<p>　スクリプトを実行するとアクティブレイヤーの文字が現在の日付に変更されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとアクティブレイヤーの文字が現在の日付に変更される</figcaption>
<img src="images/00276.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-621">
<section>
<div>
<h1 id="calibre_link-334"><b>第13章　ファイル保存</b></h1>
</div>
</section>
</div>
<div id="calibre_link-411">
<section>
<h2 id="calibre_link-335"><b>13-1　BMP形式で保存する</b></h2>
<p>　BMP形式で保存するにはBMPSaveOptionsオブジェクトを生成し、必要なオプションを設定します。以下の「【表】指定できるオプション」に示すオプションを指定できます。</p>
<p>　BMP形式のオブションを設定したらdocumentオブジェクトのsaveAs()メソッドを使って保存します。saveAs()メソッドの最初のパラメーターに保存先情報を持つファイルオブジェクトを指定します。2番目のパラメーターには保存するオプション（BMPSaveOptionsオブジェクト）を指定します。3番目のパラメーターには複製を保存するかどうかをフラグで指定します。trueなら複製を保存します。4番目のパラメーターはファイルの拡張子を大文字にするか、小文字にするかを指定します。「【表】拡張子の種類」に示す値を指定できます。</p>
<table>
<caption>【表】指定できるオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>alphaChannels</td>
  <td>αチャンネルを保存（true：保存する、false：保存しない）</td>
</tr>
<tr>
  <td>depth</td>
  <td>色深度とデータの並び順（【表】色深度とデータの並び順を参照）</td>
</tr>
<tr>
  <td>flipRowOrder</td>
  <td>行の順序の反転（true：反転する、false：反転しない）</td>
</tr>
<tr>
  <td>osType</td>
  <td>OSの種類（【表】OSの種類を参照）</td>
</tr>
<tr>
  <td>rleCompression</td>
  <td>ランレングス（RLE）圧縮（true：する、false：しない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】色深度とデータの並び順</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>BMPDepthType.BMP_A1R5G5B5</td>
  <td>A1R5G5B5の並び順とビット数(16bit)</td>
</tr>
<tr>
  <td>BMPDepthType.BMP_A4R4G4B4</td>
  <td>A4R4G4B4の並び順とビット数(16bit)</td>
</tr>
<tr>
  <td>BMPDepthType.BMP_A8R8G8B8</td>
  <td>A8R8G8B8の並び順とビット数(32bit)</td>
</tr>
<tr>
  <td>BMPDepthType.BMP_R5G6B5</td>
  <td>R5G6B5の並び順とビット数(16bit)</td>
</tr>
<tr>
  <td>BMPDepthType.BMP_R8G8B8</td>
  <td>R8G8B8の並び順とビット数(24bit)</td>
</tr>
<tr>
  <td>BMPDepthType.BMP_X1R5G5B5</td>
  <td>X1R5G5B5の並び順とビット数(16bit)</td>
</tr>
<tr>
  <td>BMPDepthType.BMP_X4R4G4B4</td>
  <td>X4R4G4B4の並び順とビット数(16bit)</td>
</tr>
<tr>
  <td>BMPDepthType.BMP_X8R8G8B8</td>
  <td>X8R8G8B8の並び順とビット数(32bit)</td>
</tr>
<tr>
  <td>BMPDepthType.ONE</td>
  <td>1ビットカラー</td>
</tr>
<tr>
  <td>BMPDepthType.FOUR</td>
  <td>4ビットカラー</td>
</tr>
<tr>
  <td>BMPDepthType.EIGHT</td>
  <td>8ビットカラー</td>
</tr>
<tr>
  <td>BMPDepthType.SIXTEEN</td>
  <td>16ビットカラー</td>
</tr>
<tr>
  <td>BMPDepthType.TWENTYFOUR</td>
  <td>24ビットカラー</td>
</tr>
<tr>
  <td>BMPDepthType.THIRTYTWO</td>
  <td>32ビットカラー</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】OSの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>OperatingSystem.OS2</td>
  <td>OS2</td>
</tr>
<tr>
  <td>OperatingSystem.WINDOWS</td>
  <td>Windows</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】拡張子の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】BMP形式で保存する</p>
<pre><code>// BMP形式で保存する
var fileObj = new File("～/Desktop/sample.bmp");
var bmpOpt = new BMPSaveOptions();  // BMP形式オプション
bmpOpt.alphaChannels = true;    // αチャンネル
bmpOpt.depth = BMPDepthType.THIRTYTWO;  // 32bit色深度
bmpOpt.flipRowOrder = false;    // 行(Row)反転
bmpOpt.osType = OperatingSystem.WINDOWS;    // OSの種類
bmpOpt.rleCompression = false;  // ランレングス(RLE)圧縮フラグ
activeDocument.saveAs(fileObj, bmpOpt, true, Extension.LOWERCASE);</code></pre>
<p>　BMP形式でファイルが保存されます。</p>
<figure>
<figcaption>【図】BMP形式でファイルが保存される</figcaption>
<img src="images/00366.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-569">
<section>
<h2 id="calibre_link-336"><b>13-2　EPS形式で保存する</b></h2>
<p>　EPS形式で保存するにはEPSSaveOptionsオブジェクトを生成し、必要なオプションを設定します。以下の「【表】指定できるオプション」に示すオプションを指定できます。</p>
<p>　EPS形式のオブションを設定したらdocumentオブジェクトのsaveAs()メソッドを使って保存します。saveAs()メソッドの最初のパラメーターに保存先情報を持つファイルオブジェクトを指定します。2番目のパラメーターには保存するオプション（EPSSaveOptionsオブジェクト）を指定します。3番目のパラメーターには複製を保存するかどうかをフラグで指定します。trueなら複製を保存します。4番目のパラメーターはファイルの拡張子を大文字にするか、小文字にするかを指定します。「【表】拡張子の種類」に示す値を指定できます。</p>
<table>
<caption>【表】指定できるオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>embedColorProfile</td>
  <td>カラープロファイル（true：埋め込む、false：埋め込まない）</td>
</tr>
<tr>
  <td>encoding</td>
  <td>エンコーディング（【表】エンコーディングを参照）</td>
</tr>
<tr>
  <td>halftoneScreen</td>
  <td>ハーフトーンスクリーン（true：含める、false：含めない）</td>
</tr>
<tr>
  <td>interpolation</td>
  <td>画像の補間（true：する、false：しない）</td>
</tr>
<tr>
  <td>preview</td>
  <td>プレビュー形式（【表】プレビュー形式を参照）</td>
</tr>
<tr>
  <td>psColorManagement</td>
  <td>ポストスクリプトカラーマネジメント（true：する、false：しない）</td>
</tr>
<tr>
  <td>transferFunction</td>
  <td>トランスファ関数（true：含める、false：含めない）</td>
</tr>
<tr>
  <td>transparentWhites</td>
  <td>透明部分（true：白にする、false：しない）</td>
</tr>
<tr>
  <td>vectorData</td>
  <td>ベクトルデータ（true：含める、false：含めない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】エンコーディング</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>SaveEncoding.ASCII</td>
  <td>アスキー</td>
</tr>
<tr>
  <td>SaveEncoding.BINARY</td>
  <td>バイナリー</td>
</tr>
<tr>
  <td>SaveEncoding.JPEGHIGH</td>
  <td>JPEG高画質</td>
</tr>
<tr>
  <td>SaveEncoding.JPEGLOW</td>
  <td>JPEG低画質</td>
</tr>
<tr>
  <td>SaveEncoding.JPEGMAXIMUM</td>
  <td>JPEG最高画質</td>
</tr>
<tr>
  <td>SaveEncoding.JPEGMEDIUM</td>
  <td>JPEG標準画質</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】プレビュー形式</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Preview.EIGHTBITTIFF</td>
  <td>8ビットTIFF</td>
</tr>
<tr>
  <td>Preview.MACOSEIGHTBIT</td>
  <td>8ビット（MacOS）</td>
</tr>
<tr>
  <td>Preview.MACOSJPEG</td>
  <td>JPEG形式（MacOS）</td>
</tr>
<tr>
  <td>Preview.MACOSMONOCHROME</td>
  <td>白黒（MacOS）</td>
</tr>
<tr>
  <td>Preview.MONOCHROMETIFF</td>
  <td>白黒TIFF</td>
</tr>
<tr>
  <td>Preview.NONE</td>
  <td>なし</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】拡張子の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】EPS形式で保存する</p>
<pre><code>// EPS形式で保存する
var fileObj = new File("～/Desktop/sample.eps");
var epsOpt = new EPSSaveOptions();
epsOpt.embedColorProfile = true;    // カラープロファイルを埋め込む
epsOpt.encoding = SaveEncoding.ASCII;   // ASCII形式でエンコード
epsOpt.halftoneScreen = false;  // ハーフトーンスクリーンは含めない
epsOpt.interpolation = false;   // 画像補完しない
epsOpt.preview = Preview.MACOSJPEG; // プレビューはMacOS JPEG形式
epsOpt.psColorManagement = false;   // ポストスクリプトカラーマネジメントはしない
epsOpt.transferFunction = false;    // トランスファ関数は含めない
epsOpt.transparentWhites = false;   // 透明部分は白にせず透明なままにする
epsOpt.vectorData = false;  // ベクトルデータは含めない
activeDocument.saveAs(fileObj, epsOpt, true, Extension.LOWERCASE);</code></pre>
<p>　EPS形式でファイルが保存されます。</p>
<figure>
<figcaption>【図】EPS形式でファイルが保存される</figcaption>
<img src="images/00135.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-5">
<section>
<h2 id="calibre_link-337"><b>13-3　GIF形式で保存する</b></h2>
<p>　GIF形式で保存するにはGIFSaveOptionsオブジェクトを生成し、必要なオプションを設定します。以下の「【表】指定できるオプション」に示すオプションを指定できます。</p>
<p>　GIF形式のオブションを設定したらdocumentオブジェクトのsaveAs()メソッドを使って保存します。saveAs()メソッドの最初のパラメーターに保存先情報を持つファイルオブジェクトを指定します。2番目のパラメーターには保存するオプション（GIFSaveOptionsオブジェクト）を指定します。3番目のパラメーターには複製を保存するかどうかをフラグで指定します。trueなら複製を保存します。4番目のパラメーターはファイルの拡張子を大文字にするか、小文字にするかを指定します。「【表】拡張子の種類」に示す値を指定できます。</p>
<table>
<caption>【表】指定できるオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>colors</td>
  <td>色数（最大256。保存パレットの種類にもよる）</td>
</tr>
<tr>
  <td>dither</td>
  <td>ディザ処理（【表】ディザ処理の方法を参照）</td>
</tr>
<tr>
  <td>ditherAmount</td>
  <td>ディザ処理の割合（1～100）</td>
</tr>
<tr>
  <td>forced</td>
  <td>強制（【表】forcedで指定できる値を参照）</td>
</tr>
<tr>
  <td>interlaced</td>
  <td>インターレース（true：オン、false：オフ）</td>
</tr>
<tr>
  <td>matte</td>
  <td>マット（【表】マットの種類を参照）</td>
</tr>
<tr>
  <td>palette</td>
  <td>パレットの種類（【表】パレットの種類を参照）</td>
</tr>
<tr>
  <td>preserveExactColors</td>
  <td>同一色の保持（true：する、false：しない）</td>
</tr>
<tr>
  <td>transparency</td>
  <td>透明（true：透明にする、false：透明にしない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】ディザ処理の方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Dither.DIFFUSION</td>
  <td>誤差拡散</td>
</tr>
<tr>
  <td>Dither.NOISE</td>
  <td>ノイズ</td>
</tr>
<tr>
  <td>Dither.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Dither.PATTERN</td>
  <td>パターン</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】forcedで指定できる値</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>ForcedColors.BLACKWHITE</td>
  <td>白黒</td>
</tr>
<tr>
  <td>ForcedColors.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>ForcedColors.PRIMARIES</td>
  <td>RGB色度座標</td>
</tr>
<tr>
  <td>ForcedColors.WEB</td>
  <td>Web</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】マットの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>MatteType.BACKGROUND</td>
  <td>背景色</td>
</tr>
<tr>
  <td>MatteType.BLACK</td>
  <td>黒</td>
</tr>
<tr>
  <td>MatteType.FOREGROUND</td>
  <td>描画色（前景色）</td>
</tr>
<tr>
  <td>MatteType.NETSCAPENONE</td>
  <td>Netscapeグレー</td>
</tr>
<tr>
  <td>MatteType.SEMIGRAY</td>
  <td>50%グレー</td>
</tr>
<tr>
  <td>MatteType.WHITE</td>
  <td>白</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】パレットの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Palette.EXACT</td>
  <td>全ての色を割り付ける</td>
</tr>
<tr>
  <td>Palette.LOCALADAPTIVE</td>
  <td>ローカル（割り付け）</td>
</tr>
<tr>
  <td>Palette.LOCALPERCEPTUAL</td>
  <td>ローカル（知覚的）</td>
</tr>
<tr>
  <td>Palette.LOCALSELECTIVE</td>
  <td>ローカル（特定）</td>
</tr>
<tr>
  <td>Palette.MACOSPALETTE</td>
  <td>システム（Macintosh）</td>
</tr>
<tr>
  <td>Palette.MASTERADAPTIVE</td>
  <td>マスター（割り付け）</td>
</tr>
<tr>
  <td>Palette.MASTERPERCEPTUAL</td>
  <td>マスター（知覚的）</td>
</tr>
<tr>
  <td>Palette.MASTERSELECTIVE</td>
  <td>マスター（特定）</td>
</tr>
<tr>
  <td>Palette.PREVIOUSPALETTE</td>
  <td>前回使用したパレット</td>
</tr>
<tr>
  <td>Palette.UNIFORM</td>
  <td>RGBカラーを均等に割り付ける</td>
</tr>
<tr>
  <td>Palette.WEBPALETTE</td>
  <td>Web</td>
</tr>
<tr>
  <td>Palette.WINDOWSPALETTE</td>
  <td>システム（Windows）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】拡張子の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】GIF形式で保存する</p>
<pre><code>// GIF形式で保存する
var fileObj = new File("～/Desktop/sample.gif");
var gifOpt = new GIFSaveOptions();
gifOpt.colors = 16; // 16色
gifOpt.dither = Dither.NONE;    // ディザなし
gifOpt.interlacted = false;  // インターレースなし
gifOpt.matte = MatteType.WHITE; // 白マット
gifOpt.palette = Palette.LOCALADAPTIVE; // ローカル（割り付け）
gifOpt.preserveExactColors = false; // 同一色の保持をする
gifOpt.transparency = true; // 透明部分ありにする
activeDocument.saveAs(fileObj, gifOpt, true, Extension.LOWERCASE);</code></pre>
<p>　GIF形式でファイルが保存されます。</p>
<figure>
<figcaption>【図】GIF形式でファイルが保存される</figcaption>
<img src="images/00551.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-508">
<section>
<h2 id="calibre_link-338"><b>13-4　JPEG形式で保存する</b></h2>
<p>　JPEG形式で保存するにはJPEGSaveOptionsオブジェクトを生成し、必要なオプションを設定します。以下の「【表】指定できるオプション」に示すオプションを指定できます。</p>
<p>　JPEG形式のオブションを設定したらdocumentオブジェクトのsaveAs()メソッドを使って保存します。saveAs()メソッドの最初のパラメーターに保存先情報を持つファイルオブジェクトを指定します。2番目のパラメーターには保存するオプション（JPEGSaveOptionsオブジェクト）を指定します。3番目のパラメーターには複製を保存するかどうかをフラグで指定します。trueなら複製を保存します。4番目のパラメーターはファイルの拡張子を大文字にするか、小文字にするかを指定します。「【表】拡張子の種類」に示す値を指定できます。</p>
<table>
<caption>【表】指定できるオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>embedColorProfile</td>
  <td>カラープロファイルを埋め込むかどうか（true：埋め込む、false：埋め込まない）</td>
</tr>
<tr>
  <td>formatOptions</td>
  <td>形式オプション（【表】形式オプションを参照）</td>
</tr>
<tr>
  <td>matte</td>
  <td>マット（【表】マットの種類を参照）</td>
</tr>
<tr>
  <td>quality</td>
  <td>画質（0～12）</td>
</tr>
<tr>
  <td>scans</td>
  <td>プログレッシブ時のスキャン数（3～5）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】形式オプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>FormatOptions.OPTIMIZEDBASELINE</td>
  <td>ベースライン（最適化）</td>
</tr>
<tr>
  <td>FormatOptions.PROGRESSIVE</td>
  <td>プログレッシブ</td>
</tr>
<tr>
  <td>FormatOptions.STANDARDBASELINE</td>
  <td>ベースライン（標準）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】マットの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>MatteType.BACKGROUND</td>
  <td>背景色</td>
</tr>
<tr>
  <td>MatteType.BLACK</td>
  <td>黒</td>
</tr>
<tr>
  <td>MatteType.FOREGROUND</td>
  <td>描画色（前景色）</td>
</tr>
<tr>
  <td>MatteType.NETSCAPENONE</td>
  <td>Netscapeグレー</td>
</tr>
<tr>
  <td>MatteType.SEMIGRAY</td>
  <td>50%グレー</td>
</tr>
<tr>
  <td>MatteType.WHITE</td>
  <td>白</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】拡張子の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】JPEG形式で保存する</p>
<pre><code>// JPEG形式で保存する
var fileObj = new File("～/Desktop/sample.jpg");
var jpegOpt = new JPEGSaveOptions();
jpegOpt.embedColorProfile = true;   // カラープロファイルを埋め込む
jpegOpt.quality = 6;    // 品質は6
jpegOpt.formatOptions = FormatOptions.PROGRESSIVE;  // プログレッシブにする
jpegOpt.scans = 3;  // スキャンラインは3
jpegOpt.matte = MatteType.NONE; // カラーマットなし
activeDocument.saveAs(fileObj, jpegOpt, true, Extension.LOWERCASE);</code></pre>
<p>　JPEG形式でファイルが保存されます。</p>
<figure>
<figcaption>【図】JPEG形式でファイルが保存される</figcaption>
<img src="images/00324.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-600">
<section>
<h2 id="calibre_link-339"><b>13-5　PDF形式で保存する</b></h2>
<p>　PDF形式で保存するにはPDFSaveOptionsオブジェクトを生成し、必要なオプションを設定します。以下の「【表】指定できるオプション」に示すオプションを指定できます。</p>
<p>　PDF形式のオブションを設定したらdocumentオブジェクトのsaveAs()メソッドを使って保存します。saveAs()メソッドの最初のパラメーターに保存先情報を持つファイルオブジェクトを指定します。2番目のパラメーターには保存するオプション（PDFSaveOptionsオブジェクト）を指定します。3番目のパラメーターには複製を保存するかどうかをフラグで指定します。trueなら複製を保存します。4番目のパラメーターはファイルの拡張子を大文字にするか、小文字にするかを指定します。「【表】拡張子の種類」に示す値を指定できます。</p>
<table>
<caption>【表】指定できるオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>alphaChannels</td>
  <td>αチャンネルを保存（true：保存する、false：保存しない）</td>
</tr>
<tr>
  <td>annotations</td>
  <td>注釈（true：あり、false：なし）</td>
</tr>
<tr>
  <td>downgradeColorProfile</td>
  <td>カラープロファイルのダウングレード（true：する、false：しない）</td>
</tr>
<tr>
  <td>embedColorProfile</td>
  <td>カラープロファイル（true：埋め込む、false：埋め込まない）</td>
</tr>
<tr>
  <td>embedFonts</td>
  <td>フォントの埋め込み（true：埋め込む、false：埋め込まない）</td>
</tr>
<tr>
  <td>encoding</td>
  <td>エンコーディング形式（【表】エンコーディング形式を参照）</td>
</tr>
<tr>
  <td>interpolation</td>
  <td>画像の補間（true：する、false：しない）</td>
</tr>
<tr>
  <td>jpegQuality</td>
  <td>JPEG画質（0～12：０が低画質、12が高画質）</td>
</tr>
<tr>
  <td>layers</td>
  <td>レイヤーを保存（true：する、false：しない）</td>
</tr>
<tr>
  <td>spotColors</td>
  <td>スポットカラー（true：保存する、false：保存しない）</td>
</tr>
<tr>
  <td>transparency</td>
  <td>透明部分の保持（true：保持する、false：保持しない）</td>
</tr>
<tr>
  <td>useOutline</td>
  <td>テキストにアウトラインを使用（true：する、false：しない）</td>
</tr>
<tr>
  <td>vectorData</td>
  <td>ベクトルデータ（true：含める、false：含めない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】エンコーディング形式</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>PDFEncoding.JPEG</td>
  <td>JPEG形式</td>
</tr>
<tr>
  <td>PDFEncoding.PDFZIP</td>
  <td>ZIP形式</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】拡張子の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】PDF形式で保存する</p>
<pre><code>// PDF形式で保存する
var fileObj = new File("～/Desktop/sample.pdf");
var pdfOpt = new PDFSaveOptions();
pdfOpt.alphaChannels = true;    // αチャンネルを保存
pdfOpt.annotations = false;  // 注釈なし
pdfOpt.downgradeColorProfile = false;   // カラープロファイルのダウングレードしない
pdfOpt.embedColorProfile = true;    // カラープロファイルは埋め込む
pdfOpt.embedFonts = false;  // フォントは埋め込まない
pdfOpt.encoding = PDFEncoding.JPEG; // エンコーディングはJPEG形式
pdfOpt.interpolation = false;   // 画像補完しない
pdfOpt.jpegQuality = 6; // JPEG画像データの品質
pdfOpt.layers = false;  // レイヤーは保持しない
pdfOpt.spotColors = false;  // スポットカラーは保存しない
pdfOpt.transparency = false;    // 透明部分は保持しない
pdfOpt.useOutlines = false; // テキストにアウトラインは使用しない
pdfOpt.vectorData = false;  // ベクトルデータは含めない
activeDocument.saveAs(fileObj, pdfOpt, true, Extension.LOWERCASE);</code></pre>
<p>　PDF形式でファイルが保存されます。</p>
<figure>
<figcaption>【図】PDF形式でファイルが保存される</figcaption>
<img src="images/00084.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-544">
<section>
<h2 id="calibre_link-340"><b>13-6　Photoshop形式で保存する</b></h2>
<p>　Photoshop形式で保存するにはPhotoshopSaveOptionsオブジェクトを生成し、必要なオプションを設定します。以下の「【表】指定できるオプション」に示すオプションを指定できます。</p>
<p>　Photoshop形式のオブションを設定したらdocumentオブジェクトのsaveAs()メソッドを使って保存します。saveAs()メソッドの最初のパラメーターに保存先情報を持つファイルオブジェクトを指定します。2番目のパラメーターには保存するオプション（PhotoshopSaveOptionsオブジェクト）を指定します。3番目のパラメーターには複製を保存するかどうかをフラグで指定します。trueなら複製を保存します。4番目のパラメーターはファイルの拡張子を大文字にするか、小文字にするかを指定します。「【表】拡張子の種類」に示す値を指定できます。</p>
<table>
<caption>【表】指定できるオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>alphaChannels</td>
  <td>αチャンネルを保存（true：保存する、false：保存しない）</td>
</tr>
<tr>
  <td>annotations</td>
  <td>注釈（true：あり、false：なし）</td>
</tr>
<tr>
  <td>embedColorProfile</td>
  <td>カラープロファイル（true：埋め込む、false：埋め込まない）</td>
</tr>
<tr>
  <td>layers</td>
  <td>レイヤーを保存（true：する、false：しない）</td>
</tr>
<tr>
  <td>spotColors</td>
  <td>スポットカラー（true：保存する、false：保存しない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】拡張子の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】Photoshop形式で保存する</p>
<pre><code>// Photoshop形式で保存する
var fileObj = new File("～/Desktop/sample.pdf");
var psdOpt = new PhotoshopSaveOptions();
psdOpt.alphaChannels = true;    // αチャンネルを保存
psdOpt.annotations = true;  // 注釈を保存
psdOpt.embedColorProfile = true;   // カラープロファイルは埋め込む
psdOpt.layers = true;   // レイヤーは保持する
psdOpt.spotColors = false;  // スポットカラーは保存しない
activeDocument.saveAs(fileObj, psdOpt, true, Extension.LOWERCASE);</code></pre>
<p>　Photoshop形式でファイルが保存されます。</p>
<figure>
<figcaption>【図】Photoshop形式でファイルが保存される</figcaption>
<img src="images/00502.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-693">
<section>
<h2 id="calibre_link-341"><b>13-7　Pixer形式で保存する</b></h2>
<p>　Pixer形式で保存するにはPixarSaveOptionsオブジェクトを生成し、必要なオプションを設定します。以下の「【表】指定できるオプション」に示すオプションを指定できます。</p>
<p>　Pixer形式のオブションを設定したらdocumentオブジェクトのsaveAs()メソッドを使って保存します。saveAs()メソッドの最初のパラメーターに保存先情報を持つファイルオブジェクトを指定します。2番目のパラメーターには保存するオプション（PixarSaveOptionsオブジェクト）を指定します。3番目のパラメーターには複製を保存するかどうかをフラグで指定します。trueなら複製を保存します。4番目のパラメーターはファイルの拡張子を大文字にするか、小文字にするかを指定します。「【表】拡張子の種類」に示す値を指定できます。</p>
<table>
<caption>【表】指定できるオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>alphaChannels</td>
  <td>αチャンネル（true：保存する、false：保存しない）</td>
</tr>
</tbody>
</table>
<p>
<br />
</p>
<table>
<caption>【表】拡張子の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】Pixer形式で保存する</p>
<pre><code>// Pixer形式で保存する
var fileObj = new File("～/Desktop/sample.pxr");
var pixarOpt = new PixarSaveOptions();
pixarOpt.alphaChannels = true;  // αチャンネルは保存
activeDocument.saveAs(fileObj, pixarOpt, true, Extension.LOWERCASE);</code></pre>
<p>　Pixer形式でファイルが保存されます。</p>
<figure>
<figcaption>【図】Pixer形式でファイルが保存される</figcaption>
<img src="images/00413.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-553">
<section>
<h2 id="calibre_link-342"><b>13-8　PNG形式で保存する</b></h2>
<p>　PNG形式で保存するにはPNGSaveOptionsオブジェクトを生成し、必要なオプションを設定します。以下の「【表】指定できるオプション」に示すオプションを指定できます。</p>
<p>　PNG形式のオブションを設定したらdocumentオブジェクトのsaveAs()メソッドを使って保存します。saveAs()メソッドの最初のパラメーターに保存先情報を持つファイルオブジェクトを指定します。2番目のパラメーターには保存するオプション（PNGSaveOptionsオブジェクト）を指定します。3番目のパラメーターには複製を保存するかどうかをフラグで指定します。trueなら複製を保存します。4番目のパラメーターはファイルの拡張子を大文字にするか、小文字にするかを指定します。「【表】拡張子の種類」に示す値を指定できます。</p>
<table>
<caption>【表】指定できるオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>compression</td>
  <td>圧縮（0～9）</td>
</tr>
<tr>
  <td>interlaced</td>
  <td>インターレース（true：あり、false：なし）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】拡張子の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】PNG形式で保存する</p>
<pre><code>// PNG形式で保存する
var fileObj = new File("～/Desktop/sample.png");
var pngOpt = new PNGSaveOptions();
pngOpt.compression = 5; // 圧縮5
pngOpt.interlaced = false;  // インターレースなし
activeDocument.saveAs(fileObj, pngOpt, true, Extension.LOWERCASE);</code></pre>
<p>　PNG形式でファイルが保存されます。</p>
<figure>
<figcaption>【図】PNG形式でファイルが保存される</figcaption>
<img src="images/00037.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-705">
<section>
<h2 id="calibre_link-343"><b>13-9　RAW形式で保存する</b></h2>
<p>　RAW形式（汎用フォーマット／生のピクセルデータ）で保存するにはRawSaveOptionsオブジェクトを生成し、必要なオプションを設定します。以下の「【表】指定できるオプション」に示すオプションを指定できます。Photoshopで保存する際に汎用フォーマットであるRAW形式には、いくつかオプションがありますがRawSaveOptionsではバイトデータの並びやヘッダーサイズなどを指定することはできません。バイトの並びは1ピクセル単位（R:G:B）で保存されます。</p>
<p>　RAW形式のオブションを設定したらdocumentオブジェクトのsaveAs()メソッドを使って保存します。saveAs()メソッドの最初のパラメーターに保存先情報を持つファイルオブジェクトを指定します。2番目のパラメーターには保存するオプション（RawSaveOptionsオブジェクト）を指定します。3番目のパラメーターには複製を保存するかどうかをフラグで指定します。trueなら複製を保存します。4番目のパラメーターはファイルの拡張子を大文字にするか、小文字にするかを指定します。「【表】拡張子の種類」に示す値を指定できます。</p>
<table>
<caption>【表】指定できるオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>alphaChannels</td>
  <td>αチャンネルを保存（true：保存する、false：保存しない）</td>
</tr>
<tr>
  <td>spotColors</td>
  <td>スポットカラー（true：保存する、false：保存しない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】拡張子の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】RAW形式で保存する</p>
<pre><code>// RAW形式で保存する
var fileObj = new File("～/Desktop/sample.raw");
var rawOpt = new RawSaveOptions();
rawOpt.alphaChannels = true;    // αチャンネルも含める
rawOpt.spotColors = false;  // スポットカラーは保存しない
activeDocument.saveAs(fileObj, rawOpt, true, Extension.LOWERCASE);</code></pre>
<p>　RAW形式／汎用フォーマットでファイルが保存されます。</p>
<figure>
<figcaption>【図】RAW形式／汎用フォーマットでファイルが保存される</figcaption>
<img src="images/00454.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-498">
<section>
<h2 id="calibre_link-344"><b>13-10　Targa形式で保存する</b></h2>
<p>　Targa形式で保存するにはTargaSaveOptionsオブジェクトを生成し、必要なオプションを設定します。以下の「【表】指定できるオプション」に示すオプションを指定できます。</p>
<p>　Targa形式のオブションを設定したらdocumentオブジェクトのsaveAs()メソッドを使って保存します。saveAs()メソッドの最初のパラメーターに保存先情報を持つファイルオブジェクトを指定します。2番目のパラメーターには保存するオプション（TargaSaveOptionsオブジェクト）を指定します。3番目のパラメーターには複製を保存するかどうかをフラグで指定します。trueなら複製を保存します。4番目のパラメーターはファイルの拡張子を大文字にするか、小文字にするかを指定します。「【表】拡張子の種類」に示す値を指定できます。</p>
<table>
<caption>【表】指定できるオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>alphaChannels</td>
  <td>αチャンネルを保存（true：保存する、false：保存しない）</td>
</tr>
<tr>
  <td>resolution</td>
  <td>色深度（【表】色深度を参照）</td>
</tr>
<tr>
  <td>rleCompression</td>
  <td>RLE（ランレングス）圧縮（true：する、false：しない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】色深度</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>TargaBitsPerPixels.SIXTEEN</td>
  <td>16ビットカラー</td>
</tr>
<tr>
  <td>TargaBitsPerPixels.TWENTYFOUR</td>
  <td>24ビットカラー</td>
</tr>
<tr>
  <td>TargaBitsPerPixels.THIRTYTWO</td>
  <td>32ビットカラー</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】拡張子の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】Targa形式で保存する</p>
<pre><code>// Targa形式で保存する
var fileObj = new File("～/Desktop/sample.pdf");
var tgaOpt = new TargaSaveOptions();
tgaOpt.alphaChannels = true;    // αチャンネルは保存
tgaOpt.resolution = TargaBitsPerPixels.THIRTYTWO;   // 32ビットカラー
tgaOpt.rleCompression = false;  // RLE（ランレングス圧縮）しない
activeDocument.saveAs(fileObj, tgaOpt, true, Extension.LOWERCASE);</code></pre>
<p>　PDF形式でファイルが保存されます。</p>
<figure>
<figcaption>【図】PDF形式でファイルが保存される</figcaption>
<img src="images/00227.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-653">
<section>
<h2 id="calibre_link-345"><b>13-11　TIFF形式で保存する</b></h2>
<p>　TIFF形式で保存するにはTiffSaveOptionsオブジェクトを生成し、必要なオプションを設定します。以下の「【表】指定できるオプション」に示すオプションを指定できます。</p>
<p>　TIFF形式のオブションを設定したらdocumentオブジェクトのsaveAs()メソッドを使って保存します。saveAs()メソッドの最初のパラメーターに保存先情報を持つファイルオブジェクトを指定します。2番目のパラメーターには保存するオプション（TiffSaveOptionsオブジェクト）を指定します。3番目のパラメーターには複製を保存するかどうかをフラグで指定します。trueなら複製を保存します。4番目のパラメーターはファイルの拡張子を大文字にするか、小文字にするかを指定します。「【表】拡張子の種類」に示す値を指定できます。</p>
<table>
<caption>【表】指定できるオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>alphaChannels</td>
  <td>αチャンネルを保存（true：保存する、false：保存しない）</td>
</tr>
<tr>
  <td>annotations</td>
  <td>注釈を保存（true：する、false：しない）</td>
</tr>
<tr>
  <td>byteOrder</td>
  <td>バイト順序（【表】バイト順序／バイトオーダーを参照）</td>
</tr>
<tr>
  <td>embedColorProfile</td>
  <td>カラープロファイル（true：埋め込む、false：埋め込まない）</td>
</tr>
<tr>
  <td>imageCompression</td>
  <td>圧縮形式（【表】圧縮形式-1を参照）</td>
</tr>
<tr>
  <td>jpegQuality</td>
  <td>JPEG画質（0～12：0が低画質、12が高画質）</td>
</tr>
<tr>
  <td>layerCompression</td>
  <td>圧縮形式（【表】圧縮形式-2を参照）</td>
</tr>
<tr>
  <td>layers</td>
  <td>レイヤーを保存（true：する、false：しない）</td>
</tr>
<tr>
  <td>saveImagePyramid</td>
  <td>画像ピラミッドを保存（true：する、false：しない）</td>
</tr>
<tr>
  <td>spotColors</td>
  <td>スポットカラー（true：保存する、false：保存しない）</td>
</tr>
<tr>
  <td>transparency</td>
  <td>透明情報（true：保存する、false：保存しない）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】バイト順序／バイトオーダー</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>ByteOrder.IBM</td>
  <td>IBM PC (Low、High順)</td>
</tr>
<tr>
  <td>ByteOrder.MACOS</td>
  <td>Macintosh (High、Low順)</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】圧縮形式-1</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>TIFFEncoding.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>TIFFEncoding.JPEG</td>
  <td>JPEG形式</td>
</tr>
<tr>
  <td>TIFFEncoding.TIFFLZW</td>
  <td>LZW形式</td>
</tr>
<tr>
  <td>TIFFEncoding.TIFFZIP</td>
  <td>ZIP形式</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】圧縮形式-2</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>LayerCompression.RLE</td>
  <td>RLE圧縮</td>
</tr>
<tr>
  <td>LayerCompression.ZIP</td>
  <td>ZIP圧縮</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】拡張子の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>Extension.NONE</td>
  <td>なし</td>
</tr>
<tr>
  <td>Extension.LOWERCASE</td>
  <td>小文字</td>
</tr>
<tr>
  <td>Extension.UPPERCASE</td>
  <td>大文字</td>
</tr>
</tbody>
</table>
<p>【sample】TIFF形式で保存する</p>
<pre><code>// TIFF形式で保存する
var fileObj = new File("～/Desktop/sample.tiff");
var tiffOpt = new TiffSaveOptions();
tiffOpt.alphaChannels = true;   // αチャンネルは保存
tiffOpt.annotations = false; // 注釈なし
tiffOpt.byteOrder = ByteOrder.IBM;    // バイトオーダー順序はx86(Low, High順)
tiffOpt.embedColorProfile = false;  // カラープロファイルは埋め込まない
tiffOpt.imageCompression = TIFFEncoding.NONE;   // エンコードなし
tiffOpt.jpegQuality = 6;    // JPEG品質
tiffOpt.layerCompression = LayerCompression.RLE;    // ランレングス圧縮
tiffOpt.layers = true;  //  レイヤーは保持
tiffOpt.saveImagePyramid = false;   // 画像ピラミッドは保存しない
tiffOpt.spotColors = false; // スポットカラーなし
tiffOpt.transparency = false;   // 透明なし
activeDocument.saveAs(fileObj, tiffOpt, true, Extension.LOWERCASE);</code></pre>
<p>　TIFF形式でファイルが保存されます。</p>
<figure>
<figcaption>【図】TIFF形式でファイルが保存される</figcaption>
<img src="images/00000.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-594">
<section>
<div>
<h1 id="calibre_link-346"><b>第14章　ファイル処理</b></h1>
</div>
</section>
</div>
<div id="calibre_link-596">
<section>
<h2 id="calibre_link-347"><b>14-1　ファイルを開く</b></h2>
<p>　ファイルを開くにはappオブジェクトのopen()メソッドを使います。最初のパラメーターには開きたいファイルオブジェクトを指定します。2番目のパラメーターは以下の表に示すファイルの種類、3番目のパラメーターは開くファイルをスマートオブジェクトにするかどうかを指定します。trueならスマートオブジェクトになります。2番目と3番目のパラメーターは省略することができます。なお、開くファイルの種類と2番目、3番目に指定したパラメーターが正しくない場合はエラーになります。</p>
<table>
<caption>【表】ファイルの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>形式</span>
  </td>
</tr>
<tr>
  <td>OpenDocumentType.ALIASPIX</td>
  <td>Alias Pix形式</td>
</tr>
<tr>
  <td>OpenDocumentType.BMP</td>
  <td> BMP形式</td>
</tr>
<tr>
  <td>OpenDocumentType.CAMERARAW</td>
  <td>Camera Raw形式</td>
</tr>
<tr>
  <td>OpenDocumentType.COMPUSERVEGIF</td>
  <td>Compuserve GIF形式</td>
</tr>
<tr>
  <td>OpenDocumentType.DICOM</td>
  <td>DICOM形式</td>
</tr>
<tr>
  <td>OpenDocumentType.ELECTRICIMAGE</td>
  <td>Electric Image形式</td>
</tr>
<tr>
  <td>OpenDocumentType.EPS</td>
  <td>EPS形式</td>
</tr>
<tr>
  <td>OpenDocumentType.EPSPICTPREVIEW</td>
  <td>EPS形式（PICTプレビュー）</td>
</tr>
<tr>
  <td>OpenDocumentType.EPSTIFFPREVIEW</td>
  <td>EPS形式（TIFFプレビュー）</td>
</tr>
<tr>
  <td>OpenDocumentType.FILMSTRIP</td>
  <td>フィルムストリップ形式</td>
</tr>
<tr>
  <td>OpenDocumentType.JPEG</td>
  <td>JPEG形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PCX</td>
  <td>PCX形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PDF</td>
  <td>PDF形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PHOTOCD</td>
  <td>PhotoCD 形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PHOTOSHOP</td>
  <td>Photoshop形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PHOTOSHOPDCS_1</td>
  <td>Photoshop DCS 1.0形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PHOTOSHOPDCS_2</td>
  <td>Photoshop DCS 2.0形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PHOTOSHOPEPS</td>
  <td>Photoshop EPS形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PHOTOSHOPPDF</td>
  <td>Photoshop PDF形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PICTFILEFORMAT</td>
  <td>PICTファイル形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PICTRESOURCEFORMAT</td>
  <td>PICTリソース形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PIXAR</td>
  <td>Pixar形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PNG</td>
  <td>PNG形式</td>
</tr>
<tr>
  <td>OpenDocumentType.PORTABLEBITMAP</td>
  <td>Portable bit Map形式</td>
</tr>
<tr>
  <td>OpenDocumentType.RAW</td>
  <td>汎用フォーマット形式</td>
</tr>
<tr>
  <td>OpenDocumentType.SCITEXCT</td>
  <td>Scitex CT形式</td>
</tr>
<tr>
  <td>OpenDocumentType.SGIRGB</td>
  <td>SGI形式</td>
</tr>
<tr>
  <td>OpenDocumentType.SOFTIMAGE</td>
  <td>SoftImage形式</td>
</tr>
<tr>
  <td>OpenDocumentType.TARGA</td>
  <td>Targa形式</td>
</tr>
<tr>
  <td>OpenDocumentType.TIFF</td>
  <td>TIFF形式</td>
</tr>
<tr>
  <td>OpenDocumentType.WAVEFRONTRLA</td>
  <td>Wavefront形式</td>
</tr>
<tr>
  <td>OpenDocumentType.WIRELESSBITMAP</td>
  <td>Wireless Bitmap形式</td>
</tr>
</tbody>
</table>
<p>【sample】ファイルを開く</p>
<pre><code>// ファイルを開く
var fileList = app.openDialog(); // Photoshopのオープンダイアログ
for(var i=0; i&lt;fileList.length; i++){   // 選択されたファイル数だけ開く
    open(fileList[i], OpenDocumentType.JPEG, false);
}</code></pre>
<p>　Photoshopのファイル選択ダイアログが表示されます。ここでファイルを選択します。複数選択することもできます。</p>
<figure>
<figcaption>【図】Photoshopのファイル選択ダイアログが表示される</figcaption>
<img src="images/00410.jpeg" />
</figure>
<p>　選択したファイルが開かれます。</p>
<figure>
<figcaption>【図】選択したファイルが開かれる</figcaption>
<img src="images/00182.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-32">
<section>
<h2 id="calibre_link-348"><b>14-2　PDFファイルを開く</b></h2>
<p>　PDFファイルを開くにはPDFOpenOptionsオブジェクトを利用します。PDFOpenOptionsオブジェクトに必要なオプションを設定します。以下「【表】設定可能なオプション」に示すオプションを指定できます。open()メソッドの最初のパラメーターに開くファイルオブジェクトを指定し、2番目のパラメーターにPDFOpenOptionsオブジェクトを指定します。</p>
<table>
<caption>【表】設定可能なオプション</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>antiAlias</td>
  <td>アンチエイリアス（true：オン、false：オフ）</td>
</tr>
<tr>
  <td>bitsPerChannel</td>
  <td>色深度（【表】色深度を参照）</td>
</tr>
<tr>
  <td>constrainProportions</td>
  <td>縦横比の固定（true：固定する、false：固定しない）※CC 2014以降は非推奨</td>
</tr>
<tr>
  <td>cropPage</td>
  <td>トリミング（切り抜き）指定（【表】トリミング（切り抜き）の種類を参照）</td>
</tr>
<tr>
  <td>height</td>
  <td>縦幅。UnitValue形式で指定。※CC 2014以降は非推奨</td>
</tr>
<tr>
  <td>mode</td>
  <td>ドキュメントモード（【表】ドキュメントモードを参照）</td>
</tr>
<tr>
  <td>name</td>
  <td>名前</td>
</tr>
<tr>
  <td>page</td>
  <td>開くページ数</td>
</tr>
<tr>
  <td>resolution</td>
  <td>解像度</td>
</tr>
<tr>
  <td>suppressWarnings</td>
  <td>警告表示（true：する、false：しない）</td>
</tr>
<tr>
  <td>usePageNumber</td>
  <td>pageでページ番号を指定するかどうか。（true：する、false：しない）</td>
</tr>
<tr>
  <td>height</td>
  <td>横幅。UnitValue形式で指定。※CC 2014以降は非推奨</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】色深度</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>BitsPerChannelType.ONE</td>
  <td>1ビット（白黒）</td>
</tr>
<tr>
  <td>BitsPerChannelType.EIGHT</td>
  <td>8ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.SIXTEEN</td>
  <td>16ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.THIRTYTWO</td>
  <td>32ビット</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】トリミング（切り抜き）の種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>CropToType.ARTBOX</td>
  <td>アートサイズ</td>
</tr>
<tr>
  <td>CropToType.BLEEDBOX</td>
  <td>裁ち落としサイズ</td>
</tr>
<tr>
  <td>CropToType.BOUNDINGBOX</td>
  <td>バウンディングボックス</td>
</tr>
<tr>
  <td>CropToType.CROPBOX</td>
  <td>トリミングサイズ</td>
</tr>
<tr>
  <td>CropToType.MEDIABOX</td>
  <td>メディアサイズ</td>
</tr>
<tr>
  <td>CropToType.TRIMBOX</td>
  <td>仕上がりサイズ</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】ドキュメントモード</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>OpenDocumentMode.CMYK</td>
  <td> CMYKモード</td>
</tr>
<tr>
  <td>OpenDocumentMode.GRAYSCALE</td>
  <td>グレースケール</td>
</tr>
<tr>
  <td>OpenDocumentMode.LAB</td>
  <td>Labカラー</td>
</tr>
<tr>
  <td>OpenDocumentMode.RGB</td>
  <td>RGBカラー</td>
</tr>
</tbody>
</table>
<p>【sample】PDFファイルを開く</p>
<pre><code>// PDFファイルを開く
var fileObj = File.openDialog("PDFを選択してください");
if (fileObj != null){
    var pdfOpt = new PDFOpenOptions();
    pdfOpt.antiAlias = true;    // アンチエイリアスON
    pdfOpt.constrainProportions = false;    // 縦横比は固定しない
    pdfOpt.width = UnitValue(595.58, "pt"); // 595.58pt
    pdfOpt.height = UnitValue(841.89, "pt");    // 841.89pt
    pdfOpt.mode = OpenDocumentMode.RGB; // RGBモード
    pdfOpt.page = 3;    //  3ページ目
    pdfOpt.resolution = 300; // 300dpi
    open(fileObj, pdfOpt);
}</code></pre>
<p>　ファイル選択ダイアログが表示されるのでPDFファイルを指定します。</p>
<figure>
<figcaption>【図】ファイル選択ダイアログでPDFファイルを指定する</figcaption>
<img src="images/00591.jpeg" />
</figure>
<p>　指定したページが指定したサイズと解像度で開かれます。</p>
<figure>
<figcaption>【図】指定したページが指定したサイズと解像度で開かれる</figcaption>
<img src="images/00362.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-537">
<section>
<h2 id="calibre_link-349"><b>14-3　EPSファイルを開く</b></h2>
<p>　EPSファイルを開くにはEPSOpenOptionsオブジェクトを利用します。EPSOpenOptionsオブジェクトに必要なオプションを設定します。以下の「【表】設定可能なオプション」に示すオプションを指定できます。open()メソッドの最初のパラメーターに開くファイルオブジェクトを指定し、2番目のパラメーターにEPSOpenOptionsオブジェクトを指定します。</p>
<table>
<caption>【表】設定可能なオプション</caption>
<tbody>
<tr>
  <td>
    <span>オプション</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>antiAlias</td>
  <td>アンチエイリアス（true：オン、false：オフ）</td>
</tr>
<tr>
  <td>constrainProportions</td>
  <td>縦横比の固定（true：固定する、false：固定しない）</td>
</tr>
<tr>
  <td>height</td>
  <td>縦幅。UnitValue形式で指定。</td>
</tr>
<tr>
  <td>mode</td>
  <td>ドキュメントモード（【表】ドキュメントモードを参照）</td>
</tr>
<tr>
  <td>resolution</td>
  <td>解像度</td>
</tr>
<tr>
  <td>height</td>
  <td>横幅。UnitValue形式で指定。</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】ドキュメントモード</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>OpenDocumentMode.CMYK</td>
  <td> CMYKモード</td>
</tr>
<tr>
  <td>OpenDocumentMode.GRAYSCALE</td>
  <td>グレースケール</td>
</tr>
<tr>
  <td>OpenDocumentMode.LAB</td>
  <td>Labカラー</td>
</tr>
<tr>
  <td>OpenDocumentMode.RGB</td>
  <td>RGBカラー</td>
</tr>
</tbody>
</table>
<p>【sample】EPSファイルを開く</p>
<pre><code>// EPSファイルを開く
var fileObj = File.openDialog("EPSファイルを選択してください");
if (fileObj != null){
    var epsOpt = new EPSOpenOptions();
    epsOpt.antiAlias = true;    // アンチエイリアスON
    epsOpt.constrainProportions = false;    // 縦横比は固定しない
    epsOpt.width = UnitValue(595.58, "pt"); // 595.58pt
    epsOpt.height = UnitValue(841.89, "pt");    // 841.89pt
    epsOpt.mode = OpenDocumentMode.RGB; // RGBモード
    epsOpt.resolution = 96; // 96dpi
    open(fileObj, epsOpt);
}</code></pre>
<p>　ファイル選択ダイアログが表示されるのでEPSファイルを指定します。</p>
<figure>
<figcaption>【図】ファイル選択ダイアログでEPSファイルを指定する</figcaption>
<img src="images/00373.jpeg" />
</figure>
<p>　EPSファイルが指定したサイズと解像度、カラーモードで開かれます。</p>
<figure>
<figcaption>【図】EPSファイルが指定したサイズと解像度、カラーモードで開かれる</figcaption>
<img src="images/00143.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-51">
<section>
<h2 id="calibre_link-350"><b>14-4　RAW（汎用）形式のファイルを開く</b></h2>
<p>　RAW（汎用）形式のファイルを開くにはRawFormatOpenOptionsオブジェクトを利用します。RawFormatOpenOptionsオブジェクトに必要な情報を設定します。「【表】設定可能なオプション」に示すオプションを指定できます。open()メソッドの最初のパラメーターに開くファイルオブジェクトを指定し、2番目のパラメーターにRawFormatOpenOptionsオブジェクトを指定します。</p>
<table>
<caption>【表】設定可能なオプション</caption>
<tbody>
<tr>
  <td>
    <span>オプション</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>bitsPerChannel</td>
  <td>色深度（【表】色深度を参照）</td>
</tr>
<tr>
  <td>byteOrder</td>
  <td>バイト順序／バイトオーダー（【表】バイト順序／バイトオーダーを参照）</td>
</tr>
<tr>
  <td>channelNumber</td>
  <td>チャンネル番号（1～56）</td>
</tr>
<tr>
  <td>headerSize</td>
  <td>ヘッダーサイズ（0～1919999）</td>
</tr>
<tr>
  <td>height</td>
  <td>縦幅。ピクセル単位で指定。</td>
</tr>
<tr>
  <td>interleaveChannels</td>
  <td>インターリーブかどうか（true：インターリーブ、false：インターリーブでない）</td>
</tr>
<tr>
  <td>retainHeader</td>
  <td>保存時にヘッダーを固定するか（true：固定する、false：しない）</td>
</tr>
<tr>
  <td>width</td>
  <td>横幅。ピクセル単位で指定。</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】色深度</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>BitsPerChannelType.EIGHT</td>
  <td>8ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.SIXTEEN</td>
  <td>16ビット</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】バイト順序／バイトオーダー</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>ByteOrder.IBM</td>
  <td>Low、Highの順序</td>
</tr>
<tr>
  <td>ByteOrder.MACOS</td>
  <td>High、Lowの順序</td>
</tr>
</tbody>
</table>
<p>【sample】RAW（汎用）形式のファイルを開く</p>
<pre><code>// RAW（汎用）形式のファイルを開く
var fileObj = File.openDialog("RAW（汎用）ファイルを選択してください");
if (fileObj != null){
    var rawOpt = new RawFormatOpenOptions();
    rawOpt.bitsPerChannel = 8; // 8ビット
    rawOpt.channelNumber = 3;   // チャンネル数は3
    rawOpt.headerSize = 0;  // ヘッダーサイズは0バイト
    rawOpt.width = 320; // 横のピクセル数
    rawOpt.height = 213;    // 縦のピクセル数
    rawOpt.interleaveChannels = true;  // インターリーブ
    rawOpt.retainHeader = false;    // ヘッダーは固定しない
    open(fileObj, rawOpt);
}</code></pre>
<p>　ファイル選択ダイアログが表示されるのでRAW（汎用）形式のファイルを指定します。</p>
<figure>
<figcaption>【図】ファイル選択ダイアログでRAW（汎用）形式のファイルを指定する</figcaption>
<img src="images/00014.jpeg" />
</figure>
<p>　RAW（汎用）形式のファイルが開かれます。</p>
<figure>
<figcaption>【図】RAW（汎用）形式のファイルが開かれる</figcaption>
<img src="images/00329.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-441">
<section>
<h2 id="calibre_link-351"><b>14-5　カメラRAWファイルを開く</b></h2>
<p>　カメラRAWファイルを開くにはCameraRAWOpenOptionsオブジェクトを利用します。CameraRAWOpenOptionsオブジェクトに必要なオプションを設定します。以下の「【表】設定可能なオプション」に示すオプションを指定できます。open()メソッドの最初のパラメーターに開くファイルオブジェクトを指定し、2番目のパラメーターにCameraRAWOpenOptionsオブジェクトを指定します。</p>
<table>
<caption>【表】設定可能なオプション</caption>
<tbody>
<tr>
  <td>
    <span>オプション</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>bitsPerChannel</td>
  <td>色深度（【表】色深度を参照）</td>
</tr>
<tr>
  <td>blueHue</td>
  <td>青成分の色相（-100～100）</td>
</tr>
<tr>
  <td>blueSaturation</td>
  <td>青成分の彩度（-100～100）</td>
</tr>
<tr>
  <td>brightness</td>
  <td>輝度（0～150）</td>
</tr>
<tr>
  <td>chromaticAberrationBY</td>
  <td>青色～黄色の色収差（-100～100）</td>
</tr>
<tr>
  <td>chromaticAberrationRC</td>
  <td>赤色～水色の色収差（-100～100）</td>
</tr>
<tr>
  <td>colorNoiseReduction</td>
  <td>ノイズ除去（０～100）</td>
</tr>
<tr>
  <td>colorSpace</td>
  <td>色空間（【表】色空間を参照）</td>
</tr>
<tr>
  <td>contrast</td>
  <td>コントラスト（-50～100）</td>
</tr>
<tr>
  <td>exposure</td>
  <td>露出（-4.0～4.0）</td>
</tr>
<tr>
  <td>greenHue</td>
  <td>緑成分の色相（-100～100）</td>
</tr>
<tr>
  <td>greenSaturation</td>
  <td>緑成分の彩度（-100～100）</td>
</tr>
<tr>
  <td>luminanceSmoothing</td>
  <td>明瞭度</td>
</tr>
<tr>
  <td>redHue</td>
  <td>赤成分の色相（-100～100）</td>
</tr>
<tr>
  <td>redSaturation</td>
  <td>赤成分の彩度（-100～100）</td>
</tr>
<tr>
  <td>resolution</td>
  <td>解像度（1～999）</td>
</tr>
<tr>
  <td>saturation</td>
  <td>彩度（-100～100）</td>
</tr>
<tr>
  <td>settings</td>
  <td>カメラRAW設定（【表】カメラRAW設定を参照）</td>
</tr>
<tr>
  <td>shadows</td>
  <td>シャドウ（0～100）</td>
</tr>
<tr>
  <td>shadowTint</td>
  <td>シャドウの色合い（-100～100）</td>
</tr>
<tr>
  <td>sharpness</td>
  <td>鮮明度／シャープネス（0～100）</td>
</tr>
<tr>
  <td>size</td>
  <td>画像サイズ（【表】画像サイズを参照）</td>
</tr>
<tr>
  <td>temperature</td>
  <td>色温度（2000～50000）</td>
</tr>
<tr>
  <td>tint</td>
  <td>色合い（-150～150）</td>
</tr>
<tr>
  <td>vignettingAmount</td>
  <td>ビネット量（-100～100）</td>
</tr>
<tr>
  <td>vignettingMidpoint</td>
  <td>ビネット中央点（-100～100）</td>
</tr>
<tr>
  <td>whiteBalance</td>
  <td>ホワイトバランス（【表】ホワイトバランスを参照）</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】色深度</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>BitsPerChannelType.ONE</td>
  <td>1ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.EIGHT</td>
  <td>8ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.SIXTEEN</td>
  <td>16ビット</td>
</tr>
<tr>
  <td>BitsPerChannelType.THIRTYTWO</td>
  <td>32ビット</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】色空間</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>ColorSpaceType.ADOBERGB</td>
  <td>Adobe RGB</td>
</tr>
<tr>
  <td>ColorSpaceType.COLORMATCHRGB</td>
  <td>Color Match RGB</td>
</tr>
<tr>
  <td>ColorSpaceType.PROPHOTORGB</td>
  <td>Pro Photo RGB</td>
</tr>
<tr>
  <td>ColorSpaceType.SRGB</td>
  <td>sRGB</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】カメラRAW設定</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>CameraRAWSettingsType.CAMERA</td>
  <td>カメラ</td>
</tr>
<tr>
  <td>CameraRAWSettingsType.CUSTOM</td>
  <td>カスタム</td>
</tr>
<tr>
  <td>CameraRAWSettingsType.SELECTEDIMAGE</td>
  <td>イメージ</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】画像サイズ</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>CameraRAWSize.EXTRALARGE</td>
  <td>5120 x 4096</td>
</tr>
<tr>
  <td>CameraRAWSize.LARGE</td>
  <td>4096 x 2731</td>
</tr>
<tr>
  <td>CameraRAWSize.MAXIMUM</td>
  <td>6144 X 4096</td>
</tr>
<tr>
  <td>CameraRAWSize.MEDIUM</td>
  <td>3072 x 2048</td>
</tr>
<tr>
  <td>CameraRAWSize.MINIMUM</td>
  <td>1536 x 1024</td>
</tr>
<tr>
  <td>CameraRAWSize.SMALL</td>
  <td>2048 x 1365</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】ホワイトバランス</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>WhiteBalanceType.ASSHOT</td>
  <td>撮影時の設定</td>
</tr>
<tr>
  <td>WhiteBalanceType.AUTO</td>
  <td>自動</td>
</tr>
<tr>
  <td>WhiteBalanceType.CLOUDY</td>
  <td>曇天</td>
</tr>
<tr>
  <td>WhiteBalanceType.CUSTOM</td>
  <td>カスタム</td>
</tr>
<tr>
  <td>WhiteBalanceType.DAYLIGHT</td>
  <td>晴天</td>
</tr>
<tr>
  <td>WhiteBalanceType.FLASH</td>
  <td>フラッシュ</td>
</tr>
<tr>
  <td>WhiteBalanceType.FLUORESCENT</td>
  <td>蛍光灯</td>
</tr>
<tr>
  <td>WhiteBalanceType.SHADE</td>
  <td>日陰</td>
</tr>
<tr>
  <td>WhiteBalanceType.TUNGSTEN</td>
  <td>タングステン-白熱灯</td>
</tr>
</tbody>
</table>
<p>【sample】カメラRAWファイルを開く</p>
<pre><code>// カメラRAWファイルを開く
var fileObj = File.openDialog("カメラRAWファイルを選択してください");
if (fileObj != null){
    var rawOpt = new CameraRAWOpenOptions();
    rawOpt.bitsPerChannel = BitsPerChannelType.SIXTEEN; // 16ビット
    rawOpt.blueHue = 20;    // 青の色相の値
    rawOpt.blueSaturation = -50;    // 青の彩度の値
    rawOpt.brightness = 10;    // 輝度
    rawOpt.contrast = 80;   // コントラスト
    rawOpt.whiteBalance = WhiteBalanceType.AUTO;    // ホワイトバランスは自動
    open(fileObj, rawOpt);
}</code></pre>
<p>　ファイル選択ダイアログが表示されるのでカメラRAWファイルを指定します。</p>
<figure>
<figcaption>【図】ファイル選択ダイアログでカメラRAWファイルを指定する</figcaption>
<img src="images/00289.jpeg" />
</figure>
<p>　カメラRAWファイルが指定した値に従って修正され開かれます。</p>
<figure>
<figcaption>【図】カメラRAWファイルが指定した値に従って修正され開かれる</figcaption>
<img src="images/00509.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-484">
<section>
<h2 id="calibre_link-352"><b>14-6　最近使用したファイルの数を求める</b></h2>
<p>　最近使用したファイルの数を求めるにはappオブジェクトのrecentFilesプロパティを参照します。recentFilesプロパティには使用したファイルの情報が配列として格納されています。配列の要素がファイルオブジェクトになっています。配列要素1つが最近使用したファイル1つに対応しています。配列なのでlengthプロパティを参照すれば最近使用したファイルの数を求めることができます。</p>
<p>【sample】最近使用したファイルの数を求める</p>
<pre><code>// 最近使用したファイルの数を求める
var fileList = app.recentFiles;
var fName = "";
if (fileList.length &gt; 0){
    fName = fileList[0].name;
}
alert(fileList.length+"\n"+fName);</code></pre>
<p>　アラートダイアログに最近使用したファイルの数が表示されます。また、1つでも使用したファイルがあれば、そのファイル名も表示されます。</p>
<figure>
<figcaption>【図】アラートダイアログに最近使用したファイルの数が表示される</figcaption>
<img src="images/00281.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-525">
<section>
<h2 id="calibre_link-353"><b>14-7　現在実行しているスクリプトのファイル名を求める</b></h2>
<p>　現在実行しているスクリプトのファイル名を求めるには$オブジェクトのfileNameプロパティを参照します。fileNameプロパティには現在実行しているスクリプトのファイルオブジェクトが格納されています。</p>
<p>【sample】現在実行しているスクリプトのファイル名を求める</p>
<pre><code>// 実行されているスクリプトのファイル名を求める
var currentScriptFile = $.fileName;
alert(File.decode(currentScriptFile));</code></pre>
<p>　アラートダイアログに現在実行しているスクリプトファイル名が表示されます。なお、一度も保存していない状態で実行された場合は(Script 2)のように一時的なファイル名が表示されます。</p>
<figure>
<figcaption>【図】アラートダイアログに現在実行しているスクリプトファイル名が表示される</figcaption>
<img src="images/00044.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-515">
<section>
<h2 id="calibre_link-354"><b>14-8　フォルダにある画像ファイルをまとめて開く</b></h2>
<p>　フォルダにある画像ファイルをまとめて開くにはFolderオブジェクトのgetFiles()メソッドを利用します。getFiles()メソッドはパラメーターで指定した拡張子を持つファイルのみ抽出（ピックアップ）することができます。例えばgetFiles("*.psd")とするとPhotoshop形式のFileオブジェクトだけがフォルダから読み出され配列に格納されます。以下の表に代表的なファイル形式の指定方法を示します。（実際はgetFiles()メソッドのパラメーターはワイルドカードの指定になります）なお、getFiles()メソッドは複数の画像形式をまとめて指定することはできません。また、サブフォルダ内にあるファイルは取得できません。同じ階層にあるファイルだけが対象になります。</p>
<p>　getFiles()メソッドにより取得したFileオブジェクトは配列に格納されているので1つずつ読み出し、open()メソッドを使って開きます。手動操作もしくは半自動処理の場合はよいのですが、完全自動化する場合にはサンプルのようにtry...catchを使ってエラーを回避するようにします。完全自動化処理を行う場合は、これでもファイル破損時には回避できないことがあります。その場合はダイアログなどが表示されるため強制的にダイアログのボタンを押す（リターンキーを押す）処理を外部から別途行う必要があります。</p>
<table>
<caption>【表】ファイル形式</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>getFiles()</td>
  <td>全てのファイル（画像、テキストなど問わない）</td>
</tr>
<tr>
  <td>getFiles("*.psd")</td>
  <td>Photoshop形式</td>
</tr>
<tr>
  <td>getFiles("*.jpg")</td>
  <td>JPEG形式。getFiles("*.jpeg")という指定もあり。</td>
</tr>
<tr>
  <td>getFiles("*.eps")</td>
  <td>EPS形式</td>
</tr>
<tr>
  <td>getFiles("*.gif")</td>
  <td>GIF形式</td>
</tr>
<tr>
  <td>getFiles("*.tiff")</td>
  <td>TIFF形式getFiles("*.tif")という指定もあり。</td>
</tr>
<tr>
  <td>getFiles("*.png")</td>
  <td>PNG形式</td>
</tr>
<tr>
  <td>getFiles("*.pdf")</td>
  <td>PDF形式</td>
</tr>
<tr>
  <td>getFiles("*.tga")</td>
  <td>Targa形式</td>
</tr>
<tr>
  <td>getFiles("*.bmp")</td>
  <td>BMP形式</td>
</tr>
<tr>
  <td>getFiles("*.pxr")</td>
  <td>Pixer形式</td>
</tr>
</tbody>
</table>
<p>【sample】フォルダにある画像ファイルをまとめて開く</p>
<pre><code>// フォルダにある画像ファイルをまとめて開く
var folderObj = Folder.selectDialog("画像ファイルがあるフォルダを選択してください");
var fileList = folderObj.getFiles("*.psd"); // Photoshop形式ファイル一覧を取得する
for(var i=0; i&lt;fileList.length; i++){
    try{
        app.open(fileList[i]);  // ファイルを開く
    }catch(e){}
}</code></pre>
<p>　フォルダ選択ダイアログが表示されるのでPhotoshop形式のファイルがあるフォルダを選択します。</p>
<figure>
<figcaption>【図】フォルダ選択ダイアログでPhotoshop形式のファイルがあるフォルダを選択する</figcaption>
<img src="images/00460.jpeg" />
</figure>
<p>　指定したフォルダにある同じ階層のPhotoshop形式のファイルがまとめて開かれます。</p>
<figure>
<figcaption>【図】指定したフォルダにある同じ階層のPhotoshop形式のファイルがまとめて開かれる</figcaption>
<img src="images/00235.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-18">
<section>
<h2 id="calibre_link-355"><b>14-9　フォルダにある異なる形式の画像ファイルをまとめて開く</b></h2>
<p>　フォルダにある異なる形式の画像ファイルをまとめて開くにはFolderオブジェクトのgetFiles()メソッドを利用します。getFiles()メソッドのパラメーターに取得したい画像形式の文字列（ワイルドカードの指定。【表】ファイル形式を参照）を指定します。ただし、getFiles()メソッドは1つの形式しか指定できないため配列オブジェクトのconcat()メソッドを利用します。[].concat(getFiles("*.psd"), getFiles("*.jpg")]とするとPhotoshop形式とJPEG形式のFileオブジェクトが配列として返されます。</p>
<p>　あとは、配列の数だけFileオブジェクトをopen()メソッドのパラメーターに指定すると、異なる形式の画像ファイルをまとめて開くことができます。</p>
<table>
<caption>【表】ファイル形式</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>getFiles()</td>
  <td>全てのファイル（画像、テキストなど問わない）</td>
</tr>
<tr>
  <td>getFiles("*.psd")</td>
  <td>Photoshop形式</td>
</tr>
<tr>
  <td>getFiles("*.jpg")</td>
  <td>JPEG形式。getFiles("*.jpeg")という指定もあり。</td>
</tr>
<tr>
  <td>getFiles("*.eps")</td>
  <td>EPS形式</td>
</tr>
<tr>
  <td>getFiles("*.gif")</td>
  <td>GIF形式</td>
</tr>
<tr>
  <td>getFiles("*.tiff")</td>
  <td>TIFF形式。getFiles("*.tif")という指定もあり。</td>
</tr>
<tr>
  <td>getFiles("*.png")</td>
  <td>PNG形式</td>
</tr>
<tr>
  <td>getFiles("*.pdf")</td>
  <td>PDF形式</td>
</tr>
<tr>
  <td>getFiles("*.tga")</td>
  <td>Targa形式</td>
</tr>
<tr>
  <td>getFiles("*.bmp")</td>
  <td>BMP形式</td>
</tr>
<tr>
  <td>getFiles("*.pxr")</td>
  <td>Pixer形式</td>
</tr>
</tbody>
</table>
<p>【sample】フォルダにある異なる形式の画像ファイルをまとめて開く</p>
<pre><code>// フォルダにある異なる形式の画像ファイルをまとめて開く
var folderObj = Folder.selectDialog("画像ファイルがあるフォルダを選択してください");
var fileList = [].concat(
    folderObj.getFiles("*.psd"), // Photoshop形式ファイル一覧を取得する
    folderObj.getFiles("*.jpg"), // JPEG形式ファイル一覧を取得する
    folderObj.getFiles("*.gif") // GIF形式ファイル一覧を取得する
);
for(var i=0; i&lt;fileList.length; i++){
    try{
        app.open(fileList[i]);  // ファイルを開く
    }catch(e){}
}</code></pre>
<p>　フォルダ選択ダイアログが表示されるので画像ファイルがあるフォルダを選択します。</p>
<figure>
<figcaption>【図】フォルダ選択ダイアログで画像ファイルがあるフォルダを選択する</figcaption>
<img src="images/00004.jpeg" />
</figure>
<p>　指定したフォルダにある同じ階層のPhotoshop形式、JPEG形式、GIF形式のファイルが開かれます。</p>
<figure>
<figcaption>【図】指定したフォルダにある同じ階層のPhotoshop形式、JPEG形式、GIF形式のファイルが開かれる</figcaption>
<img src="images/00417.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-636">
<section>
<h2 id="calibre_link-356"><b>14-10　サブフォルダ内にある画像ファイルをまとめて開く</b></h2>
<p>　サブフォルダ内にある画像ファイルをまとめて開くには再帰処理を行う関数を用意します。サンプルではopenImageFile()関数を作成し、サブフォルダがある場合に呼び出すようにしています。getFiles()メソッドを使った画像ファイルの読み込みなどの処理については「フォルダにある画像ファイルをまとめて開く」の項目を参照してください。</p>
<p>　また、再帰の呼び出しを自分自身の関数名に依存させたくない場合はarguments.callee()を使います。サンプルではopenImageFileをarguments.calleeに置き換えても動作します。ただし、arguments.callee自体は今後推奨されない可能性があるため使用に関しては注意してください。</p>
<p>【sample】サブフォルダ内にある画像ファイルをまとめて開く</p>
<pre><code>// フォルダにある画像ファイルをまとめて開く
var folderObj = Folder.selectDialog("画像ファイルがあるフォルダを選択してください");
if(folderObj){
    openImageFile(folderObj);
}
// サブフォルダまで走査して画像を開く
function openImageFile(folderObj){
    var fileList = folderObj.getFiles("*.psd"); // Photoshop形式ファイル一覧を取得する
    for(var i=0; i&lt;fileList.length; i++){
        try{
            app.open(fileList[i]);  // ファイルを開く
        }catch(e){}
    }
    var list = folderObj.getFiles();
    for(var i=0; i&lt;list.length; i++){
        if (list[i].getFiles){  // フォルダの場合
            openImageFile(list[i]); // 再帰で呼び出し
        }
    }
}</code></pre>
<p>　フォルダ選択ダイアログが表示されるのでPhotoshop形式のファイルがあるフォルダを選択します。</p>
<figure>
<figcaption>【図】フォルダ選択ダイアログでPhotoshop形式のファイルがあるフォルダを選択する</figcaption>
<img src="images/00190.jpeg" />
</figure>
<p>　指定したフォルダとサブフォルダ内にあるPhotoshop形式のファイルがまとめて開かれます。</p>
<figure>
<figcaption>【図】指定したフォルダとサブフォルダ内のPhotoshop形式のファイルがまとめて開かれる</figcaption>
<img src="images/00597.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-680">
<section>
<div>
<h1 id="calibre_link-357"><b>第15章　ガイド</b></h1>
</div>
</section>
</div>
<div id="calibre_link-468">
<section>
<h2 id="calibre_link-358"><b>15-1　ガイドの総数を求める</b></h2>
<p>　ガイドの総数はdocumentオブジェクトのguides配列の総数を取得することで求めることができます。guides配列にはドキュメント上の全てのガイドの情報が入っています。ガイドが1つの場合は1の数値が返されます。ガイドの総数は縦方向のガイドと横方向のガイドの両方を合わせた数になります。</p>
<p>【sample】ガイドの総数を求める</p>
<pre><code>// ガイドの総数を求める
var n = app.activeDocument.guides.length;
alert(n+"個あります");</code></pre>
<p>　アラートダイアログに現在のドキュメントにあるガイドの総数が表示されます。</p>
<figure>
<figcaption>【図】現在のドキュメント上のガイド</figcaption>
<img src="images/00369.jpeg" />
</figure>
<figure>
<figcaption>【図】アラートダイアログに現在のドキュメントにあるガイドの総数が表示される</figcaption>
<img src="images/00137.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-626">
<section>
<h2 id="calibre_link-359"><b>15-2　横方向と縦方向のガイド数を求める</b></h2>
<p>　横方向と縦方向のガイド数を求めるにはguides配列からガイドオブジェクトを読み出しdirectionプロパティを調べます。directionプロパティの値によってガイドの方向が分かります。方向を調べてそれぞれカウントすることで横方向と縦方向のガイド数を求めることができます。directionプロパティの値は以下の表のようになります。</p>
<table>
<caption>【表】directionプロパティの値</caption>
<tbody>
<tr>
  <td>
    <span>値</span>
  </td>
  <td>
    <span>指定する方向</span>
  </td>
</tr>
<tr>
  <td>Direction.HORIZONTAL</td>
  <td>水平方向のガイド</td>
</tr>
<tr>
  <td>Direction.VERTICAL</td>
  <td>垂直方向のガイド</td>
</tr>
</tbody>
</table>
<p>【sample】横方向と縦方向のガイド数を求める</p>
<pre><code>// ガイドの方向別に総数を求める
var g = app.activeDocument.guides;
var countW = 0; // 横方向のガイド数
var countH = 0; // 縦方向のガイド数
for(var i=0; i&lt;g.length; i++){
    // 水平方向のガイドかどうか調べる
    if (g[i].direction == Direction.HORIZONTAL){
        countW = countW + 1;
    }
    // 垂直方向のガイドかどうか調べる
    if (g[i].direction == Direction.VERTICAL){
        countH = countH + 1;
    }
}
alert("横方向に "+countW+"個、縦方向に"+countH+"個あります");</code></pre>
<p>　アラートダイアログに横方向と縦方向のそれぞれのガイド数が表示されます。</p>
<figure>
<figcaption>【図】現在のドキュメント上のガイド</figcaption>
<img src="images/00552.jpeg" />
</figure>
<figure>
<figcaption>【図】アラートダイアログに横方向と縦方向のそれぞれのガイド数が表示される</figcaption>
<img src="images/00325.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-11">
<section>
<h2 id="calibre_link-360"><b>15-3　ガイドの座標値を求める</b></h2>
<p>　ガイドの座標値はdocumentオブジェクトのguides配列のcoordinateプロパティを読み出します。ガイドが水平方向の場合は起点となる上のY座標を、垂直方向の場合は起点となる左側のX座標が格納されています。coordinateプロパティには座標値が単位付きで入っています。この座標値はUnitValue形式になっているのでUnitValueオブジェクトのas()メソッドを使って以下の表に示す単位に変換することができます。また、単位だけを削除したい場合はparseFloat()メソッドを使います。</p>
<table>
<caption>【表】as()メソッドに指定できる単位</caption>
<tbody>
<tr>
  <td>
    <span>指定値</span>
  </td>
  <td>
    <span>単位</span>
  </td>
</tr>
<tr>
  <td>in</td>
  <td>インチ</td>
</tr>
<tr>
  <td>ft</td>
  <td>フィート</td>
</tr>
<tr>
  <td>yd</td>
  <td>ヤード</td>
</tr>
<tr>
  <td>mi</td>
  <td>マイル</td>
</tr>
<tr>
  <td>mm</td>
  <td>ミリメートル</td>
</tr>
<tr>
  <td>cm</td>
  <td>センチメートル</td>
</tr>
<tr>
  <td>m</td>
  <td>メートル</td>
</tr>
<tr>
  <td>km</td>
  <td>キロメートル</td>
</tr>
<tr>
  <td>pt</td>
  <td>ポイント</td>
</tr>
<tr>
  <td>pc</td>
  <td>パイカ</td>
</tr>
<tr>
  <td>tpt</td>
  <td>ポイント（古いポイントの数値を基準にした値）</td>
</tr>
<tr>
  <td>tpc</td>
  <td>パイカ（古いパイカの数値を基準にした値）</td>
</tr>
<tr>
  <td>ci</td>
  <td>シセロ</td>
</tr>
<tr>
  <td>px</td>
  <td>ピクセル</td>
</tr>
<tr>
  <td>%</td>
  <td>パーセンテージ（割合／百分率）</td>
</tr>
</tbody>
</table>
<p>【sample】ガイドの座標値を求める</p>
<pre><code>// ガイドの座標値を求める
var coord = app.activeDocument.guides[0].coordinate;
alert(coord);</code></pre>
<p>　アラートダイアログに現在のドキュメントの最初のガイドの座標値が表示されます。</p>
<figure>
<figcaption>【図】現在のドキュメント上のガイド</figcaption>
<img src="images/00085.jpeg" />
</figure>
<figure>
<figcaption>【図】アラートダイアログに現在のドキュメントの最初のガイドの座標値が表示される</figcaption>
<img src="images/00504.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-620">
<section>
<h2 id="calibre_link-361"><b>15-4　ガイドを追加する</b></h2>
<p>　ガイドを追加するにはdocumentオブジェクトのguides配列のadd()メソッドを使います。add()メソッドの最初のパラメーターには方向を示すプロパティを指定します。add()メソッドの2番目のパラメーターには数値またはUnitValue形式を指定します。数値を指定した場合はプレファレンスで設定されている現在の単位を基準にします。UnitValue形式の場合は単位付きで指定することができます。</p>
<table>
<caption>【表】ガイドの方向を示すプロパティ</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>ガイドの方向</span>
  </td>
</tr>
<tr>
  <td>Direction.HORIZONTAL</td>
  <td>水平方向に描画されるガイド</td>
</tr>
<tr>
  <td>Direction.VERTICAL</td>
  <td>垂直方向に描画されるガイド</td>
</tr>
</tbody>
</table>
<p>【sample】ガイドを追加する</p>
<pre><code>// ガイドを追加する
var docW = activeDocument.width.value;  // ドキュメントの横幅を取得する
var docH = activeDocument.height.value;  // ドキュメントの縦幅を取得する
for(var x=0; x&lt;docW; x+=50){
    activeDocument.guides.add(Direction.VERTICAL, x);
}
for(var y=0; y&lt;docH; y+=50){
    activeDocument.guides.add(Direction.HORIZONTAL, UnitValue(y, "mm"));
}</code></pre>
<p>　ガイドを追加する前のドキュメントです。</p>
<figure>
<figcaption>【図】ガイドを追加する前のドキュメント</figcaption>
<img src="images/00274.jpeg" />
</figure>
<p>　スクリプトを実行すると等間隔に縦横のガイドが追加されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると等間隔に縦横のガイドが追加される</figcaption>
<img src="images/00038.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-661">
<section>
<h2 id="calibre_link-362"><b>15-5　ガイドを削除する</b></h2>
<p>　ガイドを削除するにはdocumentオブジェクトのguides配列のremove()メソッドを使います。ガイドの情報を読み出して判断した後に消すこともできます。サンプルのように特定方向のガイドだけを削除することもできます。なお、全てのガイドをまとめて削除する場合はremoveAll()メソッドを使います。</p>
<p>【sample】ガイドを削除する</p>
<pre><code>// ガイドを削除する
var g = activeDocument.guides;
for(var i=g.length-1; i&gt;=0; i--){
    if (g[i].direction == Direction.HORIZONTAL){
        g[i].remove();
    }
}</code></pre>
<p>　ガイドを削除する前のドキュメントです。</p>
<figure>
<figcaption>【図】ガイドを削除する前のドキュメント</figcaption>
<img src="images/00456.jpeg" />
</figure>
<p>　スクリプトを実行すると水平方向のガイドだけが削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると水平方向のガイドだけが削除される</figcaption>
<img src="images/00230.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-451">
<section>
<h2 id="calibre_link-363"><b>15-6　ガイドを全て削除する</b></h2>
<p>　ガイドを全て削除するにはdocumentオブジェクトのguides配列のremoveAll()メソッドを使います。これにより全てのガイドが削除されます。なお、個別にガイドを削除する場合はremove()メソッドを使います。</p>
<p>【sample】ガイドを全て削除する</p>
<pre><code>// ガイドを全て削除する
activeDocument.guides.removeAll();</code></pre>
<p>　ガイドを削除する前のドキュメントです。</p>
<figure>
<figcaption>【図】ガイドを削除する前のドキュメント</figcaption>
<img src="images/00001.jpeg" />
</figure>
<p>　スクリプトを実行すると全てガイドが削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると全てガイドが削除される</figcaption>
<img src="images/00061.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-619">
<section>
<div>
<h1 id="calibre_link-364"><b>第16章　ヒストリー</b></h1>
</div>
</section>
</div>
<div id="calibre_link-409">
<section>
<h2 id="calibre_link-365"><b>16-1　ヒストリーの総数を求める</b></h2>
<p>　ヒストリーの総数はdocumentオブジェクトのhistoryStates配列の総数を取得することで求めることができます。historyStates配列にはドキュメント上のヒストリー情報が入っています。ヒストリーの総数は最低でも1つ存在し0になることはありません。また、スナップショットもヒストリーに含まれます。</p>
<p>【sample】ヒストリーの総数を求める</p>
<pre><code>// ヒストリーの総数を求める
var n = app.activeDocument.historyStates.length;
alert(n+"個あります");</code></pre>
<p>　アラートダイアログに現在のドキュメントのヒストリー総数が表示されます。</p>
<figure>
<figcaption>【図】現在のドキュメントのヒストリー</figcaption>
<img src="images/00184.jpeg" />
</figure>
<figure>
<figcaption>【図】アラートダイアログに現在のドキュメントのヒストリー総数が表示される</figcaption>
<img src="images/00592.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-565">
<section>
<h2 id="calibre_link-366"><b>16-2　ヒストリー名を取得する</b></h2>
<p>　ヒストリーの名前を取得するにはdocumentオブジェクトのhistoryStates配列に格納されているHistoryStatesオブジェクトのnameプロパティを参照します。また、HistoryStatesオブジェクトのgetByName()メソッドに取得したいヒストリー名を指定して取得することができます。getByName()メソッドの場合は同じ名前のヒストリーがある場合、最初に見つかったものが返されます。nameプロパティの場合は任意の順のヒストリー名か複数の同じ名前があるヒストリー名を取得する場合に使います。</p>
<p>　nameプロパティおよびgetByName()で指定した名前を持つヒストリーがない場合、エラーで停止します。これを回避する場合はtry...catchを使います。</p>
<p>【sample】ヒストリー名を取得する</p>
<pre><code>// ヒストリーの名前を取得する
var hisName1 = app.activeDocument.historyStates.getByName("色相・彩度");
var hisName2 = app.activeDocument.historyStates[6].name;
alert(hisName1);
alert(hisName2);</code></pre>
<p>　指定された名前を持つヒストリーがあるので、アラートダイアログにヒストリー名が表示されます。</p>
<figure>
<figcaption>【図】指定された名前を持つヒストリーがあるので、ヒストリー名が表示される</figcaption>
<img src="images/00364.jpeg" />
</figure>
<p>　続いてアラートダイアログに現在のドキュメントの7番目のヒストリー名が表示されます。</p>
<figure>
<figcaption>【図】現在のドキュメントの7番目のヒストリー名が表示される</figcaption>
<img src="images/00132.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-2">
<section>
<h2 id="calibre_link-367"><b>16-3　ヒストリーがスナップショットかどうか調べる</b></h2>
<p>　ヒストリーがスナップショットかどうか調べるにはhistoryStates配列に格納されているHistoryStatesオブジェクトのsnapshotプロパティを参照します。snapshotプロパティがtrueならスナップショット、falseならスナップショットではないことを示します。</p>
<p>【sample】ヒストリーがスナップショットかどうか調べる</p>
<pre><code>// ヒストリーがスナップショットかどうか調べる
var his=app.activeDocument.historyStates[2];
alert(his.snapshot);</code></pre>
<p>　上から3番目のヒストリーはスナップショットなのでアラートダイアログにtrueが表示されます。</p>
<figure>
<figcaption>【図】上から3番目のヒストリーはスナップショットなので、trueが表示される</figcaption>
<img src="images/00549.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-505">
<section>
<h2 id="calibre_link-368"><b>16-4　アクティブになっているヒストリー名を求める</b></h2>
<p>　アクティブになっているヒストリー名を求めるにはdocumentオブジェクトのactiveHistoryStateオブジェクトのnameプロパティを参照します。</p>
<p>【sample】アクティブになっているヒストリー名を求める</p>
<pre><code>// アクティブになっているヒストリー名を表示する
var text = app.activeDocument.activeHistoryState.name;
alert(text);</code></pre>
<p>　アラートダイアログにアクティブになっているヒストリー名が表示されます。</p>
<figure>
<figcaption>【図】現在のドキュメントのヒストリー</figcaption>
<img src="images/00323.jpeg" />
</figure>
<figure>
<figcaption>【図】アラートダイアログにアクティブなヒストリー名が表示される</figcaption>
<img src="images/00081.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-658">
<section>
<h2 id="calibre_link-369"><b>16-5　スクリプトの処理をヒストリーに記録しないようにする</b></h2>
<p>　スクリプトの処理をヒストリーに記録しないようにするにはdocumentオブジェクトのsuspendHistory()メソッドを使います。最初のパラメーターにはヒストリー名を指定します。このヒストリー名がヒストリーパネルに表示される名前になります。2番目のパラメーターには実行するスクリプトを指定します。</p>
<p>　JavaScriptを使用した処理を行うと大量のヒストリーが記録されてしまい過去のヒストリーが消えてしまいます。このため、ヒストリーを保持したいのであればsuspendHistory()メソッドを使うのがよいでしょう。特に一般公開しAdd-onなどで配布する場合はヒストリーにも配慮する必要があります。</p>
<p>【sample】スクリプトの処理をヒストリーに記録しないようにする</p>
<pre><code>// スクリプトの処理をヒストリーに記録しないようにする
makeLayer(5);   // レイヤーを５つ生成
app.activeDocument.suspendHistory("レイヤー一括生成", "makeLayer(5)");
// 指定された数だけレイヤーを生成する関数
function makeLayer(n){
    for(var i=0; i&lt;n; i++){
        app.activeDocument.artLayers.add(i);
    }
}</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00500.jpeg" />
</figure>
<p>　スクリプトを実行すると5つのレイヤーが作成されヒストリーに記録されます。その後も同様に5つのレイヤーが作成されますが、suspendHistory()メソッドを利用しているため1つのヒストリー名だけが記録されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると5つのレイヤーが作成されヒストリーに記録される</figcaption>
<img src="images/00270.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-449">
<section>
<h2 id="calibre_link-370"><b>16-6　ヒストリーを全て消す</b></h2>
<p>　ヒストリーを全て消すにはappオブジェクトのpurge()メソッドを使います。パラメーターにPurgeTarget.HISTORYCACHESを指定することでヒストリーが全て消去されます。なお、消去したヒストリーはもとに戻せないので注意が必要です。</p>
<p>【sample】ヒストリーを全て消す</p>
<pre><code>// ヒストリーを全て消す
app.purge(PurgeTarget.HISTORYCACHES);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00034.jpeg" />
</figure>
<p>　スクリプトを実行するとヒストリーが全て消去されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとヒストリーが全て消去される</figcaption>
<img src="images/00141.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-605">
<section>
<h2 id="calibre_link-371"><b>16-7　特定のヒストリーに戻す</b></h2>
<p>　特定のヒストリーに戻すにはdocumentオブジェクトのactiveHistoryStateプロパティに戻したいHistoryStateオブジェクトを設定します。設定する場合はdocumentオブジェクトのhistoryStates配列で戻したい項目名か参照番号を指定します。同じ項目名がある場合は古い項目名のヒストリーにセットされます。スクリプトでsuspendHistory()メソッドを使っている場合は、独自の項目名を付けることができるため、これを利用して任意のヒストリーに戻すことができます。</p>
<p>【sample】特定のヒストリーに戻す</p>
<pre><code>// 特定のヒストリーに戻す
var myHistory = app.activeDocument.historyStates["文字ツール"];
app.activeDocument.activeHistoryState = myHistory;</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00178.jpeg" />
</figure>
<p>　スクリプトを実行すると"文字ツール"のヒストリーまで戻ります。</p>
<figure>
<figcaption>【図】スクリプトを実行すると"文字ツール"のヒストリーまで戻る</figcaption>
<img src="images/00350.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-44">
<section>
<h2 id="calibre_link-372"><b>16-8　ヒストリー項目を１つずつPhotoshop形式のファイルに書き出す</b></h2>
<p>　ヒストリー項目を１つずつPhotoshop形式のファイルに書き出すにはdocumentオブジェクトのhistoryStates配列の数だけ繰り返します。その際、アクティブヒストリーを順番に設定していくことで、ヒストリーごとにPSDファイル（Photoshop形式のファイル）を書き出すことができます。Photoshop形式のファイルの書き出しについては「Photoshop形式で保存する」の項目を参照してください。</p>
<p>【sample】ヒストリー項目を１つずつPhotoshop形式のファイルに書き出す</p>
<pre><code>// ヒストリー項目を１つずつPhotoshop形式のファイルに書き出す
var folderObj = Folder.selectDialog("保存先のフォルダを指定してください");
if (folderObj){ // フォルダが選択された場合
    var history = app.activeDocument.historyStates;
    for(var i=1; i&lt;=history.length; i++){
        app.activeDocument.activeHistoryState = history[i-1]; // 1つ進める
        var filename = folderObj + "/"+i+".psd";    // ファイル名
        app.activeDocument.saveAs(new File(filename));  // 保存する
    }
}</code></pre>
<p>　保存先のフォルダを指定します。</p>
<figure>
<figcaption>【図】保存先のフォルダを指定する</figcaption>
<img src="images/00479.jpeg" />
</figure>
<p>　ヒストリーごとにPhotoshop形式のファイルが書き出されます。</p>
<figure>
<figcaption>【図】ヒストリーごとにPhotoshop形式のファイルが書き出される</figcaption>
<img src="images/00618.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-54">
<section>
<div>
<h1 id="calibre_link-373"><b>第17章　レイヤーカンプ</b></h1>
</div>
</section>
</div>
<div id="calibre_link-444">
<section>
<h2 id="calibre_link-374"><b>17-1　レイヤーカンプの総数を求める</b></h2>
<p>　レイヤーカンプの総数はdocumentオブジェクトのlayerComps配列のlengthプロパティを参照することで求めることができます。layerComps配列の各要素にはレイヤーカンプの情報が入っています。</p>
<p>【sample】レイヤーカンプの総数を求める</p>
<pre><code>// レイヤーカンプの総数を求める
var n = app.activeDocument.layerComps.length;
alert(n+"個あります");</code></pre>
<p>　アラートダイアログに現在のドキュメントのレイヤーカンプの総数が表示されます。</p>
<figure>
<figcaption>【図】アラートダイアログに現在のドキュメントのレイヤーカンプの総数が表示される</figcaption>
<img src="images/00106.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-494">
<section>
<h2 id="calibre_link-375"><b>17-2　レイヤーカンプの名前を取得する</b></h2>
<p>　レイヤーカンプの名前を取得するにはlayerCompオブジェクトのnameプロパティを参照します。layerCompオブジェクトはdocumentオブジェクトのlayerComps配列に格納されています。layerComps[0]のように0番が最初のレイヤーカンプを示します。layerCompsで指定する番号（添え字）は1ずつ増えるため1を指定すると2番目のレイヤーカンプを示すことになります。</p>
<p>【sample】レイヤーカンプの名前を取得する</p>
<pre><code>// レイヤーカンプの名前を表示する
var compName = app.activeDocument.layerComps[2].name;
alert(compName);</code></pre>
<p>　アラートダイアログに現在の3番目のレイヤーカンプの名前が表示されます。</p>
<figure>
<figcaption>【図】アラートダイアログに現在の3番目のレイヤーカンプの名前が表示される</figcaption>
<img src="images/00367.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-529">
<section>
<h2 id="calibre_link-376"><b>17-3　レイヤーカンプを追加する</b></h2>
<p>　レイヤーカンプを追加するにはlayerCompオブジェクトのadd()メソッドを使います。add()メソッドで指定できるパラメーターは5つあります。最初のパラメーターがレイヤーカンプの名前、2番目がコメントになります。3番目は外観（レイヤースタイル）、4番目は位置、5番目は表示／非表示のフラグになります。それぞれの機能はtrueで有効、falseで無効になります。</p>
<p>【sample】レイヤーカンプを追加する</p>
<pre><code>// レイヤーカンプを追加する
var comp = app.activeDocument.layerComps.add(
    "名前入り",
    "2015/1/21に作成",
    true,   // 外観（レイヤースタイル）
    true,   // 位置
    true    // 表示／非表示
);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00383.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤーカンプが追加されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤーカンプが追加される</figcaption>
<img src="images/00446.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-435">
<section>
<h2 id="calibre_link-377"><b>17-4　レイヤーカンプを削除する</b></h2>
<p>　レイヤーカンプを削除するにはlayerCompオブジェクトのremove()メソッドを使います。</p>
<p>【sample】レイヤーカンプを削除する</p>
<pre><code>// レイヤーカンプを削除する
app.activeDocument.layerComps[0].remove();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00012.jpeg" />
</figure>
<p>　スクリプトを実行すると最初のレイヤーカンプが削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると最初のレイヤーカンプが削除される</figcaption>
<img src="images/00148.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-446">
<section>
<h2 id="calibre_link-378"><b>17-5　レイヤーカンプを全て削除する</b></h2>
<p>　レイヤーカンプを全て削除するにはlayerCompオブジェクトのremoveAll()メソッドを使います。</p>
<p>【sample】レイヤーカンプを全て削除する</p>
<pre><code>// レイヤーカンプをすべて削除する
app.activeDocument.layerComps.removeAll();</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00286.jpeg" />
</figure>
<p>　スクリプトを実行するとレイヤーカンプが全て削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとレイヤーカンプが全て削除される</figcaption>
<img src="images/00421.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-601">
<section>
<h2 id="calibre_link-379"><b>17-6　レイヤーカンプが選択されているか調べる</b></h2>
<p>　レイヤーカンプが選択されているか調べるにはlayerCompオブジェクトのselectedプロパティを参照します。selectedプロパティの値がtrueなら選択されており、falseなら選択されていないことになります。</p>
<p>【sample】レイヤーカンプが選択されているか調べる</p>
<pre><code>// レイヤーカンプが選択されているか調べる
var comps = app.activeDocument.layerComps;
var flag = comps[0].selected;
if (flag === false){
    alert("最初のレイヤーカンプは選択されていません");
}else{
    alert("最初のレイヤーカンプが選択されています");
}
var flag = comps[1].selected;
if (flag === false){
    alert("2番目のレイヤーカンプは選択されていません");
}else{
    alert("2番目のレイヤーカンプが選択されています");
}</code></pre>
<p>　まず、最初のレイヤーカンプが選択されているかどうかがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】まず、最初のレイヤーカンプが選択されているかどうかが表示される</figcaption>
<img src="images/00556.jpeg" />
</figure>
<p>　次に2番目のレイヤーカンプが選択されているかどうかがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】次に2番目のレイヤーカンプが選択されているかどうかが表示される</figcaption>
<img src="images/00043.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-39">
<section>
<h2 id="calibre_link-380"><b>17-7　選択されているレイヤーカンプを取得する</b></h2>
<p>　選択されているレイヤーカンプを取得するにはlayerComps配列に格納されているlayerCompオブジェクトのselectedプロパティを調べます。この場合、for命令を使ってlayerComps配列に格納されている数だけ繰り返し調べる必要があります。また、関数化しておくと処理が楽になります。調べた結果、選択されているレイヤーカンプが見つかったらreturn命令を使って関数から抜けます。レイヤーカンプの場合、選択されていないこともあるため、この場合はnullを返すようにします。</p>
<p>　選択されているレイヤーカンプ名を表示したい場合には関数を呼び出し戻り値を受け取ります。戻り値がnullでなければ選択されているレイヤーカンプがあることになります。</p>
<p>【sample】選択されているレイヤーカンプを取得する</p>
<pre><code>// 選択されているレイヤーカンプを取得する
function getSelectedLayerComp(){
    var comps = app.activeDocument.layerComps;
    for(var i=0; i&lt;comps.length; i++){
        if (comps[i].selected === true){
            return comps[i];    // 選択されているレイヤーカンプを返す
        }
    }
    return null;
}
var comp = getSelectedLayerComp();
if (comp != null){
    var compName = comp.name;
    alert("「"+compName+"」のレイヤーカンプが選択されています");
}else{
    alert("レイヤーカンプは選択されていません");
}</code></pre>
<p>　レイヤーカンプが選択されている場合は、そのレイヤーカンプの名前がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】レイヤーカンプが選択されている場合、その名前が表示される</figcaption>
<img src="images/00188.jpeg" />
</figure>
<p>　レイヤーカンプが選択されていない場合は、選択されていないことを示すメッセージがアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】レイヤーカンプが選択されていない場合、選択されていないことを示すメッセージが表示される</figcaption>
<img src="images/00175.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-500">
<section>
<h2 id="calibre_link-381"><b>17-8　選択されているレイヤーカンプのコメントに現在の日時を追加する</b></h2>
<p>　選択されているレイヤーカンプのコメントに現在の日時を追加するにはlayerCompオブジェクトのcommentプロパティに日時の文字列を書き込みます。選択されているレイヤーカンプを取得するにはlayerComps配列に格納されているlayerCompオブジェクトの中からselectedプロパティがtrueになっているか調べます。</p>
<p>　日時を求めるにはDateオブジェクトを生成します。これはnew Date()とすることで現在の日時を持つDateオブジェクトが生成されます。以下の表に示すDateオブジェクトのメソッドを呼び出すことで現在の日時を取得することができます。</p>
<table>
<caption>【表】Dateオブジェクトの主なメソッド</caption>
<tbody>
<tr>
  <td>
    <span>主なメソッド</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>getFullYear()</td>
  <td>西暦年4桁を返す</td>
</tr>
<tr>
  <td>getMonth()</td>
  <td>月より1少ない値を返す</td>
</tr>
<tr>
  <td>getDate()</td>
  <td>日にちを返す</td>
</tr>
<tr>
  <td>getDay()</td>
  <td>曜日を0～6の数値で返す。0が日曜日、1が月曜日、2が火曜日、3が水曜日、4が木曜日、5が金曜日、6が土曜日に対応している。</td>
</tr>
<tr>
  <td>getHours()</td>
  <td>時を返す。24時間制。</td>
</tr>
<tr>
  <td>getMinutes()</td>
  <td>分を返す</td>
</tr>
<tr>
  <td>getSeconds()</td>
  <td>秒を返す</td>
</tr>
</tbody>
</table>
<p>【sample】選択されているレイヤーカンプのコメントに現在の日時を追加する</p>
<pre><code>// 選択されているレイヤーカンプのコメントに現在の日時を追加する
function getSelectedLayerComp(){
    var comps = app.activeDocument.layerComps;
    for(var i=0; i&lt;comps.length; i++){
        if (comps[i].selected === true){
            return comps[i];    // 選択されているレイヤーカンプを返す
        }
    }
    return null;
}
var comp = getSelectedLayerComp();
if (comp != null){
    var dateObj = new Date();
    var Y = dateObj.getFullYear();  // 西暦を取得
    var M = dateObj.getMonth() + 1; // 月を取得
    var D = dateObj.getDate();  // 日を取得
    var h = dateObj.getHours(); // 時を取得
    var m = dateObj.getMinutes();   // 分を取得
    var s = dateObj.getSeconds();   // 秒を取得
    comp.comment += Y+"年"+M+"月"+D+"日　"+h+"時"+m+"分"+s+"秒";
}else{
    alert("レイヤーカンプが選択されていません");
}</code></pre>
<p>　スクリプトを実行する前のコメントの状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前のコメントの状態</figcaption>
<img src="images/00455.jpeg" />
</figure>
<p>　スクリプトを実行するとコメントに現在の日時が追加されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとコメントに現在の日時が追加される</figcaption>
<img src="images/00180.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-427">
<section>
<div>
<h1 id="calibre_link-382"><b>第18章　計測</b></h1>
</div>
</section>
</div>
<div id="calibre_link-38">
<section>
<h2 id="calibre_link-383"><b>18-1　計測スケールを設定する／取得する</b></h2>
<p>　計測スケールを設定する／取得するにはdocumentオブジェクトのmeasurementScaleオブジェクトの各プロパティにアクセスします。プロパティは以下の表に示す3つが用意されています。</p>
<table>
<caption>【表】measurementScaleのプロパティ</caption>
<tbody>
<tr>
  <td>
    <span>プロパティ</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>pixelLength</td>
  <td>ピクセル長</td>
</tr>
<tr>
  <td>logicalLength</td>
  <td>論理的な長さ</td>
</tr>
<tr>
  <td>logicalUnit</td>
  <td>スケール単位</td>
</tr>
</tbody>
</table>
<p>【sample】計測スケールを設定する／取得する</p>
<pre><code>// 計測スケールを設定する
var ms = app.activeDocument.measurementScale;
ms.pixelLength = 2; // 2pixelで1pixel分にする
ms.logicalLength = 10;  // 10倍にする</code></pre>
<p>　計測スケールを使用しない場合は画面の1ピクセルと1:1に対応した数値が画面上部のツールバーに表示されます。</p>
<figure>
<figcaption>【図】計測スケールを使用しない場合</figcaption>
<img src="images/00079.jpeg" />
</figure>
<p>　スクリプトを実行後、「計測スケールを使用」にチェックを入れるとスクリプトで設定した倍率で計測値が画面上部のツールバーに表示されます。</p>
<figure>
<figcaption>【図】スクリプトで設定した倍率で計測値が画面上部のツールバーに表示される</figcaption>
<img src="images/00225.jpeg" />
</figure>
<p>　スクリプトでは以下のダイアログの各数値に対応することになります。</p>
<figure>
<figcaption>【図】スクリプトでは以下のダイアログの各数値に対応する</figcaption>
<img src="images/00292.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-516">
<section>
<h2 id="calibre_link-384"><b>18-2　計測結果を記録する</b></h2>
<p>　計測結果を記録するにはdocumentオブジェクトのrecordMeasurements()メソッドを使います。パラメーターには以下の表に示す種類を指定します。なお、記録に該当するデータがない場合はエラーになります。</p>
<table>
<caption>【表】記録するデータの種類</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>MeasurementSource.MEASURESELECTION</td>
  <td>選択範囲</td>
</tr>
<tr>
  <td>MeasurementSource.MEASURECOUNTTOOL</td>
  <td>カウントツール</td>
</tr>
<tr>
  <td>MeasurementSource.MEASURERULERTOOL</td>
  <td>計測ツール</td>
</tr>
</tbody>
</table>
<p>【sample】計測結果を記録する</p>
<pre><code>// 計測結果を記録する
app.activeDocument.recordMeasurements( MeasurementSource.MEASURECOUNTTOOL);</code></pre>
<p>　スクリプトを実行するとカウントツールのデータが記録されます。</p>
<figure>
<figcaption>【図】スクリプトを実行するとカウントツールのデータが記録される</figcaption>
<img src="images/00496.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-433">
<section>
<h2 id="calibre_link-385"><b>18-3　計測結果を保存する</b></h2>
<p>　計測結果を保存するにはmeasurementLogオブジェクトのexportMeasurements()メソッドを使います。最初のパラメーターには保存先のファイルオブジェクトを指定します。2番目のパラメーターには以下の表に示す保存範囲を指定します。</p>
<table>
<caption>【表】保存範囲</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>MeasurementRange.ALLMEASUREMENTS</td>
  <td>全て保存</td>
</tr>
<tr>
  <td>MeasurementRange.ACTIVEMEASUREMENTS</td>
  <td>アクティブになっている欄だけを保存</td>
</tr>
</tbody>
</table>
<p>【sample】計測結果を保存する</p>
<pre><code>// 計測結果を保存する
var fileObj = new File("～/Desktop/mes.txt");
fileObj.encoding = "utf-16";
app.measurementLog.exportMeasurements(fileObj, MeasurementRange.ALLMEASUREMENTS);
// アクティブになっている計測結果だけを保存する
var fileObj = new File("～/Desktop/mes2.txt");
fileObj.encoding = "utf-16";
app.measurementLog.exportMeasurements(fileObj, MeasurementRange.ACTIVEMEASUREMENTS);</code></pre>
<p>　計測結果が5つあります。ここで、スクリプトを実行します。</p>
<figure>
<figcaption>【図】計測結果が5つある</figcaption>
<img src="images/00183.jpeg" />
</figure>
<p>　2つのファイルが保存されます。1つは全ての計測結果が保存され、もう1つは選択した計測結果だけが保存されます。</p>
<figure>
<figcaption>【図】2つのファイルが保存される。1つは全ての計測結果。</figcaption>
<img src="images/00126.jpeg" />
</figure>
<figure>
<figcaption>【図】もう1つは選択した計測結果だけが保存される</figcaption>
<img src="images/00262.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-602">
<section>
<h2 id="calibre_link-386"><b>18-4　計測結果を削除する</b></h2>
<p>　計測結果を削除するにはmeasurementLogオブジェクトのdeleteMeasurements()メソッドを使います。パラメーターには以下の表に示す削除範囲を指定します。</p>
<table>
<caption>【表】削除範囲</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>MeasurementRange.ALLMEASUREMENTS</td>
  <td>全て削除</td>
</tr>
<tr>
  <td>MeasurementRange.ACTIVEMEASUREMENTS</td>
  <td>アクティブになっている欄だけ削除</td>
</tr>
</tbody>
</table>
<p>【sample】計測結果を削除する</p>
<pre><code>// 計測結果を全て削除する
app.measurementLog.deleteMeasurements( MeasurementRange.ALLMEASUREMENTS);</code></pre>
<p>　スクリプトを実行する前の状態です。</p>
<figure>
<figcaption>【図】スクリプトを実行する前の状態</figcaption>
<img src="images/00399.jpeg" />
</figure>
<p>　スクリプトを実行すると計測結果が全て削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると計測結果が全て削除される</figcaption>
<img src="images/00537.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-25">
<section>
<div>
<h1 id="calibre_link-387"><b>第19章　カウント</b></h1>
</div>
</section>
</div>
<div id="calibre_link-534">
<section>
<h2 id="calibre_link-388"><b>19-1　カウントの総数を求める</b></h2>
<p>　カウントの総数はdocumentオブジェクトのcountItems配列の総数を取得することで求めることができます。カウントが1つの場合は1の数値が返されます。countItems配列は生成された全てのカウントの情報が入っています。Photoshopではカウントグループを作成することができますが、プログラム上ではグループは一切区別されていません。</p>
<p>【sample】カウントの総数を求める</p>
<pre><code>// カウントの総数を求める
var n = app.activeDocument.countItems.length;
alert(n+"個あります");</code></pre>
<p>　アラートダイアログに現在のドキュメントにあるカウントの総数が表示されます。</p>
<figure>
<figcaption>【図】アラートダイアログに現在のドキュメントにあるカウントの総数が表示される</figcaption>
<img src="images/00026.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-685">
<section>
<h2 id="calibre_link-389"><b>19-2　カウントを追加する</b></h2>
<p>　カウントを追加するにはdocumentオブジェクトのcountItemsオブジェクトのadd()メソッドを使います。add()メソッドにはカウントを配置する座標を指定します。座標は[x, y]のように配列形式で指定します。座標を指定する際、UnitValueオブジェクトを使って単位付きで指定します。UnitValue()はいくつかの形式でパラメーターを指定できます。シンプルな指定形式としては最初のパラメーターに数値を、2番目のパラメーターに以下の表に示す単位を指定します。なお、単位は表に示す省略系でなくUnitValue(12, "point")のようにフルスペルで指定することもできます。</p>
<table>
<caption>【表】UnitValueに指定できる単位</caption>
<tbody>
<tr>
  <td>
    <span>指定値</span>
  </td>
  <td>
    <span>単位</span>
  </td>
</tr>
<tr>
  <td>in</td>
  <td>インチ</td>
</tr>
<tr>
  <td>ft</td>
  <td>フィート</td>
</tr>
<tr>
  <td>yd</td>
  <td>ヤード</td>
</tr>
<tr>
  <td>mi</td>
  <td>マイル</td>
</tr>
<tr>
  <td>mm</td>
  <td>ミリメートル</td>
</tr>
<tr>
  <td>cm</td>
  <td>センチメートル</td>
</tr>
<tr>
  <td>m</td>
  <td>メートル</td>
</tr>
<tr>
  <td>km</td>
  <td>キロメートル</td>
</tr>
<tr>
  <td>pt</td>
  <td>ポイント</td>
</tr>
<tr>
  <td>pc</td>
  <td>パイカ</td>
</tr>
<tr>
  <td>tpt</td>
  <td>ポイント（古いポイントの数値を基準にした値）</td>
</tr>
<tr>
  <td>tpc</td>
  <td>パイカ（古いパイカの数値を基準にした値）</td>
</tr>
<tr>
  <td>ci</td>
  <td>シセロ</td>
</tr>
<tr>
  <td>px</td>
  <td>ピクセル</td>
</tr>
<tr>
  <td>%</td>
  <td>パーセンテージ（割合／百分率）</td>
</tr>
</tbody>
</table>
<p>【sample】カウントを追加する</p>
<pre><code>// カウントを5つ追加する
for(var i=0; i&lt;5; i++){
    var x = new UnitValue(i * 20 + 60, "px");
    var y = new UnitValue(i * 25 + 50, "px");
    app.activeDocument.countItems.add([x, y]);
}</code></pre>
<p>　ドキュメントにカウントが5つ追加されます。</p>
<figure>
<figcaption>【図】ドキュメントにカウントが5つ追加される</figcaption>
<img src="images/00164.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-475">
<section>
<h2 id="calibre_link-390"><b>19-3　カウントを1つ削除する</b></h2>
<p>　カウントを1つ削除するにはdocumentオブジェクトのcountItems配列で削除するカウントオブジェクトを番号で指定しremove()メソッドを使います。この番号は0から指定することができますが、0を指定しても何も削除されません。0でなく1を指定すると最初のカウントが削除されます。このため、remove()メソッドを使って全てのカウントを削除することはできません。全てのカウントを削除するにはremoveAll()メソッドを使います。</p>
<p>　また、カウントを削除した後は番号は再度付け直されます（リナンバリング）。</p>
<p>【sample】カウントを1つ削除する</p>
<pre><code>// 3番目のカウントを1つ削除する
app.activeDocument.countItems[3].remove();</code></pre>
<p>　ドキュメントにカウントが5つあります。</p>
<figure>
<figcaption>【図】ドキュメントにカウントが5つある</figcaption>
<img src="images/00305.jpeg" />
</figure>
<p>　スクリプトを実行すると上から3番目のカウントが削除され、その後番号が付け直されます。</p>
<figure>
<figcaption>【図】スクリプトを実行後、上から3番目のカウントが削除され、番号が付け直される</figcaption>
<img src="images/00407.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-631">
<section>
<h2 id="calibre_link-391"><b>19-4　カウントを全て削除する</b></h2>
<p>　カウントを全て削除するにはdocumentオブジェクトのcountItemsオブジェクトのremoveAll()メソッドを使います。</p>
<p>【sample】カウントを全て削除する</p>
<pre><code>// 全てのカウントを削除する
app.activeDocument.countItems.removeAll();</code></pre>
<p>　ドキュメントにカウントが5つあります。</p>
<figure>
<figcaption>【図】ドキュメントにカウントが5つある</figcaption>
<img src="images/00573.jpeg" />
</figure>
<p>　スクリプトを実行すると全てのカウントが削除されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると全てのカウントが削除される</figcaption>
<img src="images/00091.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-420">
<section>
<h2 id="calibre_link-392"><b>19-5　カウントの座標を求める</b></h2>
<p>　カウントの座標を求めるにはdocumentオブジェクトのcountItems配列に格納されているカウントオブジェクトのposition配列を参照します。position[0]とするとX座標、position[1]とするとY座標にアクセスすることができます。座標値はUnitValue形式になっています。単位を変換したい場合にはas()メソッドを使います。as()メソッドに指定できる単位は「19-2　カウントを追加する」の表を参照してください。</p>
<p>【sample】カウントの座標を求める</p>
<pre><code>// カウントの座標値を表示する
var countNo = 0;    // 読み出すカウントの位置
var x = app.activeDocument.countItems[countNo].position[0];
var y = app.activeDocument.countItems[countNo].position[1];
alert(x+", "+y);
var n1 = x.as("mm");
var n2 = x.as("pt");
var n3 = x.as("in");
var n4 = parseFloat(x);
alert(n1+"mm\n"+n2+"pt\n"+n3+"in\n"+n4);</code></pre>
<p>　ドキュメントにカウントが1つあります。</p>
<figure>
<figcaption>【図】ドキュメントにカウントが1つある</figcaption>
<img src="images/00202.jpeg" />
</figure>
<p>　スクリプトを実行すると読み出した座標値（UnitValue形式）がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】スクリプトを実行すると読み出した座標値（UnitValue形式）が表示される</figcaption>
<img src="images/00339.jpeg" />
</figure>
<p>　続いて単位変換した結果がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】続いて単位変換した結果が表示される</figcaption>
<img src="images/00408.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-575">
<section>
<div>
<h1 id="calibre_link-393"><b>第20章　イベント処理</b></h1>
</div>
</section>
</div>
<div id="calibre_link-12">
<section>
<h2 id="calibre_link-394"><b>20-1　イベント発生時の処理が有効になっているか調べる</b></h2>
<p>　イベント発生時の処理が有効になっているか調べるにはアプリケーションオブジェクトのnotifiersEnabledプロパティを調べます。notifiersEnabledプロパティの値がtrueなら有効、falseなら無効になります。なお、notifiersEnabledプロパティは読み出しだけでなく書き込みも可能です。</p>
<p>【sample】イベント発生時の処理が有効になっているか調べる</p>
<pre><code>// イベント発生時の処理が有効になっているか調べる
if (app.notifiersEnabled === true){
    alert("有効です");
}else{
    alert("無効です");
}</code></pre>
<p>　アラートダイアログにイベント発生時の処理の状態が表示されます。</p>
<figure>
<figcaption>【図】アラートダイアログにイベント発生時の処理の状態が表示される</figcaption>
<img src="images/00543.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-520">
<section>
<h2 id="calibre_link-395"><b>20-2　イベント発生時に処理を追加する</b></h2>
<p>　イベント発生時に処理を追加するには、あらかじめ実行したいスクリプトを作成しファイルとして保存しておきます。次にイベントを設定するスクリプトではapp.notifiersEnabledにtrueを設定します。trueを設定しないとイベント発生時の処理は行われません。次にアプリケーションオブジェクトのnotifiersオブジェクトのadd()メソッドを使って処理を追加します。add()メソッドの最初のパラメーターにはイベントIDを示す文字列を指定します。2番目のパラメーターにはイベント発生時に実行するファイルオブジェクトを指定します。</p>
<p>　イベントIDはPhotoshopのリファレンスにも掲載されていますが、全てのイベントIDが掲載されているわけではありません。目的のイベントIDを求めるにはScripting Listenerプラグインを利用します。Scripting Listenerプラグインを使い目的の操作を行います。するとデスクトップにScriptingListenerJS.logというファイル名が生成されます。これをテキストエディタで開きます。開いたらexecuteActionという文字列を探します。例えば以下のような行を探します。</p>
<pre><code>executeAction( idMk, desc4, DialogModes.NO );</code></pre>
<p>　executeActionの最初のパラメーターの変数名に注目します。上記の場合idMkです。このidMkを検索します。例えば以下のような行が検索されます。</p>
<pre><code>var idMk = charIDToTypeID( "Mk  " );</code></pre>
<p>　ここでcharIDToTypeIDで指定されている文字列に注目します。この文字列がイベントIDになります。app.notifiers.add()の最初のパラメーターに指定する文字列が、このイベントIDになります。</p>
<p>　なお、app.notifiers.add()は、すでに同じイベントが設定されている場合に追加しようとするとエラーになります。このエラーを回避するにはtry...catchを使います。</p>
<p>
<span><b>※Scripting Listenerプラグインの入手先</b></span>
</p>
<p>
<a href="http://helpx.adobe.com/jp/photoshop/kb/plug-ins-photoshop-cs61.html%23id_68969">http://helpx.adobe.com/jp/photoshop/kb/plug-ins-photoshop-cs61.html#id_68969</a>
</p>
<p>【sample】イベント発生時に処理を追加する（sample.jsx）</p>
<pre><code>// ドキュメントが新規作成された場合、自動的にレイヤーを追加する
app.notifiersEnabled = true;
var fileObj = new File("～/Desktop/addLayer.jsx");
try{
    app.notifiers.add("Mk  ", fileObj);
    alert(app.notifiers.length);
}catch(e){}</code></pre>
<p>【sample】新規にレイヤーを追加し現在の日付を入れる（addLayer.jsx）</p>
<pre><code>// 新規にレイヤーを追加し現在の日付を入れる
(function(){
    var layObj = app.activeDocument.artLayers.add();
    var dateObj = new Date();
    var y = dateObj.getFullYear();
    var m = dateObj.getMonth()+1;
    var d = dateObj.getDate();
    layObj.name = y+"/"+m+"/"+d;
})();</code></pre>
<p>　設定されているイベント処理の総数がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】設定されているイベント処理の総数が表示される</figcaption>
<img src="images/00031.jpeg" />
</figure>
<p>　スクリプト実行後に新規にドキュメントを作成します。</p>
<figure>
<figcaption>【図】スクリプト実行後に新規にドキュメントを作成する</figcaption>
<img src="images/00171.jpeg" />
</figure>
<p>　すると自動的に新規レイヤーが作成され、レイヤー名が現在の日付に設定されます。</p>
<figure>
<figcaption>【図】自動的に新規レイヤーが作成され、レイヤー名が現在の日付に設定される</figcaption>
<img src="images/00314.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-591">
<section>
<h2 id="calibre_link-396"><b>20-3　全てのイベント処理を削除する</b></h2>
<p>　全てのイベント処理を削除するにはアプリケーションオブジェクトのnotifiersオブジェクトのremoveAll()メソッドを使います。removeAll()メソッドはイベントが設定されていない場合に実行してもエラーにはなりません。</p>
<p>【sample】全てのイベント処理を削除する</p>
<pre><code>// 全てのイベント処理を削除する
var n = app.notifiers.length;
app.notifiers.removeAll();
alert(n+"個のイベントを削除しました");</code></pre>
<p>　削除したイベントの数がアラートダイアログに表示されます。</p>
<figure>
<figcaption>【図】削除したイベントの数が表示される</figcaption>
<img src="images/00444.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-676">
<section>
<div>
<h1 id="calibre_link-397"><b>第21章　アクション／バッチ</b></h1>
</div>
</section>
</div>
<div id="calibre_link-532">
<section>
<h2 id="calibre_link-398"><b>21-1　アクションを実行する</b></h2>
<p>　アクションを実行するにはアプリケーションオブジェクトのdoAction()メソッドを使います。最初のパラメーターに実行するアクションの名前を指定します。2番目のパラメーターにはアクションが入っているフォルダ（アクションパネルにおけるフォルダ）名を指定します。</p>
<p>【sample】全てのイベント処理を削除する</p>
<pre><code>// アクションを実行する
app.doAction("水面 (文字)", "初期設定のアクション");</code></pre>
<p>　アクションを実行する前の画像とアクションパネルです。</p>
<figure>
<figcaption>【図】アクションを実行する前の画像とアクションパネル</figcaption>
<img src="images/00582.jpeg" />
</figure>
<p>　スクリプトを実行すると初期設定のアクションフォルダ内にある水面（文字）のアクションが実行されます。実行後は処理したアクション名がハイライトされます。</p>
<figure>
<figcaption>【図】スクリプトを実行後、初期設定のアクションフォルダ内の水面アクションが実行される</figcaption>
<img src="images/00065.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-562">
<section>
<h2 id="calibre_link-399"><b>21-2　バッチ処理を実行する</b></h2>
<p>　バッチ処理を実行するにはアプリケーションオブジェクトのbatch()メソッドを使います。最初のパラメーターに処理するファイルオブジェクトを入れた配列を指定します。2番目のパラメーターには実行するアクションの名前を指定します。3番目のパラメーターにはアクションが入っているフォルダ（アクションパネルにおけるフォルダ）名を指定します。4番目のパラメーターにはBatchOptionsオブジェクトを指定します。なお、4番目のパラメーターは省略できますが、他のパラメーターは省略できません。</p>
<p>　BatchOptionsオブジェクトを利用した場合については次項を参照してください。</p>
<p>【sample】バッチ処理を実行する</p>
<pre><code>// バッチ処理を実行する
var imageFolder = new Folder("～/Desktop/images/");  // デスクトップのimagesフォルダ
var fileList = imageFolder.getFiles("*.jpg");   // JPEGファイルのみ処理する
app.batch(fileList, "クワドラントカラー", "初期設定のアクション");</code></pre>
<p>　スクリプトを実行するとデスクトップのimagesフォルダ内にあるJPEGファイルが読み込まれ、クワドラントカラーのアクションが実行されます。BatchOptionsオブジェクトでオプションを指定していない場合は、処理されたファイルは開かれたままになります。</p>
<figure>
<figcaption>【図】JPEGファイルが読み込まれ、クワドラントカラーのアクションが実行される</figcaption>
<img src="images/00211.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-672">
<section>
<h2 id="calibre_link-400"><b>21-3　オプションを指定してバッチ処理を実行する</b></h2>
<p>　オプションを指定してバッチ処理を実行するにはアプリケーションオブジェクトのbatch()メソッドの4番目のパラメーターにBatchOptionsオブジェクトを指定します。BatchOptionsオブジェクトは「【表】バッチ処理時のオプション」に示すオプションを指定することができます。</p>
<table>
<caption>【表】バッチ処理時のオプション</caption>
<tbody>
<tr>
  <td>
    <span>オプション</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>destination</td>
  <td>実行後の処理（【表】実行後の処理方法を参照）</td>
</tr>
<tr>
  <td>destinationFolder</td>
  <td>実行後の保存先フォルダ（フォルダオブジェクト）</td>
</tr>
<tr>
  <td>errorFile</td>
  <td>エラー発生時のログの保存ファイル（ファイルオブジェクト）。ファイルに保存しない場合は空にする。</td>
</tr>
<tr>
  <td>fileNaming</td>
  <td>ファイル名の命名規則（【表】ファイル名の命名規則を参照）</td>
</tr>
<tr>
  <td>macintoshCompatible</td>
  <td>Mac OSとの互換性を維持（true：する、false：しない）</td>
</tr>
<tr>
  <td>windowsCompatible</td>
  <td>Windowsとの互換性を維持（true：する、false：しない）</td>
</tr>
<tr>
  <td>unixCompatible</td>
  <td>UNIXとの互換性を維持（true：する、false：しない）</td>
</tr>
<tr>
  <td>overrideOpen</td>
  <td>開くコマンドを無視（true：無視する、false：無視しない）</td>
</tr>
<tr>
  <td>overrideSave</td>
  <td>"別名で保存"コマンドを省略（true：省略する、false：省略しない）</td>
</tr>
<tr>
  <td>startingSerial</td>
  <td>開始シリアル番号</td>
</tr>
<tr>
  <td>suppressOpen</td>
  <td>開くコマンドを無視（true：無視、false：無視しない）</td>
</tr>
<tr>
  <td>suppressProfile</td>
  <td>カラープロファイル警告を非表示（true：非表示、false：表示）</td>
</tr>
</tbody>
</table>
<p>※destinationFolder、fileNaming、macintoshCompatible、overrideSave、startingSerial、unixCompatible、windowsCompatibleオプションはdestinationオプションでBatchDestinationType.FOLDERが指定された場合のみ有効。</p>
<table>
<caption>【表】実行後の処理方法</caption>
<tbody>
<tr>
  <td>
    <span>パラメーター</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>BatchDestinationType.FOLDER</td>
  <td>フォルダ</td>
</tr>
<tr>
  <td>BatchDestinationType.NODESTINATION</td>
  <td>なし</td>
</tr>
<tr>
  <td>BatchDestinationType.SAVEANDCLOSE</td>
  <td>保存して閉じる</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】ファイル名の命名規則</caption>
<tbody>
<tr>
  <td>パラメーター</td>
  <td>内容</td>
</tr>
<tr>
  <td>FileNamingType.DDMM</td>
  <td>ddmm（日付）</td>
</tr>
<tr>
  <td>FileNamingType.DDMMYY</td>
  <td>ddmmyy（日付）</td>
</tr>
<tr>
  <td>FileNamingType.DOCUMENTNAMELOWER</td>
  <td>ドキュメントの名前（小文字）</td>
</tr>
<tr>
  <td>FileNamingType.DOCUMENTNAMEMIXED</td>
  <td>ドキュメントの名前</td>
</tr>
<tr>
  <td>FileNamingType.DOCUMENTNAMEUPPER</td>
  <td>ドキュメントの名前（大文字）</td>
</tr>
<tr>
  <td>FileNamingType.EXTENSIONLOWER</td>
  <td>拡張子（小文字）</td>
</tr>
<tr>
  <td>FileNamingType.EXTENSIONUPPER</td>
  <td>拡張子（大文字）</td>
</tr>
<tr>
  <td>FileNamingType.MMDD</td>
  <td>mmdd（日付）</td>
</tr>
<tr>
  <td>FileNamingType.MMDDYY</td>
  <td>mmddyy（日付）</td>
</tr>
<tr>
  <td>FileNamingType.SERIALLETTERLOWER</td>
  <td>シリアル文字（a, b, c...）</td>
</tr>
<tr>
  <td>FileNamingType.SERIALLETTERUPPER</td>
  <td>シリアル文字（A, B, C...）</td>
</tr>
<tr>
  <td>FileNamingType.SERIALNUMBER1</td>
  <td>1桁のシリアル番号</td>
</tr>
<tr>
  <td>FileNamingType.SERIALNUMBER2</td>
  <td>2桁のシリアル番号</td>
</tr>
<tr>
  <td>FileNamingType.SERIALNUMBER3</td>
  <td>3桁のシリアル番号</td>
</tr>
<tr>
  <td>FileNamingType.SERIALNUMBER4</td>
  <td>4桁のシリアル番号</td>
</tr>
<tr>
  <td>FileNamingType.YYDDMM</td>
  <td>yyddmm（日付）</td>
</tr>
<tr>
  <td>FileNamingType.YYMMDD</td>
  <td>yymmdd（日付）</td>
</tr>
<tr>
  <td>FileNamingType.YYYYMMDD</td>
  <td>yyyymmdd（日付）</td>
</tr>
</tbody>
</table>
<p>※DDは日にち、MMは月、YYは2桁の西暦年、YYYYは4桁の西暦年を示す</p>
<p>【sample】オプションを指定してバッチ処理を実行する</p>
<pre><code>// オプションを指定してバッチ処理を実行する
var srcFolder = new Folder("～/Desktop/images/");  // デスクトップのimagesフォルダ
var fileList = srcFolder.getFiles("*.psd");   // PSDファイルのみ処理する
var opt = new BatchOptions();
opt.destination = BatchDestinationType.SAVEANDCLOSE;    // 保存して閉じる
app.batch(fileList, "クワドラントカラー", "初期設定のアクション", opt);</code></pre>
<p>　スクリプトを実行するとデスクトップのimagesフォルダ内にあるPSDファイルが読み込まれ処理されます。</p>
<figure>
<figcaption>【図】imagesフォルダ内にあるPSDファイルが読み込まれ処理される</figcaption>
<img src="images/00345.jpeg" />
</figure>
<p>　処理後は同じフォルダ内に画像が同じファイル名で保存されます。</p>
<figure>
<figcaption>【図】処理後は同じフォルダ内に画像が同じファイル名で保存される</figcaption>
<img src="images/00478.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-646">
<section>
<h2 id="calibre_link-401"><b>21-4　メニューを実行する</b></h2>
<p>　メニューを実行するにはアプリケーションオブジェクトのrunMenuItem()メソッドを使います。runMenuItem()メソッドのパラメーターにはmenu IDを指定します。menu IDはstringIDToTypeID()メソッドを使って指定します。全てのmenu IDが使用できるわけではありませんが下記ページに記載されている文字列を指定することで、ある程度のメニュー項目を実行することができます。なお、Paletteと表記されている文字列は必要に応じてPanelに置き換えないと動作しない可能性もあります。</p>
<p>
<a href="http://www.pcpix.com/Photoshop/value.htm">http://www.pcpix.com/Photoshop/value.htm</a>
</p>
<p>
<br />
</p>
<p>　また、stringIDToTypeID()メソッドでなくcharIDToTypeID()メソッドを使ってmenu IDを指定することもできます。パラメーターとして指定できるmenu IDについては以下のページを参照してください。</p>
<p>
<a href="http://www.pcpix.com/Photoshop/enum.htm">http://www.pcpix.com/Photoshop/enum.htm</a>
</p>
<table>
<caption>【表】stringIDToTypeID()メソッドに指定できるmenuID（一部のみ掲載）</caption>
<tbody>
<tr>
  <td>
    <span>menuID</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>screenModeFullScreenWithMenubar</td>
  <td>メニューバー付きのフルスクリーン（全画面）モード</td>
</tr>
<tr>
  <td>screenModeStandard</td>
  <td>標準のモード</td>
</tr>
<tr>
  <td>screenModeFullScreen</td>
  <td>フルスクリーン（全画面）モード</td>
</tr>
<tr>
  <td>saveForWeb</td>
  <td>Web用に保存</td>
</tr>
<tr>
  <td>swatchesSave</td>
  <td>スウォッチの保存</td>
</tr>
<tr>
  <td>toggleGrid</td>
  <td>グリッド表示を交互に切り替え</td>
</tr>
<tr>
  <td>toggleHistoryPalette</td>
  <td>ヒストリーパネル表示を交互に切り替え</td>
</tr>
<tr>
  <td>toggleInfoPalette</td>
  <td>情報パネル表示を交互に切り替え</td>
</tr>
<tr>
  <td>toggleLockGuides</td>
  <td>ガイドのロックを交互に切り替え</td>
</tr>
<tr>
  <td>toggleLayerMask</td>
  <td>レイヤーマスク表示を交互に切り替え（レイヤーマスクがないとエラー）</td>
</tr>
<tr>
  <td>toggleNavigatorPalette</td>
  <td>ナビゲーターパネル表示を交互に切り替え</td>
</tr>
<tr>
  <td>toggleOptionsPalette</td>
  <td>オプションパネル表示を交互に切り替え</td>
</tr>
<tr>
  <td>toggleRulers</td>
  <td>ルーラー（定規）表示を交互に切り替え</td>
</tr>
<tr>
  <td>toggleToolsPalette</td>
  <td>ツールパネル表示を交互に切り替え</td>
</tr>
<tr>
  <td>toggleColorPalette</td>
  <td>カラーパネル表示を交互に切り替え</td>
</tr>
<tr>
  <td>toggleChannelsPalette</td>
  <td>チャンネルパネル表示を交互に切り替え</td>
</tr>
<tr>
  <td>togglePathsPalette</td>
  <td>パスパネル表示を交互に切り替え</td>
</tr>
<tr>
  <td>toggleSwatchesPalette</td>
  <td>スウォッチパネル表示を交互に切り替え</td>
</tr>
<tr>
  <td>toggleLayersPalette</td>
  <td>レイヤーパネル表示を交互に切り替え</td>
</tr>
<tr>
  <td>actualPixels</td>
  <td>表示メニューの「100%」</td>
</tr>
<tr>
  <td>zoomIn</td>
  <td>表示メニューの「ズームイン」</td>
</tr>
<tr>
  <td>zoomOut</td>
  <td>表示メニューの「ズームアウト」</td>
</tr>
</tbody>
</table>
<table>
<caption>【表】charIDToTypeID()メソッドに指定できるmenuID（一部のみ掲載）</caption>
<tbody>
<tr>
  <td>
    <span>menuID</span>
  </td>
  <td>
    <span>内容</span>
  </td>
</tr>
<tr>
  <td>ActP</td>
  <td>表示メニューの「100%」</td>
</tr>
<tr>
  <td>FtOn</td>
  <td>表示メニューの「画面サイズに合わせる」</td>
</tr>
<tr>
  <td>ZmIn</td>
  <td>表示メニューの「ズームイン」</td>
</tr>
<tr>
  <td>ZmOt</td>
  <td>表示メニューの「ズームアウト」</td>
</tr>
</tbody>
</table>
<p>【sample】メニューを実行する</p>
<pre><code>// メニューを実行する
app.runMenuItem(stringIDToTypeID( "toggleHistoryPalette"));  // ヒストリーパネル表示を交互に切り替え
app.runMenuItem(stringIDToTypeID("toggleGrid"));    // グリッド表示を交互に切り替え
app.runMenuItem(stringIDToTypeID("saveForWeb"));    // Web用に保存ダイアログを表示
app.runMenuItem(stringIDToTypeID("swatchesSave")); // スウォッチの保存
app.runMenuItem(charIDToTypeID("ActP"));    // 100%表示にする</code></pre>
<p>　スクリプトを実行するとヒストリーパネルの表示／非表示が切り替わります。</p>
<figure>
<figcaption>【図】スクリプトを実行するとヒストリーパネルの表示／非表示が切り替わる</figcaption>
<img src="images/00284.jpeg" />
</figure>
<p>　続いてグリッドの表示／非表示が切り替わります。</p>
<figure>
<figcaption>【図】グリッドの表示／非表示が切り替わる</figcaption>
<img src="images/00105.jpeg" />
</figure>
<p>　次に、Web用に保存ダイアログが表示されます。</p>
<figure>
<figcaption>【図】Web用に保存ダイアログが表示される</figcaption>
<img src="images/00359.jpeg" />
</figure>
<p>　最後にスウォッチの保存ダイアログが表示されます。</p>
<figure>
<figcaption>【図】スウォッチの保存ダイアログが表示される</figcaption>
<img src="images/00382.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-688">
<section>
<div>
<h1 id="calibre_link-402"><b>第22章　映像／ビデオ</b></h1>
</div>
</section>
</div>
<div id="calibre_link-614">
<section>
<h2 id="calibre_link-403"><b>22-1　ビデオファイル（映像ファイル）を読み込む</b></h2>
<p>　ビデオファイル（映像ファイル）を読み込むにはappオブジェクトのopen()メソッドまたはload()メソッドを使います。どちらのメソッドもパラメーターに読み込むビデオファイルのファイルオブジェクトを指定します。サンプルでは選択したビデオファイルを新規ドキュメントとして開きます。</p>
<p>　なお、Photoshopで認識できないビデオファイルを開くことはできません。</p>
<p>【sample】ビデオファイル（映像ファイル）を読み込む</p>
<pre><code>// ビデオファイルを読み込む
var fileObj = File.openDialog("ビデオファイルを選択してください");
if (fileObj){
    app.open(fileObj);
}</code></pre>
<p>　ファイル選択ダイアログが表示されるので、ビデオファイルを選択します。</p>
<figure>
<figcaption>【図】ファイル選択ダイアログが表示されるので、ビデオファイルを選択する</figcaption>
<img src="images/00432.jpeg" />
</figure>
<p>　選択したビデオファイルが開かれ表示されます。</p>
<figure>
<figcaption>【図】選択したビデオファイルが開かれ表示される</figcaption>
<img src="images/00011.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-432">
<section>
<h2 id="calibre_link-404"><b>22-2　タイムラインの時間インジケーターを指定した秒数に移動する</b></h2>
<p>　ビデオファイルでタイムラインの時間インジケーターを指定した秒数に移動するにはScripting Listenerを使って一度操作を記録します。そのままでは指定された秒数にしか設定できないため、記録されたスクリプトを変更します。秒数の設定はputInteger()メソッドで整数値として設定されているため、2.5秒など小数値を使った指定が無効になります。そこで、浮動小数値を指定できるようにputInteger()メソッドでなくputDouble()メソッドに変更します。これにより指定した秒数に時間インジケーターが移動します。</p>
<p>【sample】タイムラインの時間インジケーターを指定した秒数に移動する</p>
<pre><code>// タイムラインの時間インジケーターを指定した秒数に設定する
setTime(2.5, 29.97); // 2.5秒(29.97fps)に設定
// 指定した秒数にCTMを移動する関数
function setTime(sec, fRate){
    var idsetd = charIDToTypeID("setd");
    var desc1 = new ActionDescriptor();
    var idnull = charIDToTypeID("null");
    var ref1 = new ActionReference();
    var idPrpr = charIDToTypeID("Prpr");
    var idtime = stringIDToTypeID("time");
    ref1.putProperty(idPrpr, idtime);
    var idtimeline = stringIDToTypeID("timeline");
    ref1.putClass(idtimeline);
    desc1.putReference(idnull, ref1);
    var idT = charIDToTypeID("T   ");
    // 秒数を設定する
    var desc2 = new ActionDescriptor();
    var idseconds = stringIDToTypeID("seconds");
    desc2.putDouble(idseconds, sec);   // 秒数を設定する
    var idframeRate = stringIDToTypeID("frameRate");
    desc2.putDouble(idframeRate, fRate);    // フレームレートを設定する
    var idtimecode = stringIDToTypeID("timecode");
    desc1.putObject(idT, idtimecode, desc2);
    executeAction(idsetd, desc1, DialogModes.NO);
}</code></pre>
<p>　タイムラインの時間インジケーターが指定した時間に移動します。</p>
<figure>
<figcaption>【図】タイムラインの時間インジケーターが指定した時間に移動する</figcaption>
<img src="images/00088.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-648">
<section>
<h1 id="calibre_link-405">◎著者紹介</h1>
<p><b>古籏 一浩<span>（ふるはた かずひろ）</span></b></p>
<p>　JavaScript関係の本を多数執筆。この本で58冊目、自動化関係の本としては6冊目となる。他にも自動化関連の本を出したいと考えている。本の執筆以外にも4K映像など、いろいろ手がけている。</p>
<p>Web：http://www.openspc2.org/</p>
<p>
<br />
</p>
<p>◎本書スタッフ</p>
<p>アートディレクター/装丁：　岡田 章志＋GY</p>
<p>編集：　種村嘉彦+ピーチプレス</p>
</section>
</div>
<div id="calibre_link-571">
<section>
<h1 id="calibre_link-713"><b>●本書の内容についてのお問い合わせ先</b></h1>
<p>株式会社インプレスR&amp;D　メール窓口</p>
<p>
<a href="mailto:np-info@impress.co.jp">np-info@impress.co.jp</a>
</p>
<p>件名に「『本書名』問い合わせ係」と明記してお送りください。</p>
<p>電話やFAX、郵便でのご質問にはお答えできません。返信までには、しばらくお時間をいただく場合があります。なお、本書の範囲を超えるご質問にはお答えしかねますので、あらかじめご了承ください。</p>
<p>また、本書の内容についてはNextPublishingオフィシャルWebサイトにて情報を公開しております。</p>
<p>
<a href="http://nextpublishing.jp">http://nextpublishing.jp</a>/</p>
</section>
</div>
<div id="calibre_link-540">
<section>
<p>Adobe JavaScriptシリーズ</p>
</section>
</div>
<div id="calibre_link-580">
<section>
<h1 id="calibre_link-714">Photoshop自動化基本編</h1>
<hr />
<p>2015年4月24日　初版発行Ver.1.0（リフロー版）</p>
<dl>
<dt>著　者</dt>
<dd>古籏 一浩</dd>
<dt>編集人</dt>
<dd>桜井 徹</dd>
<dt>発行人</dt>
<dd>井芹 昌信</dd>
<dt>発　行</dt>
<dd>株式会社インプレスR&amp;D<br />
〒101-0051<br />
東京都千代田区神田神保町一丁目105番地<br /><a href="http://nextpublishing.jp/">http://nextpublishing.jp/</a></dd>
</dl>
<hr />
<p>◉本書は著作権法上の保護を受けています。本書の一部あるいは全部について株式会社インプレスR&amp;Dから文書による許諾を得ずに、いかなる方法においても無断で複写、複製することは禁じられています。</p>
<p>©2015 Kazuhiro Furuhata, All rights reserved.</p>
<p>ISBN978-4-8443-9649-9</p>
<p>
<br />
</p>
<figure>
<img src="images/00285.jpeg" />
</figure>
</section>
</div>
<div id="calibre_link-667">
<section>
<hgroup>
<h1 id="calibre_link-715"><b>［ 好評既刊 ］NextPublishing</b></h1>
<h2 id="calibre_link-716"><b>◎インプレスR&amp;D</b></h2>
</hgroup>
<hr />
</section>
</div>
<div id="calibre_link-623">
<section>
<h2 id="calibre_link-717"><b>Illustrator自動化基本編</b></h2>
<h3 id="calibre_link-718"><b></b></h3>
<p>◎古籏 一浩　著</p>
<p>◎印刷書籍版：B5正寸判／568ページ／小売希望価格 3,800円（税別）</p>
<p>◎電子書籍版：EPUB3/PDF／小売希望価格 2,800円（税別）</p>
<p>◎ISBN：978-4-8443-9649-9</p>
<hr />
</section>
</div>
<div id="calibre_link-611">
<section>
<h2 id="calibre_link-719"><b>Adobe JavaScriptリファレンス</b></h2>
<h3 id="calibre_link-720"><b></b></h3>
<p>◎古籏 一浩　著</p>
<p>◎印刷書籍版：B5正寸判／550ページ／小売希望価格 4,700円（税別）</p>
<p>◎電子書籍版：EPUB3/PDF／小売希望価格 3,200円（税別）</p>
<p>◎ISBN：978-4-8443-9595-9</p>
<hr />
</section>
</div>
<div id="calibre_link-49">
<section>
<h2 id="calibre_link-721"><b>ExtendScript Toolkit（ESTK）基本編</b></h2>
<h3 id="calibre_link-722"><b>Adobe JavaScript開発の必須ツール</b></h3>
<p>◎古籏 一浩　著</p>
<p>◎印刷書籍版：A5正寸判／380ページ／小売希望価格 3,000円（税別）</p>
<p>◎電子書籍版：EPUB3/PDF／小売希望価格 1,900円（税別）</p>
<p>◎ISBN：978-4-8443-9613-0</p>
<hr />
</section>
</div>
<div id="calibre_link-556">
<section>
<h2 id="calibre_link-723"><b>HTMLとCSS、JavaScriptで作る、リッチなiBooks電子書籍</b></h2>
<h3 id="calibre_link-724"><b></b></h3>
<p>◎久松 慎一　著</p>
<p>◎印刷書籍版：B5変型版／221ページ／小売希望価格 2,400円（税別）</p>
<p>◎電子書籍版：EPUB3/PDF／小売希望価格 1,600円（税別）</p>
<p>◎ISBN：978-4-8443-9610-9</p>
<hr />
</section>
</div>
<div id="calibre_link-4">
<section>
<h2 id="calibre_link-725"><b>ゲームを作りながら楽しく学べるHTML5+CSS+JavaScriptプログラミング</b></h2>
<h3 id="calibre_link-726"><b></b></h3>
<p>◎田中 賢一郎　著</p>
<p>◎印刷書籍版：B5正寸版／326ページ／小売希望価格 2,500円（税別）</p>
<p>◎電子書籍版：EPUB3/PDF／小売希望価格 1,500円（税別）</p>
<p>◎ISBN：978-4-8443-9596-6</p>
<hr />
</section>
</div>
<div id="calibre_link-445">
<section>
<hgroup>
<h1 id="calibre_link-727"><b>［ 既刊一覧 ］NextPublishing</b></h1>
<h2 id="calibre_link-728"><b>◎インプレスR&amp;D</b></h2>
</hgroup>
<ul>
<li>プロフェッショナルのためのGoogleアナリティクス完全マニュアル Ver.5対応版　<span>◎ 衣袋 宏美［著］</span></li>
<li>Visual BasicによるKinect基本プログラミング　<span>◎ 薬師寺 国安［著］</span></li>
<li>今、見直すHTML　<span>◎ 林 拓也［著］</span></li>
<li>今、見直すCSS　<span>◎ 林 拓也［著］</span></li>
<li>Objective-Cの要点　<span>◎ 柴田 文彦［著］</span></li>
<li>OpenStack Swiftによるオブジェクトストレージ入門　<span>◎ 山縣 陽［著］</span></li>
<li>CloudStack実践ガイド［前編］［後編］　<span>◎ 大削 緑［著］</span></li>
<li>［改訂新版］SDN/OpenFlowで進化する仮想ネットワーク入門　<span>◎ 伊勢 幸一［著］</span></li>
<li>1日で読めてわかるTCP/IPのエッセンス　<span>◎ 榊 正憲［著］</span></li>
<li>Internet of Everythingの衝撃　<span>◎ シスコシステムズ合同会社　IoTインキュベーションラボ［著］</span></li>
<li>クラウドソーシングの衝撃　<span>◎ 比嘉 邦彦／井川 甲作［著］</span></li>
<li>実践クラウドソーシング　<span>◎ 松浦 拓平／吉村 恭輔／後藤 匠／井川 甲作［著］</span></li>
<li>顧客を知るためのデータマネジメントプラットフォーム　DMP入門　<span>◎ 横山 隆治／菅原 健一／草野 隆史［著］</span></li>
<li>日本の電子出版を創ってきた男たち　<span>◎ OnDeck編集部［編］</span></li>
<li>知らないと始められない電子出版最新用語集　<span>◎ OnDeck編集部［編］</span></li>
<li>電子書籍端末の最新技術　<span>◎ 藤原 隆弘［著］</span></li>
<li>Facebookは初期設定で使うな！　<span>◎ インプレスジャパン編集部［編］</span></li>
<li>Gmailは初期設定で使うな！　<span>◎ インプレスジャパン編集部［編］</span></li>
<li>LINE＆Twitterは初期設定で使うな！　<span>◎ インプレスジャパン編集部［編］</span></li>
<li>Aterm MR03LN超入門　<span>◎ 村上 俊一［著］</span></li>
<li>SIMフリー超入門 iPhone編／Android編　<span>◎ 武井 一巳［著］</span></li>
<li>MacでWindowsを使う本　<span>◎ 向井 領治［著］</span></li>
<li>おとなが読んで・知って・まもる　こどもiPad　<span>◎ 吉田 メグミ［著］</span></li>
</ul>
</section>
</div>




<script>function myFunction(){document.getElementById("tateyoko").classList.toggle("tateread")}</script></body></html>