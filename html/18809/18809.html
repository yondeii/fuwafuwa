<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>基礎Visual Basic 2015 基礎シリーズ</title>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/css/mainday.css" title="default">
<link rel="alternate stylesheet" href="/css/mainnight.css" title="alternate">
<script type="text/javascript" src="/js/styleswitcher.js"></script>
<script type="text/javascript" src="/js/global.js"></script>
</head>
<body>
<div class="novelpage">
<div class="novelbody">
<div id="tateyoko">
<div id="_top"></div>
<a href="/">🏠</a>&emsp;
<a href="#" onclick="setActiveStyleSheet('default'); return false;">日</a>&emsp;
<a href="#" onclick="setActiveStyleSheet('alternate'); return false;">月</a>&emsp;
<a href="#_top" onclick="myFunction()" style="cursor: pointer;">縦書き／横書き</a>
<div id="calibre_link-313">
<div>
<div>
<table class="noveltitle">
<tr>
<td colspan="2"><i><span><i>基礎Visual Basic 2015 基礎シリーズ</i></span></i></td>
</tr>
<tr>
                    
                    
      </tr>
<tr>
<td colspan="2">羽山 博</td>
</tr>
<tr>
<td colspan="2"> (2016)</td>
</tr>
<tr>
<td colspan="2"></td>
</tr>
</table>
<div></div>
</div>
<div></div>
</div>
</div>



<div id="calibre_link-63">
<div>
<div>
<p><span>●本書の内容は、2016年<span>1</span>月の情報に基づいています。記載したURLやサービス内容などは、予告なく変更される可能性があります。</span></p>
</div>
<div>
<p><span>●本書の内容によって生じる直接的または間接的被害について、著者ならびに弊社では一切の責任を負いかねます。</span></p>
</div>
<div>
<p><span>●Microsoft、Visual Studio、Visual Basicは、米国および他の国におけるMicrosoft Corporationの商標または登録商標です。</span></p>
</div>
<div>
<p><span>●本書中の社名、製品・サービス名などは、一般に各社の商標、または登録商標です。本文中に<img src="images/00021.jpeg" alt="" />、<img src="images/00086.jpeg" alt="" />、<img src="images/00045.jpeg" alt="" />は表示していません。</span></p>
</div>
</div>
</div>
<div id="calibre_link-343">
<div>
<div id="calibre_link-66">
<div>
<p><span><b>はじめに</b></span></p>
</div>
</div>
<hr />
<p>　この本は、Visual Basicというプログラミング言語を使ってプログラミングを学ぼうとするすべての人のために書かれたものです。Windowsのデスクトップアプリケーションを作成しながら少しずつステップアップしていくので、プログラミングがはじめての人にも無理なく理解でき、しっかりとした実力が付くような構成、内容になっています。</p>
<p>　Visual Basicを利用すると、フォームと呼ばれる「台紙」にコントロールと呼ばれる「部品」をペタペタと貼り付けていく感覚でプログラムがデザインできます。プログラミングには難しいとか大変だというイメージがあるかもしれませんが、Visual Basicはそういったイメージを完全に払拭してくれます。プログラミングって何て楽しいんだ！ と感動する人も多いと思います。</p>
<p>　一般的な入門書にはコントロールの使い方や操作方法を少し説明しただけのものも多く見られます。いわば、ガイド付きのツアーに参加したような感じで、気軽に旅を楽しめるというわけです。しかし、それだけで終わりにするのは実にもったいない話です。また、本格的にプログラミングを身に付けようとしている人からは「使い方は分かったけど、自分でプログラミングしようとすると途方に暮れてしまう」という声も耳にします。</p>
<p>　実は「その先」がもっと面白いのです。</p>
<p>　プログラミングは、仕事に必要だという実用面での重要性もありますが、実は、最高に楽しい知的ゲームでもあるのです。</p>
<p>　旅先でのコミュニケーションには、やはり「言語」が欠かせません。まして、現地で仕事に就こうとするなら、簡単な挨拶程度の言語ではなく、きちんと意思を伝えられるだけの単語や文法の知識を身に付けている必要があります。プログラミングもそれと同じです。デザインしたフォームを自由自在に操るには言語の知識が欠かせません。そこで、この本では、Visual Basicの文法や処理のパターンにまで踏み込んで、そのしくみを詳しく解説しています。つまり、「入門」だけで終わるのではなく、その先に進むための「基礎」を身に付けようというわけです。といっても、何年かかってもなかなか身に付かない外国語と違って、Visual Basicの文法はきわめて簡単です。ほんの数時間から数日もあれば、誰でも基本はマスターできます。しかも、しっかりと学べば<span>10</span>年、いや<span>20</span>年、<span>30</span>年と食べていけるだけの基礎が身につきます。安心して、ぜひとも気楽に、そして、ちょっぴり将来への期待を抱きつつ読み進めていってください。</p>
<p>　最後になりましたが、この本を出版する機会を与えてくださった株式会社インプレス、コンピューターテクノロジー編集部の山本陽一編集長、いつも笑顔で仕事をバリバリとこなしてくださった編集担当の鈴木教之さん、伊藤隆司さん、ステキなイラストを描いてくださったサワダサワコさん、株式会社トップスタジオの藤田拓志さん、そのほか本書の出版にお力添えをくださった皆様方に心から感謝いたします。</p>
<p><br /></p>
<div>
<p>2016年<span>1</span>月　羽山　博</p>
</div>
</div>
</div>
<div id="calibre_link-334">
<div>
<div id="calibre_link-67">
<div><b>
<p><b>本書の読み方</b></p>
</b></div>
</div>
<hr />
<div><b>
<p><b>■ 対象読者</b></p>
</b></div>
<p>　本書は、プログラミングをこれから学びたいと考えている人のための本です。前提知識は特に必要ありません。さらに知識を定着させ、実践的なプログラムに取り組みたいという人にも適した内容になっています。</p>
<p><br /></p>
<div><b>
<p><b>■ 本書の記載内容</b></p>
</b></div>
<p>　本書は、2013年<span>3</span>月発行の『基礎Visual Basic 2012』をもとに、最新版の「Visual Studio Community 2015」に含まれるVisual Basicの機能に合わせ、加筆修正したものです。</p>
<p>　本書で取り扱うアプリケーションはWindowsデスクトップアプリケーションです。Windows<span>8</span>からは、タッチスクリーンなどでも快適に使える新しいスタイルのユニバーサルWindowsアプリ（ストアアプリ）が利用できるようになりました。ユニバーサルWindowsアプリは情報の検索を中心にタブレットなどでも気軽に使えるようになっています。しかし、これまでのWindowsアプリケーションと同様の機能と操作感を持つデスクトップアプリがなくなるわけではありません。とりわけ、業務用のアプリケーションなど、多くの詳細な項目を表示したり、入力したりするプログラムはこれまでと同様、あるいはそれ以上に幅広く使われるはずです。本書では、そういったデスクトップアプリケーションを作成するための基礎を詳しく説明しています。</p>
<div>
<div>
<p>注意：本書で取り扱う内容はWindowsデスクトップアプリケーションの作り方です。ユニバーサルWindowsアプリは取り扱っていないのでご注意ください。</p>
</div>
</div>
<p><br /></p>
<div><b>
<div><b>
<p><b>■ 本書の構成</b></p>
</b></div>
</b></div>
<p>　本書は、全体が<span>3</span>つのPartに分かれており、それぞれのPartにいくつかのChapterがあります。Part<span>1</span>は、いわばガイド付きのツアーです。ここでVisual Studioのひととおりの使い方やプログラミングの流れが分かります。Part<span>2</span>は「その先」にあたるものです。ここでは、文法や処理のパターンなどを詳しく説明し、それらを利用した基本的なサンプルプログラムを作成します。Part<span>3</span>では、より実践的なサンプルプログラムの作成を通して、本格的なプログラミングに取り組みます。</p>
<p>　本書の中心となるPart<span>2</span>では、解説の知識をしっかりと身に付けるための確認問題を用意し、さらに、身に付けた知識を実践に移せるように、サンプルプログラムを作り上げていくプロセスを詳しく解説しています。したがって、流れにそって読み進めていけば無理なく着実に力が付けられるはずです。</p>
<p>各章の内容は以下のようになっています。</p>
<p><br /></p>
<p><br /></p>
<p><span><b>Part<span><b>1</b></span></b></span></p>
<p><span><b>Chapter<span><b>1</b></span>　Visual Basicプログラミングの準備</b></span></p>
<p>　プログラミングを学ぶにあたって、Visual Basicでどんなことができるかを見た後、Visual Studio Community 2015のインストール方法を説明します。</p>
<p><br /></p>
<p><span><b>Chapter<span><b>2</b></span>　はじめてのプログラミング</b></span></p>
<p>　Visual Basicのプログラムがどのような要素から成り立っているかを確認した後、簡単なプログラムを例に、フォームのデザインからプロパティの設定、コードの記述、プログラムの実行という流れを説明します。</p>
<p><br /></p>
<p><span><b>Part<span><b>2</b></span></b></span></p>
<p><span><b>Chapter<span><b>3</b></span>　数値や文字列を取り扱う</b></span></p>
<p>　プログラムのコードの書き方や、リテラル、変数、定数、代入、演算といった基本的な知識を身に付けます。主に、データの取り扱い方と計算の方法を説明します。</p>
<p><br /></p>
<p><span><b>Chapter<span><b>4</b></span>　条件によって処理を変える</b></span></p>
<p>　さまざまな状況に対応できるプログラムを作るために、条件によって処理の流れを変える方法を説明します。条件を組み合わせる方法についても詳しく見ていきます。</p>
<p><br /></p>
<p><span><b>Chapter<span><b>5</b></span>　処理を繰り返す</b></span></p>
<p>　同じパターンの処理を何度も実行できるようにするために、一定の回数の繰り返しやデータがなくなるまでの繰り返しなど、繰り返し処理のさまざまな方法を説明します。</p>
<p><br /></p>
<p><span><b>Chapter<span><b>6</b></span>　配列を利用する</b></span></p>
<p>　大量のデータを自由自在に処理するために、配列の利用方法を説明します。さらに、繰り返し処理との組み合わせについても詳しく説明し、より高度なプログラムが作成できるようにします。</p>
<p><br /></p>
<p><span><b>Chapter<span><b>7</b></span>　プロシージャを使ってコードをまとめる</b></span></p>
<p>　さまざまな場面で共通に使われる処理をSubプロシージャやFunctionプロシージャにまとめ、いつでも呼び出せるようにする方法を説明します。</p>
<p><br /></p>
<p><span><b>Chapter<span><b>8</b></span>　クラスを利用する</b></span></p>
<p>　人やモノをより自然に表せるように、クラスの考え方や定義、継承のしかた、オブジェクトの作成方法などを説明します。クラスを利用すると、プログラムの開発効率や保守性を高めることができます。</p>
<p><br /></p>
<p><span><b>Part<span><b>3</b></span></b></span></p>
<p><span><b>Chapter<span><b>9</b></span>　ファイルを取り扱う　〜Fortuneプログラム</b></span></p>
<p>　ファイルに保存されたデータを読み出したり、ファイルにデータを書き込むプログラムを作成し、データを効果的に活用できるようにします。</p>
<p><br /></p>
<p><span><b>Chapter<span><b>10</b></span>　データベースを取り扱う　〜アイディアプロセッサ</b></span></p>
<p>　より柔軟にデータが取り扱えるように、データベースを利用したプログラムを作成します。データの検索、更新、追加、削除が自由にできるようにします。</p>
<p><br /></p>
<p><span><b>付録　確認問題と練習問題の解答</b></span></p>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>■ 本書の表記</b></p>
</b></div>
<div>
<p><span><b>リスト</b></span>　<img src="images/00034.jpeg" alt="" />マークが付いた部分は、Visual Basicのソースコードを表しています。コードの中で、行が長くなり紙面に収まりきらない場合には右端に  マークを付け、行が続くことを表します。表示は複数行になっていますが、右端で改行せずにそのまま<span>1</span>行のコードとして続けて入力します。</p>
</div>
<p><br /></p>
<div>
<p><span><b>画面</b></span>　　画面には操作の説明が加えられています。<span><b>❶❷</b></span>......などの白抜きの数字が操作の手順、つまり「やるべきこと」を表しています。一方、<span><b>①②</b></span>......などの普通の丸数字は操作の結果「こうなります」ということを表しています。</p>
</div>
<p><br /></p>
<div>
<p><span><b>ＵＲＬ</b></span>　本書に記載されているURLは、執筆時点での情報です。これらのURLは変更される可能性があります。あらかじめご了承ください。</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<div><b>
<p><b>■ 動作環境</b></p>
</b></div>
</b></div>
<p>　Visual Studio Community 2015を利用してプログラムを作成するためには、以下のようなソフトウェア、ハードウェアが必要です。</p>
<p><br /></p>
<p><span><b>サポートされているオペレーティングシステム</b></span></p>
<div>
<p><span>●</span>Windows<span>7</span>（x<span>86</span>およびx<span>64</span>）</p>
</div>
<div>
<p><span>●</span>Windows<span>8</span>（x<span>86</span>およびx<span>64</span>）</p>
</div>
<div>
<p><span>●</span>Windows<span>8</span>.<span>1</span>（x<span>86</span>およびx<span>64</span>）</p>
</div>
<div>
<p><span>●</span>Windows<span>10</span>（x<span>86</span>およびx<span>64</span>）</p>
</div>
<div>
<p><span>●</span>Windows Server 2008 R<span>2</span>（x<span>64</span>）</p>
</div>
<div>
<p><span>●</span>Windows Server 2012 （x<span>64</span>）</p>
</div>
<p><br /></p>
<p><span><b>ハードウェア要件</b></span></p>
<div>
<p><span>●</span><span>1</span>.<span>6</span>GHzまたはそれ以上のプロセッサ</p>
</div>
<div>
<p><span>●</span>1024MB RAM（仮想マシン上で実行する場合は<span>1</span>.<span>5</span>GB）</p>
</div>
<div>
<p><span>●</span><span>4</span>GBのハードディスク空き容量</p>
</div>
<div>
<p><span>●</span>5400RPMのハードディスクドライブ</p>
</div>
<div>
<p><span>●</span>1024<span>×</span>768以上の表示解像度のDirectX<span>9</span>対応ビデオカード</p>
</div>
<p><br /></p>
<p>　本書の執筆にあたって、サンプルプログラムの作成と動作確認に使用した環境は、次のとおりです。</p>
<p>Windows<span>10</span> Pro<span>64</span>ビット版（Apple iMac<span>27</span>インチ（Late 2012）+ Paralells仮想環境。メモリ<span>32</span>GBのうち<span>8</span>GBを使用。HDD<span>1</span>TBのうち128GB（可変サイズ）</p>
<p><br /></p>
<div><b>
<p><b>■サンプルプログラムについて</b></p>
</b></div>
<p>　本書のサンプルプログラムや練習問題のプログラムは、ダウンロードしてすぐに試せるようになっています。プログラムの作成前に動作を確認したい場合や、練習問題の答えを確認するためにお使いください（サンプルのプロジェクト名は<img src="images/00143.jpeg" alt="" />アイコンで示しています）。コードをそのまま入力するだけでもプログラミングの力は身に付きます。まずは自分でチャレンジしてみてください。プログラムは以下のURLからダウンロードできます。</p>
<p><br /></p>
<pre lang="en"><code>URL	http://www.impressjapan.jp/books/1115101121</code></pre>
<p><br /></p>
<p>　XMLドキュメントを利用してウェブサービスで提供されているデータを表示するプログラムやWindows Presentation Foundationを利用したアニメーション表示プログラムなど、各種のサンプルプロジェクトも、解説を含め上記のサイトからダウンロードできます。また、本書ではユニバーサルWindowsアプリについては取り扱っていませんが、簡単な入門用サンプルプロジェクトと解説も用意してあります。こちらは下記のWebサイトで紹介していますので、もう一歩先に進みたい人はぜひ参考にしてください。</p>
<p><br /></p>
<pre lang="en"><code>URL	https://thinkit.co.jp/series/5449</code></pre></div>
</div>
<div id="calibre_link-65">
<div>
<div id="calibre_link-355">
<div>
<p><span><b>目次</b></span></p>
</div>
</div>
<p><br /></p>
<div>
<p><a href="#calibre_link-66"><u>はじめに</u></a></p>
</div>
<div>
<p><a href="#calibre_link-67"><u>本書の読み方</u></a></p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-68"><b><u>Part<span><b>1</b></span>　はじめてのVisual Basicプログラミング</u></b></a></b></p>
</b></div>
<p><br /></p>
<div>
<p><a href="#calibre_link-69"><u>Chapter<span><b><span><b>1</b></span></b></span>　Visual Basic プログラミングの準備</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-70"><b><u><span><b>1</b></span>.<span><b>1</b></span>　Visual Basicでできること</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-71"><u>簡単！ 楽しい！Visual Basicプログラミング</u></a></p>
</div>
<div>
<p><a href="#calibre_link-72"><u>Visual StudioとVisual Basic</u></a></p>
</div>
<div>
<p><a href="#calibre_link-73"><u>Visual Basicで作成できるプログラム</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-74"><b><u><span><b>1</b></span>.<span><b>2</b></span>　Visual Studio Community 2015のインストール</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-75"><u>練習問題</u></a></p>
</div>
<p><br /></p>
<div>
<p><a href="#calibre_link-76"><u>Chapter<span><b><span><b>2</b></span></b></span>　はじめてのプログラミング</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-77"><b><u><span><b>2</b></span>.<span><b>1</b></span>　Visual Basicでのプログラミング</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-78"><u>Visual Basicのプログラムとは</u></a></p>
</div>
<div>
<p><a href="#calibre_link-79"><u>プロジェクトとは</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-80"><b><u><span><b>2</b></span>.<span><b>2</b></span>　プログラムを作成してみよう</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-81"><u>ここで作成するプログラム</u></a></p>
</div>
<div>
<p><a href="#calibre_link-82"><u>Visual Studioを起動する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-83"><u>プロジェクトを新規作成する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-84"><u>フォームをデザインする〜コントロールの配置</u></a></p>
</div>
<div>
<p><a href="#calibre_link-85"><u>プロパティを設定する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-86"><u>コードを書く〜イベントハンドラーの作成</u></a></p>
</div>
<div>
<p><a href="#calibre_link-87"><u>コードを簡単に入力する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-88"><u>メソッドを利用する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-89"><u>プログラムを実行する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-90"><u>プログラムのエラーに対処する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-91"><u>実行用プログラムのある場所</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-92"><b><u><span><b>2</b></span>.<span><b>3</b></span>　よく使うコントロール</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-93"><u>よく使うコントロールの一覧</u></a></p>
</div>
<div>
<p><a href="#calibre_link-94"><u>練習問題</u></a></p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-95"><b><u>Part<span><b>2</b></span>　Visual Basic の基礎を身に付ける</u></b></a></b></p>
</b></div>
<p><br /></p>
<div>
<p><a href="#calibre_link-96"><u>Chapter<span><b><span><b>3</b></span></b></span>　数値や文字列を取り扱う</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-97"><b><u><span><b>3</b></span>.<span><b>1</b></span>　コードの書き方</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-98"><u>キーワード</u></a></p>
</div>
<div>
<p><a href="#calibre_link-99"><u>演算子</u></a></p>
</div>
<div>
<p><a href="#calibre_link-100"><u>リテラル</u></a></p>
</div>
<div>
<p><a href="#calibre_link-101"><u>コメント</u></a></p>
</div>
<div>
<p><a href="#calibre_link-102"><u>ステートメントを複数行に書く</u></a></p>
</div>
<div>
<p><a href="#calibre_link-103"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-104"><b><u><span><b>3</b></span>.<span><b>2</b></span>　変数と定数</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-105"><u>変数を利用する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-106"><u>何を変数として宣言するのか</u></a></p>
</div>
<div>
<p><a href="#calibre_link-107"><u>変数のデータ型</u></a></p>
</div>
<div>
<p><a href="#calibre_link-108"><u>変数を初期化する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-109"><u>値型の変数と参照型の変数</u></a></p>
</div>
<div>
<p><a href="#calibre_link-110"><u>変数のスコープ</u></a></p>
</div>
<div>
<p><a href="#calibre_link-111"><u>変数のアクセスレベル</u></a></p>
</div>
<div>
<p><a href="#calibre_link-112"><u>定数を利用する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-113"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-114"><b><u><span><b>3</b></span>.<span><b>3</b></span>　代入と演算</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-115"><u>代入とは</u></a></p>
</div>
<div>
<p><a href="#calibre_link-116"><u>変数のデータ型と代入の注意点</u></a></p>
</div>
<div>
<p><a href="#calibre_link-117"><u>さまざまな演算</u></a></p>
</div>
<div>
<p><a href="#calibre_link-118"><u>演算子の優先順位</u></a></p>
</div>
<div>
<p><a href="#calibre_link-119"><u>演算の精度</u></a></p>
</div>
<div>
<p><a href="#calibre_link-120"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-121"><b><u><span><b>3</b></span>.<span><b>4</b></span>　プログラミングにチャレンジ</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-122"><u>時間を変換するプログラム</u></a></p>
</div>
<div>
<p><a href="#calibre_link-123"><u>フォームのデザイン</u></a></p>
</div>
<div>
<p><a href="#calibre_link-124"><u>タブオーダーの設定</u></a></p>
</div>
<div>
<p><a href="#calibre_link-125"><u>イベントハンドラーの記述</u></a></p>
</div>
<div>
<p><a href="#calibre_link-126"><u>プログラムを実行する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-127"><u>練習問題</u></a></p>
</div>
<p><br /></p>
<div>
<p><a href="#calibre_link-128"><u>Chapter<span><b><span><b>4</b></span></b></span>　条件によって処理を変える</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-129"><b><u><span><b>4</b></span>.<span><b>1</b></span>　条件分岐の考え方</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-130"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-131"><b><u><span><b>4</b></span>.<span><b>2</b></span>　Ifステートメントを利用する</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-132"><u>条件が満たされたときに処理を実行するIf ... Then ... ステートメント</u></a></p>
</div>
<div>
<p><a href="#calibre_link-133"><u>条件が満たされないときの処理も書くIf ... Then ... Elseステートメント</u></a></p>
</div>
<div>
<p><a href="#calibre_link-134"><u>より複雑な条件分岐にも対応するIf ... Then ... Else ... End Ifステートメント</u></a></p>
</div>
<div>
<p><a href="#calibre_link-135"><u>複数の条件を組み合わせる</u></a></p>
</div>
<div>
<p><a href="#calibre_link-136"><u>AndAlso演算子とOrElse演算子</u></a></p>
</div>
<div>
<p><a href="#calibre_link-137"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-138"><b><u><span><b>4</b></span>.<span><b>3</b></span>　Ifステートメントによる多分岐</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-139"><u>Ifステートメントを入れ子にする</u></a></p>
</div>
<div>
<p><a href="#calibre_link-140"><u>ElseIfを利用した多分岐</u></a></p>
</div>
<div>
<p><a href="#calibre_link-141"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-142"><b><u><span><b>4</b></span>.<span><b>4</b></span>　Select Caseステートメントによる多分岐</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-143"><u>多分岐を簡潔に書く</u></a></p>
</div>
<div>
<p><a href="#calibre_link-144"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-145"><b><u><span><b>4</b></span>.<span><b>5</b></span>　プログラミングにチャレンジ</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-146"><u>割引価格を計算するプログラム</u></a></p>
</div>
<div>
<p><a href="#calibre_link-147"><u>フォームのデザイン</u></a></p>
</div>
<div>
<p><a href="#calibre_link-148"><u>RadioButtonコントロールとコンテナー</u></a></p>
</div>
<div>
<p><a href="#calibre_link-149"><u>イベントハンドラーの記述</u></a></p>
</div>
<div>
<p><a href="#calibre_link-150"><u>プログラムを実行する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-151"><u>練習問題</u></a></p>
</div>
<p><br /></p>
<div>
<p><a href="#calibre_link-152"><u>Chapter<span><b><span><b>5</b></span></b></span>　処理を繰り返す</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-153"><b><u><span><b>5</b></span>.<span><b>1</b></span>　繰り返し処理の考え方</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-154"><u>後判断型の繰り返し処理</u></a></p>
</div>
<div>
<p><a href="#calibre_link-155"><u>前判断型の繰り返し処理</u></a></p>
</div>
<div>
<p><a href="#calibre_link-156"><u>Until型の繰り返し処理とWhile型の繰り返し処理</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-157"><b><u><span><b>5</b></span>.<span><b>2</b></span>　Do...Loopステートメントを利用した繰り返し処理</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-158"><u>条件が満たされるまで処理を繰り返す（後判断－Until型）</u></a></p>
</div>
<div>
<p><a href="#calibre_link-159"><u>条件が満たされている間処理を繰り返す（後判断－While型）</u></a></p>
</div>
<div>
<p><a href="#calibre_link-160"><u>条件が満たされるまで処理を繰り返す（前判断－Until型）</u></a></p>
</div>
<div>
<p><a href="#calibre_link-161"><u>条件が満たされている間処理を繰り返す（前判断－While型）</u></a></p>
</div>
<div>
<p><a href="#calibre_link-162"><u>前判断型の繰り返し処理がよく使われる例</u></a></p>
</div>
<div>
<p><a href="#calibre_link-163"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-164"><b><u><span><b>5</b></span>.<span><b>3</b></span>　For...Nextステートメントを利用した繰り返し処理</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-165"><u>初期値、終了値、増分値を指定して処理を繰り返す</u></a></p>
</div>
<div>
<p><a href="#calibre_link-166"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-167"><b><u><span><b>5</b></span>.<span><b>4</b></span>　For Each...Nextステートメントを利用した繰り返し処理</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-168"><u>コレクションの要素を繰り返し処理する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-169"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-170"><b><u><span><b>5</b></span>.<span><b>5</b></span>　繰り返し処理を途中で抜ける</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-171"><u>Do ... Loopステートメントを途中で抜ける〜Exit Doステートメント</u></a></p>
</div>
<div>
<p><a href="#calibre_link-172"><u>For...Next／For Each...Nextステートメントを途中で抜ける〜Exit Forステートメント</u></a></p>
</div>
<div>
<p><a href="#calibre_link-173"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-174"><b><u><span><b>5</b></span>.<span><b>6</b></span>　プログラミングにチャレンジ</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-175"><u>最高点を求めるプログラム</u></a></p>
</div>
<div>
<p><a href="#calibre_link-176"><u>フォームのデザイン</u></a></p>
</div>
<div>
<p><a href="#calibre_link-177"><u>イベントハンドラーの記述</u></a></p>
</div>
<div>
<p><a href="#calibre_link-178"><u>プログラムを実行する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-179"><u>練習問題</u></a></p>
</div>
<p><br /></p>
<div>
<p><a href="#calibre_link-180"><u>Chapter<span><b><span><b>6</b></span></b></span>　配列を利用する</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-181"><b><u><span><b>6</b></span>.<span><b>1</b></span>　配列の考え方</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-182"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-183"><b><u><span><b>6</b></span>.<span><b>2</b></span>　配列の宣言と利用</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-184"><u>配列を宣言する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-185"><u>列を利用する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-186"><u>配列を初期化する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-187"><u>多次元配列を利用する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-188"><u>多次元配列を初期化する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-189"><u>配列のサイズを変更する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-190"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-191"><b><u><span><b>6</b></span>.<span><b>3</b></span>　配列と繰り返し処理</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-192"><u>配列の要素をすべて処理する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-193"><u>多次元配列の要素をすべて処理する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-194"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-195"><b><u><span><b>6</b></span>.<span><b>4</b></span>　プログラミングにチャレンジ</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-196"><u>売上を集計するプログラム</u></a></p>
</div>
<div>
<p><a href="#calibre_link-197"><u>フォームのデザイン</u></a></p>
</div>
<div>
<p><a href="#calibre_link-198"><u>イベントハンドラーの記述</u></a></p>
</div>
<div>
<p><a href="#calibre_link-199"><u>プログラムを実行する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-200"><u>練習問題</u></a></p>
</div>
<p><br /></p>
<div>
<p><a href="#calibre_link-201"><u>Chapter<span><b><span><b>7</b></span></b></span>　プロシージャを使ってコードをまとめる</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-202"><b><u><span><b>7</b></span>.<span><b>1</b></span>　SubプロシージャとFunctionプロシージャ</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-203"><u>Subプロシージャの利用例と特徴</u></a></p>
</div>
<div>
<p><a href="#calibre_link-204"><u>Functionプロシージャの利用例と特徴</u></a></p>
</div>
<div>
<p><a href="#calibre_link-205"><u>プロシージャを作成するにあたって決めておくこと</u></a></p>
</div>
<div>
<p><a href="#calibre_link-206"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-207"><b><u><span><b>7</b></span>.<span><b>2</b></span>　Subプロシージャの作成と利用</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-208"><u>Subプロシージャを作成する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-209"><u>Subプロシージャを利用する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-210"><u>Subプロシージャを途中で抜ける</u></a></p>
</div>
<div>
<p><a href="#calibre_link-211"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-212"><b><u><span><b>7</b></span>.<span><b>3</b></span>　Functionプロシージャの作成と利用</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-213"><u>Functionプロシージャを作成する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-214"><u>Functionプロシージャを利用する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-215"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-216"><b><u><span><b>7</b></span>.<span><b>4</b></span>　引数の定義と渡し方</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-217"><u>値渡しと参照渡し</u></a></p>
</div>
<div>
<p><a href="#calibre_link-218"><u>さまざまな方法で引数を定義する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-219"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-220"><b><u><span><b>7</b></span>.<span><b>5</b></span>　プログラミングにチャレンジ</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-221"><u>色見本を表示するプログラム</u></a></p>
</div>
<div>
<p><a href="#calibre_link-222"><u>フォームのデザイン</u></a></p>
</div>
<div>
<p><a href="#calibre_link-223"><u>プログラムの設定値を保存する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-224"><u>Subプロシージャを作成する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-225"><u>イベントハンドラーの記述</u></a></p>
</div>
<div>
<p><a href="#calibre_link-226"><u>プログラムを実行する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-227"><u>練習問題</u></a></p>
</div>
<p><br /></p>
<div>
<p><a href="#calibre_link-228"><u>Chapter<span><b><span><b>8</b></span></b></span>　クラスを利用する</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-229"><b><u><span><b>8</b></span>.<span><b>1</b></span>　クラスとオブジェクト</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-230"><u>クラスとは</u></a></p>
</div>
<div>
<p><a href="#calibre_link-231"><u>オブジェクトとは</u></a></p>
</div>
<div>
<p><a href="#calibre_link-232"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-233"><b><u><span><b>8</b></span>.<span><b>2</b></span>　クラスの利用</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-234"><u>クラスからオブジェクトを作成する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-235"><u>プロパティやメソッドを利用する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-236"><u>共有メンバーを利用する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-237"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-238"><b><u><span><b>8</b></span>.<span><b>3</b></span>　クラスの作成</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-239"><u>クラスを定義する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-240"><u>プロパティを定義する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-241"><u>メソッドを定義する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-242"><u>定義したクラスを利用する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-243"><u>共有メンバーを定義する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-244"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-245"><b><u><span><b>8</b></span>.<span><b>4</b></span>　クラスの継承</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-246"><u>クラスを継承して派生クラスを定義する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-247"><u>インターフェイスを利用する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-248"><u>確認問題</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-249"><b><u><span><b>8</b></span>.<span><b>5</b></span>　プログラミングにチャレンジ</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-250"><u>フェイスチャートを表示するプログラム</u></a></p>
</div>
<div>
<p><a href="#calibre_link-251"><u>フォームのデザイン</u></a></p>
</div>
<div>
<p><a href="#calibre_link-252"><u>クラスを定義する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-253"><u>プロパティを定義する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-254"><u>メソッドを定義する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-255"><u>イベントハンドラーの記述</u></a></p>
</div>
<div>
<p><a href="#calibre_link-256"><u>練習問題</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-257"><b><u>Part<span><b>3</b></span>　本格的なプログラミングにチャレンジする</u></b></a></b></p>
</b></div>
<p><br /></p>
<div>
<p><a href="#calibre_link-258"><u>Chapter<span><b><span><b>9</b></span></b></span>　ファイルを取り扱う～ Fortune プログラム</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-259"><b><u><span><b>9</b></span>.<span><b>1</b></span>　ここで作成するプログラム</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-260"><u>格言を表示するプログラム</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-261"><b><u><span><b>9</b></span>.<span><b>2</b></span>　Fortuneプログラムを作成する</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-262"><u>フォームをデザインする</u></a></p>
</div>
<div>
<p><a href="#calibre_link-263"><u>メニューをデザインする</u></a></p>
</div>
<div>
<p><a href="#calibre_link-264"><u>ステータスバーをデザインする</u></a></p>
</div>
<div>
<p><a href="#calibre_link-265"><u>格言をファイルから読み出して表示する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-266"><u>構造化例外処理を書く</u></a></p>
</div>
<div>
<p><a href="#calibre_link-267"><u>新しい格言をファイルに書き込む</u></a></p>
</div>
<div>
<p><a href="#calibre_link-268"><u>格言をクリップボードにコピーする</u></a></p>
</div>
<div>
<p><a href="#calibre_link-269"><u>プログラムを終了させる</u></a></p>
</div>
<div>
<p><a href="#calibre_link-270"><u>プログラムを実行する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-271"><u>練習問題</u></a></p>
</div>
<p><br /></p>
<div>
<p><a href="#calibre_link-272"><u>Chapter<span><b><span><b>10</b></span></b></span>　データベースを取り扱う〜アイディアプロセッサ</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-273"><b><u><span><b>10</b></span>.<span><b>1</b></span>　いちばん簡単なデータベースアプリケーション</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-274"><u>データの取り扱い方を知る</u></a></p>
</div>
<div>
<p><a href="#calibre_link-275"><u>データベースをプロジェクトに追加する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-276"><u>データベースを利用するためのコントロールを配置する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-277"><u>プログラムを実行する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-278"><u>テキストボックスにテーブルの内容を表示する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-279"><u>自動的に追加されたコードを見る</u></a></p>
</div>
<div>
<p><a href="#calibre_link-280"><u>検索機能を追加する</u></a></p>
</div>
<div><b>
<p><b><a href="#calibre_link-281"><b><u><span><b>10</b></span>.<span><b>2</b></span>　コードを使ってデータベースを操作する</u></b></a></b></p>
</b></div>
<div>
<p><a href="#calibre_link-282"><u>ここで使うコントロール</u></a></p>
</div>
<div>
<p><a href="#calibre_link-283"><u>フォームをデザインする</u></a></p>
</div>
<div>
<p><a href="#calibre_link-284"><u>ダイアログボックスをデザインする</u></a></p>
</div>
<div>
<p><a href="#calibre_link-285"><u>レコードを検索するためのコードを書く</u></a></p>
</div>
<div>
<p><a href="#calibre_link-286"><u>レコードを追加するためのコードを書く</u></a></p>
</div>
<div>
<p><a href="#calibre_link-287"><u>レコードを修正するためのコードを書く</u></a></p>
</div>
<div>
<p><a href="#calibre_link-288"><u>レコードを削除するためのコードを書く</u></a></p>
</div>
<div>
<p><a href="#calibre_link-289"><u>プログラムを終了させる</u></a></p>
</div>
<div>
<p><a href="#calibre_link-290"><u>プログラムを実行する</u></a></p>
</div>
<div>
<p><a href="#calibre_link-291"><u>練習問題</u></a></p>
</div>
<p><br /></p>
<div><b>
<p><b><a href="#calibre_link-292"><b><u>付録　　確認・練習問題の解答</u></b></a></b></p>
</b></div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><span><b><img src="images/00053.jpeg" alt="" /><b></b></b></span>コラム目次</b></p>
</b></div>
<div>
<p><a href="#calibre_link-293"><u>ソリューションとは</u></a></p>
</div>
<div>
<p><a href="#calibre_link-294"><u>データ型を厳密に取り扱うには</u></a></p>
</div>
<div>
<p><a href="#calibre_link-295"><u>変数名の付け方</u></a></p>
</div>
<div>
<p><a href="#calibre_link-296"><u>条件分岐はさまざまな表し方がある</u></a></p>
</div>
<div>
<p><a href="#calibre_link-297"><u>反復子により、値を順に取得するには</u></a></p>
</div>
<div>
<p><a href="#calibre_link-298"><u>.NET Frameworkのクラスライブラリを利用するには</u></a></p>
</div>
<div>
<p><a href="#calibre_link-299"><u>カンマ区切りのファイルや固定長フィールドのファイルを取り扱う</u></a></p>
</div>
<div>
<p><a href="#calibre_link-300"><u>利用されるデータベースについての注意</u></a></p>
</div>
<div>
<p><a href="#calibre_link-301"><u>LINQクエリを使う</u></a></p>
</div>
</div>
</div>
<div id="calibre_link-0">
<div>
<div id="calibre_link-68">
<div>
<p>PART<span>1</span></p>
</div>
</div>
<p><br /></p>
<div><b>
<p><b>はじめての</b></p>
</b></div>
<div><b>
<p><b>Visual Basicプログラミング</b></p>
</b></div>
<hr />
<div>
<p>Visual Basicは、はじめてプログラミングに取り組む人にもとても分かりやすいプログラミング言語で、特別な前提知識がなくてもすぐに始められます。とはいえ、行き先を決めずに出かけてもすぐに途方に暮れてしまうでしょう。そのため、ここでは目的地を確認し、出発のための準備をします。まず、Visual Basicでどのようなプログラムが作成できるのかを知り、Visual Studioと呼ばれる開発環境をインストールする方法を説明します。次に、プログラミングの流れを追いかけ、Visual Basicによるプログラミングの全体像をイメージできるようにします。</p>
</div>
</div>
</div>
<div id="calibre_link-46">
<div>
<div id="calibre_link-69">
<div><b>
<p><b>Chapter<span><b>1</b></span></b></p>
</b></div>
</div>
<p><br /></p>
<div><b>
<p><b>Visual Basic プログラミングの準備</b></p>
</b></div>
<hr />
<div>
<p>この章ではVisual Basicでできることをひととおり眺めて全体像をざっと確認した後、Visual Studioをパソコンにインストールし、プログラミングを体験できる環境を作ります。本書を読むだけでも十分な知識は得られますが、実際にサンプルプログラムを作成すれば、経験として知識が定着します。あわてる必要はありません。ゆっくりのんびり、そして確実に始めましょう。</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><span><b>1</b></span>.<span><b>1</b></span>　Visual Basicでできること</b></p>
</b></div>
<div>
<p>簡単！楽しい！Visual Basicプログラミング／Visual StudioとVisual Basic／Visual Basicで作成できるプログラム</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>1</b></span>.<span><b>2</b></span>　Visual Studio Community 2015のインストール</b></p>
</b></div>
</div>
</div>
<div id="calibre_link-332">
<div>
<div><b>
<p><b>これから学ぶこと</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　Visual Studioにはどのようなエディションがあるかを知ります</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Visual Basicではどのようなプログラムが作成できるのかを知ります</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Visual Studioをパソコンにインストールし、プログラミングの準備を整えます</b></p>
</b></div>
<p><br /></p>
<div>
<p><img src="images/00026.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>　Visual Basicでプログラムを作成するためにはVisual Studioと呼ばれるプログラミング環境を利用します。Visual Studioでは、お絵描き感覚でウィンドウのデザインができるだけでなく、データベースを利用するプログラムやウェブサービスを利用するプログラムなど、高度なプログラムも作成できます。さらには、パソコンだけでなくタブレットやスマートフォンにも対応したユニバーサルWindowsアプリケーションも作成できます。</p>
</div>
</div>
</div>
<div id="calibre_link-24">
<div>
<div id="calibre_link-70">
<div><b>
<p><b>　<span><b>1</b></span>.<span><b>1</b></span>　Visual Basicでできること</b></p>
</b></div>
</div>
<p><br /></p>
<p>　海外などの見知らぬ土地に旅するときに、何の準備もせずいきなり出かける人はまずいないでしょう。あらかじめ地図を見て空港やホテル、観光地などの主要なポイントをざっと確認しておくはずです。この節でも、それと同じようにVisual Basicを使うとどんないいことがあるのか、Visual Basicでどんなプログラムが作れるのかをひととおり眺めてみることにします。いわばVisual Basicの世界を旅する前の「みどころ」案内です。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-71">
<div><b>
<p><b>■簡単！ 楽しい！Visual Basicプログラミング</b></p>
</b></div>
</div>
<hr />
<p>　Visual BasicはWindowsのプログラムを作成するためのプログラミング言語です。その特徴をひとことでいうと「きわめて簡単」です。むしろそんなカタい言葉を使わず「ちょーカンタン！」とか「わかりやすさハンパなくない?」と言いたくなるぐらいの簡単さです。</p>
<p>　Visual Basicでは、コード（命令のようなもの）を書かなくても、お絵描き感覚でウィンドウのデザインができます。まったくの初心者でも、ほんの数分でWindowsのグラフィカルユーザーインターフェイス（GUI）を利用したプログラムが作成できてしまうのです。あまりの簡単さ、楽しさに、一瞬にしてVisual Basicのとりこになってしまう人も少なくありません。</p>
<p><br /></p>
<div>
<p><img src="images/00155.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　もちろん、Visual Basicのすぐれた点は、簡単だということだけではありません。後ほど紹介しますが、Visual Basicには豊富な機能が備わっており、企業での業務に使える本格的なプログラムも効率よく作成できます。</p>
<p>　本格的なプログラムを作成するためには、コードをいくらか書く必要があります。というと、謎の呪文のような命令の羅列を思い浮かべて不安になる人もいるかもしれせんが、そんな心配はご無用です。Visual Basicは初心者用の言語としてコンピューターの普及に大きな役割を果たしたBasic言語の流れをくむもので、文法はとてもシンプルで分かりやすいものとなっています。しかも、<span><b>インテリセンス</b></span>や<span><b>コードスニペット</b></span>と呼ばれる機能により、次に入力できる単語が一覧表示されたり、よく使われる構文が自動的に挿入されたりするので、「簡単といっても英語の命令を覚えるのはちょっと......」などという心配もありません。</p>
<p><br /></p>
<div>
<p><img src="images/00272.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-72">
<div><b>
<p><b>■Visual StudioとVisual Basic</b></p>
</b></div>
</div>
<hr />
<p>　Visual StudioとはWindowsのプログラムを作成するための開発環境です。「環境」というと実感が湧かないかもしれませんが、要するに各種のツールを集めたものです。Visual Studioではさまざまなプログラミング言語を使って開発ができますが、Visual Basicはそのためのプログラミング言語の<span>1</span>つです。</p>
<p><br /></p>
<div>
<p><img src="images/00247.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Visual Studioには、無償で提供されているVisual Studio Communityと、有償で提供されているVisual Studio Professional、Visual Studio Enterpriseの<span>3</span>種類があります（表<span>1</span>-<span>1</span>）。これらのほかにも、Visual Studio Express for Windowsや、Visual Studio Test Professionalなど、目的に合わせた詳細な追加プランがありますが、一般的には開発の規模に合わせて、表<span>1</span>-<span>1</span>のいずれかの製品を選択します。</p>
<p><br /></p>
<div>
<p><img src="images/00144.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　これらの製品の違いは、同じ車のグレードの違いのようなものです。上位の製品ほど多くの機能が備わっており、当然のことながら値段も高くなります。</p>
<p>　どの製品を使うかは利用者の目的次第ですが、本書ではプログラミングを学ぶという目的に合わせ、Visual Studio Communityを使うことにします。これは個人での開発やプログラミングの学習、小規模なアプリケーションの開発を目的として無償で提供されているものですが、その実力をなめてかかることはできません。Visual Studio Communityは、決して「お試し版」程度の機能限定版ではなく、本格的なプログラムを作成するのに十分すぎるほどのフル機能を備えています。次の項では、本書で取り上げたプログラムを例に、どのようなプログラムが作成できるかひととおり紹介しますが、それだけでもVisual Studio Communityの実力のほどがうかがえると思います。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>Visual Studioの種類による機能の違い</b></p>
</b></div>
<div>
<p>　最初から豊富な機能の一覧表を示しても、見慣れないツールの名前が次から次へと出てきて困惑するだけなので、ここではあえて掲載しないことにします。オプションによる機能の違いについては、https://www.visualstudio.com/vs-2015-product-editionsを参照してください。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00020.jpeg" alt="" /></p>
</div>
</div>
<p>&nbsp;</p>
<p><br /></p>
<p><br /></p>
<p>　本書のプログラムは、すべてVisual Studio Communityで作成したものです。本書の説明もVisual Studio Communityでの操作にそって進めますが、プログラミングの方法については、どのエディションでも基本的に同じです。</p>
<p>　なお、これ以降では、特に区別の必要がある場合を除いてVisual Studio Communityのことを単にVisual Studioと呼ぶことにします。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-73">
<div><b>
<p><b>■Visual Basicで作成できるプログラム</b></p>
</b></div>
</div>
<hr />
<p>　本書ではVisual Studioという開発環境を利用し、Visual Basicというプログラミング言語でプログラムを作成していきます。そこで、Visual Basicでどのようなプログラムが作成できるか、簡単に紹介しておきましょう。以下の内容はあくまでも本書で作成したプログラムの例ですが、これだけでもVisual Basicの豊富な機能を垣間見ることができると思います。しかし、実際にできることはこれだけではありません。本書の内容は砂浜での水遊び的なレベルですが（それだけでも十分に楽しめると思います）、目の前にはさらなる大海が広がっているのです。</p>
<p>　細かな用語はあまりに気にせず、どんなことができるか、ざっと眺めておいてください。</p>
<p><br /></p>
<div><b>
<p><b>■Windows GUIプログラム</b></p>
</b></div>
<p>　すでに説明したように、Visual Basicを利用すると、Windowsのグラフィカルユーザーインターフェイス（GUI）を利用したプログラムが簡単に作成できます。コンピューター関係の書籍に「簡単」と書かれているもので、本当に簡単であることはまれですが、これは正真正銘の簡単です。お絵描き感覚でウィンドウのデザインができるので、まったくの初心者でも、ほんの数分でWindowsのGUIプログラムが作成できます。</p>
<p><br /></p>
<div>
<p><img src="images/00317.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　ウィンドウのデザインはきわめて簡単なので、とりあえず動くプログラムがすぐに作成できます。さらに、さまざまなコントロール（ラベルやボタンなどの部品にあたるもの）や、変数、条件分岐、繰り返し処理、配列、クラスなど、本書で学ぶVisual Basicの機能を利用すれば、より高度で多彩なプログラムも作成できるようになります。</p>
<p><br /></p>
<div><b>
<p><b>■ファイル入出力を利用するプログラム</b></p>
</b></div>
<p>　ファイルに保存されたデータを読み出してウィンドウに表示したり、処理したデータをファイルに書き込んだりするプログラムが作成できます。</p>
<p><br /></p>
<div>
<p><img src="images/00330.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　ファイルとのデータのやりとりにはMicrosoft .NET Frameworkのクラスライブラリが利用できます。クラスライブラリとはプログラムから利用できる部品の集まりのようなものです。もちろん、Microsoft .NET Frameworkのクラスライブラリはファイル処理以外にもさまざまな目的に利用できます。ちなみに、ウィンドウに表示されているコントロールもクラスライブラリに含まれる部品の<span>1</span>つです。</p>
<p><br /></p>
<div><b>
<p><b>■データベースを利用するプログラム</b></p>
</b></div>
<p>　SQL ServerやAccessなどのデータベースを利用すれば、ファイル処理よりも高度なデータ処理ができます。Visual Basicにはそれらのデータベースを利用しやすくするためのコントロールが用意されています。簡単なものなら、コードを<span>1</span>行も書かずにデータベースを利用するプログラムが作成できます。</p>
<p><br /></p>
<div>
<p><img src="images/00001.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>■さらに高度なプログラム</b></p>
</b></div>
<p>　Visual Basicを利用すれば、ウェブサービスやアニメーションなど、高度なプログラムも作成できます。以下の例は基礎の範囲を大きく超えるので、紙面では説明しませんが、ダウンロード用のサンプルプログラムとして、詳しい説明とともに提供しています。Visual Basicでここまで（もっと先にも）行けるんだ！ という展望が得られると思います。ぜひ参考にしてください。</p>
<p><br /></p>
<div><b>
<p><b>●ユニバーサルWindowsアプリケーション</b></p>
</b></div>
<p>　ユニバーサルWindowsアプリケーションとは、パソコンだけでなく、タブレットやスマートフォンなどでも同様の操作ができるプログラムのことです。作成したプログラムは、Windowsストアで公開することもできます。</p>
<p><br /></p>
<div>
<p><img src="images/00082.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>●ウェブサービスを利用するプログラム</b></p>
</b></div>
<p>　インターネットのWorld Wide Web（WWW）で提供されているRSS（RDF Site Summary）などの情報サービスやTwitter API、Google Maps APIなど各種のウェブサービスもVisual Basicから利用できます。これらのサービスで使われているXML形式のドキュメントから特定のデータを検索するための方法が提供されています。</p>
<p><br /></p>
<div>
<p><img src="images/00258.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div><b>
<p><b>●Windows Presentation Foundationを利用するプログラム</b></p>
</b></div>
<p>　Windows Presentation Foundation（WPF）とは、より魅力的なユーザーインターフェイスを提供するための機能の集まりです。Visual Basicでは、WPFに対応したプログラムを作成し、コントロールに表示効果を設定したり、<span>2</span>Dアニメーションや<span>3</span>Dアニメーションを表示したりすることができます。</p>
<p><br /></p>
<div>
<p><img src="images/00061.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このほか、Internet Explorerと同様、あるいはそれ以上の独自の機能を追加したウェブブラウザーや、より使いやすいメールクライアント、ワードプロセッサやスケジュール管理システムなどのビジネスプログラム、タイマーを使ったゲームプログラムなど、さまざまなプログラムが作成できます。実際、Visual Basicだけで作られた経理ソフトや給与管理システムなどの業務プログラムもめずらしくはありません。</p>
</div>
</div>
<div id="calibre_link-2">
<div>
<div id="calibre_link-74">
<div><b>
<p><b>　<span><b>1</b></span>.<span><b>2</b></span>　Visual Studio Community 2015 のインストール</b></p>
</b></div>
</div>
<p><br /></p>
<p>　Visual Studio Community 2015（以下、Visual Studioと略記）はインターネットからダウンロードして、パソコンにインストールできるので、本書の解説で取り上げたサンプルプログラムをすぐに試すことができます。本書を読んで理解するだけでも十分な知識は得られますが、それはガイドブックを読んで旅先の情報を得るのと同じようなことです。知識を生きた経験として身に付けるためには、やはり実際に旅に出ることが必要です。ぜひ、サンプルプログラムを作成し、Visual Basicという世界への旅を体験してみてください。得られるのは知識だけではありません。実際にやってみなければ分からない貴重なノウハウも身に付くはずです。わくわくする感じも、読むだけではなかなか得られないものです。</p>
<p>　旅に出るには、パスポートや搭乗券、ボストンバッグなどの用意が必要です。それと同じように、ここでVisual Studioをパソコンにインストールし、プログラミングの準備を整えておきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00122.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Visual Studioをインストールするには、マイクロソフトのウェブサイトにアクセスし、セットアッププログラムをダウンロードします。</p>
<p><br /></p>
<p><br /></p>
<div>
<p>Step<span>1</span>　マイクロソフトのウェブサイトにアクセスする</p>
</div>
<div>
<p>　Microsoft Edgeなどのウェブブラウザーを起動し、http://www.visualstudio.com/にアクセスします。正しく接続されるとVisual Studioのウェブページが表示されます（画面<span>1</span>-<span>7</span>） 。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00104.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>Step<span>2</span>　セットアッププログラムをダウンロードする</p>
</div>
<div>
<p>　［Community 2015のダウンロード］をクリックすると、セットアッププログラムがダウンロードされ、画面の下にメッセージが表示されます。［実行］ボタンをクリックすれば、セットアッププログラムが起動します（画面<span>1</span>-<span>8</span>）。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00152.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>Step<span>3</span>　セットアッププログラムを実行する</p>
</div>
<div>
<p>　セットアッププログラムが起動すると、セキュリティの警告が表示されます。［実行（R）］ボタンをクリックすれば、インストールが開始されます。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00118.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　続いて、インストール先のフォルダーやインストールするプログラムの種類を選択する画面が表示されます。インストール先のドライブに空き領域が少ない場合には、十分に空きのあるドライブを選択してください。［インストールの種類］については、必要に応じて後から変更できるので、ここでは標準設定のままとします。</p>
<p><br /></p>
<div>
<p><img src="images/00244.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00182.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　ここからVisual Studioのインストールが始まります。パソコンやネットワークの性能によって異なりますが、インストールの終了までには数十分から<span>1</span>時間ぐらいの時間がかかります。その間、インストールの進行状況が表示されます（画面<span>1</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00201.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　インストールが終了すると、画面<span>1</span>-<span>13</span>のような終了画面が表示されます。ここで［起動（L）］をクリックすると、Visual Studioが起動します。なお、インストールの開始時に［カスタム（U）］を選択して、インストールされるプログラムを追加した場合など、利用環境によってはパソコンの再起動が必要になる場合もあります。その場合は［起動（L）］の代わりに［今すぐ再起動（N）］が表示されているので、そのボタンをクリックしてパソコンを再起動してください。</p>
<p><br /></p>
<div>
<p><img src="images/00236.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00239.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Visual Studioは、これからよく使うことになるので、アイコンをタスクバーにピン留めしておくと便利です。タスクバーにピン留めするには、タスクバーに表示されたアイコンを右クリックして［タスクバーにピン留め］を選択します。</p>
</div>
</div>
<div id="calibre_link-64">
<div>
<div><b>
<p><b>Chapter<span><b>1</b></span>のまとめ</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　Visual Studioはお絵描き感覚でウィンドウのデザインができる、やさしいプログラミング環境です</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Visual Studioには、コードの入力を手助けしてくれる便利な機能が備わっています</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Visual Studioには、本格的な業務プログラムが作成できる豊富な機能が備わっています</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Visual Studioには、機能の違いにより、いくつかの製品があります</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Visual Studio 2015には有償のものと、無償で個人での開発や小規模な業務プログラムの開発に利用できるVisual Studio Community 2015があります</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　本書では、Visual Studio Community 2015を使って、Visual Basicのプログラミングを学びます</b></p>
</b></div>
</div>
</div>
<div id="calibre_link-58">
<div>
<div id="calibre_link-75">
<div><b>
<p><b>練習問題</b></p>
</b></div>
</div>
<p><br /></p>
<p><span><b>［A］</b></span>次の文章のうち、正しいものには○を付け、間違っているものには<span>×</span>を記入してください。</p>
<div>
<div>
<p><br /></p>
</div>
</div>
<div>
<p>（  ）　Visual Basicは初心者用のプログラミング言語なので、本格的な業務プログラムは作成できない</p>
</div>
<div>
<p>（  ）　Visual Basicでは、コードを書かなくてもプログラムが作成できるが、コードを書いて、より高度なプログラムを作成することもできる</p>
</div>
<div>
<p>（  ）　Visual Basicでは、データベースを利用するプログラムも作成できる</p>
</div>
<div>
<p>（  ）　Visual Basicでは、ウェブサービスを利用するプログラムは作成できない</p>
</div>
<p><br /></p>
<p><span><b>［B］</b></span>以下の空欄を埋めるもっとも適切な用語を選択肢の中から選んでください。</p>
<div>
<div>
<p><br /></p>
</div>
</div>
<p>　Visual Basicを利用すると、初心者でも簡単にWindowsの（　<span>1</span>　）を利用したプログラムが作成できます。特別な命令を使わなくても、ウィンドウをお絵描き感覚で（　<span>2</span>　）できます。高度な業務プログラムを作成するには、（　<span>3</span>　）を記述する必要がありますが、（　<span>4</span>　）と呼ばれる機能により、次に入力できる単語が一覧表示されるので、選択肢から適切な単語を選ぶだけでプログラムが作成できます。また、コードスニペットと呼ばれる機能により、よく使われる（　<span>5</span>　）を自動的に挿入することもできます。</p>
<p><br /></p>
<div>
<p>（a）デザイン</p>
</div>
<div>
<p>（b）インテリセンス</p>
</div>
<div>
<p>（c）グラフィカルユーザーインターフェイス</p>
</div>
<div>
<p>（d）構文</p>
</div>
<div>
<p>（e）コード</p>
</div>
</div>
</div>
<div id="calibre_link-345">
<div>
<div id="calibre_link-76">
<div><b>
<p><b>Chapter<span><b>2</b></span></b></p>
</b></div>
</div>
<p><br /></p>
<div><b>
<p><b>はじめてのプログラミング</b></p>
</b></div>
<hr />
<div>
<p>Visual Studio Community 2015のインストールが終わったので、いよいよプログラミングに取り組みます。Visual Basicでは、前提知識は特に必要ではありませんが、ある程度の見通しを付けておいたほうがスムーズに学習が進むのも確かです。この章では、Visual Basicのプログラムを作成するにあたって、あらかじめ押さえておきたい最低限のポイントを示した後、プログラミングという作業の流れを追いかけていきます。</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><span><b>2</b></span>.<span><b>1</b></span>　Visual Basicでのプログラミング</b></p>
</b></div>
<div>
<p>Visual Basicのプログラムとは／プロジェクトとは</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>2</b></span>.<span><b>2</b></span>　プログラムを作成してみよう</b></p>
</b></div>
<div>
<p>ここで作成するプログラム／Visual Studioを起動する／プロジェクトを新規作成する／フォームをデザインする〜コントロールの配置／プロパティを設定する／コードを書く〜イベントハンドラーの作成／コードを簡単に入力する／メソッドを利用する／プログラムを実行する／プログラムのエラーに対処する／実行用プログラムのある場所</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>2</b></span>.<span><b>3</b></span>　よく使うコントロール</b></p>
</b></div>
<div>
<p>よく使うコントロールの一覧</p>
</div>
</div>
</div>
<div id="calibre_link-43">
<div>
<div><b>
<p><b>これから学ぶこと</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　Visual Basicのプログラムがどのような要素から成り立っているかを知ります</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　簡単なプログラムを実際に作ってみて、Visual Basicでのプログラミングの流れを体験します</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Visual Basicのプログラムでよく使う部品（コントロール）の一覧を確認しておきます</b></p>
</b></div>
<p><br /></p>
<div>
<p><img src="images/00109.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>　Visual Basicのプログラムを作成するには、まず、フォーム（ウィンドウ）の中にラベルやボタンなどの部品を配置します。これらの部品はコントロールと呼ばれます。次に、コントロールに表示される文字列や色などの性質を指定します。これらの性質はプロパティと呼ばれます。ボタンのクリックなど、コントロールで何かのできごとが起こったときには、イベントハンドラーと呼ばれるコードが自動的に実行されます。Windowsのプログラムを作成するということは、コントロールのプロパティに値を設定したり、イベントハンドラーで何を実行するかを記述したりすることにほかなりません。</p>
</div>
</div>
</div>
<div id="calibre_link-328">
<div>
<div id="calibre_link-77">
<div><b>
<p><b>　<span><b>2</b></span>.<span><b>1</b></span>　Visual Basicでのプログラミング</b></p>
</b></div>
</div>
<p><br /></p>
<p>　プログラムとはコンピューターに仕事をさせるための手順書のようなものだとよくいわれます。手順書というと堅苦しく聞こえますが、料理のレシピや旅行の旅程表と同じようなものです。つまり、何をどのような順序でやるかというやり方を書いたものです。ここでは、日常の手順書とVisual Basicのプログラムを対比しながら、プログラミングに必要となる基本的な要素を確認します。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-78">
<div><b>
<p><b>■Visual Basicのプログラムとは</b></p>
</b></div>
</div>
<hr />
<p>　レシピや旅程表には決まった書き方があります。例えば、レシピには食材の種類や分量、調理の方法など、料理を作るのに必要ないくつかの要素を書いておく必要があります。それと同じように、Visual Basicのプログラムに必要となる要素もやはりいくつかあります。では、Visual Basicで作成されたWindowsの一般的なプログラムを見ながら、何が必要になるかを確認してみましょう。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>GUI以外のプログラムも作成できる</b></p>
</b></div>
<div>
<p>　Visual Basicを利用して作成されるプログラムの多くはWindowsのグラフィカルユーザーインターフェイス（GUI）を利用したプログラムですが、Visual Basicではウィンドウを表示しないプログラムも作成できます。したがって、必ずしもVisual Basicのプログラム＝WindowsのGUIプログラムというわけではありません。</p>
</div>
</div>
<p><br /></p>
<div><b>
<p><b>■コントロール</b></p>
</b></div>
<p>　画面<span>2</span>-<span>1</span>はWindowsの一般的なプログラムです。このプログラムを見ると、ウィンドウの中に、ラベルやテキストボックス、ボタンといった部品が表示されているのが分かります。したがって、どのような部品を利用するか、それらをどう配置するかを決めることがプログラミングを始めるにあたってまず必要になります。</p>
<p><br /></p>
<div>
<p><img src="images/00276.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　すでにさりげなく登場している言葉ですが、これらの部品のことを<span><b>コントロール</b></span>と呼びます。ウィンドウもコントロールの一種で、コントロールを配置するための台紙のように利用されるので、特に<span><b>フォーム</b></span>と呼ばれます。</p>
<p>　言い換えると、台紙の上に部品をペタペタと貼り付けていく感覚で、基本的な画面が簡単に作れるということです。</p>
<p><br /></p>
<div><b>
<p><b>■プロパティ</b></p>
</b></div>
<p>　ラベルやボタンに表示されている文字列はプログラムによっても、目的によっても異なります。文字列だけでなく、フォントや文字の色、背景の塗りつぶし色などさまざまな性質を決めることも必要です。このような、コントロールの性質のことを<span><b>プロパティ</b></span>と呼びます。</p>
<p><br /></p>
<div>
<p><img src="images/00294.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div><b>
<p><b>■メソッド</b></p>
</b></div>
<p>　コントロールには、性質だけでなくどのような動作ができるかも決められています。例えば、ボタンにはそのボタン自身を非表示にする動作や表示する動作が含まれています。そういった動作のことを<span><b>メソッド</b></span>と呼びます。メソッドを利用すれば、コントロールにさまざまな動作をさせることができるのです。</p>
<p><br /></p>
<div><b>
<p><b>■イベントとイベントハンドラー</b></p>
</b></div>
<p>　Visual Basicのプログラムは日常の手順書とは異なる点もあります。それは、単に手順を最初から最後まで並べて書いたものではないということです。レシピであれば、食材の種類や分量と、それらを調理する手順が書かれていて、その通りに順を追って進めていけば料理ができます。しかし、Visual Basicのプログラムは「あれをやってこれをやっておしまい」という作業の流れを一直線に書いただけのものではありません。</p>
<p>　例えば、画面<span>2</span>-<span>1</span>には<span>2</span>つのボタンがありますが、プログラムを利用する人がどちらのボタンを先にクリックするか分かりません。したがって「このボタンをクリックした後、次のボタンをクリックする」といった順序は決められません。Visual Basicのプログラムでは、発想を逆転させ、「このボタンがクリックされたら○○する」ということを決めておきます。つまり、何らかのできごとに対して、どのような仕事をするかを決めておくのです。</p>
<p><br /></p>
<div>
<p><img src="images/00310.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p>　このような「クリックされた」「キーが押された」などのできごとのことを<span><b>イベント</b></span>と呼びます。また、イベントが起こったときに実行する手続きのことを<span><b>イベントハンドラー</b></span>と呼びます。Visual Basicでは、イベントハンドラーを書いておけば、そのイベントが起こったときに、自動的にイベントハンドラーの内容が実行されます。</p>
<p>　イベントハンドラーの内容は、Visual Basicというプログラミング言語の文法に従って書きます。</p>
<p>　以上の話を図<span>2</span>-<span>1</span>にまとめておきましょう。プロパティ、メソッド、イベントといった用語も紹介しましたが、プログラミングを進めていくうちに自然に覚えてしまうので、この段階で理解できなかったとしても気にする必要はありません。</p>
<p><br /></p>
<div>
<p><img src="images/00226.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Visual Basicのプログラミングはまさにこの順序に従って進めることになります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-79">
<div><b>
<p><b>■プロジェクトとは</b></p>
</b></div>
</div>
<hr />
<p>　次の節に進んで、実際にプログラミングの流れを体験したいと、うずうずしている人も多いと思いますが、あと<span>1</span>つだけ用語を紹介しておきます。その用語とは<span><b>プロジェクト</b></span>です。</p>
<p>　Visual Studioでは、<span>1</span>つのプログラムに含まれるさまざまな要素をプロジェクトと呼ばれるまとまりで管理しています。料理の話でいえば、紙に書かれた手順だけでなく、実際の食材や調味料、調理器具、盛りつけるためのお皿などをすべて含めたものがプロジェクトです。手順が分かっただけでは料理はできません。これらのすべてが揃って料理が完成します。Visual Studioのプロジェクトもそれと同じです。フォームやコントロール、イベントハンドラーなどのコードをすべてひとまとめにしてプロジェクトとして管理しているのです。</p>
<p><br /></p>
<div>
<p><img src="images/00337.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p>　プロジェクトには、さらに実行用のプログラムや利用するデータベースなども含まれますが、詳細についてはプログラムを作りながら見ていくこととしましょう。</p>
</div>
</div>
<div id="calibre_link-18">
<div>
<div id="calibre_link-80">
<div><b>
<p><b>　<span><b>2</b></span>.<span><b>2</b></span>　プログラムを作成してみよう</b></p>
</b></div>
</div>
<p><br /></p>
<p>　この節では、いよいよVisual Studioでのプログラムの作成から実行までの流れを追いかけます。旅行にたとえるとガイド付きのツアーのようなものです。細い路地に入り込みはしませんが、Visual Studioという世界の歩き方がひととおり分かるはずです。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-81">
<div><b>
<p><b>■ここで作成するプログラム</b></p>
</b></div>
</div>
<hr />
<p>　はじめてのプログラミングなので、プログラムの機能よりも、プログラミングの流れを追いかけることを中心に手順を紹介しましょう。したがって、作成するプログラムはできるだけ簡単なものにします。イラスト<span>2</span>-<span>5</span>で完成時のイメージを確認しておきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00170.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p>　このプログラムでは、［表示（S）］ボタンをクリックすると「Hello VB!」というメッセージが表示され、［終了（X）］ボタンをクリックするとプログラムが終了するものとします。</p>
<p>　では、Visual Studioを起動して、プログラミングに取り組みましょう。ここから、以下の流れを追いかけます。</p>
<p><br /></p>
<div>
<p>■Visual Studioの起動</p>
</div>
<div>
<p>■プロジェクトの作成</p>
</div>
<div>
<p>■コントロールの配置</p>
</div>
<div>
<p>■プロパティの設定</p>
</div>
<div>
<p>■イベントハンドラーの記述</p>
</div>
<div>
<p>■プログラムの実行</p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-82">
<div><b>
<p><b>■Visual Studioを起動する</b></p>
</b></div>
</div>
<hr />
<p>　Visual Studioを起動する方法は、ワープロソフトや表計算ソフトなどのプログラムを起動するのとまったく同じです。Windows<span>10</span>では、スタートメニューの［すべてのアプリ］の一覧から選択して起動します。</p>
<p><br /></p>
<div>
<p><img src="images/00281.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［スタート］ボタンをクリックする</p>
</div>
<div>
<p>❷　［すべてのアプリ］をクリックする</p>
</div>
<div>
<p>❸　ここを下にドラッグして表示をスクロールさせる</p>
</div>
<div>
<p>❹　［Visual Studio 2015］をクリックする</p>
</div>
<p><br /></p>
<p>　Visual Studioが起動すると、画面<span>2</span>-<span>3</span>のような画面が表示されます。ウィンドウの中にはメニューバーやツールバーのほか［ツールボックス］や［スタートページ］などのタブが表示されています。どのようなものが表示されているかを確認してから先に進みましょう。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>はじめて起動するときは少し時間がかかる</b></p>
</b></div>
<div>
<p>　Visual Studioをインストールした後、はじめて起動するときには、ユーザーの利用環境が自動的に作成されます。そのため、起動には数秒〜十数秒の時間がかかります。</p>
</div>
</div>
<p><br /></p>
<div>
<p><img src="images/00158.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>①　メニューバー：</p>
</div>
<div>
<p>　Visual Studioでプログラムを作成するために必要なメニューが表示される。そのときの作業内容によって表示が変わる</p>
</div>
<div>②　ツールバー：</div>
<div>
<p>　よく使う機能がボタンで選択できるようになっている。そのときの作業内容によって表示が変わる</p>
</div>
<div>
<p>③　スタートページ：</p>
</div>
<div>
<p>　作業の開始に役立つ情報が表示される</p>
</div>
<div>
<p>　　ⓐ 最初によく行う作業の一覧が表示される</p>
</div>
<div>
<p>　　ⓑ 最近使ったプロジェクトの一覧が表示される</p>
</div>
<div>
<p>　　ⓒ 作業開始にあたってのガイダンスや開発ツールに関する最新の情報が表示される</p>
</div>
<div>
<p>④　ソリューションエクスプローラー：</p>
</div>
<div>
<p>　プロジェクトの一覧や、プロジェクトに含まれるフォームやコードなどの一覧が表示される</p>
</div>
<p><br /></p>
<p>　画面の表示は作業の内容によって変わるので、ここにはまだ表示されていないものもあります。それらについては、そのつど紹介することにしましょう。ともあれ、Visual Studioが起動できたので、新しいプログラムを作成しましょう。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>タスクバーにピン留めしておくと素早く起動できる</b></p>
</b></div>
<div>
<p>Visual Studioが起動するとタクスバーにアイコンが表示されます。そのアイコンを右クリックして［タスクバーにピン留め］を選択すれば、アイコンがタスクバーに常に表示されます。次からはアイコンをクリックするだけで起動できるようになります。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-83">
<div><b>
<p><b>■プロジェクトを新規作成する</b></p>
</b></div>
</div>
<hr />
<p>　Visual Studioでは、プログラムに含まれるフォームやコードをプロジェクトというまとまりで管理しています。したがって、プログラムを作るためには、プロジェクトを新規作成する必要があります。画面<span>2</span>-<span>4</span>のようにメニューを選択してプロジェクトを新規作成するか、ツールバーの左の方にある［新しいプロジェクト］ボタンをクリックします。また、［最近使用したファイル］の上にある［新しいプロジェクト...］をクリックしても構いません。</p>
<p><br /></p>
<div>
<p><img src="images/00091.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　メニューから［ファイル（F）］－［新規作成（N）］－［プロジェクト（P）...］を選択する</p>
</div>
<div>
<p>　　ⓐ ［新しいプロジェクト］ボタンをクリックしてもよい</p>
</div>
<div>
<p>　　ⓑ ［新しいプロジェクト...］をクリックしてもよい</p>
</div>
<p><br /></p>
<p>　いずれの方法でも、［新しいプロジェクト］ダイアログボックスが表示されます。このダイアログボックスで、これから作成するプロジェクトの種類を選択し、名前を付けます。ここでは、Visual Basicというプログラミング言語を使ってWindowsアプリケーションを作成するので、左側のリストで［インストール済み］－［テンプレート］－［Visual Basic］－［Windows］の順に階層を開き、中央の一覧から［Windowsフォームアプリケーション］を選びます。プロジェクトには分かりやすい名前を付けておきます。ここではShowMessageという名前にしましょう（画面<span>2</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00106.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［インストール済み］－［テンプレート］－［Visual Basic］－［Windows］の順に階層を開く</p>
</div>
<div>
<p>❷　［Windowsフォームアプリケーション］をクリックする</p>
</div>
<div>
<p>❸　プロジェクト名を入力する</p>
</div>
<div>
<p>❹　［OK］ボタンをクリックする</p>
</div>
<p><br /></p>
<p>　プロジェクトが作成されると、画面<span>2</span>-<span>6</span>のような画面が表示されます。画面の中央に大きく表示された部分を［フォームデザイナー］と呼び、その中にあるForm<span>1</span>というタイトルのウィンドウを<span><b>フォーム</b></span>と呼びます。フォームはいわばプログラムの台紙にあたるようなもので、この上にラベルやボタンなどのコントロールを配置しながらプログラムのウィンドウをデザインしていくわけです。</p>
<p><br /></p>
<div>
<p><img src="images/00119.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>①　［フォームデザイナー］：</p>
</div>
<div>
<p>　　ここでプログラムのウィンドウをデザインする</p>
</div>
<div>
<p>②　フォーム：</p>
</div>
<div>
<p>　　プログラムのウィンドウをデザインするための台紙にあたる</p>
</div>
<div>
<p>③　［ツールボックス］タブ：</p>
</div>
<div>
<p>　　フォーム上に配置できるコントロールの一覧。このタブをクリックすると、一覧が表示される</p>
</div>
<div>
<p>④　［ソリューションエクスプローラー］：</p>
</div>
<div>
<p>　　プロジェクトやプロジェクトに含まれるフォームなどが一覧表示される</p>
</div>
<div>
<p>⑤　［プロパティ］ウィンドウ：</p>
</div>
<div>
<p>　　フォームやコントロールの性質や設定を変更するためのウィンドウ</p>
</div>
<p><br /></p>
<p>　フォーム上に配置するコントロールは、ツールボックスから選択します。またコントロールのプロパティは［プロパティ］ウィンドウで指定します。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-84">
<div><b>
<p><b>■フォームをデザインする〜コントロールの配置</b></p>
</b></div>
</div>
<hr />
<p>　フォームが表示されたので、コントロールをフォーム上に配置していきましょう。このプログラムはボタンをクリックしたらメッセージを表示するものなので、文字列の表示ができる<span><b>Labelコントロール</b></span>と、ボタンとしての働きを持つ<span><b>Buttonコントロール</b></span>を配置します。</p>
<p>　［ツールボックス］タブをクリックし、コントロールの一覧を表示します。まず、一覧の中にある［Label］をクリックして、フォーム上に配置しましょう（画面<span>2</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00153.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［ツールボックス］タブをクリックする</p>
</div>
<div>
<p>②　［ツールボックス］の一覧が表示される</p>
</div>
<div>
<p>❸　［コモンコントロール］をクリックする</p>
</div>
<div>
<p>④　一般的に使われるコントロールの一覧が表示される</p>
</div>
<div>
<p>❺　［Label］をクリックする</p>
</div>
<div>
<p>❻　フォーム上をクリックする</p>
</div>
<p><br /></p>
<p>　選択したコントロールをフォーム上に配置するには、フォームをクリックするだけで構いません。フォーム上をドラッグすれば、コントロールの位置やサイズを変えて配置することもできます。［ツールボックス］の背後にフォームが隠れて、フォームがクリックできないときには、もう一度［ツールボックス］タブをクリックするか、［フォームデザイナー］の空白の部分をクリックし、［ツールボックス］を非表示にしてからフォーム上をクリックするといいでしょう。</p>
<p>　フォーム上に配置したコントロールは、ドラッグ操作で位置を変えたり、サイズを変えたりすることができます（画面<span>2</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00166.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　Labelコントロールにマウスポインターを合わせる</p>
</div>
<div>
<p>②　マウスポインターが<span>4</span>方向の矢印の形に変わる</p>
</div>
<div>
<p>❸　ドラッグするとLabelコントロールが移動できる</p>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>Labelコントロールのサイズを変更するには</b></p>
</b></div>
<div>
<p>　Labelコントロールのサイズは、表示される文字列の長さによって自動的に決められます。自由にサイズを変更したいときにはLabelコントロールのAutoSizeプロパティをFalseに設定します。</p>
</div>
</div>
<p><br /></p>
<p>　ツールボックスは常に表示しておくこともできます。［ツールボックス］というタイトルの右にある画鋲のアイコンをクリックしてみてください。ツールボックスが表示されたままになり、ツールボックスの背後にフォームが隠されることもなくなります。ディスプレイの解像度が大きければツールボックスを常に表示しておいたほうが使いやすいでしょう（画面<span>2</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00188.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div>
<p><span><b>❶</b></span>　画鋲のアイコン（<img src="images/00148.jpeg" alt="" />）をクリックする</p>
</div>
</div>
<div>
<div>
<p><span><b>②</b></span>　ツールボックスが表示されたままになる</p>
</div>
</div>
<div>
<div>
<p><span><b>③</b></span>　画鋲のアイコンが縦向き（<img src="images/00225.jpeg" alt="" />）になっている</p>
</div>
</div>
<p><br /></p>
<p>　では、同じようにして、Buttonコントロールを<span>2</span>つ配置してみましょう。ドラッグして位置やサイズも整え、画面<span>2</span>-<span>10</span>のようにしてください。また、フォームのサイズも変更しておいてください。</p>
<p><br /></p>
<div>
<p><img src="images/00022.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　以上で、基本的なデザインができあがりました。次にフォームやコントロールの細かな設定を変えていきましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-85">
<div><b>
<p><b>■プロパティを設定する</b></p>
</b></div>
</div>
<hr />
<p>　すでに触れたように、プロパティとは性質とか属性といった意味です。フォームやコントロールのプロパティを変更することによって、表示されている文字列や色、サイズ、そのほかの設定を変えることができます。まず、Buttonコントロールに表示されているテキストを「Button<span>1</span>」から「表示（S）」に変えてみましょう。テキストを変更するには、<span><b>Textプロパティ</b></span>に文字列を設定します（画面<span>2</span>-<span>11</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00265.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div>
<p><span><b>❶</b></span>　Buttonコントロールをクリックして選択する</p>
</div>
</div>
<div>
<div>
<p><span><b>②</b></span>　選択されているコントロールの名前がドロップダウンリストに表示される</p>
</div>
</div>
<div>
<div>
<p><span><b>❸</b></span>　［プロパティ］ウィンドウのTextの欄をクリックし、「表示(&amp;S)」と入力する</p>
</div>
</div>
<p><br /></p>
<p>　コントロールを選択するときには、コントロールをダブルクリックしないように注意してください。もし、間違ってダブルクリックしてしまった場合は、自動的にイベントハンドラーが追加され、コードウィンドウが表示されますが、とりあえずはそのまま放置しておいて構いません。［Form<span>1</span>.vb［デザイン］］タブをクリックすれば元のフォームデザイナーの画面に戻ります。なお、イベントハンドラーの詳細については、P.<span>52</span>で説明します。</p>
<p>　このように、プロパティを変更するには、対象となるフォームやコントロールをクリックし、［プロパティ］ウィンドウで値を指定するだけです。［プロパティ］ウィンドウの一覧は項目の分類によって並べられていますが、アルファベット順に表示することもできます。</p>
<p><br /></p>
<div>
<p><img src="images/00186.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［項目別］ボタンをクリックすると、プロパティが分類されて表示される</p>
</div>
<div>
<p>❷　［アルファベット順］ボタンをクリックするとプロパティがアルファベット順に表示される</p>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>NameプロパティとTextプロパティの違いに注意</b></p>
</b></div>
<div>
<p>　Nameプロパティはコントロールの名前そのものですが、Textプロパティはあくまでコントロールに表示される単なる文字列です。プログラミングにまだ慣れていない人の中には、NameプロパティとTextプロパティを混同する人が少なくありません。最初のうちは違いを意識しておくようにしましょう。</p>
</div>
</div>
<p><br /></p>
<p>　同じようにして、画面<span>2</span>-<span>13</span>と表<span>2</span>-<span>1</span>に従ってプロパティを変更しておきましょう。<span><b>Nameプロパティ</b></span>はコントロールを識別するための名前です。後でコードを記述するときにこの名前を使うので、分かりやすい名前を付けるようにしましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00051.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00138.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><span><b>注意</b></span><span>：FormのNameプロパティには、フォームの目的が分かるような名前を指定した方がいいのですが、本書の執筆時点ではNameプロパティを変更してもコードの一部が変更されず「Form<span>1</span>は&lt;プロジェクト名&gt;のメンバーではありません」というエラーが発生します。そのため、本書では、既定のForm<span>1</span>といった名前を変更しないことにします。Nameプロパティを変更してしまった場合は、エラーメッセージをダブルクリックし、コードウィンドウに表示されたコードの中の「Form<span>1</span>」をNameプロパティに指定した名前に変更します（この手順でフォームの名前が変えられます）。</span></p>
</div>
<p><br /></p>
<p>　最初は、Labelコントロールには何も表示されないようにしておきたいのでTextプロパティの文字列を削除しておきます。プロパティウィンドウの［Text］の欄を選択し、<img src="images/00262.jpeg" alt="" />キーを押せば、設定内容が削除できます。文字列を削除すると、Labelコントロールに何も表示されなくなるので、フォーム上から消えたように見えますが、コントロールそのものが削除されたわけではありません。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>表示されていないコントロールを選択するには</b></p>
</b></div>
<div>
<p>　見えなくなっているコントロールを選択するには、コントロールのあった位置を囲むようにドラッグします。コントロールの位置が分からない場合は、［プロパティ］ウィンドウの上のほうにあるドロップダウンリストをクリックして、一覧の中から選択します。いずれの方法でも、選択されたコントロールが点線の枠で表示されます。</p>
</div>
</div>
<p><br /></p>
<p>　ところで、ButtonコントロールのTextプロパティに「&amp;S」や「&amp;X」のような文字列が指定されているのが気になっている人もいるかと思います。フォーム上のコントロールを見ると、「&amp;」に続けて書かれた英字<span>1</span>文字にアンダーラインが表示されていることも分かります（画面<span>2</span>-<span>13</span>）。このような、「&amp;」に続けて書いた文字は<span><b>アクセスキー</b></span>と呼ばれ、キーボードを使ってボタンなどを操作するときに使われます。例えば、Textプロパティに「表示（&amp;S）」を指定したButtonコントロールであれば、アクセスキーは「S」となります。プログラムの実行時には<img src="images/00018.jpeg" alt="" />+<img src="images/00019.jpeg" alt="" />キーを押すことにより、このボタンが選択できます。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>「&amp;」やアクセスキーの文字は半角で入力する</b></p>
</b></div>
<div>
<p>　「&amp;」は半角で入力する必要があります。アクセスキーには任意の文字を指定できますが、日本語の文字を指定しても実行時に選択できないので、半角の英数字を指定するのが普通です。</p>
</div>
</div>
<p><br /></p>
<p>　以上でフォームのデザインは終わりです。ちょっと先走ってしまうことになりますが、試しにプログラムを実行してみましょう。ツールバーにある［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックしてみてください。プログラムが実行され、これまでにデザインしたウィンドウが表示されます（画面<span>2</span>-<span>14</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00002.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［開始］ボタンをクリックする</p>
</div>
<div>
<p>②　プログラムが起動した</p>
</div>
<div>
<p>❸　［表示（S）］ボタンをクリックする</p>
</div>
<div>
<p>④　何も起こらない</p>
</div>
<div>
<p>❺　ウィンドウ右上の［閉じる］ボタン（<img src="images/000232.gif" alt="" />）をクリックしてプログラムを終了させる</p>
</div>
<p><br /></p>
<p>　この段階では、ウィンドウがそのまま表示されるだけです。例えば、［表示（S）］ボタンをクリックしても、何も表示されません。また、［終了（X）］ボタンをクリックしても何も起こりません。というのも、ここではButtonコントロールを配置してプロパティを設定しただけで、これらのボタンをクリックしたときに何をするか決めていないからです。プログラムの「動き」を決めるにはコードを記述する必要があります。</p>
<p>　次は、コードを記述して動きのあるプログラムにします。実行したプログラムのタイトルバー右上にある［閉じる］ボタンをクリックするか、Visual Studioのツールバーにある［デバッグの停止］ボタン（<img src="images/000251.gif" alt="" />）をクリックして、プログラムをいったん終了させておいてください。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-86">
<div><b>
<p><b>■コードを書く〜イベントハンドラーの作成</b></p>
</b></div>
</div>
<hr />
<p>　プログラムがどのように動くのかを指示するためにはコードを書く必要があります。このプログラムでやりたいことは次の<span>2</span>つです。</p>
<p><br /></p>
<div>
<p>［表示（S）］ボタンをクリックしたら、ラベルにメッセージを表示したい</p>
</div>
<div>
<p>［終了（X）］ボタンをクリックしたら、プログラムを終了させたい</p>
</div>
<p><br /></p>
<p>　では、メッセージを表示するところから見ていきます。まず、［フォームデザイナー］に表示されたフォーム上の［表示（S）］ボタンをクリックして選択します。次に［プロパティ］ウィンドウの上にある［イベント］ボタンをクリックし、イベントの一覧を表示します。</p>
<p>　イベント一覧の中に［Click］があるので、その欄の右にShowMessageと入力しましょう（画面<span>2</span>-<span>15</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00004.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［表示（S）］ボタンをクリックして選択する</p>
</div>
<div>
<p>❷　［イベント］ボタンをクリックする</p>
</div>
<div>
<p>❸　［Click］の右に「ShowMessage」と入力する</p>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>コントロールをダブルクリックすると</b></p>
</b></div>
<div>
<p>　画面<span>2</span>-<span>15</span>でボタンをダブルクリックするだけでもイベントハンドラーが作成され、画面<span>2</span>-<span>16</span>のようなコードウィンドウが表示されます。ただし、その場合「Private Sub」の後に入力されるプロシージャ名は「コントロール名_Click」となります。Subの後のプロシージャ名を「ShowMessage」に書き換えると、画面<span>2</span>-<span>16</span>と同じになります。なお、間違って作成してしまったイベントハンドラーを削除したい場合は、「Private Sub」から「End Sub」までを削除してください。</p>
</div>
</div>
<p><br /></p>
<p>　この［Click］というのはClickイベント、つまり「クリックされたとき」ということを表します。「ShowMessage」は、実行される<span><b>プロシージャ</b></span>（手続き）の名前です。分かりやすいものであれば、別の名前を付けても構いません。</p>
<p>　ShowMessageと入力して<img src="images/00137.jpeg" alt="" /> キーを押すと、画面<span>2</span>-<span>16</span>のような<span><b>コードウィンドウ</b></span>が表示されます。</p>
<p><br /></p>
<div>
<p><img src="images/00140.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　コードウィンドウにはあらかじめコードが入力されています。その部分を抜き出してみると、LIST<span>2</span>-<span>1</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>2</span>-<span>1</span>　作成されたイベントハンドラー</p>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub ShowMessage(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles btnMessage.Click</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre>
<div>　本書では、長いコードが1行に収まらないときには⇒を付けて行が続くことを表します。紙面上では複数行になっていますが、実際には改行せずに入力します。</div>
</div>
</div>
<p><br /></p>
<p><br /></p>
<p>　画面<span>2</span>-<span>14</span>で指定したShowMessageがプロシージャ名で、Handlesの後に書かれているのが「どのコントロールのどのイベントが起こったときに実行するか」ということです。btnMessage.Clickとあるので「btnMessageという名前のコントロールがクリックされたとき」という意味になります（図<span>2</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00016.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このように、何かのイベントが起こったときに実行されるプロシージャを<span><b>イベントハンドラー</b></span>と呼びます。したがって、ShowMessageプロシージャはbtnMessageコントロールのClickイベントハンドラーである、ということになります。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>コントロール名の表し方について</b></p>
</b></div>
<div>
<p>　これ以降「btnMessageという名前のButtonコントロール」のことを単に「btnMessageコントロール」と表記し、ほかのコントロールについても同様に表します。例えば、「lblMessageという名前のLabelコントロール」は「lblMessageコントロール」と表記します。</p>
</div>
</div>
<p><br /></p>
<p>　あらかじめ入力されているコードにはほかにもいろいろと謎がありますが、いまの時点ではあまりに気にせず、自分のやりたいことだけを書きましょう。</p>
<p>　やりたいこととは、</p>
<p><br /></p>
<div>
<p>■lblMessageコントロールにメッセージを表示する</p>
</div>
<p><br /></p>
<p>ということでしたね。これを、もう少しプログラミング的な言葉で表すと、</p>
<p><br /></p>
<div>
<p>■lblMessageコントロールのTextプロパティにメッセージの文字列を代入する</p>
</div>
<p><br /></p>
<p>ということになります。LIST<span>2</span>-<span>1</span>のPrivate SubとEnd Subの間にコードを書いて、以下のようにしてみましょう。<span><b>①</b></span>の部分が自分で入力するコードです（LIST<span>2</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>2</span>-<span>2</span>　メッセージを表示するためのコード</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ShowMessage(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles btnMessage.Click</code></pre>
<pre lang="en"><code>        lblMessage.Text = "Hello VB!"　　　●─</code><code><code>─</code></code><code><code><code>─</code></code>①</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　コードを見ると、コントロールのプロパティが「コントロール名.プロパティ名」のように「.」（ピリオド）で区切って表されていることに気が付きます。このコードは、lblMessageコントロールのTextプロパティに"Hello VB!"という文字列を代入するという意味になります（図<span>2</span>-<span>3</span>）。「=」が代入を表す演算子ですが、ここでは「入れる」という意味だと思っておいてもらって構いません。なお、代入については<span>3</span>.<span>3</span>節で詳しく見ていきます。</p>
<p><br /></p>
<div>
<p><img src="images/00193.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　プロパティの値は、フォームのデザイン時に［プロパティ］ウィンドウで設定するだけでなく、このようにしてプログラムの実行時にコードで設定できるのです。Textプロパティの値が変更されると、表示される文字列がその時点で変わります。</p>
<p>　コード全体を見て、もう一度プログラムの動きを確認しておきましょう。これまでの流れをまとめると「btnMessageコントロールをクリックしたら、ShowMessageイベントハンドラーが実行され、lblMessageコントロールのTextプロパティに"Hello VB!"という文字列が代入される」ということが分かります（図<span>2</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00179.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　これで、ボタンをクリックしたら、ラベルにメッセージが表示されるようになったわけです。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-87">
<div><b>
<p><b>■コードを簡単に入力する</b></p>
</b></div>
</div>
<hr />
<p>　実際にコードを入力してみると、コードを<span>1</span>文字<span>1</span>文字入力しなくても、候補を選ぶだけで簡単に入力できることが分かります。LIST<span>2</span>-<span>2</span>のコードであれば、コードウィンドウで、lblまで入力した時点で、「lblMessage」というコントロール名がポップアップ表示されます（画面<span>2</span>-<span>17</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00344.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　「lbl」まで入力する</p>
</div>
<div>
<p>②　候補が表示される</p>
</div>
<div>
<p>③　lblMessageが選択された状態になっている</p>
</div>
<p><br /></p>
<p>　この時点で「.」（ピリオド）を入力すると「lblMessage.」までが自動的に入力されます。さらに、続けて入力できる単語（プロパティやメソッド）の一覧も表示されます（画面<span>2</span>-<span>18</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00220.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❹　「.」（ピリオド）と入力する</p>
</div>
<div>
<p>⑤　「lblMessage.」までが自動的に入力され、次に入力できる単語の候補が表示される</p>
</div>
<div>
<p>❻　スクロールバーをドラッグして項目をクリックするか、方向キーを使って「Text」が選択された状態にする</p>
</div>
<p><br /></p>
<p>　一覧からプロパティ名を選び、<img src="images/00096.jpeg" alt="" />キーを押すか、そのまま続けて次のコードを入力すれば、そのプロパティ名が自動的に入力されます。例えば、Textプロパティを選び、「=」と入力すると、「Text」が自動的に入力され、さらに「=」の次に入力できる候補が表示されます（画面<span>2</span>-<span>19</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00283.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❼　「=」（イコール）を入力する</p>
</div>
<div>
<p>⑧　「lblMessage.Text =」と入力される</p>
</div>
<div>
<p>⑨　代入できる値の候補がさらに表示される</p>
</div>
<p><br /></p>
<p>　入力できる候補が多いと選択しづらいかもしれませんが、次に入力したい単語の先頭数文字が分かっていれば、候補が絞り込めるので、選択がかなり楽になります。この場合なら、「lblMessage.Te」まで入力すれば、「Te」で始まる単語だけが一覧に表示されます。</p>
<p>　あとは、続けてコードを入力し、「lblMessage.Text = "Hello VB!"」というコードを完成させるだけです。</p>
<p>　なお、このような、入力できる候補を一覧表示してくれる機能は、Visual Studioのインテリセンスに含まれる機能の<span>1</span>つです。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-88">
<div><b>
<p><b>■メソッドを利用する</b></p>
</b></div>
</div>
<hr />
<p>　では、これまでの復習を兼ねて、［終了（X）］ボタンについてもイベントハンドラーを書いておきましょう。［Form<span>1</span>.vb［デザイン］］タブをクリックすれば、デザイナーウィンドウが表示できます。［終了（X）］ボタンを選択し、［プロパティ］ウィンドウで、［Click］イベントの欄にプロシージャ名（イベントハンドラー名）を入力しましょう。ここではExitProcと入力します。つまり、btnExitコントロールのClickイベントハンドラーをExitProcという名前にしたわけです。</p>
<p><br /></p>
<div>
<p><img src="images/00196.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［Form<span>1</span>.vb［デザイン］］タブをクリックする</p>
</div>
<div>
<p>②　フォームデザイナーが表示される</p>
</div>
<div>
<p>❸　［終了（X）］ボタンをクリックする</p>
</div>
<div>
<p>❹　［プロパティ］ウィンドウの［イベント］ボタンをクリックする</p>
</div>
<div>
<p>❺　［Click］の欄に「ExitProc」と入力する</p>
</div>
<p><br /></p>
<p>　コードウィンドウが表示されたら、LIST<span>2</span>-<span>3</span>のように入力しましょう。<span><b>①</b></span>の部分が入力すべきコードです。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>2</span>-<span>3</span>　プログラムを終了させるためのコード</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()　　　●───①</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　このコードでは、ApplicationとExit()が「.」（ピリオド）で区切られて書かれています。Applicationというのは、このプログラムそのものを表す<span><b>オブジェクト</b></span>です。その後のExitは「終了する」という動作を表す<span><b>メソッド</b></span>です。メソッドには後ろに()を付ける必要があります（図<span>2</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00066.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　多くのメソッドでは、()の中に<span><b>引数</b></span>と呼ばれるデータが指定できるようになっています。引数は「ひきすう」と読みます。引数はメソッドの動作のために使われるデータですが、詳細についてはChapter<span>7</span>で詳しく説明します。Exitメソッドのように、引数を必要としない場合でも()は省略できません。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>（）は自動的に付加される</b></p>
</b></div>
<div>
<p>　実際には()を入力しなくても、インテリセンスの機能により、自動的に()が付加されます。</p>
</div>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>フォームデザイナーやコードウィンドウを表示するには</b></p>
</b></div>
<div>
<p>　フォームデザイナーやコードウィンドウのタブが表示されていない場合は、ソリューションエクスプローラーを使ってフォームデザイナーやコードウィンドウを表示します。フォームのファイル名をダブルクリックすればフォームデザイナーが表示されます。フォームのファイル名を選択して［コードの表示］ボタンをクリックすれば、コードウィンドウが表示されます（画面<span>2</span>-<span>21</span>）。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00292.jpeg" alt="" /></p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<p>　オブジェクトについてはChapter<span>8</span>で改めて説明しますが、さまざまな機能を持った部品のことだと考えておいてください。......というと、コントロールとどう違うのかと疑問に思う人も多いでしょう。実は、コントロールもオブジェクトの一種です。とりあえずは、イラスト<span>2</span>-<span>6</span>のように理解しておくといいでしょう。</p>
<p><br /></p>
<div>
<p><img src="images/00006.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p>　コントロールの多くはLabelやButtonなどのように、ユーザーインターフェイス部品として使われます。しかし、Applicationオブジェクトはユーザーインターフェイスを提供する部品ではありません。直接には見えない部品ですが、さまざまな機能を持っています。自動車の部品にもハンドルやメーターのように目に見えるもの、直接操作できるものがありますが、一方でエンジンの中のバルブ（弁）や変速機のギアのように目に見えないところで使われる部品もあります。それと同じことです。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-89">
<div><b>
<p><b>■プログラムを実行する</b></p>
</b></div>
</div>
<hr />
<p>　コードがすべて入力できたら、プログラムを実行してみましょう。ツールバーにある［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックしてみてください。プログラムが実行され、ウィンドウが表示されたら［表示（S）］ボタンをクリックしてメッセージを表示してみましょう。画面<span>2</span>-<span>22</span>のようにメッセージが表示されれば完成です。［終了（X）］ボタンをクリックし、プログラムが終了することも確認しておいてください。</p>
<p><br /></p>
<div>
<p><img src="images/00060.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［表示（S）］ボタンをクリックする</p>
</div>
<div>
<p>②　メッセージが表示される</p>
</div>
<div>
<p>❸　［終了（X）］ボタンをクリックする</p>
</div>
<div>
<p>④　プログラムが終了する</p>
</div>
<p><br /></p>
<p>　プログラムを実行すると、プロジェクトは自動的に保存されます。プログラムを実行せずに変更内容を保存しておきたいときは、メニューバーから［ファイル（F）］−［すべてを保存（L）］を選択してください。内容が変更されているときには、フォームデザイナーやコードウィンドウのタブに「*」が表示されています（画面<span>2</span>-<span>23</span>）。</p>
<p>　Visual Studioのウィンドウの右上にある［閉じる］ボタン（<img src="images/000232.gif" alt="" />）をクリックすれば、Visual Studioの開発環境も終了します。</p>
<p><br /></p>
<div>
<p><img src="images/00287.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>①　変更がある場合は「*」が表示されている</p>
</div>
<div>
<p>❷　［ファイル（F）］−［すべてを保存（L）］を選択する</p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-90">
<div><b>
<p><b>■プログラムのエラーに対処する</b></p>
</b></div>
</div>
<hr />
<p>　Visual Studioでは、コードを入力するときに単語の候補が表示されるので、単語のつづりを間違う可能性はずいぶんと少なくなっています。しかし、もし間違いがあれば、問題のある単語の下に波線が表示されます（画面<span>2</span>-<span>24</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00105.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このプログラムではコードが数行しかないので、間違いにも気付きやすいですが、間違いに気付かずに、そのまま［開始］ボタンをクリックして実行しようとすると、エラーメッセージが表示されます（画面<span>2</span>-<span>25</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00028.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［開始］ボタンをクリックする</p>
</div>
<div>
<p>②　「ビルドエラーが発生しました」というメッセージが表示される</p>
</div>
<div>
<p>❸　［いいえ（N）］をクリックする</p>
</div>
<div>
<p>④　エラーメッセージが表示される</p>
</div>
<p><br /></p>
<p>　プログラムにエラーがあると、当然プログラムは実行できません。「ビルドエラーが発生しました。続行して、最後に成功したビルドを実行しますか？」というメッセージが表示されたときに［はい（Y）］をクリックすると、以前に間違いなく実行できたプログラムがあればそれをもう一度実行することになります。［いいえ（Y）］をクリックすれば、エラーメッセージが表示されます。一覧表示されたエラーメッセージをダブルクリックすると、カーソルがそのエラーのある行に移動するので、つづりの間違いなどは簡単に修正できます。修正できたら、もう一度実行してみましょう。なお、<span><b>ビルド</b></span>とは、私たちが作ったプログラム（<span><b>ソースプログラム</b></span>）を機械語に翻訳し、実行用プログラムを作成することです。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>エラーを自動的に訂正することもできる</b></p>
</b></div>
<div>
<p>　エラーのある行の前には電球のようなアイコンが表示されています。このアイコンをクリックすると訂正の方法が一覧表示されます。ただし、かなりプログラミングに慣れていないと、どれを選んでいいのか分からない場合も多く、かえって混乱することもあります。今の段階では不用意に項目を選択しないほうが無難です。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00333.jpeg" alt="" /></p>
</div>
<p><br /></p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-91">
<div><b>
<p><b>■実行用プログラムのある場所</b></p>
</b></div>
</div>
<hr />
<p>　最後に<span>1</span>つ補足です。［開始］ボタンをクリックすると、デバッグモードでプログラムが実行されます。デバッグとはプログラムのエラーを発見し、修正するという意味です。この場合、実行用のプログラムは、プロジェクトを保存したフォルダーの下にあるbinフォルダーの下のDebugフォルダーに作成されます。このプログラムではDebugフォルダーにあるShowMessage.exeという名前のファイルが実行用のプログラムです。エクスプローラーの標準設定では、ファイル名の拡張子（.exe）が表示されないことに注意してください（画面<span>2</span>-<span>27</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00133.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Debugフォルダーに作られた実行用プログラムはあくまでもテスト用に使うプログラムです。プログラムが最終的に完成し、配布できるようになったときには［開始］ボタンの隣にある［ソリューション構成］リストから［release］を選択して、メニューから［ビルド］－［ソリューションのビルド］を選択します。すると、binフォルダーの下のReleaseフォルダーに配布用のプログラムが作成されます。なお、［開始］ボタンをクリックすると、そのままプログラムが実行されます。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>プロジェクトが保存されている場所は？</b></p>
</b></div>
<div>
<p>　画面<span>2</span>-<span>27</span>をよく見れば分かりますが、プロジェクトに含まれるすべてのファイルは、通常、［ドキュメント］－［Visual Studio 2015］－［Projects］の下の&lt;ソリューション名&gt;フォルダーに保存されています。なお、ソリューションとは複数のプロジェクトをまとめたものです。下のColumnを参照してください。</p>
</div>
</div>
<p><br /></p>
<div>
<div id="calibre_link-293">
<div><b>
<p><b><span><b><img src="images/00053.jpeg" alt="" /><b></b></b></span>ソリューションとは</b></p>
</b></div>
</div>
<div>
<p>　Visual Basicのプログラムはプロジェクトというまとまりで管理されています。さらに、関連のあるいくつかのプロジェクトは、ソリューションと呼ばれるまとまりで管理されています。つまり、ソリューションには複数のプロジェクトを含めることができるというわけです。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00009.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>　ワープロソフトや表計算ソフトでは、エクスプローラーに表示された文書やブックのアイコンをダブルクリックすれば、プログラムが起動され、データが読み込まれます。Visual Studioでも、同じ方法でプロジェクトを開くことができます。エクスプローラーに表示されたソソリューションのアイコンをダブルクリックすれば、Visual Studioが起動するとともにソリューションに含まれるプロジェクトが読み込まれます。<span>1</span>つのソリューションに複数のプロジェクトがある場合には、すべてのプロジェクトが読み込まれます。</p>
</div>
<div>
<p>　なお、新しいプロジェクトを作成すると、そのプロジェクトを含むソリューションも自動的に作成されます。本書で取り扱うサンプルプログラムはすべて、<span>1</span>つのソリューションに<span>1</span>つのプロジェクトが含まれたものになっています。</p>
</div>
</div>
</div>
</div>
<div id="calibre_link-33">
<div>
<div id="calibre_link-92">
<div><b>
<p><b>　<span><b>2</b></span>.<span><b>3</b></span>　よく使うコントロール</b></p>
</b></div>
</div>
<p><br /></p>
<p>　Chapter<span>3</span>からは本格的にVisual Basicのプログラミングに取り組んでいきます。それに先だってよく使われるコントロールを紹介しておきましょう。料理でいえば、利用できる食材の一覧です。美味しい料理を作るためには上手に食材を組み合わせ、素材を生かすような調理法が必要です。プログラミングという調理法を学ぶにあたって、コントロールという食材の性質や働きを確認しておきましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-93">
<div><b>
<p><b>■よく使うコントロールの一覧</b></p>
</b></div>
</div>
<hr />
<p>　Visual Basicには数多くのコントロールが標準で用意されています。それらのうち、一般的なプログラムでよく使われるものを表<span>2</span>-<span>2</span>にまとめておきました。利用できるコントロールにどのようなものがあるかを知りたいときには以下の表を参照してください。</p>
<p><br /></p>
<div>
<p><img src="images/00241.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p><img src="images/00101.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　上記のコントロール以外にも、プログラムをより使いやすくするコントロールや、より高度な機能を提供するコントロールもたくさんあります。いわば、料理の味を引き立たせるためのスパイスや高級食材といった感じのものです。これらについては表<span>2</span>-<span>3</span>にまとめておきます。</p>
<p><br /></p>
<div>
<p><img src="images/00335.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p><img src="images/00211.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p><img src="images/00089.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　ツールボックスにはこれらのコントロールが表に示したような分類に従って表示されます。ただし、［すべてのWindowsフォーム］の下には分類に関係なくほとんどすべてのコントロールがアルファベット順に表示されています。表の最後にある「その他」はここで示したツールボックスの分類に入っていないコントロールのうちよく使われるものを一覧にしたものです。</p>
<p>　なお、［ポインター］はコントロールではなく、そのときに選択しているコントロールの選択状態を解除し、通常のマウスポインターに戻すためのアイコンです。</p>
</div>
</div>
<div id="calibre_link-34">
<div>
<div><b>
<p><b>Chapter<span><b>2</b></span>のまとめ</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　Visual Studioではプロジェクトというまとまりでプログラムを管理しています</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Visual StudioでWindowsのプログラムを作成するには、まず、フォームにコントロールを配置します</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　コントロールの性質はプロパティと呼ばれ、フォームのデザイン時に変更できます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　コントロールの動作はメソッドと呼ばれます。メソッドを呼び出すにはコードを書く必要があります</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　コントロールがクリックされるなど、何かが起こったときにはイベントハンドラーと呼ばれる手続きが自動的に呼び出されます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　イベントハンドラーにコードを書いておけば、コントロールで何かが起こったときに、プロパティを変更したり、メソッドを呼び出したりできます</b></p>
</b></div>
</div>
</div>
<div id="calibre_link-314">
<div>
<div id="calibre_link-94">
<div><b>
<p><b>練習問題</b></p>
</b></div>
</div>
<p><br /></p>
<p><span><b>［A］</b></span>　Visual Basicで使われる用語と、その正しい説明を線で結んでください。</p>
<p><br /></p>
<div>
<p><img src="images/00204.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><span><b>［B］</b></span>　（<span>1</span>）以下のコードの説明を埋めるもっとも適切な用語を選んでください。</p>
<p><br /></p>
<div>
<pre lang="en"><code>①	    Private Sub ShowMessage(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>	 Handles btnMessage.Click</code></pre>
<pre lang="en"><code>②	        lblMessage.Text = "Hello VB!"</code></pre>
<pre lang="en"><code>③	    End Sub</code></pre></div>
<p><br /></p>
<p>９　このコードはbtnMessageという（　ア　）のClick（　イ　）が起こったときに実行される（　ウ　）です。処理の内容はlblMessageという（　ア　）のText（　エ　）に文字列を代入し、その文字列を表示するというものです。"Hello VB!"という文字列がText（　オ　）です。</p>
<div>
<div>
<p><br /></p>
</div>
</div>
<div>
<p>（a）　イベントハンドラー　　（b）プロパティ　　（c）イベント</p>
</div>
<div>
<p>（d）　コントロール　　（e）プロパティに設定する値</p>
</div>
<div>
<div>
<p><br /></p>
</div>
</div>
<div>
<p>（<span>2</span>）　上のコードのうち、プログラムを作る人がコードウィンドウで記述しなければいけないのはどの行でしょう。正しいものに○を、間違っているものに<span>×</span>を記入してください。</p>
</div>
<div>
<div>
<p><br /></p>
</div>
</div>
<div>
<p>（ ）　①〜③すべて　　（ ）②だけ　（ ）　②と③　　（ ）③だけ</p>
</div>
<div>
<p>（ ）　どの行も記述しなくてよい</p>
</div>
<div>
<div>
<p><br /></p>
</div>
</div>
<div>
<p><span><b>［C］</b></span>　<span>2</span>.<span>2</span>節で作成したプロジェクトを開き、別のメッセージを表示するようにShowMessageイベントハンドラーを書き換えてみてください。メッセージの内容は好きな言葉で構いません。</p>
</div>
</div>
</div>
<div id="calibre_link-338">
<div>
<div id="calibre_link-95">
<div>
<p>Part<span>2</span></p>
</div>
</div>
<p><br /></p>
<div><b>
<p><b>Visual Basicの</b></p>
</b></div>
<div><b>
<p><b>基礎を身に付ける</b></p>
</b></div>
<hr />
<div>
<p>Part<span>1</span>ではVisual Basicでプログラムを作成する手順を学びました。このPartでは、VisualBasicのプログラミング言語としての基礎を学びます。単にさまざまなコントロールの使い方を知るのではなく、変数や定数、条件分岐、繰り返し処理、配列、プロシージャ、クラスなどをどう記述するかをしっかりと理解することに重点を置きます。プログラムを作るためのルールを身に付けることは、プログラミングを自由自在に進めるための基本です。一歩ずつ確実に見ていきましょう。</p>
</div>
</div>
</div>
<div id="calibre_link-38">
<div>
<div id="calibre_link-96">
<div><b>
<p><b>Chapter<span><b>3</b></span></b></p>
</b></div>
</div>
<p><br /></p>
<div><b>
<p><b>数値や文字列を取り扱う</b></p>
</b></div>
<hr />
<div>
<p>この章では、コードの書き方についての基本的なルールを確認した後、変数や演算といったプログラミングの基本を見ていきます。便利なコントロールがたくさん用意されているといっても、それらを並べただけでは目的に合ったプログラムとしては動きません。コントロールをいかに組み合わせ、連動させ、目的の結果を得るかが重要です。そのための基礎を身に付ける最初のステップです。</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><span><b>3</b></span>.<span><b>1</b></span>　コードの書き方</b></p>
</b></div>
<div>
<p>キーワード／演算子／リテラル／コメント／ステートメントを複数行に書く</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>3</b></span>.<span><b>2</b></span>　変数と定数</b></p>
</b></div>
<div>
<p>変数を利用する／何を変数として宣言するのか／変数のデータ型／変数を初期化する／値型の変数と参照型の変数／変数のスコープ／変数のアクセスレベル／定数を利用する</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>3</b></span>.<span><b>3</b></span>　代入と演算</b></p>
</b></div>
<div>
<p>代入とは／変数のデータ型と代入の注意点／さまざまな演算／演算子の優先順位／演算の精度</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>3</b></span>.<span><b>4</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
<div>
<p>時間を変換するプログラム／フォームのデザイン／タブオーダーの設定／イベントハンドラーの記述／プログラムを実行する</p>
</div>
</div>
</div>
<div id="calibre_link-318">
<div>
<div><b>
<p><b>これから学ぶこと</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　Visual Basicではどのようなキーワードが使われるかを学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Visual Basicのコードを書くための基本的なルールを学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　変数や定数の使い方を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　代入や演算の方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　この章で学んだことがらを利用してプログラムを作成します</b></p>
</b></div>
<p><br /></p>
<div>
<p><img src="images/00190.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>　この章ではコードの基本的な書き方を学び、変数や演算を利用したプログラムを作ります。時給を計算する場合には、時と分で表された時間を小数に変換すると便利です。例えば、<span>4</span>時間<span>30</span>分を<span>4</span>.<span>5</span>時間のように表せば、単純な掛け算で給与が求められます。作成するのは単純なプログラムですが、プログラミングの基礎を身に付ける最初のステップです。すべてはここから始まります。</p>
</div>
</div>
</div>
<div id="calibre_link-62">
<div>
<div id="calibre_link-97">
<div><b>
<p><b>　<span><b>3</b></span>.<span><b>1</b></span>　コードの書き方</b></p>
</b></div>
</div>
<p><br /></p>
<p>　Visual BasicではLabelコントロールやTextBoxコントロール、Buttonコントロールなどの部品を使ってウィンドウをデザインします。それらの部品を使えば、データを入力したり、プログラムの動きを決めたりすることもできます。しかし、本格的なプログラムを作成するには、コードの書き方の基本を身に付けておく必要があります。ここでは、コードの中に出てくるいくつかの要素を紹介します。物語に出てくる登場人物の紹介といった程度の気分で、気楽に読み進めてください。プログラミングを始めたくてうずうずしている人は、先に<span>3</span>.<span>4</span>節の「プログラミングにチャレンジ」に取り組んでもらっても構いません。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-98">
<div><b>
<p><b>■キーワード</b></p>
</b></div>
</div>
<hr />
<p>　Chapter<span>2</span>では、プログラミングの手順を見ていく中で、最後に以下のようなコードを書きました。実際に記述した内容は<span>1</span>行だけですが、あらかじめ入力されているコードも含めてざっと見渡してみるといろいろなことに気が付くと思います（LIST<span>3</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>1</span>　Chapter<span>2</span>で作成したイベントハンドラー</p>
</div>
<div>
<div>
<pre lang="en"><code><span><u>Public Class</u></span> Form1</code></pre>
<pre lang="en"><code>    Private Sub ShowMessage(sender<span><u>As Object</u></span>, e<span><u>As</u></span> EventArgs) ⇒</code></pre>
<pre lang="en"><code><span><u>Handles</u></span> btnMessage.Click</code></pre>
<pre lang="en"><code>        lblMessage.Text = "Hello VB!"</code></pre>
<pre lang="en"><code><span><u>End Sub</u></span></code></pre>
<pre lang="en"><span><u><code>End Class</code></u></span></pre></div>
</div>
<p><br /></p>
<p>　コードウィンドウの表示を見ると、それぞれの単語が異なる色で表示されています。例えば、Public、Class、Private、Sub、Asなどは青い色で表示されています（紙面では波線の箇所）。これらの青い色の文字で表示されている単語は<span><b>キーワード</b></span>と呼ばれるもので、使い方の決まった単語です。キーワードにはあらかじめ決められた働きがあるので、その働きに合わせた使い方をする必要があります。例えば、キーワードを次の節で説明する変数や定数の名前として使うことはできません。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>コードのフォントや色をカスタマイズするには</b></p>
</b></div>
<div>
<p>　メニューバーから［ツール（T）］－［オプション（O）...］を選択し、［オプション］ダイアログボックスを表示します。続いて、ダイアログボックスの左のリストから［環境］－［フォントおよび色］を選択すれば、フォントや表示色の設定画面が表示されます。</p>
</div>
</div>
<p><br /></p>
<p>　よく使われるキーワードには以下のようなものがあります。しかし、ここですべてを覚える必要はありません。これらのキーワードの働きを理解し、使いこなせるようになることはプログラミングを身に付けるうえできわめて重要なことですが、プログラミングを学ぶうちに自然に覚えてしまうので、ざっと目を通しておくだけで十分です。</p>
<p><br /></p>
<div>
<pre lang="en"><code>And	As	Boolean	Byte	Call	Case	Catch</code></pre>
<pre lang="en"><code>Class	Const	Continue	Date	Default	Dim	Do</code></pre>
<pre lang="en"><code>Double	Each	Else	ElseIf	End	EndIf	Error</code></pre>
<pre lang="en"><code>Event	Exit	False	For	Function	Get	Handles</code></pre>
<pre lang="en"><code>If	Imports	In	Integer	Is	Long	Loop</code></pre>
<pre lang="en"><code>Me	Mod	New	Next	Not	Nothing	Object</code></pre>
<pre lang="en"><code>Of	On	Option	Or	Private	Property	Public</code></pre>
<pre lang="en"><code>Return	Select	Short	Single	Static	Step	Stop</code></pre>
<pre lang="en"><code>String	Sub	Then	Throw	To	True	Try</code></pre>
<pre lang="en"><code>Wend	When	While	With</code></pre></div>
<p><br /></p>
<p>　これらのキーワードはすべて半角文字で入力することに注意してください。全角文字で入力しても自動的に半角に変換されるので神経質になる必要はありませんが、プログラムのコードは、コメントや文字列以外は半角英数字で入力するのが基本です。</p>
<p>　LIST<span>3</span>-<span>1</span>のコードを見ると、ほかにも、単語の区切りに半角スペースが使われていること、「.」（ピリオド）で区切られた単語があること、()で囲まれた単語があること、SubとEnd Sub、ClassとEnd Classが対になっていることなどに気が付くと思います。しかし、一度にたくさんのことを詰め込んでも身に付きません。Chapter<span>4</span>以降で少しずつ見ていくことにしましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-99">
<div><b>
<p><b>■演算子</b></p>
</b></div>
</div>
<hr />
<p>　プログラムの中では、さまざまな計算をします。足し算、引き算、掛け算、割り算といった数値の計算のほか、大小の比較をしたり、複数の文字列をつないだりすることもあります。このような操作のことを<span><b>演算</b></span>と呼びます。演算とは、広い意味での計算のことといえるでしょう。演算に使う記号や単語のことを<span><b>演算子</b></span>といい、以下のようなものがよく使われます。</p>
<p><br /></p>
<div>
<p>■算術演算子　<span>^  *  /  \  Mod  +  -</span></p>
</div>
<div>
<p>■代入演算子　<span>=  ^=  *=  /=  \=  +=  -=  &amp;=</span></p>
</div>
<div>
<p>■比較演算子　<span>&lt;  &lt;=  &gt;  &gt;=  =  &lt;&gt;</span></p>
</div>
<div>
<p>■連結演算子　<span>&amp;  +</span></p>
</div>
<div>
<p>■論理演算子　<span>And  Not  Or  Xor  AndAlso  OrElse</span></p>
</div>
<p><br /></p>
<p>　演算子の使い方については、<span>3</span>.<span>3</span>節で詳しく見ます。なお、論理演算子については<span>4</span>.<span>2</span>節で詳しく説明することとします。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-100">
<div><b>
<p><b>■リテラル</b></p>
</b></div>
</div>
<hr />
<p>　<span><b>リテラル</b></span>という言葉にはあまりなじみがないかもしれませんが、日本語にすると「文字通りの」といった意味で、Visual Basicでは、決まった値のことをいいます。例えば、123という数値や"Hello VB!"という文字列がリテラルと呼ばれます。つまり、リテラルとは値そのもののことです。表<span>3</span>-<span>1</span>にリテラルの例を示します。</p>
<p><br /></p>
<div>
<p><img src="images/00085.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　表<span>3</span>-<span>1</span>の例を見て気付くかもしれませんが、123とそのまま数字を書くと数値と見なされ、"123"のように二重引用符で囲むと文字列と見なされます。数値は足し算や掛け算などの計算に使えますが、文字列は数学的な計算には基本的には使えません。</p>
<p>　文字列の内容には全角文字が使えますが、二重引用符は半角で入力します。数値を表す場合は半角文字を使います。数値に全角文字は使えません。</p>
<p><br /></p>
<div>
<p><img src="images/00269.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　二重引用符などの囲み文字で囲んだり、末尾に型文字と呼ばれる文字を付けることによってリテラルのデータ型を明示的に表すこともできます（表<span>3</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00339.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p>　浮動小数点数とは小数部のある数値を近似値で表したものです。浮動小数点数にも整数にもいくつかの型がありますが、特に何も指定しない場合、小数点付きの数値リテラルは倍精度浮動小数点型と見なされ、整数のリテラルは整数型と見なされます。これらのデータ型についての詳細は、次の節で説明します。</p>
<p>　整数は&amp;Hを先頭に付けると<span>16</span>進数と見なされ、&amp;Oを先頭に付けると<span>8</span>進数と見なされます。例えば、&amp;H<span>1</span>Aは<span>16</span>進数の<span>1</span>Aを表し、&amp;O<span>32</span>は<span>8</span>進数の<span>32</span>を表します。<span>10</span>進数、<span>16</span>進数、<span>8</span>進数の対応は以下のとおりです（表<span>3</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00014.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-101">
<div><b>
<p><b>■コメント</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> ShowBirthday</p>
</div>
<hr />
<p>　Visual Basicでは、「'」（単一引用符）から行末までは<span><b>コメント</b></span>と見なされます。コメントはプログラムの実行には何も影響を与えないので、コードの説明などを書いておくことができます。コメントには半角文字、全角文字のいずれも使えます（LIST<span>3</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>2</span>　コードにコメントを書いた例</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ShowBirthday(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles btnShow.Click</code></pre>
<pre lang="en"><code>        ' メッセージボックスに日付を表示します</code></pre>
<pre lang="en"><code>        MessageBox.Show(#3/14/2016#)	' #で囲むと日付型のリテラル</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　適度にコメントを入れておくと、コードが読みやすくなります。自分で書いたコードでも、時間が経てば何をするためのコードであるか忘れてしまいがちです。また、ほかの人が仕事を引き継いでこのコードを利用するかもしれません。仕事の効率という観点からも必要に応じてコメントを入れておくようにしましょう。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>メッセージボックスを表示するには</b></p>
</b></div>
<div>
<p>　MessageBoxクラスのShowメソッドを利用すると、メッセージボックスを表示できます。例えば、LIST<span>3</span>-<span>2</span>のイベントハンドラーが実行されると、以下のようなメッセージボックスが表示されます。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00025.jpeg" alt="" /></p>
</div>
<p><br /></p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-102">
<div><b>
<p><b>■ステートメントを複数行に書く</b></p>
</b></div>
</div>
<hr />
<p>　Visual Basicの各行のコードは<span><b>ステートメント</b></span>とも呼ばれます。ステートメントは 演算子や「,」の後であれば改行できます。また、「(」の後や「)」の前でも改行できます。ただし、スペースで区切られている単語の間で改行したいときには、普通、行が次に続くことを表すため、スペースと「_」（アンダースコア）を行末に入れておく必要があります。もちろん、単語の途中で改行することはできません。以下の例では、「Object,」の後ろには「_」を入れても、そのまま改行しても構いませんが、「As」の後や「Handles」の後で改行するにはスペースと「_」が必要です（LIST<span>3</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>3</span>　「_」（アンダースコア）を使って長い行を複数行に分ける</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ShowBirthday(sender As Object, _</code></pre>
<pre lang="en"><code>                             e As EventArgs) Handles btnShow.Click</code></pre>
<pre lang="en"><code>        ' メッセージボックスに日付を表示します</code></pre>
<pre lang="en"><code>        MessageBox.Show(#3/14/2016#)	' #で囲むと日付型のリテラル</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　ただし、本書では、どこまでを<span>1</span>行で記述するかが分かるように、LIST<span>3</span>-<span>2</span>のようにできるだけ行を分割せずに  を使って行が続いていることを表します。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>長い行を折り返して表示するには</b></p>
</b></div>
<div>
<p>　メニューバーから［ツール（T）］－［オプション（O）...］を選択し、［オプション］ダイアログボックスを表示します。続いて、ダイアログボックスの左のリストから［テキストエディター］－［Basic］</p>
</div>
<div>
<p>を選択すれば、設定画面に［テキストを折り返す（W）］というチェックボックスが表示されます（画面<span>3</span>-<span>2</span>）。この項目をクリックしてチェックマークを付けておけば、コードウィンドウの右端で長い行が折り返して表示されます。また、その下の［右端の折り返しの記号を表示（S）］にチェックマークを付けておけば、コードが折り返されたことが分かるように、右端に記号が表示されます（画面<span>3</span>-<span>3</span>）。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00127.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p><img src="images/00005.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
</div>
<p><br /></p>
<div>
<div id="calibre_link-294">
<div><b>
<p><b><span><b><img src="images/00053.jpeg" alt="" /><b></b></b></span>データ型を厳密に取り扱うには</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> OptionStrictTest</p>
</div>
<p><br /></p>
<div>
<p>　Visual Basicの標準的な設定では、データ型が異なっていても計算ができるように、データ型が自動的に変換されるようになっています。例えば、100 + "123"という式では、"123"が数値に変換できるので223という結果が求められます。ただし、100 + "123x"の"123x"は数値に変換できないので、エラーとなります。</p>
</div>
<div>
<p>　データ型が自動的に変換されるのは一見便利なように思えますが、実際には思わぬ誤作動のもとになる危険があります。しかも原因が分かりにくく、修正に時間がかかることがあるので、十分な注意が必要です。そのため、"123"をあくまでも文字列と見なし、100 + "123"をエラーとするなど、データ型をできるだけ厳密に取り扱うように設定しておくこともできます。そのためには、コードウィンドウの先頭にOption Strict Onと記述しておきます（画面<span>3</span>-<span>4</span>）。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00098.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div>
<p><span>❶　Option Strict Onと記述しておいた</span></p>
</div>
<div>
<p><span>❷　i = 100 + "123"というコードを書く</span></p>
</div>
<div>
<p><span>❸　［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックしてプログラムを実行</span></p>
</div>
<div>
<p><span>❹　「ビルドエラーが発生しました。続行して、最後に成功したビルドを実行しますか？」というメッセージが表示されるので［いいえ］をクリックする</span></p>
</div>
<div>
<p><span>⑤　データ型が変換できないというエラーが表示された</span></p>
</div>
<p><br /></p>
<p>　プロジェクト全体でデータ型を厳密に取り扱うようにするには、プロジェクトのプロパティを表示し、Option Strictの設定をオンにしておきます（画面<span>3</span>-<span>5</span>）。このように設定しておくと、コードウィンドウでOption Strict Onを記述する必要はありません。</p>
<p><br /></p>
<div>
<p><img src="images/00302.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><span>❶　［プロジェクト（P）］−［＜プロジェクト名＞のプロパティ（P）...］を選択する</span></p>
</div>
<div>
<p><span>②　プロジェクトのプロパティを設定するためのウィンドウが表示される</span></p>
</div>
<div>
<p><span>❸　［コンパイル］タブをクリックする</span></p>
</div>
<div>
<p><span>❹　［Option Strict（S）:］をクリックし、［On］を選択する</span></p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-103">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　左側の言葉の説明として適切なものを右側から選んで線で結んでください。</p>
<p><br /></p>
<div>
<p><img src="images/00332.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><span><b><span><b>2</b></span>.</b></span>　以下のリテラルのデータ型を答えてください。</p>
<p><br /></p>
<div>
<p>1234 　＿＿＿＿＿＿＿＿＿　</p>
</div>
<div>
<p>"こんにちはVB"　＿＿＿＿＿＿＿＿＿</p>
</div>
<div>
<p><span>3</span>.<span>14</span>　＿＿＿＿＿＿＿＿＿</p>
</div>
<div>
<p>"<span>1</span>.4142"　＿＿＿＿＿＿＿＿＿</p>
</div>
<p><br /></p>
<p><span><b><span><b>3</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）　引用符で囲んだ文字列リテラルの内容やコメントの文字列には全角文字が使える</p>
</div>
<div>
<p>（  ）　123xのように数値に文字を含めても123のような数値と見なされる</p>
</div>
<div>
<p>（  ）　コードは行の途中で自由に改行できる</p>
</div>
<div>
<p>（  ）　コメントの中にはキーワードと同じ文字列を含め、何を書いてもよい</p>
</div>
</div>
</div>
<div id="calibre_link-19">
<div>
<div id="calibre_link-104">
<div><b>
<p><b>　<span><b>3</b></span>.<span><b>2</b></span>　変数と定数</b></p>
</b></div>
</div>
<p><br /></p>
<p>　本格的なプログラムを作るには、さまざまなデータを取り扱う必要があります。前節では、リテラルと呼ばれる決まった値のデータの書き方を説明しましたが、プログラムの中で使われるデータはいつも決まった値というわけではありません。例えば、売上金額は商品がどれだけ売れたかによって変わります。また、預金残高はいくら預けていくら引き出したかによって値が変わります。そのようなデータを表すためには<span><b>変数</b></span>を使います。ここでは変数の書き方や使い方と、リテラルを使いやすくするための<span><b>定数</b></span>について学びます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-105">
<div><b>
<p><b>■変数を利用する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> VariableNameTest</p>
</div>
<hr />
<p>　<span><b>変数</b></span>とは、データを入れるための箱のようなものだとよくいわれます。もちろんただの箱とは違うところもありますが、最初のうちはそのような理解で十分です。プログラムに仕事をさせるということは、変数という作業用の箱を用意して、そこにデータを入れたり、そこからデータを取り出したりしながら、目的の結果を得ることだと考えていいでしょう。</p>
<p><br /></p>
<div>
<p><img src="images/00147.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<p>　プログラムを作成するときには、どのような変数を利用するかをあらかじめ書いておく必要があります。そのようなコードを書くことを<span><b>変数の宣言</b></span>といいます。</p>
<p>　日常の作業でもきちんと仕事をするためには、ただ「箱」を用意するだけでなく、その箱に名前を付けておきます。また、何を入れるかによって利用する箱を変える必要もあります。それと同じように、Visual Basicでも、変数を宣言するときには変数の名前と変数のデータ型を書きます。以下の例が変数の宣言例です（LIST<span>3</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>4</span>　さまざまなデータ型の変数を宣言する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim i As Integer　　　●───整数型の変数iを宣言</code></pre>
<pre lang="en"><code>Dim Weight As Double　　　●───倍精度浮動小数点型の変数Weightを宣言</code></pre>
<pre lang="en"><code>Dim ClientName As String　　　●───文字列型の変数ClientNameを宣言</code></pre></div>
</div>
<p><br /></p>
<p>　これらの例からある程度想像できると思いますが、変数の基本的な宣言方法は、以下のようになります（図<span>3</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00172.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　最初のDimが「これから変数を宣言しますよ」という意味のキーワードです。Asは日本語でいえば「〜として」です。したがって、最初の宣言は、</p>
<div>
<pre lang="en"><code>「iという名前の変数を、整数（Integer）として用意しておきますよ」</code></pre></div>
<p>という意味になります。LIST<span>3</span>-<span>4</span>の<span>2</span>番目の宣言は、小数点以下のある数値を取り扱うための変数の宣言です。データ型としては、精度の違いによりDoubleまたはSingleを指定します。精度に関する詳細についてはP.<span>88</span>を参照してください。<span>3</span>番目の文字列型の変数については説明不要でしょう。実は、整数型や浮動小数点型と文字列型には、大きな違いがあるのですが、それについては後のお楽しみとしましょう（P.<span>89</span>）。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>変数にDimというキーワードを使う理由</b></p>
</b></div>
<div>
<p>　DimというのはDimension（配列）の略です。変数の宣言にDimというキーワードを使うことに違和感を覚える人もいるかもしれません。実は、初期のBasicでは、特に変数は宣言しなくても使えました（現在でも、宣言しなくても変数が使えるように設定することができます）。しかし、配列を利用するときには宣言が必要でした。変数の宣言にDimを使うのは、配列の宣言に使ったDimが、変数の宣言にも使われたためだといわれています。</p>
</div>
</div>
<p><br /></p>
<p>　変数名には、その変数をどのような目的で使うかがよく分かるような名前を付けておきます。さきほどの例でいえば、Weightは何かの重さであるということが分かりますし、ClientNameは顧客の名前であることが分かります。ただし、変数名に使える文字には以下のような制限があるので注意してください。</p>
<p><br /></p>
<div>
<p>■変数名には、英字、数字、日本語文字、「_ 」（アンダースコア）が使える</p>
</div>
<div>
<p>■変数名は数字で始まっていてはいけない</p>
</div>
<div>
<p>■途中に空白文字を入れてはいけない</p>
</div>
<p><br /></p>
<p>　例えば、以下のような名前は変数名として使えます。</p>
<div>
<pre lang="en"><code>Counter　　　Sum2016　　　売上金額　　　Student_Number</code></pre></div>
<p>　しかし、以下のような名前は変数名としては使えません。</p>
<p><br /></p>
<div>
<p>Counter¥　　　●───記号「¥」が使われている</p>
<p>2016Sum　　　　●───数字で始まっている</p>
<p>売上　金額　　　●───途中に空白文字が入っている</p>
<p><br /></p>
</div>
<p>　といっても、それほど神経質になる必要はありません。使えない文字を利用して変数を宣言しようとすると、エラーメッセージが表示されるのですぐに分かります（画面<span>3</span>-<span>6</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00306.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div id="calibre_link-295">
<div><b>
<p><b><span><b><img src="images/00053.jpeg" alt="" /><b></b></b></span>変数名の付け方</b></p>
</b></div>
</div>
<div>
<p>　変数は、変数名に使える文字を使って宣言するというのは当然のことですが、分かりやすい名前を付けるということについてはさまざまな考え方があります。とりわけ、議論の的になるのがハンガリアン記法と呼ばれる命名法です。ハンガリアン記法はマイクロソフトでExcelなどを開発していたチャールズ・シモニーが考案した命名法で、変数名の前に変数の用途やデータ型を表す文字列（プレフィックス）を付けるというものです。例えば、文字列であることが分かるようにstrを付け、strClientNameにするというのがそれにあたります。当初は、変数の種類が分かりやすいなどの理由で歓迎されていましたが、現在では、プレフィックスの付け方に明確な基準がなくかえって混乱のもととなる、多くのプログラミング言語でデータ型のチェックが厳密に行われるので、データ型を変数名に含めるのは無駄である、といった理由からあまり推奨されていません。</p>
</div>
<div>
<p>　実は、ハンガリアン記法にはアプリケーションハンガリアンと呼ばれる方法とシステムハンガリアンと呼ばれる方法があります。アプリケーションハンガリアンは変数のデータ型ではなく、変数の意味や目的が分かるようなプレフィックスを付ける方法です。例えば、相対位置（Relative Position）を表すためにrpを付け、rpTargetのように書くのがこの方法です。このようにすれば、この変数が何らかの基準から見た位置であるということが分かり、間違って絶対位置で計算してしまうことがなくなります。コントロール名にlblMessageのような名前を付け、Labelコントロールであるということが分かるようにするのも、どちらかというとデータ型の区別よりは意味や目的に重点を置いた考え方といえるでしょう。</p>
</div>
<div>
<p>　一方のシステムハンガリアンはデータ型を表すものです。例えば、strClientNameという書き方はシステムハンガリアンにあたります。実は、ハンガリアン記法に対する批判はほとんどがこのシステムハンガリアンに対するものです。</p>
</div>
<div>
<p>　Visual Basicでは、標準の設定（Option StrictがOffの状態）ではデータ型のチェックが厳密に行われず、自動的にデータ型が変換されるので、システムハンガリアンを使ってデータ型を変数名に含めることにもある程度の利点は認められます。しかし前節のコラム「データ型を厳密に取り扱うには」でも解説したように、データ型のチェックを厳密にしておけば、システムハンガリアンに頼らず、思わぬミス（多くの場合見つけるのが難しいミス）を防ぐことができます。</p>
</div>
<div>
<p>　本書でもシステムハンガリアンはできるだけ避けるようにします。一方、コントロール名などには、目的が分かるようなプレフィックスを付けることにします。なお、企業や部署ごとに詳細な命名基準を決めている場合には、その方法にそって変数名を付けるようにしてください。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-106">
<div><b>
<p><b>■何を変数として宣言するのか</b></p>
</b></div>
</div>
<hr />
<p>　宣言の書き方は分かっても、プログラミングがはじめてという人には、何を変数にすればいいのか分からないという人が多いようです。多くのプログラミング入門書はその疑問や悩みに答えてくれていません。しかし、原則は意外に簡単です。例えば、<span>4</span>時間<span>30</span>分のような「時」と「分」を<span>4</span>.<span>5</span>時間のような小数に変換するプログラムを考えてみましょう。</p>
<p>　まず「時」と「分」が必要......と考えがちですが、実はそれは間違いです。最初に考えるべきものは<span><b>結果として欲しいもの</b></span>です。この例でいえば、結果として欲しいものは小数で表された時間ですから、それをまず変数として宣言します。小数点以下の値があるので、Double型とすればいいでしょう。変数名をWorkingTimeとすれば、以下のように宣言できます。</p>
<div>
<pre lang="en"><code>Dim WorkingTime As Double</code></pre></div>
<p>　結果として欲しいものが分かれば、次に<span><b>その結果を得るために必要なもの</b></span>を洗い出します。この例なら、「時」と「分」です。いずれも整数なので、以下のように宣言しましょう。</p>
<div>
<pre lang="en"><code>Dim WorkingHour As Integer</code></pre>
<pre lang="en"><code>Dim WorkingMinute As Integer</code></pre></div>
<p>　必要な変数を洗い出す手順を図にしてみると、次ページのイラスト<span>3</span>-<span>4</span>のようになります。入力とはプログラムに与えるデータのことです。処理はプログラムの働きですね。そして、出力とはプログラムから出てくる結果です。</p>
<p><br /></p>
<div>
<p><img src="images/00187.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　プログラムの動作は「入力→処理→出力」のように流れるので、ともすれば入力や処理を先に考えがちです。しかし、重要なのは、出力を先に考えるということです。そしてその出力を得るために必要な入力は何かということを考えます。どんな処理をするかは最後に考えます。</p>
<p>　少しばかり先走りになりますが、Visual Basicのフォームも含めた処理の全体像を示すと図<span>3</span>-<span>2</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00052.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>①　フォームをデザインする</p>
</div>
<div>
<p>②　結果として求めたい値を入れる変数を用意する</p>
</div>
<div>
<p>③ ④　結果を求めるのに利用できる値を入れる変数を用意する</p>
</div>
<p><br /></p>
<p>　①のフォームのデザインはChapter<span>2</span>の知識でできます。フォームのデザイン時にもやはり結果として欲しいものを先に考える必要があります。②〜④はここで学んだ変数の宣言です。変数の宣言も結果として欲しいものから考えます。</p>
<p>　残る作業は枠で囲んで記した処理を記述するだけです。プログラムの処理では、変数に値を入れたり、変数の値を利用したりします。しかし、あせらずにゆっくりと進めましょう。処理については<span>3</span>.<span>4</span>節で説明するので、ここでは、変数の宣言がプログラムの骨格をはっきりさせるための第一歩だということを理解しておけば十分です。</p>
<p>　では、変数についてもう少し詳しく見ておきましょう。といっても、ここからの話はかなり細かくなるので、はじめての方や先を急ぐ方は次の節まで読み飛ばしてもらっても構いません。ただし、値型の変数と参照型の変数については、少しだけ気にしておいてください。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>変数を利用するか、プロパティに直接代入するか</b></p>
</b></div>
<div>
<p>　この例では、コントロールのプロパティだけを使い、変数を使わずにプログラムを作ってしまうこともできます。しかし、最初のうちは前ページで説明したような手順にそって、変数を用意し、ステップをきちんと押さえながらプログラムを作ったほうがいいでしょう。また、プログラムが複雑になってくると、コントロールのプロパティをそのまま使うよりも、いったん変数に値を入れておいたほうが、コードが分かりやすくなります。このように、ビュー（表示されているもの：図<span>3</span>-<span>2</span>の①にあたる）とコンテンツ（内容：図<span>3</span>-<span>2</span>の②〜④にあたる）を分けることはプログラミングだけでなくウェブデザインなどでも重要な考え方です。なお、複雑な作業をする場合には、途中の結果を入れておくための作業用の変数が必要になることもあります。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-107">
<div><b>
<p><b>■変数のデータ型</b></p>
</b></div>
</div>
<hr />
<p>　変数のデータ型のうち、よく使われるものを表<span>3</span>-<span>4</span>にまとめておきました。変数に代入したいデータの内容に合わせて、適切な型を指定して宣言しましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00282.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00154.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-108">
<div><b>
<p><b>■変数を初期化する</b></p>
</b></div>
</div>
<hr />
<p>　変数の宣言の後に「=」と値を書くと、変数に<span><b>初期値</b></span>が設定できます。</p>
<div>
<pre lang="en"><code>（例）Dim HitPoint As Integer = 100</code><code><code>　　　●───</code> 整数型の変数HitPointを宣言し、初期値として100を入れておく</code></pre></div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>データ型の指定を省略すると？</b></p>
</b></div>
<div>
<p>　Visual Basicの標準的な設定では、「As データ型」を省略すると、初期値のデータ型に従って変数のデータ型が自動的に決められます。初期値を設定していない場合はObject型と見なされます。「As データ型」を省略できないようにするには、コードの先頭にOption Strict Onと記述しておくか、プロジェクトのオプションでOption StrictをOnに設定しておきます。設定の方法については前節のコラム「データ型を厳密に取り扱うには」を参照してください。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-109">
<div><b>
<p><b>■値型の変数と参照型の変数</b></p>
</b></div>
</div>
<hr />
<p>　変数には、<span><b>値型</b></span>の変数と<span><b>参照型</b></span>の変数があります。表<span>3</span>-<span>4</span>に示した変数のうち、IntegerやDoubleなどは値型の変数で、Stringだけが参照型の変数です。</p>
<p>　値型の変数とは、まさにデータを入れる箱のようなもので、その変数に値が記憶されます。例えば、</p>
<div>
<pre lang="en"><code>Dim HitPoint As Integer = 100</code></pre></div>
<p>と宣言すると、HitPointという名前の整数型の「箱」が作られ、そこに100という値が初期値として入れられます。イメージとしては図<span>3</span>-<span>3</span>のような感じです。</p>
<p><br /></p>
<div>
<p><img src="images/00285.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　一方の参照型の変数には、値そのものは入れられません。<span><b>参照型の変数には、値がどこにあるかという情報が入れられる</b></span>のです。つまり、参照型の変数は「箱」ではなく、「宝の地図」のようなものです。例えば、</p>
<div>
<pre lang="en"><code>Dim ClientName As String</code></pre></div>
<p>と宣言すると、ClientNameという名前で白紙の「宝の地図」が作られます。宝の地図にはまだ何も書き込まれていないので、お宝（＝文字列）がどこにあるか分かりません。図<span>3</span>-<span>4</span>のようなイメージで理解しておくといいでしょう。</p>
<p><br /></p>
<div>
<p><img src="images/00263.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　ClientNameを宣言するだけでなく、初期値も設定してみましょう。</p>
<div>
<pre lang="en"><code>Dim ClientName As String = "春日由貴"</code></pre></div>
<p>　このように書くと、ClientNameに「春日由貴」という文字列が入れられるのではなく、文字列そのものはメモリ内の別の場所に記憶され、ClientNameという変数には、その文字列がどこにあるかということだけが記憶されます。イメージとしては図<span>3</span>-<span>5</span>のような感じです。</p>
<p><br /></p>
<div>
<p><img src="images/00125.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　値型と参照型の区別は、代入を実行する場合やプロシージャの引数を指定する場合、クラスを利用する場合に重要になってきます（<span>7</span>.<span>4</span>節、<span>8</span>.<span>2</span>節で詳しい説明をします）。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>変数に初期値を設定していない場合は？</b></p>
</b></div>
<div>
<p>　Integer型の変数に初期値を設定していない場合は<span>0</span>が既定値として入れられています。しかし、必要に応じて初期値はきちんと設定しておくようにしましょう。たとえ初期値が<span>0</span>の場合でも、初期値が設定されていることが分かるように記述しておくべきです。なお、String型の変数に初期値を設定していない場合はNothingという特別な値（何も参照していないということを表す値）が入れられています。図<span>3</span>-<span>4</span>の白紙の地図のようなイメージで理解しておくといいでしょう。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-110">
<div><b>
<p><b>■変数のスコープ</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> ScopeTest</p>
</div>
<hr />
<p>　変数には有効範囲があります。この有効範囲のことを変数の<span><b>スコープ</b></span>と呼びます。スコープとは視野という意味です。つまり、変数がどの範囲で使えるかということです。例えば、Sub ... End Subの中で宣言された変数はその範囲の中でのみ有効です。LIST<span>3</span>-<span>5</span>の例では、フォームにButtonコントロールを<span>2</span>つ配置し、それぞれのClickイベントハンドラーでxという変数の値をメッセージボックスに表示します。</p>
<p>　しばらくVisual Basicの文法の話が続いたので、このあたりでおさらいも兼ねてプロジェクトを作成し、試してみるといいでしょう。ダウンロード用のサンプルでコードを確認して、実行してみるだけでも構いません。ただし、⑥の行はエラーとなるので、実行する前に行の先頭に'を付けてコメント行にしておいてください。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>5</span>　モジュールレベル変数とプロシージャレベル変数</p>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Dim x As String = "外側のx"　　　●───①このxはForm1の中で有効</code></pre>
<pre lang="en"><code>    Private Sub ShowString1(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles Button1.Click</code></pre>
<pre lang="en"><code>        Dim x As String = "内側のx"　　　●───②このxはShowString1プロシージャの中でのみ有効</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        Dim y As String = "内側のy"　　　●───③このyはShowString1プロシージャの中でのみ有効</code></pre>
<pre lang="en"><code>        Debug.WriteLine(x)　　　●───④このxはForm1で宣言されたもの。</code></pre>
<pre lang="en"><code>したがって結果は「外側のx」</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    Private Sub ShowString2(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles Button2.Click</code></pre>
<pre lang="en"><code>        Debug.WriteLine(x)　　　●───⑤このxはForm1で宣言されたもの。したがって結果は「外側のx」</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        Debug.WriteLine(y)　　　●───⑥このyはShowString1プロシージャの中で宣言されたものなので、ここでは使えない（エラーとなる）</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　実際には、同じ名前の変数を別のスコープで使うのは避けたほうがいいのですが、ここでは、スコープの違いを理解するためにあえて同じ名前を付けてみました。コードを見ると、Form<span>1</span>の中にプロシージャが<span>2</span>つあることが分かります（画面<span>3</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00343.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　<span><b>プロシージャ</b></span>とはひとまとまりの手続きのことで、Subで始まりEnd Subで終わるものは特にSubプロシージャと呼ばれます。Subの前に付いているPrivateというキーワードについては、P.<span>94</span>で説明していますが、プロシージャでの指定については<a href="#calibre_link-20"><u>P.247</u></a>で説明します。とりあえず、後の楽しみにとっておきましょう。</p>
<p>　プロシージャの中にあるDebug.WriteLineは、コードウィンドウの下にある<span><b>出力ウィンドウ</b></span>に結果を表示するためのメソッドで、変数の値などをテスト用に表示するのによく使われます。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>出力ウィンドウが表示されないときは</b></p>
</b></div>
<div>
<p>　出力ウィンドウが自動的に表示されないときには、［デバッグ（D）］−［ウィンドウ（W）］−［出力（O）］を選択してください。なお、設定によっては、出力ウィンドウではなくイミディエイトウィンドウに結果が表示されることもあります。この設定を変更するには、まず［オプション］ダイアログボックスでの左側のリストから［デバッグ］−［全般］を選択し、右側の一覧で［出力ウィンドウの文字をすべてイミディエイトウィンドウにリダイレクトする］チェックボックスのオン／オフを切り替えます。標準の設定はオフで、結果は出力ウィンドウに表示されます。</p>
</div>
</div>
<p><br /></p>
<p>　LIST<span>3</span>-<span>5</span>の①で宣言されているxという変数を見てください。宣言はForm<span>1</span>の内側にあり、プロシージャの外側にあります。このような場合、変数はForm<span>1</span>というフォームの中で有効になり、Form<span>1</span>に含まれるどのプロシージャからも使えるものとなります。このようにフォームやクラスなどの中で使われる変数のことを<span><b>モジュールレベル変数</b></span>と呼びます。モジュールレベル変数は、そのモジュールの中であればどこでも使えます。</p>
<p>　一方、②と③では、ShowString<span>1</span>プロシージャの中で変数を宣言しています。この場合の変数xはモジュールレベル変数のxとは別のものとして扱われ、ShowString<span>1</span>プロシージャの中でのみ有効となります。変数yもこのプロシージャの中でだけ有効です。これらは<span><b>プロシージャレベル変数</b></span>と呼ばれます。④に書かれているxはプロシージャレベル変数のxなので、Button<span>1</span>をクリックしたときに出力ウィンドウに表示される結果は"内側のx"となります。</p>
<p>　ShowString<span>1</span>プロシージャで、モジュールレベル変数のxを利用したいときには、Me.xと記述します。Meは現在のクラス（この場合はForm<span>1</span>）を表すキーワードです。</p>
<p>　次にShowString<span>2</span>プロシージャを見てみましょう。⑤では、モジュールレベルの変数xをそのまま使っています。したがって結果は"外側のx"となります。⑥でも変数yの値を使っていますが、yはShowString<span>2</span>プロシージャの中でも、Form<span>1</span>でも宣言されていません。yはShowString<span>1</span>プロシージャの中で宣言されたものなので、その範囲外であるShowString<span>2</span>プロシージャでは使えません。［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックして、プログラムを実行しようとすると、ここでビルドエラーとなってしまいます。</p>
<p>　LIST<span>3</span>-<span>5</span>のコードを単純化して図に表すと図<span>3</span>-<span>6</span>のようになります。ここでもう一度、変数のスコープを確認しておきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00233.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p>　また、IfステートメントやForステートメントのブロック内で宣言された変数は、そのブロック内でだけ有効です。IfステートメントについてはChapter<span>4</span>で、ForステートメントについてはChapter<span>5</span>で詳しく解説するので、コードの例だけを示しておきましょう（LIST<span>3</span>-<span>6</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>6</span>　ブロックレベル変数の例</p>
</div>
<div>
<div>
<pre lang="en"><code>If i &gt; 100 Then</code></pre>
<pre lang="en"><code>    Dim z As String = "Level Up!"　　　●───Ifステートメントの中で変数zを宣言</code></pre>
<pre lang="en"><code>End If</code></pre>
<pre lang="en"><code>Debug.WriteLine(z)　　　●───Ifステートメントの外では変数zは使えない（エラーとなる）</code></pre></div>
</div>
<p><br /></p>
<p>　変数が目的の場所以外で使われると、プログラムのミスなどによって、思わぬところで値が変更されてしまう危険があります。したがって、必要なところでのみ変数が使えるように、スコープはできるだけ狭くしておきましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-111">
<div><b>
<p><b>■変数のアクセスレベル</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> AccessLevelTest</p>
</div>
<hr />
<p>　モジュールレベルの変数では、Dimの代わりにPublicやPrivateを指定することにより、モジュールの外からその変数を利用できるかどうかを指定できます。Publicを指定するとモジュールの外から変数を利用できるようになり、Privateを指定するとモジュールの中でのみ変数が利用できるようになります。</p>
<p>　例えば、プログラムにForm<span>1</span>とForm<span>2</span>という<span>2</span>つのフォームがあった場合、LIST<span>3</span>-<span>7</span>のようにPublicを指定して変数を宣言すると、Form<span>2</span>からForm<span>1</span>の変数MaxSeatCountが利用できます。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>7</span>　ほかのフォームで宣言されている変数を利用する</p>
</div>
<div>
<div>
<pre lang="en"><code>（Form1のコードウィンドウの内容）</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Public MaxSeatCount As Integer = 200　　　●───① orm1でPublicを指定して変数MaxSeatCountを宣言</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    Private Sub ShowForm2(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles btnShowForm2.Click</code></pre>
<pre lang="en"><code>        Form2.Show()　　　●───②Showメソッドを使ってForm2を表示</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>（Form2のコードウィンドウの内容）</code></pre>
<pre lang="en"><code>Public Class Form2</code></pre>
<pre lang="en"><code>    Private Sub ShowValue(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles btnShowValue.Click</code></pre>
<pre lang="en"><code>        Debug.WriteLine(Form1.MaxSeatCount)　　　●───③ Form1のMaxSeat Countの値を出力。結果は200</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　プロジェクトにフォームを追加するには、メニューから［プロジェクト］－［Windowsフォームの追加］を選択し、ファイル名を付けて［追加］ボタンをクリックします。Form<span>1</span>にbtnShowForm<span>2</span>というボタンを配置し、追加したForm<span>2</span>にbtnShowValueというボタンを配置すれば、LIST<span>3</span>-<span>7</span>のコードが入力できます。</p>
<p>　このプログラムを実行するとForm<span>1</span>が表示されます。Form<span>1</span>に表示されたbtnShowForm<span>2</span>ボタンをクリックするとForm<span>2</span>が表示されます。Form<span>2</span>にはbtnShowValueボタンが表示されているので、それをクリックすると、Form<span>1</span>で宣言した変数MaxSeatCountの値が表示されます。</p>
<p>　ほかのフォームで宣言されているPublic変数を利用するには、③のように「フォーム名.変数名」と書きます。</p>
<p>　しかしながら、①でPublicの代わりにPrivateやDimを指定すると、Form<span>2</span>からはForm<span>1</span>の変数MaxSeatCountが利用できなくなります。したがって、そこでビルドエラーになってしまいます。図<span>3</span>-<span>7</span>でPublicとPrivateの違いを確認しておきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00324.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p>　変数がほかの場所で使われ、値が変更されてしまうと、思わぬエラーを起こす可能性があります。アクセスレベルについてもできるだけ範囲を狭めるようにし、どうしてもPublicにする必要のある場合を除いて、Privateで宣言しておくようにしましょう。なお、Dimを指定した場合は、Privateが指定されたものと見なされますが、アクセスレベルが明確に分かるようにPrivateと明記するようにしましょう。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>Debug.WriteLine、Debug.Print、Console.WriteLineの違い</b></p>
</b></div>
<div>
<p>　Debug.WriteLineメソッドの代わりにDebug.Printメソッドを使っても同じ結果が得られます。ただし、WriteLineメソッドでは指定されたさまざまなデータを自動的に文字列に変換して出力してくれますが、Debug.Printメソッドに指定できるのは文字列型のデータのみです。したがって、Option StrictがOnの場合は、データ型の変換が必要です。LIST<span>3</span>-<span>7</span>の場合であれば、③のコードは</p>
</div>
<div>
<pre lang="en"><code>Debug.Print(Form1.MaxSeatCount.ToString())</code></pre></div>
<div>
<p>とする必要があります。</p>
</div>
<div>
<p>　なお、出力ウィンドウに結果を表示するにはConsole.WriteLineメソッドも使えます。このメソッドはウィンドウを表示しないコンソールアプリケーションで、実行結果を表示するのに使われます。本書で取り上げている例では動作の違いはありませんが、コマンドプロンプトで実行すれば、画面にConsole.WriteLineメソッドの結果が表示されます。一方、Debug.WriteLineメソッドやDebug.Printメソッドは実行結果を表示するためのメソッドではなく、プログラムの動きをチェックするために使うものなので、コマンドプロンプトで実行しても結果は表示されません。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-112">
<div><b>
<p><b>■定数を利用する</b></p>
</b></div>
</div>
<hr />
<p>　<span><b>定数</b></span>とは、リテラルに分かりやすい名前を付けたものです。Constステートメントを使うと定数が宣言できます。変数には自由に値を入れることができますが、定数では宣言時に指定した値を後で変更することはできません。例えば、性別を表すときに、男性ならば<span>0</span>、女性ならば<span>1</span>という値を使いたいときには、LIST<span>3</span>-<span>8</span>のように定数を宣言しておくと便利です。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>8</span>　男性と女性を表す定数を宣言する</p>
</div>
<div>
<div>
<pre lang="en"><code>Const MALE As Integer = 0</code></pre>
<pre lang="en"><code>Const FEMALE As Integer = 1</code></pre></div>
</div>
<p><br /></p>
<p>　このように宣言すると、プログラムの中で男性を表したいときに<span>0</span>という値の代わりにMALEという名前が使えます。<span>0</span>のような数値だと意味がまったく分かりませんが、MALEと書けば性別を表す値であり、男性であるということがすぐに分かります。定数の宣言のしかたは以下のとおりです（図<span>3</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00055.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　変数と定数の違いは、値が変更できるかできないかです。定数に設定した値は後から変更することはできません。</p>
<p>　定数の名前の付け方は、変数の場合と同じです。ただし、それが定数と分かるように大文字で書くことが多いようです。もちろん、誤解がないことが確実な場合は小文字で書かれることもあります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-113">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　次の単語のうち、変数名として使えるものには○を、使えないものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）Person</p>
</div>
<div>
<p>（  ）Kiso!VB</p>
</div>
<div>
<p>（  ）first_day_of_the_week</p>
</div>
<div>
<p>（  ）<span>2</span>ndDay</p>
</div>
<div>
<p>（  ）Sub</p>
</div>
<div>
<p>（  ）総合計</p>
</div>
<p><br /></p>
<p><span><b><span><b>2</b></span>.</b></span>　以下の空欄に適切なキーワードを入れて、変数の宣言を完成させてください。</p>
<p><br /></p>
<div>
<p>Dim Counter As （　　）　......　整数型の変数Counterを宣言する</p>
</div>
<div>
<p>Dim Depth As （　　）　......　倍精度浮動小数点型の変数Depthを宣言する</p>
</div>
<div>
<p>（　　） STUDENT As Boolean = True</p>
</div>
<div>
<p>　　......　STUDENTという名前のブール型定数を宣言し、その値をTrueとする</p>
</div>
<div>
<p>（　　） GrandTotal As （　　）</p>
</div>
<div>
<p>　　......　整数型のプライベート変数GrandTotalを宣言する</p>
</div>
<p><br /></p>
<p><span><b><span><b>3</b></span>.</b></span>　以下の文章のうち正しいものには○を間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）　変数を宣言すればプログラムの中のどの場所でも自由にその変数が使える</p>
</div>
<div>
<p>（  ）　変数の宣言に続けて「= 値」と書くと変数に初期値を設定しておくことができる</p>
</div>
<div>
<p>（  ）　Publicキーワードを使って変数を宣言すると、ほかのフォームからでもその変数が利用できる</p>
</div>
<div>
<p>（  ）　定数の名前は必ず大文字で書く</p>
</div>
<div>
<p>（  ）　定数としてリテラルに名前を付けても、後からその値を変えることができる</p>
</div>
</div>
</div>
<div id="calibre_link-55">
<div>
<div id="calibre_link-114">
<div><b>
<p><b>　<span><b>3</b></span>.<span><b>3</b></span>　代入と演算</b></p>
</b></div>
</div>
<p><br /></p>
<p>　前節では変数の宣言方法について見てきました。ここからは変数やリテラルを使ってさまざまな計算をする方法を見ていきましょう。計算といっても四則演算だけでなく、代入や文字列の連結、比較なども含めた広い意味での計算なので、これらをまとめて<span><b>演算</b></span>と呼びます。そして演算のために使うキーワードを<span><b>演算子</b></span>と呼びます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-115">
<div><b>
<p><b>■代入とは</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> AssignTest</p>
</div>
<hr />
<p>　<span><b>代入</b></span>とは、変数にデータを入れることで、「=」という演算子を使って表します。まずは例を見てみましょう。変数の型が分かるように変数の宣言から示しておきます（LIST<span>3</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>9</span>　さまざまな変数に値を代入する</p>
</div>
<div>
<div>
<pre lang="en"><code>（例1）</code></pre>
<pre lang="en"><code>Dim Counter As Integer	' 整数型の変数Counterを宣言</code></pre>
<pre lang="en"><code>Counter = 0	' Counterに0を代入</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>（例2）</code></pre>
<pre lang="en"><code>Dim Height As Double	' 倍精度浮動小数点型の変数Heightを宣言</code></pre>
<pre lang="en"><code>Height = 1.72	' Heightに1.72を代入</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>（例3）</code></pre>
<pre lang="en"><code>Dim GroupName As String	' 文字列型の変数GroupNameを宣言</code></pre>
<pre lang="en"><code>GroupName = "営業グループ"	' GroupNameに"営業グループ"という文字列を代入</code></pre></div>
</div>
<p><br /></p>
<p>　代入の一般的な書き方は以下のようになります（図<span>3</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00076.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　「=」は等しいという意味ではなく、右辺の値を左辺に入れるという意味です。実は、代入には単純にデータを箱に入れるのとは違う面があります。「代入」という言葉が示すように、これまで変数に入っていたデータの「代わりに」新しいデータを「入れる」ということです。したがって、次のような代入もできます（LIST<span>3</span>-<span>10</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>10</span>　これまでに入っていた値の代わりに別の値を入れる</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim Counter As Integer = 1	' 整数型の変数Counterを宣言し、初期値1を代入</code></pre>
<pre lang="en"><code>Counter = 2	' Counterに2を代入</code></pre></div>
</div>
<p><br /></p>
<p>　この例の<span>2</span>行目ではCounterに<span>2</span>を代入します。それまではCounterに<span>1</span>が入っていましたが、その代わりに<span>2</span>を入れるというわけです。したがって、Counterの新しい値は<span>2</span>になります。</p>
<p>　代入の右辺にはリテラルだけでなく変数を書くこともできます。例えば、CounterにInitialNumberという変数の値を代入する場合は、以下のようなステートメントとなります。</p>
<div>
<pre lang="en"><code>Counter = InitialNumber</code></pre></div>
<p>　また、次のような式も書けます。変数の値を増やすときにはこのような書き方をするのがお決まりのパターンです（LIST<span>3</span>-<span>11</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>11</span>　変数の値を<span>1</span>増やす</p>
</div>
<div>
<div>
<pre lang="en"><code>Counter = 2</code></pre>
<pre lang="en"><code>Counter = Counter + 1	' Counterの値を1増やす</code></pre></div>
</div>
<p><br /></p>
<p>　この例も<span>2</span>行目に注目してください。ここではCounterの値に<span>1</span>加えた値をCounterに代入します。それまでCounterに入っていた<span>2</span>という値に<span>1</span>を加えた値を、元の値の代わりにCounterに入れるというわけです。したがって、Counterの値は<span>3</span>になります（図<span>3</span>-<span>10</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00301.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　なお、変数の値を増やす演算は「+=」という演算子を使って書くこともできます。次のように「+=」の後に増やしたい値を書くだけです。この書き方のほうが変数の値を増やしていることがよく分かります。</p>
<div>
<pre lang="en"><code>Counter += 1</code></pre></div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-116">
<div><b>
<p><b>■変数のデータ型と代入の注意点</b></p>
</b></div>
</div>
<hr />
<p>　代入は変数に値を入れるだけなので簡単なことのように見えますが、いくつか注意点があります。それらの注意点をまとめておきましょう。</p>
<p><br /></p>
<div><b>
<p><b>■変数のデータ型と代入できるデータの種類</b></p>
</b></div>
<p>　最初の注意点は、変数の型によって代入できるデータの種類に制限があるということです。例えば、Integer型の変数に文字列を代入することはできません。これも例を見てみましょう。以下のように書くとエラーとなります。</p>
<div>
<pre lang="en"><code>Dim Counter As Integer</code></pre>
<pre lang="en"><code>Counter = "第1回"	' エラーとなる例</code></pre></div>
<p>　Visual Basicの標準の設定（Option StrictがOffの状態）では、データの内容が解釈され、可能な限り代入先に合わせてデータ型が変換されます。したがって、文字列が数値として解釈できる場合は自動的に数値に変換されて代入されます。以下の例でCounterがInteger型であれば"123"という文字列が123という整数に変換されて代入されます。</p>
<div>
<pre lang="en"><code>Counter = "123"	' データ型が自動的に変換される例</code></pre></div>
<p>　このような、自動的なデータ型の変換は便利なように思えますが、すでに触れたように思わぬ落とし穴になることも多いので、十分に注意する必要があります。例えば、txtStartNumberという名前のTextBoxコントロールがあるとします。このTextプロパティの値（これはString型です）をCounterに代入する場合を考えてみましょう。図で表すと図<span>3</span>-<span>11</span>のような感じです。</p>
<p><br /></p>
<div>
<p><img src="images/00177.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　この場合だと、次のようなコードを書けばよさそうです。</p>
<div>
<pre lang="en"><code>Counter = txtStartNumber.Text</code></pre></div>
<p>　しかし、操作を間違ってtxtStartNumberコントロールに数値と解釈できない文字列を入力してしまったらどうでしょう。プログラムはエラーとなり、実行を停止してしまいます。このような場合には入力したデータが適切であるかどうかチェックしておく必要があります。具体的な対処法は<span>4</span>.<span>2</span>節で説明します。</p>
<p><br /></p>
<div><b>
<p><b>■代入の精度</b></p>
</b></div>
<div>
<p><img src="images/00143.jpeg" alt="" /> PrecisionTest</p>
</div>
<p>　次は、Single型やDouble型の値をInteger型の変数に代入する場合の注意です。Integer型の変数には整数しか入れられないので、浮動小数点数を代入すると小数点以下が銀行型丸め（<a href="#calibre_link-56"><u>P.102</u></a>参照）という方法で四捨五入されてしまいます。次の例ではAgeという変数はInteger型です。したがって、<span>21</span>.<span>5</span>という値を代入しようとしても、小数点以下が四捨五入された<span>22</span>が代入されることになります（LIST<span>3</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>12</span>　Integer型の変数に浮動小数点数を代入する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim Age As Integer</code></pre>
<pre lang="en"><code>Age = 21.5</code></pre>
<pre lang="en"><code>Debug.WriteLine(Age)　　　●───結果は22と表示される</code></pre></div>
</div>
<p><br /></p>
<p>　つまり、<span><b>精度</b></span>（表現できる値の範囲）の小さい変数に、精度の大きな値を代入すると、代入先に合わせて精度が小さくなるように自動的に変換されるというわけです。その場合には代入しようとする値によってはエラーとなったり、情報が失われる可能性があることに注意してください。</p>
<p>　Option StrictがOnの場合には、Age =<span>21</span>.<span>5</span>という代入ステートメントはデータ型が一致しないのでエラーになります。エラーにならないようにするにはAge = CInt(<span>21</span>.<span>5</span>)のように明示的に型変換をする必要があります。CIntは文字列や浮動小数点数の整数化に使われる関数です。なお、CIntの代わりに、Convert.Int<span>32</span>を使って、Convert.Int<span>32</span>(<span>21</span>.<span>5</span>)と書くこともできます。</p>
<p>　逆に、Single型やDouble型の変数に整数を代入しようすると、自動的に浮動小数点数に変換されて代入されます。精度の大きな変数に精度の小さな値を代入するときには、自動的に精度が大きくされるというわけです。このように、代入によって精度が下がらない場合は、Option StrictがOnでもエラーにはなりません。以下の例では、HeightというDouble型の変数に172という整数を代入していますが、この場合は倍精度浮動小数点数に変換された値が代入されます。出力ウィンドウには172とだけしか表示されませんが、正しく変換されています（LIST<span>3</span>-<span>13</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>13</span>　Double型の変数に整数を代入する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim Height As Double</code></pre>
<pre lang="en"><code>Height = 172</code></pre>
<pre lang="en"><code>Debug.WriteLine(Height)　　　●───結果は172と表示される</code></pre></div>
</div>
<p><br /></p>
<div id="calibre_link-56">
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>整数型への代入やでは銀行型丸めと呼ばれる四捨五入が行われる</b></p>
</b></div>
<div>
<p>　整数型の変数に浮動小数点数を代入したりCInt関数を使って文字列や浮動小数点数を整数化するとき、小数点以下は銀行型丸めと呼ばれる特殊な四捨五入の方法が使われます。<span><b>銀行型丸め</b></span>では、<span>0</span>.<span>5</span>を四捨五入した結果がいちばん近い偶数になるように切り上げ、または切り下げが行われます。例えば、<span>0</span>.<span>5</span>に近い偶数は<span>0</span>なので、CInt(<span>0</span>.<span>5</span>)では切り下げが行われ、結果は<span>0</span>となります。一方<span>1</span>.<span>5</span>に近い偶数は<span>2</span>なので、CInt(<span>1</span>.<span>5</span>)では切り上げが行われ、結果は<span>2</span>となります。</p>
</div>
<p><br /></p>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>通常の四捨五入や切り上げ、切り下げをするには</b></p>
</b></div>
<div>
<p>　数値の丸めにはいくつかの方法があります。ここではMathクラスのRoundメソッドを使って四捨五入や切り上げ、切り下げをする方法を紹介しましょう。Roundメソッドでは、銀行型の丸めも通常の四捨五入もできます。<span>21</span>.<span>5</span>だと同じ結果になるので、<span>22</span>.<span>5</span>で試してみましょう。</p>
</div>
<div>
<pre lang="en"><code>    Age = Math.Round(22.5, MidpointRounding.ToEven)　　　●───銀行型の丸め。結果は22</code></pre>
<pre lang="en"><code>    Age = Math.Round(22.5, MidpointRounding.AwayFromZero)　　　●───通常の丸め。結果は23</code></pre></div>
<div>
<p>　四捨五入したい数値の後に、カンマで区切ってMidpointRounding.ToEvenを指定するか、カンマも含めて省略すると銀行型の丸めになります。一方、MidpointRounding.AwayFromZeroを指定すると通常の四捨五入になります。</p>
</div>
<div>
<p>　Roundメソッドでは、四捨五入の桁位置も指定できます。例えば、小数点以下第<span>2</span>位が求められるように四捨五入するには</p>
</div>
<div>
<pre lang="en"><code>Pi = Math.Round(3.1415, 2, MidpointRounding.AwayFromZero)</code></pre></div>
<div>
<p>のように、求めたい桁位置（この場合は<span>2</span>）を数値の後に指定します。</p>
</div>
<div>
<p>　なお、切り上げにはMath.Ceilingメソッドを使い、切り下げにはMath.FloorメソッドやInt関数を使います。例えば、Math.Ceiling(<span>3</span>.<span>14</span>)は<span>4</span>になり、Math.Floor(<span>3</span>.<span>14</span>)やInt(<span>3</span>.<span>14</span>)は<span>3</span>になります。<span>※<span>1</span></span></p>
</div>
</div>
<p><br /></p>
<hr />
<div>
<p>※<span>1</span>　負の数を指定したときに注意が必要です。正確には、Math.Ceilingは指定した値以上の最小の整数を返します。したがって、Math.Ceiling(-<span>3</span>.<span>14</span>)は-<span>3</span>です。一方、Math.FloorやIntは指定した値以下の最大の整数を返します。したがって、Math.Floor(-<span>3</span>.<span>14</span>)やInt(-<span>3</span>.<span>14</span>)は-<span>4</span>となります。</p>
</div>
</div>
</div>
<div id="calibre_link-327">
<div>
<div><b>
<p><b>■参照型の変数への代入</b></p>
</b></div>
<div>
<p><img src="images/00143.jpeg" alt="" /> StringTest</p>
</div>
<p>　Integer型の変数やDouble型の変数への代入は、箱にデータを入れるというイメージでとらえることができますが、String型など参照型の変数への代入はしくみが異なっています。</p>
<p>　String型の変数には文字列そのものではなく<span><b>参照</b></span>が入っています。したがって、LIST<span>3</span>-<span>14</span>のように代入すると、参照が代入されます。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>3</span>-<span>14</span>　String 型の変数に代入する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim ClientName As String = "春日由貴"　　　●───①</code></pre>
<pre lang="en"><code>Dim OwnerName As String</code></pre>
<pre lang="en"><code>OwnerName = ClientName　　　●───②</code></pre></div>
</div>
<p><br /></p>
<p>　コードを見ると、値型の変数の場合とさほど変わらないように見えます。しかし、しくみを図で表してみると、その違いが分かるはずです（図<span>3</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00043.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　図の中に書かれている200というのは文字列のある場所を表します。この数字には特に意味はありません。仮に200番という場所だとして考えてみましょう、というだけの意味です。①では文字列が作られ、その参照（200という値と考えるといいですね）がClientNameに代入されます。実線の矢印はデータの流れを表しますが、点線の矢印は参照の方向を表していることに注意してください。つまり、点線の矢印はClientNameを見れば、記憶されている文字列にたどり着けるという矢印です。②では参照をOwnerNameに代入しているので、OwnerNameを見ても記憶されている文字列にたどり着けるということが分かります。したがって、</p>
<div>
<pre lang="en"><code>    Debug.WriteLine(ClientName)</code></pre></div>
<p>でも</p>
<div>
<pre lang="en"><code>    Debug.WriteLine(OwnerName)</code></pre></div>
<p>でも、「春日由貴」という文字列が出力ウィンドウに表示されます。</p>
<p><br /></p>
<div><b>
<p><b>■文字列の変更</b></p>
</b></div>
<p>　文字列の取り扱いにはさらに注意点があります。String型の変数で参照される文字列はその内容を変更することができません。といっても代入ができないという意味ではありません。以下のコードを見てください（LIST<span>3</span>-<span>15</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>3</span>-<span>15</span>　別の文字列を代入する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim ClientName As String = "春日由貴"</code></pre>
<pre lang="en"><code>ClientName = "松岡歩"</code></pre></div>
</div>
<p><br /></p>
<p>　この場合、元の文字列が「春日由貴」から「松岡歩」に変更されたわけではなく、元の「春日由貴」という文字列が破棄された後、新しい「松岡歩」という文字列が別に作成され、その参照がClientNameに代入されるのです（図<span>3</span>-<span>13</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00277.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　さらに、以下のコードを見てください（LIST<span>3</span>-<span>16</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>3</span>-<span>16</span>　参照を代入した後、別の文字列を代入する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim ClientName As String = "春日由貴"　　　●─── ①</code></pre>
<pre lang="en"><code>Dim OwnerName As String</code></pre>
<pre lang="en"><code>OwnerName = ClientName　　　●───②</code></pre>
<pre lang="en"><code>ClientName = "松岡歩"　　　●───③</code></pre>
<pre lang="en"><code>Debug.WriteLine(OwnerName)</code></pre></div>
</div>
<p><br /></p>
<p>　このコードで出力ウィンドウに表示されるOwnerNameはどちらの名前でしょう。少し考えてみてください。「春日由貴」でしょうか「松岡歩」でしょうか。答えは「春日由貴」です。図<span>3</span>-<span>14</span>でしくみを確認してみましょう。</p>
<p>　OwnerNameとClientNameが同じ文字列を参照しているので、ClientNameに文字列（松岡歩）を代入すると、OwnerNameも新しい文字列になると考えてしまいそうです。図<span>3</span>-<span>14</span>の左側がそれを表したものですが、実際にはこうはなりません。文字列を代入すると、これまでの文字列とは別の場所に、新たに記憶されるので、右側のようになります。OwnerNameは元の文字列を参照したままですが、ClientNameは新しく作成された文字列を参照するようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00146.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このことからも、String型の変数に文字列を代入すると、これまでの文字列が置き換えられるのではなく、新しい文字列が作られ、その参照が変数に代入されるということが分かります。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>StringBuilderクラスの場合</b></p>
</b></div>
<div>
<p>　String型の変数と似たものにStringBuilderクラスがあります。StringBuilderクラスのオブジェクトの場合、文字列の内容を直接変更することができます。したがって、StringBuilderクラスを使った場合は図<span>3</span>-<span>14</span>の左側のような動作になります。なお、クラスとオブジェクトについてはChapter<span>8</span>で詳しく解説します。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<p>　いかがでしょう。かなり込み入った話になりましたが、この段階では十分に理解できなくても心配には及びません。実は、この話は、経験のあるプログラマーでも、完全に理解するには時間がかかる話です。しかし、必ず「ああ、そういうことだったのか」と腑に落ちる日が来るので、あまり気にせず少しずつ慣れていくようにしましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-117">
<div><b>
<p><b>■さまざまな演算</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> CalcTest</p>
</div>
<hr />
<p>　代入以外の演算も見ていきましょう。まずは、よく使われる四則演算と文字列連結の例から見てみます。すでに足し算（加算）のための「+」演算子は出てきています。引き算（減算）には「-」演算子を、掛け算（乗算）には「*」演算子を、割り算（除算）には「/」演算子を使います。またべき乗には「^」演算子を使います。文字列の連結には「&amp;」演算子を使います（LIST<span>3</span>-<span>17</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>3</span>-<span>17</span>　さまざまな演算の例</p>
</div>
<div>
<div>
<pre lang="en"><code>（加算の例）</code></pre>
<pre lang="en"><code>GrandTotal = SubTotal1 +SubTotal2　　　●───SubTotal1とSubTotal2を加算した値をGrandTotalに代入</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>（乗算の例）</code></pre>
<pre lang="en"><code>Kakaku = Teika * 1.05　　　●───Teikaに1.05を掛けた値をKakakuに代入</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>（べき乗の例）</code></pre>
<pre lang="en"><code>apY = apX ^ 2 + 1　　　●───apXを2乗した値に1を加えた値をapYに代入</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>（文字列連結の例）</code></pre>
<pre lang="en"><code>FullName = "日向" &amp; "とも子"　　　●───"日向"と"とも子"を連結した文字列をFullNameに代入</code></pre></div>
</div>
<p><br /></p>
<div><b>
<p><b>■乗算・除算が優先</b></p>
</b></div>
<p>　四則演算のための演算子は、数学の式と同じように乗算や除算が加算、減算よりも優先されます（図<span>3</span>-<span>15</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00199.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　したがって、</p>
<div>
<pre lang="en"><code>z = 1 + 2 * 3</code></pre></div>
<p>なら、zには<span>7</span>が代入されます。</p>
<p><br /></p>
<div><b>
<p><b>■ ()が優先</b></p>
</b></div>
<p>　数学の式と同じように()で囲めば、その中の式が先に計算されます（図<span>3</span>-<span>16</span>）。</p>
<p><br /></p>
<p><img src="images/00256.jpeg" alt="" /></p>
<p><br /></p>
<p><br /></p>
<p>　したがって、</p>
<div>
<pre lang="en"><code>z = (1 + 2) * 3</code></pre></div>
<p>なら、zには<span>9</span>が代入されます。</p>
<p><br /></p>
<div><b>
<p><b>■べき乗は乗算・除算よりも優先</b></p>
</b></div>
<p>　べき乗は乗算や除算よりも優先されます（図<span>3</span>-<span>17</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00117.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　したがって、</p>
<div>
<pre lang="en"><code>w = 2 * 3 ^ 2</code></pre></div>
<p>なら、wには<span>18</span>が代入されます。なお、<span>2</span>*<span>3</span>を先に計算したいときには、()で囲んで</p>
<div>
<pre lang="en"><code>w = (2 * 3) ^ 2</code></pre></div>
<p>とするといいでしょう。この場合は<span>6</span>^<span>2</span>つまり<span>36</span>がwに代入されます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-118">
<div><b>
<p><b>■演算子の優先順位</b></p>
</b></div>
</div>
<hr />
<p>　よく使われる演算子には表<span>3</span>-<span>5</span>のようなものがあります。<span>1</span>つのステートメントに複数の演算子がある場合、<span><b>優先順位</b></span>の高いものから先に演算が行われます。優先順位が同じである場合は左から右へと演算が行われます。</p>
<p><br /></p>
<div id="calibre_link-323">
<p><img src="images/00349.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このほかにもさまざまな演算子がありますが、ほぼ数学での計算の方法と同じです。ただ、少し見慣れないのは表の下の方にある<span><b>比較演算子</b></span>や<span><b>論理演算子</b></span>でしょう。比較演算子では、大小関係が成り立てばTrue、成り立たなければFalseとなります。表<span>3</span>-<span>5</span>の例として示した</p>
<div>
<pre lang="en"><code>Flag = a &lt;= 10</code></pre></div>
<p>であれば、aが<span>10</span>以下ならTrueとなり、そうでなければFalseとなります。そのいずれかの値がFlagに代入されます。この式の=は比較演算子ではなく、代入演算子です。ただし、この式がIfステートメントなどの条件として書かれている場合は、＝は「等しい」という意味の比較演算子になります。詳細についてはChapter<span>4</span>で改めて説明します。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>浮動小数点数の比較には要注意</b></p>
<div><b>
<p><b><img src="images/00143.jpeg" alt="" /><b></b> CompareTest</b></p>
</b></div>
</b></div>
<p><br /></p>
<div>
<p>　浮動小数点数はあくまで近似値なので、比較演算子を使って比較すると、日常の感覚とは異なる結果になることがあります。例えば、<span>0</span>.<span>1</span>*<span>3</span>と<span>0</span>.<span>3</span>は等しくなりません。<span>0</span>.<span>1</span>は浮動小数点数では<span>0</span>.<span>1</span>よりわずかに大きな値になっており、<span>0</span>.<span>3</span>は<span>0</span>.<span>3</span>よりわずかに小さい値になっているからです。このような問題を回避するためには、誤差が許容できる範囲を決めておき、四捨五入によって微小な差を無視するようにします。例えば、Math.Roundメソッドを使って小数点以下第<span>2</span>位までを求めるようにすれば期待した結果が得られます。</p>
</div>
<div>
<pre lang="en"><code>    Debug.WriteLine(0.1 * 3 = 0.3)　　　●───Falseと表示される</code></pre>
<pre lang="en"><code>    Debug.WriteLine(Math.Round(0.1 * 3, 2) = Math.Round(0.3, 2))　　　●───Trueと表示される</code></pre></div>
</div>
<p><br /></p>
<p>　論理演算子のANDは、両方がTrueのときTrueとなり、ORはどちらか一方がTrueのときにTrueとなります。NOTはTrueとFalseを反転させます。したがって、例として示した</p>
<div>
<pre lang="en"><code>Flag = (a&gt;10) AND (b&gt;10)</code></pre></div>
<p>では、a&gt;<span>10</span>が成り立ち、かつ、b&gt;<span>10</span>が成り立っているときに、FlagにTrueが代入されます。どちらか<span>1</span>つでも成り立たないときにはFlagにはFalseが代入されます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-119">
<div><b>
<p><b>■演算の精度</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> DivideTest</p>
</div>
<hr />
<p>　Visual Basicでは、できるだけ精度が落ちないように演算が行われます。例えば、整数と整数を加算すると結果は整数となりますが、整数と倍精度浮動小数点数を加算すると、結果は倍精度浮動小数点数になります。ただし、整数を整数で割ると、倍精度浮動小数点数として結果が求められることに注意してください。整数同士の演算でも、例えば<span>3</span>/<span>4</span>のような演算をする場合、結果が小数になることがあるからです。CやJavaといったほかのプログラミング言語では、整数同士の演算は整数で実行され、小数点以下が切り捨てられるので、経験のある人には違和感があるかもしれませんが、注意が必要です。LIST<span>3</span>-<span>18</span>の例を見てください。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>3</span>-<span>18</span>　整数同士の除算で注意すべき点</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim x As Double</code></pre>
<pre lang="en"><code>x = 3<i><i> 4　　　●───3</i></i>4の結果は0.75。0.75がxに代入される</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>Dim x As Integer</code></pre>
<pre lang="en"><code>x = 3<i><i> 4　　　●───3</i></i>4の結果は0.75。ただし、xはInteger型なので、0.75の小数点以下が銀行型丸めにより四捨五入され、1がxに代入される</code></pre></div>
</div>
<p><br /></p>
<p>　ただし、Option StrictがOnの場合はLIST<span>3</span>-<span>18</span>の下の例はエラーとなります。その場合はx=CInt(<span>3</span>/<span>4</span>)とします。なお、「¥」演算子を使って割り算をすると小数点以下が切り下げられ、結果が整数で求められます。この例も見ておきましょう（LIST<span>3</span>-<span>19</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>3</span>-<span>19</span>　除算の結果を整数で求める「¥」演算子を使う</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim x As Integer</code></pre>
<pre lang="en"><code>x = 3 ¥ 4　　　●───3¥4の結果は0.75の小数点以下を切り下げた0となる。0がxに代入さる</code></pre></div>
</div>
<p><br /></p>
<p>　Modという演算子も比較的よく使います。これは余りを求める演算子です。例えば、<span>7</span>を<span>3</span>で割ると、<span>2</span>余り<span>1</span>です。したがって、Mod演算子を使って余りを求めると結果は<span>1</span>となります（LIST<span>3</span>-<span>20</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>3</span>-<span>20</span>　Mod演算子を使って剰余を求める</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim w As Integer</code></pre>
<pre lang="en"><code>w = 7 Mod 3　　　●───7を3で割った余りは1。1がwに代入される</code></pre></div>
</div>
<p><br /></p>
<p>　演算子の一覧表にはまだまだ見慣れないものがありますが、ここでは基本的なものだけにとどめ、プログラミングの学習を進めていきながら必要に応じて覚えていくこととしましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-120">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）　代入とはそれまでの変数に入っていた値の代わりに新しい値を入れることである</p>
</div>
<div>
<p>（  ）　代入時には自動的にデータ型が変換されるので、Integer型の変数にはどんな文字列でも代入できる</p>
</div>
<div>
<p>（  ）　整数同士の演算は必ず整数の結果が得られる</p>
</div>
<div>
<p>（  ）　優先順位の低い演算を先に実行したいときには()で囲むとよい</p>
</div>
<div>
<p>（  ）　String型の変数に文字列を代入すると、文字列そのものが変数に代入される</p>
</div>
<p><br /></p>
<div>
<p><span><b><span><b>2</b></span>.</b></span>　次の演算を実行したとき、変数xにはどのような値が入るでしょうか。Option StrictはOffであるものとします。</p>
</div>
<p><br /></p>
<div>
<p>（<span>1</span>）　Dim x As Integer</p>
</div>
<div>
<p>　x =<span>1</span> +<span>2</span> *<span>3</span></p>
</div>
<div>
<p>（<span>2</span>）　Dim x As Integer</p>
</div>
<div>
<p>　x =<span>3</span>.<span>14</span> *<span>3</span> ^<span>2</span></p>
</div>
<div>
<p>（<span>3</span>）　Dim x As Double</p>
</div>
<div>
<p>　x =<span>10</span> /<span>4</span></p>
</div>
<div>
<p>（<span>4</span>）　Dim x As String</p>
</div>
<div>
<p>　x = "123" &amp; "456"</p>
</div>
<div>
<p>（<span>5</span>）　Dim x As Boolean</p>
</div>
<div>
<p>　x = (<span>1</span>&gt;<span>2</span>)</p>
</div>
<p><br /></p>
<div>
<p><span><b><span><b>3</b></span>.</b></span>　以下の文章で示された変数の宣言と演算を行うコードを書いてください。</p>
</div>
<p><br /></p>
<div>
<p>（<span>1</span>）整数型の変数WeekNumberを宣言し、初期値として<span>0</span>を代入する</p>
</div>
<div>
<p>（<span>2</span>）変数WeekNumberに変数CurrentDayを<span>7</span>で割った値を代入する</p>
</div>
<div>
<p>（<span>3</span>）変数StartOffsetの値に CurrentDayを<span>7</span>で割った余りを加算して、変数DayOfWeekに代入する</p>
</div>
</div>
</div>
<div id="calibre_link-11">
<div>
<div id="calibre_link-121">
<div><b>
<p><b>　<span><b>3</b></span>.<span><b>4</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
</div>
<p><br /></p>
<p>　この章では変数や演算などについて学びました。ここではそれらを利用したプログラムを作ります。これまでに学んだ知識はどれも重要なものばかりですが、まだ断片的な知識でしかありません。そこで、<span>1</span>つのプログラム全体を作っていく中で、それらの知識がどのように使われるかを実践的に見ていこうというわけです。作成するプログラムは時間の単位を変換するプログラムです。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-122">
<div><b>
<p><b>■時間を変換するプログラム</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> ConvertTime</p>
</div>
<hr />
<p>　私たちが時間を数えるときには<span>4</span>時間<span>30</span>分のように「時」と「分」を使うのが普通です。しかし、時給を計算するときには、それを<span>4</span>.<span>5</span>時間のように小数で表すほうが便利です。例えば時給が950円なら、950<span>×</span><span>4</span>.<span>5</span>という掛け算をするだけで給与が求められます。そこで、時と分を使って表された時間を小数に変換して表示するようなプログラムを作ってみたいと思います。どのようなプログラムになるか、フォームのイメージをつかんでおきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00227.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　見てのとおり、時間を換算するだけのシンプルなプログラムです。表示されている内容にも謎めいたものは何もありません。では、さっそくフォームのデザインから取りかかりましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-123">
<div><b>
<p><b>■フォームのデザイン</b></p>
</b></div>
</div>
<hr />
<p>　プログラムの作成を始めたばかりなので、不慣れな人も多いでしょう。そこで、これまでのおさらいを兼ねて、新しいプロジェクトを作成するところから始めてみましょう。Visual Studioを起動し、画面<span>3</span>-<span>8</span>の手順で新しいプロジェクトを作成し、プロジェクト名を入力しましょう。プロジェクト名はConvertTimeとします。</p>
<p><br /></p>
<div>
<p><img src="images/00318.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　メニューから［ファイル（F）］−［新規作成（N）］－［プロジェクト（P）...］を選択する</p>
</div>
<div>
<p>②　［新しいプロジェクト］ダイアログボックスが表示される</p>
</div>
<div>
<p>❸　左側のリストで［インストール済み］－［テンプレート］－［Visual Basic］－［Windows］の順に階層を開く</p>
</div>
<div>
<p>❹　［Windowsフォームアプリケーション］をクリックする</p>
</div>
<div>
<p>❺　プロジェクト名を入力する。ここでは「ConvertTime」とする</p>
</div>
<div>
<p>❻　［OK］ボタンをクリックする</p>
</div>
<p><br /></p>
<p>　プロジェクト名を入力し、［OK］ボタンをクリックすると何もコントロールが配置されていないフォームが表示されます。そのフォーム上にコントロールを配置していきます。このプログラムで利用するのはLabelコントロールが<span>4</span>つ、TextBoxコントロールが<span>2</span>つ、Buttonコントロールが<span>2</span>つです。ツールボックスから必要なコントロールを選択し、フォームをクリックしてコントロールを配置していってください。画面<span>3</span>-<span>9</span>に示した画面を参考にしてコントロールの位置やサイズを整え、表<span>3</span>-<span>6</span>の内容に従って、利用するコントロールのプロパティを設定してください。</p>
<p><br /></p>
<div>
<p><img src="images/00321.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00326.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　フォームのAcceptButtonプロパティやCancelButtonプロパティを指定するときにはフォーム上に配置されたボタンの名前が選択できます。したがって、Buttonコントロールを配置してからこれらのプロパティを設定してください。なお、ButtonコントロールのNameプロパティを変更すると、AcceptButtonプロパティやCancelButtonプロパティに設定されている名前も自動的に変わります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-124">
<div><b>
<p><b>■タブオーダーの設定</b></p>
</b></div>
</div>
<hr />
<p>　フォームのデザインができたら、すぐにコードの記述に移りたいところですが、その前にこのプログラムを使いやすくするための設定を<span>1</span>つ付け加えておきましょう。それはタブオーダーの設定です。プログラムの実行時に<img src="images/00096.jpeg" alt="" />キーを押すと、入力できるコントロールが順に変わりますが、この順序のことを<span><b>タブオーダー</b></span>といいます。また、そのとき入力できるコントロールのことをフォーカスのあるコントロールといいます。</p>
<p>　設定方法は簡単です。Visual Studioのメニューから［表示（V）］－［タブオーダー（B）］を選択し、フォーム上のコントロールをタブオーダーの順にクリックしていくだけです。最初はコントロールを配置した順に番号が表示されていますが、コントロールをクリックすると、その順にタブオーダーの番号が<span>0</span>、<span>1</span>、<span>2</span>......と変わります。左から右、上から下へと自然な操作ができるような順序でコントロールをクリックし、タブオーダーを設定しておいてください（画面<span>3</span>-<span>10</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00073.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［表示（V）］−［タブオーダー（B）］を選択する</p>
</div>
<div>
<p>②　タブオーダーの番号が表示される</p>
</div>
<div>
<p>❸　タブオーダーを設定したい順にコントロールをクリックしていく</p>
</div>
<div>
<p>❹　eキーを押すとタブオーダーの設定が終わり、元の画面に戻る</p>
</div>
<p><br /></p>
<p>　ここでは、Labelコントロールにもタブオーダーを設定していることに注意してください。Labelコントロールは入力には使われませんが、<span><b>アクセスキー</b></span>を押すと、その次にタブオーダーのあるコントロールに<span><b>フォーカス</b></span>（入力や選択などの操作ができる状態）が移るようになっているからです。例えば、<img src="images/00018.jpeg" alt="" />+<span>H</span>キーを押すと、［時間（H）:］の次にタブオーダーのあるtxtHourコントロールにフォーカスが移ります。このように、タブオーダーを適切に設定しておけば、マウスだけでなくキーボードで操作するときにもプログラムが使いやすくなります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-125">
<div><b>
<p><b>■イベントハンドラーの記述</b></p>
</b></div>
</div>
<hr />
<p>　準備が整ったので、コードを書いていきましょう。このプログラムでは［変換（V）］ボタンをクリックしたときに、時間の変換を実行します。したがって［変換（V）］ボタンのClickイベントハンドラーをまず作成します。イベントハンドラーの作成方法もChapter<span>2</span>で見ましたが、おさらいを兼ねて画面<span>3</span>-<span>11</span>で手順を見ておきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00299.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［変換（V）］ボタンをクリックして選択する</p>
</div>
<div>
<p>❷　プロパティウィンドウの［イベント］ボタン（<img src="images/000174.gif" alt="" />）をクリックする</p>
</div>
<div>
<p>❸　［Click］の欄にイベントハンドラーの名前を入力する</p>
</div>
<p><br /></p>
<p>　イベントハンドラーはDoConvertという名前にします。画面<span>3</span>-<span>11</span>の❸でDoConvertと入力して<img src="images/00137.jpeg" alt="" />キーを押すと、以下のコードがあらかじめ入力されたコードウィンドウが表示されます。</p>
<div>
<pre lang="en"><code>Private Sub DoConvert(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles btnConvert.Click</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
<p>　このSub ... End Subの間にコードを書いていきましょう。</p>
<p>　コードを書くときにはまず変数の宣言から始めます。<span>3</span>.<span>2</span>節でも説明したように、<span><b>結果として欲しいものを最初に変数として表します</b></span>。このプログラムでは小数で表された時間を求めたいので、以下のようにDouble型の変数を宣言すればいいでしょう。</p>
<div>
<pre lang="en"><code>Dim WorkingTime As Double	' 小数で表された時間</code></pre></div>
<p>　<span><b>次に宣言するのは、結果を求めるために利用できる変数です</b></span>。このプログラムでは時と分を利用します。これらは整数型で構いません。<span>3</span>.<span>2</span>節では変数を<span>1</span>つずつ宣言していましたが、以下のように「,」（カンマ）で区切れば一度に宣言できます。</p>
<div>
<pre lang="en"><code>Dim WorkingHour, WorkingMinute As Integer</code></pre></div>
<p>　この後は、TextBoxコントロールに入力されたデータを変数に入れ、計算を実行した後、計算の結果をLabelコントロールに表示します。<span>3</span>.<span>2</span>節では変数に注目して全体像を見ましたが、ここでは処理に注目して見ておきましょう（図<span>3</span>-<span>18</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00041.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p id="calibre_link-324">　本来なら、入力されたデータが数値として正しいものであるかといったチェックが必要なのですが、とりあえず正しく入力されたものとして書いてみます。TextBoxコントロールに入力されたデータはTextプロパティで参照できます。TextプロパティはString型なので、CInt関数を使ってInteger型に変換してからWorkingHourやWorkingMinuteに代入しましょう。</p>
<div>
<pre lang="en"><code>WorkingHour = CInt(txtHour.Text)</code></pre>
<pre lang="en"><code>　　　●───図の①</code></pre>
<pre lang="en"><code>WorkingMinute = CInt(txtMinute.Text)<br /></code></pre></div>
<p>　txtHourやtxtMinuteに数値と見なせる文字列が入力されていれば、WorkingHourやWorkingMinuteに整数の時間や分が代入されます。</p>
<p>　続いて、WorkingHourとWorkingMinuteを使って小数で表した時間を計算します。<span>60</span>分が<span>1</span>時間なので、分を<span>60</span>で割れば小数部分が求められます。例えば、<span>30</span>分は<span>30</span>/<span>60</span>=<span>0</span>.<span>5</span>時間です。したがって、以下のようなステートメントが書けます。</p>
<div>
<pre lang="en"><code>WorkingTime = WorkingHour + WorkingMinute / 60　　　●───図の②</code></pre></div>
<p>　最後に、求められた時間を表示します。これはWorkingTimeの値をlblTimeコントロールのTextプロパティに代入するだけです。WorkingTimeはDouble型の数値なので、ToStringメソッドを使って文字列に変換し、lblTime.Textに代入します。</p>
<div>
<pre lang="en"><code>lblTime.Text = WorkingTime.ToString()　　　●───図の③</code></pre></div>
<p>　これで、小数で表された時間がフォーム上のlblTimeコントロールに表示されるようになりました。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>データ型を自動的に変換したいときは</b></p>
</b></div>
<div>
<p>　Option StrictがOffであれば、データ型が自動的に変換されるので、以下に示す左側のコードは右側のように書くこともできます。</p>
</div>
<div>
<pre lang="en"><code>WorkingHour = CInt(txtHour.Text)     ←→ WorkingHour = txtHour.Text</code></pre>
<pre lang="en"><code>lblTime.Text = WorkingTime.ToString()←→ lblTime.Text = WorkingTime</code></pre></div>
</div>
<p><br /></p>
<p>　以上でコードの主要な部分はできあがりです。プログラムを終了させるためのイベントハンドラー（btnExitのClickイベントハンドラー）と合わせて、全体を示しておきましょう（LIST<span>3</span>-<span>21</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>3</span>-<span>21</span>　時間を変換するプログラムのコード全体</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub DoConvert(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles btnConvert.Click</code></pre>
<pre lang="en"><code>        Dim WorkingTime As Double</code></pre>
<pre lang="en"><code>        Dim WorkingHour, WorkingMinute As Integer</code></pre>
<pre lang="en"><code>        ' 入力された時間と分を数値に変換する</code></pre>
<pre lang="en"><code>        WorkingHour = CInt(txtHour.Text)</code></pre>
<pre lang="en"><code>        WorkingMinute = CInt(txtMinute.Text)</code></pre>
<pre lang="en"><code>        ' 時間の計算をする</code></pre>
<pre lang="en"><code>        WorkingTime = WorkingHour + WorkingMinute / 60</code></pre>
<pre lang="en"><code>        ' 時間を表示する</code></pre>
<pre lang="en"><code>        lblTime.Text = WorkingTime.ToString()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　プログラミングに少し慣れてくると、変数を一切使わずにこのプログラムが作成できることに気付く人もいるでしょう。実際、DoConvertプロシージャは以下の<span>1</span>行だけでも同じように動作します。</p>
<div>
<pre lang="en"><code>lblTime.Text = (CInt(txtHour.Text) + CInt(txtMinute.Text) / ⇒</code></pre>
<pre lang="en"><code>60).ToString()</code></pre></div>
<p>　しかし、時間や分の計算がより複雑になってくると、これだけではプログラムが分かりにくくなり、かえって冗長になることもあります。やはり、何を結果として求めたいのか、そのために何が使えるのかをきちんと洗い出して、変数として宣言しておくほうが確実です。</p>
<p>　また、このプログラムでは入力された文字列が数値と見なせるかどうかのチェックをしていません。したがって、［時（H）:］や［分（M）:］に数値と見なせない文字列を入れて［変換（V）］ボタンをクリックするとエラーになってしまいます。対処法については<span>4</span>.<span>2</span>節で説明しますが、このような問題に対処するためにも、変数を用意しておく必要があります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-126">
<div><b>
<p><b>■プログラムを実行する</b></p>
</b></div>
</div>
<hr />
<p>　コードがすべて入力できたら、［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックして、プログラムを実行します。画面<span>3</span>-<span>12</span>のような画面が表示され、時間の変換ができれば完成です。</p>
<p><br /></p>
<div>
<p><img src="images/00072.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　時を入力する</p>
</div>
<div>
<p>❷　分を入力する</p>
</div>
<div>
<p>❸　［変換（V）］ボタンをクリッ クする</p>
</div>
<div>
<p>④　時間が小数で表示される</p>
</div>
<p><br /></p>
<p>　入力した文字列が数値に変換できない場合は［変換（V）］ボタンをクリックしたときにエラーとなり「＜エラーの種類＞はハンドルされませんでした。」といったメッセージが表示されます（画面<span>3</span>-<span>13</span>）。その場合は、［中断（B）］ボタンをクリックしてダイアログボックスを閉じ、ツールバーの［デバッグの停止］ボタン（<img src="images/000251.gif" alt="" />）をクリックしてプログラムを終了させてください。</p>
<p><br /></p>
<div>
<p><img src="images/00145.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
</div>
</div>
<div id="calibre_link-42">
<div>
<div><b>
<p><b>Chapter<span><b>3</b></span>のまとめ</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　Visual Basicのコードで、決まった働きのある単語はキーワードと呼ばれます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　コードに含まれる「'」（単一引用符）から行末まではコメントと見なされ、プログラムの実行には影響を与えません</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　変数には値型の変数と参照型の変数があります。値型では、データが変数にそのまま入れられます。参照型では、データがどこにあるかという情報が変数に入れられます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　変数を利用するためには、あらかじめDimステートメントを使って、変数を宣言しておく必要があります</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　変数にはスコープがあり、どの範囲で使えるかが決まっています</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　変数にはアクセスレベルがあります。Dimの代わりにPrivateを指定するとモジュールの中でだけ使う変数になり、Publicを指定するとモジュールの外からでも使える変数になります</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　ある決まった値をそのまま表したものをリテラルと呼びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　定数を利用すると、リテラルに名前を付けることができます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　代入や四則演算、文字列の連結など、広い意味での計算のことを演算と呼び、演算に使われる記号や単語のことを演算子と呼びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　演算子には優先順位があります。式を()で囲むとその中の演算を優先させることができます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　数値と見なせる文字列や浮動小数点数を整数に変換するにはCInt関数を使います</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　数値を文字列に変換するにはToStringメソッドを使います</b></p>
</b></div>
</div>
</div>
<div id="calibre_link-309">
<div>
<div id="calibre_link-127">
<div><b>
<p><b>練習問題</b></p>
</b></div>
</div>
<p><br /></p>
<div>
<p><span><b>［A］</b></span>サンプルプログラムを拡張し、支給額を計算できるプログラムを作成してください。プロジェクト名はCalcPaymentとし、時給はTextBoxコントロールに入力するものとします。実行結果が以下の画面のようになるプログラムとしてください。支給額は「時給<span>×</span>小数で表した時間」で求められます。なお、支給額は小数点以下を切り上げるものとします。</p>
</div>
<div>
<p><img src="images/00108.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><span><b>［B］</b></span>新しいプロジェクトを作成し、指定された値を黄金比に分割するプログラムを作成してみてください。黄金比とは、もっとも美しいとされる比率で、<span><img src="images/00254.jpeg" alt="" /></span>で表されます。プロジェクト名などは自由につけてください。</p>
<div>
<p><img src="images/00149.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　　平方根（ルート）の値を求めるには、Math.Sqrtメソッドが使えます。例えば、√<span>5</span>であれば、Math.Sqrt(<span>5</span>)で求められます。</p>
<p>　　実行結果は以下の図のようになります。</p>
<div>
<p><img src="images/00346.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
</div>
</div>
<div id="calibre_link-342">
<div>
<div id="calibre_link-128">
<div><b>
<p><b>Chapter<span><b>4</b></span></b></p>
</b></div>
</div>
<p><br /></p>
<div><b>
<p><b>条件によって処理を変える</b></p>
</b></div>
<hr />
<div>
<p>日常生活で人がさまざまな判断をするのと同じように、プログラムでも「〜ならば〜する」という判断ができます。コンピューターは融通が利かないとよくいわれますが、何が何でも決まった処理しかしないというわけではありません。条件分岐を利用すれば、条件によって実行するステートメントを変えることができるのです。さまざまな状況に対応できる使いやすいプログラムを作るためには条件分岐が欠かせません。</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><span><b>4</b></span>.<span><b>1</b></span>　条件分岐の考え方</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>4</b></span>.<span><b>2</b></span>　Ifステートメントを利用する</b></p>
</b></div>
<div>
<p>条件が満たされたときに処理を実行するIf ... Then ...ステートメント／条件が満たされないときの処理も書くIf ... Then ... Elseステートメント／より複雑な条件分岐にも対応するIf ... Then ... Else ... End Ifステートメント／複数の条件を組み合わせる／AndAlso演算子とOrElse演算子</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>4</b></span>.<span><b>3</b></span>　Ifステートメントによる多分岐</b></p>
</b></div>
<div>
<p>Ifステートメントを入れ子にする／ElseIfを利用した多分岐</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>4</b></span>.<span><b>4</b></span>　Select Caseステートメントによる多分岐</b></p>
</b></div>
<div>
<p>多分岐を簡潔に書く</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>4</b></span>.<span><b>5</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
<div>
<p>割引価格を計算するプログラム／フォームのデザイン／RadioButtonコントロールとコンテナー／イベントハンドラーの記述／プログラムを実行する</p>
</div>
</div>
</div>
<div id="calibre_link-17">
<div>
<div><b>
<p><b>これから学ぶこと</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　Ifステートメントの使い方を学び、実行するステートメントを条件によって変えられるようにします</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Ifステートメントを組み合わせて使う方法を学び、さまざまな条件によって異なるステートメントを実行できるようにします</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Select ... Caseステートメントの使い方を学び、式の値によって異なるステートメントを実行できるようにします</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　この章で学んだことがらを利用してプログラムを作成します</b></p>
</b></div>
<p><br /></p>
<div>
<p><img src="images/00224.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>　この章では条件によって異なるステートメントを実行する方法を学び、判断のできるプログラムを作ります。例えば、学生であれば定価の<span>1</span>割引の価格を販売価格とし、株主であれば<span>1</span>割<span>5</span>分引の価格を販売価格とするというような、割引価格を求めるプログラムの作成を目標にします。</p>
</div>
</div>
</div>
<div id="calibre_link-54">
<div>
<div id="calibre_link-129">
<div><b>
<p><b>　<span><b>4</b></span>.<span><b>1</b></span>　条件分岐の考え方</b></p>
</b></div>
</div>
<p><br /></p>
<p>　私たちは日常生活の中で状況に合わせてさまざまな判断をしています。降水確率が<span>50</span>％以上であれば傘を持って出かける、財布の中に<span>1</span>,000円以上あれば喫茶店でコーヒーを飲む、距離が<span>1</span>キロ未満であればバスに乗らずに歩く......などなど枚挙にいとまがありません。</p>
<p>　日常生活で人がさまざまな判断をするのと同じように、プログラムでも条件によって異なるコードが実行できます。ただし、コンピューターには「雨が降りそうだったら傘を持って出かける」というようなあいまいな判断はできません。「雨が降りそう」だけでは明確な基準が示されていないからです。コンピューターは人間のように気を利かせたり、不十分な情報からでも適当に判断することができないので、「降水確率が<span>50</span>％以上か」のようにYESかNOで明確に答えられる条件を指定する必要があります。</p>
<p><br /></p>
<div>
<p><img src="images/00205.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　別の例でもう少し詳しく考えてみましょう。例えば、<span>3</span>,600円の商品があり、学生割引が適用できるものとします。割引率を<span>10</span>％とすると、学生であるか学生でないかによって、価格の計算方法を変える必要があります。学生であるか学生でないかはYESかNOで答えられるので、条件による計算方法の違いは以下のような考え方で書けばいいということになります。</p>
<div>
<pre lang="en"><code>もし身分が学生であれば</code></pre>
<pre lang="en"><code>　販売価格 = 標準価格 * 0.9</code></pre>
<pre lang="en"><code>そうでなければ</code></pre>
<pre lang="en"><code>　販売価格 = 標準価格</code></pre></div>
<p>　このように、日常の言葉を使ってプログラムの処理を表したものを<span><b>擬似コード</b></span>と呼ぶことがあります。実際には「もし」や「そうでなければ」の代わりに「If」や「Else」といった英単語を使って簡潔に書きます。</p>
<p>　また、処理の流れを視覚的に分かりやすくするために図<span>4</span>-<span>1</span>のような図で書くこともあります。このような図を<span><b>フローチャート</b></span>（流れ図）と呼びます。</p>
<p><br /></p>
<div>
<p><img src="images/00319.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　フローチャートでは、条件をひし形で表し、処理を長方形の箱で表します。処理の流れは線で示され、原則として上から下へ、左から右へと進みます。条件を示すひし形からは線が<span>2</span>本出ていることに注意してください。ここで処理が分岐します。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>擬似コードとフローチャート</b></p>
</b></div>
<div>
<p>　本書では、日常の言葉に近い書き方の擬似コードとフローチャートの両方を必要に応じて掲載し、処理の内容や流れが分かるようにします。</p>
</div>
</div>
<p><br /></p>
<p>　ところで、これまでは日常の言葉を使って、条件に指定できるのは「YESかNOで答えられること」と解説してきましたが、Visual Basicをはじめとするプログラミング言語では、True（真）かFalse（偽）かによって条件を判定します。Trueは条件として指定した式が成り立つこと、Falseは式が成り立たないことと考えるといいでしょう。したがって、厳密には「学生であれば」は「身分が学生であるということがTrueであれば」と考える必要があります。</p>
<p>　図<span>4</span>-<span>1</span>のフローチャートでは、条件がTrueの場合、処理の流れは下方向に進みます。条件がFalseの場合、処理の流れは右方向に進みます。したがって、身分が学生であるという条件が成り立つときには、標準価格の<span>10</span>％引の価格（つまり標準価格に<span>0</span>.<span>9</span>を掛けた値）が販売価格になります。しかし、身分が学生であるという条件が成り立たないときには標準価格がそのまま販売価格になるわけです。</p>
<p>　条件分岐の考え方についてはだいたい理解できたでしょうか。実際にはより複雑な条件判断が必要になることがありますが、次の節でコードの書き方を確認し、その中で分岐のさまざまなパターンについても見ていくこととしましょう。なお、先にプログラミングを体験してみたい人は<span>4</span>.<span>5</span>節の「プログラミングにチャレンジ」に取り組んでいただいても構いません。その後、じっくりと解説を読み進めていってください。また、これ以降の章も同じように読み進めていただいて構いません。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-130">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）　コンピューターは人間の直感にあたるような機能を持っているので、あいまいな状況でも適切に判断ができる</p>
</div>
<div>
<p>（  ）　条件によって異なる処理をすることは人間にのみ可能であって、コンピューターにはできない</p>
</div>
<div>
<p>（  ）　プログラムで条件分岐を行うには、YESかNO（TrueかFalse）が決められる明確な基準が必要である</p>
</div>
<div>
<p>（  ）　処理の流れを表すフローチャートで、条件分岐は長方形の箱で表される</p>
</div>
</div>
</div>
<div id="calibre_link-321">
<div>
<div id="calibre_link-131">
<div><b>
<p><b>　<span><b>4</b></span>.<span><b>2</b></span>　Ifステートメントを利用する</b></p>
</b></div>
</div>
<p><br /></p>
<p>　条件分岐を利用したプログラムを作成するには、どのような条件のときに何を実行するか、あらかじめ明確にしておく必要があります。そのうえで、Visual Basicの文法に従ってコードを書いていきます。簡単な例から少しずつ複雑なものへと進めていきます。急がず確実に理解を深めていってください。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-132">
<div><b>
<p><b>■条件が満たされたときに処理を実行するIf ... Then ... ステートメント</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />IfTest<span>1</span></p>
</div>
<hr />
<p>　簡単な例から始めます。まず、<span>65</span>歳以上の人は会費を<span>2</span>割引にするという例を考えてみましょう。割引率を求めるための処理を日本語の擬似コードで表すと以下のようになります。</p>
<div>
<pre lang="en"><code>もし年齢が65以上であれば　割引率に0.2を代入する</code></pre></div>
<p>　条件分岐はIfステートメントを使って書きます。「もし」にあたるキーワードが<span><b>If</b></span>で、「であれば」にあたるキーワードが<span><b>Then</b></span>です。年齢がAgeという変数に入っていて、割引率をDiscountRateという変数に入れるのであれば、以下のようにコードが書けます。</p>
<div>
<pre lang="en"><code>If Age &gt;= 65 Then DiscountRate = 0.2　　　●───Ageの値が65以上であれば、DiscountRateに0.2を代入する</code></pre></div>
<p>　条件はAge &gt;=<span>65</span>で、条件を満たしたときにはDiscountRate =<span>0</span>.<span>2</span>が実行されます。この程度であれば、コードを見るだけでだいたいの意味は想像できるでしょう。しかし、自分でコードを書くためには書き方や意味を正確に知っておく必要があります。図<span>4</span>-<span>2</span>で書き方を確認した後、ポイントを確認しておきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00049.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Ifの後には条件を表す式を書き、Thenの後にその条件が満たされたとき（式の値がTrueのとき）に実行するステートメントを書きます。条件が満たされないときには、何もせずに次のコードに進みます。<span><b>ステートメント</b></span>は、あまりなじみのない言葉かもしれませんが「文」といった意味です。</p>
<p>　この書き方では、Ifから始まるコードをすべて<span>1</span>行で書かなくてはならないことに注意してください。したがって、複雑なステートメントを書くのには、この書き方は向いていません。もう少し柔軟性のある書き方については後で説明します。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>コードスニペットを利用して自動的にコードを入力する</b></p>
</b></div>
<div>
<p>　「If条件」まで入力し<img src="images/00137.jpeg" alt="" />キーを押して改行すると、<span>コードスニペット</span>の働きにより自動的に「Then」と「End If」が入力され、<a href="#calibre_link-322"><u>P.130</u></a>の複数行形式のIfステートメントになります。</p>
</div>
</div>
<p><br /></p>
<p id="calibre_link-325">　Ifステートメントの意味についてもう少し考えてみましょう。図<span>4</span>-<span>2</span>では、Ifの後に条件を書くと記されていますが、正確にはTrue（真）かFalse（偽）の値が求められる式を書きます。条件を表すために使う比較演算子や論理演算子については、すでに<a href="#calibre_link-323"><u>P.108</u></a>の表<span>3</span>-<span>5</span>で触れていますが、数学の大小比較とほぼ同様の書き方です。例えば、「If Age &gt;=<span>65</span> Then」の正確な意味は「Ageが<span>65</span>以上であるという式がTrueであれば」ということになります。</p>
<p>　したがって、以下のような書き方もできます。</p>
<div>
<pre lang="en"><code>Dim ReverseFlag As Boolean</code></pre>
<pre lang="en"><code>        :</code></pre>
<pre lang="en"><code>If ReverseFlag Then xDirection = -1　　　●───ReverseFlagの値がTrueであればxDirectionに-1を代入する</code></pre></div>
<p><br /></p>
<p>　一見しただけでは条件が書かれていないように見えますが、ReverseFlagの値はTrueかFalseに決まるので、文法的に正しいステートメントです。なお、この例は、左右に移動する物体があって、状況に応じて移動方向が変わるような場合に利用できるコードです。ReverseFlagの値がTrueになると、移動方向を表す変数xDirectionの値が-<span>1</span>になるので、その値を移動量に掛けてやれば移動方向が反転するというわけです。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>条件に数値を指定すると？</b></p>
</b></div>
<div>
<p>　Visual Basicでは<span>0</span>がFalseと見なされ、<span>0</span>以外の数値はTrueと見なされます。したがって、あまり意味はありませんが、If<span>1</span> Then ...というステートメントを書くこともできます。その場合、式は常にTrueとなるので、Then以下が必ず実行されます。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-133">
<div><b>
<p><b>■条件が満たされないときの処理も書くIf ... Then ... Elseステートメント</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />IfTest<span>1</span></p>
</div>
<hr />
<p>　次に、条件が満たされないときにも何らかの処理を実行する例を見てみましょう。スマートフォンなどの料金プランの中には、一定の限度額を超えたら定額にするというものがあります。そのような場合、擬似コードは以下のようになります。</p>
<div>
<pre lang="en"><code>料金が限度額を超えたら、料金に限度額を代入する。そうでなければ加算された料金を代入する</code></pre></div>
<p>　「そうでなければ」にあたるキーワードは「Else」です。料金を表す変数をChargeとし、限度額をLIMITという定数とすれば、コードは以下のようになります。</p>
<div>
<pre lang="en"><code>Work = Charge + Count　　　●───これまでの料金に、新たに利用した金額を加えた値を作業用の変数Workに代入する</code></pre>
<pre lang="en"><code>If Work &gt; LIMIT Then Charge = LIMIT Else Charge = Work</code><code>　　　●───Workの値がLIMITより大きければ、ChargeにLIMITの値を代入する。そうでなければ、ChargeにWorkの値を代入する</code>
</pre></div>
<p><br /></p>
<p>　図<span>4</span>-<span>3</span>で書き方を確認しておきましょう。この書き方でもステートメントをすべて<span>1</span>行に書く必要があります。</p>
<p>　Else以下を省略すると、図<span>4</span>-<span>2</span>の書き方と同じになります。</p>
<p><br /></p>
<div>
<p><img src="images/00071.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>複数のステートメントを<span><b>1</b></span>行で書くには</b></p>
</b></div>
<div>
<p>　複数のステートメントを書きたい場合には、ステートメントを<span>1</span>行にまとめるための区切り記号「：」を使って以下の例のようにします。</p>
</div>
<div>
<pre lang="en"><code>If x &lt;= 0 Then x = 0: dirLeft = True Else x -= 1</code></pre></div>
<div>
<p>　普通は、次の項で説明する複数行の形式でIfステートメントを書いたほうが、コードが見やすくなりますが、短いステートメントの場合、複数行に書くよりも「：」を使って<span>1</span>行にまとめたほうが見やすくなることがあります。</p>
</div>
</div>
<p><br /></p>
<p>　ここで示したIfステートメントの例は、スマートフォンの料金のほか、ゲームなどで主人公が壁のところまで移動したらそれ以上動けないようにする処理など、ある値を増やしていっても一定の限界を超えないようにするような場合に活用できるパターンです。なお、このような場合、Ifステートメントを使わず、小さい値を求めるためのMath.Minメソッドを使って</p>
<div>
<pre lang="en"><code>Charge = Math.Min(LIMIT, Work)</code></pre></div>
<p>と書くこともできます。LIMITとWorkの小さい方が求められるので、Chargeの値はLIMITを超えることはありません。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-134">
<div><b>
<p><b>■より複雑な条件分岐にも対応するIf ... Then ... Else ... End Ifステートメント</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />IfTest2,ConvertTime2</p>
</div>
<hr />
<p id="calibre_link-322">　これまで見てきたIfステートメントの書き方では、条件が満たされたときや条件が満たされないときに実行できるステートメントは<span>1</span>つだけでした。しかし、実際にプログラムを作るときには、Ifの中で複数のステートメントを実行したいこともよくあります。そのような場合は、Ifの最後をEnd Ifで閉じ、Thenの範囲やElseの範囲を明確にします。これまで見てきた例を複数行の形式で書き直してみましょう（LIST<span>4</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>4</span>-<span>1</span>　複数行形式のIfステートメント</p>
</div>
<div>
<div>
<pre lang="en"><code>If Age &gt;= 65 Then</code></pre>
<pre lang="en"><code>    DiscountRate = 0.2	　　　●───Ageの値が65以上であれば、DiscountRateに0.2を代入する</code></pre>
<pre lang="en"><code>End If</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>Work = Charge + Count　　　●───これまでの料金に、新たに利用した金額を加えた値を作業用の変数Workに代入する</code></pre>
<pre lang="en"><code>If Work &gt; LIMIT Then</code></pre>
<pre lang="en"><code>    Charge = LIMIT　　　●───Chargeの値がLIMITより大きければ、ChargeにLIMITの値を代入する</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>    Charge = Work　　　●───そうでなければ、ChargeにWorkの値を代入する</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p>　処理内容は前項で見たものと同じで、Then以下のステートメントやElse以下のステートメントも<span>1</span>行しか書いていませんが、こちらのほうがずいぶんと見やすいはずです。ごく簡単なIfステートメントであれば前項の書き方でも構いませんが、一般にはこちらの書き方のほうがいいでしょう（図<span>4</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00296.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<p>　このように書くと、条件を満たしたときに実行されるステートメントの範囲と、条件を満たしていないときに実行されるステートメントの範囲がはっきりと区別できます。</p>
<p>　もちろん、「実行されるステートメント」の箇所には、複数のステートメントを書くことができます。そういった例も含めていくつかの実用的な例を見ておきましょう。まず、文字列の長さを調べる例です（LIST<span>4</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>4</span>-<span>2</span>　文字列の長さが<span>8</span>文字未満ならメッセージを表示する</p>
</div>
<div>
<div>
<pre lang="en"><code>If UserName.Length() &lt; 8 Then　　　●───UserNameという文字列の長さが8文字未満なら</code></pre>
<pre lang="en"><code>    MessageBox.Show("8文字以上入力してください")　　　●─── メッセージを表示する</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p>　この例では、UserNameはString型の変数とします。String型の変数では、長さを求めるためのLengthというメソッドが使えます。つまり、変数名.Length()と書くことにより、文字列の長さが求められます。</p>
<p>　では、別の例も見てみましょう。TextBoxコントロールに入力された文字列が整数に変換できなかったら、メッセージを表示し、もう一度そのTextBoxコントロールに入力できるようにする例です（LIST<span>4</span>-<span>3</span>）。この例は「分」が整数に変換できる文字列かどうかというチェックのみなので、実際に動くプログラムにするためには「時」のチェックも必要です。Chapter<span>3</span>のConvertTimeプロジェクトに、そういったチェックを付け加えたプロジェクトをConvertTime<span>2</span>という名前で用意しておきました。ぜひ、ダウンロードしてコードと動作を確認してみてください。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>4</span>-<span>3</span>　TextBoxコントロールに整数と見なせる数字が入力されていないときに再入力できるようにする</p>
</div>
<div>
<div>
<pre lang="en"><code>If Integer.TryParse(txtMinute.Text, WorkingMinute) = False Then</code></pre>
<pre lang="en"><code>    MessageBox.Show("数値が入力されていません")　　　●─── メッセージを表示する</code></pre>
<pre lang="en"><code>    txtMinute.Focus()　　　●───txtMinuteにフォーカスを移動する</code></pre>
<pre lang="en"><code>    txtMinute.SelectAll()　　　●───txtMinuteのテキスト全体を選択する</code></pre>
<pre lang="en"><code>    Exit Sub　　　●───プロシージャを抜ける</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>    WorkingTime = WorkingHour + WorkingMinute / 60</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p>　Integer.TryParseは、文字列を整数に変換するためのメソッドです。CInt関数と似ていますが、Integer.TryParseメソッドでは小数を表す文字列を指定すると変換ができません。CInt関数では小数を表す文字列を指定すると、その小数を四捨五入した整数が求められます（<a href="#calibre_link-56"><u>P.102</u></a>、<a href="#calibre_link-324"><u>P.116</u></a>参照）。また、Integer.TryParseメソッドでは文字列が整数に変換できない場合には、Falseが結果として返されますが、CInt関数では例外が発生します（例外についてはChapter<span>9</span>を参照）。</p>
<p>　Integer.TryParseメソッドの書き方は次のとおりです（図<span>4</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00303.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　文字列が整数と解釈できる場合には、整数型の変数に変換結果が入れられます。正しく整数に変換できた場合にはこのメソッドの結果はTrueとなり、整数に変換できない場合には、結果がFalseとなります（図<span>4</span>-<span>6</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00037.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　関数やメソッドの結果が何らかの値になることを、関数やメソッドが値を<span><b>返す</b></span>といいます。返された値は変数に代入したり、Ifステートメントの条件判断に使うことができます。</p>
<p>　TextBoxコントロールのFocusメソッドは、そのコントロールを入力できる状態にするためのメソッドです。また、SelectAllメソッドは、TextBoxコントロールに入力されているすべての文字列を選択された状態にするメソッドです。なお、コントロールが入力できる状態にあることを<span><b>フォーカスがある</b></span>といい、入力できるコントロールを変更することを<span><b>フォーカスを移動する</b></span>といいます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-135">
<div><b>
<p><b>■複数の条件を組み合わせる</b></p>
</b></div>
</div>
<hr />
<p>　これまでのIfステートメントには条件が<span>1</span>つしかありませんでしたが、複数の条件について調べなくてはならない場合もあります。例えば、コレステロール値が110以上250以下であれば、標準の範囲であるものとするとか、学科試験の成績が<span>90</span>点以上、かつ、実技試験の成績が<span>80</span>点以上で合格とするとか、成績の評価が「S」または「A」であれば給付金の対象となる、などさまざまな例があるはずです。And演算子やOr演算子を利用すると、このような複数の条件を組み合わせることができます。順に見ていきましょう。</p>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>■And演算子</b></p>
</b></div>
<div>
<p><img src="images/00143.jpeg" alt="" />IfTest<span>3</span></p>
</div>
<p>　And演算子は<span><b>論理積</b></span>を求めるための演算子で、Andの前後に書いた式が両方ともTrueであれば結果がTrueになります。簡単にいえば、<span>2</span>つの条件の両方が成立するときだけ、条件が成立することになります。<span>1</span>つでも条件が成立しないと、全体の条件は成立しません。LIST<span>4</span>-<span>4</span>は、コレステロール値が標準値の範囲内に入っているかどうかを調べる例です。コレステロール値はCholという変数に入っているものとし、この値が110以上、250以下であれば「標準値の範囲内です」をMessageに代入し、そうでなければ「標準値の範囲外です」をMessageに代入します。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>4</span>-<span>4</span>　変数の値が一定の範囲に入っているかどうかを調べる例</p>
</div>
<div>
<div>
<pre lang="en"><code>If Chol &gt;= 110 And Chol &lt;= 250 Then　　　●─── Cholの値が110以上であり、かつ、Cholの値が250以下であれば</code></pre>
<pre lang="en"><code>    Message = "標準値の範囲内です"</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>    Message = "標準値の範囲外です"</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p>　Cholの値が110以上、250以下というのは、日常の感覚では以下のように書きたくなります。しかし、これでは必ずしも正しく動作しないので注意が必要です。</p>
<div>
<pre lang="en"><code>If 110 &lt;= Chol &lt;= 250 Then</code></pre></div>
<p>　例えば、Cholの値が300の場合を考えてみましょう。まず</p>
<div>
<pre lang="en"><code>110 &lt;= Chol	　　　●─── 110 &lt;= 300は成り立つので、この結果はTrue</code></pre></div>
<div>
<p>が実行されるので、この値はTrueになります。この結果と250を比較して</p>
</div>
<div>
<pre lang="en"><code>True &lt;= 250　　　●───True(-1) &lt;= 250は成り立つので、この結果もTrue</code></pre></div>
<div>
<p>が実行されますが、これもTrueになります。なぜなら、整数型の変数に代入したり、整数と比較したりするときにはTrueは-<span>1</span>と見なされるからです<span>※<span>1</span></span>。とすると、Cholの値が300であるにもかかわらず、110以上、250以下の範囲に入っていることになってしまい、正しい結果が得られません。</p>
</div>
<p>　したがって、変数の値がある範囲に入っているかどうかを調べたいときには、LIST<span>4</span>-<span>4</span>に示したように「下限値以上であり、かつ上限値以下である」というような式を書く必要があります。なお、Option StrictをOnにしていると、データ型の違いが厳密にチェックされるので、正しく動作しない場合の書き方ではエラーになります。</p>
<p>　別の例を見てみましょう。複数の変数を使った条件を組み合わせることもできます。LIST<span>4</span>-<span>5</span>は、筆記試験の成績と実技試験の成績がいずれも基準値を満たしていれば合格とする例です。筆記試験の成績はExamScoreに、実技試験の成績はSkillScoreに入っているものとします。ExamScoreが<span>90</span>以上であり、かつSkillScoreが<span>80</span>以上である場合のみ合格とします。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>4</span>-<span>5</span>　複数の変数がすべて基準値以上であるかを調べる例</p>
</div>
<div>
<div>
<pre lang="en"><code>If ExamScore &gt;= 90 And SkillScore &gt;= 80 Then</code></pre>
<pre lang="en"><code>    Grade = "合格"</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>    Grade = "不合格"</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>


<hr />
<div>
<p>※<span>1</span>　Trueを整数として扱うと-<span>1</span>になり、Falseを整数として扱うと<span>0</span>になります。一方、整数を真偽値として扱うときには<span>0</span>以外がTrue、<span>0</span>がFalseとして扱われます（<a href="#calibre_link-325"><u>P.128</u></a>を参照してください）。</p>
</div>
</div>
</div>
<div id="calibre_link-9">
<div>
<div><b>
<p><b>■Or演算子</b></p>
</b></div>
<div>
<p><img src="images/00143.jpeg" alt="" />IfTest<span>4</span></p>
</div>
<p>　Orは<span><b>論理和</b></span>を求める演算子で、Orの前後に書いた式のどちらかがTrueであれば結果がTrueになります。こちらは、いずれか<span>1</span>つの条件が成立すれば、全体の条件が成立することになります。もちろん、両方の条件が成立していても構いません。例を見てみましょう。成績の評価が「S」または「A」であれば給付金の対象であることを表示してみます。成績の評価がGradeという変数に入っているものとすれば、LIST<span>4</span>-<span>6</span>のように書けます。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>4</span>-<span>6</span>　変数の値がいずれか<span>1</span>つに一致するかどうかを調べる例</p>
</div>
<div>
<div>
<pre lang="en"><code>If Grade = "S" Or Grade = "A" Then</code></pre>
<pre lang="en"><code>    Message = "給付金の対象となります"</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>    Message = "給付金の対象となりません"</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p>　念のため、複数の変数を使った条件の例についても見ておきましょう。第<span>1</span>回の試験の成績と第<span>2</span>回の試験の成績のいずれかが基準値を満たしていれば合格とする例です。第<span>1</span>回の成績はFirstScoreに、第<span>2</span>回の成績はSecondScoreに入っているものとします。第<span>1</span>回の合格基準を<span>90</span>点以上とし、第<span>2</span>回の合格基準を<span>80</span>点以上とすればLIST<span>4</span>-<span>7</span>のように書けます。もちろん、両方の成績が基準点以上であっても合格です。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>4</span>-<span>7</span>　複数の変数のいずれかが基準値以上であるかを調べる例</p>
</div>
<div>
<div>
<pre lang="en"><code>If FirstScore &gt;= 90 Or SecondScore &gt;= 80 Then</code></pre>
<pre lang="en"><code>    Grade = "合格"</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>    Grade = "不合格"</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-136">
<div><b>
<p><b>■AndAlso演算子とOrElse演算子</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />IfTest<span>5</span></p>
</div>
<hr />
<p>　And演算子やOr演算子に似た演算子にAndAlso演算子とOrElse演算子があります。これらは、見た目の動作としてはAnd演算子やOr演算子と同じですが、処理効率のいい演算子です。それぞれ詳しく見てみましょう。</p>
<p><br /></p>
<div><b>
<p><b>■AndAlso演算子</b></p>
</b></div>
<p>　AndAlso演算子では、前に指定した式がFalseなら後ろの式を評価せずに（調べずに）、結果としてそのままFalseを返します。And条件の場合、両方の式がTrueである場合にだけ結果がTrueになるので、最初の式がFalseであればその時点で結果がFalseであることは明らかだからです。And演算子は両方の式を評価しますが、AndAlso演算子は不必要な式の評価はしないというわけです。LIST<span>4</span>-<span>8</span>はAnd演算子のところで見た例と同じ処理を、AndAlso演算子を使って書いたものです。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>4</span>-<span>8</span>　AndAlso演算子の利用例</p>
</div>
<div>
<div>
<pre lang="en"><code>If ExamScore &gt;= 90 AndAlso SkillScore &gt;= 80 Then</code></pre>
<pre lang="en"><code>    Grade = "合格"</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>    Grade = "不合格"</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p>　この例では、ExamScoreが<span>90</span>未満であればその時点でFalseだと分かるので、後のSkillScore &gt;=<span>80</span>は調べる必要がありません。その場合は、すぐにElseの後のステートメントを実行します。</p>
<p><br /></p>
<div><b>
<p><b>■OrElse演算子</b></p>
</b></div>
<p>　一方のOrElse演算子では、前に指定した式がTrueなら後ろの式を評価せずに、結果としてそのままTrueを返します。Or条件の場合、いずれかの式がTrueであれば、結果がTrueになるので、最初の式がTrueであればその時点で結果がTrueであることは明らかだからです。Or演算子は両方の式を評価しますが、OrElse演算子は不必要な式の評価はしないというわけです。LIST<span>4</span>-<span>9</span>はOr演算子のところで見た例と同じ処理を、OrElse演算子を使って書いたものです。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>4</span>-<span>9</span>　OrElse演算子の利用例</p>
</div>
<div>
<div>
<pre lang="en"><code>If Grade = "S" OrElse Grade = "A" Then</code></pre>
<pre lang="en"><code>    Message = "給付金の対象となります"</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>    Message = "給付金の対象となりません"</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p>　この例では、Gradeが「S」であればその時点でTrueだと分かるので、後のGrade = "A"は調べる必要がありません。その場合はすぐにThenの後のステートメントを実行します。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>AndAlso演算子やOrElse演算子でなければできないこと</b></p>
</b></div>
<div>
<p><img src="images/00143.jpeg" alt="" />IfTest<span>6</span></p>
</div>
<p><br /></p>
<div>
<p>　AndAlso演算子やOrElse演算子は、後ろの式が前の式に依存するような場合に便利です。例えば、以下のコードでは、objという変数がrbOptionというRadioButtonコントロールであり、かつCheckedプロパティがTrueであるとき、メッセージを表示します。</p>
</div>
<div>
<pre lang="en"><code>If obj Is rbOption And obj.Checked Then</code></pre>
<pre lang="en"><code>    MessageBox.Show("ラジオボタンがチェックされています")</code></pre>
<pre lang="en"><code>End If</code></pre></div>
<div>
<p>　Is演算子は、変数が同じオブジェクトを参照しているかを調べる演算子です。要するにobjがrbOptionというコントロールであるかどうかを調べています（オブジェクトを参照する変数については<span>8</span>.<span>2</span>節で詳しく説明します。とりあえずはこう考えておいてください）。</p>
</div>
<div>
<p>　この場合、もしobjがrbOptionでなく、CheckedプロパティのないLabelコントロールなどを参照していると、Andの後ろのobj.Checkedという部分が実行時にエラーとなってしまいます。And演算子を使った場合は、両方の式を調べるので、objがrbOptionであるかどうかにかかわらず、obj.CheckedがTrueであるかどうかも調べられてしまうからです。Trueかどうか以前に、LabelコントロールにはそもそもCheckedプロパティがないわけですから、当然エラーになるわけです。</p>
</div>
<div>
<p>　しかし、以下のようにAndの代わりにAndAlsoを使えば、obj Is rbOptionという式がTrueであるときだけobj.CheckedがTrueであるかどうかが調べられます（obj Is rbOptionがFalseであれば、その時点でFalseとなるのでobj.Checkedを調べることはありません）。したがって、objが参照しているコントロールがLabelコントロールなどであっても実行時にエラーとならず、正しく条件分岐ができます。</p>
</div>
<div>
<pre lang="en"><code>If obj Is rbOption AndAlso obj.Checked Then</code></pre>
<pre lang="en"><code>    MessageBox.Show("ラジオボタンがチェックされています")</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-137">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）　Ifステートメントの条件にあたる部分には、結果がTrueかFalseになる式を書く</p>
</div>
<div>
<p>（  ）　Ifステートメントの中に、区切り記号「：」を使わず複数のステートメントを書きたいときには、最後にEnd Ifを書く</p>
</div>
<div>
<p>（  ）　Ifステートメントには必ずElseキーワードを書く必要がある</p>
</div>
<div>
<p>（  ）　Or演算子を使うと、少なくとも一方の条件を満たすときに処理を実行するIfステートメントが書ける</p>
</div>
<p><br /></p>
<p><span><b><span><b>2</b></span></b></span>.　説明に従って以下の空欄を埋め、Ifステートメントを完成させてください。</p>
<p><br /></p>
<div>
<div>
<pre lang="en"><code>（1）	If（　　）Then　　　●───変数apXの値が100を超えたら</code></pre>
<pre lang="en"><code>	    apX = 0　　　●─── apXに0を代入する</code></pre>
<pre lang="en"><code>	End If</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>（2）	If</code><code><code>（　　）</code>Then　　　●───変数OptionFlagの値がTrueであれば</code></pre>
<pre lang="en"><code>	    btnOption.Focus()　　　●───btnOptionにフォーカスを移動<br /></code><code>　　　　　　　　　　（　　）</code>　　　●───<code> そうでなければ</code>
</pre>
<pre lang="en"><code>	    txtName.Focus()　　　●─── txtNameにフォーカスを移動</code></pre>
<pre lang="en"><code>	End If</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>（3）	If Confirm = "Y"</code><code><code>（　　）</code>NeedConfirm = False Then</code></pre>
<pre lang="en"><code>		　　　　　　　　　　　　●───Confirmの値が"Y"であるか、NeedConfirmの値がFalseであれば</code></pre>
<pre lang="en"><code>	    lblOrder.Text = "注文処理を実行しました"　　　●───　lblOrderに「注文処理を実行しました」と表示 </code></pre>
<pre lang="en"><code>	End If</code></pre></div>
</div>
</div>
</div>
<div id="calibre_link-40">
<div>
<div id="calibre_link-138">
<div><b>
<p><b>　<span><b>4</b></span>.<span><b>3</b></span>　Ifステートメントによる多分岐</b></p>
</b></div>
</div>
<p><br /></p>
<p>　前節では、簡単な例から条件を組み合わせて指定する例までを見ましたが、基本的には、条件が満たされた場合と条件が満たされない場合の<span>2</span>つに分岐するだけでした。しかし、現実にはより複雑に分岐することがあります。この節では、Ifステートメントの中にさらにIfステートメントがあるような場合について見ていきます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-139">
<div><b>
<p><b>■Ifステートメントを入れ子にする</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />NestTest<span>1</span></p>
</div>
<hr />
<p>　Ifステートメントを組み合わせると、これまでに見たような<span>2</span>分岐の処理だけでなく、多くの場合分けがある<span><b>多分岐</b></span>の処理を書くこともできます。具体例で見てみましょう。あらかじめ決められたランクと購入金額により会員の種別を決めるような処理を想像してみてください。</p>
<p>　まず、会員のランクが「A」であるかそうでないかによって、どの会員になれるかが決まるものとします。会員ランクが「A」の場合、購入金額が<span>10</span>,000円以上であればプレミアム会員になれますが、そうでなければゴールド会員となります。会員ランクが「A」でない場合、購入金額が<span>20</span>,000円以上であればゴールド会員になれますが、そうでなければ通常会員となります。日本語の擬似コードでこの処理を書いてみましょう。</p>
<div>
<pre lang="en"><code>もし　会員のランクが「A」であれば</code></pre>
<pre lang="en"><code>　　もし、購入金額が10,000円以上であれば</code></pre>
<pre lang="en"><code>　　　　プレミアム会員とする</code></pre>
<pre lang="en"><code>　　そうでなければ</code></pre>
<pre lang="en"><code>　　　　ゴールド会員とする</code></pre>
<pre lang="en"><code>そうでなければ</code></pre>
<pre lang="en"><code>　　もし、購入金額が20,000円以上であれば</code></pre>
<pre lang="en"><code>　　　　ゴールド会員とする</code></pre>
<pre lang="en"><code>　　そうでなければ</code></pre>
<pre lang="en"><code>　　　　通常会員とする</code></pre></div>
<p>　ちょっと見ただけでは、何がどうなっているのか分からない人もいるでしょう。最初は会員のランクが「A」であるかどうかで分岐します。その次は購入金額がいくらであるかで分岐します。分かれ道の先にまた分かれ道があるようなイメージを思い浮かべるといいでしょう。フローチャートにすると、流れが理解しやすくなります（図<span>4</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00280.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>①　ランクによる条件分岐</p>
</div>
<div>
<p>②　ランクが「A」のときの購入金額による条件分岐</p>
</div>
<div>
<p>③　ランクが「A」でないときの購入金額による条件分岐</p>
</div>
<p><br /></p>
<p>　フローチャートのひし形<span>1</span>つがIfステートメント<span>1</span>つにあたるので、それをそのまま表現するだけでコードが書けます。会員のランクがCustomerRankという変数に入れられており、購入金額がSalesという変数に入れられているものとしましょう。会員の種別はlblGradeというLabelコントロールに表示するものとします。すると、コードはLIST<span>4</span>-<span>10</span>のようになります。まずはコードをざっと眺めておいてください。その後、詳しい説明をします。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>4</span>-<span>10</span>　会員のランクと購入金額により会員種別を決めるコードをIfステートメントの入れ子で書く</p>
</div>
<div>
<div>
<pre lang="en"><code>If CustomerRank = "A" Then　　　●―――CustomerRankが"A"であれば</code></pre>
<pre lang="en"><code>    If Sales &gt;= 10000 Then　　　●―――Salesが10000以上であれば</code></pre>
<pre lang="en"><code>        lblGrade.Text = "プレミアム会員"</code></pre>
<pre lang="en"><code>    Else　　　●―――そうでなければ（Salesが10000以上でなければ）</code></pre>
<pre lang="en"><code>        lblGrade.Text = "ゴールド会員"</code></pre>
<pre lang="en"><code>    End If</code></pre>
<pre lang="en"><code>Else　　　●―――そうでなければ（CustomerRankが"A"でなければ）</code></pre>
<pre lang="en"><code>    If Sales &gt;= 20000 Then　　　●―――Salesが20000以上であれば</code></pre>
<pre lang="en"><code>        lblGrade.Text = "ゴールド会員"</code></pre>
<pre lang="en"><code>    Else　　　●―――そうでなければ（Salesが20000以上でなければ）</code></pre>
<pre lang="en"><code>        lblGrade.Text = "通常会員"</code></pre>
<pre lang="en"><code>    End If</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p>　If ... Then ... Else ... End Ifの書き方はこれまでと同じですが、Thenの後やElseの後に、さらにIfステートメントが書かれています。このように、Ifステートメントの中にさらにIfステートメントを書くことを<span><b>入れ子</b></span>とか<span><b>ネスト</b></span>と呼びます。</p>
<p>　まず、条件は後回しにして、明確にしておくべきことが<span>1</span>つあります。それは、結果として何が欲しいかということです。ここで欲しいものは会員の種別です。もっと具体的にいうと、</p>
<div>
<pre lang="en"><code>lblGrade.Text = "プレミアム会員"</code></pre>
<pre lang="en"><code>lblGrade.Text = "ゴールド会員"</code></pre>
<pre lang="en"><code>lblGrade.Text = "通常会員"</code></pre></div>
<p>のいずれかを実行したいということです。これらのコードを条件によってどう振り分けるか、というのが課題となるわけです。</p>
<p>　では、このようなコードが確実に書けるように、入れ子の作り方を見ていきましょう。どんなに複雑な入れ子でも、鉄則は上位のレベルから順に考えていくということです。この例では、まずCustomerRankが"A"であるか、そうでないかによって異なる処理をします。まだ細かな処理について考える必要はありません。フローチャートの①にあたる部分からおおまかに考えましょう。図にすると図<span>4</span>-<span>8</span>のようになります。簡単な<span>2</span>分岐なのでこれまでの知識で十分理解できるはずです。</p>
<p><br /></p>
<div>
<p><img src="images/00142.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　次に、CustomerRankが"A"であるときの処理の中身を考えます。これはフローチャートの②にあたる部分です。上位のレベルも下位のレベルも考える必要はありません。このレベルだけを考えます。Salesの値によってプレミアム会員にするかゴールド会員にするかという条件分岐であることが分かります（図<span>4</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00200.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　CustomerRankが"A"でないときの処理の中身も同じように考えることができます。これはフローチャートの③にあたる部分です（図<span>4</span>-<span>10</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00070.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　上位のレベルの処理を洗い出した後、続いて下位のレベルの処理をすべて洗い出せば、あとはそれらをすべて組み合わせて書くだけです。図<span>4</span>-<span>9</span>と図<span>4</span>-<span>10</span>を、最初の図<span>4</span>-<span>8</span>に埋め込んでやれば、Ifステートメントの入れ子が完成していることに気付くと思います。また、得られる会員種別にも漏れがなく、条件によってきちんと結果が求められることも分かります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-140">
<div><b>
<p><b>■ElseIfを利用した多分岐</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />NestTest<span>2</span></p>
</div>
<hr />
<p>　条件が満たされないときに、さらに条件分岐していく場合にはElseIfというキーワードを使って簡潔に多分岐のステートメントを書くことができます。例えば、得点が<span>60</span>点未満のときは評価を「不可」とし、<span>60</span>点以上<span>70</span>点未満のときは評価を「可」、<span>70</span>点以上<span>80</span>点未満のときは「良」、<span>80</span>点以上のときは 「優」とする例を考えてみましょう。この場合も、結果として欲しいものを最初に洗い出しておきます。結果は「不可」「可」「良」「優」のいずれかで、それ以外はありません。問題は、これらを条件によってどう振り分ければいいかということです。日本語で書いた擬似コードは以下のようになります。</p>
<div>
<pre lang="en"><code>もし　得点が60点未満であれば</code></pre>
<pre lang="en"><code>　　評価を不可とする</code></pre>
<pre lang="en"><code>そうでなければ</code></pre>
<pre lang="en"><code>　　もし　得点が70点未満であれば</code></pre>
<pre lang="en"><code>　　　　評価を可とする</code></pre>
<pre lang="en"><code>　　そうでなければ</code></pre>
<pre lang="en"><code>　　　　もし　得点が80点未満であれば</code></pre>
<pre lang="en"><code>　　　　　　評価を良とする</code></pre>
<pre lang="en"><code>　　　　そうでなければ</code></pre>
<pre lang="en"><code>　　　　　　評価を優とする</code></pre></div>
<p>　このように「〜以上〜未満」という条件がいくつもあり、それらの条件によって複数の場合分けをするときには、端から順に考えていくと分かりやすくなります。最初は<span>60</span>未満について考え、次にそうでない場合のうち<span>70</span>未満について考え、次にそうでない場合のうち<span>80</span>未満について考える......という具合です。「であれば」や「そうでなければ」の次の行を字下げして書くのが分かりやすくするためのコツです。</p>
<p>　この例についてもフローチャートで処理の流れを見ておきましょう（図<span>4</span>-<span>11</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00295.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>①　得点が<span>60</span>点未満であるかどうかによる条件分岐</p>
</div>
<div>
<p>②　得点が<span>70</span>点未満であるかどうかによる条件分岐</p>
</div>
<div>
<p>③　得点が<span>80</span>点未満であるかどうかによる条件分岐</p>
</div>
<p><br /></p>
<p>　このフローチャートは、これまでのフローチャートとTrueとFalseの向きが異なることに注意してください。これまでと同じようにTrueを下方向に、Falseを横方向に書くこともできますが、横長になってしまうので向きを変えて多分岐であることがよく分かるようにしただけのことです。</p>
<p>　このように表しても、ひし形<span>1</span>つがIfステートメント<span>1</span>つにあたります。得点がScoreという変数に入れられており、評価をGradeという変数に入れるのであれば、コードはLIST<span>4</span>-<span>11</span>のようになります。これについてもコードをざっと眺めておいてください。後で考え方を詳しく説明します。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>4</span>-<span>11</span>　得点により何段階かの評価を決めるコードをElseIfによる多分岐で書く</p>
</div>
<div>
<div>
<pre lang="en"><code>If Score &lt; 60 Then　　　●―――Scoreが60未満であれば</code></pre>
<pre lang="en"><code>    Grade = "不可"</code></pre>
<pre lang="en"><code>ElseIf Score &lt; 70 Then　　　●―――そうではなく（Scoreが60以上であり）、Scoreが70未満であれば</code></pre>
<pre lang="en"><code>    Grade = "可"</code></pre>
<pre lang="en"><code>ElseIf Score &lt; 80 Then　　　●―――そうではなく（Scoreが70以上であり）、Scoreが80未満であれば</code></pre>
<pre lang="en"><code>    Grade = "良"</code></pre>
<pre lang="en"><code>Else　　　●―――そうでなければ（Scoreが80以上であれば）</code></pre>
<pre lang="en"><code>    Grade = "優"</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p>　では、このようなコードを確実に書くための考え方を説明しましょう。すでに少し触れましたが、基本は「端から考える」です。まず、得点が<span>60</span>点未満の場合と、そうでない場合に分けます。得点が<span>60</span>点未満の場合は評価を「不可」とします。そうでない場合は「可」「良」「優」のいずれかになりますが、ここではまだ考えません。それが図<span>4</span>-<span>12</span>の①の部分です。</p>
<p>　次に、「そうでない場合（得点が<span>60</span>点以上の場合）」のことを考えます。これは図<span>4</span>-<span>12</span>の②の部分です。得点が<span>70</span>点未満の場合は評価を「可」とします。そうでない場合は「良」「優」のいずれかになりますが、やはりまだ考えません。</p>
<p>　最後に、「そうでない場合（今度は得点が<span>70</span>点以上の場合）」を考えます。これが図<span>4</span>-<span>12</span>の③の部分です。すると、得点が<span>80</span>点未満の場合は評価が「良」であり、そうでない場合は評価が「優」となることが分かります。これですべての場合が洗い出されました。</p>
<p><br /></p>
<div>
<p><img src="images/00040.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00036.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>①　得点が<span>60</span>点未満であるかどうかを考える。<span>60</span>以上のときはまだ考えない</p>
</div>
<div>
<p>②　得点が<span>70</span>点未満であるかどうかを考える。<span>70</span>以上のときはまだ考えない</p>
</div>
<div>
<p>③　得点が<span>80</span>点未満であるかどうかを考える</p>
</div>
<p><br /></p>
<p>　この図をそのままコードにすると、以下のようになります。最初に書いた擬似コードともほぼ同じです。</p>
<div>
<pre lang="en"><code>If Score &lt; 60 Then</code></pre>
<pre lang="en"><code>    Grade = "不可"</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>    If Score &lt; 70 Then</code></pre>
<pre lang="en"><code>        Grade = "可"</code></pre>
<pre lang="en"><code>    Else</code></pre>
<pre lang="en"><code>        If Score &lt; 80 Then</code></pre>
<pre lang="en"><code>            Grade = "良"</code></pre>
<pre lang="en"><code>        Else</code></pre>
<pre lang="en"><code>            Grade = "優"</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>    End If</code></pre>
<pre lang="en"><code>End If</code></pre></div>
<p>　このコードのElse IfはElseIfという<span>1</span>つのキーワードにできます。また、最後のEnd Ifは<span>1</span>つにまとめられます。そうすれば、図<span>4</span>-<span>13</span>の右側のような簡潔なコードにできます。</p>
<p><br /></p>
<div>
<p><img src="images/00131.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　ElseとIfの間にはスペースが入らないことに注意してください。ただし、実際に入力するときには途中にスペースを入れてElse Ifと入力しても、自動的に<span>1</span>つの単語に訂正されます。書き方をまとめると、次のようになります（図<span>4</span>-<span>14</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00215.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　実用的には、これまでのように順を追って考えなくても、<span>1</span>つのパターンとして覚えておいても構わないでしょう。実際、条件<span>1</span>が満たされたときには最初のステートメントを実行し、それ以外の場合で条件<span>2</span>が満たされたときには次のステートメントを実行し、......という具合に書いていけば間違いありません。</p>
<p><br /></p>
<div>
<div id="calibre_link-296">
<div><b>
<p><b><span><b><img src="images/00053.jpeg" alt="" /><b></b></b></span>条件分岐はさまざまな表し方がある</b></p>
</b></div>
</div>
<div>
<p>　どんな場合でも、条件の指定方法には何通りかの方法があります。例えば「<span>65</span>歳以上」というのは「<span>65</span>歳未満ではない」というのと同じことです。「○○という条件にあてはまっている場合で、△△という条件にあてはまる場合」も入れ子で表したり、And演算子やAndAlso演算子を使って表したりできます。例えば、LIST<span>4</span>-<span>10</span>の例も、以下のように表せます。</p>
</div>
<div>
<pre lang="en"><code>    If CustomerRank = "A" AndAlso Sales &gt;= 10000 Then</code></pre>
<pre lang="en"><code>        lblGrade.Text = "プレミアム会員"</code></pre>
<pre lang="en"><code>    ElseIf CustomerRank = "A" OrElse Sales &gt;= 20000 Then</code></pre>
<pre lang="en"><code>        lblGrade.Text = "ゴールド会員"</code></pre>
<pre lang="en"><code>    Else</code></pre>
<pre lang="en"><code>        lblGrade.Text = "通常会員"</code></pre>
<pre lang="en"><code>    End If</code></pre></div>
<div>
<p>　行数は少なくて済みますが、これでは条件が複雑になりすぎて何を判定しているのかがきわめて分かりにくくなります。実際には、入れ子にしたほうが分かりやすい場合も、And演算子やOr演算子を使ったほうが分かりやすい場合もあり、いちがいにどちらがいいとはいえませんが、できるだけ人間が読んでもスッキリと分かる書き方にしてください。条件が分かりにくいと、本来あてはまるべき条件にあてはまらない値が出てくるなど、思わぬエラーのもととなるからです。後でプログラムを修正する必要が生じた場合にも、条件が分かりにくいと作業の効率が落ちてしまいます。分かりやすいコードを書くには、この節で説明したように、上位のレベルから考えるのが基本です。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-141">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　説明に従って以下の空欄を埋め、Ifステートメントを完成させてください。</p>
<p><br /></p>
<div>
<p>（<span>1</span>）　ウェストのサイズによって、S、M、L、LLを決める</p>
</div>
<div>
<div>
<pre lang="en"><code>	If Waist &lt; 64 Then　　　●―――Waistが64未満であれば</code></pre>
<pre lang="en"><code>	    ItemSize = "S"　　　●―――ItemSizeに"S"を代入する</code></pre>
<pre lang="en"><code>	（　　）Waist &lt; 70 Then　　　●―――上記にあてはまらず、Waistが70未満であれば</code></pre>
<pre lang="en"><code>	（　　）ItemSize = "M"　　　●―――ItemSizeに"M"を代入する</code></pre>
<pre lang="en"><code>	 Waist &lt; 77 Then　　　●―――上記にあてはまらず、Waistが77未満であれば</code></pre>
<pre lang="en"><code>	    ItemSize = "L"　　　●―――ItemSizeに"L"を代入する</code></pre>
<pre lang="en"><code>	（　　）	　　　●―――上記にあてはまらなければ</code></pre>
<pre lang="en"><code>	    ItemSize = "LL"　　　●―――ItemSizeに"LL"を代入する</code></pre>
<pre lang="en"><code>	End If。</code></pre></div>
</div>
<p><br /></p>
<p>（<span>2</span>）　TextBoxコントロールに整数と見なせる数字が入力されているかどうかを調べる</p>
<div>
<div>
<pre lang="en"><code>	If Integer.TryParse(txtHour.Text, WorkingHour) = False Then</code><code><code>　　　●―――</code>txtHourに入力されている文字列を整数に変換しWorkingHourに入れる。変換できなければ以下のコードを実行する</code></pre>
<pre lang="en"><code>	    MessageBox.Show("時間が正しく入力されていません")</code></pre>
<pre lang="en"><code>	    txtHour. （　　）　　　●―――txtHourにフォーカスを移動</code></pre>
<pre lang="en"><code>	    txtHour. （　　）　　　●―――txtHourに入力されている文字列を選択する</code></pre>
<pre lang="en"><code>	 Integer.TryParse(txtMinute.Text, WorkingMinute) = ⇒　　　●―――上記以外で、txtMinuteに入力されている文字列を整数に変換し、WorkingMinuteに入れる。変換できなければ以下のコードを実行する</code></pre>
<pre lang="en"><code>	    False Then	　</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	    MessageBox.Show("分が正しく入力されていません")</code></pre>
<pre lang="en"><code>	    txtMinute. （　　）　　　●―――txtMinuteにフォーカスを移動</code></pre>
<pre lang="en"><code>	    txtMinute. （　　）　　　●―――txtMinuteに入力されている文字列を選択する</code></pre>
<pre lang="en"><code>	 	（　　）　　　●―――上記以外であれば</code></pre>
<pre lang="en"><code>	    WorkingTime = WorkingHour + WorkingMinute / 60</code></pre>
<pre lang="en"><code>	    lblTime.Text = WorkingTime.ToString()</code></pre>
<pre lang="en"><code>	End If</code></pre></div>
</div>
<p><br /></p>
<div>
<p><span><b><span><b>2</b></span>.</b></span>　上記の（<span>2</span>）で、時間が<span>24</span>以上になったり、分が<span>60</span>以上になった場合にもエラーメッセージを表示するコードを追加してみてください。</p>
</div>
</div>
</div>
<div id="calibre_link-307">
<div>
<div id="calibre_link-142">
<div><b>
<p><b>　<span><b>4</b></span>.<span><b>4</b></span>　Select Caseステートメントによる多分岐</b></p>
</b></div>
</div>
<p><br /></p>
<p>　<span>1</span>つの式や変数の値によって何通りかの異なる処理をしたい場合には、Ifステートメントによる多分岐よりもSelect Caseステートメントを使った多分岐が便利です。例えば、指定された日付が何月であるかによって実行する処理を変えたり、いくつかの（例えば<span>1</span>番から<span>4</span>番までの）選択肢のどれを選んだかによって実行する処理を変えたりするときに使えます。値の範囲や大小比較もできます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-143">
<div><b>
<p><b>■多分岐を簡潔に書く</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />CaseTest<span>1</span></p>
</div>
<hr />
<p>　Select Caseステートメントを使うと便利な処理の例を見てみましょう。日本では<span>1</span>月は「睦月」、<span>2</span>月は「如月」......のように月に和名が付けられています。このような場合、何月であるかによって、月の和名が決まります。つまり、月を表す数値を指定すれば、それに対応する文字列が求められるわけです。</p>
<p><br /></p>
<div>
<p><img src="images/00176.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　処理そのものは簡単なので、擬似コードやフローチャートを描くまでもないでしょう。月を表す数値がMonthNumberという変数に入れられており、求めたい月の和名をMonthNameという変数に入れるものとして、さっそくコードを書いてみましょう（LIST<span>4</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>4</span>-<span>12</span>　月を表す数値をもとに、月の和名を求める</p>
</div>
<div>
<div>
<pre lang="en"><code>     MonthNumber = Today.Month</code></pre>
<pre lang="en"><code>    Select Case MonthNumber</code></pre>
<pre lang="en"><code>        Case 1</code></pre>
<pre lang="en"><code>            MonthName = "睦月"</code></pre>
<pre lang="en"><code>        Case 2</code></pre>
<pre lang="en"><code>            MonthName = "如月"</code></pre>
<pre lang="en"><code>        Case 3</code></pre>
<pre lang="en"><code>            MonthName = "弥生"</code></pre>
<pre lang="en"><code>        Case 4</code></pre>
<pre lang="en"><code>            MonthName = "卯月"</code></pre>
<pre lang="en"><code>        Case 5</code></pre>
<pre lang="en"><code>            MonthName = "皐月"</code></pre>
<pre lang="en"><code>        Case 6</code></pre>
<pre lang="en"><code>            MonthName = "水無月"</code></pre>
<pre lang="en"><code>        Case 7</code></pre>
<pre lang="en"><code>            MonthName = "文月"</code></pre>
<pre lang="en"><code>        Case 8</code></pre>
<pre lang="en"><code>            MonthName = "葉月"</code></pre>
<pre lang="en"><code>        Case 9</code></pre>
<pre lang="en"><code>            MonthName = "長月"</code></pre>
<pre lang="en"><code>        Case 10</code></pre>
<pre lang="en"><code>            MonthName = "神無月"</code></pre>
<pre lang="en"><code>        Case 11</code></pre>
<pre lang="en"><code>            MonthName = "霜月"</code></pre>
<pre lang="en"><code>        Case 12</code></pre>
<pre lang="en"><code>            MonthName = "師走"</code></pre>
<pre lang="en"><code>        Case Else</code></pre>
<pre lang="en"><code>            MonthName = "不明"</code></pre>
<pre lang="en"><code>    End Select</code></pre></div>
</div>
<p><br /></p>
<p>　最初の行は、今日の日付から月の値を求めるためのコードです。Todayは現在の日時を表すDate型の値を返し、さらにMonthプロパティは月の値を整数として返します。これで、今日の月がMonthNumberに代入されます。理詰めで表現するとけっこう難しくなりますが、要するにToday.Monthと書けば月の値が求められるというわけです。</p>
<p>　続く、Select Caseが多分岐のためのステートメントです。Select Caseの後には値を調べたい式を書きます。この例では、月を表す数値を調べるので、MonthNumberという変数を書いています。その後に、それぞれの場合によって実行する処理を書きます。場合分けはCaseの後に書いた式の値と一致するかどうかで決められます。値が一致すればそこに書かれているステートメントを実行し、それ以外のステートメントは実行されません。どの値にも一致しない場合はCase Elseの後に書かれているステートメントを実行します。最後にEnd Selectを書いて終わりです。書き方をまとめておきましょう（図<span>4</span>-<span>15</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00068.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　ここでは、それぞれの場合に実行するステートメントを<span>1</span>つずつしか書いていませんが、複数のステートメントを書くこともできます。さらに、Caseの後の式には複数の値を書いたり、値の範囲を書いたりすることもできます。便利な使い方ができるので、いくつかのパターンを見ておきましょう。</p>
<p><br /></p>
<div><b>
<p><b>■複数の値と一致させる例</b></p>
</b></div>
<div>
<p><img src="images/00143.jpeg" alt="" />CaseTest<span>2</span></p>
</div>
<p>　Caseの後には、複数の値を「,」（カンマ）で区切って書くこともできます。その場合、それらの値のいずれかに一致すれば、Caseの後のステートメントが実行されます。色の名前をもとに、ウェブページなどで使われるカラーコードを求める例で見てみましょう。例えば、「red」という色の名前から「#FF0000」というカラーコードを求めます。「cyan」と「aqua」はいずれも同じ色で、カラーコードは「#<span>00</span>FFFF」です。また「magenta」と「fuchsia」も同じ色で、カラーコードは「#FF<span>00</span>FF」です。色の名前がColorNameという変数に入っており、求めたいカラーコードをColorCodeという変数に入れるのであれば、LIST<span>4</span>-<span>13</span>のようなコードが書けます。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>4</span>-<span>13</span>　色の名前からカラーコードを求める</p>
</div>
<div>
<div>
<pre lang="en"><code>Select Case ColorName　　　●―――ColorNameの値によって処理を振り分ける</code></pre>
<pre lang="en"><code>    Case "red"　　　●―――"red"に一致する場合</code></pre>
<pre lang="en"><code>        ColorCode = "#FF0000"</code></pre>
<pre lang="en"><code>    Case "cyan", "aqua"　　　●―――cyan"または"aqua"に一致する場合</code></pre>
<pre lang="en"><code>        ColorCode = "#00FFFF"</code></pre>
<pre lang="en"><code>    Case "magenta", "fuchsia"　　　●―――"magenta"または"fuchsia"に一致する場合</code></pre>
<pre lang="en"><code>        ColorCode = "#FF00FF"</code></pre>
<pre lang="en"><code>End Select</code></pre></div>
</div>
<p><br /></p>
<p>　この例では、Case Else以下が書かれていないので、どの値にも一致しない場合は何もせずに次に進みます。</p>
<p><br /></p>
<div><b>
<p><b>■値の範囲を指定する例</b></p>
</b></div>
<div>
<p><img src="images/00143.jpeg" alt="" />CaseTest<span>3</span>, CaseTest<span>4</span></p>
</div>
<p>　Caseの後には値の範囲も指定できます。書き方は以下の<span>2</span>通りです。</p>
<div>
<pre lang="en"><code>式1 To 式2　　　●―――式1の値から式2の値まで</code></pre>
<pre lang="en"><code>Is 比較演算子 式　　　●―――式の値より小さい、より大きいなど</code></pre></div>
<p>　例えば、年度を<span>3</span>か月ごとに、第<span>1</span>四半期、第<span>2</span>四半期、第<span>3</span>四半期、第<span>4</span>四半期と<span>4</span>つに分けることがあります。年度が<span>4</span>月から始まるとすると、<span>4</span>月から<span>6</span>月が第一四半期となります。月をもとに、その月が第何四半期であるかを求めるコードを書いてみましょう。月がMonthNumberという変数に入っており、第何四半期であるかをTermNumberという変数に入れるのであればLIST<span>4</span>-<span>14</span>のようなコードになります。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>4</span>-<span>14</span>　月を表す数値をもとに第何四半期かを求める</p>
</div>
<div>
<div>
<pre lang="en"><code>Select Case MonthNumber　　　●―――MonthNumberの値によって処理を振り分ける</code></pre>
<pre lang="en"><code>    Case 4 To 6　　　●―――4から6に一致する場合</code></pre>
<pre lang="en"><code>        TermNumber = 1</code></pre>
<pre lang="en"><code>    Case 7 To 9　　　●―――7から9に一致する場合</code></pre>
<pre lang="en"><code>        TermNumber = 2</code></pre>
<pre lang="en"><code>    Case 10 To 12　　　●―――10から12に一致する場合</code></pre>
<pre lang="en"><code>        TermNumber = 3</code></pre>
<pre lang="en"><code>    Case 1 To 3　　　●―――1から3に一致する場合</code></pre>
<pre lang="en"><code>        TermNumber = 4</code></pre>
<pre lang="en"><code>End Select</code></pre></div>
</div>
<p><br /></p>
<p>　比較演算子を使う方法も見ておきましょう。Ifステートメントを使って書いた成績評価のコードも、Select Caseステートメントを使えば簡潔に書けます。得点がScoreという変数に入っており、評価をGradeという変数に入れるものとします（LIST<span>4</span>-<span>15</span>）。</p>
<p><br /></p>
<div id="calibre_link-53">
<p><img src="images/00034.jpeg" alt="" /><span>4</span>-<span>15</span>　得点をもとに成績の評価を求める</p>
</div>
<div>
<div>
<pre lang="en"><code>Select Case Score　　　●―――Scoreの値によって処理を振り分ける</code></pre>
<pre lang="en"><code>    Case Is &lt; 60　　　●―――60未満の場合</code></pre>
<pre lang="en"><code>        Grade = "不可"</code></pre>
<pre lang="en"><code>    Case Is &lt; 70　　　●―――70未満の場合</code></pre>
<pre lang="en"><code>        Grade = "可"</code></pre>
<pre lang="en"><code>    Case Is &lt; 80　　　●―――80未満の場合</code></pre>
<pre lang="en"><code>        Grade = "良"</code></pre>
<pre lang="en"><code>    Case Else　　　●―――上記以外の場合</code></pre>
<pre lang="en"><code>        Grade = "優"</code></pre>
<pre lang="en"><code>End Select</code></pre></div>
</div>
<p><br /></p>
<p>　Isの後で使える比較演算子は、「&lt;」「&lt;=」「=」「&gt;=」「&gt;」です。さらに「,」（カンマ）で区切って複数の式を書くこともできます。ただし、以下のような書き方には注意が必要です。</p>
<div>
<pre lang="en"><code>Case Is &gt;= 60, Is &lt; 70</code></pre></div>
</div>
<p>　この書き方では、<span>60</span>以上<span>70</span>未満の範囲を表すことはできません。「,」で区切って複数の式を書くと「または（Or）」の意味になるので、ここでの指定は<span>60</span>以上または<span>70</span>未満という意味になります。したがって、すべての値が一致することになってしまいます。しかし、「かつ（And）」を表そうとして</p>
<div>
<pre lang="en"><code>Case Is &gt;=60 And Is &lt; 70</code></pre></div>
<p>のように書いてもうまくいきません。これは文法的に正しくないのでエラーとなってしまいます。</p>
<p>　Scoreが整数の場合、</p>
<div>
<pre lang="en"><code>Case 60 To 69</code></pre></div>
<p>と書けば、<span>60</span>以上<span>70</span>未満が表せます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-144">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）　Select Caseステートメントを使えば、多分岐の処理が簡潔に記述できる</p>
</div>
<div>
<p>（  ）　Select Caseの後には複数の式を書くことができ、それらの式がCaseの後に書かれた<span>1</span>つの値に一致するかどうかを調べられる</p>
</div>
<div>
<p>（  ）　Select Caseの後には式を<span>1</span>つ書くことができ、その式がCaseの後に書かれたいくつかの値に一致するか、あるいは一定の範囲に入っているかどうかを調べられる</p>
</div>
<div>
<p>（  ）　Caseの後に「,」（カンマ）で区切って複数の式を書くと「または」の意味になる</p>
</div>
<p><br /></p>
<p><br /></p>
<p><span><b><span><b>2</b></span>.</b></span>　説明に従って以下の空欄を埋め、Select Caseステートメントを完成させてください。</p>
<p><br /></p>
<div>
<pre lang="en"><code>（1）	 （　　）（　　） Direction　　　●―――変数Directionの値を調べる</code></pre>
<pre lang="en"><code>	    Case DIRUP　　　●―――定数DIRUPと等しければ</code></pre>
<pre lang="en"><code>	       apY -= 1　　　●―――apYを1減らす</code></pre>
<pre lang="en"><code>	    Case DIRDOWN　　　●―――定数DIRDOWNと等しければ</code></pre>
<pre lang="en"><code>	       apY += 1　　　●―――apYを1増やす</code></pre>
<pre lang="en"><code>	    Case DIRLEFT　　　●―――定数DIRLEFTと等しければ</code></pre>
<pre lang="en"><code>	       apX -= 1　　　●―――apXを1減らす</code></pre>
<pre lang="en"><code>	    Case （　　）　　　●―――上記以外の場合は</code></pre>
<pre lang="en"><code>	       apX += 1　　　●―――apXを1増やす</code></pre>
<pre lang="en"><code>	End（　　）</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>（2）	Select Case MemberID Mod 10　　　●―――変数MemberIDを10で割った余りを調べる</code></pre>
<pre lang="en"><code>	    Case（　　）　　　●―――値が0か5であれば</code></pre>
<pre lang="en"><code>	        PrizeName = "特賞"</code></pre>
<pre lang="en"><code>	    Case（　　）　　　●―――値が5より小さければ</code></pre>
<pre lang="en"><code>	        PrizeName = "当選"</code></pre>
<pre lang="en"><code>	    Case Else</code></pre>
<pre lang="en"><code>	        PrizeName = "落選"</code></pre>
<pre lang="en"><code>	End Select</code></pre></div>
</div>
<div id="calibre_link-340">
<div>
<div id="calibre_link-145">
<div><b>
<p><b>　<span><b>4</b></span>.<span><b>5</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
</div>
<p><br /></p>
<p>　<span>4</span>.<span>1</span>節から<span>4</span>.<span>4</span>節までで条件分岐についての基本的な知識を紹介したので、実践に移りましょう。ここでは標準価格から割引価格を求めるプログラムを作ります。割引価格は学生であるか株主であるかによって変わるものとします。プログラムの完成イメージをラフスケッチするところから始めましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-146">
<div><b>
<p><b>■割引価格を計算するプログラム</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />CalcPrice</p>
</div>
<hr />
<p>　多くの商品やサービスで、学生や会員などの条件による割引価格が適用されています。ここでも割引価格を求めるプログラムを作成してみます。標準価格は<span>3</span>,600円に決まっているものとして、学生であれば<span>1</span>割引、株主であれば<span>1</span>.<span>5</span>割引の割引価格を求めることとします。どの割引を適用するかはRadioButtonコントロールで選択できるようにします。プログラムの完成イメージはイラスト<span>4</span>-<span>5</span>のような感じです。</p>
<p><br /></p>
<div>
<p><img src="images/00213.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　完成イメージが確認できたら、Windowsフォームアプリケーションの新しいプロジェクトを作成しておいてください。プロジェクト名はCalcPriceとします。続いて、フォームをデザインします。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-147">
<div><b>
<p><b>■フォームのデザイン</b></p>
</b></div>
</div>
<hr />
<p>　画面<span>4</span>-<span>1</span>にならってフォームにコントロールを配置していきましょう。設定すべきプロパティは表<span>4</span>-<span>1</span>にまとめておきました。</p>
<p><br /></p>
<div>
<p><img src="images/00217.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>①　Textプロパティに文字列を設定していないので内容は表示されていないが、標準価格と販売価格を表示するためのLabelコントロールを配置する</p>
</div>
<div>
<p><img src="images/00221.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00274.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-148">
<div><b>
<p><b>■RadioButtonコントロールとコンテナー</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />RadioButtonTest</p>
</div>
<hr />
<p>　RadioButtonコントロールは本章ではじめて使うコントロールです。イベントハンドラーを書く前にRadioButtonコントロールの使い方を見ておきましょう。</p>
<p>　RadioButtonコントロールは複数のコントロールでひとまとまりのグループになっていて、その中の<span>1</span>つだけが選択できるようになっています。例えば、RadioButtonコントロールをフォームに配置したとき、<span>1</span>つのRadioButtonコントロールをクリックしてチェックされた状態にすると、ほかのRadioButtonコントロールのチェック状態は解除されます。この場合はフォームに配置されたRadioButtonコントロールが<span>1</span>つのグループとして取り扱われていることになります。</p>
<p>　では、図<span>4</span>-<span>16</span>のように、<span>4</span>つのRadioButtonコントロールを<span>2</span>つのグループに分けたいときにはどうすればいいでしょうか。</p>
<p><br /></p>
<div>
<p><img src="images/00316.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このままだと、フォーム上に配置した<span>4</span>つのRadioButtonコントロールが<span>1</span>つのグループになり、どれか<span>1</span>つだけしか選択できないようになってしまいます。例えば、［普通］にチェックされている状態のとき、［吉祥寺支店］をクリックすると、［普通］のチェックが外れてしまいます。</p>
<p>　複数のグループに分けるには、ツールボックスの［コンテナー］の一覧にあるGroupBoxコントロールやPanelコントロールをフォームに配置し、その中にRadioButtonコントロールを配置します（画面<span>4</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00307.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　これでグループが<span>2</span>つできました。それぞれのグループでRadioButtonコントロールが選択できるようになっています。左側のグループでの選択は右側のグループの選択には影響を及ぼしません。また、右側のグループでの選択も左側のグループの選択には影響を及ぼしません。このように、グループ化のために使われるGroupBoxコントロールやPanelコントロールのことを<span><b>コンテナー</b></span>と呼びます。フォームもコンテナーの<span>1</span>つです。イメージとしては図<span>4</span>-<span>17</span>のような感じです。</p>
<p><br /></p>
<div>
<p><img src="images/00238.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>①　フォームはGroupBoxコントロールのコンテナーとなっている</p>
</div>
<div>
<p>②　GroupBoxコントロールはRadioButtonコントロールのコンテナーとなっている</p>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>RadioButtonコントロールのチェック状態を手動で設定するには</b></p>
</b></div>
<div>
<p>　RadioButtonコントロールのAutoCheckプロパティをFalseに設定すると、ほかのRadioButtonコントロールをチェックしても、自動的にチェックが外されることがなくなります。この機能はRadioButtonコントロールをグループから外すためではなく、正しいRadioButtonコントロールがチェックされたかどうかを調べ、手動でチェック状態を変えるために使われます。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-149">
<div><b>
<p><b>■イベントハンドラーの記述</b></p>
</b></div>
</div>
<hr />
<p>　RadioButtonコントロールの使い方が分かったところで、次はコードの記述です。コードの中心となるのはイベントハンドラーです。しかし、いきなりイベントハンドラーを書き始めるのは無理なので、イラスト<span>4</span>-<span>6</span>でおおまかな処理のイメージを確認し、どのような変数が必要になるかをあらかじめ洗い出しておきましょう。それだけでずいぶん見通しがよくなります。</p>
<p><br /></p>
<div>
<p><img src="images/00311.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　RadioButtonを使ったり、条件によって場合分けをしたりはするものの、結局のところ求めたいものは販売価格です。したがって、販売価格を表す変数をまず宣言しておく必要があります。販売価格は極端に大きな数値にはならないのでInteger型を使いましょう。</p>
<div>
<pre lang="en"><code>Dim SalesPrice As Integer</code></pre></div>
<p>　販売価格を求めるために利用できる値は、もちろん標準価格です。このプログラムでは標準価格を<span>3</span>,600円と決めているので、定数として宣言すればいいでしょう。</p>
<div>
<pre lang="en"><code>Const StandardPrice As Integer = 3600</code></pre></div>
<p>　割引の条件はRadioButtonコントロールの状態を調べれば分かるので、特に変数は必要なさそうです。また、割引率も販売価格を計算する式の中でリテラルとして書けばいいので、宣言は必要なさそうです。</p>
<p>　変数や定数を宣言するときには、スコープも重要になってきます。つまり、変数や定数をどこで使うかによって宣言の場所が変わるからです。そこで、変数や定数が使われるイベントハンドラーを洗い出してみましょう。プログラムの実行や操作の流れにそって、それぞれのコントロールについて考えてみると、表<span>4</span>-<span>2</span>のような<span>3</span>つのイベントハンドラーが必要であると分かります。</p>
<p><br /></p>
<div>
<p><img src="images/00168.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><span>（注）フォームのLoadイベントハンドラーはフォームがはじめて表示される直前に呼び出され、RadioButtonのCheckedChangedイベントハンドラーは、RadioButtonがクリックされチェック状態が変わったときに呼び出されます。</span></p>
<p><br /></p>
<p>　注意すべき点は複数のイベントハンドラーで使われる変数や定数です。表を見ると、標準価格（StandardPrice）が複数の場所で使われることが分かります。フォームのLoadイベントハンドラーとRadioButtonのCheckedChangedイベントハンドラーです。このような変数や定数はモジュールレベルで宣言する必要があります。プロシージャレベルで宣言すると、複数のイベントハンドラーで共通に使うことができません。</p>
<p>　一方、販売価格（SalesPrice）はRadioButtonコントロールのCheckedChangedイベントハンドラーでしか使われないということが分かります。したがって、販売価格はプロシージャレベルで宣言します。</p>
<p>　以上で、必要な変数と変数のスコープ、イベントハンドラーが洗い出せました。では、イベントハンドラーの内容を見てみましょう。</p>
<p><br /></p>
<div><b>
<p><b>■フォームのLoadイベントハンドラー</b></p>
</b></div>
<p>　フォームがはじめて表示される直前に実行したいことは、フォームのLoadイベントハンドラーに書きます。画面<span>4</span>-<span>3</span>のようにしてイベントハンドラーを追加しましょう。イベントハンドラーの名前はInitProcとします。</p>
<p><br /></p>
<div>
<p><img src="images/00198.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　フォームをクリックして選択する</p>
</div>
<div>
<p>❷　［イベント］ボタン（<img src="images/000174.gif" alt="" />）をクリックする</p>
</div>
<div>
<p>❸　［Load］の右に「InitProc」と入力する</p>
</div>
<div>
<p><br /></p>
</div>
<p>　入力するコードは以下のとおりです。イベントハンドラーの前に、モジュールレベルの定数として標準価格（StandardPrice）を宣言していることに注意してください（LIST<span>4</span>-<span>16</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>4</span>-<span>16</span>　モジュールレベルの定数の宣言とフォームのLoadイベントハンドラー</p>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Const StandardPrice As Integer = 3600	' 標準価格は3600円</code></pre>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles MyBase.Load</code></pre>
<pre lang="en"><code>        lblStandardPrice.Text = StandardPrice.ToString("#,##0円")</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　このイベントハンドラーの処理はStandardPriceの値をlblStandardPriceコントロールに表示するだけです。ただし、StandardPriceはInteger型なので、lblStandardPriceコントロールのTextプロパティに代入するためにはToStringメソッドを使って文字列に変換しておく必要があります。</p>
<p>　コードを見ると、ToStringメソッドの引数として「"#,##<span>0</span>円"」が指定されていることが分かります。これは文字列に変換するときに適用される書式です。これまで見てきたToStringメソッドは数値を文字列にそのまま変換するだけでしたが、ToStringメソッドには書式を指定して文字列に変換する便利な機能があるのです。</p>
<p>　<span><b>書式指定文字</b></span>は桁数や数字の表示方法を示すもので、「#」や「<span>0</span>」はその桁位置に数字を出力することを示します。ただし「#」を書いた場合は、元の数値が桁数に満たないときには何も出力しません。「<span>0</span>」を書いた場合は、元の数値が桁数に満たないときには「<span>0</span>」を出力します（図<span>4</span>-<span>18</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00185.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p id="calibre_link-15">　また、「,」（カンマ）は桁区切りを示します。桁数が「,」の位置を超えたときには途中に「,」を挿入します（図<span>4</span>-<span>19</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00139.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　書式指定文字以外の文字はそのまま出力されます。したがって、LIST<span>4</span>-<span>16</span>の例の「円」はそのまま出力されます（図<span>4</span>-<span>20</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00191.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>標準の数値書式指定子を利用するには</b></p>
</b></div>
<div>
<p>　ここで紹介した書式指定文字はカスタム数値書式指定文字列と呼ばれるものです。標準の数値書式指定文字列を使うと、よく使われる書式を簡単に指定できます。標準の数値書式指定文字列はデータの種類を表す文字と精度の組み合わせで指定します。例えば、<span>10</span>進数は「D」で表されるので、"D<span>5</span>"と書けば<span>10</span>進数<span>5</span>桁で出力するという意味になります。また、小数点付きの数値は「F」で表されるので、"F<span>3</span>"は小数点以下<span>3</span>桁を出力するという意味になります。例えば、1234.ToString("D<span>5</span>")の結果は"01234"となります。</p>
</div>
</div>
<p><br /></p>
<div><b>
<p><b>■RadioButtonコントロールのイベントハンドラー</b></p>
</b></div>
<div>
<p>　RadioButtonコントロールは<span>3</span>つありますが、別々にイベントハンドラーを書くのではなく、同じイベントハンドラーで処理を実行できるようにしましょう。まず、rbNoneコントロールのCheckedChangedイベントハンドラーを追加してください。イベントハンドラーの追加方法は画面を出して説明しなくてももう大丈夫ですね。［フォームデザイナー］でrbNoneコントロールを選択し、［プロパティ］ウィンドウの［イベント］ボタン（<img src="images/000174.gif" alt="" />）をクリックします。［CheckedChanged］の右にイベントハンドラーの名前を入力するとLIST<span>4</span>-<span>17</span>のようなコードが表示されます。ここでは、イベントハンドラーの名前をRecalcとしました。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>4</span>-<span>17</span>　rbNoneコントロールのCheckedChangedイベントハンドラー</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub Recalc(sender As Object, e As EventArgs) Handles</code></pre>
<pre lang="en"><code>rbNone.CheckedChanged</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　次に、rbStudentコントロールのイベントハンドラーを追加するのですが、［プロパティ］ウィンドウのCheckedChangedの欄に新しいイベントハンドラー名を入力するのではなく、すでに作成したRecalcプロシージャを選択します（画面<span>4</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00180.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><span><b>❶</b></span>　rbStudentコントロールをクリックして選択する</p>
</div>
<div>
<p>❷　［イベント］ボタン（<span><img src="images/000174.gif" alt="" /></span>）をクリックする</p>
</div>
<div>
<p>❸　［CheckedChanged］をクリックする</p>
</div>
<div>
<p>❹　［∨］をクリックする</p>
</div>
<div>
<p><span><b>⑤</b></span>　すでに作成されているイベントハンドラーの一覧が表示される</p>
</div>
<div>
<p><span><b>❻</b></span>　［Recalc］をクリックする</p>
</div>
<p><br /></p>
<p>　すると、コードはLIST<span>4</span>-<span>18</span>のように変わります。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>4</span>-<span>18</span>　イベントハンドラーを共有する</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub Recalc(sender As Object, e As EventArgs) Handles</code></pre>
<pre lang="en"><code>rbNone.CheckedChanged, rbStudent.CheckedChanged</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　これで、rbNoneコントロールのCheckedChangedイベントハンドラーもrbStudentコントロールのCheckedChangedイベントハンドラーも同じRecalcというプロシージャになり、いずれのイベントが起こってもRecalcプロシージャで処理されることになります。</p>
<p>　同様にしてrbHolderコントロールのイベントハンドラーにもRecalcプロシージャを指定しましょう。コードは以下のようになります（LIST<span>4</span>-<span>19</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>4</span>-<span>19</span>　すべてのRadioButtonコントロールで、CheckedChangedイベントハンドラーを共有した</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub Recalc(sender As Object, e As EventArgs) Handles</code></pre>
<pre lang="en"><code>rbNone.CheckedChanged, rbStudent.CheckedChanged,</code></pre>
<pre lang="en"><code>rbHolder.CheckedChanged</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>イベントハンドラーの共有を直接コードに書くには</b></p>
</b></div>
<div>
<p>　プロパティウィンドウのイベント一覧で共有したいイベントハンドラーを選択せず、LIST<span>4</span>-<span>19</span>のように、SubプロシージャのHandlesの後に複数の「コントロール名.イベント名」を「,」（カンマ）で区切って直接書いても構いません。</p>
</div>
</div>
<p><br /></p>
<p>　イベントハンドラーの中身は、RadioButtonの状態を調べ、割引を適用した販売価格を求めるだけです。RadioButtonの状態によって計算の方法が変わるので、条件分岐のIfステートメントを使えばいいでしょう。まず、日本語の擬似コードを書いて、流れを確認しておきましょう。</p>
<div>
<pre lang="en"><code>もし「割引なし」がチェックされていれば</code></pre>
<pre lang="en"><code>　　販売価格に標準価格を代入する</code></pre>
<pre lang="en"><code>そうでなければ</code></pre>
<pre lang="en"><code>　　もし「学生割引」がチェックされていれば</code></pre>
<pre lang="en"><code>　　　　販売価格に標準価格×0.9を代入する</code></pre>
<pre lang="en"><code>　　そうでなければ</code></pre>
<pre lang="en"><code>　　　　販売価格に標準価格×0.85を代入する</code></pre></div>
<p><br /></p>
<p>　多分岐のIfステートメントであることはすぐに分かります。また、「そうでなければ」「もし」と続いているので、ElseIfを使えば簡潔に書けることも分かります。注意すべき点は「株主優待」がチェックされているかどうかを調べずに、最後の「そうでなければ」の後に書いてあることです。これは、<span>3</span>つのRadioButtonコントロールが<span>1</span>つのグループになっているからです。「割引なし」も「学生割引」もチェックされていなければ、必ず「株主優待」がチェックされているはずです。</p>
<p>　では、最初に洗い出した変数SalesPriceを宣言してからIfステートメントを書いてみましょう。RadioButtonコントロールがチェックされていればCheckedプロパティの値がTrueとなっており、チェックされていなければFalseとなっているので、それを利用して条件を書きます。なお、販売価格は小数点以下を切り下げて求めることとします。小数点以下の切り下げにはMath.FloorメソッドかInt関数が使えますが、ここではInt関数を使ってみます（LIST<span>4</span>-<span>20</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>4</span>-<span>20</span>　割引価格を計算するためのコード（全体）</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub Recalc(sender As Object, e As EventArgs) Handles</code></pre>
<pre lang="en"><code>rbNone.CheckedChanged, rbStudent.CheckedChanged,</code></pre>
<pre lang="en"><code>rbHolder.CheckedChanged</code></pre>
<pre lang="en"><code>        Dim SalesPrice As Integer</code></pre>
<pre lang="en"><code>        If rbNone.Checked Then</code></pre>
<pre lang="en"><code>            SalesPrice = StandardPrice</code></pre>
<pre lang="en"><code>        ElseIf rbStudent.Checked Then</code></pre>
<pre lang="en"><code>            SalesPrice = CInt(Int(StandardPrice * 0.9))</code></pre>
<pre lang="en"><code>        Else</code></pre>
<pre lang="en"><code>            SalesPrice = CInt(Int(StandardPrice * 0.85))</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>        lblSalesPrice.Text = SalesPrice.ToString("#,##0円")</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>CheckedChangedイベントハンドラーが実行されるタイミング</b></p>
</b></div>
<div>
<p>　フォームが表示される直前にもRadioButtonコントロールのチェック状態が設定されます。したがって、このイベントハンドラーは最初に<span>1</span>回実行されます。フォームのLoadイベントハンドラーで販売価格を計算していないにもかかわらず、プログラムを実行すると販売価格が表示されるのはそのためです。</p>
</div>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>チェックが外れたときにもCheckedChangedイベントハンドラーは実行される</b></p>
</b></div>
<div>
<p>　LIST<span>4</span>-<span>20</span>のコードでは、RadioButtonコントロールをクリックしてチェックされた状態を変えると、イベントハンドラーが<span>2</span>回実行されてしまいます。例えば、rbNoneコントロールがチェックされた状態のときにrbStudentコントロールをクリックすると、まず、rbNoneコントロールのチェックが外れるので、このイベントハンドラーが実行されます。次にrbStudentコントロールがチェックされた状態になるので、またこのイベントハンドラーが実行されます。このプログラムでは、同じ計算を<span>2</span>回実行するだけなので正しい結果が得られますが、値を加算する処理やメッセージボックスを表示する処理がある場合には、値を余計に加算してしまったり、メッセージボックスが余計に表示されたりするので、注意が必要です。</p>
</div>
</div>
<p><br /></p>
<div><b>
<p><b>■btnExitのイベントハンドラー</b></p>
</b></div>
<p>　［終了（X）］ボタン（btnExit）のClickイベントハンドラーは簡単です。プログラムを終了させるコードを書いておいてください（LIST<span>4</span>-<span>21</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>4</span>-<span>21</span>　プログラムを終了させるためのコード</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs) Handles</code></pre>
<pre lang="en"><code>btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-150">
<div><b>
<p><b>■プログラムを実行する</b></p>
</b></div>
</div>
<hr />
<p>　コードがすべて入力できたら［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックして、プログラムを実行します。RadioButtonコントロールをクリックし、チェック状態を変えると販売価格が変わります（画面<span>4</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00067.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><span><b>❶</b></span>　［学生割引（T）］をクリックする</p>
</div>
<div>
<p>②　標準価格の<span>1</span>割引の価格が表示される</p>
</div>
<p><br /></p>
<p>　このプログラムでは、多分岐のIfステートメントを使いました。Select Caseステートメントのほうが簡潔に書けるのでは、と思った人もいるかもしれませんが、テストする式が<span>1</span>つではなく、それぞれのRadioButtonコントロールのCheckedプロパティなのでSelect Caseステートメントは使えません。疑問に思った人は、Ifステートメントの書き方とSelect Caseステートメントの書き方をもう一度見比べておいてください（P143、150）。</p>
</div>
</div>
<div id="calibre_link-335">
<div>
<div><b>
<p><b>Chapter<span><b>4</b></span>のまとめ</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　条件により異なる処理をするにはIfステートメントが使えます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　And演算子やOr演算子を利用すると、条件を組み合わせることができます。And演算子は「かつ」という意味になり、Or演算子は「または」という意味になります</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　And演算子やOr演算子の代わりに、処理効率のよいAndAlso演算子やOrElse演算子を使うこともできます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Ifステートメントの中に、さらにIfステートメントを書くことを「入れ子」または「ネスト」といい、複雑な条件分岐も実現できます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Select Caseステートメントを利用すると、指定した式の値によって処理をいくつかに分岐させることができます</b></p>
</b></div>
</div>
</div>
<div id="calibre_link-52">
<div>
<div id="calibre_link-151">
<div><b>
<p><b>練習問題</b></p>
</b></div>
</div>
<p><br /></p>
<div>
<p><span><b>［A］</b></span>　サンプルプログラムを拡張し、標準価格を<span>3</span>,600円に固定せず、TextBoxコントロールに入力して計算できるようにしてください。プロジェクト名はCalcPrice<span>2</span>とします。実行結果は以下の画面のようになればいいでしょう。なお、RadioButtonのチェック状態が変わったときではなく［計算（C）］ボタンがクリックされたときに販売価格を計算し直すようにしてください。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00341.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><span><b>［B］</b></span>　<a href="#calibre_link-53"><u>P.151</u></a>のLIST<span>4</span>-<span>15</span>を参考にして、入力された得点により評価を表示するプログラムを作成してください。プロジェクト名はShowGradeとし、フォームのデザインは自由とします。</p>
</div>
</div>
</div>
<div id="calibre_link-319">
<div>
<div id="calibre_link-152">
<div><b>
<p><b>Chapter<span><b>5</b></span></b></p>
</b></div>
</div>
<p><br /></p>
<div><b>
<p><b>処理を繰り返す</b></p>
</b></div>
<hr />
<div>
<p>私たち人間は単調な作業を繰り返すとすぐに飽きが来てしまいます。しかし、コンピューターは何千回、何万回であっても、文句<span>1</span>つ言わずに単調な作業を繰り返し実行してくれます。そこがコンピューターの面目躍如たるところといってもいいでしょう。この章では繰り返し処理の方法を学び、データを集計したり、検索したりするための基礎を身に付けます。</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><span><b>5</b></span>.<span><b>1</b></span>　繰り返し処理の考え方</b></p>
</b></div>
<div>
<p>後判断型の繰り返し処理／前判断型の繰り返し処理／Until型の繰り返し処理とWhile型の繰り返し処理</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>5</b></span>.<span><b>2</b></span>　Do...Loopステートメントを利用した繰り返し処理</b></p>
</b></div>
<div>
<p>条件が満たされるまで処理を繰り返す（後判断－Until型）／条件が満たされている間処理を繰り返す（後判断－While型）／条件が満たされるまで処理を繰り返す（前判断－Until型）／条件が満たされている間処理を繰り返す（前判断－While型）／前判断型の繰り返し処理がよく使われる例</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>5</b></span>.<span><b>3</b></span>　For...Nextステートメントを利用した繰り返し処理</b></p>
</b></div>
<div>
<p>初期値、終了値、増分値を指定して処理を繰り返す</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>5</b></span>.<span><b>4</b></span>　For Each...Nextステートメントを利用した繰り返し処理</b></p>
</b></div>
<div>
<p>コレクションの要素を繰り返し処理する</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>5</b></span>.<span><b>5</b></span>　繰り返し処理を途中で抜ける</b></p>
</b></div>
<div>
<p>Do ... Loopステートメントを途中で抜ける〜Exit Doステートメント／For...Next／For Each...Nextステートメントを途中で抜ける〜Exit Forステートメント</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>5</b></span>.<span><b>6</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
<div>
<p>最高点を求めるプログラム／フォームのデザイン／イベントハンドラーの記述／プログラムを実行する</p>
</div>
</div>
</div>
<div id="calibre_link-7">
<div>
<div><b>
<p><b>これから学ぶこと</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　Do ... Loopステートメントの使い方を学び、条件が成立するまで（または成立する間）繰り返し処理を実行します</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　For ... Nextステートメントの使い方を学び、一定の回数の繰り返し処理を実行します</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　For Each ... Nextステートメントの使い方を学び、コレクションの要素をすべて処理します</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　繰り返し処理を途中で抜け出す方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　この章で学んだことがらを利用してプログラムを作成します</b></p>
</b></div>
<p><br /></p>
<div>
<p><img src="images/00298.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>　この章では繰り返し処理を実行する方法を学び、集計や検索のための基礎を身に付けます。繰り返し処理には、条件を満たすまで繰り返す、条件を満たす間繰り返す、一定の回数繰り返す、などいくつかのパターンがあり、実行したい処理の特徴に合わせて使い分けることができます。この章の最後ではいくつかのデータをすべて調べ、その中から最大の値を求めるプログラムを作成します。</p>
</div>
</div>
</div>
<div id="calibre_link-49">
<div>
<div id="calibre_link-153">
<div><b>
<p><b>　<span><b>5</b></span>.<span><b>1</b></span>　繰り返し処理の考え方</b></p>
</b></div>
</div>
<p><br /></p>
<p>　これまでの章で取り扱ってきた演算や条件分岐のプログラムを見て、これなら電卓でやったほうが早いという感想を持った人もいるでしょう。実際、簡単な計算ならそれで十分対処できます。しかし、何十回、何百回と同じ計算をするとなるとコンピューターでなければほとんど不可能です。このように、同じ処理を何度も実行することを<span><b>繰り返し処理</b></span>といいます。</p>
<p>　ただし、「同じ処理」といっても、まったく同じことを繰り返すわけではなく、やり方が同じことを何度も繰り返すということです。例えば、繰り返し処理の中で使われる変数の値は毎回違うのが普通です。何人かの身長のデータを処理する場合、全員の身長が同じということはありえません。身長を表す変数の値は毎回違っているはずです（イラスト<span>5</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00350.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　また、「何度も実行する」といっても、普通は無限に繰り返し処理を実行し続けるわけではありません。何らかの条件にあてはまったら繰り返しを終了しなくてはなりません。例えば、100人分のデータを処理するなら、処理を100回実行したら繰り返しを終了しなければなりません（イラスト<span>5</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00313.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　決まった回数だけ繰り返し処理を実行するには、繰り返しの回数を数えておく必要があります。そのためには、繰り返しの回数を記憶しておくための変数が必要になります。変数の値が繰り返し処理を続けるか終了させるかを決める条件になるというわけです。</p>
<p>　繰り返し処理を終了させる条件は回数だけではありません。変数の値が特定の値になるまで繰り返すことも考えられます。また、データがなくなるまで処理をすることもあるでしょう。いずれにしても繰り返し処理を理解するためのポイントは、どういう条件で繰り返しを終了させるかということです。</p>
<p>　終了をどのようなタイミングで判定するかによって、繰り返し処理には<span><b>後判断型</b></span>と<span><b>前判断型</b></span>があります。では、比較的理解しやすい後判断型から見ていきます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-154">
<div><b>
<p><b>■後判断型の繰り返し処理</b></p>
</b></div>
</div>
<hr />
<p>　具体的な例として、<span>3</span>人の点数の平均値を求める処理を例に考えてみます。考え方は<span>10</span>人でも100人でも同じですが、繰り返し処理の内容を逐一追いかけて見るために<span>3</span>人だけにします。</p>
<p>　基本に忠実に進めましょう。処理の内容を考える前に、変数として必要なものを洗い出しておきます。まず、結果として欲しいものからです。平均値を求めるわけですから、平均値を記憶しておくための変数が必要です。次に、結果を求めるために利用できる値を考えます。平均値は合計点<span>÷</span>人数で求められるので、合計点と人数も必要になります。この例では人数は<span>3</span>人と分かっていますが、分からない場合には繰り返しの回数を数えていくと最後に人数が求められるはずです。いずれにしても繰り返しの回数を記憶しておくための変数も必要になります。</p>
<p>　では、処理を<span>1</span>ステップずつ順に書いてみます（図<span>5</span>-<span>1</span>）。<span>3</span>人の点数を<span>60</span>点、<span>72</span>点、<span>65</span>点としましょう。答えを先にいうのは反則ですが、平均点が<span>65</span>.<span>66</span>...になれば正解です。</p>
<p>　最初は、繰り返しの回数は<span>0</span>、合計点も<span>0</span>です。平均値はまだ求められません。</p>
<p><br /></p>
<div>
<p><img src="images/00291.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　合計点が求められれば、あとはそれを<span>3</span>で割って平均点を求めるだけです。この図を見ても分かるように、処理は上から下へと進みますが、<span>1</span>回目、<span>2</span>回目......と横方向に網掛けされている処理はすべて同じで「得点を加算→回数を加算→（終了条件の判定）」となっています。日本語で擬似コードを書くと以下のようになるでしょう。</p>
<div>
<pre lang="en"><code>※以下を繰り返す</code></pre>
<pre lang="en"><code>　合計点に得点を加算する</code></pre>
<pre lang="en"><code>　回数に1を加算する</code></pre>
<pre lang="en"><code>※に戻る。ただし、回数が3以上になれば終わり</code></pre></div>
<p>　Visual Basicでのコードも、ほぼこの形になります。コードの書き方については後で詳しく説明しますが、このような繰り返しを<span><b>後判断型</b></span>の繰り返し処理といいます。後判断型の繰り返し処理の場合、<span>1</span>回目の処理は必ず実行されることに注意が必要です。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-155">
<div><b>
<p><b>■前判断型の繰り返し処理</b></p>
</b></div>
</div>
<hr />
<p>　実際のプログラムでは、はじめから条件を満たしていれば処理をまったく実行しないこともあります。例えば「所持金が<span>10</span>,000円以下になるまで一定の金額を減らしていく」といった処理の場合、はじめから所持金が<span>10</span>,000円以下であれば、処理を実行する必要がありません。そのような場合、繰り返し処理は次のような流れになります。</p>
<div>
<pre lang="en"><code>※以下を繰り返す。ただし、所持金が10,000円以下になれば終わり</code></pre>
<pre lang="en"><code>　所持金から一定の額を減算する</code></pre>
<pre lang="en"><code>※に戻る</code></pre></div>
<p>　こちらは<span><b>前判断型</b></span>の繰り返し処理です。前判断型の繰り返し処理では、繰り返しの中の処理をまったく実行しないこともあります。なお、この場合は所持金がいくらであるかを調べればいいので、回数を数える必要はありません。</p>
<p>　平均点を求める例の場合は、必ず<span>1</span>回以上実行することが分かっているので、どちらの方法を使っても同じ結果が得られます。念のため、図<span>5</span>-<span>2</span>で、前判断型の繰り返し処理にしたときの流れを見ておきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00044.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　この場合も、処理は上から下へと進みますが、<span>1</span>回目、<span>2</span>回目......と横方向に網掛けされている処理はすべて同じで「（終了条件の判定）→得点を加算→回数を加算」となっています。</p>
<p>　この方法の利点は人数が<span>0</span>人の場合にも対処できるということです。合計が求められたら、あとは人数で割り算をして合計を求めるだけです。もちろん、人数が<span>0</span>人の場合、<span>0</span>で割り算をするとエラーになるので、平均値を求めるときにはそれに対処することも必要ですが、繰り返し処理そのものはうまくできます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-156">
<div><b>
<p><b>■Until型の繰り返し処理とWhile型の繰り返し処理</b></p>
</b></div>
</div>
<hr />
<p>　これまで、繰り返しを終了させるための条件を「<span>3</span>以上になれば終わり」のように書いてきましたが、「<span>3</span>未満である間繰り返す」と言い換えても同じことです。「〜になれば終わる」のほうはUntil型、「〜の間繰り返す」のほうはWhile型と呼びます。</p>
<p>　Until型では、条件が満たされていない間、繰り返しを実行します。そして、条件が満たされると繰り返しを終了します。一方のWhile型では、条件が満たされている間、繰り返しを実行します。そして、条件が満たされなくなると繰り返しを終了します。</p>
<p>　したがって、繰り返し処理には次に示すような<span>4</span>つのパターンがあることが分かります。</p>
<p><br /></p>
<div>
<p>■後判断−Until型</p>
</div>
<div>
<p>■後判断−While型</p>
</div>
<div>
<p>■前判断−Until型</p>
</div>
<div>
<p>■前判断−While型</p>
</div>
<p><br /></p>
<p>　次の節では、これらの<span>4</span>つの繰り返し処理についてコードの書き方を見ていきます。</p>
</div>
</div>
<div id="calibre_link-317">
<div>
<div id="calibre_link-157">
<div><b>
<p><b>　<span><b>5</b></span>.<span><b>2</b></span>　Do...Loopステートメントを利用した繰り返し処理</b></p>
</b></div>
</div>
<p><br /></p>
<p>　ここでは前節で説明した<span>4</span>つのパターンの繰り返し処理について、Do ... Loopステートメントの書き方を見ていきます。一般的な文法書では「前判断−While」型の繰り返しから書かれていることが多いのですが、はじめてプログラミングに取り組む人にとっては「後判断−Until」型から入るほうが分かりやすいと思われるので、それから見ていきます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-158">
<div><b>
<p><b>■条件が満たされるまで処理を繰り返す（後判断－Until型）</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> RepeatTest<span>1</span></p>
</div>
<hr />
<p>　はじめての繰り返し処理なので、簡単な例から見ていきます。実用性はほとんどありませんが、基本をしっかりと理解するために、次の例を考えてみましょう。</p>
<div>
<pre lang="en"><code>「Hello VB!」というメッセージを出力ウィンドウに5回表示する</code></pre></div>
<p>　この例では特に求めたい値はなく、メッセージを表示するだけです。ただし、回数を数える必要があるので、そのための変数が必要です。日本語で擬似コードを書いてみましょう。</p>
<div>
<pre lang="en"><code>※以下を繰り返す</code></pre>
<pre lang="en"><code>　メッセージを表示する</code></pre>
<pre lang="en"><code>　回数に1を加算する</code></pre>
<pre lang="en"><code>※に戻る。ただし、回数が5以上になれば終わり</code></pre></div>
<p>　実感が湧かないという人は、図<span>5</span>-<span>3</span>のフローチャートで処理の流れを確認してください。繰り返しの中でやらなければならないことは、メッセージを表示することと、回数を数える（<span>1</span>増やす）ことです。</p>
<p><br /></p>
<div>
<p><img src="images/00173.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　繰り返し処理はDo ... Loopステートメントを使って書きます。「繰り返す」にあたるキーワードが「Do」で、「戻る」にあたるキーワードが「Loop」です。「〜まで」は「Until」を使って表します。繰り返しの回数を記憶しておくための変数をiとすると、コードは以下のようになります（LIST<span>5</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>1</span>　メッセージを<span>5</span>回表示するためのコード（後判断−Until型）</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim i As Integer = 0　　　●───繰り返しを実行する前なので初期値を0としておく</code></pre>
<pre lang="en"><code>Do</code><code><code>　　　●───</code> DoからLoopの間のコードを繰り返し実行する</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>    i += 1</code><code><code>　　　●───</code> 繰り返しの回数を1増やす</code></pre>
<pre lang="en"><code>Loop Until i &gt;= 5</code><code><code>　　　●───</code> 繰り返しの回数が5以上になったら終わり</code></pre></div>
</div>
<p><br /></p>
<p>　このコードが実行されると、出力ウィンドウには画面<span>5</span>-<span>1</span>のように「Hello VB!」というメッセージが<span>5</span>回表示されます。</p>
<p><br /></p>
<div>
<p><img src="images/00231.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　では、後判断−Until型のDo ... Loopステートメントの書き方を見てみましょう（図<span>5</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00046.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Do...Loopの中に書くステートメントは複数でも構いません。Untilの後ろには条件を書きます。すでに読者のみなさんはIfステートメントのところで「条件」の正確な意味を学んだので、ここでも正確に表現しておきましょう。Untilの後ろに書くのはTrueまたはFalseを返す式です。その式の値がTrueになるまで繰り返しが実行される（Trueになると繰り返しが終了する）というわけです。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-159">
<div><b>
<p><b>■条件が満たされている間処理を繰り返す（後判断－While型）</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> RepeatTest<span>2</span></p>
</div>
<hr />
<p>　次に、「〜になるまで」ではなく「〜の間」繰り返すようなパターンも見ておきましょう。この場合はUntilの代わりにWhileを使います。違うところは、条件が成立したら繰り返しを終わるのではなく、条件が成立している間繰り返しを実行するという点だけです。したがって、条件を表す式の書き方が逆になります。前項の例と同じ処理をWhile型にした例を図<span>5</span>-<span>5</span>のフローチャートで確認し、その後コードを見てみましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00107.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　コードをUntil型の繰り返しと対比させて書いてみると次のようになります（LIST<span>5</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>2</span>　メッセージを<span>5</span>回表示するためのコード（後判断−Until型と後判断−While型を対比）</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim i As Integer = 0</code></pre>
<pre lang="en"><code>Do</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>    i += 1</code></pre>
<pre lang="en"><code>Loop Until i &gt;= 5</code></pre></div>
</div>
<pre lang="en"><code></code></pre>
<div>
<div>
<pre lang="en"><code>Dim i As Integer = 0</code></pre>
<pre lang="en"><code>Do</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>    i += 1</code></pre>
<pre lang="en"><code>Loop While i &lt; 5</code></pre></div>
</div>
<p><br /></p>
<p>　iの値が<span>5</span>以上になるまで繰り返すというのと、iの値が<span>5</span>未満の間繰り返すというのは同じです。どちらを使うかは、条件を表す式が自然に書けるかどうかで決めるといいでしょう。この程度の単純な例であればどちらでもさほど変わりませんが、複雑なプログラムになってくると、条件の表し方をどちらにするかで意味の分かりやすさがずいぶんと変わってくるものです。</p>
<p>　では、後判断−While型のDo ... Loopステートメントの書き方をまとめておきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00134.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　後判断型の繰り返し処理の場合、Until型であってもWhile型であっても、繰り返しの中身は少なくとも<span>1</span>回実行されるということに注意してください。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-160">
<div><b>
<p><b>■条件が満たされるまで処理を繰り返す（前判断－Until型）</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> RepeatTest<span>3</span></p>
</div>
<hr />
<p>　前判断型の繰り返し処理では、最初から終了の条件が成立していたら繰り返しの中身は<span>1</span>回も実行されません。これまでに見てきたものと同じ例で書き方を確認した後、前判断型を使うと便利な例を見てみます。これまでの例は、以下のようなものでした。</p>
<div>
<pre lang="en"><code>「Hello VB!」というメッセージを出力ウィンドウに5回表示する</code></pre></div>
<p>　日本語で擬似コードを書いてみると以下のようになります。</p>
<div>
<pre lang="en"><code>※以下を繰り返す。ただし、回数が5以上になれば終わり</code></pre>
<pre lang="en"><code>　メッセージを表示する</code></pre>
<pre lang="en"><code>　回数に1を加算する</code></pre>
<pre lang="en"><code>※に戻る</code></pre></div>
<p>　念のため、フローチャートも見ておきましょう（図<span>5</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00010.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　コードは以下のようになります（LIST<span>5</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>3</span>　メッセージを<span>5</span>回表示するためのコード（前判断−Until型）</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim i As Integer = 0　　　●─── 繰り返しを実行する前なので初期値を0としておく</code></pre>
<pre lang="en"><code>Do Until i &gt;= 5</code><code>　　　●───DoからLoopの間のコードを繰り返し実行する。繰り返しの回数が5以上になったら終わり</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>    i += 1</code><code><code>　　　●───</code>繰り返しの回数を1増やす</code></pre>
<pre lang="en"><code>Loop</code></pre></div>
</div>
<p><br /></p>
<p>　このコードが実行されると、やはり出力ウィンドウに「Hello VB!」というメッセージが<span>5</span>回表示されます。では、前判断−Until型の繰り返し処理の書き方です（図<span>5</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00229.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Do...Loopの中に書くステートメントは複数でも構いません。Untilの後には条件を書きます。正確にいうとUntilの後に書くものはTrueまたはFalseを返す式です。その式の値がTrueになるまで繰り返しが実行されます（Trueになると繰り返しが終了します）。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-161">
<div><b>
<p><b>■条件が満たされている間処理を繰り返す（前判断－While型）</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> RepeatTest<span>4</span></p>
</div>
<hr />
<p>　前判断−While型の繰り返し処理では、条件が成立している間、処理を繰り返します。前項の例と同じ処理をWhile型にした例を図<span>5</span>-<span>9</span>のフローチャートで確認し、コードを書いてみましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00095.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　書き方の違いは、Untilを使って「〜以上になるまで」と表す代わりに、Whileを使って「〜未満の間」と表していることだけです（LIST<span>5</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>4</span>　メッセージを<span>5</span>回表示するためのコード（前判断−Until型と前判断−While型を対比）</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim i As Integer = 0</code></pre>
<pre lang="en"><code>Do Until i &gt;= 5</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>    i += 1</code></pre>
<pre lang="en"><code>Loop</code></pre></div>
</div>
<pre lang="en"><code></code></pre>
<div>
<div>
<pre lang="en"><code>Dim i As Integer = 0</code></pre>
<pre lang="en"><code>Do While i &lt; 5</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>    i += 1</code></pre>
<pre lang="en"><code>Loop</code></pre></div>
</div>
<p><br /></p>
<p>　前判断−While型のDo ... Loopステートメントの書き方も確認しておきましょう（図<span>5</span>-<span>10</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00315.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p><span><img src="images/00279.jpeg" alt="" /></span>While ... End Whileステートメントも利用できる</p>
<div>
<p>　前判断－While型の繰り返し処理は、While ... End Whileというステートメントを使って書くこともできます。書き方は以下のとおりです。</p>
</div>
<div>
<pre lang="en"><code>While 条件</code></pre>
<pre lang="en"><code>    ステートメント（複数でも可）</code></pre>
<pre lang="en"><code>End While</code></pre></div>
<div>
<p>　この書き方では、条件が成立している間（条件を表す式がTrueである間）、中に書かれたステートメントを繰り返し実行します。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-162">
<div><b>
<p><b>■前判断型の繰り返し処理がよく使われる例</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> RepeatTest<span>5</span>, RepeatTest<span>6</span></p>
</div>
<hr />
<p>　前判断型の繰り返し処理は、データの件数がいくつあるか分からない場合に、データがなくなるまで処理をするといった場合によく使われます。データの件数が分からないということは、もしかすると処理すべきデータが<span>1</span>件もないかもしれないからです。これまでの例ではメッセージの表示回数は<span>5</span>回と決まっていましたが、この回数がランダムに決まるものとするとどうでしょう。例えば、<span>0</span>回〜<span>5</span>回までのいずれかに決まるものとします。<span>0</span>回の場合もありうるわけですから、前判断型の繰り返し処理にする必要があります。日本語で擬似コードを書いてみます。</p>
<div>
<pre lang="en"><code>0〜5までの乱数を作成する</code></pre>
<pre lang="en"><code>※以下を繰り返す。ただし、回数が乱数以上になれば終わり</code></pre>
<pre lang="en"><code>　メッセージを表示する</code></pre>
<pre lang="en"><code>　回数に1を加算する</code></pre>
<pre lang="en"><code>※に戻る</code></pre></div>
<p>　これまでに見たコードとほとんど同じですが、回数をランダムに決めるために乱数を作成する必要があります。乱数の作成にはRandomクラスのオブジェクトを使うのですが、ここで重要なことは繰り返し処理の理解なので、クラスの使い方についてはChapter<span>8</span>に譲ることとします。とりあえずは、乱数を作成するためのコードだけを示しておくので、理屈は抜きにしてこのまま書いておいてください。作成した乱数をLimitという変数に入れることにすれば以下のようになります（図<span>5</span>-<span>11</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00223.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<p>　繰り返し処理の終了回数はいままでは<span>5</span>となっていましたが、ここではLimitに入っています。Nextメソッドの結果は実行するたびに異なるので、Limitの値も毎回異なるものになります。これまでのコードに乱数を作成するコードを追加すればLIST<span>5</span>-<span>5</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>5</span>　メッセージを<span>0</span>回〜<span>5</span>回のいずれかの回数だけ表示するコード</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim i As Integer = 0			' 現在の回数</code></pre>
<pre lang="en"><code>Dim Limit As Integer			' 終了回数</code></pre>
<pre lang="en"><code>Dim r As Random = New Random()	' 乱数オブジェクトを作成する</code></pre>
<pre lang="en"><code>Limit = r.Next(0, 6)			' 0以上6未満の乱数を求める</code></pre>
<pre lang="en"><code>Do Until i &gt;= Limit			' 現在の回数が終了回数以上になるまで</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>    i += 1</code></pre>
<pre lang="en"><code>Loop</code></pre></div>
</div>
<p><br /></p>
<p>　重要なのは繰り返しの終了回数がLimitに入っていて、その値が<span>0</span>から<span>5</span>のいずれかだということです。Limitの値が<span>0</span>であれば、i &gt;= Limitという条件が成り立っているので、<span>1</span>回も繰り返しを実行せずに終わります。しかし、これを後判断型で以下のように書くと、Limitの値が<span>0</span>であっても、繰り返しが<span>1</span>回実行され、その後、繰り返しを終了することになってしまいます。</p>
<div>
<pre lang="en"><code>Do</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>    i += 1</code></pre>
<pre lang="en"><code>Loop Until i &gt;= Limit	' 現在の回数が終了回数以上になるまで</code></pre></div>
<p>　もう<span>1</span>つ例を示しておきましょう。少し発展的な話になりますが、ファイルからデータを読み込む場合にも前判断型の繰り返し処理をよく使います。例えば<span>1</span>行ずつデータを読み込んでいく場合、どこでデータがなくなるか分かりません。もしかするとデータが<span>1</span>行もないかもしれません。そういう場合も前判断型の繰り返し処理にする必要があります。素直に流れを書くと図<span>5</span>-<span>12</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00065.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　同じ方法で処理が繰り返されるので、Do ... Loopステートメントが使えそうです。しかし、Do ... Loopステートメントでは、終了のための条件は最初か最後に書かないといけないので、上のようにまとめると、うまくパターンにあてはまりません。終了のための条件が繰り返し処理の途中に出てくるからです。</p>
<p>　このような場合には、最初の「ファイルから<span>1</span>行読み込む」を特別扱いにして、図<span>5</span>-<span>13</span>のように終了のための条件が最初に来るようにまとめます。</p>
<p><br /></p>
<div>
<p><img src="images/00290.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　日本語の擬似コードで表すと次のようになるでしょう。</p>
<div>
<pre lang="en"><code>ファイルから1行読み込む</code></pre>
<pre lang="en"><code>※以下を繰り返す　ただし、データがある間</code></pre>
<pre lang="en"><code>　実行したい処理</code></pre>
<pre lang="en"><code>　ファイルから1行読み込む</code></pre>
<pre lang="en"><code>※に戻る</code></pre></div>
<p>　最初の読み込みだけを特別扱いしたので、「ファイルから<span>1</span>行読み込む」という処理が<span>2</span>回出てきますが、これはデータがなくなるまで処理をするときによく使われるパターンです。LIST<span>5</span>-<span>6</span>に、sample.txtという名前のファイルの行をすべて読み込んで、出力ウィンドウに表示するコードも書いておきます。この時点では、ファイル処理について理解している必要はないので、参考程度に眺めておいてください（ファイル処理についてはChapter<span>9</span>で詳しく説明します）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>6</span>　ファイルの行をすべて読み出して出力ウィンドウに表示する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim OneLine As String</code></pre>
<pre lang="en"><code>Dim sr As System.IO.StreamReader</code></pre>
<pre lang="en"><code>' ファイルを開く</code></pre>
<pre lang="en"><code>sr = My.Computer.FileSystem.OpenTextFileReader("sample.txt",System</code></pre>
<pre lang="en"><code>.Text.Encoding.GetEncoding("shift_jis"))</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>OneLine = sr.ReadLine()		' 1行読み込む</code></pre>
<pre lang="en"><code>Do While OneLine IsNot Nothing	' 読み出した行がNothingでない間</code></pre>
<pre lang="en"><code>    Debug.WriteLine(OneLine)		   ' 出力ウィンドウに表示</code></pre>
<pre lang="en"><code>    OneLine = sr.ReadLine()		   ' 1行読み込む</code></pre>
<pre lang="en"><code>Loop</code></pre>
<pre lang="en"><code>sr.Close()</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-163">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）　後判断型のDo ... Loopステートメントでは、繰り返し処理の中のステートメントが<span>1</span>回も実行されないことがある</p>
</div>
<div>
<p>（  ）　Do ... Loopステートメントの終了条件にあたる部分には、結果がTrueかFalseになる式を書く</p>
</div>
<div>
<p>（  ）　Do ... Loopステートメントの終了条件として「While x &lt;<span>10</span>」と書くと、xが<span>10</span>未満の間、繰り返しが実行される</p>
</div>
<div>
<p>（  ）　Do ... Loopステートメントの終了条件として「While x &lt;<span>10</span>」と書く代わりに「Until x &gt;<span>10</span>」と書いても同じ繰り返し処理ができる</p>
</div>
<p><br /></p>
<p><span><b><span><b>2</b></span>.</b></span>　説明に従って以下の空欄を埋め、Do ... Loopステートメントを完成させてください。</p>
<p><br /></p>
<div>
<pre lang="en"><code>（1）	Dim x, y As Double</code></pre>
<pre lang="en"><code>	x = 0</code></pre>
<pre lang="en"><code>	Do（　　）  x &gt;= 3.14　　　●───xの値が3.14以上になるまで繰り返す</code></pre>
<pre lang="en"><code>	    y = Math.Sin(x)</code><code><code>　　　●───</code>sin(x)の値を求める</code></pre>
<pre lang="en"><code>	    Debug.WriteLine(y.ToString("F3"))</code><code><code><code>　　　●───</code></code>小数点以下3桁で出力ウィンドウに表示する</code></pre>
<pre lang="en"><code>	    x（　　）0.1</code><code><code>　　　●───</code>xの値を0.1加算する</code></pre>
<pre lang="en"><code>	Loop</code></pre></div>
<p><br /></p>
<p><span><b>備考</b></span>　Math.Sinはラジアン単位で指定された値のsin（正弦値）を求めるメソッドです。</p>
<div>
<p><br /></p>
</div>
<div>
<pre lang="en"><code>（2）	Dim Total As Integer = 0</code></pre>
<pre lang="en"><code>	Dim n As Integer</code></pre>
<pre lang="en"><code>	Do</code></pre>
<pre lang="en"><code>	    Total += n</code><code><code><code>　　　●───</code></code> Totalにnの値を加算する</code></pre>
<pre lang="en"><code>	    n += 1</code><code><code><code>　　　●───</code></code> nの値を1加算する</code></pre>
<pre lang="en"><code>	Loop （　　） n</code><code><code> （　　）</code>100</code><code><code><code>　　　●───</code></code>nが100未満である間繰り返す</code></pre>
<pre lang="en"><code>	MessageBox.Show(Total.ToString())</code><code><code><code><code>　　　●───</code></code></code>0から99までをすべて足した値をメッセージボックスに表示する</code></pre></div>
</div>
</div>
<div id="calibre_link-5">
<div>
<div id="calibre_link-164">
<div><b>
<p><b>　<span><b>5</b></span>.<span><b>3</b></span>　For...Nextステートメントを利用した繰り返し処理</b></p>
</b></div>
</div>
<p><br /></p>
<p>　前節で見たDo ... Loopステートメントは一般的な繰り返し処理に使われるステートメントです。条件さえ正しく指定すれば、どんな繰り返し処理でもできます。しかし、それだけに記述が冗長になる場合もあります。For ... Nextステートメントは、一定の回数だけ繰り返したり、変数が特定の値になるまで繰り返すのに適したステートメントで、Do ... Loopステートメントよりも簡潔な書き方ができます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-165">
<div><b>
<p><b>■初期値、終了値、増分値を指定して処理を繰り返す</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> ForTest</p>
</div>
<hr />
<p>　Do ... Loopステートメントの書き方で見た前判断型の繰り返しは、以下のようなコードでした（LIST<span>5</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>7</span>　Do ... Whileステートメントを使ってメッセージを<span>5</span>回表示する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim i As Integer = 0</code></pre>
<pre lang="en"><code>Do While i &lt; 5</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>    i += 1</code></pre>
<pre lang="en"><code>Loop</code></pre></div>
</div>
<p><br /></p>
<p>　このコードは出力ウィンドウに「Hello VB!」というメッセージを<span>5</span>回表示するものですが、よく見ると、iという変数が<span>3</span>箇所に出てきているので、ずいぶんと冗長な感じがします。<span>1</span>行目では初期値を代入し、<span>2</span>行目では繰り返しの終了判定にiを使っています。そして<span>4</span>行目ではiの値を増やしています。</p>
<p>　このような繰り返し処理では、iの初期値、終了値、増分値さえ指定すれば、繰り返しの方法が決まります。しかし、それらをバラバラな位置に書くとコードが読みづらくなってしまいます。上記の例であれば、それほど苦労もせずに理解はできると思いますが、繰り返しの中身が<span>10</span>行、<span>20</span>行と増えていけば、iの値をどこでどう増やしているのか、分からなくなることもあります。</p>
<p>　そこで、For ... Nextステートメントの登場です。このステートメントでは、ある変数の初期値、終了値、増分値で決まるような繰り返しが簡潔に書けます。さきほどのコードを書き換えてみましょう（LIST<span>5</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>8</span>　For ... Nextステートメントを使ってメッセージを<span>5</span>回表示する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim i As Integer</code></pre>
<pre lang="en"><code>For i =0 To 4 Step 1</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>Next i</code></pre></div>
</div>
<p><br /></p>
<p>　変数の宣言は別として、変数iを使って繰り返しを制御するコードは<span>1</span>箇所にまとめて書かれています。これならiの値が<span>0</span>から<span>4</span>になるまで<span>1</span>ずつ増やしながら繰り返すということが一目で分かります（<span>5</span>回の繰り返しなので、<span>0</span>から<span>5</span>ではなく、<span>0</span>から<span>4</span>までとなります）。一般に、For ... Nextステートメントを使ってn回の繰り返しを実行したいときには、初期値を<span>0</span>、終了値をn-<span>1</span>、増分値を<span>1</span>とします。</p>
<p>　では、For ... Nextステートメントの書き方をまとめておきましょう（図<span>5</span>-<span>14</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00167.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　For ... Nextステートメントでは、変数に初期値を代入してから、繰り返しに入ります。終了の判定は前判断型で、終了値を超えたら繰り返しが終了します。繰り返しの中のステートメントは複数でも構いません。繰り返しの中のステートメントを実行した後には、毎回、変数に増分値を加算します。この流れをフローチャートで表すと図<span>5</span>-<span>15</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00031.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>変数の値を減らしながら繰り返し処理をするには</b></p>
</b></div>
<div>
<p>　増分値に負の値を指定したときは、図<span>5</span>-<span>15</span>のフローチャートの終了条件は「変数＜終了値」となります。つまり、変数の値が終了値よりも小さくなるまで繰り返しが実行されます。</p>
</div>
</div>
<div>
<div>
<p><br /></p>
</div>
</div>
<p>　For ... Nextステートメントでは、増分値が<span>1</span>の場合にはStep以降が省略できます。また、繰り返しの範囲を分かりやすくするため、Nextの後に変数名を書いておくこともできますが、必要がなければ省略しても構いません。したがって、LIST<span>5</span>-<span>8</span>のコードは以下のようにより簡潔に書くことができます（LIST<span>5</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>9</span>　増分値が<span>1</span>のときはStep以降が省略できる</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim i As Integer</code></pre>
<pre lang="en"><code>For i =0 To 4</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<div>
<div>
<p><br /></p>
</div>
</div>
<p>　さらに、変数名の後ろに「As データ型」を書いて、変数の宣言も済ませてしまうことができます。したがって、Do ... Whileステートメントの場合は<span>6</span>行だったコードが<span>3</span>行で書けます（LIST<span>5</span>-<span>10</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>10</span>　For ... Nextの中で繰り返しを制御する変数を宣言する</p>
</div>
<div>
<div>
<pre lang="en"><code>For i As Integer = 0 To 4</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>NextWriteLine</code></pre></div>
</div>
<div>
<div>
<p><br /></p>
</div>
</div>
<p>　ただし、この場合、iという変数はFor ... Nextの中でしか使えないことに注意してください。</p>
<div>
<div>
<pre lang="en"><code>○</code></pre>
<pre lang="en"><code>Dim i As Integer</code></pre>
<pre lang="en"><code>For i =0 To 4</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>Next</code></pre>
<pre lang="en"><code>Debug.WriteLine(i)　　　●───iの値は5</code></pre></div>
</div>
<pre lang="en"><code></code></pre>
<div>
<div>
<pre lang="en"><code>×</code></pre>
<pre lang="en"><code>For i As Integer = 0 To 4</code></pre>
<pre lang="en"><code>    Debug.WriteLine("Hello VB!")</code></pre>
<pre lang="en"><code>Next</code></pre>
<pre lang="en"><code>Debug.WriteLine(i)</code><code>　　　●───</code><code> For...</code><code>Nextの外で</code><code>iは使えない</code></pre>
<pre lang="en"><code></code></pre></div>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>増分値には小数も指定できる</b></p>
</b></div>
<div>
<p>　繰り返しの制御に使う変数は浮動小数点型でも構いません。Stepの後には小数も指定できます。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-166">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<div>
<p>（  ）　For ... Nextステートメントを使うと、決まった回数の繰り返し処理を簡潔に書くことができる</p>
</div>
<div>
<p>（  ）　For ... Nextステートメントでは、増分値を表すStep以降はどんな場合でも省略して構わない</p>
</div>
<div>
<p>（  ）　For ... Nextステートメントの中で変数を宣言すると、それ以降、その変数がどこでも使えるようになる</p>
<p><br /></p>
</div>
<p><span><b><span><b>2</b></span>.</b></span>　説明に従って以下の空欄を埋め、For ... Nextステートメントを完成させてください。</p>
<div>
<pre lang="en"><code>（1）	Dim x, y As Double</code></pre>
<pre lang="en"><code>	For x = 0 （　　） 3.14 （　　） 0.1</code><code><code></code><code>　　　●───</code><code></code>xの値を0から0.1ずつ増やしながら、3.14以上になるまで繰り返す</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>¥	    y = Math.Sin(x)</code><code><code></code><code>　　　●───</code><code></code> sin(x)の値を求める</code></pre>
<pre lang="en"><code>	    Debug.WriteLine(y.ToString("F3"))</code><code></code><code>　　　●───小数点以下3桁で出力ウィンドウに表示する</code><code></code></pre>
<pre lang="en"><code>	Loop</code></pre></div>
<p><br /></p>
<p><span><b>備考</b></span>　Math.Sinはラジアン単位で指定された値のsin（正弦値）を求めるメソッドです。</p>
<p><br /></p>
<div>
<pre lang="en"><code>（2）	Dim HitNumber, InputNumber As Integer</code><code><code>　　　●───</code>当たり番号と入力された番号</code></pre>
<pre lang="en"><code>	Dim r As Random = New Random()</code><code><code>　　　●───</code>Randomクラスのオブジェクトを作る</code></pre>
<pre lang="en"><code>	If Integer.TryParse(TextBox1.Text, InputNumber) = False OrElse _</code></pre>
<pre lang="en"><code>	    InputNumber &lt; 0 OrElse InputNumber &gt; 9 Then</code><code><code><code>　　　●───</code></code>TextBoxコントロールに0〜9までの数字が入力されているかどうかをチェックする</code></pre>
<pre lang="en"><code>		</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	    MessageBox.Show("0から9までの数字を入力してください")</code></pre>
<pre lang="en"><code>	    TextBox1.Focus()</code></pre>
<pre lang="en"><code>	    TextBox1.SelectAll()</code></pre>
<pre lang="en"><code>	Else    ' 正しく数字が入力されている場合</code></pre>
<pre lang="en"><code>	    For i As</code><code><code> （　　）</code> = 0 To</code><code><code>（　　）</code></code><code><code><code><code>　　　●───</code></code></code>3回繰り返す</code></pre>
<pre lang="en"><code>	        HitNumber = r.Next(0, 10)</code><code><code><code><code>　　　●───</code></code></code>0以上10未満の乱数を作る</code></pre>
<pre lang="en"><code>	        If HitNumber =</code><code><code>（　　）</code> Then	 </code><code><code><code><code>　　　●───</code></code></code>入力された数字と等しければ</code></pre>
<pre lang="en"><code>	            MessageBox.Show("当選です")</code></pre>
<pre lang="en"><code>	            Exit Sub</code><code><code><code><code>　　　●───</code></code></code>当選したのでその時点でプロシージャを抜ける</code></pre>
<pre lang="en"><code>	        End If</code></pre>
<pre lang="en"><code>	    Next</code></pre>
<pre lang="en"><code>	    MessageBox.Show("はずれです。残念でした")</code><code><code><code><code><code>　　　●───</code></code></code></code> 繰り返しの外にあるということは3つの乱数に一致せず、当選しなかったということ</code></pre>
<pre lang="en"><code>	End If</code></pre></div>
<p><br /></p>
<p><span><b>備考</b></span>　このコードは、TextBox<span>1</span>というテキストボックスに入力された数字が乱数で作られた当たり番号に一致するかどうかを調べるコードです。当たり番号は<span>3</span>回作られ、入力された数字と比較されます。</p>
</div>
</div>
<div id="calibre_link-37">
<div>
<div id="calibre_link-167">
<div><b>
<p><b>　<span><b>5</b></span>.<span><b>4</b></span>　For Each...Nextステートメントを利用した繰り返し処理</b></p>
</b></div>
</div>
<p><br /></p>
<p>　これまで見てきた繰り返し処理は、一般的な変数やステートメントを使った繰り返しでした。しかしVisual Basicでは変数だけでなく、さまざまなコントロールを取り扱います。そして、コントロールの中にはListBoxなど、複数の項目を含んでいるものもあります。それらの項目について繰り返し処理をするにはFor Each ... Nextステートメントが便利です。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-168">
<div><b>
<p><b>■コレクションの要素を繰り返し処理する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> ForEachTest</p>
</div>
<hr />
<p>　ListBoxコントロールの項目はItemsプロパティで参照できます。Itemsプロパティはリスト内の項目全体を表すもので、複数の要素が含まれているので<span><b>コレクション</b></span>（Collection）と呼ばれます。コレクションの個々の要素を取り扱うにはインデックスと呼ばれる番号を()内に書いて区別します。例えば、ListBox<span>1</span>という名前のListBoxコントロールがあり、その<span>3</span>番の要素であれば、</p>
<div>
<pre lang="en"><code>ListBox1.Items(3)</code></pre></div>
<p>と表すことができます。ただし、先頭の要素を<span>0</span>番と表すことに注意してください。ListBox<span>1</span>.Items(<span>3</span>)は先頭から数えると<span>4</span>番目になります（図<span>5</span>-<span>16</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00080.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　なお、ListBoxコントロールの各項目はObject型と呼ばれるデータ型です。Object型の場合、数値や文字列をはじめとするさまざまな型のデータを参照できます。とりあえずは「どんなデータでも入れられる」と考えておいて差し支えありません（実際にはデータへの参照が入れられます）。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>デザイン時にListBoxコントロールの項目を入力するには</b></p>
</b></div>
<div>
<p>　ListBoxコントロールに複数の項目を入れるには、フォームにListBoxコントロールを配置し、［プロパティ］ウィンドウの［Items］の欄の右端に表示されている［...］ボタンをクリックします。［文字列コレクションエディター］ダイアログボックスが表示されるので、そこで項目を入力します。</p>
</div>
</div>
<p><br /></p>
<p>　これまでの知識でListBoxコントロールの項目をすべて処理するには、For ... Nextステートメントを使って、インデックスに変数を指定するという方法が使えます。LIST<span>5</span>-<span>11</span>はListBoxコントロールの項目をすべて出力ウィンドウに表示するコードです。ListBoxコントロールの各項目はObject型ですが、P.<span>95</span>で説明したように、Debug.WriteLineメソッドに指定すれば自動的に文字列に変換されて出力されます。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>11</span>　For ... Nextステートメントを使ってListBoxコントロールの項目をすべて処理する</p>
</div>
<div>
<div>
<pre lang="en"><code>For i As Integer = 0 To ListBox1.Items.Count - 1</code></pre>
<pre lang="en"><code>    Debug.WriteLine(ListBox1.Items(i))</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<p><br /></p>
<p>　ItemsのCountプロパティはコレクションの要素数を表すので、<span>0</span>から要素数-<span>1</span>まで処理すれば、ListBoxコントロールの全項目が処理できるというわけです。</p>
<p>　インデックスを使わずにすべての項目を処理する方法もあります。それが、For Each ... Nextステートメントです。上のコードを書き換えてみましょう（LIST<span>5</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>5</span>-<span>12</span>　For Each... Nextステートメントを使ってListBoxコントロールの項目をすべて処理する</p>
</div>
<div>
<div>
<pre lang="en"><code>For Each anItem As String In ListBox1.Items</code></pre>
<pre lang="en"><code>    Debug.WriteLine(anItem)</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<p><br /></p>
<p>　このように書くと、ListBox<span>1</span>.Itemsに含まれる項目を、先頭から順にanItemに代入して、最後まで繰り返しを実行します。こちらの書き方であれば、いちいちインデックスを表す変数を用意する必要がありません。その分、コードもスッキリします。また、Eachは「それぞれ」という意味なので、複数の要素を<span>1</span>つずつ処理していくことがうまく表せます（図<span>5</span>-<span>17</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00136.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　実際にはコレクションの要素（文字列）が変数に代入されているのではなく、文字列への参照が変数に代入されているのですが、いまはこの図のような理解で構いません。参照については<span>3</span>.<span>2</span>節でも説明しましたが、<span>8</span>.<span>2</span>節でクラスやオブジェクトの話と合わせて、さらに詳しく説明します。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>インデックスを使うと項目の追加や削除が正しくできないことがある</b></p>
</b></div>
<div>
<p>　インデックスを使う方法では、繰り返しの中でListBoxコントロールに項目を追加したり削除したりすると正しく動作しないことがあります。追加や削除をするとListBoxコントロールの項目数が変わるので、それにともないインデックスで示せない項目ができてしまったりするからです。LIST<span>5</span>-<span>11</span>の例でいえばListBox<span>1</span>.Items.Count -<span>1</span> の値は<span>4</span>ですが、項目を追加したり削除したりすると値が変わってしまいます。それにより、繰り返し処理が正しく実行できなくなることがあります。</p>
</div>
</div>
<p><br /></p>
<p>　図<span>5</span>-<span>18</span>はFor Each ... Nextステートメントの書き方をまとめたものです。</p>
<p><br /></p>
<div>
<p><img src="images/00322.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このように書くと、変数にコレクションの要素を順に代入しながら、繰り返しの中のステートメントを実行します。終了の判定は前判断型で、コレクションの要素がなくなったら繰り返しが終了します。図<span>5</span>-<span>19</span>はFor Each ... Nextステートメントの働きをフローチャートで表したものです。</p>
<p><br /></p>
<div>
<p><img src="images/00245.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>ObjectCollectionとCollectionの違い</b></p>
</b></div>
<div>
<p>　ListBoxコントロールのItemsプロパティで参照されるコレクションは、正確にはObjectCollectionと呼ばれるコレクションです。一般的なコレクションは、確認問題<span>2</span>に示したCollectionクラスを使って作成します。ObjectCollectionの要素は図<span>5</span>-<span>16</span>で見たように<span>0</span>番から始まりますが、Collectionの要素は<span>1</span>番から始まります。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-169">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）　For ... NextステートメントのForの代わりにFor Eachと書くだけで、For Each ... Nextステートメントが記述できる</p>
</div>
<div>
<p>（  ）　For Each ... Nextステートメントは、コレクションの要素をすべて処理するのに向いている</p>
</div>
<div>
<p>（  ）　For Each ... Nextステートメントでは、インデックスの値を使ってコレクションの要素を利用する</p>
</div>
<p><br /></p>
<div>
<p><br /></p>
</div>
<div>
<p><span><b><span><b>2</b></span>.</b></span>　説明に従って以下の空欄を埋め、For Each ... Nextステートメントを完成させてください。</p>
</div>
<p><br /></p>
<div>
<pre lang="en"><code>（1）	Dim MyCollection As Collection = New Collection()　　　●───新しいコレクションを作る </code></pre>
<pre lang="en"><code>	MyCollection.Add("Onion")</code><code><code>　　　●───</code>コレクションに要素を追加する</code></pre>
<pre lang="en"><code>	MyCollection.Add("Potato")</code><code><code>　　　●───</code>コレクションに要素を追加する</code></pre>
<pre lang="en"><code>	MyCollection.Add("Carrot")</code><code><code>　　　●───</code>コレクションに要素を追加する</code></pre>
<pre lang="en"><code>	（　　） Each anItem As String In （　　）</code><code><code>　　　●───</code>コレクションのすべての要素について処理する</code></pre>
<pre lang="en"><code>	</code></pre>
<pre lang="en"><code>	    Debug.WriteLine(anItem)</code><code><code>　　　●───</code> 要素を出力ウィンドウに表示する</code></pre>
<pre lang="en"><code>	（　　）</code></pre></div>
<p><br /></p>
<p><span><b>備考</b></span>　このように、自分でコレクションを作って要素を追加することもできます。</p>
<p><br /></p>
<div>
<pre lang="en"><code>（2）	For （　　） aControl （　　） Me.Controls</code><code><code><code>　　　●───</code></code> Me.Controlsコレクションのすべての要素について処理する</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	    If TypeOf aControl Is Button Then</code><code><code><code>　　　●───</code></code>aControlがButtonであれば</code></pre>
<pre lang="en"><code>	        Debug.WriteLine(CType(aControl, Button).Text)</code><code><code><code>　　　●───</code></code>Textプロパティの値を出力ウィンドウに表示する</code></pre>
<pre lang="en"><code>		　　</code></pre>
<pre lang="en"><code>	    End If</code></pre>
<pre lang="en"><code>	Next</code></pre></div>
<p><br /></p>
<p><span><b>備考</b></span>　このコードは、フォーム上にあるすべてのButtonコントロールのTextプロパティの値を出力ウィンドウに表示します。Me.Controlsは現在のフォームにあるコントロールのコレクションです。コントロールにはさまざまな型（ButtonやTextBoxなど）があるので、aControlにはデータ型を指定していません（Object型と見なされます）。「TypeOfコントロール名 Is コントロールの種類」という式で、コントロールが指定された種類のコントロールであるかどうかが分かります。CTypeはデータ型を変換するための関数です。aControlのデータ型はObject型なのでButton型に変換し、Textプロパティの値を出力ウィンドウに表示します。</p>
</div>
</div>
<div id="calibre_link-304">
<div>
<div id="calibre_link-170">
<div><b>
<p><b>　<span><b>5</b></span>.<span><b>5</b></span>　繰り返し処理を途中で抜ける</b></p>
</b></div>
</div>
<p><br /></p>
<p>　これまで見てきた繰り返し処理では、条件が成立するまで、あるいは条件が成立している間、ずっとステートメントを実行するものでした。しかし、特別な条件が成立した場合に限って、繰り返し処理を途中で抜けたいこともあるでしょう。そういった柔軟な繰り返し処理についても見ておきましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-171">
<div><b>
<p><b>■Do ... Loopステートメントを途中で抜ける〜Exit Doステートメント</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> ExitDoTest</p>
</div>
<hr />
<p>　ウェブサイトを表示する場合やプログラムでデータを表示する場合に、パスワードの入力が必要になることがあります。また、ショッピングサイトなどでは優待キーワードを入力すると割引価格で商品を購入できるところもあります。いずれの場合も、正しい文字列を入力すると先に進めますが、何回か間違うとエラーメッセージが表示されたり、プログラムが終了するようになっているのが普通です。例えば、<span>3</span>回まで入力できるとすると、どのようなコードを書けばいいでしょうか。優待キーワードを入力する場合を例にとって、繰り返し処理の流れを見てみましょう。方法はいくつかありますが、「正しいキーワードが入力されるまで」の繰り返しと考えると、<span>3</span>回以上入力された場合には繰り返しを抜けなければなりません。日本語で擬似コードを書いた後、フローチャートもあわせて示しておきます（図<span>5</span>-<span>20</span>）。</p>
<div>
<pre lang="en"><code>優待キーワードを入力する</code></pre>
<pre lang="en"><code>※以下を繰り返す。ただし、入力されたキーワードが正しいキーワードと一致するまで</code></pre>
<pre lang="en"><code>　優待キーワードが間違っているというメッセージを表示する</code></pre>
<pre lang="en"><code>　優待キーワードの間違いが3回になったら、繰り返しを抜ける</code></pre>
<pre lang="en"><code>　優待キーワードを入力する</code></pre>
<pre lang="en"><code>※に戻る</code></pre></div>
<div>
<p><img src="images/00110.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　太い線で描かれた部分を見ると想像が付くと思いますが、この繰り返し処理は前判断型のDo ... Loopステートメントを使って書くことのできるパターンになっています。</p>
<p>　キーワードを入力するには、InputBox関数が便利です。InputBox関数を利用すると、入力のための簡単なダイアログボックスを表示することができ、入力された文字列が結果として返されます。</p>
<p>　問題は繰り返しを途中で抜けるところです。Do ... Loopステートメントを途中で抜けるには、Exit Doステートメントを使います。細かな処理は省略して、骨格だけ書くと以下のようになります（LIST<span>5</span>-<span>13</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>5</span>-<span>13</span>　Do...Loopステートメントによる繰り返し処理を途中で抜けるためのコード</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim InputCount As Integer = 0	' 入力回数</code></pre>
<pre lang="en"><code>Dim CorrectKeyword As String = "foobar"	' 優待キーワード</code></pre>
<pre lang="en"><code>Dim InputKeyword As String	' 入力されたキーワード</code></pre>
<pre lang="en"><code>InputKeyword = InputBox("優待キーワードをどうぞ")</code></pre>
<pre lang="en"><code>Do Until InputKeyword = CorrectKeyword</code></pre>
<pre lang="en"><code>    MessageBox.Show("優待キーワードが間違っています")</code></pre>
<pre lang="en"><code>    InputCount += 1</code></pre>
<pre lang="en"><code>    If InputCount &gt;= 3 Then Exit Do</code></pre>
<pre lang="en"><code>    InputKeyword = InputBox("優待キーワードをどうぞ")</code></pre>
<pre lang="en"><code>Loop</code></pre></div>
</div>
<p><br /></p>
<p>　このコードが実行されると、画面<span>5</span>-<span>2</span>のようなダイアログボックスが表示されます。</p>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00340.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　実際には、考慮しておかなければいけない問題がいくつかあります。</p>
<p><br /></p>
<div>
<p>■入力用のダイアログボックスで［キャンセル］ボタンがクリックされた場合にも繰り返しを抜ける必要がある</p>
</div>
<div>
<p>■正しいキーワードを入力して繰り返しを終了した場合も、回数が<span>3</span>以上になって繰り返しを終了した場合もLoopの次の行に進むので、それ以降は同じ処理が実行される</p>
</div>
<p><br /></p>
<p>　［キャンセル］ボタンがクリックされたときには、InputBox関数は長さ<span>0</span>の文字列を返すので、その判定をするためのステートメントを追加するといいでしょう。</p>
<p>　正しいキーワードを入力して繰り返しを終了した場合と、回数が<span>3</span>以上になって繰り返しを抜けた場合を区別するには、どのような状態にあるかを表す変数を用意し、その値によって区別するといいでしょう。正しく繰り返しを抜けたかエラーで抜けたかという<span>2</span>つの状態があるので、Boolean型の変数がうってつけです。正しく繰り返しを抜けた場合をTrueとし、エラーで抜けた場合をFalseとすればいいでしょう。そのあたりまで含めて書くと、以下のようなコードになります（LIST<span>5</span>-<span>14</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>5</span>-<span>14</span>　［キャンセル］ボタンがクリックされた場合やキーワードが正しく入力されたかどうかに対処するためのコード</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim InputCount As Integer = 0			' 入力回数</code></pre>
<pre lang="en"><code>Dim CorrectKeyword As String = "foobar"	' 優待キーワード</code></pre>
<pre lang="en"><code>Dim InputKeyword As String			' 入力されたキーワード</code></pre>
<pre lang="en"><code>Dim IsRightKeyword As Boolean = True		' 正しく入力されたかどうか</code></pre>
<pre lang="en"><code>InputKeyword = InputBox("優待キーワードをどうぞ")</code></pre>
<pre lang="en"><code>Do Until InputKeyword = CorrectKeyword</code></pre>
<pre lang="en"><code>    MessageBox.Show("優待キーワードが間違っています")</code></pre>
<pre lang="en"><code>    InputCount += 1</code></pre>
<pre lang="en"><code>    If InputCount &gt;= 3 Or InputKeyword = "" Then</code></pre>
<pre lang="en"><code>        IsRightKeyword = False		' 正しいキーワードでなかった</code></pre>
<pre lang="en"><code>        Exit Do</code></pre>
<pre lang="en"><code>    End If</code></pre>
<pre lang="en"><code>    InputKeyword = InputBox("優待キーワードをどうぞ")</code></pre>
<pre lang="en"><code>Loop</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>If IsRightKeyword Then</code></pre>
<pre lang="en"><code>    MessageBox.Show("おめでとうございます。優待の対象です")</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>    MessageBox.Show("申し訳ありませんが、優待の権利はありません")</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>InputBoxで何も入力しなかったときは？</b></p>
</b></div>
<div>
<p>　入力用のダイアログボックスで何も入力せずに［OK］をクリックした場合も、長さ<span>0</span>の文字列が返されるので、その場合も繰り返しを途中で抜けることになります。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-172">
<div><b>
<p><b>■For...Next／For Each...Nextステートメントを途中で抜ける〜Exit Forステートメント</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> ExitForTest</p>
</div>
<hr />
<p>　前項では、Do ... Loopステートメントを途中で抜けるために使うExit Doステートメントを見ました。では、For ... NextステートメントやFor Each ... Nextステートメントを途中で抜けるにはどういうステートメントを使うのでしょうか。</p>
<p>　これにはExit Forステートメントを使います。</p>
<p>　前項の例は「入力を<span>3</span>回繰り返す」と考えることもできます。その場合、正しいキーワードを入力した場合にその時点で繰り返しを抜ければいいということになります。日本語の擬似コードで流れを書いた後、フローチャートもあわせて示しておきます（図<span>5</span>-<span>21</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00214.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　太い線で描かれた部分がFor ... Nextステートメントのパターンになっています。ここでも、細かな処理は省略して骨格だけ書いてみましょう（LIST<span>5</span>-<span>15</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>5</span>-<span>15</span>　For ... Nextステートメントによる繰り返し処理を途中で抜けるコード</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim CorrectKeyword As String = "foobar"	' 優待キーワード</code></pre>
<pre lang="en"><code>Dim InputKeyword As String			' 入力されたキーワード</code></pre>
<pre lang="en"><code>For i As Integer = 0 To 2</code></pre>
<pre lang="en"><code>    InputKeyword = InputBox("優待キーワードをどうぞ")</code></pre>
<pre lang="en"><code>    If InputKeyWord = CorrectKeyword Then Exit For</code></pre>
<pre lang="en"><code>    MessageBox.Show("優待キーワードが間違っています")</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<p><br /></p>
<p>　この方法だと、途中で繰り返しを抜けた場合が、正しくキーワードが入力された場合になります。さらに、正しいキーワードを入力して繰り返しを途中で終了したか、<span>3</span>回入力しても正しいキーワードが入力できなかったので繰り返しを終了したのかを判定する処理と、入力のためのダイアログボックスで［キャンセル］ボタンがクリックされて繰り返しを終了したのかを判定する処理を含めて書くと以下のようになります（LIST<span>5</span>-<span>16</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>5</span>-<span>16</span>　［キャンセル］ボタンがクリックされた場合やキーワードが正しく入力されたかどうかに対処するためのコード</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim CorrectKeyword As String = "foobar"	' 優待キーワード</code></pre>
<pre lang="en"><code>Dim InputKeyword As String			' 入力されたキーワード</code></pre>
<pre lang="en"><code>Dim IsRightKeyword As Boolean = False		' 正しく入力されたかどうか</code></pre>
<pre lang="en"><code>For i As Integer = 0 To 2</code></pre>
<pre lang="en"><code>    InputKeyword = InputBox("優待キーワードをどうぞ")</code></pre>
<pre lang="en"><code>    If InputKeyword = CorrectKeyword Then</code></pre>
<pre lang="en"><code>        IsRightKeyword = True</code></pre>
<pre lang="en"><code>        Exit For</code></pre>
<pre lang="en"><code>    Else If InputKeyword = "" Then</code></pre>
<pre lang="en"><code>        IsRightKeyword = False</code></pre>
<pre lang="en"><code>        Exit For</code></pre>
<pre lang="en"><code>    End If</code></pre>
<pre lang="en"><code>    MessageBox.Show("優待キーワードが間違っています")</code></pre>
<pre lang="en"><code>Next</code></pre>
<pre lang="en"><code>If IsRightKeyword Then</code></pre>
<pre lang="en"><code>    MessageBox.Show("おめでとうございます。優待の対象です")</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>    MessageBox.Show("申し訳ありませんが、優待の権利はありません")</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p>　繰り返し処理には、繰り返し処理をさらに繰り返して実行するという多重の繰り返しが必要になる場合もあります。これについては、配列の利用方法を説明した後で詳しく解説します。コラムの後の確認問題で知識を確実にしてから、サンプルプログラムにチャレンジしてみましょう。</p>
<p><br /></p>
<div>
<div id="calibre_link-297">
<div><b>
<p><b><span><b><img src="images/00053.jpeg" alt="" /><b></b></b></span><span><b>反復子により、値を順に取得するには</b></span></b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> YieldTest</p>
</div>
<p><br /></p>
<div>
<p>　Visual Basic 2012以降では、反復子と呼ばれる機能が利用できるようになりました。反復子を利用するとコレクションなどの要素を<span>1</span>つずつ返す関数（反復子関数）が作成できます。詳細な機能はこの本の範囲を超えてしまうので、簡単な例と書き方だけを紹介しましょう。なお、関数については<a href="#calibre_link-305"><u>P.252</u></a>で説明します。</p>
</div>
<div>
<p>　例えば、呼び出しのたびに、<span>7</span>、<span>5</span>、<span>3</span>という値を順に返す関数は以下のようになります。Functionの前にIteratorというキーワードを書き、関数の型をIEnumerableとします。また、関数が順に返す値をYieldの後に指定します。</p>
</div>
<div>
<pre lang="en"><code>    Private Iterator Function NumberGenerator() As IEnumerable</code></pre>
<pre lang="en"><code>        Yield 7</code></pre>
<pre lang="en"><code>        Yield 5</code></pre>
<pre lang="en"><code>        Yield 3</code></pre>
<pre lang="en"><code>    End Function</code></pre></div>
<div>
<p>　ここでは、関数名をNumberGeneratorとしています。この関数を最初に呼び出すとYield<span>7</span>というステートメントが実行され、<span>7</span>という値が返されます。次に呼び出すと<span>5</span>が返され、次に呼び出すと<span>3</span>が返されます。この関数はFor Each ... Nextステートメントの中で使えます。例えば、以下のように利用します。Inの後に関数名と()を書くことに注意してください。</p>
</div>
<div>
<pre lang="en"><code>        Dim number As Integer</code></pre>
<pre lang="en"><code>        For Each number In NumberGenerator()</code></pre>
<pre lang="en"><code>            Debug.WriteLine(number)</code></pre>
<pre lang="en"><code>        Next</code></pre></div>
<div>
<p>　NumberGeneratorは、<span>7</span>、<span>5</span>、<span>3</span>を順に返すので、それらが順にnumberに代入され、出力ウィンドウに表示されます。</p>
</div>
<div>
<p>　反復子を使った関数に引数を指定したり、繰り返し処理を使えば、柔軟な処理も実行できます。次の関数は、引数で指定した個数だけ乱数を返します。</p>
</div>
<div>
<pre lang="en"><code>    Private Iterator Function RandomGenerator(Count As Integer) As ⇒</code></pre>
<pre lang="en"><code>IEnumerable</code></pre>
<pre lang="en"><code>        Dim r As New Random()</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To Count - 1</code></pre>
<pre lang="en"><code>            Yield r.Next(10)</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>    End Function</code></pre></div>
<div>
<p>　この関数は以下のように利用します。引数に<span>5</span>を指定しているので、乱数が<span>5</span>個返されます。</p>
</div>
<div>
<pre lang="en"><code>        For Each number In RandomGenerator(5)</code></pre>
<pre lang="en"><code>            Debug.WriteLine(number)</code></pre>
<pre lang="en"><code>        Next</code></pre></div>
<div>
<p>　反復子を利用すると、さまざまな繰り返しのパターンを記述でき、簡単に利用できるようになります。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-173">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）　For ... Nextステートメントでは、Exitステートメントを書くことにより繰り返し処理を途中で抜けることができる</p>
</div>
<div>
<p>（  ）　Do ... Loopステートメントでは、前判断型の場合は繰り返し処理を途中で抜けられるが、後判断型では途中で抜けられない</p>
</div>
<div>
<p>（  ）　Do ... Loopステートメントによる繰り返し処理を抜けるにはExit Doステートメントを利用する</p>
</div>
</div>
</div>
<div id="calibre_link-331">
<div>
<div id="calibre_link-174">
<div><b>
<p><b>　<span><b>5</b></span>.<span><b>6</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
</div>
<p><br /></p>
<p>　繰り返し処理にはさまざまなステートメントがあり、それぞれの基本的な知識についてはこれまでに説明しました。ここでは、ListBoxコントロールに入っている成績の最高点を検索するプログラムを作成します。繰り返し処理に注目してプログラム全体を作り上げていきましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-175">
<div><b>
<p><b>■最高点を求めるプログラム</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> GetMax</p>
</div>
<hr />
<p>　本来であれば、ListBoxコントロールには実際の成績が入れられるのですが、このプログラムでは、架空の成績を入れておくことにします。そのため、乱数を使って<span>0</span>以上100以下のランダムな値を<span>10</span>個作り、それらをListBoxコントロールに入れます。そしてその中から最大値を検索するわけです。プログラムの完成イメージはイラスト<span>5</span>-<span>4</span>のような感じになるでしょう。</p>
<p><br /></p>
<div>
<p><img src="images/00255.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　新しいプロジェクトを作成し、完成イメージにそってフォームをデザインしていきましょう。プロジェクト名はGetMaxとしておきます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-176">
<div><b>
<p><b>■フォームのデザイン</b></p>
</b></div>
</div>
<hr />
<p>　フォームにはListBoxコントロールを<span>1</span>つと、Buttonコントロールを<span>2</span>つ配置します。画面<span>5</span>-<span>3</span>のようにコントロールを配置し、表<span>5</span>-<span>1</span>にそってプロパティの値を設定してください。</p>
<p><br /></p>
<div>
<p><img src="images/00312.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00039.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-177">
<div><b>
<p><b>■イベントハンドラーの記述</b></p>
</b></div>
</div>
<hr />
<p>　プログラムを実行したときには、リストボックスに<span>0</span>以上100以下の乱数を<span>10</span>個入れ、架空の成績とします。したがって、フォームのLoadイベントハンドラーにその処理を書くといいでしょう。正確には、Loadイベントはプログラムの実行時ではなく、フォームが読み込まれ、はじめて表示される直前に発生します。</p>
<p>　乱数を利用する方法は<span>5</span>.<span>2</span>節で見たとおりです。以下のように、乱数を利用するための変数rを宣言します。</p>
<div>
<pre lang="en"><code>Dim r As Random = New Random()</code></pre></div>
<p>　実際に整数の乱数を作るには、Nextメソッドを使います。次のように書くと、<span>0</span>以上、101未満の乱数が<span>1</span>つ作られScoreに代入されます。成績は<span>0</span>以上100以下なのですが、Nextメソッドでは下限値以上、上限値未満という指定のしかたをするので、「100以下」を表すには「101未満」と指定する必要があります。</p>
<div>
<pre lang="en"><code>Score = r.Next(0, 101)</code></pre></div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>指定した範囲の乱数を作成するには</b></p>
</b></div>
<div>
<p>　RandomクラスのNextメソッドでは、引数の指定のしかたによって、作成する乱数の値の範囲を変えることができます。引数を省略すると<span>0</span>以上、整数の最大値未満の乱数が作成できます。引数を<span>1</span>つだけ指定するとそれが上限値と見なされます。その場合の下限値は<span>0</span>です。引数を<span>2</span>つ指定すると、下限値と上限値と見なされます。いずれの場合も、下限値以上、上限値未満の乱数が作成されます。</p>
</div>
</div>
<p><br /></p>
<p>　ListBoxコントロールの項目に新しい項目を追加するには、ListBoxコントロールのItems.Addメソッドを使います。例えば、ListBox<span>1</span>コントロールの項目に変数Scoreの値を追加するなら、以下のようになります。</p>
<div>
<pre lang="en"><code>ListBox1.Items.Add(Score)</code></pre></div>
<p>　また、以下のように書けば、Scoreの値ではなく、作成した乱数を直接追加できます。</p>
<div>
<pre lang="en"><code>ListBox1.Items.Add(r.Next(0, 101))</code></pre></div>
<p>　新しい項目はListBoxコントロールの項目の末尾に追加されます。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>ListBoxコントロールの項目を自動的に並べ替えるには</b></p>
</b></div>
<div>
<p>　ListBoxコントロールのSortedプロパティがTrueであれば、項目が自動的に並べ替えられるので、Addメソッドで追加された新しい項目は末尾ではなく、並べ替えを行った適切な位置に追加されます。</p>
</div>
</div>
<p><br /></p>
<p>　では、フォームのLoadイベントハンドラーを書いてみましょう。</p>
<p><br /></p>
<div><b>
<p><b>■フォームのLoadイベントハンドラー</b></p>
</b></div>
<p>　フォームのLoadイベントハンドラーではListBoxコントロールに乱数を<span>10</span>個追加します。言い換えると「乱数を<span>1</span>個作り、それをListBoxコントロールに追加するという処理を<span>10</span>回繰り返す」ことになります。これは決まった回数の繰り返しなので、For ... Nextステートメントが使えます。</p>
<p>　For ... Nextステートメントについてはもう具体的なコードを書くことができるはずです。それ以外は日本語で構わないので擬似コードで表してみましょう。</p>
<div>
<pre lang="en"><code>For i As Integer = 0 To 9</code></pre>
<pre lang="en"><code>    乱数を1つ作る</code></pre>
<pre lang="en"><code>    乱数をListBoxコントロールに追加する</code></pre>
<pre lang="en"><code>Next</code></pre></div>
<p>　乱数を<span>1</span>つ作り、それをListBoxコントロールに追加する処理は、ステップを分けて書いても構いませんが、すでに見たように<span>1</span>行で書けます。Loadイベントハンドラーの名前をInitProcとして、コードを書いてみましょう（LIST<span>5</span>-<span>17</span>）。このプログラムでは、フォーム上に配置したListBoxコントロールの名前はlstScoreです。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>5</span>-<span>17</span>　ListBoxコントロールに乱数を<span>10</span>個追加する</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs) Handles ⇒</code></pre>
<pre lang="en"><code>MyBase.Load</code></pre>
<pre lang="en"><code>        Dim r As Random = New Random()</code></pre>
<pre lang="en"><code>        lstScore.Items.Clear()　　　●───リストボックスの項目をクリアしておく</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To 9</code><code><code>　　　●───</code>10回繰り返す</code></pre>
<pre lang="en"><code>            lstScore.Items.Add(r.Next(101)) </code><code>　　　●───0以上101未満の乱数を作り、リストボックスの項目に追加する</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　繰り返しに入る前に、lstScore.ItemsのClearメソッドを使っています。Clearメソッドは項目をすべて削除するためのメソッドです。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>ListBoxのClearメソッドが必要になる場合</b></p>
</b></div>
<div>
<p>　フォームのLoadイベントハンドラーではなく、ButtonコントロールのClickイベントハンドラーでこのコードを実行する場合には、LIST<span>5</span>-<span>17</span>のようなClearメソッドが必要になることがあります。ボタンをクリックするたびに新しいリストを作りたい場合、前回の内容を消してから新しい項目を追加する必要があるからです。Clearメソッドを使えば、新しい項目を追加する前に前回の内容を削除しておくことができます。Clearメソッドを書いていないと、前回の項目の後に、新しい項目が追加されることになります。</p>
</div>
</div>
<p><br /></p>
<div><b>
<p><b>■Buttonコントロールのイベントハンドラー</b></p>
</b></div>
<p>　Buttonコントロールは<span>2</span>つあります。btnMaxValueが最高点を求めるためのボタン、btnExitがプログラムを終了させるためのボタンです。</p>
<p>　最高点をどうやって求めればいいか、少し考えてみても方法が簡単に思いつかないかもしれません。しかし、これにはお決まりのパターンがあります。私たちは実生活の中で同じようなことをよく経験しています。例えば、お笑い芸人のチャンピオンを決める方法やフィギュアスケートの優勝者を決める方法はそれとほとんど同じです。最初は、優勝者席は空席ですが、<span>1</span>番目の挑戦者がまずそこに座ります。それ以降は、優勝者席に座っている人よりも挑戦者の点数が高ければ、挑戦者が優勝者席に座ります。同じようにして演技を進めていけば、すべての演技が終わったときに優勝者席に座っている人が最高点を獲得した優勝者ということになります。</p>
<p>　このプログラムでは、最高点をMaxScoreという変数に入れるものとしましょう。宣言は簡単です。</p>
<div>
<pre lang="en"><code>Dim MaxScore As Integer</code></pre></div>
<p>　最初は、優勝者席を空席にしておき、<span>1</span>番目の挑戦者を座らせたいのですが、これにはちょっとしたテクニックを使います。MaxScoreに「どんな値よりも小さな値」を入れておけば、<span>1</span>番目の点数がいくらであっても絶対にその値よりも大きくなるので、MaxScoreに<span>1</span>番目の点数を入れることができます。</p>
<p>　それ以降も処理の方法は同じです。次の点数とMaxScoreの値を比べ、点数のほうがMaxScoreよりも大きければ、MaxScoreにその点数を代入します（図<span>5</span>-<span>22</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00059.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　これまでの説明を踏まえて、処理の流れを日本語の擬似コードで書いてみましょう。</p>
<div>
<pre lang="en"><code>MaxScoreに整数の最小値を入れる</code></pre>
<pre lang="en"><code>※リストボックスの項目すべてについて繰り返す</code></pre>
<pre lang="en"><code>　点数がMaxScoreより大きければ</code></pre>
<pre lang="en"><code>　　MaxScoreにその点数を入れる</code></pre>
<pre lang="en"><code>※</code></pre></div>
<p>　点数がMaxScore以下であれば、その点数が最高点になることはありえないので何もしません。たとえ点数が最高点と同点であっても、その値はMaxScoreにすでに入っているので、わざわざ入れ直す必要はありません。</p>
<p>　整数の最小値はInteger.MinValueで表されます。繰り返し処理はリストボックスの項目すべてについて実行するので、For Each ... Nextステートメントが便利です。これまで説明した内容をすべてまとめると、LIST<span>5</span>-<span>18</span>のようにbtnMaxValueのClickイベントハンドラーが書けるでしょう。イベントハンドラー名はSearchMaxValueとしておきます。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>5</span>-<span>18</span>　ListBoxコントロールから最大値を求めるコード</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub SearchMaxValue(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles btnMaxValue.Click</code></pre>
<pre lang="en"><code>        Dim MaxScore As Integer</code></pre>
<pre lang="en"><code>        MaxScore = Integer.MinValue   ●───最初は整数の最小値を入れておく</code></pre>
<pre lang="en"><code>        For Each Score As Integer In lstScore.Items　　　</code><code><code>●───</code>リストボックスの項目を順にすべて処理する</code></pre>
<pre lang="en"><code>            If Score &gt; MaxScore Then</code></pre>
<pre lang="en"><code>                MaxScore = Score　　　</code><code><code>●───</code> 項目が最大値より大きい場合は、最大値に代入する</code></pre>
<pre lang="en"><code>            End If</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>        MessageBox.Show("最高点は" &amp; MaxScore &amp; "です")</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　このFor Each ... Nextステートメントでは、lstScoreコントロールすべての項目、つまりlstScore.Itemsを<span>1</span>つずつScoreに代入しながら、項目がなくなるまで繰り返し処理が実行されます。繰り返しを抜けたときにはMaxScoreに最高点が入っているので、それを表示すればおしまいです。</p>
<p>　［終了（X）］ボタン（btnExit）のイベントハンドラーは簡単です。このコードも入力しておいてください（LIST<span>5</span>-<span>19</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>5</span>-<span>19</span>　プログラムを終了させるためのコード</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs) Handles⇒</code></pre>
<pre lang="en"><code>btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-178">
<div><b>
<p><b>■プログラムを実行する</b></p>
</b></div>
</div>
<hr />
<p>　コードがすべて入力できたら、［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックしてプログラムを実行します。［最高点（M）］ボタンをクリックすると、ListBoxコントロールの項目の最大値が表示されます（画面<span>5</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00048.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div>
<p><span><b>❶</b></span>　［最高点（M）］をクリックする</p>
</div>
</div>
<div>
<div>
<p><span><b>②</b></span>　最高点が表示される</p>
</div>
</div>
<p><br /></p>
<p>　このプログラムでは、For ... NextステートメントとFor Each ... Nextステートメントを使いました。繰り返し処理は配列と組み合わせるとさらに威力を発揮します。練習問題に取り組んで、繰り返し処理を確実に身に付け、次の章に進んでください。</p>
</div>
</div>
<div id="calibre_link-23">
<div>
<div><b>
<p><b>Chapter<span><b>5</b></span>のまとめ</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　一般的な繰り返し処理にはDo ... Loopステートメントが使えます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Do ... Loopステートメントには、前判断型と後判断型があります</b></p>
</b></div>
<div><b>
<p><b>　− 前判断型では繰り返し処理の中身が<span><b>1</b></span>回も実行されないこともあります</b></p>
</b></div>
<div><b>
<p><b>　− 後判断型では繰り返し処理の中身が少なくとも<span><b>1</b></span>回は実行されます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　繰り返しの終了を判定する方法にはUntil型とWhile型があります</b></p>
</b></div>
<div><b>
<p><b>　− Until型では条件が成立するまで繰り返し処理が実行されます</b></p>
</b></div>
<div><b>
<p><b>　− While型では条件が成立する間繰り返し処理が実行されます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　一定の回数の繰り返し処理を実行したい場合や変数の値を変化させながら繰り返し処理を実行したい場合にはFor ... Nextステートメントが便利です</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　コレクションの要素をすべて処理するには、For Each ... Nextステートメントが便利です</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Do ... Loopステートメントによる繰り返し処理を途中で抜けるにはExit Doステートメントを使います</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　For ... NextステートメントやFor Each ... Nextによる繰り返し処理を途中で抜けるにはExit Forステートメントを使います</b></p>
</b></div>
</div>
</div>
<div id="calibre_link-48">
<div>
<div id="calibre_link-179">
<div><b>
<p><b>練習問題</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" /> GetMin, CountPass</p>
</div>
<p><br /></p>
<div>
<p><span><b>［A］</b></span>サンプルプログラムを変更し、最低点を求めるプログラムを作成してみてください。プロジェクト名はGetMinとします。実行結果が以下の画面のようになればいいでしょう。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00163.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div>
<p><span><b>［B］</b></span>サンプルプログラムを変更し、<span>60</span>点以上の人数を数えるプログラムを作成してみてください。プロジェクト名はCountPassとします。実行結果が以下の画面のようになればいいでしょう。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00027.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
</div>
</div>
<div id="calibre_link-316">
<div>
<div id="calibre_link-180">
<div><b>
<p><b>Chapter<span><b>6</b></span></b></p>
</b></div>
</div>
<p><br /></p>
<div><b>
<p><b>配列を利用する</b></p>
</b></div>
<hr />
<div>
<p>同じデータ型で、同じ目的に使う変数がいくつもある場合、<span>1</span>つ<span>1</span>つ変数を宣言するのはとても面倒です。例えば、<span>10</span>人分の成績データを同時に取り扱いたい場合、<span>10</span>個の変数を宣言する必要があります。<span>10</span>個ならまだしも、これが100個、<span>1</span>,000個となると、個別に変数を宣言することはとうていできません。そのような場合に便利なのが配列です。配列を利用すると、宣言を<span>1</span>つ書くだけで多数の要素が利用できるようになります。</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><span><b>6</b></span>.<span><b>1</b></span>　配列の考え方</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>6</b></span>.<span><b>2</b></span>　配列の宣言と利用</b></p>
</b></div>
<div>
<p>配列を宣言する／配列を利用する／配列を初期化する／多次元配列を利用する／多次元配列を初期化する／配列のサイズを変更する</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>6</b></span>.<span><b>3</b></span>　配列と繰り返し処理</b></p>
</b></div>
<div>
<p>配列の要素をすべて処理する／多次元配列の要素をすべて処理する</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>6</b></span>.<span><b>4</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
<div>
<p>売上を集計するプログラム／フォームのデザイン／イベントハンドラーの記述／プログラムを実行する</p>
</div>
</div>
</div>
<div id="calibre_link-4">
<div>
<div><b>
<p><b>これから学ぶこと</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　配列を宣言し、同じ名前で多くの要素を持つ変数が利用できるようにします</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　繰り返し処理を使って配列の要素をすべて処理する方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　多次元の配列を利用する方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　この章で学んだことがらを利用してプログラムを作成します</b></p>
</b></div>
<p><br /></p>
<div>
<p><img src="images/00267.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>　この章では配列を利用する方法を学び、多くのデータを効率よく取り扱うための基礎を身に付けます。繰り返し処理を使って配列を処理すれば、配列のすべての要素を一度に処理できます。この章の最後では配列に入れられた売上金額をもとに、合計や平均値、標準偏差を求めるプログラムを作成します。</p>
</div>
</div>
</div>
<div id="calibre_link-36">
<div>
<div id="calibre_link-181">
<div><b>
<p><b>　<span><b>6</b></span>.<span><b>1</b></span>　配列の考え方</b></p>
</b></div>
</div>
<p><br /></p>
<p>　変数とはデータを入れるための箱のようなものだとChapter<span>3</span>で説明しました。読者のみなさんはもはやそんなたとえ話をしなくても、「〜を入れておくための変数を宣言してください」といわれれば、Dimステートメントを使って、難なく変数の宣言ができると思います。例えば、成績を記憶しておくための変数であれば、Integer型で宣言すればいいでしょう。</p>
<div>
<pre lang="en"><code>Dim Score As Integer</code></pre></div>
<p>　では、成績を記憶しておくための変数を<span>2</span>つ利用するとすればどうでしょう。</p>
<div>
<pre lang="en"><code>Dim Score1 As Integer</code></pre>
<pre lang="en"><code>Dim Score2 As Integer</code></pre></div>
<p>　この程度なら何の問題もないでしょう。しかし、成績を記憶しておくための変数を100個利用するとすればどうでしょう。これまでの方法では宣言のためのステートメントが100個必要になります。しかも、変数名がそれぞれ異なるので、合計や平均などの計算をする場合にも変数名を個別に書かなくてはなりません。想像するだけでも気の遠くなる作業です。</p>
<p>　しかし、<span><b>配列</b></span>を使えばこの問題は一挙に解決します。配列では複数の要素にすべて同じ名前が付けられます。したがって、宣言は<span>1</span>回だけで構いません。それぞれの要素は<span><b>インデックス</b></span>と呼ばれる値で区別されます（図<span>6</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00132.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　例えば、Scoreの<span>2</span>番といえば、どの要素であるかが特定できます。上の例では、その値は<span>76</span>です。このようにすれば個別に変数名を付ける必要もなく、しかも、それぞれの要素を確実に区別して使えます。また、変数名が同じなので、同じ目的に使うということもよく分かります。</p>
<p>　実際には、配列は値型の変数ではなく、参照型の変数なので、正確なイメージは図<span>6</span>-<span>1</span>とは異なります。しかし、とりあえずは同じ型の変数が同じ名前で複数個利用でき、それぞれの要素をインデックスで区別すると考えておいてください。一応、正確なイメージを図にすると図<span>6</span>-<span>2</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00008.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　配列の利点はまだまだあります。繰り返し処理と組み合わせて使えば「<span>0</span>番から何番まで処理をする」というコードが書けるので、要素が100個であろうが<span>1</span>,000個であろうが、ほんの数行で大量のデータが処理できます。例えば、100人の平均値を求めるのであれば、以下のような流れになるでしょう。</p>
<div>
<pre lang="en"><code>合計に0を代入する</code></pre>
<pre lang="en"><code>※iの値が0番から99番まで繰り返す</code></pre>
<pre lang="en"><code>　合計に成績のi番目の値を加算する</code></pre>
<pre lang="en"><code>※</code></pre>
<pre lang="en"><code>平均に、合計を100で割った値を代入する</code></pre></div>
<p>　配列のインデックスは通常<span>0</span>から始まることに注意してください。したがって、要素が100個あるとすれば、最後の要素のインデックスは<span>99</span>になります。</p>
<p>　Visual Basicでは、複数のインデックスを使った多次元配列も可能です。しかし、まずは基本的な配列の使い方をしっかり身に付けましょう。その後で、さらに高度な配列について見ていくこととします。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-182">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）　Visual Basicで大量のデータを取り扱うときには、それらのデータを記憶するための変数を個別に宣言する必要がある</p>
</div>
<div>
<p>（  ）　配列を使うと、<span>1</span>つの変数名でたくさんの変数が利用できる</p>
</div>
<div>
<p>（  ）　配列の各要素を区別するには、キーと呼ばれる値を使う</p>
</div>
<div>
<p>（  ）　配列と繰り返し処理を組み合わせると、大量のデータを簡潔なコードで処理できる</p>
</div>
<div>
<p>（  ）　配列のインデックスは通常<span>1</span>から始まる</p>
</div>
</div>
</div>
<div id="calibre_link-303">
<div>
<div id="calibre_link-183">
<div><b>
<p><b>　<span><b>6</b></span>.<span><b>2</b></span>　配列の宣言と利用</b></p>
</b></div>
</div>
<p><br /></p>
<p>　ここでは、配列の宣言のしかたと、それぞれの要素の利用のしかたを見ていきます。配列を宣言するには、インデックスの最大値を指定します。また、それぞれの要素はインデックスを指定して利用します。インデックスとして変数を指定することもできます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-184">
<div><b>
<p><b>■配列を宣言する</b></p>
</b></div>
</div>
<hr />
<p>　配列の宣言にもDimステートメントを使います。宣言の方法はこれまでに見てきた変数の宣言とほとんど同じです。ただし、変数名の後に()を書き、()の中にインデックスの最大値を書きます。例えば、成績を記憶するための変数を<span>10</span>個、整数の配列として宣言するのであれば、以下のようにDimステートメントを書きます。</p>
<div>
<pre lang="en"><code>Dim Score(9) As Integer</code></pre></div>
<p>　注意すべき点は、()の中に書く数字です。この値は配列の要素数ではなく、あくまでもインデックスの最大値です。インデックスは<span>0</span>から始まるので、<span>10</span>個の要素を利用するのであれば、インデックスの最大値には<span>9</span>と書きます。</p>
<p>　この宣言により、要素数が<span>10</span>個の整数型の配列が利用できるようになりました（図<span>6</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00240.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　では、一般的な書き方をまとめておきましょう（図<span>6</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00057.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　データ型にはIntegerのほか、DoubleやStringなど、どのようなものでも指定できます。</p>
<div>
<pre lang="en"><code>Dim DiscountRate(2) As Double　　　●―――Double型のDiscountRateという配列を宣言する。インデックスの最大値が2なので要素数は3</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>Dim Grade(3) As String　　　●―――String型のGradeという配列を宣言する。インデックスの最大値が3なので要素数は4</code></pre></div>
<p><br /></p>
<p>　配列にも変数のアクセスレベルが指定できるので、Dimの代わりにPublicやPrivateを指定することができます。</p>
<div>
<pre lang="en"><code>Private QuarterSales(3) As Long　　　●―――Privateを指定しているので、同じフォームやモジュールの中でだけ使える（ほかのモジュールからは利用できない）</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>Public CustomerName(9) As String　　　●―――Publicを指定しているので、ほかのフォームなどからもアクセスできる</code></pre></div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-185">
<div><b>
<p><b>■配列を利用する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />MatrixTest<span>1</span></p>
</div>
<hr />
<p>　宣言に続いて、配列の基本的な利用方法を見ておきましょう。配列の要素は通常の変数と同じように扱えるので、代入や演算にそのまま使えます。異なるのは()の中にインデックスを書いてどの要素かを指定することだけです。</p>
<div>
<pre lang="en"><code>①Score(0) = 95　　　●―――Scoreの0番の要素に95を代入する</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>　i = 3</code></pre>
<pre lang="en"><code>②Score(i) = 80　　　●―――Scoreのi番目に80を代入する（iの値が3なので、3番の要素に80が代入される）</code></pre>
<pre lang="en"><code>③Score(i+4) = 55　　　●―――Scoreのi+4番の要素に55を代入する（iの値が3なので、7番の要素に55が代入される）</code></pre>
<pre lang="en"><code>④Score(5) = Score(3)　　　●―――Scoreの5番の要素にScoreの3番の要素の値を代入する</code></pre>
<pre lang="en"><code>⑤Score(10) = 100　　　●―――Scoreの10番の要素はないので、エラーになる</code></pre></div>
<p>　上の例を見ても分かるように、インデックスには変数や式も指定できます。なお、インデックスの値が存在しない要素を示している場合はエラーになります。処理を順に追いかけていくと図<span>6</span>-<span>5</span>のように値が代入されることが分かります。</p>
<p><br /></p>
<div>
<p><img src="images/00334.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>変数の初期値は？</b></p>
</b></div>
<p>　値が代入されていない要素には、初期値として数値型には<span>0</span>が、Boolean型にはFalseが、文字列型にはNothingと呼ばれる特別な値が入れられています。</p>
</div>
<p><br /></p>
<p>　ここで、配列を表す変数が参照型であることを思い出してください。以下のようなコードでは、配列の各要素の値がすべて代入されるのではなく、参照が代入されます（LIST<span>6</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>6</span>-<span>1</span>　配列を表す変数は参照型なので、参照が代入される</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim Score(2) As Integer</code></pre>
<pre lang="en"><code>Dim ScoreSave () As Integer</code></pre>
<pre lang="en"><code>Score(0) = 65</code></pre>
<pre lang="en"><code>Score(1) = 83</code></pre>
<pre lang="en"><code>Score(2) = 76</code></pre>
<pre lang="en"><code>ScoreSave = Score　　　●―――Scoreに入れられている配列の参照をScoreSaveに代入する</code></pre></div>
</div>
<p><br /></p>
<p>　図で表すと、図<span>6</span>-<span>6</span>のような感じになります。</p>
<p><br /></p>
<div>
<p><img src="images/00210.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　配列の各要素の値がScoreSaveに代入されているわけでなく、参照が代入されているだけなので、Scoreという名前で参照される配列を変更すると、ScoreSaveで参照される配列も当然のことながら変更されています。上のコードに続いて、LIST<span>6</span>-<span>2</span>のコードを入力し、プログラムを実行してみると、そのことがよく分かります。</p>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>6</span>-<span>2</span>　元の配列を変更する</p>
</div>
<div>
<div>
<pre lang="en"><code>Score(1) = 90</code></pre>
<pre lang="en"><code>Debug.WriteLine(ScoreSave(1))</code></pre></div>
</div>
<p><br /></p>
<p>　出力ウィンドウに表示される結果は<span>90</span>です。もし、各要素の値が代入されているのであれば、ScoreとScoreSaveは別のものなので、結果は<span>83</span>になるはずですが、そうはなりません（図<span>6</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00088.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　配列が大きくなると、値をすべて代入するには処理時間がかかります。しかし、参照を代入するだけであれば、<span>1</span>回の代入だけで処理が終わります。参照型の変数にはそのようなメリットもあります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-186">
<div><b>
<p><b>■配列を初期化する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />MatrixTest<span>2</span></p>
</div>
<hr />
<p>　配列の要素は宣言時に初期化できます。初期値は変数の初期化と同じように「=」の後に書きます。ただし、配列には複数の要素があるので、全体を{}で囲み、各要素を「,」（カンマ）で区切ります。このとき、インデックスの最大値は指定できません。初期値の個数によって要素の数が決められます。</p>
<div>
<pre lang="en"><code>Dim DiscountRate() As Double = {0.1, 0.15, 0.2}</code></pre>
<pre lang="en"><code>Dim Grade() As String = {"不可", "可", "良", "優"}</code></pre></div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>宣言時に配列を初期化する別の方法</b></p>
</b></div>
<p>　以下のような書き方もできます。</p>
<div>
<pre lang="en"><code>Dim DiscountRate As Double()= {0.1, 0.15, 0.2}</code></pre>
<pre lang="en"><code>Dim DiscountRate As Double()= New Double(2) {0.1, 0.15, 0.2}</code></pre></div>
<div>
<p>　<span>2</span>番目の例の場合、インデックスの最大値を書くことも、省略することもできます。</p>
</div>
</div>
<p><br /></p>
<p>　配列を利用すると、これまでSelect ... Caseステートメントを使って書いていたコードが簡単に書ける場合があります。例えば、月の和名を表示する例であれば、LIST<span>6</span>-<span>3</span>のように書けます。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>6</span>-<span>3</span>　月の和名を配列から求めるコード</p>
</div>
<div>
<div>
<pre lang="en"><code>    Dim MonthName() As String = {"睦月", "如月", "弥生", "卯月", "皐月",⇒</code></pre>
<pre lang="en"><code>"水無月", "文月", "葉月", "長月", "神無月", "霜月", "師走", "不明"}</code></pre>
<pre lang="en"><code>    Dim MonthNumber As Integer = Today.Month - 1</code></pre>
<pre lang="en"><code>    MessageBox.Show("今月は" &amp; MonthName(MonthNumber) &amp; "です")</code></pre></div>
</div>
<p><br /></p>
<p>　Today.Monthと書くと、現在の日付から月が取り出せます。月は<span>1</span>から始まるので、<span>1</span>を引いて配列のインデックスと合わせます。例えば、<span>5</span>月であれば<span>4</span>番の要素を取り出すことになります。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>配列の宣言にはConstステートメントは使えない</b></p>
</b></div>
<div>
<p>　月の和名を入れた配列は内容を変更することがないので、定数として宣言したいところですが、配列の場合Constステートメントを使うことができません。Dimの代わりにConstと書くとエラーになります。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-187">
<div><b>
<p><b>■多次元配列を利用する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />MatrixTest<span>3</span></p>
</div>
<hr />
<p>　これまで見てきた配列は、<span>0</span>番から何番かまでの要素が順に並んだデータを表すのに便利です。しかし、データが表のような形に並んでいる場合には、インデックスを<span>0</span>から順に指定するよりも行と列を組み合わせて指定したほうが便利です（図<span>6</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00308.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　この例では、（行, 列）という形式でそれぞれの要素を指定しています。このように、配列の要素を、行を表すインデックスと列を表すインデックスを使って表すこともできます。Integer型の配列であるとして、上の例をそのまま宣言してみましょう。</p>
<div>
<div>
<pre lang="en"><code>Dim DataMatrix(2, 3) As Integer</code></pre></div>
</div>
<p>　インデックスの最大値は、それぞれ「,」（カンマ）で区切って指定します。このように宣言すると、<span>3</span><span>×</span><span>4</span>=<span>12</span>個の要素を持つInteger型の配列が宣言できたことになります。</p>
<p>　配列で利用されるインデックスの数は<span><b>次元</b></span>と呼ばれ、Visual Basicでは<span>32</span>次元までの配列を利用できます。例えば、さきほどの例はインデックスを<span>2</span>つ使うので<span>2</span>次元の配列となります。また、次の例は<span>3</span>次元の配列になります。</p>
<div>
<div>
<pre lang="en"><code>Dim DataCube(2, 3, 4) As Double</code></pre></div>
</div>
<p>　この例であれば、奥行きが<span>3</span>個、高さが<span>4</span>個、幅が<span>5</span>個の立体のようなデータを想像するといいでしょう（図<span>6</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00189.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　多次元の配列を利用する場合も考え方は<span>1</span>次元の場合と同じです。それぞれの要素はインデックスを使って指定します。もちろん、インデックスには変数や式も指定できます。いくつか例を見てみましょう。</p>
<div>
<pre lang="en"><code>①DataMatrix(1, 2) = 10</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	x = 2</code></pre>
<pre lang="en"><code>	y = 3</code></pre>
<pre lang="en"><code>②DataMatrix(x, y) = 15</code></pre></div>
<p>　念のため図で示しておくと、図<span>6</span>-<span>10</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00056.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-188">
<div><b>
<p><b>■多次元配列を初期化する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />MatrixTest<span>4</span></p>
</div>
<hr />
<p>　多次元配列でも、配列の宣言と同時に初期値の設定ができます。この場合、最初の次元の並びの中に、次の次元の並びをそれぞれ{}で囲んで書きます。</p>
<div>
<pre lang="en"><code>Dim Matrix(, ) As Integer = {{1, 2, 3, 4}, {101, 102, 103, 104},⇒</code></pre>
<pre lang="en"><code>{30, 40, 50, 60}}</code></pre></div>
<p>　インデックスの最大値が書かれていないので、(<span>3</span>,<span>2</span>)の配列なのか(<span>2</span>,<span>3</span>)の配列なのか迷ってしまうかもしれません。しかし、最初の次元がいちばん外側の{}にあたると考え、順を追って丁寧に見ていけば難しいことはありません。外側から考えるので、とりあえず内側の{}をX, Y, Zとおけば、要素が<span>3</span>つであることが分かります。したがって、最初の次元の要素は<span>3</span>つ。つまり、最初の次元のインデックスの最大値は<span>2</span>です。</p>
<p><br /></p>
<div>
<p><img src="images/00320.jpeg" alt="" /></p>
</div>
<p>　次に内側を見ていきます。Xは{<span>1</span>,<span>2</span>,<span>3</span>,<span>4</span>}、Yは{101, 102, 103, 104}、Zは{<span>30</span>,<span>40</span>,<span>50</span>,<span>60</span>}にあたるわけですから、次の次元の要素は<span>4</span>つ。つまり、次の次元のインデックスの最大値は<span>3</span>となります。</p>
<p><br /></p>
<div>
<p><img src="images/00159.jpeg" alt="" /></p>
</div>
<p>　したがって、この配列は（<span>2</span>,<span>3</span>）の配列だということが分かります。全体を図にすると図<span>6</span>-<span>11</span>のようなイメージになるでしょう。</p>
<p><br /></p>
<div>
<p><img src="images/00024.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-189">
<div><b>
<p><b>■配列のサイズを変更する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />MatrixTest<span>5</span></p>
</div>
<hr />
<p>　配列のサイズは後から変更できるので、あらかじめ宣言していた配列のサイズよりもデータが多くなってしまった場合や、データが少ししかなく、無駄な領域を削除したい場合にも対処できます。配列のサイズを変更するには、ReDimステートメントを使います（LIST<span>6</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>6</span>-<span>4</span>　配列のサイズを変更する</p>
<div>
<div>
<pre lang="en"><code>Dim x() As Double = {0.5, 1.0 ,1.5}</code></pre>
<pre lang="en"><code>ReDim x(5)　　　●―――ReDimステートメントに配列名とインデックスの新しい最大値を指定する</code></pre>
<pre lang="en"><code>Debug.WriteLine(x(1).ToString("F1"))</code></pre></div>
</div>
</div>
<p><br /></p>
<p>　ただし、この場合は元の要素の値が失われてしまいます。したがって、出力ウィンドウには<span>1</span>.<span>0</span>ではなく<span>0</span>.<span>0</span>と表示されます。元の要素の値を保持したまま、配列のサイズを変更したいときには、Preserveというキーワードを付けます（LIST<span>6</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>6</span>-<span>5</span>　元のデータを保持したまま配列のサイズを変更する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim x() As Double = {0.5, 1.0 ,1.5}</code></pre>
<pre lang="en"><code>ReDim Preserve x(5)　　　●―――Preserveキーワードを付けて配列のサイズを変える</code></pre>
<pre lang="en"><code>Debug.WriteLine(x(1).ToString("F1"))</code></pre></div>
</div>
<p><br /></p>
<p>　この場合、出力ウィンドウには<span>1</span>.<span>0</span>が表示されます。なお、配列のサイズを小さくした場合、切り詰められた要素は利用できなくなります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-190">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　左のステートメントと、その正しい説明を線で結んでください。</p>
<p><br /></p>
<div>
<p><img src="images/00327.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><span><b><span><b>2</b></span>.</b></span>　以下のコードを実行したときに、右に記した説明の空欄を埋める値を答えてください。エラーになる場合は、エラーと答えてください。</p>
<p><br /></p>
<div>
<pre lang="en"><code>	Dim x() As Integer = {1, 2, 3, 4, 5}</code></pre>
<pre lang="en"><code>	Dim y() As Integer</code></pre>
<pre lang="en"><code>	Dim i As Integer</code></pre>
<pre lang="en"><code>	Debug.WriteLine(x(4))　　　●─</code><code><code>─</code></code><code><code><code>─</code></code> 出力ウィンドウに表示される値は（　　）</code></pre>
<pre lang="en"><code>	x(0) = x(1) + x(2)</code><code><code>　　　●─</code><code><code>─</code></code><code><code><code>─</code></code></code>x(0)の値は（　　）になる</code></pre>
<pre lang="en"><code>	y = x</code></pre>
<pre lang="en"><code>	i = 4</code></pre>
<pre lang="en"><code>	y(i) = 10</code><code><code>　　　●─</code><code><code>─</code></code><code><code><code>─</code></code></code>代入前のy(i)の値は（　　）、代入後のy(i)の値は（　　）になる</code></pre>
<pre lang="en"><code>	x(4) +=1</code><code><code>　　　●─</code><code><code>─</code></code><code><code><code>─</code></code></code>x(4)の値は（　　）になる</code></pre>
<pre lang="en"><code>	ReDim Preserve x(3)</code></pre>
<pre lang="en"><code>	Debug.WriteLine(x(4))</code><code><code>　　　●─</code><code><code>─</code></code><code><code><code>─</code></code></code>出力ウィンドウに表示される値は（　　）</code></pre></div>
</div>
</div>
<div id="calibre_link-337">
<div>
<div id="calibre_link-191">
<div><b>
<p><b>　<span><b>6</b></span>.<span><b>3</b></span>　配列と繰り返し処理</b></p>
</b></div>
</div>
<p><br /></p>
<p>　配列の便利なところは、インデックスに変数や式を指定できるということです。変数の値や計算の結果によって利用する要素が決められるので、高度なデータの処理ができるようになります。とりわけ、繰り返し処理と組み合わせて利用すると、多くのデータを一度に処理できるので、その威力は<span>2</span>倍や<span>3</span>倍どころか、何百倍、何千倍にも発揮されます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-192">
<div><b>
<p><b>■配列の要素をすべて処理する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />MatrixTest<span>6</span></p>
</div>
<hr />
<p>　配列のインデックスは<span>0</span>から始まり、要素数-<span>1</span>で終わります。これらはFor ... Nextステートメントによる繰り返し処理の初期値と終了値とまったく同じなので、配列の要素をすべて処理したいときには、For ... Nextステートメントを使うと簡潔なコードが書けます。</p>
<p>　例えば、会議室の空き状況を配列で管理するものとしましょう。会議室の数は<span>10</span>とし、とりあえずは空きであるか使用中であるかが区別できればいいので、データ型はBooleanとし、TrueかFalseで状態を表すものとします。配列の宣言は次のようになるでしょう。</p>
<div>
<pre lang="en"><code>Dim RoomStatus(9) As Boolean</code><code></code></pre></div>
<p>　空きをFalse、使用中をTrueとしましょう。ただし、そのままではどちらが空きでどちらが使用中なのか分かりにくいので、定数を宣言しておきます。</p>
<div>
<pre lang="en"><code>Const VACANT As Boolean = False	　　　        ' 空き</code></pre>
<pre lang="en"><code>Const OCCUPIED As Boolean = True	　　　' 使用中</code></pre></div>
<p>　For ... Nextステートメントを使って、RoomStatusのすべての要素にVACANTを代入すれば、会議室をすべて「空き」にできます（LIST<span>6</span>-<span>6</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>6</span>-<span>6</span>　For ... Nextステートメントを使って配列の要素をすべて初期化する</p>
</div>
<div>
<div>
<pre lang="en"><code>For i As Integer = 0 To 9</code></pre>
<pre lang="en"><code>    RoomStatus(i) = VACANT</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>ブール型変数の初期値はFalse</b></p>
</b></div>
<p>　ブール型（Boolean型）変数の既定の値はFalseなので、このような初期化をしなくても最初からすべてが空きになっています。しかし、明示的にコードを書いておけば、どのような値に初期化されているのかがよく分かります。</p>
</div>
<p><br /></p>
<p>　会議室を利用したければ、必要に応じてインデックスを指定し、その要素にOCCUPIEDを代入します。例えば、<span>3</span>番の会議室を使いたければ、</p>
<div>
<pre lang="en"><code>RoomStatus(3) = OCCUPIED</code></pre></div>
<p>とすればいいでしょう。</p>
<p>　これだけで、もう会議室の空き状況を管理するプログラムの骨格ができます。この配列を使うと、さまざまな処理ができます。例えば、現在空いている会議室の数を数えてみましょう。やはりFor ... Nextステートメントが使えます（LIST<span>6</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>6</span>-<span>7</span>　空き会議室の数を数えるコード</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim VacantCount As Integer = 0</code></pre>
<pre lang="en"><code>For i As Integer = 0 To 9</code></pre>
<pre lang="en"><code>    If RoomStatus(i) = VACANT Then</code></pre>
<pre lang="en"><code>        VacantCount += 1</code></pre>
<pre lang="en"><code>    End If</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-193">
<div><b>
<p><b>■多次元配列の要素をすべて処理する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />MatrixTest<span>7</span></p>
</div>
<hr />
<p>　多次元配列にはインデックスが複数個あるので、繰り返し処理を入れ子にする必要があります。作業のシフト表のようなものを考えてみましょう。例えば、毎日点検すべき箇所が<span>4</span>箇所あるものとします。点検は毎日なので、<span>1</span>週間分の表を作るとすれば、日曜日から土曜日までの<span>7</span>日間の表になるはずです（図<span>6</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00042.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　表の中に担当者の名前を入れるなら、String型の配列を宣言する必要があります。行数が<span>4</span>、列数が<span>7</span>の配列になるので、次のように宣言できます。</p>
<div>
<pre lang="en"><code>Dim ShiftTable(3, 6) As String</code></pre></div>
<p>　初期設定として、すべての要素に""（長さ<span>0</span>の文字列）を入れるなら、図<span>6</span>-<span>13</span>のように、まず<span>0</span>行目にすべて""を代入し、次に<span>1</span>行目にすべて""を代入し......と進めていきます。</p>
<p><br /></p>
<div>
<p><img src="images/00162.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　入れ子になった繰り返し処理をいきなり書くのは難しいので、<span>1</span>行ずつ個別に書いてみましょう。これなら、曜日を順に変えるという繰り返しなので、For ... Nextステートメントで書けるはずです。曜日を表すインデックスをidxDayとします。まず、<span>1</span>行目です。このときは、点検箇所を表すインデックスが<span>0</span>なので、以下のようになります（LIST<span>6</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>6</span>-<span>8</span>　<span>1</span>行目のすべての列を初期化する</p>
</div>
<div>
<div>
<pre lang="en"><code>For idxDay = 0 To 6</code></pre>
<pre lang="en"><code>    ShiftTable(0, idxDay) = ""</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<p><br /></p>
<p>　<span>2</span>行目から<span>4</span>行目までも同様です（LIST<span>6</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>6</span>-<span>9</span>　<span>2</span>行目から<span>4</span>行目までのすべての列を初期化する</p>
</div>
<div>
<div>
<pre lang="en"><code>For idxDay = 0 To 6</code></pre>
<pre lang="en"><code>    ShiftTable(1, idxDay) = ""</code></pre>
<pre lang="en"><code>Next</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>For idxDay = 0 To 6</code></pre>
<pre lang="en"><code>    ShiftTable(2, idxDay) = ""</code></pre>
<pre lang="en"><code>Next</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>For idxDay = 0 To 6</code></pre>
<pre lang="en"><code>    ShiftTable(3, idxDay) = "" 　　　●―――この部分以外はすべて同じ。ここだけが0〜3に変わるので変数にする</code></pre>
<pre lang="en"><code>Next	</code></pre></div>
</div>
<p><br /></p>
<p>　これで、すべての要素を初期化できます。これらのコードを見てみると、点検箇所を表すインデックス以外はすべて同じだということが分かります。点検箇所を表すインデックスをidxPosとすると、<span>4</span>つのコードすべてが以下のように書けます（LIST<span>6</span>-<span>10</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>6</span>-<span>10</span>　行を表すインデックスを変数にする</p>
</div>
<div>
<div>
<pre lang="en"><code>For idxDay = 0 To 6</code></pre>
<pre lang="en"><code>    ShiftTable(idxPos, idxDay) = ""</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<p><br /></p>
<p>　idxPosの値が<span>0</span>から<span>3</span>まで変わればいいのですから、このコード全体をFor ... Nextステートメントで囲みましょう（LIST<span>6</span>-<span>11</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>6</span>-<span>11</span>　For ... Nextステートメントを入れ子にしてすべての行と列を初期化する</p>
</div>
<div>
<div>
<pre lang="en"><code>For idxPos = 0 To 3</code></pre>
<pre lang="en"><code>    For idxDay = 0 To 6</code></pre>
<pre lang="en"><code>        ShiftTable(idxPos, idxDay) = ""</code></pre>
<pre lang="en"><code>    Next</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<p><br /></p>
<p>　これで、繰り返し処理を入れ子にできました。これは、図<span>6</span>-<span>14</span>のようなカウンターと同じ動きをします。</p>
<p><br /></p>
<div>
<p><img src="images/00278.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　idxPosの値は、最初は<span>0</span>です。まずidxDayが<span>0</span>から<span>6</span>まで変わります。idxDayが<span>1</span>周すると、idxPosの値が<span>1</span>になり、またidxDayが<span>0</span>から<span>6</span>まで変わります。このようにして、最後まで（idxPosの値が<span>3</span>、idxDayの値が<span>6</span>まで）処理を進めるわけです。</p>
<p>　多次元の繰り返し処理も、慣れてくればいきなりコードとして書けるようになりますが、最初のうちは、こういうカウンターを想像すればいいでしょう。インデックスの順序とカウンターの桁の順序とは同じで、左のほうのインデックスが外側の繰り返しに対応します。</p>
<p>　なお、ここで示した会議室の例や作業のシフト表の例は、あくまで配列の機能を理解するためのものです。実際には予約状況や割り当てを保存しておかないと意味がないので、配列ではなく、<span>9</span>章のファイルや<span>10</span>章のデータベースを利用するのが普通です。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-194">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><br /></p>
<p><span><b><span><b>1</b></span>.</b></span>　説明をもとに空欄を埋めてコードを完成させてください。</p>
<p><br /></p>
<div>
<pre lang="en"><code>（1）	Const FREE As Integer = 0		' 空き</code></pre>
<pre lang="en"><code>	Const RESERVED As Integer = 1	' 予約済み</code></pre>
<pre lang="en"><code>	Const VIPONLY As Integer = 2		' VIPのみ利用可</code></pre>
<pre lang="en"><code>	Dim SeatNumber(（　　）) As Integer　　　●───座席の状態を表す配列を宣言する。座席数は100とする</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	' すべてを空席とする。ただし10で割り切れる番号の座席はVIP専用とする</code></pre>
<pre lang="en"><code>	（　　） idx As Integer = 0 To （　　）</code><code><code>　　　●───</code>すべての座席について処理する</code></pre>
<pre lang="en"><code>	    SeatNumber(idx) = （　　）</code><code><code>　　　●───</code>座席を空席とする</code></pre>
<pre lang="en"><code>	    （　　） idx （　　） 10 = 0 Then SeatNumber(idx) = （　　）</code><code>　　　●───インデックスが10で割り切れる場合はVIPのみ利用可とする</code></pre>
<pre lang="en"><code>	Next				</code></pre></div>
<p><br /></p>
<div>
<pre lang="en"><code>（2）	Const HIT As Boolean = True		' 当たり</code></pre>
<pre lang="en"><code>	Const MISS As Boolean = False	' はずれ</code></pre>
<pre lang="en"><code>	Dim r As Random = New Random()	' 乱数オブジェクトを作成する</code></pre>
<pre lang="en"><code>	Dim x(（　　）) As （　　）			' 要素数100個のBoolean型の配列を作る</code></pre>
<pre lang="en"><code>	（　　） idx As Integer = 0 To （　　）		' 最初はすべてを「はずれ」にしておく</code></pre>
<pre lang="en"><code>	    x(（　　）) = MISS</code></pre>
<pre lang="en"><code>	Next</code></pre>
<pre lang="en"><code>	（　　） i As Integer = 0 To （　　）</code><code><code>　　　●───</code>10個だけ「当たり」を作る</code></pre>
<pre lang="en"><code>	    x(r.Next(100)) = （　　）</code><code><code>　　　●───100未満の乱数を発生させ、それをインデックスに持つ要素を当たりとする（同じ値が出る可能性があるが重複してもよいものとする）</code>	 </code></pre>
<pre lang="en"><code>	Next</code></pre></div>
<p><br /></p>
<div>
<pre lang="en"><code>（3）	Dim x(9,9) As Integer</code><code><code></code><code><code>　　　●───</code></code>行が0〜9まで</code></pre>
<pre lang="en"><code>	For i As Integer = 0 To 9</code><code><code></code><code><code>　　　●───</code></code>列が0から9まで</code></pre>
<pre lang="en"><code>	    For （　　） As Integer = 0 To 9</code><code><code></code><code><code>　　　●───</code></code> 九九の計算結果を入れる配列を用意する</code></pre>
<pre lang="en"><code>	        x(（　　）, j) = i * j</code><code><code></code><code><code>　　　●───</code></code> i * jの値を配列に入れる</code></pre>
<pre lang="en"><code>	    Next j</code></pre>
<pre lang="en"><code>	Next i</code></pre></div>
</div>
</div>
<div id="calibre_link-14">
<div>
<div id="calibre_link-195">
<div><b>
<p><b>　<span><b>6</b></span>.<span><b>4</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
</div>
<p><br /></p>
<p>　実用的なプログラムを作成するためには、配列や繰り返し処理の利用は必須といっても過言ではありません。ここでは、配列に入れられた売上金額をもとに、合計や平均値、標準偏差といった簡単な統計値を求めるプログラムを考えてみます。これらの値を求めるには、すべての値を加算する必要があるので、繰り返し処理を使います。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-196">
<div><b>
<p><b>■売上を集計するプログラム</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />CalcSales</p>
</div>
<hr />
<p>　この章では、スーパーマーケットの売上金額をもとに、簡単な統計値を求めるプログラムを考えてみます。レジの台数は<span>6</span>台として、各レジの売上金額は配列に入れられているものとしましょう。それらの合計、平均値、標準偏差を求めるプログラムを作成してみましょう。標準偏差とはデータの散らばり具合を表す値です。</p>
<p>　標準偏差の求め方はそれほど難しくありませんが、最初に数式をお見せするとアレルギーを起こしてしまう人もいるかもしれないので、平均値を求めるところから始めましょう。平均値を求めるには、その前に合計を求める必要があります。合計をデータの個数で割った値が平均値です。</p>
<p>　プログラムの完成イメージはイラスト<span>6</span>-<span>2</span>のような感じです。</p>
<p><br /></p>
<div>
<p><img src="images/00181.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　次に、新しいプロジェクトを作成し、完成イメージにそってフォームをデザインしていきましょう。プロジェクト名はCalcSalesとしておきます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-197">
<div><b>
<p><b>■フォームのデザイン</b></p>
</b></div>
</div>
<hr />
<p>　このプログラムの処理は、配列を使った内部の処理がほとんどなので、目に見えるものは計算結果と計算を始めるためのボタンだけです。したがって、LabelコントロールとButtonコントロールを配置すればフォームのデザインは終わりです。画面<span>6</span>-<span>1</span>のようにコントロールを配置し、表<span>6</span>-<span>1</span>にそってプロパティの値を設定していってください。</p>
<p><br /></p>
<div>
<p><img src="images/00047.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p><img src="images/00275.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-198">
<div><b>
<p><b>■イベントハンドラーの記述</b></p>
</b></div>
</div>
<hr />
<p>　このプログラムの目的、つまり求めたいものは合計と平均値と標準偏差です。したがって、まずそれらの変数を宣言します。合計はInteger型で構いませんが、平均値と標準偏差は小数点以下の値があるはずなので、Double型にしましょう。合計金額には初期値として<span>0</span>を入れておきます。</p>
<p>　次に、それらの値を求めるために利用できる変数を宣言します。利用できるのは各レジの売上金額なので、Integer型の配列として宣言すればいいでしょう。売上金額には初期値として各月の金額をあらかじめ入れておくものとします（LIST<span>6</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>6</span>-<span>12</span>　変数を宣言し、配列を初期化する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim Sum As Integer = 0</code></pre>
<pre lang="en"><code>Dim Average As Double, SD As Double</code></pre>
<pre lang="en"><code>Dim Sales() As Integer = {1230, 890, 1450, 1520, 1380, 1090}</code></pre></div>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>ListBoxコントロールやDataGridViewコントロールにデータを表示してもよい</b></p>
</b></div>
<div>
<p>　売上金額の元のデータはファイルに保存されているのが普通です。また、このプログラムは合計を求めるという目的に限定されたものなので、毎月の値は表示していませんが、毎月の値を表示するならListBoxコントロールやDataGridViewコントロールを使います。</p>
</div>
</div>
<p><br /></p>
<div><b>
<p><b>■Buttonコントロールのイベントハンドラー</b></p>
</b></div>
<p>　Buttonコントロールは<span>2</span>つあり、btnCalcが合計や平均値などを計算する求めるためのボタン、btnExitがプログラムを終了させるためのボタンです。</p>
<p>　平均値を求めるためには、まず合計を求める必要がありますが、その方法は簡単です。レジの売上金額を順に合計に加算していくだけです。各レジの売上金額は配列になっているので、繰り返し処理を使ってインデックスの値を順に変えていくだけで簡単に合計が求められます。</p>
<p><br /></p>
<div>
<p><img src="images/00150.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　処理の流れを日本語の擬似コードで書いてみましょう。</p>
<div>
<pre lang="en"><code>Sumに0を入れる</code></pre>
<pre lang="en"><code>※iが0から5まで繰り返す</code></pre>
<pre lang="en"><code>　Sumに売上のi番目を加算する</code></pre>
<pre lang="en"><code>※</code></pre></div>
<p>　繰り返し処理が終了した時点でSumには合計が入っています。その値を<span>6</span>で割れば平均値が求められます。Labelコントロールにこれらの値を表示すればプログラムは半分完成です。btnCalcのClickイベントハンドラーの名前をDoCalcとして、そこまでを書いてみましょう（LIST<span>6</span>-<span>13</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>6</span>-<span>13</span>　売上の合計と平均値を求める</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub DoCalc(sender As Object, e As EventArgs) Handles</code></pre>
<pre lang="en"><code>btnCalc.Click</code></pre>
<pre lang="en"><code>        Dim Sum As Integer = 0</code></pre>
<pre lang="en"><code>        Dim Average, SD As Double</code></pre>
<pre lang="en"><code>        Dim Sales() As Integer = {1230, 890, 1450, 1520, 1380, 1090}</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To UBound(Sales)　　　●―――0から配列のインデックスの最大値まで</code></pre>
<pre lang="en"><code>            Sum += Sales(i)　　　●―――SumにSales(i)を加算していく</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>        Average = Sum / Sales.Length　　　●―――Sumを配列のサイズで割る</code></pre>
<pre lang="en"><code>        lblSum.Text = Sum.ToString()</code></pre>
<pre lang="en"><code>        lblAverage.Text = Average.ToString("F1")</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　UBound関数を使うと配列のインデックスの最大値が求められます。これを利用して「<span>0</span>から<span>5</span>まで繰り返す」と書く代わりに「<span>0</span>から配列のインデックスの最大値まで繰り返す」という書き方にしています。このような書き方にすれば、配列のインデックスがいくつであってもすべての要素を処理できるコードになります。</p>
<p>　また、配列名.Lengthというプロパティを使うと配列の要素数が求められます。ここでは、平均値を求めるときに<span>6</span>で割る代わりにSales.Lengthで割っています。この場合も、配列の要素がいくつであっても、要素の個数を使った計算ができます。</p>
<p>　平均値は小数点以下<span>1</span>位まで表示することとします。そのため、ToStringメソッドに"F<span>1</span>"という書式を指定しています（<a href="#calibre_link-15"><u>P.161</u></a>参照）。</p>
<p>　では、続いて標準偏差の求め方です。標準偏差は以下の式で求められます。</p>
<p><br /></p>
<div>
<p><img src="images/00203.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<p>　ちょっと見たところ難しそうですが、<span>1</span>つずつステップを踏んでいけば難しくはありません。上の式の中で、各データの値とデータの個数、平均値はすでに分かっています。</p>
<p>　まずやるべきことは、各データから平均値を引くことです。次にそれを<span>2</span>乗します。<span>2</span>乗といっても特別な計算ではありません。ただ、同じ値を<span>2</span>回掛けるだけです。ただし、Visual Basicでは、べき乗を求める「＾」演算子を使ったほうが簡単に表せます。</p>
<p>　続いて、それらの値の総合計を求めます。あとは総合計をデータの個数で割って<span>※<span>1</span></span>、正の平方根を求めれば、その値が標準偏差になります（図<span>6</span>-<span>16</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00260.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　各データから平均値を引き、<span>2</span>乗するには以下のような式を書きます。</p>
<div>
<pre lang="en"><code>(Sales(i) - Average) ^ 2</code></pre></div>
<p>　この総合計を求めるには、iの値を<span>0</span>から<span>5</span>まで変えながら繰り返し処理をします。総合計を求めるための変数がSSE<span>※<span>2</span></span>という名前であれば、コードはLIST<span>6</span>-<span>14</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>6</span>-<span>14</span>　平均値と各データの差の<span>2</span>乗を合計する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim SSE As Double = 0</code></pre>
<pre lang="en"><code>For i = 0 To UBound(Sales)　　　●―――0から配列のインデックスの最大値まで</code></pre>
<pre lang="en"><code>    SSE += (Sales(i) - Average) ^ 2　　　●―――(売上 - 平均)の2乗をSSEに加算していく</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<p><br /></p>
<p>　繰り返しが終了した時点で、SSEには（各データ−平均値）^<span>2</span>の総合計が入っています。これをデータの個数で割り、平方根を求めれば標準偏差になります。平方根はMath.Sqrt()というメソッドを使って求めます。()内に元の値を指定すれば、その正の平方根が求められます。例えばMath.Sqrt(<span>2</span>)の値は<span>1</span>.41421356...です。コードの続きは次のようになります（LIST<span>6</span>-<span>15</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>6</span>-<span>15</span>　標準偏差を求める</p>
</div>
<div>
<div>
<pre lang="en"><code>SD = Math.Sqrt(SSE / Sales.Length)　　　●―――SSEをデータの個数で割り、正の平方根を求める</code></pre>
<pre lang="en"><code>lblSD.Text = SD.ToString("F2")</code></pre></div>
</div>
<p><br /></p>
<p>　コードが細切れになったので、イベントハンドラー全体を見ておきましょう。以下が完成したコードです。少し長いですが、間違いのないように入力してください（LIST<span>6</span>-<span>16</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>6</span>-<span>16</span>　売上の合計、平均値、標準偏差を求めるコード</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub DoCalc(sender As Object, e As EventArgs) Handles ⇒</code></pre>
<pre lang="en"><code>btnCalc.Click</code></pre>
<pre lang="en"><code>        Dim Sum As Integer = 0</code></pre>
<pre lang="en"><code>        Dim Average As Double, SD As Double</code></pre>
<pre lang="en"><code>        Dim Sales() As Integer = {1230, 890, 1450, 1520, 1380, 1090}</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To UBound(Sales)</code></pre>
<pre lang="en"><code>            Sum += Sales(i)</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>        Average = Sum / Sales.Length</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        Dim SSE As Double = 0</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To UBound(Sales)</code></pre>
<pre lang="en"><code>            SSE += (Sales(i) - Average) ^ 2</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>        SD = Math.Sqrt(SSE / Sales.Length)</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        lblSum.Text = Sum.ToString()</code></pre>
<pre lang="en"><code>        lblAverage.Text = Average.ToString("F1")</code></pre>
<pre lang="en"><code>        lblSD.Text = SD.ToString("F2")</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　［終了（X）］ボタン（btnExit）のイベントハンドラーを作成し、コードを入力すればプログラムの完成です（LIST<span>6</span>-<span>17</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" />　<span>6</span>-<span>17</span>　プログラムを終了させるコード</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs) Handles ⇒</code></pre>
<pre lang="en"><code>btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>

  
<hr />
<div id="calibre_link-356">
<div>
<p>※2	平均値と各データの差を誤差あるいは残差と呼び、その2乗の総合計を残差平方和と呼びます。残差平方和は英語で表記するとSum of Squared Errorなので、SSEと略されることがあります。</p>
</div>
</div>
</div>
</div>
<div id="calibre_link-12">
<div>
<div id="calibre_link-199">
<div><b>
<p><b>■プログラムを実行する</b></p>
</b></div>
</div>
<hr />
<p>　コードがすべて入力できたら、［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックしてプログラムを実行します。［集計（C）］ボタンをクリックすると、売上の合計、平均値、標準偏差が表示されます（画面<span>6</span>-<span>2</span>）。</p>
<div>
<p><img src="images/00120.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div>
<p><span><b>❶</b></span>　［集計（C）］ボタンをクリックする</p>
</div>
</div>
<div>
<div>
<p><span><b>②</b></span>　合計、平均値、標準偏差が表示される</p>
</div>
</div>
<p><br /></p>
<p>　このプログラムでは、配列とFor ... Nextステートメントを組み合わせて使いました。まとめの後の練習問題に取り組み、実践的な知識を身に付けましょう。</p>
</div>
</div>
<div id="calibre_link-3">
<div>
<div><b>
<p><b>Chapter<span><b>6</b></span>のまとめ</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　配列を利用すると同じ目的に使う多くのデータを<span><b>1</b></span>つの変数名で取り扱えます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　配列の各要素はインデックスで区別されます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　配列を表す変数は参照型の変数です</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　インデックスには変数も指定できるので、インデックスの値を変えながら繰り返し処理を実行すれば配列の要素がすべて処理できます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　複数のインデックスを利用する多次元の配列も使えます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　配列は宣言時に初期化できます</b></p>
</b></div>
</div>
</div>
<div id="calibre_link-344">
<div>
<div id="calibre_link-200">
<div><b>
<p><b>練習問題</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />CalcSales<span>2</span>, CalcSales<span>3</span>, CalcSales<span>4</span></p>
</div>
<p><br /></p>
<div>
<p><span><b>［A］</b></span>サンプルプログラムを変更し、各レジの売上金額をListBoxコントロールにも表示するプログラムを作成してみてください。プロジェクト名はCalcSales<span>2</span>とします。実行結果が以下の画面のようになればいいでしょう。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00352.jpeg" alt="" /></p>
</div>
<div>
<p><span><b>ヒント</b></span>　<span>ListBoxコントロールに項目を追加するには、ListBoxコントロールのItems.Addメソッドを使います。</span></p>
</div>
<p><br /></p>
<div>
<p><span><b>［B］</b></span>サンプルプログラムを変更し、各レジの偏差値を求めるプログラムを作成してみてください。偏差値は、</p>
</div>
<p><br /></p>
<div>
<p><span>（それぞれの値－平均値）／標準偏差×10＋50</span></p>
</div>
<p><br /></p>
<div>
<p>　で求められます。プロジェクト名はCalcSales<span>3</span>とします。実行結果が以下の画面のようになればいいでしょう。CalcSales<span>2</span>では売上金額をListBoxコントロールに表示していますが、このプログラムでは偏差値を表示することに注意してください。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00266.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><span><b>［C］</b></span>　サンプルプログラムの方法だと平均値を求めるためにすべての値を合計するという繰り返し処理が必要になり、次に各データから平均値を引くためにもう一度繰り返し処理をする必要があります。</p>
</div>
<div>
<p>　　本文で紹介した標準偏差の式を変形し、次の式のようにすると、繰り返し処理を<span>1</span>回で済ませることができます。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00300.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>　この式を参考にして、サンプルプログラムを変更し、<span>1</span>回の繰り返し処理で標準偏差を求めてみてください。プロジェクト名はCalcSales<span>4</span>とします。実行結果はサンプルプログラムと同じものになります。</p>
</div>
</div>
</div>
<div id="calibre_link-35">
<div>
<div id="calibre_link-201">
<div><b>
<p><b>Chapter<span><b>7</b></span></b></p>
</b></div>
</div>
<p><br /></p>
<div><b>
<p><b>プロシージャを使ってコードをまとめる</b></p>
</b></div>
<hr />
<div>
<p>膨大な数のプログラムを効率よく開発するためには、一度作ったものは再利用するのが鉄則です。身近なレベルでいえば、よく使われる処理をプロシージャにまとめるのがその第一歩です。プログラムの中には、いくつかの場所で使われる同じ処理や、どのようなプログラムでも使われる処理があります。それらの処理に名前を付けたものがプロシージャです。プロシージャを一度作っておけば、同じコードをふたたび書く必要がなくなり、名前といくつかのデータを指定するだけで決まった処理ができるようになります。</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><span><b>7</b></span>.<span><b>1</b></span>　SubプロシージャとFunctionプロシージャ</b></p>
</b></div>
<div>
<p>Subプロシージャの利用例と特徴／Functionプロシージャの利用例と特徴／プロシージャを作成するにあたって決めておくこと</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>7</b></span>.<span><b>2</b></span>　Subプロシージャの作成と利用</b></p>
</b></div>
<div>
<p>Subプロシージャを作成する／Subプロシージャを利用する／Subプロシージャを途中で抜ける</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>7</b></span>.<span><b>3</b></span>　Functionプロシージャの作成と利用</b></p>
</b></div>
<div>
<p>Functionプロシージャを作成する／Functionプロシージャを利用する</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>7</b></span>.<span><b>4</b></span>　引数の定義と渡し方</b></p>
</b></div>
<div>
<p>値渡しと参照渡し／さまざまな方法で引数を定義する</p>
</div>
<div>
<p><br /></p>
</div>
<div><b>
<p><b><span><b>7</b></span>.<span><b>5</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
<div>
<p>色見本を表示するプログラム／フォームのデザイン／プログラムの設定値を保存する／Subプロシージャを作成する／イベントハンドラーの記述／プログラムを実行する</p>
</div>
</div>
</div>
<div id="calibre_link-330">
<div>
<div><b>
<p><b>これから学ぶこと</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　SubプロシージャとFunctionプロシージャの違いを学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Subプロシージャの作り方と利用のしかたを学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Functionプロシージャの作り方と利用のしかたを学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　引数の定義のしかたや引数の渡し方について学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　この章で学んだことがらを利用してプログラムを作成します</b></p>
</b></div>
<p><br /></p>
<div>
<p><img src="images/00325.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>　この章ではSubプロシージャやFunctionプロシージャの作り方や使い方を学びます。共通に使われる処理をプロシージャとしてまとめることは、大規模なプログラムを作成するための基本です。この章の最後では、色見本と<span>16</span>進数のカラーコードを表示するプロシージャを作成し、赤、緑、青の度合いを表すTrackBarコントロールを操作したときに、そのプロシージャを呼び出すプログラムを作成します。</p>
</div>
</div>
</div>
<div id="calibre_link-339">
<div>
<div id="calibre_link-202">
<div><b>
<p><b>　<span><b>7</b></span>.<span><b>1</b></span>　SubプロシージャとFunctionプロシージャ</b></p>
</b></div>
</div>
<p><br /></p>
<p>　<span><b>プロシージャ</b></span>を日本語にすると「手続き」です。手続きというと、所定の用紙に必要事項を書いて......という「申請」のようなイメージを抱く人がいるかもしれませんが、そうではなく、一定の手順に従って進められるひとまとまりの仕事という意味です。Visual Basicのプロシージャも、よく使われる処理に名前を付けておき、いつでも呼び出せるようにしたものです。プロシージャにはSubプロシージャと呼ばれるものやFunctionプロシージャと呼ばれるものがあります。</p>
<p>　といっても、プロシージャはここではじめて登場するものではありません。これまでに私たちはプロシージャを何度も使っています。例えば、イベントハンドラーはすべてSubプロシージャです。また、Debug.WriteLineメソッドの正体もSubプロシージャです。</p>
<p>　一方、Chapter<span>5</span>で使ったInput関数はFunctionプロシージャです。整数を文字列にするためのToStringメソッドや、平方根を求めるためのMath.Sqrtメソッドの正体も、実はFunctionプロシージャなのです。</p>
<p>　つまり、これまではすでに用意されたプロシージャを意識せずに使ってきたわけです。しかし、これからやることは自分でプロシージャを作ることです。ここでは、そのための準備として、これまでに使ったSubプロシージャやFunctionプロシージャを振り返って、特徴を確認しておきましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-203">
<div><b>
<p><b>■Subプロシージャの利用例と特徴</b></p>
</b></div>
</div>
<hr />
<p>　Debug.WriteLineメソッドを例にSubプロシージャの特徴を見てみましょう。Debug.WriteLineメソッドの書き方を図にすると図<span>7</span>-<span>1</span>のようになります。動作のイメージはイラスト<span>7</span>-<span>2</span>のような感じです。</p>
<p><br /></p>
<div>
<p><img src="images/00336.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00077.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Debugというのはクラス名ですが、クラスについてはChapter<span>8</span>で解説するので、この段階ではあまり気にしないでください。この図を見るといくつかの特徴に気が付きます。</p>
<p><br /></p>
<p>・　Subプロシージャには名前がある。この例であればWriteLineという名前になっている</p>
<p>・　Subプロシージャ名の後には()を書き、そのプロシージャで使うデータを引数として指定する</p>
<p>・　何らかの機能を実行するが、結果として値が返されることはない</p>
<p><br /></p>
<p>　このように、Subプロシージャは<span><b>引数</b></span>（ひきすう）として与えられたデータをもとに、決められた仕事をします。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-204">
<div><b>
<p><b>■Functionプロシージャの利用例と特徴</b></p>
</b></div>
</div>
<hr />
<p>　続いて、Math.Sqrtメソッドを例にFunctionプロシージャの特徴を見てみます。Math.Sqrtメソッドの書き方を図にすると図<span>7</span>-<span>2</span>のようになります。動作のイメージはイラスト<span>7</span>-<span>3</span>のような感じです。</p>
<p><br /></p>
<div>
<p><img src="images/00128.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Mathもクラス名ですが、この話も後回しにしましょう。Functionプロシージャの特徴を確認しておきます。</p>
<p><br /></p>
<div>
<p>■Functionプロシージャには名前がある。この例であればSqrtという名前になっている</p>
</div>
<div>
<p>■Functionプロシージャ名の後には( )を書き、そのプロシージャで使うデータを引数として指定する</p>
</div>
<div>
<p>■何らかの機能を実行し、結果として値を返す</p>
</div>
<p><br /></p>
<p>　Functionプロシージャが返す値は<span><b>戻り値</b></span>または返り値と呼ばれます。Functionプロシージャは引数として与えられたデータをもとに、決められた仕事をして、その結果を戻り値として返すというわけです。戻り値は、ほかの変数に代入したり、Ifステートメントの条件として指定できます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-205">
<div><b>
<p><b>■プロシージャを作成するにあたって決めておくこと</b></p>
</b></div>
</div>
<hr />
<p>　SubプロシージャとFunctionプロシージャの違いは、値を返すか返さないかの違いだけです。いずれの場合でもプロシージャには名前が付いており、必要に応じて引数を指定します。したがって、SubプロシージャやFunctionプロシージャを自分で作るには、以下のような内容を決めておく必要があります。</p>
<p><br /></p>
<div>
<p>■プロシージャ名は何か</p>
</div>
<div>
<p>■引数として受け取るデータは何か</p>
</div>
<div>
<p>■Functionプロシージャの場合は、戻り値として返すデータは何か</p>
</div>
<p><br /></p>
<p>　この<span>3</span>つのポイントを頭に入れたうえで、次の節から、実際の書き方と利用のしかたを見ていきましょう。</p>
<p><br /></p>
<div id="calibre_link-206">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）　プロシージャを作成すれば、一連の処理をまとめておくことができる</p>
</div>
<div>
<p>（  ）　プロシージャを呼び出すためには、プロシージャの内容を毎回書く必要がある</p>
</div>
<div>
<p>（  ）　プロシージャにはSubプロシージャやFunctionプロシージャがある</p>
</div>
<div>
<p>（  ）　プロシージャはプロシージャ名や引数を指定するだけで呼び出せる</p>
</div>
<div>
<p>（  ）　Subプロシージャを利用すれば処理結果を戻り値として返せる</p>
</div>
</div>
</div>
<div id="calibre_link-16">
<div>
<div id="calibre_link-207">
<div><b>
<p><b>　<span><b>7</b></span>.<span><b>2</b></span>　Subプロシージャの作成と利用</b></p>
</b></div>
</div>
<p><br /></p>
<p>　Subプロシージャを作成しておくと、複数の箇所で使われる共通の処理を一箇所にまとめて書いておくことができます。ここでは、Subプロシージャの書き方や引数の渡し方などを説明します。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-208">
<div><b>
<p><b>■Subプロシージャを作成する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />SubProcTest<span>1</span></p>
</div>
<hr />
<p>　Subプロシージャの例として、PictureBoxコントロールの背景色を変えるコードを作ってみましょう。PictureBoxコントロールははじめて使うコントロールなので、フォームに配置した様子を確認しておきます（画面<span>7</span>-<span>1</span>）。新しいプロジェクトを作成して、ぜひ実際に試してみてください。なお、背景色はBackColorプロパティに設定します。</p>
<p><br /></p>
<div>
<p><img src="images/00178.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　ここで作るSubプロシージャには、赤、緑、青の色の強さを<span>0</span>〜255の値で渡すことにします。これらの値をもとに色を表すデータを作り、それをPictureBoxコントロールのBackColorプロパティに設定しようというわけです。</p>
<p>　Subプロシージャを作るためには、前節で見たようにプロシージャ名と引数を決めておく必要があります。</p>
<p><br /></p>
<div>
<p>■プロシージャ名はSetBackColor</p>
</div>
<div>
<p>■引数は、赤、緑、青の値。引数の名前はRed, Green, Blueで、いずれもInteger型とする</p>
</div>
<p><br /></p>
<p>　これらが決まれば、Subプロシージャが作成できます。処理の中身はまだ書けませんが、必要最低限の骨格は作成できます（LIST<span>7</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>1</span>　プロシージャ名と引数を書きSubプロシージャの骨格を作る</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Sub SetBackColor(Red As Integer, Green As Integer, Blue As Integer)</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　このコードはイベントハンドラーとは異なり、自動的に作られるわけではないので、自分でコードウィンドウに入力する必要があります。コードウィンドウを表示するには、［ソリューションエクスプローラー］でフォームを選択し、［コードの表示］ボタンをクリックします（画面<span>7</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00012.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>Subプロシージャはほかのプロシージャの内側ではなく、外側に書くことに注意してください（画面<span>7</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00084.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　実際にSub...の行を入力すると、<img src="images/00137.jpeg" alt="" />キーを押して改行した時点でEnd Subが自動的に入力されます。次に一般的な書き方をまとめた後、処理の中身も見ていきましょう（図<span>7</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00208.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p id="calibre_link-20">　SubプロシージャでもPrivateやPublicなどの<span><b>アクセス指定子</b></span>を付けると<span><b>アクセスレベル</b></span>が指定できます。Privateを指定するとそのフォームの中でだけ使えるプロシージャになり、Publicを指定するとほかのフォームなどからも利用できるプロシージャになります。特に何も指定しなければ、Publicが指定されたものと見なされます。</p>
<p>　アクセスレベルも<span><b>スコープ</b></span>と同様、できるだけ小さくしておいたほうが間違いの危険が減ります。ほかのフォームからSetBackColorプロシージャを呼び出さないのであれば、Privateを指定しておいたほうがいいでしょう。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>引数が不要なSubプロシージャを作るには？</b></p>
</b></div>
<div>
<p>　特にデータを与えずに何らかの処理をしたい場合には、引数のないSubプロシージャを作ることもできます。その場合には引数のリストを書く必要はありません。ただし()は省略できません。</p>
</div>
</div>
<p><br /></p>
<p>　では、SetBackColorプロシージャのアクセスレベルをPrivateとし、プロシージャの中身を書きましょう。PictureBoxコントロールの名前をPictureBox<span>1</span>とします（LIST<span>7</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>2</span>　PictureBoxコントロールの背景色を変えるSubプロシージャを書く</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub SetBackColor(Red As Integer, Green As Integer,</code></pre>
<pre lang="en"><code>Blue As Integer)</code></pre>
<pre lang="en"><code>        PictureBox1.BackColor = Color.FromArgb(Red, Green, Blue)</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　Color.FromArgbは、透明度、赤、緑、青の度合いをもとに、色を表すデータを作るメソッドです。ここでは透明度を省略していますが、その場合は不透明が指定されたものと見なされます。赤、緑、青の度合いは引数として渡されたRed、Green、Blueの値をそのまま使います。これでSetBackColorという名前のSubプロシージャが作成できました。SetBackColorプロシージャを呼び出す方法や、引数がどのように渡されるかは次の項で見ることにしましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-209">
<div><b>
<p><b>■Subプロシージャを利用する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />SubProcTest<span>1</span>, SubProcTest<span>2</span></p>
</div>
<hr />
<p>　Subプロシージャは、名前と引数を指定するだけで簡単に呼び出せます。例えば、フォームをはじめて表示する直前にPictureBox<span>1</span>の背景色を赤にしたければ、FormのLoadイベントハンドラーに、SetBackColorプロシージャを呼び出すコードを書きます。以下のコードの骨格部分は自動的に入力できますね。フォームを選択し、［プロパティ］ウィンドウで［イベント］ボタン（<img src="images/000174.gif" alt="" />）をクリックして［Load］の欄にInitProcというイベントハンドラー名を入力します。そうすれば、SetBackColor(255,<span>0</span>,<span>0</span>）という行を書くだけで済みます。もちろん、コードをすべて自分で入力しても構いません（LIST<span>7</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>3</span>　SetBackColorプロシージャを呼び出す</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs) Handles</code></pre>
<pre lang="en"><code>MyBase.Load</code></pre>
<pre lang="en"><code>        SetBackColor(255, 0, 0)</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　このとき、コードは図<span>7</span>-<span>4</span>のような流れで実行されます。引数は順序で対応しているので、最初に指定した引数がRedに、<span>2</span>番目に指定した引数がGreenに、<span>3</span>番目に指定した引数がBlueに渡されます。</p>
<p><br /></p>
<div>
<p><img src="images/00116.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　プログラムを実行してみると、PictureBox<span>1</span>の背景色が赤になることが分かります。</p>
<p>　Subプロシージャはほかの場所からいつでも呼び出すことができます。例えば、それぞれの色の度合いを表すTrackBarコントロールがあるものとします（画面<span>7</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00257.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　これらのTrackBarコントロールのスクロールボックスが動かされたときにSetBackColorプロシージャを呼び出したければ、LIST<span>7</span>-<span>4</span>のようなコードを書くといいでしょう。さきほどのフォームにTrackBarコントロールを<span>3</span>つ追加し、trbRed、trbGreen、trbBlueという名前を付けて、以下のコードを入力してみましょう。trbRedのScrollイベントハンドラーを<span>1</span>つ作った後、Handlesの後ろに「コントロール名.イベント名」をカンマで区切って追加すると効率よくコードが入力できます。イベントハンドラーの名前はChangeColorとします。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 7</span>-<span>4</span>　TrackBarコントロールの値が変わったときにSetBackColorプロシージャを呼び出す</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ChangeColor(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles trbRed.Scroll, trbGreen.Scroll, trbBlue.Scroll</code></pre>
<pre lang="en"><code>        SetBackColor(trbRed.Value, trbGreen.Value, trbBlue.Value)</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　TrackBarコントロールのスクロールボックスを動かすと、Scrollイベントが発生するので、ここで示したイベントハンドラーが実行されます。イベントハンドラーの中ではSetBackColorプロシージャを呼び出し、それぞれのTrackBarコントロールの値を引数として渡します。これでPictureBoxコントロールの背景色が変わります。プログラムを実行して、試してみてください。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>SubプロシージャからさらにSubプロシージャを呼び出せる</b></p>
</b></div>
<div>
<p>　このChangeColorというイベントハンドラーも、トラックバーの値を変えたときに呼び出されているSubプロシージャであることは、いうまでもありません。Subプロシージャの中から、ほかのSubプロシージャを呼び出すこともできるというわけです。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-210">
<div><b>
<p><b>■Subプロシージャを途中で抜ける</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />SubProcTest<span>3</span></p>
</div>
<hr />
<p>　SetBackColorプロシージャには、引数として整数を<span>3</span>つ指定します。しかし、その値は<span>0</span>〜255でなければなりません。例えば、500といった値を指定するとプログラムの実行時にエラーとなってしまいます。このようなエラーに対処するには、いくつかの方法があります。<span>1</span>つは、適切な値が指定されていない場合には何もせずにプロシージャを抜けるという方法です。</p>
<p>　Subプロシージャを抜けるにはExit Subステートメントを書きます。SetBackColorプロシージャを修正してみましょう（LIST<span>7</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>5</span>　色の値が<span>0</span>未満であるか255より大きければプロシージャを抜ける</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Sub SetBackColor(Red As Integer, Green As Integer, Blue As ⇒</code></pre>
<pre lang="en"><code>Integer)</code></pre>
<pre lang="en"><code>        If Red &lt; 0 OrElse Red &gt; 255 Then</code></pre>
<pre lang="en"><code>            Exit Sub</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>        If Green &lt; 0 OrElse Green &gt; 255 Then</code></pre>
<pre lang="en"><code>            Exit Sub</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>        If Blue &lt; 0 OrElse Blue &gt; 255 Then</code></pre>
<pre lang="en"><code>            Exit Sub</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>        PictureBox1.BackColor = Color.FromArgb(Red, Green, Blue)</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　<span>0</span>未満の値であれば<span>0</span>が指定されたものと見なし、255を超えた場合は255が指定されたものと見なすという対処法もあります。この場合はプロシージャを途中で抜ける必要はありません（LIST<span>7</span>-<span>6</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 7</span>-<span>6</span>　色の値が<span>0</span>未満であれば<span>0</span>と見なし、255より大きければ255と見なす</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Sub SetBackColor(Red As Integer, Green As Integer, Blue As ⇒</code></pre>
<pre lang="en"><code>Integer)</code></pre>
<pre lang="en"><code>        Red = Math.Max(0, Math.Min(255, Red))</code></pre>
<pre lang="en"><code>        Green = Math.Max(0, Math.Min(255, Green))</code></pre>
<pre lang="en"><code>        Blue = Math.Max(0, Math.Min(255, Blue))</code></pre>
<pre lang="en"><code>        PictureBox1.BackColor = Color.FromArgb(Red, Green, Blue)</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<br />
<p>　値を適切な範囲内に収めるためにIfステートメントで場合分けをしてもいいのですが、Math.Minメソッドを使って255とRedの小さいほうを求め、Math.Maxメソッドを使って、その値と<span>0</span>の大きいほうを求めるという方法も使えます。例えば、Redの値が500だと、Math.Min(255,Red)の値は255になります。Math.Max(<span>0</span>, Math.Min(255,Red))なら、<span>0</span>と255の大きいほうなので255が返されます。したがって、Redの値が500の場合はRedに255が代入されることになります。GreenやBlueについても同様です。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-211">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　左のキーワードと、その正しい説明を線で結んでください。</p>
<p><br /></p>
<div>
<p><img src="images/00157.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>2.　右側の説明に従って、コードを完成させてください。</p>
<p><br /></p>
<div>
<pre lang="en"><code>（1）	    Dim x As Double = 3.14</code></pre>
<pre lang="en"><code>	    （　　） (x)　　　●─</code><code><code>─</code></code><code><code><code>─</code></code>Subプロシージャを呼び出す</code></pre>
<pre lang="en"><code>	        :</code></pre>
<pre lang="en"><code>	（　　） （　　） Multiply2(v As Double)</code><code><code>　　　●─</code><code><code>─</code></code><code><code><code>─</code></code></code> このモジュールだけで利用できるSubプロシージャを定義する</code></pre>
<pre lang="en"><code>	    v *= 2</code></pre>
<pre lang="en"><code>	    Debug.WriteLine(y)</code></pre>
<pre lang="en"><code>	End （　　）</code><code><code>　　　●─</code><code><code>─</code></code><code><code><code>─</code></code></code> プロシージャの定義の終わり	</code></pre></div>
<p><br /></p>
<div>
<pre lang="en"><code>（2）	    Dim BaseNumber As String = "2"</code></pre>
<pre lang="en"><code>		Dim Suffix As String = "nd"</code></pre>
<pre lang="en"><code>		MakeOrdinal(BaseNumber, Suffix)</code><code><code><code>　　　●─</code><code><code>─</code></code><code><code><code>─</code></code></code> </code>Subプロシージャを呼び出す</code></pre>
<pre lang="en"><code>	        :</code></pre>
<pre lang="en"><code>	（　　） （　　） MakeOrdinal(bn As （　　）, suf As （　　）)</code><code><code><code><code>　　　●─</code><code><code>─</code></code><code><code><code>─</code></code></code> </code></code>このモジュールだけで利用できるSubプロシージャを定義する			　　　　　　　　　　　</code></pre>
<pre lang="en"><code>		Dim Result As String</code></pre>
<pre lang="en"><code>		Result = bn &amp; suf</code></pre>
<pre lang="en"><code>		Debug.WriteLine(Result)</code></pre>
<pre lang="en"><code>	（　　） （　　）</code><code><code><code>　　　●─</code><code><code>─</code></code><code><code><code>─</code></code></code> </code> プロシージャの定義の終わり</code></pre></div>
</div>
</div>
<div id="calibre_link-50">
<div>
<div id="calibre_link-212">
<div><b>
<p><b>　<span><b>7</b></span>.<span><b>3</b></span>　Functionプロシージャの作成と利用</b></p>
</b></div>
</div>
<p><br /></p>
<p id="calibre_link-305">　Functionプロシージャは<span><b>関数</b></span>とも呼ばれ、よく使われる計算を簡単に実行するために使います。Functionプロシージャに引数を指定するだけで計算の結果が戻り値として返されるので、さまざまな場所で同じような計算をするときに便利です。引数の定義方法はSubプロシージャと同じなので、ここでは戻り値の指定方法を中心に説明します。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-213">
<div><b>
<p><b>■Functionプロシージャを作成する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />FunctionTest<span>1</span></p>
</div>
<hr />
<p>　Functionプロシージャの例として、曜日を整数で指定すると、「Sun」「Mon」などの曜日の名前が求められるようなコードを作ってみましょう<span>※<span>1</span></span>。Functionプロシージャを作るためには、プロシージャ名と引数のほか、<span><b>戻り値</b></span>を決めておく必要があります。</p>
<p><br /></p>
<div>
<p>■プロシージャ名はGetDayOfWeek</p>
</div>
<div>
<p>■引数は曜日を表す整数。引数の名前をDowとする。データ型はInteger型で、<span>0</span>を日曜日とする</p>
</div>
<div>
<p>■戻り値は曜日の名前を表す文字列なのでString型とする</p>
</div>
<p><br /></p>
<p>　これらが決まれば、Functionプロシージャの骨格が書けるようになります（LIST<span>7</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>7</span>　プロシージャ名と引数、戻り値のデータ型を書きFunctionプロシージャの骨格を作る</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Function GetDayOfWeek(Dow As Integer) As String</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>End Function</code></pre></div>
</div>
<p><br /></p>
<p>　Functionプロシージャも自動的に作成されるわけではないので、自分でコードウィンドウに入力する必要があります。ほかのプロシージャの内側ではなく、外側に書くということに注意してください（画面<span>7</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00000.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　実際にFunction...の行を入力すると<img src="images/00137.jpeg" alt="" />キーを押して改行した時点でEnd Functionが自動的に入力されます。Subプロシージャと異なり、Functionステートメントの最後に戻り値のデータ型を書いておくことに注意が必要です。実際の戻り値はプロシージャの中で指定します。</p>
<p>　戻り値の指定方法には<span>2</span>通りあります。<span>1</span>つはReturnステートメントに戻り値を指定する方法で、もう<span>1</span>つはプロシージャ名に値を代入する方法です。例えば、String型の変数DowNameの値を戻り値として返すなら、</p>
<div>
<pre lang="en"><code>Return DowName</code></pre></div>
<p>と書くか、</p>
<div>
<pre lang="en"><code>GetDayOfWeek = DowName</code></pre></div>
<p>と書きます。Returnステートメントの場合は、その時点でプロシージャを抜け、呼び出し元の次の処理に移ります。一方、プロシージャ名に代入した場合は、End Functionまでコードが実行されたところでプロシージャを抜け、呼び出し元の次の処理に移ります。</p>
<p>　では、一般的な書き方をまとめておきましょう。その後、処理の中身を見ていきます（図<span>7</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00114.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Functionプロシージャでも、PrivateやPublicなどのアクセス指定子を付けると、アクセスレベルが指定できます。Privateを指定すると、そのフォームの中でだけ使えるプロシージャになり、Publicを指定すると、ほかのフォームなどからも利用できるプロシージャになります。特に何も指定しなければ、Publicが指定されたものと見なされます。</p>
<p>　アクセスレベルもスコープと同様、できるだけ小さくしておいたほうが間違いの危険が減ります。ほかのフォームからGetDayOfWeekプロシージャを呼び出さないのであれば、Privateを指定しておいたほうがいいでしょう。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>引数が不要なFunctionプロシージャを作るには</b></p>
</b></div>
<div>
<p>　特にデータを与えずに何らかの処理をしたい場合には、引数のないFunctionプロシージャを作ることもできます。その場合には引数のリストを書く必要はありません。ただし、()を省略することはできません。また、戻り値の型と戻り値の指定は省略できません。</p>
</div>
</div>
<p><br /></p>
<p>　Functionプロシージャ内での処理は、引数の値をもとに曜日の文字列を求め、それを戻り値として返すだけです。曜日の文字列を求めるにはSelect Caseによる条件分岐を使っても構いませんが、引数の値が<span>0</span>なら「Sun」を、<span>1</span>なら「Mon」を......という具合に文字列を返せばいいので、配列を使うとコードが簡単になります。用意しておく配列はString型の配列で、初期値として最初の要素に「Sun」、次の要素に「Mon」を......という具合に設定しておきます。このような配列ができれば、配列のインデックスに引数の値を指定するだけで曜日の文字列が求められます（LIST<span>7</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 7</span>-<span>8</span>　曜日を表す整数から曜日の文字列を求めるFunctionプロシージャを書く（Returnステートメントに戻り値を指定する）</p>
</div>
</div>
<div></div>
<div>
<div>
<pre lang="en"><code>    Private Function GetDayOfWeek(Dow As Integer) As String</code></pre>
<pre lang="en"><code>        Dim DowName() As String = {"Sun", "Mon", "Tue", "Wed", ⇒</code></pre>
<pre lang="en"><code>"Thu", "Fri", "Sat"}</code></pre>
<pre lang="en"><code>        Return DowName(Dow)　　　●─── 配列DowNameの、引数Dowで指定された要素を返す</code></pre>
<pre lang="en"><code>    End Function</code></pre></div>
</div>
<p><br /></p>
<p>　Returnステートメントを使わずにプロシージャ名に戻り値を代入する書き方であれば、LIST<span>7</span>-<span>9</span>のようなコードになります。いずれの書き方でも同じ結果になります。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>9</span>　曜日を表す整数から曜日の文字列を求めるFunctionプロシージャを書く（プロシージャ名に値を代入して戻り値を指定する）</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Function GetDayOfWeek(Dow As Integer) As String</code></pre>
<pre lang="en"><code>        Dim DowName() As String = {"Sun", "Mon", "Tue", "Wed", ⇒</code></pre>
<pre lang="en"><code>"Thu", "Fri", "Sat"}</code></pre>
<pre lang="en"><code>        GetDayOfWeek = DowName(Dow)</code><code><code>　　　●───</code>配列DowNameの、引数Dowで指定された要素を関数の戻り値として指定する</code></pre>
<pre lang="en"><code>    End Function</code></pre></div>
</div>
<p><br /></p>
<div id="calibre_link-357"><hr />
<div>
<p>※<span>1</span>　	単に曜日を求めるだけなら、Functionプロシージャを作らなくても簡単にできる方法があるのですが、ここではFunctionプロシージャの書き方を理解するために、あえて自分で作ってみます。簡単に曜日を求める方法については<a href="#calibre_link-51"><u>P.255</u></a>の最後を参照してください。</p>
</div>
</div>
</div>
</div>
<div id="calibre_link-47">
<div>
<div id="calibre_link-214">
<div><b>
<p><b>■Functionプロシージャを利用する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />FunctionTest<span>1</span></p>
</div>
<hr />
<p id="calibre_link-51">　Functionプロシージャも、名前と引数を指定するだけで簡単に呼び出せます。例えば、Button<span>1</span>をクリックしたときに曜日を表示したいのであれば、Button<span>1</span>のClickイベントハンドラーに、GetDayOfWeekプロシージャを呼び出すコードを書きます（LIST<span>7</span>-<span>10</span>）。今日の曜日はToday.DayOfWeekプロパティで求めることができます。この値は<span>0</span>が日曜日、<span>1</span>が月曜日......といった値になっているので、GetDayOfWeek関数に渡すには好都合です。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 7</span>-<span>10</span>　GetDayOfWeekプロシージャを呼び出す</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ShowDow(sender As Object, e As EventArgs) Handles ⇒</code></pre>
<pre lang="en"><code>Button1.Click</code></pre>
<pre lang="en"><code>        Dim Message As String</code></pre>
<pre lang="en"><code>        Dim DowNumber As Integer</code></pre>
<pre lang="en"><code>        DowNumber = Today.DayOfWeek　　　●―――今日の曜日を表す数値を求める</code></pre>
<pre lang="en"><code>        Message = GetDayOfWeek(DowNumber)　　　●―――曜日の名前を求めるGetDayOfWeekプロシージャを呼び出す 	 </code></pre>
<pre lang="en"><code>        MessageBox.Show(Message)</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　GetDayOfWeek関数から返される戻り値はMessageという変数に代入され、MessageBox.Showメソッドにより、その日の曜日がメッセージボックスに表示されます。</p>
<p>　処理の流れとデータの流れを図<span>7</span>-<span>6</span>で確認しておきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00219.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　実は、曜日を求めるだけであれば、ToStringメソッドの引数に、曜日を表す書式文字を指定するだけでもできます。</p>
<div>
<pre lang="en"><code>Message = Today.DayOfWeek.ToString("ddd")</code></pre></div>
<p>　「ddd」は<span>0</span>〜<span>6</span>の数値で表された曜日を「Sun」〜「Sat」までの文字列に変換するための書式指定文字列です。「dddd」を指定すると「Sunday」〜「Saturday」の形式に変換されます。しかし、日本語の「日」「月」「火」......などに変換することはできません。</p>
<p>　次の節では、引数の定義方法をより詳しく説明します。その中で、曜日を「日」「月」「火」......などの、さまざまな形式の文字列に変換するプロシージャも紹介します。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-215">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　左のキーワードと、その正しい説明を線で結んでください。</p>
<p><br /></p>
<div>
<p><img src="images/00348.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><span><b><span><b>2</b></span>.</b></span>　右側の説明に従って、コードを完成させてください。</p>
<div>
<p><br /></p>
</div>
<div>
<pre lang="en"><code>（1）	    Dim x As Double = 1.14</code></pre>
<pre lang="en"><code>	    Debug.WriteLine(（　　）(x))1　　●─── Functionプロシージャを呼び出す</code></pre>
<pre lang="en"><code>	        :</code></pre>
<pre lang="en"><code>	（　　） （　　） Add2(v As Double) As （　　）</code><code><code>　　●───</code>このモジュールだけで利用できるFunctionプロシージャを定義する</code></pre>
<pre lang="en"><code>	    v += 2</code></pre>
<pre lang="en"><code>	    （　　） v</code><code><code>　　●───</code> 戻り値を指定する</code></pre>
<pre lang="en"><code>	End （　　）	</code><code><code>　　●───</code> プロシージャの定義の終わり</code></pre></div>
<br />
<div>
<pre lang="en"><code>（2）	    Dim Bmi As Double</code></pre>
<pre lang="en"><code>	    Bmi = GetBMI(1.71, 64.5)</code><code><code><code>　　●───</code></code>Functionプロシージャを呼び出す</code></pre>
<pre lang="en"><code>	        :</code></pre>
<pre lang="en"><code>	（　　） （　　） （　　） (Height As （　　）, Weight As ⇒　　●───このモジュールだけで利用できるFunctionプロシージャを定義する</code></pre>
<pre lang="en"><code>	（　　）) As （　　）	　</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	    If Height &gt; 3 Then （　　） 0</code><code><code><code>　　●───</code></code>身長が3メートルを超える場合は0を返す</code></pre>
<pre lang="en"><code>	    （　　） Weight / (Height * Height)</code><code><code><code>　　●───</code></code> BMI指数を返す</code></pre>
<pre lang="en"><code>	（　　） （　　）</code><code><code><code>　　●───</code></code>プロシージャの定義の終わり</code></pre></div>
</div>
</div>
<div id="calibre_link-39">
<div>
<div id="calibre_link-216">
<div><b>
<p><b>　<span><b>7</b></span>.<span><b>4</b></span>　引数の定義と渡し方</b></p>
</b></div>
</div>
<p><br /></p>
<p>　SubプロシージャやFunctionプロシージャで引数を定義するときには、値渡しであるか、参照渡しであるかが指定できます。また、異なるデータ型の引数を定義したり、省略可能な引数を定義することもできます。より使いやすいプロシージャを作るために、引数の定義の方法と引数の渡し方を身に付けましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-217">
<div><b>
<p><b>■値渡しと参照渡し</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />SwapTest<span>1</span>, SwapTest<span>2</span></p>
</div>
<hr />
<p>　プロシージャに引数を渡す方法には、値渡しと参照渡しと呼ばれる<span>2</span>つの方法があります。これまでに紹介したプロシージャでは特に何も指定していませんが、その場合は値渡しと見なされます。値渡しと参照渡しの違いは、簡単なコードを書いて実行してみると一目瞭然です。ここでは、引数に<span>1</span>加算するだけのSubプロシージャを例として説明します。</p>
<p><br /></p>
<div><b>
<p><b>■値渡し</b></p>
</b></div>
<p>　引数の定義の前に何も指定しないか、ByValを指定すると値渡しになります。その場合、元の値がコピーされ、その値が渡されます。したがって、呼び出し側の引数と呼び出されたプロシージャの引数は別のものとして扱われます。「値のコピーをあげるからプロシージャの中で自由に使ってね」という渡し方をイメージするといいでしょう（イラスト<span>7</span>-<span>4</span>）。渡された値を変更しても、元の値は変更されません。</p>
<p><br /></p>
<div>
<p><img src="images/00261.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　LIST<span>7</span>-<span>11</span>の例を見てみましょう。ここではnというInteger型の変数を用意し、<span>10</span>という値を入れておきます。それを値渡しでAdd<span>1</span>というSubプロシージャに渡します。Add<span>1</span>プロシージャでは、渡された値をiという引数で受け取り、その値を<span>1</span>増やします。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 7</span>-<span>11</span>　値渡しで引数を渡す</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Dim n As Integer = 10</code></pre>
<pre lang="en"><code>Add1(n)　　　●─── Add1プロシージャを呼び出す。nの値を渡す</code></pre>
<pre lang="en"><code>Debug.WriteLine(n)</code><code><code>　　　●───</code>nの値を表示する（nの値は変わらない）</code></pre>
<pre lang="en"><code>　:</code></pre>
<pre lang="en"><code>Sub Add1(ByVal i As Integer)</code><code><code>　　　●───</code>ByValを指定すると、値が渡される。ByValは省略してもよい</code></pre>
<pre lang="en"><code>    i += 1</code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<br />
<p>　コードを実行し、nの値を出力すると、出力ウィンドウには<span>10</span>という値が表示されます。この例の場合、nの値がコピーされてiに渡されます。Add<span>1</span>プロシージャの中ではiに<span>1</span>を加算していますが、元のnとは関係がないので、nの値は変わりません。したがって、出力ウィンドウには元の<span>10</span>という値が表示されるというわけです。加算されたのはあくまでもプロシージャの中にあるiという変数です。</p>
<p><br /></p>
<div><b>
<p><b>■参照渡し</b></p>
</b></div>
<p>　引数の定義の前にByRefを指定すると参照渡しになります。その場合は、元の値がどこにあるかという情報がプロシージャに渡されます。したがって、呼び出し側の引数と呼び出されたプロシージャの引数は、同じ変数を参照することになります。「ここにある値をプロシージャの中でも使ってね」という渡し方をイメージするといいでしょう（イラスト<span>7</span>-<span>5</span>）。プロシージャの中で引数の値を変更することにより、呼び出し側の引数の値を変えることができます。</p>
<p><br /></p>
<div>
<p><img src="images/00074.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　LIST<span>7</span>-<span>12</span>の例を見てみましょう。ここでは、nというInteger型の変数を用意し、<span>10</span>という値を入れておきます。それを参照渡しでAdd<span>1</span>というSubプロシージャに渡します。Add<span>1</span>プロシージャでは、渡された参照をiという引数で受け取り、iで示される場所にある値を<span>1</span>増やします。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>12</span>　参照渡しで引数を渡す</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Dim n As Integer = 10</code></pre>
<pre lang="en"><code>Add1(n)</code><code><code></code><code><code>　　　●───</code></code>Add1プロシージャを呼び出す。nの参照を渡す</code></pre>
<pre lang="en"><code>Debug.WriteLine(n)</code><code><code></code><code><code>　　　●───</code></code> nの値を表示する（nの値は1増えている）</code></pre>
<pre lang="en"><code>　:</code></pre>
<pre lang="en"><code>Sub Add1(ByRef i As Integer)</code><code><code></code><code><code>　　　●───</code></code>ByRefを指定すると、参照が渡される</code></pre>
<pre lang="en"><code>    i += 1</code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　コードを実行し、nの値を出力すると、出力ウィンドウには<span>11</span>という値が表示されます。この例の場合、nがどこにあるかという情報がiに渡され、それに従って計算が行われます。したがってi +=<span>1</span>はiの値を<span>1</span>加算するということではなく、iで示された場所にある値に<span>1</span>加算するということになります。そのため、元のnの値が<span>1</span>増え、出力ウィンドウには<span>11</span>が表示されるというわけです。</p>
<p>　普通、参照渡しを使うことはあまりありませんが、呼び出し元の変数の値を変えたいときには参照渡しにする必要があります。これまでに登場した例では、Integer.TryParseというメソッド（関数）で参照渡しが使われています。例えば、</p>
<div>
<pre lang="en"><code>    Integer.TryParse(txtMinute.Text, WorkingMinute)</code></pre></div>
<p>では、txtMinute.Textの文字列を整数に変換してWorkingMinuteに入れます。WorkingMinuteの値を変更する必要があるので、参照渡しが使われているというわけです。</p>
<p>　自分でプロシージャを作ってみるとさらによく分かります。例えば、<span>2</span>つの変数の値を入れ替えるSubプロシージャは、値渡しではできません（LIST<span>7</span>-<span>13</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>13</span>　値渡しの場合、呼び出し元の引数の値は変わらない</p>
</div>
</div>
<div>
<div>
<p><br /></p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Dim n As Integer = 10</code></pre>
<pre lang="en"><code>Dim m As Integer = 20</code></pre>
<pre lang="en"><code>Swap(n, m)</code><code><code></code><code><code></code><code><code>　　　●───</code></code></code>Swapプロシージャを呼び出す。nとmの値を渡す</code></pre>
<pre lang="en"><code>Debug.WriteLine(n &amp; ":" &amp; m)</code><code><code></code><code><code></code><code><code>　　　●───</code></code></code> nとmの値を表示する（値は変わらない）</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>Sub Swap(ByVal i As Integer, ByVal j As Integer)</code><code><code><code><code><code>　　　●───</code></code></code> </code>値渡し。nの値がiに、mの値がjにコピーされる</code></pre>
<pre lang="en"><code>    Dim Temp As Integer</code></pre>
<pre lang="en"><code>    Temp = i</code><code><code></code><code><code><code><code><code>　　　●───</code></code></code> </code></code>iの値とjの値を入れ替える。nとmには影響しない</code></pre>
<pre lang="en"><code>    i = j</code><code><code></code><code><code><code><code><code>　　　●───</code></code></code> </code></code>iの値とjの値を入れ替える。nとmには影響しない</code></pre>
<pre lang="en"><code>    j = Temp</code><code><code></code><code><code><code><code><code>　　　●───</code></code></code> </code></code>iの値とjの値を入れ替える。nとmには影響しない</code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<br />
<p>　この例では、iとjの値はSwapプロシージャの中で入れ替わりますが、nとmの値は入れ替わりません。iとjにはnとmの値のコピーが渡されているからです。したがって、出力ウィンドウに表示される値は元の「<span>10</span>:<span>20</span>」のままとなります。</p>
<p>　しかし、参照渡しにすれば変数の値の入れ替えができます（LIST<span>7</span>-<span>14</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 7</span>-<span>14</span>　参照渡しの場合、呼び出し元の引数の値を変えられる</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Dim n As Integer = 10</code></pre>
<pre lang="en"><code>Dim m As Integer = 20</code></pre>
<pre lang="en"><code>Swap(n, m)</code><code><code></code><code><code><code><code><code>　　　●───</code></code></code> </code></code>Swapプロシージャを呼び出す。nとmの参照を渡す</code></pre>
<pre lang="en"><code>Debug.WriteLine(n &amp; ":" &amp; m)</code><code><code></code><code><code><code><code><code>　　　●───</code></code></code> </code></code>nとmの値を表示する（値が変わっている）</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>Sub Swap(ByRef i As Integer, ByRef j As Integer)</code><code><code></code><code><code></code><code><code><code><code><code>　　　●───</code></code></code></code></code></code> 参照渡し。iはnを参照し、jはmを参照するようになる</code></pre>
<pre lang="en"><code>    Dim Temp As Integer</code></pre>
<pre lang="en"><code>    Temp = i</code><code><code></code><code><code></code><code><code></code><code><code><code><code><code>　　　●───</code></code></code></code></code></code> </code>iが参照する値とjが参照する値を入れ替える。nとmの値が入れ替わる</code></pre>
<pre lang="en"><code>    i = j</code><code><code></code><code><code></code><code><code></code><code><code><code><code><code>　　　●───</code></code></code></code></code></code> </code>iが参照する値とjが参照する値を入れ替える。nとmの値が入れ替わる</code></pre>
<pre lang="en"><code>    j = Temp</code><code><code></code><code><code></code><code><code></code><code><code><code><code><code>　　　●───</code></code></code></code></code></code> </code>iが参照する値とjが参照する値を入れ替える。nとmの値が入れ替わる</code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<br />
<p>　こちらの例では、iとjにnとmの場所が渡されるので、iで示される場所にある変数（つまりnのこと）とjで示される場所にある変数（つまりmのこと）の値が、Swapプロシージャの中で入れ替えられます。元のnとmの値が入れ替えられるので、出力ウィンドウには「<span>20</span>:<span>10</span>」と表示されます。</p>
<p><br /></p>
<div><b>
<p><b>■参照型の変数を値渡しで渡す</b></p>
</b></div>
<div>
<p><img src="images/00143.jpeg" alt="" />ReferenceTest</p>
</div>
<p>　配列を参照する変数やString型の変数など、参照型の変数を引数として定義するとき、何も指定しないかByValを指定すると、参照がそのまま渡されます。一方、ByRefを指定すると、変数の参照が渡されるので、いわば「参照の参照」が渡されることになります（図<span>7</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00129.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　この図を読み解くのには参照型に対する慣れが必要なので、いまは読み飛ばしてもらっても構いません。sという変数が100という場所にあり、文字列が200という場所にあるものとしましょう。sの値は200なので、sを見れば文字列がどこにあるかが分かります（つまり、sが文字列を参照しています）。</p>
<p>　左側の値渡しだと、sの値（200）がSubプロシージャに渡されます。つまり、引数xの値は200になります。したがって、sとxは同じ文字列を参照します。一方、右側の参照渡しだと、sの参照が渡されます。つまり100が渡されるわけです。引数xの値は100になるので、xは文字列そのものではなくsという変数を参照することになります。</p>
<p>　参照型の変数をさらに参照としてByRefで渡すことはめったにありません。参照そのものを変更したい場合を除いて、普通はByValで構わないでしょう。ただし、渡された参照をプロシージャの中でどのように扱うかによって、元の値が変わる場合や変わらない場合があるので注意が必要です。例えば、配列を参照する変数をプロシージャに渡し、For ... NextステートメントとFor Each ... Nextステートメントで処理した場合に違いが出てきます。呼び出し側のコードがLIST<span>7</span>-<span>15</span>のようなものだとします。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>15</span>　配列を参照する変数をSubプロシージャに渡す</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Dim Score(2) As Integer</code></pre>
<pre lang="en"><code>Score(0) = 78 : Score(1) = 64 : Score(2) = 88</code></pre>
<pre lang="en"><code>Add10ToAll(Score)</code></pre>
<pre lang="en"><code>Debug.WriteLine(Score(0))</code></pre></div>
</div>


<br />
<p>　Add<span>10</span>ToAllプロシージャでは、渡された引数を使って、それぞれの要素に<span>10</span>を加算します。出力ウィンドウに表示される結果は、プロシージャの内容によって変わってきます。まず、For ... Nextステートメントを使った場合です（LIST<span>7</span>-<span>16</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>16</span>　配列のすべての要素に<span>10</span>を加算する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Sub Add10ToAll(ByVal Values As Integer())</code></pre>
<pre lang="en"><code>    For i As Integer = 0 To UBound(Values)</code></pre>
<pre lang="en"><code>        Values(i) += 10　　　●―――Valuesの要素をそのまま使う</code></pre>
<pre lang="en"><code>    Next</code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<br />
<p>　Valuesには配列の参照がそのまま渡されているので、Values(i)は参照されている配列のi番の要素となります。つまり、元の配列の値が変わります。したがって、出力ウィンドウには<span>78</span>に<span>10</span>を加算した<span>88</span>が表示されます。</p>
<p>　続いて、For Each ... Nextステートメントを使った例を見てみましょう（LIST<span>7</span>-<span>17</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>17</span>　配列のすべての要素を変数に代入し、<span>10</span>を加算する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>Sub Add10ToAll(ByVal Values As Integer())</code></pre>
<pre lang="en"><code>    For Each x As Integer In Values　　　●───Valuesの要素が順にxに代入される</code></pre>
<pre lang="en"><code>        x += 10</code><code><code>　　　●───</code>xは別の変数なので、元の値は変わらない</code></pre>
<pre lang="en"><code>    Next</code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　Valuesに配列の参照がそのまま渡されているのは同じですが、For Each ... Nextステートメントで、Valuesが参照する配列の各要素を順にxに代入します。そして、xの値を加算しているので、元の配列の値は変わりません。加算されたのはあくまでもxという変数の値です。したがって、出力ウィンドウには元の<span>78</span>という値が表示されます。</p>
<p>　話がかなり細かくなりましたが、もう<span>1</span>つだけお話しておきましょう。String型の変数の場合も注意が必要です。String型の変数は参照型ですが、文字列の取り扱いが特殊なので、値型のような動きをします。String型の場合、文字列の内容を変更するときには文字列そのものが変更されるのではなく、変更後の新しい文字列が作成され、その参照が代入されます（図<span>7</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00175.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　引数としてString型の変数を渡した場合も、渡されるのは参照の値そのものですが、Subプロシージャの中で文字列を変更すると、新しい文字列が作られ、その参照が代入されます。したがって、元の文字列は変更されません。LIST<span>7</span>-<span>18</span>で確認しておきましょう。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>18</span>　文字列の参照の値が渡されるが、内容を変更すると新しい文字列が作られる</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    Dim Message As String = "今日はいい天気"</code></pre>
<pre lang="en"><code>    AddString(Message)</code></pre>
<pre lang="en"><code>    Debug.WriteLine(Message)　　　●───Message（文字列の参照）を渡す。Messageとsは同じ文字列を参照する</code></pre>
<pre lang="en"><code>End Sub</code></pre>
<pre lang="en"><code>	：</code></pre>
<pre lang="en"><code>Sub AddString(ByVal s As String)</code><code></code></pre>
<pre lang="en"><code>    s &amp;= "です"</code><code><code></code><code>　　　●───</code>sには文字列の参照が入っているが、内容を変更するために新しい文字列が作られるので、元の文字列は変わらない</code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　この場合は、sには「今日はいい天気です」という新しく作られた文字列の参照が代入されますが、元のMessageで参照される文字列の内容は変わりません。したがって、出力ウィンドウには「今日はいい天気」だけが表示されます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-218">
<div><b>
<p><b>■さまざまな方法で引数を定義する</b></p>
</b></div>
</div>
<hr />
<p>　SubプロシージャやFunctionプロシージャでは、引数のデータ型や個数の違いによって動作を変えるものがあります。例えば、ToStringメソッドは、引数を指定しない場合には数値や日付を文字列に変換するだけですが、引数に書式指定文字列を指定すると、その書式にそった形式の文字列に変換してくれます。このような、さまざまな引数が指定できるプロシージャを作ることもできます。</p>
<p><br /></p>
<div><b>
<p><b>■異なる個数の引数や異なるデータ型の引数を定義する</b></p>
</b></div>
<div>
<p><img src="images/00143.jpeg" alt="" />OverLoadTest<span>1</span>, OverLoadTest<span>2</span></p>
</div>
<p>　前節では、数値で表された曜日を文字列の曜日に変換するFunctionプロシージャを見ました。例えば、引数に<span>0</span>を指定すると「Sun」といった<span>3</span>文字の曜日が返されます。そのFunctionプロシージャを少し拡張し、形式を指定することによって「Sunday」のようなフルスペルの曜日を返したり、「日」「月」のような日本語の曜日を返したりできるようにしましょう。そのためには、同じ名前で、引数リストの内容を変えたプロシージャをもう<span>1</span>つ作ります（LIST<span>7</span>-<span>19</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>19</span>　引数の指定方法によって、異なる処理ができるFunctionプロシージャを書く</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Function GetDayOfWeek(Dow As Integer) As String</code></pre>
<pre lang="en"><code>        Dim DowName() As String = {"Sun", "Mon", "Tue", "Wed", ⇒</code></pre>
<pre lang="en"><code>"Thu", "Fri", "Sat"}</code></pre>
<pre lang="en"><code>        Return DowName(Dow)</code></pre>
<pre lang="en"><code>    End Function</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    Private Function GetDayOfWeek(Dow As Integer, idxFormat As ⇒</code></pre>
<pre lang="en"><code>Integer) As String</code></pre>
<pre lang="en"><code>        Dim DowName(,) As String = {{"Sun", "Mon", "Tue", "Wed", ⇒</code></pre>
<pre lang="en"><code>"Thu", "Fri", "Sat"}, _</code></pre>
<pre lang="en"><code>        {"Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", ⇒</code></pre>
<pre lang="en"><code>"Friday", "Saturday"}, _</code></pre>
<pre lang="en"><code>        {"日", "月", "火", "水", "木", "金", "土"}}</code></pre>
<pre lang="en"><code>        Return DowName(idxFormat, Dow)</code></pre>
<pre lang="en"><code>    End Function</code></pre></div>
</div>
<p><br /></p>
<p>　同じ名前のプロシージャが複数あるとエラーになるのではないかと心配する人もいるかもしれませんが、大丈夫です。引数のデータ型や個数が異なるので、どのような引数を指定したかによって、どちらのプロシージャを呼び出せばいいか区別できるからです。例えば、</p>
<div>
<pre lang="en"><code>GetDayOfWeek(3)</code></pre></div>
<p>と書くと、Integer型の引数が<span>1</span>個なので、上のGetDayOfWeekプロシージャが呼び出されます。結果はもちろん「Wed」となります。一方、</p>
<div>
<pre lang="en"><code>GetDayOfWeek(3, 2)</code></pre></div>
<p>と書くと、Integer型の引数が<span>2</span>個あるので、下のGetDayOfWeekプロシージャが呼び出されます。下のGetDayOfWeekプロシージャではDowNameという配列は<span>2</span>次元になっており、図<span>7</span>-<span>9</span>のように初期値が設定されています。</p>
<p><br /></p>
<div>
<p><img src="images/00329.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　最初の引数が曜日を表し、次の引数が形式を表すので、結果は「水」となります。この例では、引数の順序と配列のインデックスの順序が逆になっていることに注意してください。もう<span>1</span>つ例を見ておきましょう。あまり意味のない例ですが、引数の個数は同じでデータ型が異なる場合です（LIST<span>7</span>-<span>20</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>20</span>　引数の個数は同じで、データ型が異なるFunctionプロシージャ</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Dim i As Integer = 100</code></pre>
<pre lang="en"><code>    Dim s As String = "Hello!"</code></pre>
<pre lang="en"><code>    ShowLength(i)　　　●───引数に整数を指定</code></pre>
<pre lang="en"><code>    ShowLength(s)</code><code><code>　　　●───</code> 引数に文字列を指定</code></pre>
<pre lang="en"><code>        ：</code></pre>
<pre lang="en"><code>Private Sub ShowLength(value As Integer)</code><code><code>　　　●───</code>引数が整数の場合</code></pre>
<pre lang="en"><code>    Debug.WriteLine(value.ToString().Length)</code><code>　　　●───数値を文字列にして、その長さを出力</code></pre>
<pre lang="en"><code>			　　　　</code></pre>
<pre lang="en"><code>End Sub</code></pre>
<pre lang="en"><code>Private Sub ShowLength(value As String)</code><code><code>　　　●───</code> 引数が文字列の場合</code></pre>
<pre lang="en"><code>    Debug.WriteLine(value.Length)</code><code><code>　　　●───</code>文字列の長さを出力</code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<br />
<p>　最初に呼び出されたShowLengthプロシージャにはInteger型の引数が指定されているので、上のほうで定義されたShowLengthプロシージャが呼び出されます。次に呼び出されたShowLengthプロシージャにはString型の引数が指定されているので、下のほうで定義されたShowLengthプロシージャが呼び出されます。</p>
<p>　このように、異なる個数の引数や異なるデータ型の引数を指定し、同じ名前のプロシージャを複数個作成することを<span><b>オーバーロード</b></span>といいます。</p>
<p><br /></p>
<div><b>
<p><b>■省略可能な引数を定義する</b></p>
</b></div>
<div>
<p><img src="images/00143.jpeg" alt="" />OptionalTest<span>1</span>, OptionalTest<span>2</span></p>
</div>
<p>　さきほどのGetDayOfWeekプロシージャの場合、引数の個数が異なるだけなので、省略可能な引数を意味するOptionalというキーワードを使って<span>1</span>つのプロシージャで書くこともできます（LIST<span>7</span>-<span>21</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>21</span>　省略可能な引数を定義する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Function GetDayOfWeek(Dow As Integer, Optional⇒</code></pre>
<pre lang="en"><code>idxFormat As Integer = 0) As String</code></pre>
<pre lang="en"><code>        Dim DowName(,) As String = {{"Sun", "Mon", "Tue", "Wed",⇒</code></pre>
<pre lang="en"><code>"Thu" , "Fri", "Sat"},</code></pre>
<pre lang="en"><code>        {"Sunday", "Monday", "Tuesday", "Wednesday", "Thursday",⇒</code></pre>
<pre lang="en"><code>"Friday", "Saturday"},</code></pre>
<pre lang="en"><code>        {"日", "月", "火", "水", "木", "金", "土"}}</code></pre>
<pre lang="en"><code>        GetDayOfWeek = DowName(idxFormat, Dow)</code></pre>
<pre lang="en"><code>    End Function</code></pre></div>
</div>
<br />
<p>　Optionalを付けて定義した引数には<span><b>既定値</b></span>を指定しておく必要があります。プロシージャを呼び出すときに引数が省略されている場合、どのような値を指定したものと見なすかを決めておくというわけです。書き方は以下のとおりです。</p>
<p><br /></p>
<div>
<p><img src="images/00351.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このようにして定義されたプロシージャは、以下のいずれの方法でも呼び出せます。</p>
<div>
<pre lang="en"><code>    GetDayOfWeek(3, 2)　　　●─</code><code><code>─</code></code><code><code><code>─</code></code> 引数を省略しない</code></pre>
<pre lang="en"><code>    GetDayOfWeek(3)</code><code><code>　　　●─</code><code><code>─</code></code><code><code><code>─</code></code></code>引数を省略した。2番目の引数の値は既定値の0と見なされる</code></pre></div>
<p>　なお、Optionalを指定した引数以降のすべての引数は、省略可能である必要があります。つまり、それ以降はすべてOptionalを指定する必要があります。LIST<span>7</span>-<span>22</span>は、簡単な料金計算をするFunctionプロシージャの例です。このFunctionプロシージャでは、基本料金の種類と特約<span>1</span>、特約<span>2</span>の契約により、戻り値として返される合計金額が変わります。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>22</span>　Optionalを指定した後の引数にはすべてOptionalを指定する必要がある</p>
</div>
</div>
<div></div>
<div>
<div>
<pre lang="en"><code>    Private Function GetCharge(ContactNumber As Integer, Optional</code></pre>
<pre lang="en"><code>Special1 As Boolean = False, Optional Special2 As Boolean = False)</code></pre>
<pre lang="en"><code>As Integer</code></pre>
<pre lang="en"><code>        Dim Charge As Integer</code></pre>
<pre lang="en"><code>        Select Case ContactNumber</code></pre>
<pre lang="en"><code>            Case 0</code></pre>
<pre lang="en"><code>                Charge = 1000</code></pre>
<pre lang="en"><code>            Case 1</code></pre>
<pre lang="en"><code>                Charge = 1200</code></pre>
<pre lang="en"><code>            Case Else</code></pre>
<pre lang="en"><code>                Charge = 1500</code></pre>
<pre lang="en"><code>        End Select</code></pre>
<pre lang="en"><code>        If Special1 Then Charge += 300</code></pre>
<pre lang="en"><code>        If Special2 Then Charge += 500</code></pre>
<pre lang="en"><code>        Return Charge</code></pre>
<pre lang="en"><code>    End Function</code></pre></div>
</div>
<br />
<p>　このようなプロシージャを呼び出すとき、途中の引数を省略するには、「,」（カンマ）だけを書いておきます。例えば、<span>2</span>番目の引数を省略するなら次のように書きます。</p>
<div>
<pre lang="en"><code>x = GetCharge(1, , True)</code></pre></div>
<p>　この場合、基本料金の<span>1</span>,200円と、特約<span>2</span>の500円が適用されるので、GetChargeプロシージャの戻り値は1700になります。したがって、xには1700が代入されます。</p>
<p><br /></p>
<div><b>
<p><b>■名前付き引数を指定して呼び出す</b></p>
</b></div>
<p>　省略できる引数がたくさんある場合は、「,」が続くと見づらくなります。そのような場合には「引数名:=値」の形式で、指定したい引数だけを書くとコードが見やすくなります。さきほどの例であれば、ContactNumberという引数に<span>1</span>を、Special<span>2</span>という引数にTrueを指定するので、以下のように書くことができます。</p>
<div>
<pre lang="en"><code>x = GetCharge(ContactNumber:=1, Special2:=True)</code></pre></div>
<p>　このように、引数の名前を指定したときには、引数はどんな順序で指定しても構いません。例えば、以下のように順序を逆転させても正しく動きます。</p>
<div>
<pre lang="en"><code>x = GetCharge(Special2:=True, ContactNumber:=1)</code></pre></div>
<p>　当然のことながら、省略されている引数には既定値が適用されます。この例でもGetCharge関数が返す戻り値は1700なので、xに1700が代入されます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-219">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下のコードを実行したときに、出力ウィンドウに表示される値を答えてください。</p>
<div>
<p><br /></p>
</div>
<div>
<pre lang="en"><code>（1）	    Dim x As Double = 3.14</code></pre>
<pre lang="en"><code>	    Multiply2(x)</code></pre>
<pre lang="en"><code>	    Debug.WriteLine(x)</code></pre>
<pre lang="en"><code>	        :</code></pre>
<pre lang="en"><code>	Sub Multiply2(ByVal v As Double)</code></pre>
<pre lang="en"><code>	    v *= 2</code></pre>
<pre lang="en"><code>	End Sub</code></pre></div>
<p><br /></p>
<div>
<pre lang="en"><code>（2）	    Dim x As Double = 3.14</code></pre>
<pre lang="en"><code>	    Multiply2(x)</code></pre>
<pre lang="en"><code>	    Debug.WriteLine(x)</code></pre>
<pre lang="en"><code>	        :</code></pre>
<pre lang="en"><code>	Sub Multiply2(ByRef v As Double)</code></pre>
<pre lang="en"><code>	    v *= 2</code></pre>
<pre lang="en"><code>	End Sub<br /><br /></code></pre></div>
<p><br /></p>
<div>
<pre lang="en"><code>（3）	    Dim Message As String = "今日の日付："</code></pre>
<pre lang="en"><code>	    AddDate(Message)</code></pre>
<pre lang="en"><code>	    Debug.WriteLine(Message)</code></pre>
<pre lang="en"><code>	        ：</code></pre>
<pre lang="en"><code>	Sub AddDate(ByVal s As String)</code></pre>
<pre lang="en"><code>	    s &amp;= Today.Month &amp; "月" &amp; Today.Day &amp; "日"</code></pre>
<pre lang="en"><code>	End Sub</code></pre></div>
<p><br /></p>
<div>
<pre lang="en"><code>（4）	    Debug.WriteLine(GetSeason(2))</code></pre>
<pre lang="en"><code>	        ：</code></pre>
<pre lang="en"><code>	Function GetSeason(term As Integer, Optional en As Boolean =</code></pre>
<pre lang="en"><code>	False) As String</code></pre>
<pre lang="en"><code>	    Dim enSeason As String = {"Spring", "Summer", "Autumn", "Winter"}</code></pre>
<pre lang="en"><code>	    Dim jpSeason As String = {"春", "夏", "秋", "冬"}</code></pre>
<pre lang="en"><code>	    If en Then</code></pre>
<pre lang="en"><code>	        Return enSeason(term)</code></pre>
<pre lang="en"><code>	    Else</code></pre>
<pre lang="en"><code>	        Return jpSeason(term)</code></pre>
<pre lang="en"><code>	    End If</code></pre>
<pre lang="en"><code>	End Function</code></pre></div>
</div>
</div>
<div id="calibre_link-312">
<div>
<div id="calibre_link-220">
<div><b>
<p><b>　<span><b>7</b></span>.<span><b>5</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
</div>
<p><br /></p>
<p>　<span>7</span>.<span>2</span>節ではPictureBoxコントロールの背景色を変えるためのSubプロシージャを作成しました。そのコードを利用して、色見本とウェブページなどでよく使われる<span>16</span>進数のカラーコードを表示するプログラムを作成してみましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-221">
<div><b>
<p><b>■色見本を表示するプログラム</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />ColorMaker ,ColorMaker<span>1</span></p>
</div>
<hr />
<p>　ここで作成するプログラムでは、赤（R）、緑（G）、青（B）の度合いを<span>0</span>〜255までTrackBarコントロールで指定したり、TextBoxコントロールに入力して指定できるようにします。指定された<span>3</span>つの値から色を表すデータを求め、PictureBoxコントロールの背景色を変えます。また、<span>16</span>進数のカラーコードも表示します。</p>
<p>　プログラムの完成イメージはイラスト<span>7</span>-<span>6</span>のような感じです。</p>
<p><br /></p>
<div>
<p><img src="images/00160.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このプログラムでは、プログラムを終了するときに、設定されている色を保存しておくようにしましょう。そして、次にプログラムを実行したときに、保存された色が表示されるようにします。</p>
<p>　では、Windowsフォームアプリケーションの新しいプロジェクトを作成してください。プロジェクト名はColorMakerとします。プロジェクトができたらフォームのデザインに取りかかりましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-222">
<div><b>
<p><b>■フォームのデザイン</b></p>
</b></div>
</div>
<hr />
<p>　フォームに配置するコントロールは、TextBoxコントロール、TrackBarコントロール、PictureBoxコントロールなどです。画面<span>7</span>-<span>6</span>のようにコントロールを配置し、表<span>7</span>-<span>1</span>にそってプロパティの値を設定していってください。なお、TrackBarコントロールは［ツールボックス］の［すべてのWindowsフォーム］の下にあります。</p>
<p><br /></p>
<div>
<p><img src="images/00164.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00242.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00081.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　TrackBarコントロールのプロパティに注目しましょう。赤、緑、青の度合いは<span>0</span>〜255と決まっているので、それ以外の値が選択できないようにするため、Minimumプロパティに<span>0</span>を指定し、Maximumプロパティの255を指定しています。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-223">
<div><b>
<p><b>■プログラムの設定値を保存する</b></p>
</b></div>
</div>
<hr />
<p>　このプログラムでは、設定されている色をプログラムの終了時に保存しておきます。保存すべき値は、赤の度合い、緑の度合い、青の度合いの<span>3</span>つです。また、プログラムの起動時にはそれらの値を読み出します。そのためには難しいコードを記述しなければ......と思われるかもしれませんが、実はプロパティを設定するだけで可能です。</p>
<p>　では、trbRedコントロールの値（Valueプロパティの値）を保存するように設定しましょう。手順は画面<span>7</span>-<span>7</span>に示したとおりです。</p>
<p><br /></p>
<div>
<p><img src="images/00171.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Nameの欄には、その設定に付ける名前が自由に指定できます。ここでは、REDと入力しました。同じようにして、trbGreenのValueプロパティをGREENという名前で保存し、trbBlueのValueプロパティをBLUEという名前で保存するように設定しておいてください。</p>
<p>　このように設定しておくだけで、プログラムの終了時に自動的にプロパティの値が保存されるようになります。また、プログラムの起動時には保存された値が自動的にプロパティに設定されます。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>設定値を手動で保存したり、読み出したりするには</b></p>
</b></div>
<div>
<p>　プログラムの終了時以外に設定値を手動で保存したいときには、My.Settings.Saveメソッドを使います。例えば、赤の値を<span>0</span>に設定して保存するのであれば、以下のように記述します。</p>
</div>
<div>
<pre lang="en"><code>My.Settings.RED = 0	　　　●───「My.Settings.設定の名前」に値を代入する</code></pre>
<pre lang="en"><code>My.Settings.Save()</code><code><code>　　　●───</code>Saveメソッドを使って保存する</code></pre></div>
<div>
<p>　逆に、プログラムの起動時以外に設定値を手動で読み出したいときには、特にメソッドを使う必要はありません。My.Settingsのプロパティを利用するだけで、設定値が読み出され、利用できるようになります。</p>
</div>
<div>
<pre lang="en"><code>txtRed.Text = My.Settings.RED　　　●───「My.Settings.設定の名前」を利用する</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-224">
<div><b>
<p><b>■Subプロシージャを作成する</b></p>
</b></div>
</div>
<hr />
<p>　このプログラムでは、フォームを読み込んだときとTrackBarコントロールの値が変わったときに色見本の表示とカラーコードの表示を変更します。複数の場所で同じ処理を実行するので、Subプロシージャにまとめましょう。</p>
<p>　Subプロシージャの中でやるべきことは以下のとおりです。</p>
<p><br /></p>
<div>
<p>■TextBoxコントロールに現在の設定値を表示する</p>
</div>
<div>
<p>■PictureBoxコントロールの背景色を変える</p>
</div>
<div>
<p>■Labelコントロール（lblCode）にカラーコードを表示する</p>
</div>
<p><br /></p>
<p>　現在の設定値はプログラムの実行時にそれぞれのTrackBarコントロールのValueプロパティに読み込まれているので、それらを利用します。Subプロシージャの名前をSetBackColorとします。引数には赤、緑、青の度合いを指定するものとします。いずれもデータ型はIntegerです。コードウィンドウを表示して、以下のコードを入力しましょう（LIST<span>7</span>-<span>23</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>23</span>　PictureBoxコントロールの背景色などを変えるプロシージャを定義する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub SetBackColor(Red As Integer, Green As Integer,⇒</code></pre>
<pre lang="en"><code>Blue As Integer)</code></pre>
<pre lang="en"><code>        txtRed.Text = Red.ToString()</code></pre>
<pre lang="en"><code>        txtGreen.Text = Green.ToString()</code></pre>
<pre lang="en"><code>        txtBlue.Text = Blue.ToString()</code></pre>
<pre lang="en"><code>        picColor.BackColor = Color.FromArgb(Red, Green, Blue)</code></pre>
<pre lang="en"><code>        lblCode.Text = "#" &amp; Red.ToString("X2") &amp; Green.ToString(</code></pre>
<pre lang="en"><code>"X2") &amp; Blue.ToString("X2")</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　ToStringメソッドに指定した"X"は数値を<span>16</span>進数で表した文字列にするという意味で、その後の"<span>2</span>"は<span>2</span>桁で表示するという意味です。</p>
<p>　なお、TrackBarコントロールのValueプロパティの値はどのプロシージャからでも使えるので、引数として渡さなくてもSetBackColorプロシージャを書くことができます。しかし、ここでは<span>7</span>.<span>2</span>節で書いたコードを再利用するために、引数を利用しています。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-225">
<div><b>
<p><b>■イベントハンドラーの記述</b></p>
</b></div>
</div>
<hr />
<p>　プログラムの実行時（フォームが表示される前）には、前回の状態を表示するため、PictureBoxコントロールの背景色を変更する必要があります。また、TrackBarコントロールの値が変わったときにもPictureBoxコントロールの背景色を変更する必要があります。TextBoxコントロールにも色の度合いを表す値が入力されます。TextBoxコントロールについては<img src="images/00137.jpeg" alt="" />キーが押されたときに、PictureBoxコントロールの背景色を変更します。もちろん、いずれの場合でも<span>16</span>進数のカラーコードも正しい値に変更して表示します。</p>
<p><br /></p>
<div><b>
<p><b>■フォームのLoadイベントハンドラー</b></p>
</b></div>
<p>　フォームを読み込んだ時点の処理は、以前の設定を表示するだけです。したがって、SetColorプロシージャを呼び出すコードだけで構いません。イベントハンドラーの名前はInitProcとします。フォームのLoadイベントハンドラーを作成し、以下のように入力しましょう（LIST<span>7</span>-<span>24</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>24</span>　フォームを表示する直前にSetBackColorプロシージャを呼び出す</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs) Handles⇒</code></pre>
<pre lang="en"><code>MyBase.Load</code></pre>
<pre lang="en"><code>        SetBackColor(trbRed.Value, trbGreen.Value, trbBlue.Value)</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　<span>3</span>つのTrackBarコントロールのValueプロパティには前回の終了時の値がすでに読み込まれているので、これでPictureBoxコントロールの背景色を変えるなど、必要な処理が実行されます。</p>
<p><br /></p>
<div><b>
<p><b>■TrackBarコントロールのイベントハンドラー</b></p>
</b></div>
<p>　TrackBarコントロールは<span>3</span>つありますが、いずれも同じイベントハンドラーを呼び出します。TrackBarコントロールのイベント一覧を表示すると、Scrollイベントの欄に入力できる状態になっていますが、このプログラムではScrollイベントは使いません。ScrollイベントはTrackBarコントロールのスクロールボックスをドラッグするなどして動かしたときに発生するので、これを使えばよさそうですが、ScrollイベントではなくValueChangedイベントを使います。ValueChangedイベントは、TrackBarコントロールの値が変わったときに発生するイベントです。コードはLIST<span>7</span>-<span>25</span>のようになります。この場合も、イベントハンドラーを<span>1</span>つ作って、Handlesの後に「コントロール名.イベント名」をカンマで区切って追加すると、効率よく入力できます。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 7</span>-<span>25</span>　TrackBarコントロールの値が変わったらSetBackColorプロシージャを呼び出す</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ChangeColor(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles trbRed.ValueChanged, trbGreen.ValueChanged, ⇒</code></pre>
<pre lang="en"><code>trbBlue.ValueChanged</code></pre>
<pre lang="en"><code>        SetBackColor(trbRed.Value, trbGreen.Value, trbBlue.Value)</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　ValueChangedイベントを利用するのはTextBoxコントロールに値を入力したときに対応するためです。TextBoxコントロールの値を使ってTrackBarコントロールのValueプロパティを変更すると、TrackBarコントロールの値が変わり、スクロールボックスの位置も変わります。このとき値が変わるので、ValueChangedイベントが発生しますが、スクロールボックスを操作したわけではないのでScrollイベントは発生しません。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>異なるコントロールのイベントでも引数が同じであればイベントハンドラーが共有できる</b></p>
</b></div>
<div>
<p>　実は、ChangeColorプロシージャとInitProcプロシージャの処理はまったく同じです。したがって、このプログラムに限っていえばTrackBarコントロールのValueChangedイベントハンドラーとしてInitProcを使っても構いません。ただし、一般的なプログラムでは、フォームの読み込み時とTrackBarコントロールの利用時には異なる処理をするのが普通なので、別のプロシージャにしておくのが自然です。</p>
</div>
</div>
<p><br /></p>
<div><b>
<p><b>■TextBoxコントロールのイベントハンドラー</b></p>
</b></div>
<p>　TextBoxコントロールでは、値を入力して<img src="images/00137.jpeg" alt="" />キーを押したときに、TrackBarコントロールの値を変えるようにします。どのキーを押したか知りたいときには、KeyDownイベントハンドラーを利用します。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>KeyDownイベントとKeyPressイベントの違い</b></p>
</b></div>
<div>
<p>　KeyDownイベントに似たものにKeyPressイベントがあります。ただし、KeyPressイベントでは、どの文字が入力されたか分かりますが、どのキーが押されたかは分からないので、<img src="images/00137.jpeg" alt="" />キーを押したということを検出できません。</p>
</div>
</div>
<p><br /></p>
<p>　<span>3</span>つあるTextBoxコントロールはすべて同じイベントハンドラーを呼び出すようにします。ChangeColorByTextという名前でイベントハンドラーを作成しましょう。コードの概要だけを先に見ておきます（LIST<span>7</span>-<span>26</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>26</span>　TextBoxコントロールでキーが押されたときに実行されるイベントハンドラー</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ChangeColorByText(sender As Object, e As ⇒</code></pre>
<pre lang="en"><code>KeyEventArgs) Handles txtRed.KeyDown, txtGreen.KeyDown, ⇒</code></pre>
<pre lang="en"><code>txtBlue.KeyDown</code></pre>
<pre lang="en"><code>        If e.KeyCode = Keys.Enter Then　　　●───押されたキーが<img src="images/00137.jpeg" alt="" />キーなら</code></pre>
<pre lang="en"><code>          ' TextBoxに数値が入力されているときだけ、TrackBarコントロールの値を変える</code></pre>
<pre lang="en"><code>          ' ただし、値が0より小さいときは0と見なし、255より大きいときは255と見なす</code></pre>
<pre lang="en"><code>       End If</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　このイベントハンドラーはキーが押されるたびに呼び出されるので、<img src="images/00137.jpeg" alt="" />キーを押したときにのみ必要なコードが実行されるようにします。どのキーが押されたかは、イベントハンドラーに渡されるeという引数のKeyCodeプロパティを見れば分かるようになっています。この値が<img src="images/00137.jpeg" alt="" />キーを表すKeys.Enterと等しければ、色見本を変えたり、カラーコードを表示する処理を実行します。</p>
<p>　赤の度合いを表すTextBoxコントロールの処理に限って、Ifステートメントの中身を書いてみるとLIST<span>7</span>-<span>27</span>のようになります。以下のコードを書くには、Redという作業用の整数型変数を宣言しておく必要があります。Redという名前はSetBackColorプロシージャの引数と同じ名前ですが、変数のスコープが異なるので問題なく使えます。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>27</span>　赤の度合いを表すTextBoxコントロールの値をもとにTrackBarコントロールの値を変える</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>If e.KeyCode = Keys.Enter Then</code></pre>
<pre lang="en"><code>    If Integer.TryParse(txtRed.Text, Red) Then</code></pre>
<pre lang="en"><code>        trbRed.Value = Math.Max(0, Math.Min(255, Red))</code></pre>
<pre lang="en"><code>    Else</code></pre>
<pre lang="en"><code>        MessageBox.Show("0〜255の整数を入力してください")</code></pre>
<pre lang="en"><code>        txtRed.Focus()</code></pre>
<pre lang="en"><code>        txtRed.SelectAll()</code></pre>
<pre lang="en"><code>    End If</code></pre>
<pre lang="en"><code>        ：</code></pre>
<pre lang="en"><code>        ：</code></pre>
<pre lang="en"><code>End If</code></pre></div>
</div>
<p><br /></p>
<p>　まず、Integer.TryParseメソッドでTextBoxコントロールに入力されている文字列を整数に変換します。整数に変換できたら、<span>0</span>〜255の範囲に収まるようにします。255より大きい場合は255とし、<span>0</span>より小さい場合は<span>0</span>としています。これは<span>7</span>.<span>2</span>節でも見た方法です。</p>
<p>　文字列が整数に変換できない場合には、メッセージを表示し、TextBoxコントロールにフォーカスを移動して文字列を選択された状態にします。</p>
<p>　緑と青についても同様に書けます。イベントハンドラー全体を記しておきましょう。かなり長いですが、がんばって入力してください（LIST<span>7</span>-<span>28</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>7</span>-<span>28</span>　TextBoxコントロールの値をもとにTrackBarコントロールの値を変える</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ChangeColorByText(sender As Object, e As ⇒</code></pre>
<pre lang="en"><code>KeyEventArgs) Handles txtRed.KeyDown, txtGreen.KeyDown, ⇒</code></pre>
<pre lang="en"><code>txtBlue.KeyDown</code></pre>
<pre lang="en"><code>        Dim Red, Green, Blue As Integer</code></pre>
<pre lang="en"><code>        If e.KeyCode = Keys.Enter Then</code></pre>
<pre lang="en"><code>            If Integer.TryParse(txtRed.Text, Red) Then</code></pre>
<pre lang="en"><code>                trbRed.Value = Math.Max(0, Math.Min(255, Red))</code></pre>
<pre lang="en"><code>            Else</code></pre>
<pre lang="en"><code>                MessageBox.Show("0〜255の整数を入力してください")</code></pre>
<pre lang="en"><code>                txtRed.Focus()</code></pre>
<pre lang="en"><code>                txtRed.SelectAll()</code></pre>
<pre lang="en"><code>            End If</code></pre>
<pre lang="en"><code>            If Integer.TryParse(txtGreen.Text, Green) Then</code></pre>
<pre lang="en"><code>                trbGreen.Value = Math.Max(0, Math.Min(255, Green))</code></pre>
<pre lang="en"><code>            Else</code></pre>
<pre lang="en"><code>                MessageBox.Show("0〜255の整数を入力してください")</code></pre>
<pre lang="en"><code>                txtGreen.Focus()</code></pre>
<pre lang="en"><code>                txtGreen.SelectAll()</code></pre>
<pre lang="en"><code>            End If</code></pre>
<pre lang="en"><code>            If Integer.TryParse(txtBlue.Text, Blue) Then</code></pre>
<pre lang="en"><code>                trbBlue.Value = Math.Max(0, Math.Min(255, Blue))</code></pre>
<pre lang="en"><code>            Else</code></pre>
<pre lang="en"><code>                MessageBox.Show("0〜255の整数を入力してください")</code></pre>
<pre lang="en"><code>                txtBlue.Focus()</code></pre>
<pre lang="en"><code>                txtBlue.SelectAll()</code></pre>
<pre lang="en"><code>            End If</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　このコードを見ると、色見本の表示を変えたり、カラーコードを表示したりする処理が書かれていません。しかし、TrackBarコントロールのValueプロパティに値を代入しているので、値が変わればTrackBarコントロールのValueChangedイベントハンドラーが自動的に呼び出されます。TrackBarコントロールのValueChangedイベントハンドラーからSetBackColorプロシージャが呼び出されているので、PictureBoxコントロールの背景色やカラーコードの表示が変わります。</p>
<p><br /></p>
<div><b>
<p><b>■Buttonコントロールのイベントハンドラー</b></p>
</b></div>
<p>　Buttonコントロールのイベントハンドラーはプログラムを終了させるだけの、おなじみのコードです。以下に記しておきます（LIST<span>7</span>-<span>29</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 7</span>-<span>29</span>　プログラムを終了するためのコード</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-226">
<div><b>
<p><b>■プログラムを実行する</b></p>
</b></div>
</div>
<hr />
<p>　コードがすべて入力できたら、［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックして、プログラムを実行します。TextBoxコントロールに数値を入力したり、TrackBarコントロールのスクロールボックスを操作したりして、PictureBoxコントロールの背景色と<span>16</span>進数のカラーコードが変わることを確認しましょう。また、プログラムを終了させた後、もう一度実行し、前回の色やカラーコードが表示されるかどうかも確認してください。以下が実行例です。</p>
<p><br /></p>
<div>
<p><img src="images/00112.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div>
<p>①　プログラムの起動時には前回の値や色が表示される</p>
</div>
</div>
<div>
<div>
<p><span><b>❷</b></span>　赤、緑、青の度合いを入力するかドラッグして、赤、緑、青の度合いを変更する</p>
</div>
</div>
<div>
<div>
<p><span><b>③</b></span>　いずれの方法でも、背景色が変わり、<span>16</span>進数のカラーコードが表示される</p>
</div>
</div>
<p><br /></p>
<p>　なお、このプログラムでは、TextBoxコントロールの値を変更しても、<img src="images/00137.jpeg" alt="" />キーを押さずにほかのTextBoxコントロールをクリックすると色が変更されません。そのような場合にも色が変更されるようにするには、TextBoxのLeaveイベントハンドラーにもコードを書いておく必要があります。Leaveイベントハンドラーはコントロールからフォーカスが失われたときに実行されるので、どのキーが押されたかという判定は不要です。それ以外はLIST<span>7</span>-<span>28</span>で書いたコードと同じです。ダウンロード用のサンプルプログラムにはそのような処理も含めたプロジェクト（ColorMaker<span>1</span>）を用意しておきました。ただし、同じようなコードを何度も書くのは美しくないので、さまざまな工夫をこらしています。まとめと練習問題の後で、ぜひダウンロードして読み解いてみてください。</p>
</div>
</div>
<div id="calibre_link-306">
<div>
<div><b>
<p><b>Chapter<span><b>7</b></span>のまとめ</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　SubプロシージャやFunctionプロシージャを利用すると、よく使われる処理を<span><b>1</b></span>箇所にまとめておくことができます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　SubプロシージャやFunctionプロシージャには引数を使って値や参照を渡すことができます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Functionプロシージャは、処理の結果を戻り値として返します</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　SubプロシージャやFunctionプロシージャにもアクセスレベルが指定できるので、モジュール内だけで使えるプロシージャや、モジュールの外からも使えるプロシージャが作成できます</b></p>
</b></div>
</div>
</div>
<div id="calibre_link-326">
<div>
<div id="calibre_link-227">
<div><b>
<p><b>練習問題</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />ColorMaker</p>
</div>
<p><br /></p>
<div>
<p><span><b>［A］</b></span>整数が<span>0</span>より小さい場合には<span>0</span>とし、255より大きい場合は255とするコードをFunctionプロシージャにし、呼び出せるようにしてください。プロシージャ名はLimit<span>0</span>To255とします。例えば、</p>
</div>
<div>
<p><br /></p>
</div>
<div>
<pre lang="en"><code>trbRed.Value = Math.Max(0, Math.Min(255, Red))</code></pre></div>
<div>
<p><br /></p>
</div>
<div>
<p>　と書く代わりに、</p>
</div>
<div>
<p><br /></p>
</div>
<div>
<pre lang="en"><code>trbRed.Value = Limit0To255(Red)</code></pre></div>
<div>
<p><br /></p>
</div>
<div>
<p>　と書いて同じことができるように、Limit<span>0</span>To255プロシージャを作成してください。プロジェクト名はColorMaker<span>2</span>とします。</p>
</div>
<div>
<p><br /></p>
</div>
<div>
<p><span><b>［B］</b></span>ChangeColorByTextプロシージャの中には同じようなコードが<span>3</span>つあります。</p>
</div>
<div>
<p>　［A］のプロジェクトのコードを変更し、これをSubプロシージャにしてみてください。プロシージャ名はChangeTrackBarとし、TextBoxコントロールとTrackBarコントロールを渡せば、TextBoxコントロールの値に従って、TrackBarコントロールの値を変えるものとします。</p>
</div>
<div>
<p>　ChangeColorByTextプロシージャが以下のように書けるように、Change TrackBarプロシージャを作成してください。</p>
</div>
<p><br /></p>
<div>
<pre lang="en"><code>	    Private Sub ChangeColorByText(sender As Object ,e As ⇒</code></pre>
<pre lang="en"><code>KeyEventArgs) Handles txtRed.KeyDown, txtGreen.KeyDown, ⇒</code></pre>
<pre lang="en"><code>txtBlue.KeyDown</code></pre>
<pre lang="en"><code>	        If e.KeyCode = Keys.Enter Then</code></pre>
<pre lang="en"><code>	            ChangeTrackBar(txtRed, trbRed)</code></pre>
<pre lang="en"><code>	            ChangeTrackBar(txtGreen, trbGreen)</code></pre>
<pre lang="en"><code>	            ChangeTrackBar(txtBlue, trbBlue)</code></pre>
<pre lang="en"><code>	        End If</code></pre>
<pre lang="en"><code>	    End Sub</code></pre></div>
<p><br /></p>
<div>
<div>
<p><span><b>ヒント</b></span>　<span>以下のようなSubプロシージャの中身を考えます。</span></p>
</div>
</div>
<div>
<p><br /></p>
</div>
<div>
<pre lang="en"><code>	    Private Sub ChangeTrackBar(txtSource As TextBox, trbTarget ⇒</code></pre>
<pre lang="en"><code>As TrackBar)</code></pre>
<pre lang="en"><code>		' ここにコードを書く</code></pre>
<pre lang="en"><code>	    End Sub</code></pre></div>
<p><br /></p>
<div>
<p>　このように、引数としてコントロールを渡すこともできます。txtSource.Textと書けば、引数として渡されたTextBoxコントロールのTextプロパティが利用できます。</p>
</div>
</div>
</div>
<div id="calibre_link-10">
<div>
<div id="calibre_link-228">
<div><b>
<p><b>Chapter<span><b>8</b></span></b></p>
</b></div>
</div>
<p><br /></p>
<div><b>
<p><b>クラスを利用する</b></p>
</b></div>
<hr />
<div>
<p>プログラミングとは、世界を記述することといっても過言ではありません。しかし、これまで説明してきたプログラミングの方法は、どちらかというとコンピューターの都合に合わせたものです。例えば身長や成績を変数として表しましたが、世界には身長とか成績といったデータがポツンと存在するのではなく、人間が存在し、その人に身長や成績といった値がついてまわります。クラスを利用すれば、人やモノが持っているデータや働きを目的にそって自然に表し、プログラムの中で利用できるようになります。</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><span><b>8</b></span>.<span><b>1</b></span>　クラスとオブジェクト</b></p>
</b></div>
<div>
<p>クラスとは／オブジェクトとは</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>8</b></span>.<span><b>2</b></span>　クラスの利用</b></p>
</b></div>
<div>
<p>クラスからオブジェクトを作成する／プロパティやメソッドを利用する／共有メンバーを利用する</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>8</b></span>.<span><b>3</b></span>　クラスの作成</b></p>
</b></div>
<div>
<p>クラスを定義する／プロパティを定義する／メソッドを定義する／定義したクラスを利用する／共有メンバーを定義する</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>8</b></span>.<span><b>4</b></span>　クラスの継承</b></p>
</b></div>
<div>
<p>クラスを継承して派生クラスを定義する／インターフェイスを利用する</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>8</b></span>.<span><b>5</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
<div>
<p>フェイスチャートを表示するプログラム／フォームのデザイン／クラスを定義する／プロパティを定義する／メソッドを定義する／イベントハンドラーの記述</p>
</div>
</div>
</div>
<div id="calibre_link-41">
<div>
<div><b>
<p><b>これから学ぶこと</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>クラスからオブジェクトを作成する方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>クラスを定義する方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>クラスのプロパティやメソッドを定義する方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>基本クラスの機能を継承するとともに、新たな機能を追加した派生クラスを定義する方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>インターフェイスを利用し、さまざまなクラスで使われる機能を派生クラスに組み込む方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>この章で学んだことがらを利用してプログラムを作成します</b></p>
</b></div>
<p><br /></p>
<div>
<p><img src="images/00103.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>　この章ではクラスの定義方法や利用方法を学びます。クラスを利用すると、人やモノを自然に表現でき、さらに拡張していくこともできます。この章の最後では、企業のプロフィールをクラスとして定義し、いくつかの指標をもとに、フェイスチャートを作成するプログラムを作成します。</p>
</div>
</div>
</div>
<div id="calibre_link-308">
<div>
<div id="calibre_link-229">
<div><b>
<p><b>　<span><b>8</b></span>.<span><b>1</b></span>　クラスとオブジェクト</b></p>
</b></div>
</div>
<p><br /></p>
<p>　プログラムの中では、その仕事の目的に合わせて、人は「身長」「体重」「成績」そのほかの変数で表されます。これらの変数を個別に宣言すると、ある特定の人の身長と体重をまとめて表すことはできません。クラスを利用すると、それが可能になります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-230">
<div><b>
<p><b>■クラスとは</b></p>
</b></div>
</div>
<hr />
<p>　<span><b>クラス</b></span>とは、人やモノの性質や働きを表したものです。まず「性質」について考えてみましょう。当然のことながら、人の持つあらゆる性質を表すことは現実的でないので、目的に合わせたデータだけをまとめて表します。例えば、健康管理に関する仕事であれば、成績というデータは必要がないので、人は身長と体重などのデータをまとめたものとして表されます。</p>
<p><br /></p>
<div>
<p><img src="images/00141.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　一方、成績管理という仕事であれば、身長や体重のデータは必要がないので、人は出席日数や試験の成績などのデータをまとめたものとして表されます。</p>
<p>　つまり、クラスとは</p>
<p><br /></p>
<p><span><b>　　　ある目的に合わせて、必要な変数をまとめたもの</b></span></p>
<p><br /></p>
<p>と考えられます。このような、人やモノの持つ性質を<span><b>プロパティ</b></span>と呼びます。</p>
<p><br /></p>
<div>
<p><img src="images/00017.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　次に、「働き」について見ていきます。人は身長や体重といったデータで表されるだけでなく、食べる、寝るなどの動作ができます。健康管理といった目的に合わせて考えると、決められたカロリーの食事を摂ることもあるはずです。</p>
<p>　これまで、何らかの動作はSubプロシージャやFunctionプロシージャで表してきましたが、これらもクラスに含まれます。したがって、クラスとは</p>
<p><br /></p>
<p><span><b>　　　ある目的に合わせて、必要なプロシージャを含んだもの</b></span></p>
<p><br /></p>
<p>ということもいえます。このような、人やモノの持つ動作を<span><b>メソッド</b></span>と呼びます。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>クラスにはイベントも含まれる</b></p>
</b></div>
<div>
<p>　さらに、クラスには<span>イベント</span>も含まれますが、ここでは、これぐらいにとどめておきます。例えば「ある時間になったら寝る」など、何らかのできごとに対してプロシージャが呼び出されるようにすることも可能です。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-231">
<div><b>
<p><b>■オブジェクトとは</b></p>
</b></div>
</div>
<hr />
<p>　クラスの具体的な利用方法について説明する前に、あと<span>1</span>つだけクラスの特徴について見ておきます。「人」についてもう少し考えてみましょう。</p>
<p>　普段、私たちは人という概念と個別の人をあまり区別していません。しかし、改めて考えてみると、「人」というのはあくまで「人というのはこういうものだ」ということを表す概念であって、実体として存在するのは個別の二宮さんとか桜井さんといった人です。</p>
<p>　クラスは人の概念にあたるものです。人やモノについて「これはこういうものだ」というのを決めたものがクラスです。一方、それぞれの実体のことは<span><b>オブジェクト</b></span>とか<span><b>インスタンス</b></span>と呼ばれます。</p>
<p><br /></p>
<div>
<p><img src="images/00249.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　個々のオブジェクトは、クラスをもとにして作られます。クラスは設計図で、オブジェクトが設計図をもとにして作られた個々の実体である、と考えてもいいでしょう。新しい用語や考え方がたくさん出てきたように思われるかもしれませんが、実は、クラスとオブジェクトの関係はこれまで見てきた変数の宣言と同じです。整数という概念をもとに、個々の整数型（Integer型）変数を作ったのと同じことなのです。</p>
<p>　クラスとオブジェクトの概略はこれぐらいにしておき、次に具体的な使い方を見ていきます。イメージがつかめないという人も、いまはあまり気にせず、読み進めていってください。具体的な使い方を学んでから、もう一度ここでの説明を読み返してみると、実感が湧いてくると思います。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>クラス、オブジェクト、インスタンス</b></p>
</b></div>
<div>
<p>　Visual Basicでは、インスタンスとオブジェクトは同じ意味で使われますが、プログラミング言語によっては、クラスとインスタンスをまとめてオブジェクトと呼ぶ場合もあります。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-232">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>　以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）クラスとは目的に合わせてデータや手続きをまとめたものである</p>
</div>
<div>
<p>（  ）オブジェクトとはひな形のようなものであり、実体はクラスと呼ばれる</p>
</div>
<div>
<p>（  ）クラスにはプロパティが含まれる</p>
</div>
<div>
<p>（  ）クラスにはプロシージャは含まれない</p>
</div>
<div>
<p>（  ）Visual Basicでは、オブジェクトはインスタンスとも呼ばれる</p>
</div>
</div>
</div>
<div id="calibre_link-341">
<div>
<div id="calibre_link-233">
<div><b>
<p><b>　<span><b>8</b></span>.<span><b>2</b></span>　クラスの利用</b></p>
</b></div>
</div>
<p><br /></p>
<p>　この章では、クラスを自分で定義して利用する方法を学びます。しかし、その前に、あらかじめ用意されているクラスの利用方法を確認しておきましょう。そうすれば、自分でクラスを定義するときに、どのようなポイントを押さえておく必要があるかが分かります。また、.NET Frameworkのクラスライブラリに含まれる、さまざまな機能を持つクラスが利用できるようになります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-234">
<div><b>
<p><b>■クラスからオブジェクトを作成する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />ClassTest<span>1</span></p>
</div>
<hr />
<p>　クラスの定義や利用の方法をこれから学ぶわけですが、実は、私たちはすでにクラスを使っています。クラスを利用するには、次のような方法があります。</p>
<p><br /></p>
<div>
<p>■あらかじめ用意されたクラスからオブジェクトを作成して利用する</p>
</div>
<div>
<p>■クラスを自分で定義し、そこからオブジェクトを作成して利用する</p>
</div>
<p><br /></p>
<p>　この、「あらかじめ用意されたクラス」については、すでに使っているのです。</p>
<p>　例えば、<span>5</span>.<span>2</span>節で、乱数を取り出す例を見ました。乱数はRandomクラスからオブジェクトを作成して、Nextメソッドにより取り出したものです。Randomクラスは「乱数」というモノを表したクラスで、Nextというメソッドを含んでいるというわけです。<span>5</span>.<span>2</span>節では</p>
<div>
<pre lang="en"><code>Dim r As Random = New Random()</code></pre></div>
<p>というコードを書きました。これがクラスからオブジェクトを作成するためのコードです。Randomというキーワードが<span>2</span>つも書かれていて、奇妙な感じがします。しかし、これは<span>2</span>つのことを<span>1</span>行にまとめて書いてあるためです。</p>
<p>　ここから<span>1</span>つ<span>1</span>つ順を追ってみていきましょう。</p>
<p>　まず、クラスからオブジェクトを作成するためには、オブジェクトを参照するための変数が必要です。Randomクラスのオブジェクトを参照するための変数は以下のようにして宣言します。</p>
<div>
<pre lang="en"><code>Dim r As Random</code></pre></div>
<p>　これは、Randomクラスのオブジェクトそのものではなく、あくまでもオブジェクトを参照するための変数を宣言したにすぎません。図にすると図<span>8</span>-<span>1</span>のようなイメージです。</p>
<p><br /></p>
<div>
<p><img src="images/00113.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　rという変数は参照型の変数です。その中に乱数の値を入れるために使うのではなく、Randomクラスのオブジェクトがどこにあるのかという情報を入れておくための変数です。このコードでは、rという変数を宣言しただけで、Randomクラスのオブジェクトについてはまだ作成されていないので、うすい点線で描いてあります。</p>
<p>　ここまでは大丈夫でしょうか。単なる変数の宣言なので、難しくはないですね。では、続けます。</p>
<p>　次に、Randomクラスのオブジェクトを作成してみましょう。Newキーワードを使います。</p>
<div>
<pre lang="en"><code>New Random()</code></pre></div>
<p>　これでRandomクラスのオブジェクトが作成されます。()内には何も書いていませんが、初期値の設定などが必要な場合には、引数として書いておくこともできます。ここまでは、図<span>8</span>-<span>2</span>に示したようなイメージです。ただし、まだオブジェクトを作成しただけなので、rという変数にはRandomクラスのオブジェクトがどこにあるかという情報が入れられていません。矢印がうすい点線で描かれているのは、そのためです。</p>
<p><br /></p>
<div>
<p><img src="images/00345.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　ここからが大事なところです。すべてがつながるので、じっくりと読んでください。</p>
<p>　Newキーワードを使ってオブジェクトを作成すると、作成されたオブジェクトの参照が返されます。つまり、そのオブジェクトがどこにあるかという情報が返されます。したがって、それをrに代入してやれば、rがオブジェクトを参照するようになります。コードは次のとおりです。</p>
<div>
<pre lang="en"><code>r = New Random()</code></pre></div>
<p>　これについても、図で見ておきましょう（図<span>8</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00092.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　コードの直接的な意味は、Randomクラスがどこにあるかという情報がrに代入される（参照が代入される）というだけのことです。①の実線で示した部分がそれにあたります。参照が代入されると、変数を使ってオブジェクトが利用できるようになります。オブジェクトを利用する流れに注目すると②の点線の矢印のようなイメージになるというわけです。</p>
<p>　では、オブジェクトを参照するための変数を宣言する一般的な書き方を見ておきましょう（図<span>8</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00097.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　クラスから新しいオブジェクトを作成して、その参照を代入するコードの書き方は以下のとおりです（図<span>8</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00078.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　宣言とオブジェクトの作成をまとめて、図<span>8</span>-<span>6</span>のように書くこともできます。</p>
<p><br /></p>
<div>
<p><img src="images/00197.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このコードの意味を日本語で書くと「Randomクラスのオブジェクトを参照する変数rを宣言し、新しく作成したRandomクラスのオブジェクトの参照を代入する」ということになります。ちなみに、宣言と初期化をまとめて書く方法は、通常の変数の初期化でも同じです。</p>
<div>
<pre lang="en"><code>Dim i As Integer	　←→	 Dim i As Integer = 0</code></pre>
<pre lang="en"><code>i = 0</code></pre></div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-235">
<div><b>
<p><b>■プロパティやメソッドを利用する</b></p>
</b></div>
</div>
<hr />
<p>　オブジェクトのプロパティやメソッドは、そのオブジェクトを参照する変数名の後に「.」（ピリオド）で区切って書きます。すでにコントロールのプロパティやメソッドを何度も利用してきたので、この知識は十分身に付いていると思います。なお、オブジェクトのプロパティやメソッドをまとめて<span><b>メンバー</b></span>と呼ぶこともあります。</p>
<p>　念のため、Randomクラスのオブジェクトを作成し、Nextメソッドを呼び出す例で確認しておきましょう（LIST<span>8</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>1</span>　Randomクラスのオブジェクトを作成し、Nextメソッドを使って乱数を作成する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Dim i As Integer</code></pre>
<pre lang="en"><code>Dim r As Random = New Random()</code></pre>
<pre lang="en"><code>i = r.Next(10)　　●───Nextメソッドを使って0以上10未満の整数の乱数を作成し、iに代入する</code></pre></div>
</div>
<p><br /></p>
<p>　実は、これまで使ってきたコントロールもクラスから作られたオブジェクトです。例えば、フォームにButtonコントロールを配置すると、Button<span>1</span>という名前のコントロールが作成されます。これはButtonクラスから作成されたButton<span>1</span>という名前のオブジェクトなのです。したがって、コントロールをフォームに配置する代わりに、コードの中で作成することもできます（LIST<span>8</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>2</span>　コードを使ってButtonコントロールを作成する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Dim btnOption As Button = New Button()　　　●─── Buttonクラスのオブジェクトを作成し、btnOptionという変数で参照できるようにする</code></pre>
<pre lang="en"><code>btnOption.Text = "オプション(&amp;O)"</code><code><code>　　　●───</code>Textプロパティを設定する</code></pre>
<pre lang="en"><code>btnOption.Parent = Me</code><code><code>　　　●───</code> 親コントロールをMe（現在のフォーム）とする</code></pre></div>
</div>
<p><br /></p>
<p>　フォームデザイナーでコントロールをフォームに配置すると、Visual Basicは自動的に上記のようなコードを追加しています（ただし、それらのコードは、通常は表示されていません）。いかがでしょう。参照型の変数、クラスとオブジェクト、コントロール......と、これまでバラバラだった知識がすべてつながってきました。この節の終わりに、もう<span>1</span>つ重要な知識として、共有メンバーのお話をしておきましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-236">
<div><b>
<p><b>■共有メンバーを利用する</b></p>
</b></div>
</div>
<hr />
<p>　プロパティやメソッドを利用するには「オブジェクト名.プロパティ名」や「オブジェクト名.メソッド名」と書きます。しかし、「クラス名.プロパティ名」や「クラス名.メソッド名」と書く場合もあります。例えば、<span>4</span>.<span>2</span>節や<span>6</span>.<span>4</span>節で見た、</p>
<div>
<pre lang="en"><code>Integer.TryParse</code></pre>
<pre lang="en"><code>Math.Sqrt</code></pre></div>
<p>などがそれにあたります。IntegerクラスやMath クラスのオブジェクトを作らずに、TryParseやSqrtといったメソッドを呼び出していますね。このようなプロパティやメソッドは<span><b>共有メンバー</b></span>と呼ばれるもので、オブジェクトを作成しなくてもそのまま使えます。共有メンバーは、個々のオブジェクトの働きではなく、クラスに特有の機能なのです。なお、共有メンバーは<span><b>静的メンバー</b></span>と呼ばれることもあります。</p>
<p><br /></p>
<div>
<div id="calibre_link-298">
<div><b>
<p><b><span><b><img src="images/00053.jpeg" alt="" /><b></b></b></span>.NET Frameworkのクラスライブラリを利用するには</b></p>
</b></div>
</div>
<div>
<p>　Visual Basicのプログラムからは、.NET Frameworkのクラスライブラリが利用できます。.NET Frameworkとは、Windowsのプログラムを作成するためのさまざまな道具の集まりのことで、クラスライブラリとは文字通りクラスの図書館（＝ライブラリ）のようなものです。つまり、あらかじめ用意されたさまざまなクラスのことです。実はフォームやコントロールもクラスライブラリに含まれるFormクラスやLabelクラス、Buttonクラスなどから作られたオブジェクトなのです。この節で説明したRandomクラスも.NET Frameworkのクラスライブラリに含まれています。それ以外にも、電子メールの送信に使われるSmtpClientクラスや、電子メールのメッセージを表すMailMessageクラス、XMLドキュメントを表すXmlDocumentクラス、クリップボードを表すClipboardクラスなど、さまざまなクラスが用意されています。これらのクラスを利用する方法はすでに説明したように、次のとおりです。</p>
</div>
<p><br /></p>
<div>
<p>　■オブジェクトを参照するための変数を宣言する</p>
</div>
<div>
<p>　■新しいオブジェクトを作成し、その参照を変数に代入する</p>
</div>
<p><br /></p>
<div>
<p>　.NET Frameworkのクラスライブラリに含まれるクラスの一覧やその説明は、MSDNライブラリのページ（http://msdn.microsoft.com/ja-jp/library)から見ることができます。ページ内の一覧に表示されている［開発ツールおよび言語］の下の［.NET Framework class library］をクリックすれば、「.NET Framework<span>4</span>.<span>6</span>および<span>4</span>.<span>5</span>」というページが表示されます（バージョン番号は本書執筆時点のもの）。そのページの左側の［.NET Framework クラスライブラリ］の階層を開いていけば、さまざまなクラスの一覧やクラスのメンバーが表示できます。なお、クラスのメンバーのうち［S］のマークが付いているものが共有メンバーです。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-237">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>右側の説明に従って、コードを完成させてください。</p>
<p><br /></p>
<div>
<pre lang="en"><code>（1）	Imports System.Net.Mail　　　●─── 電子メールの配信に使うクラスを利用するための記述</code></pre>
<pre lang="en"><code>	Public Class Form1</code></pre>
<pre lang="en"><code>	    ' Visual Basicを使って電子メールを送信する</code></pre>
<pre lang="en"><code>	    ' 実際には認証などの必要がある。ここでは骨格のみを書いてみる</code></pre>
<pre lang="en"><code>	    Private Sub MailSend(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles Button1.Click</code></pre>
<pre lang="en"><code>	        Dim Msg As MailMessage　　　●───電子メールのメッセージを表すMailMessageクラスのオブジェクトを参照する変数を宣言</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	        Msg =（　　）MailMessage("sender@example.com",⇒</code></pre>
<pre lang="en"><code>"receiver@example.com")　　　●───送信者と受信者を指定してMailMessageクラスのオブジェクトを作成する</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	        Msg.</code><code><code>（　　）</code>= "メールを送信します"　　　●───件名を表すSubjectプロパティに文字列を設定する</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	        Msg.</code><code><code>（　　）</code>= "テスト用のメールです"　　　●───メールの内容を表すBodyプロパティに文字列を設定する</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	        Dim Client As SmtpClient　　　●───電子メールの送信に使われるSmtpClientクラスのオブジェクトを参照する変数を宣言</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	        Client =</code><code><code>（　　）</code>  SmtpClient("mail.example.com")　　　●───メールサーバーを指定してSmtpClientクラスのオブジェクトを作成する</code></pre>
<pre lang="en"><code>	　　　　　　　　</code><code>Client.</code><code><code>（　　）</code>(Msg)　　　●───メッセージを指定し、電子メールを送信するためのSendメソッドを呼び出す</code>
</pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	    End Sub</code></pre>
<pre lang="en"><code>	End Class</code></pre></div>
<p><br /></p>
<div>
<pre lang="en"><code>（2）	Imports System.XML</code><code><code>　　　●───</code> XMLドキュメントを取り扱うクラスを利用するための記述</code></pre>
<pre lang="en"><code>	Public Class Form1</code></pre>
<pre lang="en"><code>	    ' Visual Basicを使ってXMLドキュメントを作る</code></pre>
<pre lang="en"><code>	    Private Sub MakeXml(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles Button1.Click</code></pre>
<pre lang="en"><code>	        Dim xDoc As XmlDocument</code><code>　　　●───XMLドキュメントを表すXmlDocumentクラスのオブジェクトを参照する変数を宣言</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	        xDoc =</code><code><code>（　　）</code>  XmlDocument()</code><code>　　　●───XmlDocumentクラスのオブジェクトを作成する</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	        xDoc.</code><code><code>（　　）</code>("&lt;item&gt;&lt;title&gt;明日の天気&lt;/title&gt;&lt;/item&gt;")</code><code>　　　●───XMLドキュメントを読み込むためのLoadXmlメソッドを呼び出す</code></pre>
<pre lang="en"><code>				　　</code></pre>
<pre lang="en"><code>	        MessageBox.Show(xDoc.</code><code><code>（　　）</code>)</code><code>　　　●───内部のテキストを表すInnerTextプロパティの値をメッセージボックスに表示する</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	    End Sub</code></pre>
<pre lang="en"><code>	End Class</code></pre></div>
<p><br /></p>
<div>
<pre lang="en"><code>（3）	Imports System.Windows</code><code><code></code><code>　　　●───</code>Windowsのさまざまな機能を取り扱うクラスを利用するための記述</code></pre>
<pre lang="en"><code>	Public Class Form1</code></pre>
<pre lang="en"><code>	    ' クリップボードとテキストのやりとりをする</code></pre>
<pre lang="en"><code>	    Private Sub SendToClipBoard(sender As Object, e As⇒</code></pre>
<pre lang="en"><code>EventArgs) Handles Button1.Click</code></pre>
<pre lang="en"><code>	        Clipboard.（　　）("テストデータです")</code><code></code><code>　　　●───Clipboardクラスの共有メソッドSetTextを使ってクリップボードにテキストを入れる</code></pre>
<pre lang="en"><code>	    End Sub</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	    Private Sub ReceiveFromClipBoard(sender As Object, e As⇒</code></pre>
<pre lang="en"><code>EventArgs) Handles Button2.Click	</code></pre>
<pre lang="en"><code>	        Debug.WriteLine(（　　）.GetText())</code><code></code><code>　　　●─── Clipboardクラスの共有メソッドGetTextを使ってクリップボードからテキストを取得する</code></pre>
<pre lang="en"><code>	    End Sub</code></pre>
<pre lang="en"><code>	End Class</code></pre></div>
<p><br /></p>
</div>
</div>
<div id="calibre_link-60">
<div>
<div id="calibre_link-238">
<div><b>
<p><b>　<span><b>8</b></span>.<span><b>3</b></span>　クラスの作成</b></p>
</b></div>
</div>
<p><br /></p>
<p>　これまでは、すでに用意されているクラスからオブジェクトを作る方法を見てきました。この節では、自分でクラスを定義してみましょう。クラスにはプロパティやメソッドが含まれているので、それらを記述するのが主な作業です。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-239">
<div><b>
<p><b>■クラスを定義する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />ClassTest<span>2</span></p>
</div>
<hr />
<p>　<span>8</span>.<span>1</span>節で健康管理の話をしたので、その例をもとにクラスを作ってみましょう。人というクラスを考えてみます。クラスの名前はPersonとしましょう。コードウィンドウに以下のコードを書きます（LIST<span>8</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>3</span>　Personクラスを定義する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Class Person</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　中身はまだ何もありませんが、これでクラスが定義できました。実際にコードを入力するときには、Class Personという行を入力した時点でEnd Classが自動的に入力されます。</p>
<p>　このコードは、フォームのクラス定義の中に書くこともできますし、外側に書くこともできます（LIST<span>8</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>4</span>　クラス定義を書く位置</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Class Form1</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    Class Person</code></pre>
<pre lang="en"><code>       </code></pre>
<pre lang="en"><code>    End Class</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<div>
<div>
<pre lang="en"><code>Class Form1</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>End Class</code></pre>
<pre lang="en"><code>Class Person</code></pre>
<pre lang="en"><code>   </code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　フォームのクラス定義の中に書くと、そのクラスの中に含まれるクラスと見なされます。クラスからオブジェクトを作成する方法は、Form<span>1</span>の中では同じです。</p>
<div>
<pre lang="en"><code>Dim aPerson As Person = New Person()</code></pre></div>
<p>　=の左辺はPersonオブジェクトを参照するための変数aPersonの宣言で、=の右辺はPersonクラスのオブジェクトを作成するコードですね。Randomクラスのオブジェクトを作ったときとまったく同じ形式です。</p>
<p>　ただし、別のフォームなどからオブジェクトを作成する場合は書き方が異なります。クラス定義の中に書いた場合（左側の場合）はForm<span>1</span>の中に含まれるクラスなので、それを明示する必要があります（LIST<span>8</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>5</span>　Form<span>1</span>に含まれるPersonクラスのオブジェクトを作成する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Class Form2</code></pre>
<pre lang="en"><code>    Dim aPerson As Form1.Person = New Form1.Person()</code></pre>
<pre lang="en"><code>        :</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　Form<span>1</span>のクラス定義の外に書いた場合（右側の場合）は、最初と同じ書き方です（LIST<span>8</span>-<span>6</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>6</span>　Personクラスのオブジェクトを作成する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Class Form2</code></pre>
<pre lang="en"><code>    Dim aPerson As Person = New Person()</code></pre>
<pre lang="en"><code>        :</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　また、クラスにもPublicやPrivateなどの<span><b>アクセスレベル</b></span>が指定できます。ただし、Privateはクラスの中でクラスを定義した場合にだけ書けます。つまり、LIST<span>8</span>-<span>4</span>の左側の場合だけPrivateが指定できます（LIST<span>8</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>7</span>　PersonクラスをPrivateなクラスとして定義する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Class Form1</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    Private Class Person</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    End Class</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　このとき、Personというクラスは、Form<span>1</span>の中でしか使えません。したがって、別のフォームなどで以下のように書いてもエラーになります。</p>
<div>
<pre lang="en"><code>Dim aPerson As Form1.Person = New Form1.Person()</code></pre></div>
<p>　では、Classステートメントの書き方を整理しておきましょう（図<span>8</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00228.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　アクセスレベルの指定を省略すると、Publicが指定されたものと見なされます。しかし、混乱を防ぐためにも、アクセスレベルは指定しておいたほうがいいでしょう。なお、これ以外にもProtectedなどのアクセスレベルがありますが、<a href="#calibre_link-61"><u>P.308</u></a>で説明することにします。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-240">
<div><b>
<p><b>■プロパティを定義する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />ClassTest<span>3</span></p>
</div>
<hr />
<p>　Classステートメントを書いただけでは、まだクラスの中身が決まっていないのでまったく何もできません。そこで、プロパティを定義しましょう。例えばPersonクラスには、身長、体重というプロパティがあるものとします。プロパティの名前はHeight、Weightでいいでしょう。</p>
<p>　まずやるべきことは、これらのプロパティの値を記憶しておくために使う変数の宣言です。いずれも浮動小数点数となるはずです（LIST<span>8</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>8</span>　身長と体重を記憶しておくための変数を宣言する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Person</code></pre>
<pre lang="en"><code>    Private mHeight As Double	' Heightプロパティの値を記憶する変数</code></pre>
<pre lang="en"><code>    Private mWeight As Double	' Weightプロパティの値を記憶する変数</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　クラスの中で宣言された変数は<span><b>メンバー変数</b></span>や<span><b>フィールド</b></span>と呼ばれることがあります。これらの変数はクラスの中でだけ使うものなので、Privateで宣言しておきます。そうすれば、不用意に身長や体重の値を変更してしまうのを防ぐことができます。身長や体重の値を利用したいときや、それらの値を設定したいときには、プロパティを使うことにします。</p>
<p>　プロパティを定義するにはPropertyプロシージャを書きます。まず、Heightプロパティについて見てみましょう。メンバー変数の宣言の後に</p>
<div>
<pre lang="en"><code>Public Property Height() As Double</code></pre>
<pre lang="en"><code>End Property</code></pre></div>
<p>と入力してみてください。これがPropertyプロシージャの骨格です。続けて、プロパティの値を取得するためのGetメソッドとプロパティの値を設定するためのSetメソッドを書きます（LIST<span>8</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /> 8-9　Propertyプロシージャを作成する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Person</code></pre>
<pre lang="en"><code>    Private mHeight As Double	' Heightプロパティの値を記憶する変数</code></pre>
<pre lang="en"><code>    Private mWeight As Double	' Weightプロパティの値を記憶する変数</code></pre>
<pre lang="en"><code>    Public Property Height() As Double</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As Double)</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p>　</p>
<p>コードは少し長いですが、自動的に入力することもできます。Propertyプロシージャの骨格を作った後、その中にGetと入力して<img src="images/00137.jpeg" alt="" />キーを押すだけでコードが自動的に挿入され、LIST<span>8</span>-<span>9</span>のようになります（画面<span>8</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00293.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div>
<p><br /></p>
</div>
</div>
<div>
<p>❶　Getと入力して<img src="images/00137.jpeg" alt="" />キーを押す</p>
</div>
<div>
<p>②　GetメソッドとSetメソッドが自動的に追加される</p>
</div>
<p><br /></p>
<p>　PropertyプロシージャのGet ... End Getステートメントの中には、プロパティの値を読み出すためのコードを書きます。この例であれば、身長を表すmHeightの値を返すだけでいいので、</p>
<div>
<pre lang="en"><code>Return mHeight</code></pre></div>
<p>と書きます。必要であれば、値を返す前に何らかの処理を実行しておくこともできます。</p>
<p>　次に、Set ... End Setステートメントです。この中には、プロパティの値を設定するためのコードを書きます。プロパティに設定した値はvalueという引数に渡されるので、これをmHeightに代入します。つまり、</p>
<div>
<pre lang="en"><code>mHeight = value</code></pre></div>
<p>と書きます。この場合も、必要であれば値を代入する前に何らかの処理を実行しておくことができます。例えば、身長には負の値が設定されることはありえません。そのために、値の範囲をチェックするコードを書いておくこともできます。</p>
<p>　これで、Heightプロパティを定義するPropertyプロシージャが一応完成しました。コードは以下のようになっています（LIST<span>8</span>-<span>10</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>10</span>　Propertyプロシージャの完成例</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Property Height() As Double</code></pre>
<pre lang="en"><code>    Get</code></pre>
<pre lang="en"><code>        Return mHeight</code></pre>
<pre lang="en"><code>    End Get</code></pre>
<pre lang="en"><code>    Set(value As Double)</code></pre>
<pre lang="en"><code>        mHeight = value</code></pre>
<pre lang="en"><code>    End Set</code></pre>
<pre lang="en"><code>End Property</code></pre></div>
</div>
<p><br /></p>
<p>　ここまでのおさらいとして、メンバー変数とPropertyプロシージャの関係を図で表しておきましょう（図<span>8</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00079.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　プロパティの実際の値を入れておくための変数はPrivateで宣言されているので、直接変更することはできません。しかし、変数から値を取り出したり、変数に値を代入するためのPropertyプロシージャはPublicで宣言されているので、外部から利用することができます。つまり、プロパティを経由して、内部の変数を取り扱うというわけです。この利点は、すでに触れたように、値を取り出したり、代入したりする前に、値の範囲のチェックなど、必要な処理ができるということです。それにより、不正な値が設定されてしまうことが防げるので、プログラムのエラーを未然に防ぐのに役立ちます。</p>
<p>　このように不用意に変更されては困る変数をPrivateにし、Publicなプロパティを経由してのみ使えるようにすることを、<span><b>情報の隠蔽</b></span>（いんぺい）といいます。情報の隠蔽は、データの安全性や信頼性を高めるのに有効な考え方です。</p>
<p>　Propertyプロシージャの書き方についてもここでまとめておきましょう（図<span>8</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00033.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　ReadOnlyを指定したときには、読み出し専用のプロパティとなるので、Set ... End Setステートメントを書くことはできません。一方、WriteOnlyを指定したときには、書き込み専用のプロパティとなり、値を読み出すことができないので、Get ... End Getステートメントを書くことはできません。</p>
<p>　Getステートメントで値を返すときには、Returnステートメントに戻り値を指定します。プロパティ名に値を代入し、Exit Propertyステートメントを使ってプロシージャを抜け出しても構いません。例えば、Heightプロパティであれば、以下のように書いても構いません（LIST<span>8</span>-<span>11</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>11</span>　Propertyプロシージャを途中で抜ける</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Property Height() As Double</code></pre>
<pre lang="en"><code>    Get</code></pre>
<pre lang="en"><code>        Height = mHeight</code></pre>
<pre lang="en"><code>        Exit Property</code></pre>
<pre lang="en"><code>    End Get</code></pre>
<pre lang="en"><code>	：</code></pre>
<pre lang="en"><code>End Property</code></pre></div>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>自動実装プロパティを利用するとコードが簡単になる</b></p>
</b></div>
<div>
<p>　値の設定と取得だけを行うプロパティであれば、自動実装プロパティの利用が便利です。Propertyの後にプロパティ名とデータ型を書くだけでプロパティが定義できるので、コードがきわめて簡単になります。例えば、LIST<span>8</span>-<span>9</span>と同じように、HeightプロパティとWeightプロパティを持つPersonクラスを作成するには、以下のように書きます。GetステートメントやSetステートメントを書く必要はありません。</p>
</div>
<div>
<pre lang="en"><code>Public Class Person</code></pre>
<pre lang="en"><code>    Property Height As Double	...... Heightプロパティの定義</code></pre>
<pre lang="en"><code>    Property Weight As Double	...... Weightプロパティの定義</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<div>
<p>　これだけでLIST<span>8</span>-<span>13</span>と同じようにプロパティの値が設定・取得できるようになります。例えば、以下のように記述すれば、オブジェクトを作成し、Heightプロパティに値が設定できます。</p>
</div>
<div>
<pre lang="en"><code>    Dim aPerson As Person = New Person()</code></pre>
<pre lang="en"><code>    aPerson.Height = 170</code></pre></div>
<div>
<p>　なお、自動実装プロパティを利用した場合、プロパティ名の前に_を付けた変数がクラス内に自動的に用意されます。例えば、Heightプロパティの値は_Heightという変数に記憶されます。</p>
</div>
<div>
<p>　値の設定や取得時に何らかのチェックをかけたり、処理をしたりする場合、ReadOnlyやWriteOnlyのプロパティを定義したい場合には、自動実装プロパティだけではできないので、GetステートメントやSetステートメントを書く必要があります。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-241">
<div><b>
<p><b>■メソッドを定義する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />ClassTest<span>4</span></p>
</div>
<hr />
<p>　メソッドの正体はSubプロシージャやFunctionプロシージャです。身長と体重からBMI指数を求めるメソッドを例として見てみましょう。BMI（Body Mass Index）とは体格を表す指数で、次の式で求められます。</p>
<div>
<p><br /></p>
<p>BMI指数 = 体重 / 身長<span>2</span>（ただし、体重はkg単位、身長はm単位）</p>
<p><br /></p>
</div>
<p>　BMI指数を求めるためのメソッドは値を返す必要があるのでFunctionプロシージャを使います。これまでに学んだFunctionプロシージャをクラス定義の中にそのまま書きます。身長はcm単位で記憶されているものとし、100で割ってm単位に換算しておきます。プロシージャ名はGetBmiとしましょう（LIST<span>8</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>12</span>　BMI指数を求めるためのメソッドを定義する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Function GetBmi() As Double</code></pre>
<pre lang="en"><code>    Return mWeight / (mHeight / 100) ^ 2</code></pre>
<pre lang="en"><code>End Function</code></pre></div>
</div>
<p><br /></p>
<p>　もちろん、メソッドには必要に応じて引数も指定できます。また、メソッドが値を返さない場合にはSubプロシージャを使います。FunctionプロシージャやSubプロシージャの書き方を忘れた人はChapter<span>7</span>をもう一度読み返してみてください。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>単純に値を返すだけならプロパティにしてもよい</b></p>
</b></div>
<div>
<p>　BMI指数はメソッドとしてではなく、ReadOnlyのプロパティとして定義することもできます。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-242">
<div><b>
<p><b>■定義したクラスを利用する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />CalcBmi<span>1</span></p>
</div>
<hr />
<p>　最後に、この節で作成したPersonクラスからオブジェクトを作成し、BMI指数を求めてみましょう。新しいプロジェクトを作成し、フォームに<span>1</span>つボタンを配置すれば試せるので、ぜひ実際にやってみてください。オブジェクトを作成するには前節で見たようにNewキーワードを使います。Button<span>1</span>をクリックしたときにこのコードが実行されるものとして、クラス定義も含め、コード全体を見ておきましょう（LIST<span>8</span>-<span>13</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /> 8-13　Personクラスのオブジェクトを作成し、利用する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub ShowBmi(sender As Object, e As EventArgs) Handles ⇒</code></pre>
<pre lang="en"><code>Button1.Click</code></pre>
<pre lang="en"><code>        Dim aPerson As Person = New Person()　　　●───Personクラスのオブジェクトを参照する変数をaPersonとし、作成したオブジェクトの参照を代入する</code></pre>
<pre lang="en"><code>				</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        aPerson.Height = 170</code><code><code>　　　●───</code> Heightプロパティに170を設定する</code></pre>
<pre lang="en"><code>        aPerson.Weight = 65</code><code><code>　　　●───</code> Weightプロパティに65を設定する</code></pre>
<pre lang="en"><code>        MessageBox.Show(aPerson.GetBmi().ToString("F2"))</code><code><code>　　　●───</code>GetBmiメソッドを使ってBMI指数を求め、メッセージボックスに表示する</code></pre>
<pre lang="en"><code>    End Sub			　　</code></pre>
<pre lang="en"><code>End Class</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>Public Class Person</code></pre>
<pre lang="en"><code>    Private mHeight As Double</code></pre>
<pre lang="en"><code>    Private mWeight As Double</code></pre>
<pre lang="en"><code>    Public Property Height() As Double</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return mHeight</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As Double)</code></pre>
<pre lang="en"><code>            mHeight = value</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>    Public Property Weight() As Double</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return mWeight</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As Double)</code></pre>
<pre lang="en"><code>            mWeight = value</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>    Public Function GetBmi() As Double</code></pre>
<pre lang="en"><code>        Return mWeight / (mHeight / 100) ^ 2</code></pre>
<pre lang="en"><code>    End Function</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>

  
<br />
<p>　クラスから新しいオブジェクトを作成するためのコードはButton<span>1</span>のClickイベントハンドラーに書かれています。オブジェクトの作成方法やプロパティ、メソッドの利用方法について確認しておきましょう。</p>
<p>　このコードを実行し、Button<span>1</span>（［BMI指数］ボタン）をクリックすると、メッセージボックスには「<span>22</span>.<span>49</span>」と表示されます（画面<span>8</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00271.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>■コンストラクターとデストラクター</b></p>
</b></div>
<div>
<p><img src="images/00143.jpeg" alt="" />MakeMonster</p>
</div>
<p>　<span><b>コンストラクター</b></span>とは、オブジェクトが作成されるときに自動的に実行されるプロシージャのことです。コンストラクターを定義しておくと、メンバー変数の初期値を設定するなど、オブジェクトを利用するにあたっての準備ができます。コンストラクターは、Newという名前のSubプロシージャです。ゲームに登場するモンスターを表すクラスを例にとって見てみましょう。話を簡単にするために、モンスターには生命力（Hp）というプロパティのみがあるものとします。クラスの定義はLIST<span>8</span>-<span>14</span>のようになります。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>14</span>　モンスターを表すクラスの定義</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Monster</code></pre>
<pre lang="en"><code>    Private mHp As Integer</code></pre>
<pre lang="en"><code>    Sub New(value As Integer)</code></pre>
<pre lang="en"><code>        mHp = value</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Public Property Hp() As Integer</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return mHp</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set (value As Integer)</code></pre>
<pre lang="en"><code>            mHp = value</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　Newという名前のプロシージャは、一般的なSubプロシージャと同じ書き方です。ここでは、引数として与えられた値がmHpに代入されるので、生命力の初期値が設定されるというわけです。</p>
<p>　クラスのオブジェクトを作成すると、Newという名前のプロシージャが自動的に実行され、オブジェクトを作成するときに指定した引数が渡されます。LIST<span>8</span>-<span>15</span>のようなコードを実行すると、出力ウィンドウには<span>10</span>という値が表示されます。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>15</span>　引数を指定してオブジェクトを作成する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Dim aMonster As Monster = New Monster(10)</code><code><code><code>　　　●───</code></code>オブジェクトが作成され、10という値がNewプロシージャに渡される</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>Debug.WriteLine(aMonster.Hp)</code></pre></div>
</div>


  
  
<br />
<p>　<span>7</span>.<span>4</span>節では、<span><b>オーバーロード</b></span>することにより、同じ名前のプロシージャを複数定義する方法を学びました。名前が同じでも、引数の個数や引数のデータ型が異なるので、呼び出すときにどのプロシージャかが正しく区別できるという機能でした。これと同じことが、Newプロシージャでもできます。例えば、LIST<span>8</span>-<span>16</span>のような、引数のないNewプロシージャを追加しておけば、既定値の設定ができます。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>16</span>　Newプロシージャをオーバーロードして既定値を設定する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Sub New()</code></pre>
<pre lang="en"><code>    mHp = 20</code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<p>　これで、オブジェクトを作成するときに、引数を省略することも指定することもできるようになります。LIST<span>8</span>-<span>17</span>のようなコードを書けば、出力ウィンドウには<span>20</span>と<span>10</span>が表示されます。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>17</span>　異なるコンストラクターを利用する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Dim Monster1 As Monster = New Monster()</code><code><code></code><code><code><code>　　　●───</code></code></code> HPの値は既定値とする</code></pre>
<pre lang="en"><code>Dim Monster2 As Monster = New Monster(10)</code><code><code></code><code><code><code>　　　●───</code></code></code> HPの値は10とする</code></pre>
<pre lang="en"><code>Debug.WriteLine(Monster1.Hp)</code><code><code></code><code><code><code>　　　●───</code></code></code>20が表示される</code></pre>
<pre lang="en"><code>Debug.WriteLine(Monster2.Hp)</code><code><code></code><code><code><code>　　　●───</code></code></code>10が表示される</code></pre></div>
</div>
<p><br /></p>
<p>　プロシージャの実行が終了して、オブジェクトがもはや使われなくなってしまうと、オブジェクトは破棄されます。破棄というのは、オブジェクトによって使われていたメモリの領域などをほかの目的で使えるようにすることです。これは、使われなくなった家屋を取り壊して、更地にするようなイメージです。引っ越しをして家を使わなくなったとしても、取り壊すまでは家屋が土地を占有しています。取り壊してはじめてほかの目的に使えるようになるというわけです。オブジェクトの破棄は、オブジェクトが利用されなくなったときに自動的に実行されます。</p>
<p><br /></p>
<div>
<p><img src="images/00252.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　オブジェクトが破棄される直前に実行したい後始末などがあれば、Finalizeプロシージャにコードを書いておきます。Finalizeプロシージャは<span><b>デストラクター</b></span>と呼ばれ、オブジェクトが破棄される前に自動的に実行されます。このとき、アクセスレベルはProtectedにし、Overridesというキーワードを付けておく必要があります（LIST<span>8</span>-<span>18</span>）。以下のコードのOverridesの意味やMyBaseの意味については、次の節で説明します。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>18</span>　Finalizeメソッドに後始末のためのコードを書く</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Sub New()</code></pre>
<pre lang="en"><code>    mHp = 20</code></pre>
<pre lang="en"><code>    Debug.WriteLine("モンスターを一匹作成しました")</code></pre>
<pre lang="en"><code>End Sub</code></pre>
<pre lang="en"><code>Protected Overrides Sub Finalize()</code></pre>
<pre lang="en"><code>    Debug.WriteLine("モンスターを一匹破棄しました")</code></pre>
<pre lang="en"><code>    MyBase.Finalize()●───基本クラスのFinalizeメソッドも呼び出しておく</code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　実際には、オブジェクトが利用されなくなってもすぐにオブジェクトが破棄されるというわけではありません。オブジェクトの破棄は一定のタイミングごとに行われます。したがって、Finalizeプロシージャに書かれたメッセージは少し時間が経ってから表示されます。LIST<span>8</span>-<span>19</span>のコードを例に、オブジェクトの作成と破棄の様子を追いかけてみましょう。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>19</span>　Monsterオブジェクトを作成し、すぐにプロシージャの実行を終了するコード</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub MakeMonster(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles Button1.Click</code></pre>
<pre lang="en"><code>        Dim aMonster As Monster = New Monster()</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　Button<span>1</span>コントロールをクリックすると、MakeMonsterプロシージャにより、Monsterクラスのオブジェクトが作成されます。しかし、aMonsterの宣言がプロシージャレベルなので、プロシージャの実行が終わると作成したオブジェクトはもう使われなくなってしまいます。ところが、オブジェクトの破棄はすぐに行われないので、「モンスターを一匹破棄しました」というメッセージはこのプロシージャが終了した直後ではなく、しばらく経ってから表示されます。ただし、実際にはプロシージャの実行が終了しても、オブジェクトへの参照は保持されたままになっているので、実質的にはウィンドウを閉じたときにメッセージが表示されます（画面<span>8</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00013.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［作成と破棄（D）］ボタンをクリックする</p>
</div>
<div>
<p>②　「モンスターを一匹作成しました」というメッセージが表示される</p>
</div>
<div>
<p>❸　［<span>×</span>］をクリックしてプログラムを終了させる</p>
</div>
<div>
<p>④　「モンスターを一匹破棄しました」というメッセージが表示される</p>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>オブジェクトを即座に破棄するには</b></p>
</b></div>
<div>
<p>　オブジェクトの破棄を即座に実行しなくてはならないケースはほとんどありませんが、オブジェクトを参照する変数にNothingを代入した後、GC.Collect()メソッドを呼び出すという方法が使えます。上の例であれば、</p>
</div>
<div>
<pre lang="en"><code>    aMonster = Nothing</code></pre>
<pre lang="en"><code>    GC.Collect()</code></pre></div>
<div>
<p>とします。また、多くのコントロールでは、Disposeメソッドを使ってオブジェクトを破棄できます。例えば、Button<span>1</span>.Dispose()と書くと、即座にButton<span>1</span>コントロールが破棄されます（フォーム上からも消えます）。ただし、Disposeメソッドによりコントロールが破棄される直前に何らかの後始末をする方法は本書の範囲を大きく超えているので、ここでは触れないこととします。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-243">
<div><b>
<p><b>■共有メンバーを定義する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />CalcBmi<span>2</span></p>
</div>
<hr />
<p>　個々のオブジェクトの機能ではなく、クラスに特有な機能は共有プロパティや共有メソッドといった共有メンバーとして定義します。例えば、これまで見てきたBMI指数を求めるメソッドは、個々の人に関する機能ととらえることもできますが、どんな人にでも適用される一般的な計算です。そのような場合にはオブジェクトを作成しなくても使える<span><b>共有メンバー</b></span>にしておくと便利です。では、BMI指数を求めるメソッドを<span><b>共有メソッド</b></span>としてみましょう。LIST<span>8</span>-<span>20</span>のようにSharedというキーワードをメソッドの定義の最初に指定します。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 8</span>-<span>20</span>　BMI指数を求めるメソッドを共有メソッドにする</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Person</code></pre>
<pre lang="en"><code>        :</code></pre>
<pre lang="en"><code>    Public Shared Function GetBmi(Height As Double, Weight As⇒</code></pre>
<pre lang="en"><code>Double) As Double</code></pre>
<pre lang="en"><code>        Return Weight / (Height / 100) ^ 2</code></pre>
<pre lang="en"><code>    End Function</code></pre></div>
</div>
<p><br /></p>
<p>　共有メソッドとして定義したGetBmiメソッドは、オブジェクトを作成しなくても使えるので、以下のようなコードを書くと、出力ウィンドウにBMI指数が表示されます。</p>
<div>
<pre lang="en"><code>Debug.WriteLine(Person.GetBmi(172.1, 67.5).ToString("F2"))</code></pre></div>
<p>　共有プロパティや共有フィールド（変数）を定義する場合も同様にSharedというキーワードを付けるだけです。ただし、共有メソッドの中では共有されていないメンバーを使うことはできません。LIST<span>8</span>-<span>20</span>の例ではPersonクラスでSharedの指定がされていないmWeightやmHeightといった変数は使えません。</p>
<p>　なお、共有されていないメンバーのことを、<span><b>インスタンスメンバー</b></span>（インスタンス変数、インスタンスプロパティ、インスタンスメソッドなど）と呼ぶことがあります。これらのメンバーはインスタンス（オブジェクト）を作成してはじめて使えます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-244">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><span><b><span><b>1</b></span>.</b></span>左のキーワードと、その正しい説明を線で結んでください。</p>
<p><br /></p>
<div>
<p><img src="images/00246.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><span><b><span><b>2</b></span>.</b></span>この節で見たPersonクラスに、氏名を表すNameプロパティを追加するコードを完成させてください。</p>
<div>
<pre lang="en"><code>	Private mName As （　　）　　●───プロパティの実際の値を記憶するための変数を宣言する</code></pre>
<pre lang="en"><code>	Public （　　） Name() As String</code><code><code>　　●───</code>Nameプロパティを定義する</code></pre>
<pre lang="en"><code>	    Get</code></pre>
<pre lang="en"><code>	        Return （　　）</code><code><code>　　●───</code>プロパティの値を返す</code></pre>
<pre lang="en"><code>	    End Get</code></pre>
<pre lang="en"><code>	    Set(value As String)</code></pre>
<pre lang="en"><code>	        mName = （　　）</code><code><code>　　●───</code>プロパティに値を設定する</code></pre>
<pre lang="en"><code>	    End Set</code></pre>
<pre lang="en"><code>	End Property</code></pre></div>
<p><br /></p>
<p><span><b><span><b>3</b></span>.</b></span>この節で見たPersonクラスに、食事をするEatメソッドを追加するコードを完成させてください。Eatメソッドを実行すると引数で指定した値だけ体重が増えるものとします。</p>
<div>
<pre lang="en"><code>	Public （　　） （　　） (value As Double)</code></pre>
<pre lang="en"><code>	    mWeight （　　） （　　）　　●───mWeightにvalueの値を加算する</code></pre>
<pre lang="en"><code>	End Sub</code></pre></div>
</div>
</div>
<div id="calibre_link-354">
<div>
<div id="calibre_link-245">
<div><b>
<p><b>　<span><b>8</b></span>.<span><b>4</b></span>　クラスの継承</b></p>
</b></div>
</div>
<p><br /></p>
<p>　継承という機能を利用すると、あるクラスの機能をすべて受け継ぎ、さらに新たな機能を加えた新しいクラスを定義できます。例えば、人を表すPersonクラスの機能をすべて受け継ぎ、さらに男性に特有の値をプロパティとして持つようなMaleクラスを作ることができます。MaleクラスではPersonクラスの機能も、Maleクラス独自の機能も利用できます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-246">
<div><b>
<p><b>■クラスを継承して派生クラスを定義する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />InheritTest</p>
</div>
<hr />
<p>　前節で定義したPersonクラスは健康管理のために使われるクラスでした。クラスのプロパティとしては身長を表すHeightと体重を表すWeightとを定義しましたが、通常の健康管理のためには、最高血圧、最低血圧、赤血球数、白血球数などなど、さまざまなプロパティを定義しておく必要があります。それらはいずれもPropertyプロシージャで定義できるので、これまでの方法で追加していけば実用的なクラスが作成できるでしょう。</p>
<p>　しかし、診断項目の中には男性特有のもの（前立腺肥大、前立腺がんなど）や、女性特有のもの（子宮筋腫や子宮がんなど）もあり、より詳細な健康診断のためにはこれらのプロパティが必要になります。このとき、性別を問わずすべての項目をプロパティとして追加することもできますが、<span><b>継承</b></span>の機能を使うと、よりスッキリとクラスを定義することができます。</p>
<p>　継承というのは、あるクラスの機能をすべて受け継ぎ、それに新たな機能を加えた新しいクラスを定義することです。例えば、男性であれば、Personクラスの機能はすべて受け継ぎ、さらに男性特有の検査項目の値をプロパティとして持つようなクラスを定義するというわけです。例えば、男性クラスの名前をMaleクラスとすると、イラスト<span>8</span>-<span>6</span>のようなイメージのクラスが作成できるというわけです。</p>
<p><br /></p>
<div>
<p><img src="images/00123.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　この場合、継承元にあたるクラスを<span><b>親クラス</b></span>や<span><b>基本クラス</b></span>と呼びます。また、継承されたクラスを<span><b>子クラス</b></span>や<span><b>派生クラス</b></span>と呼びます。したがって、Personクラスが基本クラス、Maleクラスが派生クラスになるわけです。</p>
<p>　具体的なコードを見てみましょう。まず、Maleクラスを作るには、Personクラスの機能を受け継いでいることを書く必要があります（LIST<span>8</span>-<span>21</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>21</span>　Personクラスを継承したMaleクラスを定義する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Male</code></pre>
<pre lang="en"><code>    Inherits Person</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>クラスのアクセスレベルに注意</b></p>
</b></div>
<div>
<p>　フォームの外側でPersonクラスを作成した場合、Personクラスを継承できるようにするには、Personクラスの定義にPublicキーワードを付けておく必要があります。</p>
</div>
</div>
<p><br /></p>
<p>　Inheritsは「継承する」という意味です。つまり、MaleクラスはPersonクラスの機能を受け継いでいるというわけです。これだけで、Personクラスのさまざまなプロパティやメソッドが使えるようになります。あとは、Maleクラスに特有のプロパティやメソッドを追加しておくだけです。例えば、前立腺がんの検診に使われるPSAという値<span>※<span>1</span></span>をプロパティとして定義するなら、LIST<span>8</span>-<span>22</span>のようになります。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>22</span>　MaleクラスにPsaプロパティを定義する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Male</code></pre>
<pre lang="en"><code>    Inherits Person</code></pre>
<pre lang="en"><code>    Private mPsa As Double</code></pre>
<pre lang="en"><code>    Public Property Psa() As Double</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return mPsa</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As Double)</code></pre>
<pre lang="en"><code>            mPsa = value</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　継承されたクラスは、これまでのクラスと同じように使えます。オブジェクトを作成してプロパティを設定してみましょう（LIST<span>8</span>-<span>23</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>23</span>　Maleクラスのオブジェクトを作成し、プロパティを設定する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Dim aMale As Male = New Male()</code></pre>
<pre lang="en"><code>aMale.Height = 172.1</code></pre>
<pre lang="en"><code>aMale.Weight = 67.5</code></pre>
<pre lang="en"><code>aMale.Psa = 0.01</code></pre></div>
</div>
<p><br /></p>
<p>　注目すべき点はHeightプロパティやWeightプロパティです。これらのプロパティはMaleクラスでは定義していないにもかかわらず、Maleクラスで利用できます。なぜなら、これらのプロパティは基本クラスで定義されていたからです。基本クラスの機能を受け継いでいるので、これらのプロパティが使えるというわけです。</p>
<p>　ただし、基本クラスでPrivateを付けて宣言された変数やプロパティ、メソッドは派生クラスでは使えません。</p>
<p><br /></p>
<div id="calibre_link-61"><b>
<p><b>■基本クラスと派生クラスだけで利用できるメンバーを定義する</b></p>
</b></div>
<p>　基本クラスでPublicを指定されたメンバーは、クラスの外側からでも利用できます。派生クラスでは基本クラスのPublicメンバーは何も宣言しなくても利用できます。一方Privateを指定されたメンバーは、クラスの中でだけしか使えません。いくら機能を継承しているといっても、基本クラスのPrivateメンバーは派生クラスで使うことができません。</p>
<p>　ところで、基本クラスの外側からは利用できないが、派生クラスで利用できるメンバーが必要になることもあります。そのような場合には基本クラスでの宣言にProtectedを指定します（LIST<span>8</span>-<span>24</span>）。例えば、身長を表すHeightの取り扱いを派生クラスで変更したいような場合に便利です。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>24</span>　基本クラスのメンバー変数を派生クラスでも使えるようにする</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Person</code></pre>
<pre lang="en"><code>    Protected mHeight As Double</code></pre>
<pre lang="en"><code>        :</code></pre></div>
</div>
<p><br /></p>
<p>　このように宣言しておくと、Personクラスから派生したMaleクラスでは自由にmHeightという変数が使えます。次に説明するオーバーライドを利用する場合に必要になるので、具体例は次の項で見ることにしましょう。</p>
<p><br /></p>
<div><b>
<p><b>■プロパティやメソッドをオーバーライドする</b></p>
</b></div>
<p>　派生クラスは基本クラスの機能を受け継いでいます。しかし、基本クラスの機能が派生クラスでそのまま使えないこともあります。同じ名前の機能ではあっても、基本クラスと派生クラスで取り扱いや計算方法が異なるような場合がそれにあたります。あまり意味のない例ですが、例えば、Personクラスを継承したChildクラスがあるものとします。Childクラスは文字通り、子供を表すクラスです。</p>
<p><br /></p>
<p>　小さな子供の場合、大人のBMI指数をそのまま使ってもあまり意味のないことがあるので、身長が100cmよりも小さい場合にはBMI指数を計算せずに<span>0</span>を返したいということもあるはずです。その場合には、GetBmiというメソッドを派生クラスで定義し直します。これが<span><b>オーバーライド</b></span>です。そのためには、同じ名前のメソッドを派生クラスに書きます。このとき、メソッドの定義にOverridesというキーワードを付けておきます。ChildクラスのGetBmiメソッドはLIST<span>8</span>-<span>25</span>のようになるでしょう。なお、前節の最後でGetBmiメソッドを共有メソッドにする例を見ましたが、ここでは、共有メソッドではないものとしてコードを見ていきます。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>25</span>　GetBmiメソッドをオーバーライドする（Childクラス内のコード）</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Child</code></pre>
<pre lang="en"><code>    Inherits Person</code></pre>
<pre lang="en"><code>    Public Overrides Function GetBmi() As Double</code></pre>
<pre lang="en"><code>        If mHeight &lt; 100 Then</code></pre>
<pre lang="en"><code>            Return 0</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>        Return mWeight<i><i> (mHeight</i></i> 100) ^ 2</code></pre>
<pre lang="en"><code>    End Function</code></pre>
<pre lang="en"><code>    :</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　このように、オーバーライドを利用すれば、基本クラスのメソッドと同じ名前で、異なる働きのメソッドを派生クラスで定義できます。</p>
<p>　派生クラスでメソッドをオーバーライドしても、基本クラスのメソッドを派生クラスから呼び出すこともできます。基本クラスを表すMyBaseキーワードを利用し、メソッド名を指定します。上の例では、BMI指数を求めるメソッドが基本クラスにあるので、</p>
<div>
<pre lang="en"><code>Return mWeight<i><i> (mHeight</i></i> 100) ^ 2</code></pre></div>
<p>のような計算をする代わりに</p>
<div>
<pre lang="en"><code>Return MyBase.GetBmi()</code></pre></div>
<p>と書いて基本クラスのメソッドを呼び出しても構いません。このようにすれば、同じ名前のメソッドであっても、基本クラスのメソッドなのか派生クラスのメソッドなのかが区別できます。</p>
<p>　ただし、このとき、基本クラスに書かれている同じ名前のメソッドにはOverridableというキーワードを付けておく必要があります。つまり、PersonクラスのGetBmiメソッドの最初の行を書き換える必要があります。また、派生クラスでも使われる変数についてはProtectedキーワードを付けて宣言しておく必要があります（LIST<span>8</span>-<span>26</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>26</span>　基本クラスのメソッドをオーバーライド可能にする（Personクラス内のコード）</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Protected mHeight As Double</code></pre>
<pre lang="en"><code>Public Overridable Function GetBmi() As Double</code></pre>
<pre lang="en"><code>    Return mWeight<i><i> (mHeight</i></i> 100) ^ 2</code></pre>
<pre lang="en"><code>End Function</code></pre></div>
</div>
<p><br /></p>
<p>　なお、オーバーライドを利用するときには、引数の並びやデータ型も同じでなくてはいけません。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>オーバーロードも利用できる</b></p>
</b></div>
<div>
<p>　Chapter<span>7</span>で見たオーバーロードを利用することもできます。その場合は、派生クラスのGetBmiメソッドにOverloadsというキーワードを付けます。</p>
</div>
<div>
<pre lang="en"><code>Public Overloads Function GetBmi() As Double</code></pre></div>
<div>
<p>　この場合、基本クラスのGetBmiメソッドを書き換える必要はありません。また、引数の並びやデータ型が異なっても構いません。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-247">
<div><b>
<p><b>■インターフェイスを利用する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />InterfaceTest</p>
</div>
<hr />
<p>　<span><b>インターフェイス</b></span>とは、複数のクラスで共通に使われるような機能を定義するのに便利な機能です。例えば、「歌をうたう」という機能は人を表すクラスでも、鳥を表すクラスでも使われます。そのような機能をインターフェイスとして定義しておき、クラスから利用できるようにします。インターフェイスでは、プロパティやメソッドは定義されますが、どのような処理をするかはインターフェイスには書かれません。処理の内容はインターフェイスを利用するクラスで書きます。</p>
<p>　インターフェイスを定義するにはInterfaceキーワードを使います。Singメソッドを持つISingというインターフェイスを定義してみましょう（LIST<span>8</span>-<span>27</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>27</span>　インターフェイスを定義する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Interface ISing</code></pre>
<pre lang="en"><code>    Sub Sing(SongName As String)</code></pre>
<pre lang="en"><code>End Interface</code></pre></div>
</div>
<p><br /></p>
<p>　ここでは、歌の名前を引数として受け取るSingメソッドを<span>1</span>つだけ定義していますが、必要であれば、パートを表すPartプロパティ、歌の長さを返すTimeプロシージャなどを以下のように書いておくこともできます（図<span>8</span>-<span>10</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00183.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　インターフェイスでは、プロシージャの中身を書かないという点に注目してください。話を簡単にするために、最初のSingメソッドだけが定義されたISingインターフェイスを利用するものとします。MaleクラスでISingインターフェイスを利用するためのコードを見てみましょう（LIST<span>8</span>-<span>28</span>）。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>28</span>　クラスでインターフェイスを利用する</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Male</code></pre>
<pre lang="en"><code>    Inherits Person</code></pre>
<pre lang="en"><code>    Implements ISing</code></pre>
<pre lang="en"><code>        ：</code></pre>
<pre lang="en"><code>    Public Sub Sing(value As String) Implements ISing.Sing</code></pre>
<pre lang="en"><code>        My.Computer.Audio.Play(value, AudioPlayMode.Background)</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>        ：</code></pre></div>
</div>
<p><br /></p>
<p>　インターフェイスを利用するには、クラス定義の後に「Implements インターフェイス名」と書き、インターフェイスで定義されているプロシージャの内容を書きます。プロシージャ名の後にもImplementsキーワードと「インターフェイス名.プロシージャ名」を書く必要があります。Implementsとは「実装する」という意味です。</p>
<p>　ここでは、Singメソッドの中でMy.Computer.AudioというオブジェクトのPlayメソッドを使い、valueで指定されたサウンドファイルを再生します。ただし、再生できるサウンドファイルはwav形式のものに限ります。サウンドファイルの拡張子が「.wav」であっても、内容がmp<span>3</span>などほかの形式である場合にはエラーとなるので注意してください。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>サウンドを繰り返して再生するには</b></p>
</b></div>
<div>
<p>　My.Computer.Audio.Playメソッドでは、サウンドファイル名と再生の方法を指定します。再生の方法にはAudioPlayMode.Background（再生の終了を待たずに次のコードを実行する）、AudioPalyMode.BackgroundLoop（繰り返し再生する。再生の終了を待たずに次のコードを実行する）、AudioPalyMode.WaitToComplete（再生が終了してから次のコードを実行する）が指定できます）。</p>
</div>
</div>
<p><br /></p>
<p>　ポイントは、インターフェイスを利用するクラスでプロシージャの内容を書くということです。書き方をまとめておきましょう（図<span>8</span>-<span>11</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00216.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このように定義しておけば、MaleクラスのオブジェクトからSingメソッドが呼び出せます（LIST<span>8</span>-<span>29</span>）。Singメソッドに指定するサウンドファイル名を実際のサウンドファイルのパス名に書き換えて実行してみてください。</p>
<p><br /></p>
<div>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>29</span>　インターフェイスのメソッドを呼び出す</p>
</div>
</div>
<div>
<div>
<pre lang="en"><code>Dim aMale As Male = New Male()</code></pre>
<pre lang="en"><code>aMale.Sing("C:￥Users￥User1￥Music￥海の歌.wav")</code></pre></div>
</div>
<p><br /></p>
<p>　以上、クラスの継承、オーバーライド、インターフェイスについて見てきました。クラスにはほかにもさまざまな機能がありますが、一般的なプログラムの作成にはこれで十分です。確認問題で知識を確実なものにし、次の節で、クラスを利用したプログラムに取り組みましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-248">
<div><b>
<p><b>確認問題</b></p>
</b></div>
</div>
<p><br /></p>
<p><span><b><span><b>1</b></span>.</b></span>以下の文章のうち正しいものには○を、間違っているものには<span>×</span>を記入してください。</p>
<p><br /></p>
<div>
<p>（  ）継承とはクラスをコピーすることである</p>
</div>
<div>
<p>（  ）継承とはあるクラスの機能を受け継いだクラスを定義することである</p>
</div>
<div>
<p>（  ）派生クラスでは基本クラスにない機能が追加できる</p>
</div>
<div>
<p>（  ）派生クラスでは基本クラスのプロシージャと同じ名前のプロシージャは定義できない</p>
</div>
<div>
<p>（  ）インターフェイスではプロシージャなどを定義するだけで、処理の内容は書かない</p>
</div>
<p><br /></p>
<p><span><b><span><b>2</b></span>.</b></span>右側の説明を参考に、PersonクラスからRogueクラスを派生させ、さらにIMagicインターフェイスを利用するコードを書いてください。</p>
<p><br /></p>
<div>
<pre lang="en"><code>	Public Class Form1</code></pre>
<pre lang="en"><code>	    Private Sub Button1_Click(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles Button1.Click	</code></pre>
<pre lang="en"><code>	        Dim aRogue As （　　） = New （　　）()　　　●───Rogueクラスのオブジェクトを作成する</code></pre>
<pre lang="en"><code>	        aRogue.Hp = 50　　　●─── 各プロパティに値を代入する</code></pre>
<pre lang="en"><code>	        aRogue.Ap = 80</code></pre>
<pre lang="en"><code>	        aRogue.Mp = 10</code></pre>
<pre lang="en"><code>	    End Sub</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	End Class</code></pre>
<pre lang="en"><code>	Public Class Person</code></pre>
<pre lang="en"><code>	    （　　） mHitPoint As Integer ' 生命力　　　●───この変数を派生クラスでも使えるようにする</code></pre>
<pre lang="en"><code>	    Public Property Hp() As Integer</code></pre>
<pre lang="en"><code>	        Get</code></pre>
<pre lang="en"><code>	            Return mHitPoint</code></pre>
<pre lang="en"><code>	        End Get</code></pre>
<pre lang="en"><code>	        Set(value As Integer)</code></pre>
<pre lang="en"><code>	            mHitPoint = value</code></pre>
<pre lang="en"><code>	        End Set</code></pre>
<pre lang="en"><code>	    End Property</code></pre>
<pre lang="en"><code>	End Class</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	Public Class Rogue</code></pre>
<pre lang="en"><code>	    （　　） Person	 Person　　　●───クラスを継承する</code></pre>
<pre lang="en"><code>	    （　　）IMagic	 IMagic　　　●───インターフェイスを実装する</code></pre>
<pre lang="en"><code>	    Private mAttackPower As Integer ' 攻撃力</code></pre>
<pre lang="en"><code>	    Private mMagicPower As Integer  ' 魔力</code></pre>
<pre lang="en"><code>	    Public Property Ap() As Integer</code></pre>
<pre lang="en"><code>	        Get</code></pre>
<pre lang="en"><code>	            Return mAttackPower</code></pre>
<pre lang="en"><code>	        End Get</code></pre>
<pre lang="en"><code>	        Set(value As Integer)</code></pre>
<pre lang="en"><code>	            mAttackPower = value</code></pre>
<pre lang="en"><code>	        End Set</code></pre>
<pre lang="en"><code>	    End Property</code></pre>
<pre lang="en"><code>	    Public Sub Regene() ' 回復メソッド</code></pre>
<pre lang="en"><code>	        （　　） += 1　　　●───生命力を表す基本クラスの変数の値を1増やす</code></pre>
<pre lang="en"><code>	    End Sub</code></pre>
<pre lang="en"><code>	    Public Property Mp() As Integer （　　） （　　）</code><code>　　　●───IMagicインターフェイスのMpプロパティの内容を書く</code></pre>
<pre lang="en"><code>	        Get</code></pre>
<pre lang="en"><code>	            Return mMagicPower</code></pre>
<pre lang="en"><code>	        End Get</code></pre>
<pre lang="en"><code>	        Set(value As Integer)</code></pre>
<pre lang="en"><code>	            mMagicPower = value</code></pre>
<pre lang="en"><code>	        End Set</code></pre>
<pre lang="en"><code>	    End Property</code></pre>
<pre lang="en"><code>	End Class</code></pre>
<pre lang="en"><code>	Public （　　） IMagic</code><code><code>　　　●───</code>IMagicインターフェイスを定義する</code></pre>
<pre lang="en"><code>	    Property Mp() As Integer    ' 魔力</code></pre>
<pre lang="en"><code>	End （　　）</code><code><code>　　　●───</code>IMagicインターフェイスの定義の終わり</code></pre></div>
</div>
</div>
<div id="calibre_link-320">
<div>
<div id="calibre_link-249">
<div><b>
<p><b>　<span><b>8</b></span>.<span><b>5</b></span>　プログラミングにチャレンジ</b></p>
</b></div>
</div>
<p><br /></p>
<p>　クラスを利用すれば、人やモノを変数で表すよりも自然な形で表現できます。この節では、企業のプロフィールを表すクラスを定義し、企業の評価に利用できるようにします。クラスには企業の評価に使われるいくつかの指標をプロパティとして含むものとします。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-250">
<div><b>
<p><b>■フェイスチャートを表示するプログラム</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />FaceChart</p>
</div>
<hr />
<p>　経営分析や株価の分析には、自己資本比率や一株当たり経常利益などさまざまな指標が使われます。しかし、一般の人には意味が分かりにくいので、イメージが湧くように、それらの値をもとに、企業の成長性や株価の割安性などを点数で表すことがよくあります。ここでは、企業の評価に使われる「成長性」「割安性」「財務健全性」について、<span>1</span>〜<span>10</span>までの<span>10</span>段階の点数が得られているものとして、簡単なフェイスチャートを作ってみます。まず、プログラムの完成イメージはイラスト<span>8</span>-<span>7</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00093.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　顔はPictureBoxコントロールに描くものとし、眉毛が「成長性」、目が「割安性」、口が「財務健全性」を表すものとします。顔の具体的な描き方はコードを書くときに説明しますが、成長性が<span>1</span>のときは下がった眉になり、<span>10</span>のときは上がった眉になるようにします。割安性が<span>1</span>のときは目は小さく、<span>10</span>のときは目を大きくします。また、財務健全性が<span>1</span>のときはへの字型の口になり、<span>10</span>のときはにっこりとした口になります。つまり、評価が高いほど、活力のあるきりっとした顔になり、評価が低いほど元気のない顔になります。</p>
<p>　このプログラムでは、成長性や割安性といった点数で表される企業のプロフィールをクラスとして定義し、それをもとにオブジェクトを作成します。</p>
<p>　では、新しいプロジェクトを作成してフォームをデザインしていきましょう。プロジェクト名はFaceChartとします。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-251">
<div><b>
<p><b>■フォームのデザイン</b></p>
</b></div>
</div>
<hr />
<p>　フォームに配置するコントロールは、Labelコントロール、TextBoxコントロール、Buttonコントロール、PictureBoxコントロールなどです。画面<span>8</span>-<span>4</span>のようにコントロールを配置し、表<span>8</span>-<span>1</span>にそってプロパティの値を設定していってください。</p>
<p><br /></p>
<div>
<p><img src="images/00063.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00194.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00062.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-252">
<div><b>
<p><b>■クラスを定義する</b></p>
</b></div>
</div>
<hr />
<p>　最初に、企業のプロフィールを表すクラスを作っておきましょう。クラス名はFaceとします。Faceクラスには、成長性、割安性、財務健全性を表すプロパティが必要です。したがって、それらの値を保持しておくための変数が必要です。また、実際にフェイスチャートを描くために使うPictureBoxコントロールを参照するための変数もクラスに含めておきましょう。クラスの定義と、変数の宣言まで書いてみます（LIST<span>8</span>-<span>30</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>30</span>　クラスのメンバー変数を宣言する</p>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Face</code></pre>
<pre lang="en"><code>    Private mGrowth As Integer      ' 成長性</code></pre>
<pre lang="en"><code>    Private mUnderValue As Integer  ' 割安性</code></pre>
<pre lang="en"><code>    Private mHealth As Integer      ' 財務健全性</code></pre>
<pre lang="en"><code>    Private picFace As PictureBox   ' 顔</code></pre>
<pre lang="en"><code>        ：</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-253">
<div><b>
<p><b>■プロパティを定義する</b></p>
</b></div>
</div>
<hr />
<p>　成長性、割安性、財務健全性を表すプロパティは名前こそ異なりますが、コードの内容は同じです。いずれも<span>1</span>〜<span>10</span>までの整数値しか取らないので、その範囲外の値を設定しようとしたら、<span>1</span>〜<span>10</span>になるように調節することにしましょう（LIST<span>8</span>-<span>31</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>31</span>　成長性を表すGrowthプロパティを定義する</p>
</div>
<div>
<div>
<pre lang="en"><code>Public Property Growth() As Integer</code></pre>
<pre lang="en"><code>    Get</code></pre>
<pre lang="en"><code>        Return mGrowth</code></pre>
<pre lang="en"><code>    End Get</code></pre>
<pre lang="en"><code>    Set(value As Integer)</code></pre>
<pre lang="en"><code>        mGrowth = Math.Min(10, Math.Max(1, value))</code></pre>
<pre lang="en"><code>    End Set</code></pre>
<pre lang="en"><code>End Property</code></pre></div>
</div>
<p><br /></p>
<p>　プロパティの値を設定するためのSet ... End Setステートメントでは、設定された値が<span>1</span>より小さいときは<span>1</span>にし、<span>10</span>より大きいときには<span>10</span>にするコードが書かれています。これは<span>7</span>.<span>2</span>節などで見たのと同じ方法です。</p>
<p>　ほかのプロパティも同様に書けます。Propertyプロシージャをすべて書き終わったところまで、コードを見ておきましょう（LIST<span>8</span>-<span>32</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>32</span>　すべてのプロパティを定義した</p>
</div>
<div>
<div>
<pre lang="en"><code>Public Class Face</code></pre>
<pre lang="en"><code>    Private mGrowth As Integer      ' 成長性</code></pre>
<pre lang="en"><code>    Private mUnderValue As Integer  ' 割安性</code></pre>
<pre lang="en"><code>    Private mHealth As Integer      ' 財務健全性</code></pre>
<pre lang="en"><code>    Private picFace As PictureBox   ' 顔</code></pre>
<pre lang="en"><code>    Public Property Growth() As Integer</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return mGrowth</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As Integer)</code></pre>
<pre lang="en"><code>            mGrowth = Math.Min(10, Math.Max(1, value))</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>    Public Property UnderValue() As Integer</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return mUnderValue</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As Integer)</code></pre>
<pre lang="en"><code>            mUnderValue = Math.Min(10, Math.Max(1, value))</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>    Public Property Health() As Integer</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return mHealth</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As Integer)</code></pre>
<pre lang="en"><code>            mHealth = Math.Min(10, Math.Max(1, value))</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>    Public Property Picture() As PictureBox</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return picFace</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As PictureBox)</code></pre>
<pre lang="en"><code>            picFace = value</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>	：</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<p>　最後のPictureプロパティは、フェイスチャートを描画するために使うPictureBoxコントロールへの参照を記憶しておくためのものです。フォーム上のpicCanvasというPictureBoxコントロールは、Faceクラスの中ではpicFaceという変数で参照できるようになります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-254">
<div><b>
<p><b>■メソッドを定義する</b></p>
</b></div>
</div>
<hr />
<p>　Faceクラスで使われるメソッドは、PictureBoxコントロールにフェイスチャートを描くメソッドだけです。しかし、単純に絵を描けばいいというものではありません。Windowsのプログラムでは、ウィンドウの重なり方が変わったり、ウィンドウのサイズが変わったり、最小化から元のサイズに戻されたりするので、そのつど描画された内容を再描画する必要があります。つまり、どのタイミングで描画すればよいか、私たちがあらかじめ決めておくことはできないのです。しかし、Windowsはウィンドウの操作などを管理しているので、再描画が必要になったかどうかを知っています。そこで、発想を転換します。自分で絵を描くのではなく、再描画の必要が生じときに描画するコードを用意しておき、Windowsに呼び出してもらうのです。</p>
<p>　それに対処するための機能がPictureBoxコントロールのPaintイベントです。再描画が必要になるとWindowsによってPaintイベントハンドラーが自動的に呼び出されます（図<span>8</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00270.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<p>　したがって、Faceクラスの中にPaintイベントハンドラーを書いておき、その中でフェイスチャートを描画します。Paintイベントハンドラーは、クラスの外から呼び出すものではなく、再描画が必要になったときに自動的に呼び出されるので、Privateキーワードを指定しておきます（LIST<span>8</span>-<span>33</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>33</span>　PictureBoxコントロールのPaintイベントハンドラーを書く</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub DrawFace(sender As Object, e As PaintEventArgs)⇒</code></pre>
<pre lang="en"><code>Handles picFace.Paint</code></pre>
<pre lang="en"><code>        e.Graphics.Clear(picFace.BackColor)</code></pre>
<pre lang="en"><code>        ' 輪郭</code></pre>
<pre lang="en"><code>        e.Graphics.DrawEllipse(Pens.Black, 0, 0, 45, 45)</code></pre>
<pre lang="en"><code>        ' 眉毛を描く</code></pre>
<pre lang="en"><code>        e.Graphics.DrawLine(Pens.Black, 10, 10, 20, mGrowth + 5)</code></pre>
<pre lang="en"><code>        e.Graphics.DrawLine(Pens.Black, 25, mGrowth + 5, 35, 10)</code></pre>
<pre lang="en"><code>        ' 目を描く</code></pre>
<pre lang="en"><code>        e.Graphics.DrawEllipse(Pens.Black, 15 - mUnderValue ￥ 2,⇒</code></pre>
<pre lang="en"><code>20 - mUnderValue ￥ 2, mUnderValue, mUnderValue)</code></pre>
<pre lang="en"><code>        e.Graphics.DrawEllipse(Pens.Black, 30 - mUnderValue ￥ 2,⇒</code></pre>
<pre lang="en"><code>20 - mUnderValue ￥ 2, mUnderValue, mUnderValue)</code></pre>
<pre lang="en"><code>        ' 口を描く</code></pre>
<pre lang="en"><code>        If (mHealth &lt; 6) Then</code></pre>
<pre lang="en"><code>            e.Graphics.DrawArc(Pens.Black, 15, 30, 15, 6 - mHealth,⇒</code></pre>
<pre lang="en"><code>180, 180)</code></pre>
<pre lang="en"><code>        Else</code></pre>
<pre lang="en"><code>            e.Graphics.DrawArc(Pens.Black, 15, 30, 15, mHealth, 0,⇒</code></pre>
<pre lang="en"><code>180)</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　プロシージャはすべて自分でFaceクラスの中に入力する必要があります。イベントハンドラーの引数として渡されたeという変数のGraphicsプロパティを参照すれば、描画に使われるGrapchicsオブジェクトを利用できます。Graphicsオブジェクトには、表示をクリアするClearメソッド、線を引くためのDrawLineメソッド、楕円を描くためのDrawEllipseメソッド、円弧を描くためのDrawArcメソッドなどが使えるので、これらを利用してフェイスチャートを描画します。</p>
<p>　なお、変数で参照されたオブジェクトのイベントを利用したい場合には、そのオブジェクトを参照する変数の宣言にWithEventsキーワードを指定しておく必要があります。したがって、Faceクラスの最初に宣言されているpicFaceという変数は</p>
<div>
<pre lang="en"><code>Private WithEvents picFace As PictureBox   ' 顔</code></pre></div>
<p>と書き換えておいてください。WithEventsを書いていない場合は、上に示したpicFace.Paintというイベントハンドラーが使えません。</p>
<p><br /></p>
<div><b>
<p><b>■線を引く</b></p>
</b></div>
<p>　DrawLineメソッドにはいくつかの形式がありますが、ここで使っているのは以下のような書き方です。</p>
<div>
<pre lang="en"><code>DrawLine(ペン, 始点のX位置, 始点のY位置, 終点のX位置, 終点のY位置)</code></pre></div>
<p>　ここでは、眉を描くためにDrawLineメソッドを使っています。例えば、mGrowthの値が<span>8</span>の場合、</p>
<div>
<pre lang="en"><code>e.Graphics.DrawLine(Pens.Black, 10, 10, 20, mGrowth + 5)</code></pre></div>
<p>によって描かれる左眉の線は、図<span>8</span>-<span>13</span>のようになります。左上が（<span>0</span>,<span>0</span>）で、右にいくほどXの値が増え、下に行くほどYの値が増えます。mGrowth（成長性）の値によって終点のY位置が変わるので、mGrowthが大きくなるほど吊り上がった眉になることが分かります。</p>
<p><br /></p>
<div>
<p><img src="images/00165.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　最初の引数（ペン）には、Penクラスのオブジェクトを指定します。このオブジェクトは描画に使われる線の太さや色、塗りつぶしを決めるのに使われます。Pensクラスのオブジェクトを作成して、細かく指定してもいいのですが、「Pens.色名」で表されるPenオブジェクトを利用すれば、よく使う設定が簡単に指定できます。ここでは、Pens.Blackを指定し、太さ<span>1</span>の黒いペンで描画することにしています。</p>
<p><br /></p>
<div><b>
<p><b>■楕円を描く</b></p>
</b></div>
<p>　楕円はDrawEllipseメソッドを使って書きます。ここでは、左上の位置と幅、高さを指定する形式を使っています。</p>
<div>
<pre lang="en"><code>DrawEllipse(ペン, 左上のX位置, 左上のY位置, 幅, 高さ)</code></pre></div>
<p>　例えば、mUnderValueの値が<span>5</span>であれば、mUnderValue ￥<span>2</span>の値が<span>2</span>となるので、</p>
<div>
<pre lang="en"><code>    DrawEllipse(Pens.Black, 15 - mUnderValue ￥ 2, 20 - mUnder⇒</code></pre>
<pre lang="en"><code>Value ￥ 2, mUnderValue, mUnderValue)</code></pre></div>
<p>は、</p>
<div>
<pre lang="en"><code>DrawEllipse(Pens.Black, 13, 18, 5, 5)</code></pre></div>
<p>と同じです。したがって、図<span>8</span>-<span>14</span>のような円が描かれます。mUnderValue（割安性）の値が大きいほど円の左上のX位置とY位置が小さくなり、幅と高さが大きくなるので、目が大きくなることが分かります。</p>
<p><br /></p>
<div>
<p><img src="images/00029.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>■円弧を描く</b></p>
</b></div>
<p>　円弧はDrawArcメソッドを使います。ここでは、左上の位置と幅、高さ、開始位置の角度、終了位置の角度を指定します。</p>
<div>
<pre lang="en"><code>DrawArc(ペン, 左上のX座標, 左上のY座標, 幅, 高さ, 開始角, 終了角)</code></pre></div>
<p>　mHealthの値が<span>6</span>であれば、</p>
<div>
<pre lang="en"><code>DrawArc(Pens.Black, 15, 30, 15, mHealth, 0, 180)</code></pre></div>
<p>で図<span>8</span>-<span>15</span>のような円弧が描かれます。円弧は開始角から終了角まで時計回りに描かれます。mHealth（財務健全性）の値が大きいほど円弧の高さが高くなるのでり、にっこりした口になることが分かります。</p>
<p><br /></p>
<div>
<p><img src="images/00268.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　picFaceのPaintイベントハンドラーは、コントロールの再描画が必要になったときには自動的に呼び出されます。しかし、それ以外の場合に自分で描画したいこともあるでしょう。例えば、btnDrawコントロールをクリックしたときにフェイスチャートを描画したい場合などがそれにあたります。ボタンをクリックしただけではpicFaceコントロールを再描画する必要がないので、Paintイベントハンドラーは呼び出されません。したがって、picFaceの表示は変わりません。そのような場合にもpicFaceコントロールのPaintイベントを発生させ、picFaceコントロールを再描画したいときには、Refreshメソッドを呼び出します。つまり、</p>
<div>
<pre lang="en"><code>picFace.Refresh()</code></pre></div>
<p>と書けば、picFaceが再描画され（Paintイベントハンドラーが呼び出され）、フェイスチャートが表示されます。</p>
<p>　そこで、Faceクラスのメソッドとして、picFaceのRefreshメソッドを呼び出すコードを書いておきましょう（LIST<span>8</span>-<span>34</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>34</span>　picFaceコントロールを再描画するためのメソッド</p>
</div>
<div>
<div>
<pre lang="en"><code>Public Sub Refresh()</code></pre>
<pre lang="en"><code>    picFace.Refresh()</code></pre>
<pre lang="en"><code>End Sub</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-255">
<div><b>
<p><b>■イベントハンドラーの記述</b></p>
</b></div>
</div>
<hr />
<p>　このプログラムでは、<span>3</span>つのTextBoxコントロールにそれぞれ値を入力し、btnDrawボタンをクリックしたらフェイスチャートを表示します。したがって、btnDrawコントロールのClickイベントハンドラーにそのためのコードを書きます。コードの内容は、Faceクラスの新しいオブジェクトを作成し、TextBoxコントロールに入力されている値をGrowth、UnderValue、Healthの各プロパティに設定した後、利用するPictureBoxコントロールをPictureプロパティに設定します。あとは、Refreshメソッドを呼び出すだけです。</p>
<p>　btnDrawコントロールのClickイベントハンドラーの名前をMakeFaceChartとして、コードを書いてみましょう（LIST<span>8</span>-<span>35</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>35</span>　成長性、割安性、財務健全性の値をもとにフェイスチャートを描画するイベントハンドラー</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub MakeFaceChart(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles btnDraw.Click</code></pre>
<pre lang="en"><code>        Dim aFace As Face = New Face()　　　●─── Faceクラスのオブジェクトを作る</code></pre>
<pre lang="en"><code>        aFace.Picture = picCanvas　　　●─── PictureプロパティでpicCanvasを参照できるようにする</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        aFace.Growth = CInt(txtGrowth.Text)	　　　　</code></pre>
<pre lang="en"><code>        aFace.UnderValue = CInt(txtUnderValue.Text)　　　●───入力された値を設定する</code></pre>
<pre lang="en"><code>        aFace.Health = CInt(txtHealth.Text)</code></pre>
<pre lang="en"><code>        aFace.Refresh()　　　●───	PictureBoxが再描画されるように指示する</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　ここまではコードを少しずつ見てきたので、それぞれの働きは理解できたかもしれませんが、全体の関係が把握しづらいかもしれません。そこで、コード全体を確認しておきましょう（LIST<span>8</span>-<span>36</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>8</span>-<span>36</span>　フェイスチャートを描くためのコード（全体）</p>
</div>
<div>
<div>
<pre lang="en"><code>Option Strict On</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub MakeFaceChart(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles btnDraw.Click</code></pre>
<pre lang="en"><code>        Dim aFace As Face = New Face()</code></pre>
<pre lang="en"><code>        aFace.Picture = picCanvas</code></pre>
<pre lang="en"><code>        aFace.Growth = CInt(txtGrowth.Text)</code></pre>
<pre lang="en"><code>        aFace.UnderValue = CInt(txtUnderValue.Text)</code></pre>
<pre lang="en"><code>        aFace.Health = CInt(txtHealth.Text)</code></pre>
<pre lang="en"><code>        aFace.Refresh()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>Public Class Face</code></pre>
<pre lang="en"><code>    Private mGrowth As Integer      ' 成長性</code></pre>
<pre lang="en"><code>    Private mUnderValue As Integer  ' 割安性</code></pre>
<pre lang="en"><code>    Private mHealth As Integer      ' 財務健全性</code></pre>
<pre lang="en"><code>    Private WithEvents picFace As PictureBox   ' 顔</code></pre>
<pre lang="en"><code>    Public Property Growth() As Integer</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return mGrowth</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As Integer)</code></pre>
<pre lang="en"><code>            mGrowth = Math.Min(10, Math.Max(1, value))</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>    Public Property UnderValue() As Integer</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return mUnderValue</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As Integer)</code></pre>
<pre lang="en"><code>            mUnderValue = Math.Min(10, Math.Max(1, value))</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>    Public Property Health() As Integer</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return mHealth</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As Integer)</code></pre>
<pre lang="en"><code>            mHealth = Math.Min(10, Math.Max(1, value))</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>    Public Property Picture() As PictureBox</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return picFace</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(value As PictureBox)</code></pre>
<pre lang="en"><code>            picFace = value</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>    Private Sub DrawFace(sender As Object, e As PaintEventArgs)⇒</code></pre>
<pre lang="en"><code>Handles picFace.Paint</code></pre>
<pre lang="en"><code>        e.Graphics.Clear(picFace.BackColor)</code></pre>
<pre lang="en"><code>        ' 輪郭</code></pre>
<pre lang="en"><code>        e.Graphics.DrawEllipse(Pens.Black, 0, 0, 45, 45)</code></pre>
<pre lang="en"><code>        ' 眉毛を描く</code></pre>
<pre lang="en"><code>        e.Graphics.DrawLine(Pens.Black, 10, 10, 20, mGrowth + 5)</code></pre>
<pre lang="en"><code>        e.Graphics.DrawLine(Pens.Black, 25, mGrowth + 5, 35, 10)</code></pre>
<pre lang="en"><code>        ' 目を描く</code></pre>
<pre lang="en"><code>        e.Graphics.DrawEllipse(Pens.Black, 15 - mUnderValue ￥ 2,⇒</code></pre>
<pre lang="en"><code>20 - mUnderValue ￥ 2, mUnderValue, mUnderValue)</code></pre>
<pre lang="en"><code>        e.Graphics.DrawEllipse(Pens.Black, 30 - mUnderValue ￥ 2,⇒</code></pre>
<pre lang="en"><code>20 - mUnderValue ￥ 2, mUnderValue, mUnderValue)</code></pre>
<pre lang="en"><code>        ' 口を描く</code></pre>
<pre lang="en"><code>        If (mHealth &lt; 6) Then</code></pre>
<pre lang="en"><code>            e.Graphics.DrawArc(Pens.Black, 15, 30, 15, 6 - mHealth,⇒</code></pre>
<pre lang="en"><code>180, 180)</code></pre>
<pre lang="en"><code>        Else</code></pre>
<pre lang="en"><code>            e.Graphics.DrawArc(Pens.Black, 15, 30, 15, mHealth, 0,⇒</code></pre>
<pre lang="en"><code>180)</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Public Sub Refresh()</code></pre>
<pre lang="en"><code>        picFace.Refresh()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
</div>
<p><br /></p>
<div><b>
<p><b>■プログラムを実行する</b></p>
</b></div>
<p>　コードがすべて入力できたら［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックして、プログラムを実行します。TextBoxコントロールにさまざまな数値を入力し、［イメージ表示（D）］ボタンをクリックすればPictureBoxコントロールにフェイスチャートが表示されます（画面<span>8</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00235.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［成長性（G）］、［割安性（V）］、［財務健全性（H）］の値を入力する</p>
</div>
<div>
<p>❷　［イメージ表示（D）］ボタンをクリックする</p>
</div>
<div>
<p>③　フェイスチャートが表示される</p>
</div>
</div>
</div>
<div id="calibre_link-8">
<div>
<div>
<div>
<p><br /></p>
</div>
</div>
<div><b>
<p><b>Chapter<span><b>8</b></span>のまとめ</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>クラスを利用すると、人やモノを目的に合わせて自然に表現できます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>クラスにはプロパティやメソッドを定義できます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>オブジェクトを作成するとコンストラクターが自動的に実行されます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>オブジェクトを破棄するときに必要な後始末はデストラクターに書きます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>共有プロパティや共有メソッドを利用すると、オブジェクトを作成しなくても使える、クラス特有の機能が定義できます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>クラスを継承すると基本クラスの機能を備え、しかも独自の機能が追加できる派生クラスが作成できます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>派生クラスでは基本クラスのプロパティやメソッドをオーバーライドできます。オーバーライドにより、同じ名前で異なる機能を持つプロパティやメソッドが定義できます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>インターフェイスを利用すると、さまざまなクラスで使われる機能をクラスに組み込むことができます</b></p>
</b></div>
</div>
</div>
<div id="calibre_link-22">
<div>
<div id="calibre_link-256">
<div><b>
<div><b>
<p><b>練習問題</b></p>
</b></div>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />Insect</p>
</div>
<p><br /></p>
<div>
<p><span><b>［A］</b></span>新しいプロジェクトInsectを作成し、平面上をランダムに動き回る昆虫ロボットを表すクラスを作ってみましょう。クラス名はInsectroidとします。プロパティとしては、水平位置を表すXプロパティ、垂直位置を表すYプロパティを作成し、メソッドとしては、ランダムに一歩動くRandomWalkメソッドを作成してください。なお、水平位置と垂直位置の初期値は（<span>10</span>,<span>10</span>）とします。</p>
</div>
<p><br /></p>
<div>
<p><span><b>［B］</b></span>フォームのLoadイベントハンドラーで上記のInsectroidクラスから新しいオブジェクトを作成し、ボタンをクリックするたびに位置を変えるプログラムを作成してください。昆虫ロボットの絵を描く必要はありません。右の実行例のように位置を表示するだけで構いません。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00038.jpeg" alt="" /></p>
</div>
<p><br /></p>
</div>
</div>
<div id="calibre_link-45">
<div>
<div id="calibre_link-257">
<div>
<p>Part<span>3</span></p>
</div>
</div>
<p><br /></p>
<div><b>
<p><b>本格的なプログラミングに</b></p>
</b></div>
<div><b>
<p><b>チャレンジする</b></p>
</b></div>
<hr />
<div>
<p>Part<span>3</span>では、これまでに学んだ言語の基礎をもとにして、実践的なプログラミングに取り組みます。実際の業務で使われるプログラムでは、複雑な例外に対応するため、かなり細かな処理を書く必要がありますが、ここでは、大きな流れがつかめるように、ある程度単純化してあります。プログラムの規模はそれほど大きくはありませんが、エッセンスとなる要素を押さえてあるので、応用のための足がかりとなるはずです。</p>
</div>
</div>
</div>
<div id="calibre_link-6">
<div>
<div id="calibre_link-258">
<div><b>
<p><b>Chapter<span><b>9</b></span></b></p>
</b></div>
</div>
<p><br /></p>
<div><b>
<p><b>ファイルを取り扱う～ Fortune プログラム</b></p>
</b></div>
<hr />
<div>
<p>この章では、日々の格言を表示するFortuneプログラムを作成します。格言はファイルに保存されているので、ファイルのデータを読み出したり、新しい格言をファイルに書き込んだりする必要があります。その方法を学ぶとともに、メニューの設定、ステータスバーの利用、構造化例外処理、クリップボードの使い方などについても学び、本格的なプログラミングへとステップアップします。</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><span><b>9</b></span>.<span><b>1</b></span>　ここで作成するプログラム</b></p>
</b></div>
<div>
<p>格言を表示するプログラム</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>9</b></span>.<span><b>2</b></span>　Fortuneプログラムを作成する</b></p>
</b></div>
<div>
<p>フォームをデザインする／メニューをデザインする／ステータスバーをデザインする／格言をファイルから読み出して表示する／構造化例外処理を書く／新しい格言をファイルに書き込む／格言をクリップボードにコピーする／プログラムを終了させる／プログラムを実行する</p>
</div>
</div>
</div>
<div id="calibre_link-310">
<div>
<div><b>
<p><b>これから学ぶこと</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>　ファイルのデータを読み出したり、ファイルにデータを書き込む方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　メニューの設定と利用方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　ステータスバーの設定と利用方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　構造化例外処理の方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　プログラムからクリップボードにデータをコピーしたり、クリップボードからデータを取り出す方法を学びます</b></p>
</b></div>
<p><br /></p>
<div>
<p><img src="images/00243.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>　この章では格言を表示するFortuneプログラムの作成を通して、ファイルからデータを読み出したり、ファイルにデータを書き込んだりする処理を学びます。あわせて構造化例外処理の方法やクリップボードの利用方法についても学びます。</p>
</div>
</div>
</div>
<div id="calibre_link-336">
<div>
<div id="calibre_link-259">
<div><b>
<p><b>　<span><b>9</b></span>.<span><b>1</b></span>　ここで作成するプログラム</b></p>
</b></div>
</div>
<p><br /></p>
<p>　格言を表示するためのプログラムは、一般にFortune（フォーチュン）と呼ばれます。この章では、ファイル処理、メニューの設定と利用、例外処理、クリップボードの利用などの機能を盛り込んだFortuneプログラムを作成します。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-260">
<div><b>
<p><b>■格言を表示するプログラム</b></p>
</b></div>
</div>
<hr />
<p>　ここで作成するFortuneプログラムでは、ファイルに保存されている格言をランダムに読み出し、フォーム上に表示します。また、自分で格言を追加することもできるようにします。ファイルには<span>1</span>行につき<span>1</span>つの格言が保存されているものとします。</p>
<p>　プログラムの完成イメージをラフスケッチで描いてみましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00342.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　プログラムの表面的な動きはだいたい分かると思いますが、どのようなファイルにどのようなデータが保存されているか、プログラムとデータをどうやりとりするかといったことはこれだけでは見えません。ファイルまで含めた処理のイメージは図<span>9</span>-<span>1</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00338.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このプログラムではファイルを<span>2</span>つ利用します。<span>1</span>つは格言の行数が保存されているfortune.ctrファイルです。もう<span>1</span>つは実際に格言が保存されているfortune.txtファイルです。プログラムが実行されると、まず、fortune.ctrファイルから行数を読み出します。この行数をもとにランダムな行位置を選び、fortune.txtファイルから格言を読み出してフォーム上に表示します。</p>
<p>　また、フォームのメニューから［編集（E）］−［格言の追加（A）...］を選ぶと、新しい格言が追加できるようにします。このときfortune.txtファイルに新しい格言を追加するとともに、fortune.ctrファイルに保存されている行数も<span>1</span>増やしておきます。</p>
<p>　プログラムのイメージがつかめたら、Fortuneという名前のプロジェクトを作成し、プログラミングに取り組みましょう。</p>
</div>
</div>
<div id="calibre_link-346">
<div>
<div id="calibre_link-261">
<div><b>
<p><b>　<span><b>9</b></span>.<span><b>2</b></span>　Fortuneプログラムを作成する</b></p>
</b></div>
</div>
<p><br /></p>
<p>　このプログラムでは、これまで使ってきたコントロールのほかに、メニューとステータスバーを使います。実行すべき主な処理は、プログラムが起動されたときにファイルから格言を読み出して表示すること、入力された新しい格言をファイルに追加することです。さらに、例外処理を加え、プログラムをより堅牢で安定したものにしたり、クリップボードとのやりとりを加え、プログラムをより使いやすいものにします。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-262">
<div><b>
<p><b>■フォームをデザインする</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />Fortune</p>
</div>
<hr />
<p>　フォーム上にメニューを表示するにはMenuStripコントロールを使い、ステータスバーを表示するにはStatusStripコントロールを使います。ただし、この段階では、MenuStripコントロールとStatusStripコントロールはフォーム上に配置しておくだけにします（画面<span>9</span>-<span>1</span>）。使い慣れたLabelコントロールやButtonコントロールについては、プロパティを設定しておきましょう（表<span>9</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00212.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　MenuStripコントロールを配置する</p>
</div>
<div>
<p>②　何も表示されていないメニューが追加される</p>
</div>
<div>
<p>③　MenuStripコントロールを表すアイコンが表示される</p>
</div>
<div>
<p>❹　StatusStripコントロールを配置する</p>
</div>
<div>
<p>⑤　何も表示されていないステータスバーが追加される</p>
</div>
<div>
<p>⑥　StatusStripコントロールを表すアイコンが表示される</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00090.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　MenuStripコントロールとStatusStripコントロールを配置すると、ウィンドウの下のほうにコントロールを表すアイコンが表示されます。ウィンドウ内に表示されないコントロールやプロパティの設定が複雑なコントロールには、このようなアイコンが表示されるものもあります。MenuStripコントロールにはサブメニューがあり、StatusStripコントロールの中にはラベルやボタンが表示できるので、ここからメニュー項目を追加していきます。</p>
<p>　では、メニューのデザインに移りましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-263">
<div><b>
<p><b>■メニューをデザインする</b></p>
</b></div>
</div>
<hr />
<p>　MenuStripコントロールを配置すると、フォームに空のメニューと、ウィンドウの下のほうにアイコンが表示されます。空のメニューには「ここへ入力」と表示された項目があるので、そこに直接メニュー項目のテキストを入力していきます（画面<span>9</span>-<span>2</span>）。入力した文字列はTextプロパティに設定されます。</p>
<p><br /></p>
<div>
<p><img src="images/00309.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　「ここへ入力」と表示されている場所にメニュー項目のテキストを入力する</p>
</div>
<p><br /></p>
<p>　同じようにして、メニューバーの右側にメインメニューの項目を、それらの項目の下にサブメニューの項目を入力していきましょう。項目の区切りを追加するには、項目名として「-」（ハイフン）を入力します。画面<span>9</span>-<span>3</span>が完成例です。</p>
<p><br /></p>
<div>
<p><img src="images/00323.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［編集（E）］メニューのサブメニューも定義しておく</p>
</div>
<div>
<p>❷　区切り線を入れるには「ここへ入力」と表示されている場所に「-」を入力する</p>
</div>
<p><br /></p>
<p>　個々のメニュー項目も実はToolStripMenuItemというコントロールの一種です。コントロールのNameプロパティにはメニュー項目のテキストに指定した文字列をもとに名前が付けられます。例えば、「ファイル（&amp;F）」という項目であれば「ファイルFToolStripMenuItem」のようなコントロール名になります。コードの中でこの名前を使うことはあまりないので、そのままにしておいても構いませんが、mnuFなどのように、<span><b>アクセスキー</b></span>の文字を使った簡潔な名前にしておいたほうが、取り扱いが楽です（表<span>9</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00058.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>標準的なメニュー項目を一発で設定するには</b></p>
</b></div>
<div>
<p>　MenuStripコントロールの右にある［ ▶ ］ボタンをクリックし、［標準項目の挿入］を選択すると、一般的なアプリケーションでよく使われるメニューが自動的に設定されます。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-264">
<div><b>
<p><b>■ステータスバーをデザインする</b></p>
</b></div>
</div>
<hr />
<p>　ステータスバーには表示された格言の番号を表示します。そこで、ステータスバー上にラベルを追加し、文字列が表示できるようにしましょう。フォーム上に表示されているStatusStripコントロールをクリックし、［ToolStripStatusLabelの追加］ボタンをクリックします（画面<span>9</span>-<span>4</span>）。すると、ToolStripStatusLabelと呼ばれるコントロールが追加されます。このコントロールの使い方はLabelコントロールとほとんど同じです。</p>
<p><br /></p>
<div>
<p><img src="images/00286.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div>
<p><span><b>❶</b></span>　［ToolStripStatusLabelの追加］ボタンをクリックする</p>
</div>
</div>
<p><br /></p>
<p>　プロパティは表<span>9</span>-<span>3</span>のように変更します。最初はラベルに何も表示しないので、Textプロパティの文字列は削除しておきます。</p>
<p><br /></p>
<div>
<p><img src="images/00161.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>［▼］をクリックすればステータスバーに表示するコントロールが選択できる</b></p>
</b></div>
<div>
<p>　［ToolStripStatusLabelの追加］ボタンの右にある［▼］をクリックすれば、StatusLabelのほか、ProgressBar、DropDownButton、SplitButtonのいずれかのコントロールを選択してステータスバーに追加できます。</p>
</div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-265">
<div><b>
<p><b>■格言をファイルから読み出して表示する</b></p>
</b></div>
</div>
<hr />
<p>　ただ格言を表示するだけといっても、やるべきことがかなりたくさんあるので、大きな流れを確認しておきます。おおまかにいうと、格言の行数が入ったファイル（fortune.ctr）から行数を読み出し、その行数を最大値とする乱数をもとに、格言ファイル（fortune.txt）から目的の行を読み出して表示する、ということになります。</p>
<p>　もう少し細かく見ると、次のようになるでしょう。</p>
<p><br /></p>
<div>
<p>■　<span><b>ステップ<span><b>1</b></span>　コントロールファイルから行数を読み出す</b></span></p>
</div>
<div>
<p>　fortune.ctrファイルを開く</p>
</div>
<div>
<p>　<span>1</span>行読み出す</p>
</div>
<div>
<p>　読み出した行を整数にして「行数」に入れる</p>
</div>
<div>
<p><br /></p>
</div>
<div>
<p>■　<span><b>ステップ<span><b>2</b></span>　格言ファイルから、ランダムに行を読み出す</b></span></p>
</div>
<div>
<p>　fortune.txtファイルを開く</p>
</div>
<div>
<p>　<span>0</span>以上「行数」未満の乱数を作成し「読み飛ばす行数」に入れる</p>
</div>
<div>
<p>　「読み飛ばす行数」だけ、行を読み飛ばす</p>
</div>
<div>
<p>　目的の行を読み出す</p>
</div>
<div>
<p><br /></p>
</div>
<div>
<p>■　<span><b>ステップ<span><b>3</b></span>　読み出した行を表示する</b></span></p>
</div>
<div>
<p>　読み出した行をラベルに表示する</p>
</div>
<div>
<p>　読み出した行の番号をステータスバーのラベルに表示する</p>
</div>
<p><br /></p>
<p>　ファイルからは<span>1</span>行ずつデータを読み出すので、一度に何行かを読み飛ばすことはできません。そこで、<span>0</span>から「読み飛ばす行数」までの繰り返し処理により、ファイルから<span>1</span>行ずつ読み出します。繰り返し処理が終わった後、次に読み出した行が目的の行となるわけです（図<span>9</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00234.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Part<span>2</span>では、新しい知識を学びながら、それらを積み上げてプログラムを作ってきましたが、Part<span>3</span>の各章（Chapter<span>9</span>〜<span>10</span>）では、コードが少し長くなる場合もあるので、先にイベントハンドラーなどのひとまとまりのコードを見て、その後、各部分を詳細に見ていくこととします。</p>
<p><br /></p>
<div><b>
<p><b>■フォームのLoadイベントハンドラー</b></p>
</b></div>
<p>　格言はプログラムを起動したときに表示すればいいので、フォームのLoadイベントハンドラーに記述します。コードの全体像を見ておきましょう。この段階ではおおまかな流れを追いかけておくだけで構いません（LIST<span>9</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>1</span>　フォームのLoadイベントハンドラー（格言を表示する）</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private TotalCount As Integer   ' 格言ファイルの行数	</code></pre>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs) Handles⇒</code></pre>
<pre lang="en"><code>MyBase.Load</code></pre>
<div>
<pre lang="en"><code>Dim OneLine As String   ' ファイルから読み出した1行　　　●─── ステップ1</code><code> コントロールファイルから行数を読み出す→<a href="#calibre_link-347"><u>P.338</u></a></code><code>　　　　　　　　　　　　</code></pre>
<pre lang="en"><code>Dim sr As System.IO.StreamReader</code>
</pre>
<pre lang="en"><code>Try</code><code>   ●───</code><code>構造化例外処理</code><code> ファイルが見つからないなどのエラーに対応する→<a href="#calibre_link-348"><u>P.343</u></a></code></pre>
<pre lang="en"><code>    sr = New System.IO.StreamReader("fortune.ctr")  ' ファイル⇒ を開く</code></pre>
<pre lang="en"><code>    OneLine = sr.ReadLine()     ' 1行読み出す</code></pre>
<pre lang="en"><code>    TotalCount = Integer.Parse(OneLine)     ' 整数に変換する</code></pre>
<pre lang="en"><code>    sr.Close()</code></pre></div>
<pre lang="en"><code></code></pre>
<div>
<pre lang="en"><code>    Dim SkipLine As Integer     ' 読み飛ばす行数</code></pre>
<pre lang="en"><code>    Dim r As Random = New Random()</code></pre>
<pre lang="en"><code>    SkipLine = r.Next(TotalCount)   ' 読み飛ばす行数をランダムに決める</code></pre>
<pre lang="en"><code>    ' 格言ファイルを開く</code></pre>
<pre lang="en"><code>    sr = New System.IO.StreamReader("fortune.txt",</code></pre>
<pre lang="en"><code>          System.Text.Encoding.GetEncoding("shift_jis"))</code></pre>
<pre lang="en"><code>    Dim i As Integer = 0	　</code></pre>
<pre lang="en"><code>    Do While i &lt; SkipLine　　　●───ステップ2</code><code> 格言ファイルから、ランダムに行を読み出す→<a href="#calibre_link-349"><u>P.340</u></a></code>
</pre>
<pre lang="en"><code>        sr.ReadLine()   ' 空読みする</code></pre>
<pre lang="en"><code>        i += 1</code></pre>
<pre lang="en"><code>    Loop</code></pre>
<pre lang="en"><code>    OneLine = sr.ReadLine()</code></pre>
<pre lang="en"><code>    sr.Close()</code></pre></div>
<pre lang="en"><code></code></pre>
<div>
<pre lang="en"><code>    lblFortune.Text = OneLine</code></pre>
<pre lang="en"><code>    lblNumber.Text = (SkipLine + 1).ToString()　　　●───ステップ3</code><code> 読み出した行を表示する→<a href="#calibre_link-350"><u>P.342</u></a></code>
</pre></div>
<pre lang="en"><code></code></pre>
<div>
<pre lang="en"><code>Catch ex As Exception	</code></pre>
<pre lang="en"><code>   MessageBox.Show(ex.Message)</code></pre>
<pre lang="en"><code>   Application.Exit()　　　●───</code><code>構造化例外処理</code><code>ファイルが見つからないなどのエラーに対応する→<a href="#calibre_link-348"><u>P.343</u></a></code></pre>
<pre lang="en"><code>End Try</code></pre></div>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>1</b></span>　コントロールファイルから行数を読み出す</b></p>
</b></div>
<p id="calibre_link-347">　ここからコードを詳細に見ていきます。最初は、行数の入ったファイル（fortune.ctr）を開いて<span>1</span>行読み出し、それを数値に変換するところまでです。このステップでは、格言そのものを読み出すのではなく、格言の行数を読み出します。したがって、結果として欲しいものは行数です。そこで、行数を記憶しておくためのInteger型の変数を宣言します。変数名はTotalCountとしています。少し先の話になりますが、TotalCountはファイルに書き込むためのプロシージャでも使うので、フォームレベルで宣言してあることに注意してください。</p>
<p>　続いて、TotalCountの値を求めるためにfortune.ctrファイルから<span>1</span>行読み出すので、そのデータを記憶するための変数も必要です。ファイルには文字列が入っているので、String型のOneLineという変数を宣言します（LIST<span>9</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>2</span>　行数を読み出すために必要な変数を宣言する</p>
</div>
<div>
<div>
<pre lang="en"><code>Private TotalCount As Integer　　　●───格言ファイルの行数</code></pre>
<pre lang="en"><code>Private Sub InitProc(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles MyBase.Load</code></pre>
<pre lang="en"><code>    Dim OneLine As String　　　●───ファイルから読み出した1行</code></pre></div>
</div>
<p><br /></p>
<p>　ファイルから行を読み出すには、StreamReaderクラスのオブジェクトを使います。このオブジェクトを参照する変数をsrという名前で宣言しましょう。続いて、オブジェクトを作成し、その参照を代入します。オブジェクトの作成時には、引数にファイル名が指定できます（LIST<span>9</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>3</span>　StreamReaderクラスのオブジェクトを作成する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim sr As System.IO.StreamReader</code></pre>
<pre lang="en"><code>sr = New System.IO.StreamReader("fortune.ctr")</code></pre></div>
</div>
<p><br /></p>
<p>　StreamReaderクラスのフルネームはSystem.IO.StreamReaderなので、上記のようなコードになります。StreamReaderクラスをコードの中でよく使うのであれば、コードの先頭に</p>
<div>
<div>
<pre lang="en"><code>Imports System.IO</code></pre></div>
</div>
<p>と書いておくといいでしょう。そうすれば、System.IO.StreamReaderと書く代わりにStreamReaderと略して書けるようになります。</p>
<p>　なお、"fortune.ctr"のようにファイル名だけを指定した場合には、実行用プログラムと同じフォルダー（プロジェクトのbin¥Debugフォルダーまたはbin¥Releaseフォルダー）に「fortune.ctr」があるものと見なされます。あらかじめ、格言の行数を入力したテキストファイルを作成しておいてください。もちろん、ファイル名は絶対パス名でも指定できるので、ほかのフォルダーに作成しておいても構いません。</p>
<p>　ここまでを図にして表すと、図<span>9</span>-<span>3</span>のような感じになります。</p>
<p><br /></p>
<div>
<p><img src="images/00259.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　これで、fortune.ctrファイルを利用するためのStreamReaderオブジェクトが使えるようになりました。この後、srという変数を使って行を読み出すことができます。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>My.Computer.FileSystemオブジェクトも利用できる</b></p>
</b></div>
<div>
<p>　My.Computer.FileSystemオブジェクトのOpenTextFileReaderメソッドを利用すれば、StreamReaderオブジェクトが取得できます。したがって、以下のように書くこともできます。なお、<a href="#calibre_link-349"><u>P.340</u></a>と同様に文字コードの指定もできます。</p>
</div>
<div>
<pre lang="en"><code>Dim sr As System.IO.StreamReader</code></pre>
<pre lang="en"><code>sr = My.Computer.FileSystem.OpenTextFileReader("fortune.ctr")</code></pre></div>
</div>
<p><br /></p>
<p>　ファイルから<span>1</span>行読み出すには、StreamReaderクラスのReadLineメソッドを使います。ReadLineメソッドは読み出した行を返すので、それをOneLineに代入します。さらに、OneLineを整数に変換してTotalCountに代入します。ファイルの利用が終わったらCloseメソッドを呼び出してファイルを閉じておきます（LIST<span>9</span>-<span>4</span>）。CloseメソッドからはDisposeメソッドが自動的に呼び出されるので、ここでオブジェクトが破棄されます。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>4</span>　ファイルから<span>1</span>行読み出し、整数に変換する</p>
</div>
<div>
<div>
<pre lang="en"><code>OneLine = sr.ReadLine()	' 1行読み出す</code></pre>
<pre lang="en"><code>TotalCount = Integer.Parse(OneLine)</code></pre>
<pre lang="en"><code>sr.Close()</code></pre></div>
</div>
<p><br /></p>
<p>　これで、fortune.txtに保存されている格言の行数が求められます。イベントハンドラーの後半（ステップ<span>2</span>）で必要となるので、TotalCountに行数が代入されることを覚えておいてください。</p>
<p>　<span>4</span>.<span>2</span>節や<span>7</span>.<span>5</span>節では、文字列を整数に変換するためにTryParseというメソッドを使いましたが、ここではParseメソッドを使っています。実際にはTryParseメソッドのほうが効率はいいのですが、Parseメソッドを使うとエラー処理をまとめて書けるからです。どのようにエラー処理をするのかは少し後の楽しみということにして、イベントハンドラーの続きを見ていきましょう。</p>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>2</b></span>　格言ファイルから、ランダムに行を読み出す</b></p>
</b></div>
<p id="calibre_link-349">　後半の処理は、fortune.txtファイルから目的の行を読み出す処理です。この場合もまず必要な変数から考えましょう。当然のことながら、読み出した行を記憶しておく変数が必要です。この変数を新しく用意してもいいのですが、ステップ<span>1</span>で使ったOneLineという変数がそのまま使えます。</p>
<p>　次に、目的の行が何行目であるかを表す変数が必要になりそうです。しかし、ここでは目的の行にたどり着くまで何行読み飛ばすかを表す変数を宣言します。例えば、<span>5</span>行目を取り出したいときには、<span>4</span>行読み飛ばすのでこの変数に<span>4</span>が代入されるようにします。</p>
<p>　また、読み飛ばす行数を求めるために乱数を使うので、Randomクラスのオブジェクトを作成する必要もあります（LIST<span>9</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>5</span>　読み飛ばしの行数を記憶する変数を宣言し、Randomオブジェクトを作成する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim SkipLine As Integer</code></pre>
<pre lang="en"><code>Dim r As Random = New Random()</code></pre></div>
</div>
<p><br /></p>
<p>　ファイルの先頭の行を読み出したいときには<span>0</span>行読み飛ばすことになり、ファイルの最後の行を読み出したいときには、ファイルの行数−<span>1</span>行読み飛ばすことになります。したがって、読み飛ばす行数をランダムに決めるには、<span>0</span>行からファイルの行数未満までの乱数を作成すればいいということが分かります。以下のようにRandomクラスのNextメソッドを使い、<span>0</span>からTotalCount未満の値を作成しましょう。</p>
<div>
<pre lang="en"><code>SkipLine = r.Next(TotalCount)  ' 読み飛ばす行数を決める</code></pre></div>
<p>　ファイルを開く方法は、fortune.ctrファイルの場合と同じです。StreamReaderクラスのオブジェクトを参照するための変数を新たに宣言してもいいのですが、もはやfortune.ctrは使わないので、StreamReaderクラスのオブジェクトを参照するsrをもう一度使いましょう。</p>
<div>
<pre lang="en"><code>    sr = New System.IO.StreamReader("fortune.txt",⇒</code></pre>
<pre lang="en"><code>System.Text.Encoding.GetEncoding("shift_jis"))</code></pre></div>
<div>
<div>
<div>
<pre lang="en"><code></code></pre></div>
</div>
</div>
<div>
<div></div>
</div>
<p>　変数とオブジェクトの関係は図<span>9</span>-<span>4</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00130.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　fortune.ctrを指定したときと違って、引数がもう<span>1</span>つ指定されていることに注目してください。<span>2</span>番目の引数は文字コードを指定するためのものです。コード化の方法を表す引数は、見た目は複雑ですが、</p>
<div>
<pre lang="en"><code>System.Text.Encoding.GetEncoding()</code></pre></div>
<p>の()内に<span><b>コードページ</b></span>と呼ばれる値を指定するだけです。Shift-JISコードであれば"shift_jis"という文字列または932という整数を指定します。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>コードページの一覧を見るには</b></p>
</b></div>
<div>
<p>　Microsoft Developer Network（MSDN）のウェブページにある.NET Frameworkクラスライブラリの一覧で、System.Textの下のEncodingクラスのリファレンスを表示すれば、そのページの下の方に掲載されています。本書の執筆時点でのURLはhttps://msdn.microsoft.com/ja-JP/library/system.text.encoding(v=vs.110).aspxです。</p>
</div>
</div>
<p><br /></p>
<p>　さらに続きを見ていきましょう。</p>
<p>　SkipLineの行数だけ行を読み飛ばすには、繰り返し処理が使えます。iの値がSkipLineよりも小さい間、ファイルから<span>1</span>行ずつ読み出す処理を繰り返すといいでしょう（LIST<span>9</span>-<span>6</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>6</span>　SkipLineで示される行数だけ読み飛ばすためのコード</p>
</div>
<div>
<div>
<pre lang="en"><code>' 取り出す行を選択する</code></pre>
<pre lang="en"><code>Dim i As Integer = 0</code></pre>
<pre lang="en"><code>Do While i &lt; SkipLine</code></pre>
<pre lang="en"><code>    sr.ReadLine()   ' 空読みする</code></pre>
<pre lang="en"><code>    i += 1</code></pre>
<pre lang="en"><code>Loop</code></pre></div>
</div>
<p><br /></p>
<p>　例えば、SkipLineの値が<span>3</span>であれば、iの値が<span>0</span>、<span>1</span>、<span>2</span>のときに繰り返し処理の中にあるReadLineメソッドが実行され、順に行が読み出されます。ただし、これらの行は利用せずに読み飛ばすだけなので、変数に代入していません。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>For ... Nextステートメントを使って同じ処理をするには</b></p>
</b></div>
<div>
<p>　For ... Nextステートメントを使ってこの繰り返し処理を書くこともできます。</p>
</div>
<div>
<pre lang="en"><code>For i As Integer = 0 To SkipLine - 1</code></pre>
<pre lang="en"><code>    sr.ReadLine()</code></pre>
<pre lang="en"><code>Next</code></pre></div>
<div>
<p>　終了値から<span>1</span>を引いていることに注意しましょう。<span>10</span>回繰り返すときにはFor i =<span>0</span> To<span>9</span>と書いたのを思い出してください。SkipLine回繰り返すのであれば、終了値はSkipLine -<span>1</span>になります。</p>
</div>
</div>
<p><br /></p>
<p>　読み飛ばしのための繰り返し処理が終わった後、その次の行が格言として表示したい行です。行を読み出してOneLineに代入します。また、必要なデータが取り出せたので、ファイルを閉じておきます（LIST<span>9</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>　9</span>-<span>7</span>　目的の行を読み出し、ファイルを閉じる</p>
</div>
<div>
<div>
<pre lang="en"><code>OneLine = sr.ReadLine()		' 目的の行を読み出す</code></pre>
<pre lang="en"><code>sr.Close()</code></pre></div>
</div>
<p><br /></p>
<p>　以上で目的の行が取り出せました。あとはこれを表示するだけです。</p>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>3</b></span>　読み出した行を表示する</b></p>
</b></div>
<p id="calibre_link-350">　読み出した行はOneLineに代入されているので、これをlblFortuneコントロールに表示し、ステータスバーのラベルにも格言の番号を表示しておきましょう（LIST<span>9</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>8</span>　読み出した行と行の番号を表示する</p>
</div>
<div>
<div>
<div>
<pre lang="en"><code>lblFortune.Text = OneLine</code></pre>
<pre lang="en"><code>lblNumber.Text = (SkipLine + 1).ToString()</code></pre></div>
</div>
</div>
<p><br /></p>
<p>　以上で、目的の行を表示する処理は終わりです。</p>
<p>　なお、このプログラムではファイルから行を読み出し、ラベルに表示するまでを、</p>
<div>
<pre lang="en"><code>lblFortune.Text = sr.ReadLine()</code></pre></div>
<p>のようにまとめて書いても構いません。ただし、一般的には、読み出した行をさらに加工することもあるので、いったんOneLineなどの変数に代入しておいたほうがより柔軟な処理ができます。</p>
<p>　このプログラムのイベントハンドラーには、ほかにもメニュー項目を選択したときの処理やボタンをクリックしたときの処理があります。しかし、その前に例外処理について見ておきます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-266">
<div><b>
<p><b>■構造化例外処理を書く</b></p>
</b></div>
</div>
<hr />
<p id="calibre_link-348">　<span><b>例外処理</b></span>は、エラー処理と考えてもらっても構いません。しかし、「本来の目的とは異なる事態に対処する方法」という広い意味で、例外処理と呼ばれます。例えば、ファイルを利用するときには、開こうとしたファイルがなかったり、データを読み出せないことがあります。これらが<span><b>例外</b></span>にあたります。そのような例外に対処するためには、Try ... Catch ... Finally ... End Tryというステートメントを使います。このステートメントを使った例外処理は<span><b>構造化例外処理</b></span>と呼ばれます。</p>
<p>　構造化例外処理では、Tryの後に書かれたコードで例外が発生すると、Catchの後に書かれたコードが実行されます。したがって、例外が起こる可能性のあるコードはTryの後に書き、必要な例外処理はCatchの後に書いておきます。このとき、Catchの後に書かれた変数には、例外を表すオブジェクトの参照が自動的に代入されるので、この変数を利用して例外の種類を調べたり、例外の原因を表示したりできます（LIST<span>9</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>9</span>　Try ... Catch ...Finally ... End Tryステートメントの使い方</p>
</div>
<div>
<div>
<pre lang="en"><code>Try</code></pre>
<pre lang="en"><code>    実行したいコード	←例外が起こる可能性があるコードをここに書く</code></pre>
<pre lang="en"><code>Catch 変数名 As 例外の種類を表すクラス名</code></pre>
<pre lang="en"><code>    例外処理		←例外に対処するためのコードをここに書く</code></pre>
<pre lang="en"><code>        ：</code></pre>
<pre lang="en"><code>Finally</code></pre>
<pre lang="en"><code>    最後に実行したい処理	←いずれの場合にも最後に実行したいコードをここに書く</code></pre>
<pre lang="en"><code>End Try</code></pre></div>
</div>
<p><br /></p>
<p>　このステートメントに、fortune.ctrファイルから行数を読み出すためのコードを埋め込んでみましょう。実際には、Tryと入力して<img src="images/00137.jpeg" alt="" /> キーを押した時点でCatch ex As ExceptionやEnd Tryが自動的に入力されます。コードはLIST<span>9</span>-<span>10</span>のようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>10</span>　furtune.ctrファイルを処理するときの例外に対処する</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs) Handles⇒</code></pre>
<pre lang="en"><code>MyBase.Load</code></pre>
<pre lang="en"><code>        Dim OneLine As String</code></pre>
<pre lang="en"><code>        Dim sr As System.IO.StreamReader</code></pre>
<pre lang="en"><code>        ' コントロールファイルから行数を読み出す</code></pre>
<pre lang="en"><code>        Try</code></pre>
<pre lang="en"><code>            sr = New System.IO.StreamReader("fortune.ctr")</code></pre>
<pre lang="en"><code>            OneLine = sr.ReadLine()</code></pre>
<pre lang="en"><code>            TotalCount = Integer.Parse(OneLine)</code></pre>
<pre lang="en"><code>            sr.Close()</code></pre>
<pre lang="en"><code>        Catch ex As Exception</code></pre>
<pre lang="en"><code>            MessageBox.Show(ex.Message) ' 例外のメッセージを表示する</code></pre>
<pre lang="en"><code>            Application.Exit()</code></pre>
<pre lang="en"><code>        End Try</code></pre></div>
</div>
<br />
<p>　exで参照されるオブジェクトのMessageプロパティにエラーメッセージが入れられているので、例外が起こったときにはそれを表示します。このプログラムでは、ファイルからデータが読み込めなかったり、文字列が整数に変換できなかったりしたときには、実行を続けても意味がないので、そのままプログラムを終了させています。</p>
<p>　fortune.txtファイルから格言を読み出すコードについても同様にTry ... End Tryの中に書いておくといいでしょう。最初に示したLIST<span>9</span>-<span>1</span>には、そのコードも含まれています。全体像を確認しておいてください。なお、行数を読み出すコードと、格言を読み出すコードを別のTry ... End Tryに入れ、個別に例外処理をしても構いません。</p>
<p>　このようなコードを書くと、例外が起こったときに画面<span>9</span>-<span>5</span>のようなメッセージが表示されます。</p>
<p><br /></p>
<div>
<p><img src="images/00007.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　Catchステートメントは複数個書くこともできます。As の後に例外を表すクラスの名前を書けば、例外の種類によって対処方法を変えられるというわけです。例えば、As Exceptionと書くと、すべての例外に対処できますが、As FileNotFoundExceptionと書くと、ファイルが見つからなかったという例外だけに対処するコードが書けます。また、Integer.Parseメソッドは、文字列が整数に変換できないときにFormatExceptionという例外を発生させるので、その場合にはAs FormatExceptionの後に書かれたコードが実行されます（LIST<span>9</span>-<span>11</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>11</span>　さまざまな例外に対処するためのコード</p>
</div>
<div>
<div>
<pre lang="en"><code>Try</code></pre>
<pre lang="en"><code>    sr = New System.IO.StreamReader("fortune.ctr")</code></pre>
<pre lang="en"><code>    OneLine = sr.ReadLine()</code></pre>
<pre lang="en"><code>    TotalCount = Integer.Parse(OneLine)</code></pre>
<pre lang="en"><code>    sr.Close()</code></pre>
<pre lang="en"><code>Catch ex As System.IO.FileNotFoundException</code></pre>
<pre lang="en"><code>    MessageBox.Show("コントロールファイルが見つかりません")</code></pre>
<pre lang="en"><code>    Application.Exit()</code></pre>
<pre lang="en"><code>Catch ex As FormatException</code></pre>
<pre lang="en"><code>    MessageBox.Show("数値の形式が不正です")</code></pre>
<pre lang="en"><code>    Application.Exit()</code></pre>
<pre lang="en"><code>End Try</code></pre></div>
</div>
<p><br /></p>
<p>　<span>4</span>.<span>2</span>節や<span>7</span>.<span>5</span>節で使ったInteger.TryParseメソッドは、文字列が整数に変換できたかどうかをBoolean型の戻り値として返します（整数に変換できなくても例外は発生しません）。ここではTry ... Catch ... Finally ... End Tryを使った例外処理を利用するため、整数に変換できないときに例外を発生させるInteger.Parseメソッドを使ったというわけです。</p>
<p>　なお、Throwステートメントを使って自分で例外を発生させることもできます。例えば、Parseメソッドの代わりにTryParseメソッドを使い、数値に変換できないときに例外を発生させるようにするには、LIST<span>9</span>-<span>12</span>のようなコードを書きます。ただし、TryParseメソッドは、そもそも例外を発生させずに、戻り値によって変換が成功したかどうかを調べるためのメソッドなので、このコードはあまり適切なものではありません。あくまでも書き方の例として見てください。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>12</span>　Throwステートメントを使って例外を発生させる</p>
</div>
<div>
<div>
<pre lang="en"><code>Try</code></pre>
<pre lang="en"><code>    sr = New System.IO.StreamReader("fortune.ctr")</code></pre>
<pre lang="en"><code>    OneLine = sr.ReadLine()</code></pre>
<pre lang="en"><code>    If Integer.TryParse(OneLine, TotalCount) = False Then</code></pre>
<pre lang="en"><code>        Throw New Exception("数字と見なされません")</code></pre>
<pre lang="en"><code>    End If</code></pre>
<pre lang="en"><code>    sr.Close()</code></pre>
<pre lang="en"><code>Catch ex As Exception</code></pre>
<pre lang="en"><code>    MessageBox.Show(ex.Message)</code></pre>
<pre lang="en"><code>    Application.Exit()</code></pre>
<pre lang="en"><code>End Try</code></pre></div>
</div>
<p><br /></p>
<p>　Throwステートメントには例外を表すオブジェクトへの参照を指定します。ここではExceptionクラスのオブジェクトを作成し、それを指定しています。Exceptionクラスのオブジェクトを作成するときに引数に指定した文字列がMessageプロパティの値になります。Throwは「投げる」という意味です。自分で例外を発生させることを<span><b>例外をスローする</b></span>ということもあります。</p>
<p>　Finallyステートメントについても簡単に見ておきましょう。このプログラムではFinallyステートメントを使っていませんが、例外処理の最後に実行したいことがあれば、Finallyの後にコードを書いておきます。注意しなければならないのはFinallyの後に書かれたコードは例外が起こった場合にも、起こらなかった場合にも実行されるということです。これまでのコードでは、例外が発生した場合にはプログラムを終了させているので、Finallyの後にコードを書いてもあまり意味がありませんが、例えば、ファイルを閉じるためのCloseメソッドなどを書くことがあります（LIST<span>9</span>-<span>13</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>13</span>　Finallyステートメントに、最後に必ず実行する処理を書く</p>
</div>
<div>
<div>
<pre lang="en"><code>Try</code></pre>
<pre lang="en"><code>    sr = New System.IO.StreamReader("fortune.ctr")</code></pre>
<pre lang="en"><code>    OneLine = sr.ReadLine()</code></pre>
<pre lang="en"><code>    TotalCount = Integer.Parse(OneLine)</code></pre>
<pre lang="en"><code>Catch ex As Exception</code></pre>
<pre lang="en"><code>    MessageBox.Show(ex.Message)</code></pre>
<pre lang="en"><code>Finally</code></pre>
<pre lang="en"><code>    sr.Close()</code></pre>
<pre lang="en"><code>End Try</code></pre></div>
</div>
<p><br /></p>
<p>　このコードでは、例外が起こった場合にメッセージを表示するだけで、特に何もしていません。しかし、Finallyの後にCloseメソッドが書かれているので、例外が起こった場合でも起こらなかった場合でも正しくファイルが閉じられます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-267">
<div><b>
<p><b>■新しい格言をファイルに書き込む</b></p>
</b></div>
</div>
<hr />
<p>　このプログラムの便利なところは、単に格言を表示するだけでなく、自分で格言を追加できることです。格言を追加するには、メニューから［編集（E）］−［格言の追加（A）...］を選びます。したがって、このメニュー項目を選択したときのイベントハンドラーに、格言を追加するためのコードを書けばいいということが分かります。</p>
<p>　格言を追加するための処理は以下のようになります。</p>
<p><br /></p>
<div>
<p>■　<span><b>ステップ<span><b>1</b></span>　新しい格言を入力する</b></span></p>
</div>
<div>
<p>　InputBoxを表示して格言を入力する</p>
</div>
<div>
<p>　キャンセルされたり、格言が入力されていなければプロシージャを抜ける</p>
</div>
<div>
<p><br /></p>
</div>
<div>
<p>■　<span><b>ステップ<span><b>2</b></span></b></span>　<span><b>格言ファイルに新しい格言を追加する</b></span></p>
</div>
<div>
<p>　fortune.txtファイルを開く</p>
</div>
<div>
<p>　格言を追加する</p>
</div>
<div>
<p><br /></p>
</div>
<div>
<p>■　<span><b>ステップ<span><b>3</b></span>　コントロールファイルに新しい行数を書き込む</b></span></p>
</div>
<div>
<p>　現在の行数に<span>1</span>加える</p>
</div>
<div>
<p>　コントロールファイルに書き込む</p>
</div>
<p><br /></p>
<div><b>
<p><b>■メニュー項目のClickイベントハンドラー</b></p>
</b></div>
<p>　［編集（E）］−［格言の追加（A）...］のClickイベントハンドラーは、LIST<span>9</span>-<span>14</span>のようになります。まずはコードの全体像を眺めておいてください。後で少しずつ詳しく見ていくので、この段階ではおおまかな流れを確認するだけで十分です。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>14</span>　［編集（E）］−［格言の追加（A）...］のClickイベントハンドラー（格言を追加する）</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub AddFortune(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles mnuEA.Click</code></pre>
<div>
<pre lang="en"><code>Dim NewFortune As String　　　●───ステップ1　新しい格言を入力する→<a href="#calibre_link-351"><u>P.348</u></a></code></pre>
<pre lang="en"><code>NewFortune = InputBox("格言を入力してください")</code></pre>
<pre lang="en"><code>If NewFortune = "" Then Exit Sub</code></pre></div>
<pre lang="en"><code></code></pre>
<div>
<pre lang="en"><code>Try	</code></pre>
<pre lang="en"><code>    Dim sw As System.IO.StreamWriter　　　●───ステップ2　格言ファイルに新しい格言を追加する→<a href="#calibre_link-351"><u>P.348</u></a></code></pre>
<pre lang="en"><code>    ' 行を追加</code></pre>
<pre lang="en"><code>    sw = New System.IO.StreamWriter("fortune.txt",True,</code></pre>
<pre lang="en"><code>           System.Text.Encoding.GetEncoding("shift_jis"))</code></pre>
<pre lang="en"><code>    sw.WriteLine(NewFortune)</code></pre>
<pre lang="en"><code>    sw.Close()</code></pre></div>
<pre lang="en"><code></code></pre>
<div>
<pre lang="en"><code>    TotalCount += 1 ' コントロールファイルの行数を増やす</code></pre>
<pre lang="en"><code>    sw = New System.IO.StreamWriter("fortune.ctr", False)</code></pre>
<pre lang="en"><code>    sw.WriteLine(TotalCount)</code></pre>
<pre lang="en"><code>    sw.Close()　　　●───ステップ3　コントロールファイルに新しい行数を書き込む→<a href="#calibre_link-352"><u>P.349</u></a></code></pre></div>
<pre lang="en"><code></code><code>　Catch ex As Exception	</code>
</pre>
<pre lang="en"><code>            MessageBox.Show(ex.Message)</code></pre>
<pre lang="en"><code>            Application.Exit()</code></pre>
<pre lang="en"><code>        End Try</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　ステップ<span>2</span>とステップ<span>3</span>では、ファイルにデータを書き込むので、ファイルが見つからなかった場合などのエラーに備えて構造化例外処理を書いてあります。では、各ステップの詳細を見ていきましょう。</p>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>1</b></span>　新しい格言を入力する</b></p>
</b></div>
<p id="calibre_link-351">　LIST<span>9</span>-<span>14</span>はメニュー項目をクリックしたときのイベントハンドラーです。メニュー項目といっても、イベントハンドラーの追加の方法はほかのコントロールと同じです。フォームに配置されているメニューから［格言の追加（A）...］を選択し、プロパティウィンドウのイベント一覧にある［Click］の欄にイベントハンドラー名を入力します。イベントハンドラーの名前をAddFortuneとすると、以下のようなコードが追加されます（LIST<span>9</span>-<span>15</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>15</span>　メニュー項目のClickイベントハンドラー</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub AddFortune (sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles mnuEA.Click</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　ここでも、必要な変数から考えていきます。入力された格言をファイルに保存したいので、格言を記憶しておくための変数が必要になります。String型で宣言しておくといいでしょう。</p>
<div>
<pre lang="en"><code>Dim NewFortune As String</code></pre></div>
<p>　とりあえず必要な変数はこれだけなので、コードの続きを書いていきましょう。格言を入力するためにはInputBoxを表示します。InputBoxに何も入力されていなかったり、［キャンセル］ボタンがクリックされたときには、長さ<span>0</span>の文字列が返されるので、その場合は何もせずにイベントハンドラーを抜けます（LIST<span>9</span>-<span>16</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>16</span>　InputBoxを使って格言を入力するためのコード</p>
</div>
<div>
<div>
<pre lang="en"><code>NewFortune = InputBox("格言を入力してください")</code></pre>
<pre lang="en"><code>If NewFortune = "" Then Exit Sub</code></pre></div>
</div>
<p><br /></p>
<p>　ここまでが格言を入力するためのコードです。InputBoxで新しい格言を入力し［OK］ボタンをクリックすれば、続くステップ<span>2</span>のコードが実行されます。</p>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>2</b></span>　格言ファイルに新しい格言を追加する</b></p>
</b></div>
<p>　続くコードでは、格言をfortune.txtファイルに追加書き込みします。ファイルに行を書き込むためには、StreamWriterクラスのオブジェクトを使います。このオブジェクトを参照する変数をswという名前で宣言し、ファイルを開きましょう。StreamWriterクラスのフルネームはSystem.IO.StreamWriterです（LIST<span>9</span>-<span>17</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>17</span>　StreamWriterクラスのオブジェクトを作成する</p>
</div>
<div>
<div>
<pre lang="en"><code>    Dim sw As System.IO.StreamWriter</code></pre>
<pre lang="en"><code>    sw = New System.IO.StreamWriter("fortune.txt", True,</code></pre>
<pre lang="en"><code>           System.Text.Encoding.GetEncoding("shift_jis"))</code></pre></div>
</div>
<p><br /></p>
<p>　StreamWriterクラスをコードの中でよく使うのであれば、コードの先頭に</p>
<div>
<pre lang="en"><code>Imports System.IO</code></pre></div>
<p>と書いておくといいでしょう。そうすれば、System.IO.StreamWriterと書く代わりにStreamWriterと略して書けるようになります。</p>
<p>　StreamWriterクラスのオブジェクトを作成するときには、引数にファイル名が指定できます。fortune.txtファイルには日本語文字が含まれており、Shift-JISコードで内容を書き込むので、コードの種類も指定します。</p>
<p>　このコードを見て「おや」と思った方もおられるでしょう。StreamReaderクラスの場合とは異なり、<span>2</span>番目の引数にTrueを指定してあります。その後にコードの種類が指定されています。実は、ファイルに書き込むときには、追加書き込みであるか新規書き込みであるかが指定できます。Trueを指定すると追加になるので、入力された格言はfortune.txtファイルのこれまでの内容の末尾に追加されます。一方、Falseを指定すると新規書き込みになり、それまでに保存されていたデータを消して新しくデータを書き込むことになるので注意が必要です。</p>
<p>　ファイルに書き込むためには、StreamWriterクラスのWriteLineメソッドを使います。これは引数に文字列を指定するだけなので簡単です。行を追加書き込みしたら、Closeメソッドを呼び出してファイルを閉じておきます（LIST<span>9</span>-<span>18</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>18</span>　ファイルに格言を書き込んだ後、ファイルを閉じる</p>
</div>
<div>
<div>
<pre lang="en"><code>sw.WriteLine(NewFortune)</code></pre>
<pre lang="en"><code>sw.Close()</code></pre></div>
</div>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>3</b></span>　コントロールファイルに新しい行数を書き込む</b></p>
</b></div>
<p id="calibre_link-352">　最後に、fortune.ctrファイルに保存されている行数を増やします。以前のファイルの内容を書き換えるので、新規書き込みとします（LIST<span>9</span>-<span>19</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>19</span>　行数を加算し、fortune.ctrファイルに書き込む</p>
</div>
<div>
<div>
<pre lang="en"><code>TotalCount += 1 ' コントロールファイルの行数を増やす</code></pre>
<pre lang="en"><code>sw = New System.IO.StreamWriter("fortune.ctr", False)</code></pre>
<pre lang="en"><code>sw.WriteLine(TotalCount)</code></pre>
<pre lang="en"><code>sw.Close()</code></pre></div>
</div>
<p><br /></p>
<p>　今度は、StreamWriterクラスのオブジェクトを作成するときに、<span>2</span>番目の引数にFalseを指定していることに注意してください。これは、ファイルに新規書き込みするためです。また、WriteLineメソッドの引数に文字列でなく整数を指定していることにも注目してください。StreamWriterクラスのWriteLineメソッドはさまざまなデータ型の引数を指定できるようにオーバーライドされており、引数がWriteLineメソッドの中で文字列に変換されているからです。したがって、</p>
<div>
<pre lang="en"><code>   sw.WriteLine(TotalCount.ToString())</code></pre></div>
<p>のようにTotalCountを文字列に変換してから引数に指定する必要はありません。</p>
<p><br /></p>
<div>
<div><b>
<p><b><span><b><img src="images/00279.jpeg" alt="" /><b></b></b></span>My.Computer.FileSystemオブジェクトも利用できる</b></p>
</b></div>
<div>
<p>　My.Computer.FileSystemオブジェクトのOpenTextFileWriterメソッドを利用すれば、StreamWriterオブジェクトが取得できます。したがって、以下のように書くこともできます。なお、<a href="#calibre_link-352"><u>P.349</u></a>と同様に文字コードの指定もできます。</p>
</div>
<div>
<pre lang="en"><code> Dim sw As System.IO.StreamWriter</code></pre>
<pre lang="en"><code> sw = My.Computer.FileSystem.OpenTextFileWriter (⇒</code></pre>
<pre lang="en"><code>"fortune.ctr", False)</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-268">
<div><b>
<p><b>■格言をクリップボードにコピーする</b></p>
</b></div>
</div>
<hr />
<p>　このプログラムには、表示された格言をクリップボードにコピーする機能があります。この機能は［編集（E）］−［コピー（C）］を選択したときに実行するので、mnuECコントロールのClickイベントハンドラーに記述します。</p>
<p>　クリップボードにデータをコピーするにはClipboardクラスのSetDataメソッドを使います。SetDataメソッドは<span><b>共有メソッド</b></span>（静的メソッド）なので、Clipboardクラスの新しいオブジェクトを作らなくてもそのまま使えます。引数にはデータの形式とデータを指定します（LIST<span>9</span>-<span>20</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>20</span>　クリップボードにデータをコピーする</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub CopyProc(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles mnuEC.Click</code></pre>
<pre lang="en"><code>        Clipboard.SetData(DataFormats.Text, lblFortune.Text)</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　データの形式にはDataFormats.Text以外にもさまざまな形式が指定できます。よく使うのは表<span>9</span>-<span>4</span>のような形式です。</p>
<p><br /></p>
<div>
<p><img src="images/00237.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　テキストデータの場合は、ClipboardクラスのSetTextメソッドも使えます。テキストはUnicodeテキスト文字列としてクリップボードにコピーされます。</p>
<p>　クリップボードのデータを取り出したいときには、GetDataメソッドを使います。これも共有メソッドなのでオブジェクトを作成せずにそのまま使えます。GetDataメソッドにデータの形式を指定して呼び出すと、クリップボードから取り出されたデータが返されます。</p>
<div></div>
<p>　また、テキストデータの場合は、GetTextメソッドも使えます。テキストはUnicodeテキスト文字列としてクリップボードから取り出されます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-269">
<div><b>
<p><b>■プログラムを終了させる</b></p>
</b></div>
</div>
<hr />
<p>　最後に［終了（X）］ボタンと［ファイル（F）］−［終了（X）］のClickイベントハンドラーを書きます。いずれを選択してもプログラムを終了させるので、同じイベントハンドラーを使います。btnExitコントロールのClickイベントハンドラーとしてExitProcプロシージャを書いておき、mnuFXのイベントハンドラーとしてもExitProcプロシージャを選択すればいいでしょう。Private Subステートメントの最後にカンマで区切ってmnuFX.Clickという文字列を自分で入力しても構いません。コードは以下のとおりです（LIST<span>9</span>-<span>21</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 9</span>-<span>21</span>　プログラムを終了させるためのコード</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles btnExit.Click, mnuFX.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-270">
<div><b>
<p><b>■プログラムを実行する</b></p>
</b></div>
</div>
<hr />
<p>　コードがすべて入力できたら［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックして、プログラムを実行します。プログラムが実行されると、格言がランダムに表示されます。ステータスバーに格言の番号が表示されていることにも注目してください（画面<span>9</span>-<span>6</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00202.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　表示された格言はクリップボードにコピーして、テキストエディターやワープロソフトの文書に貼り付けることもできます。さらに、さまざまな機能を追加すれば、より便利で役に立つプログラムが作成できるはずです。演習問題に取り組み、プログラムの拡張にぜひチャレンジしてみてください。</p>
<p><br /></p>
<div>
<div id="calibre_link-299">
<div><b>
<p><b><span><b><img src="images/00053.jpeg" alt="" /><b></b></b></span>カンマ区切りのファイルや固定長フィールドのファイルを取り扱う</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />ShowCSV, ShowFixed</p>
</div>
<p><br /></p>
<div>
<p>　この章のプログラムでは、<span>1</span>行のデータをそのまま読み出しましたが、ファイルには、区切り文字によって<span>1</span>行がいくつかのフィールド（項目）に区切られているものや、フィールドの桁数が決まっているものなどもあります。それらについては、Microsoft.VisualBasic.FileIO.TextFieldParserクラスのオブジェクトを利用して取り扱うことができます。</p>
</div>
<div>
<p>　フィールドの区切り文字はDelimitersプロパティまたはSetDelimtersメソッドに文字列の配列を指定することによって設定します。<span>1</span>行のすべてのフィールドを読み出すにはReadFieldsメソッドが使えます。ReadFieldsメソッドは、各フィールドの内容を文字列の配列として返します。以下のコードはフィールドが「:」（コロン）または「,」（カンマ）で区切られたファイルから<span>1</span>行ずつ各フィールドを読み出し、出力ウィンドウに表示する例です。</p>
</div>
<p><br /></p>
<div>
<pre lang="en"><code>Imports Microsoft.VisualBasic.FileIO</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub ShowCSVFile(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles Button1.Click</code></pre>
<pre lang="en"><code>        Dim aRow As String()　　　●───1行に含まれる各フィールドのデータ。文字列の配列</code></pre>
<pre lang="en"><code>        Dim tfp As TextFieldParser = New TextFieldParser (</code></pre>
<pre lang="en"><code>            "sample.txt", System.Text.Encoding.GetEncoding("shift_⇒</code></pre>
<pre lang="en"><code>jis"))　　　●───TextFieldParserクラスのオブジェクトを作成する</code></pre>
<pre lang="en"><code>						　 </code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        tfp.Delimiters = New String() { ":", ","}　　　●───</code><code>フィールドの区切りを「:」（コロン）または「,」（カンマ）とする</code>
</pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        Do While Not tfp.EndOfData　　　●───データがなくなるまで</code></pre>
<pre lang="en"><code>            aRow = tfp.ReadFields()　　　●───フィールドを読み出す。文字列の配列として読み出されるので、その参照をaRowに代入</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>            For Each aField As String In aRow　　　●───aRowの各フィールドについて</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>                Debug.WriteLine(aField)　　　●─── フィールドを表示する</code></pre>
<pre lang="en"><code>            Next</code></pre>
<pre lang="en"><code>        Loop</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre>
<pre lang="en"><code></code></pre></div>
<div>
<p>　以下に示すのはファイルの内容がどのように読み出され、表示されるかを図にしたものです。</p>
</div>
<p><br /></p>
<p><img src="images/00347.jpeg" alt="" /></p>
<p><br /></p>
<p><br /></p>
<div>
<p>　一方、固定長のフィールドの場合は、TextFieldTypeプロパティにFieldType.FixedWidthを指定し、FieldWidthsプロパティに各フィールドの長さを整数の配列として指定します。以下のコードは<span>1</span>行が<span>5</span>文字,<span>4</span>文字,<span>4</span>文字,<span>3</span>文字の各フィールドから成り立っているファイルから<span>1</span>行ずつ各フィールドを読み出し、出力ウィンドウに表示する例です。地色の濃い箇所が、前のコードと異なるコードです。</p>
</div>
<div>
<pre lang="en"><code>Imports Microsoft.VisualBasic.FileIO</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub ShowFixedFile(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles Button1.Click</code></pre>
<pre lang="en"><code>        Dim aRow As String()</code></pre>
<pre lang="en"><code>        Dim tfp As TextFieldParser = New TextFieldParser (</code></pre>
<pre lang="en"><code>            "sample.txt", System.Text.Encoding.GetEncoding("shift_⇒</code></pre>
<pre lang="en"><code>jis"))</code></pre></div>
<div>
<div>
<pre lang="en"><code>       tfp.TextFieldType = FieldType.FixedWidth　　　●───固定長フィールドであることを指定する</code></pre>
<pre lang="en"><code>       tfp.FieldWidths = New Integer() {5, 4, 4, 3}　　　●───フィールドの長さを整数の配列として指定する</code></pre></div>
</div>
<div>
<pre lang="en"><code>    　　　</code><code>Do While Not tfp.EndOfData</code>
</pre>
<pre lang="en"><code>            aRow = tfp.ReadFields()</code></pre>
<pre lang="en"><code>            For Each aField As String In aRow</code></pre>
<pre lang="en"><code>                Debug.WriteLine(aField)</code></pre>
<pre lang="en"><code>            Next</code></pre>
<pre lang="en"><code>        Loop</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<div>
<p>　こちらも、ファイルの内容がどのように読み出され、表示されるかを図にしておきます。</p>
<p><br /></p>
<div>
<p><img src="images/00209.jpeg" alt="" /></p>
</div>
</div>
</div>
<p>　</p>
</div>
</div>
<div id="calibre_link-315">
<div>
<div><b>
<p><b>Chapter<span><b>9</b></span>のまとめ</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span>ファイルのデータを<span><b>1</b></span>行読み出すにはStreamReaderクラスのReadLineメソッドが使えます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　ファイルにデータを<span><b>1</b></span>行書き込むにはStreamWriterクラスのWriteLineメソッドが使えます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　ファイルにデータを書き込むときには、追加書き込みと新規書き込みの違いに注意する必要があります</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Try ... Catch ... Finally ... End Tryステートメントを利用すると構造化例外処理ができます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　構造化例外処理では、例外の種類によってきめ細かく対処法を変えることができます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　Clipboardクラスの共有メソッドを使うと、クリップボードとのデータのやりとりができます</b></p>
</b></div>
</div>
</div>
<div id="calibre_link-57">
<div>
<div id="calibre_link-271">
<div><b>
<p><b>練習問題</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />Fortune<span>2</span>, ShowFixed<span>2</span></p>
</div>
<p><br /></p>
<div>
<p><span><b>［A］</b></span>この章で見たFortuneプログラムは、プログラムを実行したときに（フォームが表示される直前に）格言が表示されるものでした。フォーム上にButtonコントロールを配置し、クリックすれば、別の格言がランダムに表示されるようにしてみましょう。プロジェクト名はFortune<span>2</span>とします。</p>
</div>
<div>
<p><br /></p>
</div>
<div>
<p><span><b>［B］</b></span>この章の最後のコラムにあるコードには例外処理が書かれていません。固定長フィールドの行を読み出すコードに構造化例外処理を適用したコードを書いてみてください。対処する例外は以下の<span>2</span>つとします。</p>
</div>
<p><br /></p>
<div>
<pre lang="en"><code>	System.IO.FileNotFoundException　　　●───ファイルが見つからない</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>	Microsoft.VisualBasic.FileIO.MalformedLineException　　　●───</code><code>フィールドの形式が正しくない（フィールドの桁数が1行の幅よりも短い場合など）</code>
</pre></div>
<p><br /></p>
<div>
<div>
<p><br /></p>
</div>
</div>
<div>
<p>　　例外が発生した場合は、右側の説明に書いた文章をメッセージとして表示し、プログラムを終了するものとします。プログラムができたら、データファイルの名前を変えたり、フィールドの幅を変えたりして例外を発生させ、動作を確認してみてください。プロジェクト名はShowFixed<span>2</span>とします。なお、データファイルの正しい名前はsample.txtとし、実行用プログラムと同じフォルダーに作成しておいてください。</p>
</div>
</div>
</div>
<div id="calibre_link-329">
<div>
<div id="calibre_link-272">
<div><b>
<p><b>Chapter<span><b>10</b></span></b></p>
</b></div>
</div>
<p><br /></p>
<div><b>
<p><b>データベースを取り扱う〜アイディアプロセッサ</b></p>
</b></div>
<hr />
<div>
<p>Visual Basicでは、コントロールを配置してプロパティを設定するだけでSQL ServerやMicrosoft Accessなどのデータベースが簡単に取り扱えます。さらに、コードを記述することにより、きめ細かな処理のできるプログラムが作成できます。この章では、思いついたアイディアをキーワードとともに記録しておいたり、キーワードを使ってアイディアを検索したりできる簡単なデータベースアプリケーションを作成してみます。</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b><span><b>10</b></span>.<span><b>1</b></span>　いちばん簡単なデータベースアプリケーション</b></p>
</b></div>
<div>
<p>データの取り扱い方を知る／データベースをプロジェクトに追加する／データベースを利用するためのコントロールを配置する／プログラムを実行する／テキストボックスにテーブルの内容を表示する／自動的に追加されたコードを見る／検索機能を追加する</p>
</div>
<p><br /></p>
<div><b>
<p><b><span><b>10</b></span>.<span><b>2</b></span>　コードを使ってデータベースを操作する</b></p>
</b></div>
<div>
<p>ここで使うコントロール／フォームをデザインする／ダイアログボックスをデザインする／レコードを検索するためのコードを書く／レコードを追加するためのコードを書く／レコードを修正するためのコードを書く／レコードを削除するためのコードを書く／プログラムを終了させる／プログラムを実行する</p>
</div>
</div>
</div>
<div id="calibre_link-1">
<div>
<div><b>
<p><b>これから学ぶこと</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span><span><b>　</b></span>データベースのレコードをDataGridViewコントロールやTextBoxコントロールに表示する方法を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　データベースを操作するためのさまざまなコントロールの働きと使い方を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　データベースのレコードを検索、追加、修正、削除するためのコードの書き方を学びます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　自分でデザインしたダイアログボックスを表示する方法を学びます</b></p>
</b></div>
<p><br /></p>
<div>
<p><img src="images/00087.jpeg" alt="" /></p>
</div>
<p><br /></p>
<div>
<p>　この章ではアイディアが保存されたデータベースをキーワードによって検索するプログラムを作成します。データベースの検索だけでなく、新しいアイディアをキーワードとともに保存したり、すでに保存されているデータを修正したり、削除したりする方法も学び、データベースのひととおりの取り扱い方を身に付けます。</p>
</div>
</div>
</div>
<div id="calibre_link-44">
<div>
<div id="calibre_link-273">
<div><b>
<p><b>　<span><b>10</b></span>.<span><b>1</b></span>　いちばん簡単なデータベースアプリケーション</b></p>
</b></div>
</div>
<p><br /></p>
<p>　データベースを利用すると、必要な項目だけを取り出して表示したり、キーワードを含む行を検索したり、並べ替えたり、集計したり、とさまざまな方法でデータが活用できます。ここでは、手始めにデータベースの内容を表示するプログラムから見ていきます。驚くべきことに、コードを<span>1</span>行も書かなくても、データの表示、修正、追加、削除ができてしまいます。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-274">
<div><b>
<p><b>■データの取り扱い方を知る</b></p>
</b></div>
</div>
<hr />
<p>　データベースを利用するプログラムの基本を理解しておくために、データベースに含まれるテーブルの内容を表示するだけのプログラムを見ておきます。最初のプログラムでは、コードを書く必要はまったくありません。</p>
<p>　データベースとしては、思いついたアイディアにキーワードを付けて保存したようなものを使うことにします。内容は以下のような簡単なものとし、すでにMicrosoft Accessを使って作られているものとします。データベースでデータを取り扱うときに使う「テーブル」「レコード」「フィールド」などの用語の意味を確認しておいてください（図<span>10</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00305.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　<span>1</span>つのデータベースの中には複数の<span><b>テーブル</b></span>（表）が作られていることもありますが、ここでは、テーブルは<span>1</span>つだけとします。<span><b>レコード</b></span>は「行」にあたるもので、<span><b>フィールド</b></span>は「項目」にあたるものです。各フィールドはデータ型が決められていることにも注意しましょう。</p>
<p>　では、ShowDBという名前の新しいプロジェクトを作成し、ideadb.mdbというデータベースのideatableというテーブルを利用できるようにしましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-275">
<div><b>
<p><b>■データベースをプロジェクトに追加する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />ShowDB</p>
</div>
<hr />
<p>　いつもの手順では、プロジェクトを作成した後、フォームのデザインに移っていました。しかし、プロジェクトにデータベースを追加すると、なんと、フォームのデザインも自動的にできてしまいます。したがって、データベースの追加から始めましょう。フォームのデザインを細かく調整するのはその後にします。</p>
<p>　データベースの追加はきわめて簡単です。エクスプローラーに表示されているデータベースファイルのアイコンをドラッグし、ソリューションエクスプローラーのプロジェクト名にドロップするだけです（画面<span>10</span>-<span>1</span>）<span>※<span>1</span></span>。</p>
<p><br /></p>
<div>
<p><img src="images/00075.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　ただし、これだけでは、データベースのファイルを取り込んだだけで、プログラムから利用できる状態にはなっていません。そこで、データベースに接続する操作を行います。</p>
<p><br /></p>
<hr />
<div>
<p>※<span>1</span>　次の［データソース］ウィンドウからの操作だけでデータベースのファイルを取り込むこともできます。しかしながら、あらかじめファイルを取り込んでおいた方が、手順が少し簡単になるので、ここでは画面<span>10</span>-<span>1</span>の操作を行っておきます。</p>
</div>
</div>
</div>
<div id="calibre_link-333">
<div>
<p>　まず、メニューから［表示（V）］－［その他のウィンドウ（E）］－［データソース（D）］を選択して、［データソース］ウィンドウを表示しておきましょう。そのウィンドウで［新しいデータソースの追加］をクリックします（画面<span>10</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00054.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［新しいデータソースの追加...］をクリックする</p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00284.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>①　［データベース構成］ウィザードの［データソースの種類の選択］画面が表示される</p>
</div>
<div>
<p>❷　［アプリケーションのデータの取得元（W）］の一覧に表示されている［データベース］をクリックする</p>
</div>
<div>
<p>❸　［次へ（N）&gt;］をクリックする</p>
</div>
<div>
<p>④　［データベースモデルの選択］画面が表示される</p>
</div>
<div>
<p>❺　［データセット］をクリックする</p>
</div>
<div>
<p>❻　［次へ（N）&gt;］をクリックする</p>
</div>
<p><br /></p>
<p>　ここでは、データベースの種類とデータベースモデルを選択しました。「データソース」というのはデータの出どころといった意味です。一般的なデータベースだけでなく、各種のサービスやオブジェクト、SharePointサイトのデータが利用できますが、このプログラムでは、Microsoft Accessのデータベースを利用するので［データベース］を選択しました。</p>
<p>　データベースモデルとは、データベースの形式とでも考えておいてください。ここで選択した［データセット］とは、行と列からなる表と、表同士の関連を含んだ形式です。</p>
<p>先に進みましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00156.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>①　［データ接続の選択］画面が表示される</p>
</div>
<div>
<p>❷　［次へ（N）&gt;］をクリックする</p>
</div>
<div>
<p>③　［接続文字列をアプリケーション構成ファイルに保存する］画面が表示される</p>
</div>
<div>
<p>❹　［次へ（N）&gt;］をクリックする</p>
</div>
<p><br /></p>
<p>　［データ接続の選択］画面ではデータソースの接続文字列を指定します。これはデータベースの種類やファイル名、接続時のオプションなどを文字列として表したものです。ここではすでに取り込んだデータベース名が表示されているので、そのまま［次へ（N）&gt;］をクリックして先に進みます。なお、実際にどのような文字列になるのかを見たい場合は［アプリケーションの保存する接続文字列（S）］の前にある［＋］をクリックすれば、接続文字列が表示されます。</p>
<p>　次の画面では、接続文字列をアプリケーション構成ファイル（App.configファイル）に保存するかどうかを指定します。接続文字列を保存しておけば、修正が必要になった場合にも、保存した内容を編集するだけで対応できるようになります。ここでも、そのまま［次へ（N）&gt;］をクリックして先に進みましょう。続いて、データベース内のどの情報を利用するかを指定します。</p>
<p><br /></p>
<div>
<p><img src="images/00023.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><span><b>❶</b></span>　［▷］をクリックする（クリックすると表示が［<img src="images/00264.jpeg" alt="" />］に変わる）</p>
</div>
<div>
<p><span><b>②</b></span>　下位のテーブルやフィールドが表示される</p>
</div>
<div>
<p><span><b>❸</b></span>　テーブルのチェックマークをクリックしてオンにする</p>
</div>
<div>
<p><span><b>④</b></span>　テーブルとすべてのフィールドが選択される</p>
</div>
<div>
<p><span><b>❺</b></span>　［完了（F）］ボタンをクリックする</p>
</div>
<p><br /></p>
<p>　このプログラムでは、ideatableのすべてのフィールドを利用します。ideatableの前にあるチェックボックスをクリックしてチェックマークを付けましょう。テーブルにチェックマークを付けると、すべてのフィールドに自動的にチェックマークが付けられます。［完了（F）］ボタンをクリックすれば、設定の終了です。</p>
<p>　また、データベースのファイル名の末尾にDataSetという文字列を付加した名前が［データセット名（D）］に設定されていることにも注意しましょう。<span><b>データセット</b></span>とは、データベースの内容を読み込んでおくためのオブジェクトです。データベースの内容を操作するときには、データベースを直接操作するのではなく、データセットを操作します。データベースの更新が必要になった時点で、データセットの内容をデータベースに書き出すというわけです（図<span>10</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00126.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-276">
<div><b>
<p><b>■データベースを利用するためのコントロールを配置する</b></p>
</b></div>
</div>
<hr />
<p>　次に、データセットをもとにコントロールを自動的に配置します。Visual Studioの画面の左に表示されている［データソース］タブをクリックし、データセットのテーブル名を選択します。ここではideadbDataSetの下位にあるideatableを選択し、以下のようにフォーム上にドラッグして配置してください（画面<span>10</span>-<span>6</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00003.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><span><b>❶　</b></span>テーブル名の右の［∨］をクリックする</p>
</div>
<div>
<p><span><b>❷　</b></span>［DataGridView］をクリックする</p>
</div>
<div>
<p><span><b>❸</b></span>　テーブル名の前に表示されているアイコンをドラッグする</p>
</div>
<p><br /></p>
<p>　DataGridViewコントロールがフォーム上に配置されるとともに、ツールバーが表示されます。このツールバーはデータベースを操作するために使われるBindingNavigatorコントロールです（画面<span>10</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00230.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><span><b>①</b></span>　BindingNavigatorコントロールが自動的に配置される</p>
</div>
<div>
<p><span><b>②</b></span>　DataGridViewコントロールが配置される。列は自動的に追加され、項目名も設定されている</p>
</div>
<div>
<p><span><b>③</b></span>　データベースを利用するために使われる各種のコントロールが配置される。コントロールが重なって表示されている場合は何も表示されていない部分を右クリックして［等間隔に整列（L）］を選択する</p>
</div>
<p><br /></p>
<p>　画面の下を見ると、ほかにもデータセット、BindingSourceコントロール、TableAdapterコントロール、TableAdapterManagerコントロールが表示されていることが分かります。それぞれの働きを整理すると図<span>10</span>-<span>3</span>のようになります。このプログラムでは、これらのコントロールを意識する必要はほとんどありませんが、全体像と各コントロールの関係について、ざっと確認しておきましょう。</p>
<p><br /></p>
<div>
<p>■BindingNavigator：データベースを操作するために使うツールバー</p>
</div>
<div>
<p>■BindingSource：フォーム上のコントロールとデータセットを結びつけるために使われる</p>
</div>
<div>
<p>■TableAdapter：データセットとデータベースとの間でデータをやりとりするために使われる</p>
</div>
<div>
<p>■TableAdapterManager：データベースの更新順序を変えるなど、データの保存をきめ細かく、簡単に実行するために使われる</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00253.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　以上でデータベースの追加とコントロールの配置は終了です。あとは、フォームの境界線のスタイルを変えたり、コントロールのサイズや位置を変えるなど、デザインを調整するだけでプログラムは完成です。データベースの内容が自動的にDataGridViewコントロールに表示され、データの変更や追加などもできるようになります。表<span>10</span>-<span>1</span>にプロパティをまとめておきます。フォームのプロパティ以外は変更する必要はありませんが、それぞれのコントロールにどのようなプロパティが設定されているか、ひととおり見ておいてください。確認ができたら、さっそく［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックして、プログラムを実行してみましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00331.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-277">
<div><b>
<p><b>■プログラムを実行する</b></p>
</b></div>
</div>
<hr />
<p>　プログラムを実行すると、データベースのテーブルの内容がDataGridViewコントロールに表示されます。BindingNavigatorのボタンをクリックすれば、レコードの移動、新規レコードの追加、削除、変更内容の保存ができます（画面<span>10</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00206.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　以上で、はじめてのデータベースアプリケーションが完成しました。続いて、重要な関連知識をまとめておきましょう。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-278">
<div><b>
<p><b>■テキストボックスにテーブルの内容を表示する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />ShowDBCard</p>
</div>
<hr />
<p>　はじめてのデータベースプログラムでは、テーブルの内容をDataGridViewコントロールに一覧表示しました。しかし、一覧形式ではなく<span>1</span>画面につき<span>1</span>レコードの、いわゆるカード型データベースのような形式で表示したいこともあるでしょう。そのような場合には、［データソース］ウィンドウで、データの表示方法として［詳細］を選びます。</p>
<p>　ShowDBプロジェクトは後でまた使うので、ここではShowDBプロジェクトをコピーしたもので試してみましょう。もちろん、おさらいをかねて、新しいプロジェクトを作り、前項の操作をもう一度やってみても構いません。</p>
<p>　コピーの手順を箇条書きにしておきます。</p>
<p><br /></p>
<div>
<p>●　エクスプローラーを起動する</p>
</div>
<div>
<p>●　［ドキュメント］-［Visual Studio 2015］-［Projects］の順にフォルダーを開き、その下の［ShowDB］フォルダーを選択する</p>
</div>
<div>
<p>●　<img src="images/00083.jpeg" alt="" />+<img src="images/00304.jpeg" alt="" />キーを押してコピーを実行する</p>
</div>
<div>
<p>●　<img src="images/00083.jpeg" alt="" />+<img src="images/00184.jpeg" alt="" />キーを押して貼り付けを実行する</p>
</div>
<p><br /></p>
<p>　コピーされたフォルダーは［ShowDB - コピー］という名前になっています。<img src="images/00050.jpeg" alt="" />キーを押してフォルダー名を「ShowDBCard」に変えておきましょう。</p>
<p>　あとは、［ShowDBCard］フォルダーを開き、［ShowDB.sln］ファイルをダブルクリックすれば、Visual Studioが起動し、プロジェクトが読み込まれます。拡張子を表示しない設定になっている場合は、ファイル名が［ShowDB］としか表示されていませんが、Visual Studioのアイコンが表示されているので、それと分かるはずです。</p>
<p>　Visual Studioが起動したら、［ソリューションエクスプローラー］の［Form<span>1</span>.vb］をダブルリックして、フォームデザイナーを表示しておきましょう。</p>
<p>　では、始めましょう。まずは、すでに配置されているDataGridViewコントロールを削除してください。次に、［データソース］ウィンドウで、データを表示する方法として［詳細］を選び、テーブルのアイコンをフォーム上にドラッグします（画面<span>10</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00032.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　テーブル名の右の［∨］をクリックする</p>
</div>
<div>
<p>❷　［詳細］をクリックする</p>
</div>
<div>
<p>❸　テーブル名の前に表示されているアイコンをドラッグする</p>
</div>
<p><br /></p>
<p>　LabelコントロールとTextBoxコントロールがフォーム上に配置されます。日付に関しては、データベースでのデータ型の指定が日付／時刻型なので、自動的にDateTimePickerコントロールが配置されることに注目してください（画面<span>10</span>-<span>10</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00250.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　では、プログラムを実行してみましょう。データベースの<span>1</span>レコードが１画面に表示されるようになります。ツールバーのボタンを使えば、次のレコードや前のレコードも表示できます。また、データを修正して［保存］ボタンをクリックすれば、データベースの内容が書き換えられます。いろいろな操作を試してみてください。</p>
<p><br /></p>
<div>
<p><img src="images/00115.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div id="calibre_link-300">
<div><b>
<p><b><span><b><img src="images/00053.jpeg" alt="" /><b></b></b></span>利用されるデータベースについての注意</b></p>
</b></div>
</div>
<div>
<p>　実際にプログラムを実行してみると分かるのですが、プロジェクトに追加されたデータベースはこのままでは更新されないように見えます。例えば、データを追加しても、次にプログラムを実行すると元の内容に戻っていることがあります。プログラムが正しく動いていないのか、と心配になる人も多いのですが、これはエラーではありません。</p>
</div>
<p><br /></p>
<div>
<p>　プログラムをビルド（実行用のプログラムを作成）すると、プロジェクトに追加されたデータベースがプロジェクトのbin¥Debugフォルダーにコピーされ、コピー先のデータベースが更新されます。プログラムを修正した後、実行すると、実行用のプログラムが作成し直されるとともに、プロジェクトに追加されたデータベースがコピーされるので、データベースが更新されていないように見えるというわけです。プログラムを修正せずにもう一度実行した場合には、実行用のプログラムが作成し直されないので、データベースも前回の状態のままになっています。また、Visual Studioの画面からではなく、Debugフォルダーの下にある実行用プログラム（exeファイル）を直接実行したときにも、オリジナルのデータベースがコピーされないので、データベースが正しく更新されていることが確認できます（図<span>10</span>-<span>4</span>）。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00102.jpeg" alt="" /></p>
</div>
<p><br /></p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-279">
<div><b>
<p><b>■自動的に追加されたコードを見る</b></p>
</b></div>
</div>
<hr />
<p>　現在のところ、まだコードを書いてはいませんが、フォームをデザインした時点で以下のようなコードが自動的に追加されています。プログラムの動きを確認するために、ひととおり見ておきましょう。まず、フォームのLoadイベントハンドラーです（LIST<span>10</span>-<span>1</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>10</span>-<span>1</span>　自動的に追加されたフォームのLoadイベントハンドラー</p>
</div>
<div>
<div>
<pre lang="en"><code> Private Sub Form1_Load(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles MyBase.Load</code></pre>
<pre lang="en"><code>        'TODO: このコード行はデータを 'IdeadbDataSet.ideatable' テーブルに</code><code>⇒</code></pre>
<pre lang="en"><code>読み込みます。必要に応じて移動、または削除をしてください。</code></pre>
<pre lang="en"><code>        Me.IdeatableTableAdapter.Fill(Me.IdeadbDataSet.ideatable)</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code></code></pre></div>
</div>
<p><br /></p>
<p>　フォームを読み込んだときには、TableAdapterコントロールのFillメソッドを利用して、データセットのテーブルにデータを読み出します。データセットにデータが入れられると、BindingSourceコントロールの働きにより、DataGridViewコントロールにデータが自動的に表示されます（図<span>10</span>-<span>5</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00222.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　自動的に追加されたイベントハンドラーは、もう<span>1</span>つあります。これは、BindingNavigatorコントロールのツールバーにある［データの保存］ボタンをクリックしたときに実行されます（LIST<span>10</span>-<span>2</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>10</span>-<span>2</span>　自動的に追加された［データの保存］ボタンのClickイベントハンドラー</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub IdeatableBindingNavigatorSaveItem_Click(sender As⇒</code></pre>
<pre lang="en"><code>Object, e As EventArgs) Handles IdeatableBindingNavigatorSaveItem.⇒</code></pre>
<pre lang="en"><code>Click</code></pre>
<pre lang="en"><code>        Me.Validate()　　　●─── 入力終了時のデータチェックなどを実行する</code></pre>
<pre lang="en"><code>        Me.IdeatableBindingSource.EndEdit()　　　●───  コントロールの</code><code>データをデータ</code><code>セットに書き込む</code></pre>
<pre lang="en"><code>        Me.TableAdapterManager.UpdateAll(Me.IdeadbDataSet)　　　●─</code><code><code>─</code></code><code><code><code>─</code></code>データセットをデータベースに書き込む</code></pre>
<pre lang="en"><code>    End Sub		</code></pre></div>
</div>
<p>　Validateメソッドは、正しいデータが入力されているかを検証するために使われるValidatingイベントとValidatedイベントを発生させ、入力フォーカスを失ったコントロールでのデータチェックができるようにするメソッドです。それぞれのコントロールでValidatingイベントハンドラーとValidatedイベントハンドラーが実行されるので、そこにデータチェックのためのコードを書いておけば、保存される前に間違ったデータを排除できるというわけです。ただし、このプログラムでは特に何もしていません。</p>
<p>　次のBindingSourceコントロールのEndEditメソッドはコントロール上での変更をデータセットに書き込むためのメソッドです。最後のUpdateAllメソッドはデータセットへの変更をデータベースに書き込むためのメソッドです。これらをまとめると図<span>10</span>-<span>6</span>のような動作になります。</p>
<p><br /></p>
<div>
<p><img src="images/00099.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-280">
<div><b>
<p><b>■検索機能を追加する</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />ShowDB<span>2</span></p>
</div>
<hr />
<p>　以上で、コードをまったく書かなくても、データベースのほとんどの操作ができることが分かったと思います。しかし、それだけではできないことがあるのも確かです。この章の最終的な目標はキーワードを使ってデータを検索できることでした。しかし、ここまでの機能だけでは、キーワード検索はできません。そこで、少しだけコードを書いてキーワード検索（レコードの抽出）の機能を追加し、プログラムを充実させましょう。最初のShowDBプロジェクトに戻って続きを進めます。</p>
<p>　まず、キーワードを入力するためのTextBoxコントロールと、検索状態を解除するためのButtonコントロールをBindingNavigatorコントロールのツールバーに追加しておきます（画面<span>10</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00151.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［▼］をクリックする</p>
</div>
<div>
<p>❷　［TextBox］をクリックする</p>
</div>
<div>
<p>③　ツールバーにTextBoxコントロールが追加される　同様にしてButtonも追加する</p>
</div>
<p><br /></p>
<p>　TextBoxコントロールの名前はtxtSearchとしておき、Buttonコントロールの名前はbtnResetとしておきます。Buttonコントロールに好きなアイコンを表示したい場合は、プロパティウィンドウのImageの欄をクリックし、右端の［...］をクリックします。画面<span>10</span>-<span>13</span>のようなダイアログボックスが表示されるので、［インポート］をクリックし、画像ファイルの名前を指定します。</p>
<p><br /></p>
<div>
<p><img src="images/00328.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［インポート（M）...］ボタンをクリックする</p>
</div>
<div>
<p>❷　ファイルを選択するためのダイアログボックスが表示されるので、画像ファイルを選択する</p>
</div>
<p><br /></p>
<p>　イベントハンドラーは<span>2</span>つです。TextBoxコントロールでは<img src="images/00137.jpeg" alt="" />キーを押したときに検索を実行するようにします。したがって、KeyDownイベントハンドラーで、<img src="images/00137.jpeg" alt="" />キーが押されたかどうかを調べ、検索を実行します（LIST<span>10</span>-<span>3</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>10</span>-<span>3</span>　入力されたキーワードを含む行を抽出する</p>
</div>
<div>
<div>
<pre lang="en"><code> Private Sub Search(sender As Object, e As KeyEventArgs)</code></pre>
<pre lang="en"><code>Handles txtSearch.KeyDown</code></pre>
<pre lang="en"><code>        If e.KeyCode = Keys.Enter Then</code></pre>
<pre lang="en"><code>            If txtSearch.Text = "" Then Exit Sub</code></pre>
<pre lang="en"><code>            Me.IdeatableBindingSource.Filter = 　　 検索フィルターを設定する</code></pre>
<pre lang="en"><code>                "キーワード LIKE '" &amp;  txtSearch.Text &amp;  "'"</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　コードを見ると、BindingSourceコントロールのFilterプロパティに、抽出のために使う式を代入するだけだというのが分かります。Filterプロパティには「フィールド名 演算子 値」のような形式で条件（<span><b>フィルター</b></span>）を指定します。ここでは、LIKE演算子を使って「キーワード」というフィールドが、txtSearchコントロールのTextプロパティに指定したパターンに一致している場合、という条件を指定しています。</p>
<p>　よく使う演算子には表<span>10</span>-<span>2</span>のようなものがあります。</p>
<p><br /></p>
<div>
<p><img src="images/00069.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　LIKE演算子に指定するパターンには単なる文字列のほか、<span><b>ワイルドカード</b></span>を使えます。ワイルドカードとは、一致する文字列のパターンを表す特殊な文字で、任意の文字列という意味の「*」や「%」が使えます。ただし、ワイルドカードを文字列の途中に含めることはできません。例えば「書*」のように書くことはできますが、「書*籍」のような書き方はできません（EvaluateExceptionという例外が発生します）。</p>
<p>　Filterプロパティに代入される値の指定が複雑な形になっているので、念のため、図<span>10</span>-<span>7</span>で確認しておきましょう。</p>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00207.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　LIST<span>10</span>-<span>3</span>のコードが実行されると、条件にあった行だけが抽出され、自動的にDataGridViewコントロールの表示が更新されます（図<span>10</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00169.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　もう<span>1</span>つのイベントハンドラーは、btnResetのClickイベントハンドラーです。ここでは、RemoveFilterメソッドを使ってフィルターの設定を解除します。これは簡単ですね（LIST<span>10</span>-<span>4</span>)。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>10</span>-<span>4</span>　レコードを抽出するためのフィルターを解除する</p>
</div>
<div>
<div>
<pre lang="en"><code>Private Sub ResetSearch(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles btnReset.Click</code></pre>
<pre lang="en"><code>        Me.IdeatableBindingSource.RemoveFilter()　　　●─── 検索フィルターを解除する</code></pre>
<pre lang="en"><code>        txtSearch.Text = ""</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　フィルターが解除されると、またすべてのレコードが表示されるようになります。ただし、RemoveFilterメソッドだけだと、IDの値が-<span>1</span>の空白の行が表示されることがあります。そのような場合には、RemoveFilterメソッドを使う代わりに、</p>
<div>
<pre lang="en"><code> Me.IdeatableBindingSource.Filter = ""</code></pre></div>
<p>のようにFilterプロパティに空文字列を設定するとよいでしょう。コードが入力できたら、プログラムを実行し、検索の操作を試してみてください。</p>
<p>　以上でデータベースの基本的な利用ができるようになりました。次の節では、これまでのプログラムと同等の機能を持つプログラムを、コードを使って書いてみます。それにより、自由にデータベースを取り扱える知識を身に付けましょう。</p>
</div>
</div>
<div id="calibre_link-25">
<div>
<div id="calibre_link-281">
<div><b>
<p><b>　<span><b>10</b></span>.<span><b>2</b></span>　コードを使ってデータベースを操作する</b></p>
</b></div>
</div>
<p><br /></p>
<p>　ここではプログラムのユーザーインターフェイスを自由に作成するとともに、コードを記述してデータセットとのやりとりをきめ細かく処理します。これまでは、BindingNavigatorコントロールやBindingSourceコントロールを使って、ユーザーインターフェイスとデータセットのやりとりをほぼ自動的に処理していましたが、その処理をコードで記述しようというわけです。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-282">
<div><b>
<p><b>■ここで使うコントロール</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />IdeaMaker</p>
</div>
<hr />
<p>　このプログラムでは、データセットを表すDataSetコントロールと、データセットとデータベースのやりとりをするTableAdapterコントロールだけを使います。データセットからレコードを読み出したり、データセットのレコードを修正したりする処理は、自分で書いたコードによって実行されるようにします。したがって、BindingNavigatorコントロールやBindingSourceコントロールは使いません。また、データベースの更新順序の変更なども不要なので、TableAdapterManagerコントロールは使いません（図<span>10</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00035.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　処理の流れを見る前に、フォームのデザインを片付けておきましょう。IdeaMakerという名前のWindowsフォームアプリケーションプロジェクトを作成し、ideadb.mdbファイルをソリューションエクスプローラーのプロジェクト名の位置にドラッグしてデータベースを追加し、接続の設定をしておいてください。ここまでの手順は前節と同じです。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-283">
<div><b>
<p><b>■フォームをデザインする</b></p>
</b></div>
</div>
<hr />
<p>　前節では、データセットのテーブルをもとにフォームをデザインしました。このプログラムではフォームのデザインが自由に作成できるようにします。完成時のイメージはイラスト<span>10</span>-<span>2</span>のような感じです。</p>
<p><br /></p>
<div>
<p><img src="images/00273.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　フォームを自由にデザインするといっても、一からデザインしていくよりは、テーブルの内容をもとに自動的にコントロールを配置し、そこから修正を加えていくほうが簡単です。そこで、前節と同じ方法で［データソース］ウィンドウを表示し、［ideatable］をドラッグしてDataGridViewコントロールをフォーム上に配置してください。以下の<span>5</span>つのコントロールが画面の下に表示されます。</p>
<p><br /></p>
<div>
<p>■DateSetコントロール（IdeadbDataSet）</p>
</div>
<div>
<p>■BindingSourceコントロール（IdeatableBindingSource）</p>
</div>
<div>
<p>■TableAdapterコントロール（IdeatableTableAdapter）</p>
</div>
<div>
<p>■TableAdapterManagerコントロール（TableAdapterManager）</p>
</div>
<div>
<p>■BindingNavigatorコントロール（IdeatableBindingNavigator）</p>
</div>
<p><br /></p>
<p>　このうち、BindingSourceコントロール、TableAdapterManagerコントロール、BindingNavigatorコントロールは使わないので、削除しておきます。画面の下に表示されているそれぞれのコントロールをクリックし、<img src="images/00262.jpeg" alt="" />キーを押して削除しておいてください。</p>
<p>　ここで<span>1</span>つ重要な注意点です。BindingSourceコントロールを削除したので、DataGridViewコントロールとデータセットを結びつけるものは何もなくなりました。したがって、このままではDataGridViewコントロールには何も表示されません。それまで表示されていた見出しも表示されなくなったはずです。見出しの表示もデータの表示もプロパティやコードを指定して、すべて自前で処理する必要があります。</p>
<p>　そこで、DataGridViewコントロールの右上に表示されている［▶］ボタンをクリックし、［列の追加...］というリンクをクリックしてください。画面<span>10</span>-<span>14</span>のダイアログボックスが表示され、列が追加できるようになります。［追加（A）］ボタンを<span>4</span>回クリックし、列を<span>4</span>つ追加しておきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00288.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　続いて、もう一度［▶］ボタンをクリックし、［列の編集...］というリンクをクリックします。各列のプロパティが設定できるようになるので、表<span>10</span>-<span>3</span>に従って設定を変更しておいてください。</p>
<p><br /></p>
<div>
<p><img src="images/00015.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　最後に、データベースを操作するためのボタンなどを配置して、メインフォームのデザインを仕上げましょう（画面<span>10</span>-<span>15</span>・表<span>10</span>-<span>4</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00248.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　DataGridView、DataSet、TableAdapterの各コントロールについては、設定値を変更する必要はありませんが、参考のために掲載しておきます。</p>
<p><br /></p>
<div>
<p><img src="images/00111.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00121.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　なお、BindingNavigatorコントロールを削除したので、コードウィンドウに入力されていた以下のコードは削除しておいてください。</p>
<div>
<pre lang="en"><code>Private Sub IdeatableBindingNavigatorSaveItem_Click(⇒</code></pre>
<pre lang="en"><code>sender As Object, e As EventArgs) Handles⇒</code></pre>
<pre lang="en"><code>IdeatableBindingNavigatorSaveItem.Click</code></pre>
<pre lang="en"><code>        Me.Validate()</code></pre>
<pre lang="en"><code>        Me.IdeatableBindingSource.EndEdit()</code></pre>
<pre lang="en"><code>        Me.TableAdapterManager.UpdateAll(Me.IdeadbDataSet)</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
<p>　ただし、フォームのLoadイベントハンドラーは削除しないでください。フォームが読み込まれたときにデータベースの内容をデータセットに読み込むために必要です。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-284">
<div><b>
<p><b>■ダイアログボックスをデザインする</b></p>
</b></div>
</div>
<hr />
<p>　続いて、新規レコードの追加や修正に使うダイアログボックスのデザインです。メニューから［プロジェクト（P）］−［Windowsフォームの追加（F）...］を選択すると、画面<span>10</span>-<span>16</span>のような画面が表示されるので、ダイアログボックスとして使う新しいフォームが追加できます。［ダイアログ］は一覧の最後の方にあるので、スクロールバーを下の方にドラッグすれば表示できます。</p>
<p><br /></p>
<div>
<p><img src="images/00218.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p>❶　［テンプレート］の一覧から［ダイアログ］を選択する</p>
</div>
<div>
<p>❷　ファイル名を指定する。ここではDialog<span>1</span>.vbのままとする</p>
</div>
<div>
<p>❸　［追加（A）］ボタンをクリックする</p>
</div>
<p><br /></p>
<p>　フォームが表示されたら、画面<span>10</span>-<span>17</span>のようにLabelコントロールやTextBoxコントロールを追加し、表<span>10</span>-<span>5</span>のようにプロパティを設定しておきましょう。TextBoxコントロールのMultiLineプロパティをTrueにすると、コントロールの高さが変更できるようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00094.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<p><img src="images/00314.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　［OK］ボタンと［キャンセル］ボタンは、あらかじめ配置されているので、表には記していません。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-285">
<div><b>
<p><b>■レコードを検索するためのコードを書く</b></p>
</b></div>
</div>
<hr />
<p>　ここから、さまざまな機能を実行するためのコードを書いていきます。まず、検索機能から始めましょう。検索は［キーワード（K）:］ボックスで<img src="images/00137.jpeg" alt="" />キーを押したときに実行します。したがって、txtKeywordコントロールのKeyDownイベントハンドラーにコードを書き、<img src="images/00137.jpeg" alt="" />キーが押されたときだけ実行されるようにします。実行すべき内容は以下の<span>2</span>つです。</p>
<p><br /></p>
<div>
<p><span><b>■　ステップ<span><b>1</b></span>　キーワードに一致するレコードを抽出する</b></span></p>
</div>
<div>
<p>　抽出したレコード（複数）を参照する変数を用意する</p>
</div>
<div>
<p>　レコードを抽出し、変数で参照できるようにする</p>
</div>
<div>
<p><br /></p>
</div>
<div>
<p><span><b>■　ステップ<span><b>2</b></span>　抽出されたレコードを表示する</b></span></p>
</div>
<div>
<p>　DataGridViewコントロールの内容をクリアする</p>
</div>
<div>
<p>　DataGridViewコントロールの行を追加し、抽出されたレコードを<span>1</span>行ずつ入れる</p>
</div>
<p><br /></p>
<p>　Form<span>1</span>フォームを表示して、txtKeywordコントロールのKeyDownイベントハンドラーを追加しましょう。イベントハンドラー名はSearchDataとし、LIST<span>10</span>-<span>5</span>のようなコードを入力します。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>　</span><span>10</span>-<span>5</span>　データセットのテーブルから検索されたレコードを表示する</p>
</div>
<div>
<div>
<pre lang="en"><code>Private Sub SearchData(sender As Object, e As KeyEventArgs)⇒</code></pre>
<pre lang="en"><code>Handles txtKeyword.KeyDown</code></pre>
<pre lang="en"><code>        If e.KeyCode &lt;&gt; Keys.Enter Then Exit Sub ' Enterキーのときだけ実行</code></pre>
<pre lang="en"><code>        If txtKeyword.Text = "" Then Exit Sub</code></pre>
<div>
<pre lang="en"><code>        Dim SelRows As DataRow()　　　●───ステップ1</code><code>　キーワードに一致するレコードを抽出する→<a href="#calibre_link-26"><u>P.384</u></a></code>
</pre>
<pre lang="en"><code>        SelRows = IdeadbDataSet.ideatable.Select(</code></pre>
<pre lang="en"><code>            "キーワード LIKE '" &amp; txtKeyword.Text &amp; "'")</code></pre></div>
<pre lang="en"><code></code></pre>
<div>
<pre lang="en"><code>        IdeatableDataGridView.Rows.Clear()　　　●───ステップ2　</code><code>抽出されたレコードを表示する→<a href="#calibre_link-27"><u>P.385</u></a></code>
</pre>
<pre lang="en"><code>        For Each aRow As DataRow In SelRows</code></pre>
<pre lang="en"><code>            IdeatableDataGridView.Rows.Add(</code></pre>
<pre lang="en"><code>                CType(aRow, ideadbDataSet.ideatableRow).ID,</code></pre>
<pre lang="en"><code>                CType(aRow, ideadbDataSet.ideatableRow).日付.⇒</code></pre>
<pre lang="en"><code>ToString("yyyy/MM/dd"),</code></pre>
<pre lang="en"><code>                CType(aRow, ideadbDataSet.ideatableRow).キーワード,</code></pre>
<pre lang="en"><code>                CType(aRow, ideadbDataSet.ideatableRow).アイディア)</code></pre>
<pre lang="en"><code>        Next</code></pre></div>
<pre lang="en"><code></code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　はじめて見るメソッドや関数がたくさんあるので、少しずつコードを見ていきしょう。まずは、キーワードに一致するレコードを抽出する処理からです。</p>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>1</b></span>　キーワードに一致するレコードを抽出する</b></p>
</b></div>
<p id="calibre_link-26">　データセット（IdeadbDataSet）にはすでにテーブルの内容が読み込まれているので、Selectメソッドを使ってキーワードに一致するレコードを抽出します。</p>
<p>　そのためには抽出されたレコードを参照するための変数が必要になります。そこでDataRowクラスのオブジェクトの配列を参照するための変数SelRowsを宣言します。DataRowクラスのオブジェクトは、データベースのレコードを格納するために使われます。</p>
<div>
<pre lang="en"><code>Dim SelRows As DataRow()</code></pre></div>
<p>　これでSelRowsという変数が利用できるようになりました。抽出されるレコードは<span>1</span>つとは限らないので（複数のレコードが抽出されるはずなので）、SelRowsが参照するのは<span>1</span>つのDataRowオブジェクトではなく、DataRowオブジェクトの配列であることに注意してください。イメージとしては図<span>10</span>-<span>10</span>のような感じです。</p>
<p><br /></p>
<div>
<p><img src="images/00195.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　データセットのテーブルのSelectメソッドを利用すれば、条件に合ったレコードを抽出できます。その参照をSelRowsに代入しておきます。Selectメソッドの引数には、BindingSourceコントロールのFilterプロパティで指定したのと同じ形式で条件を書きます。</p>
<div>
<pre lang="en"><code>　　SelRows = IdeadbDataSet.ideatable.Select("キーワード LIKE '"⇒</code></pre>
<pre lang="en"><code>&amp; txtKeyword.Text &amp; "'")</code></pre></div>
<p><br /></p>
<p>　例えば、キーワードとして「書籍」という文字列が入力されていれば、図<span>10</span>-<span>11</span>のようなレコードをSelRowsで参照できるようになります。</p>
<p><br /></p>
<div>
<p><img src="images/00064.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>2</b></span>　抽出されたレコードを表示する</b></p>
</b></div>
<p id="calibre_link-27">　続いて、DataGridViewコントロールに行を追加し、SelRowsで参照されるレコードを順に表示します。For Each ... Next ステートメントを使ってSelRowsのレコードをすべて処理するだけです。</p>
<p>　DataGridViewコントロールに行を追加するにはRows.Addメソッドを使います。Addメソッドでは単に行を追加するだけでなく、列の内容も入れておくことができます。列の内容は左から順にAddメソッドの引数に指定します。この例ではレコードの各フィールドを順に列の内容として指定すればいいでしょう。コードは複雑に見えますが、処理の流れは簡単な繰り返し処理です。まず、骨格だけを示しておきましょう（LIST<span>10</span>-<span>6</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 10</span>-<span>6</span>　DataGridViewコントロールに行を追加するコードの骨格</p>
</div>
<div>
<div>
<pre lang="en"><code>For Each aRow As DataRow In SelRows</code></pre>
<pre lang="en"><code>    ideatableDataGridView.Rows.Add(ID, 日付, キーワード, アイディア)</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<p><br /></p>
<p>　IDや日付はSelRowsの各行（aRow）に含まれるフィールドなので、aRow.IDやaRow.日付と書きたいところなのですが、aRowはDataRow型なので、IDプロパティや日付プロパティがありません。一方、ideadbDataSet.ideatableRow型であれば、IDプロパティや日付プロパティが使えます。そこで、CType関数を使ってaRowをideadbDataSet.ideatableRow型に変換し、そのIDプロパティを指定します。</p>
<p>　したがって、IDというフィールドを指定するために</p>
<div>
<pre lang="en"><code>aRow.ID</code></pre></div>
<p>ではなく、</p>
<div>
<pre lang="en"><code>CType(aRow, ideadbDataSet.ideatableRow).ID</code></pre></div>
<p>のように書くわけです。</p>
<p>　CType関数には、変数と変換後のデータ型を指定します。もちろん、どんなデータ型でも自由に変換できるわけではなく、互換性のあるデータ型だけにしか変換できません。DataRow型は一般的なデータセットのレコードを表し、ideadbDataSet.ideatableRow型は、ideadbDataSetというデータセットのideatableRowという特定の型のレコードを表します。いずれもテーブルのレコードを表しているので、変換ができるというわけです。</p>
<p>　日付やキーワード、アイディアについても同様にデータ型を変換し、Addメソッドの引数に指定すればコードの完成です。</p>
<p>　なお、For Each ... Nextステートメントで変数aRowのデータ型をideadbDataSet.ideatableRow型として指定すれば、このような変換は必要ありません。その場合は次のように簡単に書くことができます（LIST<span>10</span>-<span>7</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>10</span>-<span>7</span>　変数aRowのデータ型をideadbDataSet.ideatableRow型とする</p>
</div>
<div>
<div>
<pre lang="en"><code>For Each aRow As ideadbDataSet.ideatableRow In SelRows</code></pre>
<pre lang="en"><code>    IdeatableDataGridView.Rows.Add(</code></pre>
<pre lang="en"><code>        aRow.ID,</code></pre>
<pre lang="en"><code>        aRow.日付.ToString("yyyy/MM/dd"),</code></pre>
<pre lang="en"><code>        aRow.キーワード,</code></pre>
<pre lang="en"><code>        aRow.アイディア)</code></pre>
<pre lang="en"><code>Next</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-286">
<div><b>
<p><b>■レコードを追加するためのコードを書く</b></p>
</b></div>
</div>
<hr />
<p>　レコードを追加するには、ダイアログボックスを表示する必要があります。そして、そこで入力されたキーワードとアイディアを、レコードとしてデータベースに追加します。IDは自動的に設定するものとし、日付にはそのときの日付を代入しておきます。この処理も<span>2</span>つのステップに分けて見ていきましょう。</p>
<p><br /></p>
<div>
<p><span><b>■　ステップ<span><b>1</b></span>　ダイアログボックスに入力された内容をもとにレコードを作成する</b></span></p>
</div>
<div>
<p>　レコードを作成する</p>
</div>
<div>
<p>　日付フィールドに日付を入れる</p>
</div>
<div>
<p>　キーワードフィールドに、ダイアログボックスに入力されたキーワードを入れる</p>
</div>
<div>
<p>　アイディアフィールドに、ダイアログボックスに入力されたアイディアを入れる</p>
</div>
<div>
<p><br /></p>
</div>
<div>
<p>■　<span><b>ステップ<span><b>2</b></span>　データベースにレコードを追加する</b></span></p>
</div>
<div>
<p>　データセットのテーブルにレコードを追加する</p>
</div>
<div>
<p>　データベースを更新する</p>
</div>
<p><br /></p>
<p>　コードは［新規（N）］ボタンのClickイベントハンドラーに書きます。イベントハンドラー名はAddDataとします。全体像を見ておきましょう（LIST<span>10</span>-<span>8</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>　</span><span>10</span>-<span>8</span>　新しいレコードをデータベースに追加する</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub AddData(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles btnNew.Click</code></pre>
<pre lang="en"><code>        dlgRecord.Text = "レコードの追加"</code></pre>
<pre lang="en"><code>        dlgRecord.txtKeyword.Text = ""</code></pre>
<pre lang="en"><code>        dlgRecord.txtIdea.Text = ""</code></pre>
<div>
<pre lang="en"><code>        If dlgRecord.ShowDialog() &lt;&gt; DialogResult.OK Then⇒</code></pre>
<pre lang="en"><code>Exit Sub</code></pre>
<pre lang="en"><code>        ' レコードを新規作成する　　　●───ステップ1　</code><code>ダイアログボックスに入力された内容をもとにレコードを作成する→<a href="#calibre_link-28"><u>P.387</u></a></code>
</pre>
<pre lang="en"><code>        Dim aRow As DataRow</code></pre>
<pre lang="en"><code>        aRow = IdeadbDataSet.ideatable.NewRow()</code></pre>
<pre lang="en"><code>        ' フィールドに内容を入れる</code></pre>
<pre lang="en"><code>        aRow.Item("日付") = Today</code></pre>
<pre lang="en"><code>        aRow.Item("キーワード") = dlgRecord.txtKeyword.Text</code></pre>
<pre lang="en"><code>        aRow.Item("アイディア") = dlgRecord.txtIdea.Text</code></pre></div>
<pre lang="en"><code></code></pre>
<div>
<pre lang="en"><code>        IdeadbDataSet.ideatable.Rows.Add(aRow)　　　●───ステップ2</code><code>　データセットのテーブルに</code><code>レコードを追加する→<a href="#calibre_link-29"><u>P.389</u></a></code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        ' データベースを更新し、再度読み込む</code></pre>
<pre lang="en"><code>        IdeatableTableAdapter.Update(IdeadbDataSet.ideatable)</code></pre>
<pre lang="en"><code>        IdeatableTableAdapter.Fill(IdeadbDataSet.ideatable)</code></pre>
<pre lang="en"><code></code></pre></div>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>1</b></span>　ダイアログボックスに入力された内容をもとにレコードを作成する</b></p>
</b></div>
<p id="calibre_link-28">　このコードについても少しずつ見ていきましょう。最初にレコードを追加するためのダイアログボックスを表示します。ダイアログボックスとして表示したいフォームのShowDialogメソッドを呼び出します（LIST<span>10</span>-<span>9</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 10</span>-<span>9</span>　フォームをダイアログボックスとして表示する</p>
</div>
<div>
<div>
<pre lang="en"><code>dlgRecord.Text = "レコードの追加"　　　　　　　●─── ダイアログボックスのタイトル</code></pre>
<pre lang="en"><code>    dlgRecord.txtKeyword.Text = ""　　　●─── キーワードをクリアしておく</code></pre>
<pre lang="en"><code>    dlgRecord.txtIdea.Text = ""　　　　　 ●─── アイディアをクリアしておく</code></pre>
<pre lang="en"><code>    If dlgRecord.ShowDialog() &lt;&gt; DialogResult.OK Then Exit Sub</code></pre>
<pre lang="en"><code>			　　　 　●─── ダイアログボックスを表示する。［OK］がクリックされなかった場合は、何もせずプロシージャを抜ける</code></pre>
<pre lang="en"><code>        ：</code></pre></div>
</div>
<p><br /></p>
<p>　最初の<span>3</span>行はダイアログボックスの準備です。タイトルを設定したり、表示をクリアしているだけです。</p>
<p>　ダイアログボックスのフォーム名はdlgRecordなので、dlgRecord.ShowDialog()というメソッドを使って、このフォームをダイアログボックスとして表示します。</p>
<p>　フォームを新規作成するときに「ダイアログ」を選択した場合には、［OK］ボタンと［キャンセル］ボタンがあらかじめ追加されていたことを思い出してください。実は、そのときにボタンだけでなく簡単なコードも追加されており、いずれのボタンをクリックしたかが、このShowDialogメソッドの戻り値として返されるようになっています。［OK］をクリックしたときの戻り値はDialogResult.OKという値で、［キャンセル］をクリックしたときの戻り値はDialogResult.Cancelという値です。そこで、Ifステートメントにより、ShowDialogメソッドの戻り値を調べ、［OK］ボタンがクリックされたときだけ、レコードを追加するようにしています。［キャンセル］ボタンをクリックしたときには、何もせずプロシージャを抜けます。</p>
<p>　続きを見てみましょう。ダイアログボックスで［OK］がクリックされたときには、IdeadbDataSet.ideatableで使われているものと同じ形式の行を作成し、それをaRowという変数で参照できるようにします。まず、テーブルのNewRowメソッドを利用して、新しい行を作成します（LIST<span>10</span>-<span>10</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 10</span>-<span>10</span>　テーブルの行と同じ形式の行を作成する</p>
</div>
<div>
<div>
<pre lang="en"><code>Dim aRow As DataRow</code></pre>
<pre lang="en"><code>aRow = IdeadbDataSet.ideatable.NewRow()</code></pre></div>
</div>
<p><br /></p>
<p>　念のため、図でこのイメージを示しておきましょう（図<span>10</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00289.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　次に、作成した行の各フィールドにデータを入れます。各フィールドはフィールド名をキーとして指定できるので、</p>
<div>
<pre lang="en"><code>aRow.Item("フィールド名") = 値</code></pre></div>
<p>の形式でコードを書けばデータが入れられます。図<span>10</span>-<span>13</span>は日付、キーワード、アイディアにデータを入れた様子です。</p>
<p><br /></p>
<div>
<p><img src="images/00297.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　このデータベースでは、IDはテーブルの主キーとなっており、自動的に付番されるようになっているので、プログラムでは特に値を指定しません。値を指定しないと、すでに設定されている値と重複しないように、データセット上では-<span>1</span>から<span>1</span>ずつ引いた負の値が設定されます（続くUpdateメソッドを使ってデータベースを更新すると、データベースの中で自動的に付番し直されます）。これでレコードの準備ができました。</p>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>2</b></span>　データベースにレコードを追加する</b></p>
</b></div>
<p id="calibre_link-29">　各フィールドにデータを入れ、レコードの準備ができたら、Addメソッドを使ってそのレコードをデータセットに追加します。実際にデータベースに書き込む処理は、TableAdapterの助けを借りましょう。TableAdapterコントロールのUpdateメソッドの引数に、更新内容を書き込むテーブルを指定します。また、Fillメソッドを使って、更新されたデータをもう一度データセットに読み込んでおきます（LIST<span>10</span>-<span>11</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>10</span>-<span>11</span>　行をテーブルに追加し、データベースを更新する</p>
</div>
<div>
<div>
<pre lang="en"><code>IdeadbDataSet.ideatable.Rows.Add(aRow)　　　●─── 行をテーブルに追加する</code></pre>
<pre lang="en"><code>IdeatableTableAdapter.Update(IdeadbDataSet.ideatable)　　　●─── データベースに更新内容を書き込む</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>IdeatableTableAdapter.Fill(IdeadbDataSet.ideatable)　　　●─── データベースからもう一度テーブルを読み出しておく</code></pre></div>
</div>
<p><br /></p>
<p>　ここでFillメソッドを書いていないと、IDには-<span>1</span>、-<span>2</span>......といった負の値が表示されます。付番し直されたIDを表示するために、Fillメソッドを使ってデータベースからテーブルの内容をもう一度読み出しているというわけです。ただし、実際に表示されるのはキーワード検索をしてレコードを表示し直したときになります。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-287">
<div><b>
<p><b>■レコードを修正するためのコードを書く</b></p>
</b></div>
</div>
<hr />
<p>　修正のためのコードは、追加のためのコードと似ています。すでにあるレコードを更新するのでNewRowメソッドは使わず、現在の内容をダイアログボックスに表示しておきます。ダイアログボックスで［OK］ボタンがクリックされれば、そのとき表示されているデータを書き込みます。ステップは以下のようになるでしょう。</p>
<p><br /></p>
<div>
<p><span><b>■　ステップ<span><b>1</b></span>　現在のレコードの内容をダイアログボックスに表示する</b></span></p>
</div>
<div>
<p>　　グリッドの現在行の<span>2</span>列目のセルをダイアログボックスのキーワードに入れる</p>
</div>
<div>
<p>　　グリッドの現在行の<span>3</span>列目のセルをダイアログボックスのアイディアに入れる</p>
</div>
<p><br /></p>
<div>
<p><span><b>■　ステップ<span><b>2</b></span>　入力された内容をもとにレコードを修正する</b></span></p>
</div>
<div>
<p>　　IDをもとに、現在のレコードを選択する</p>
</div>
<div>
<p>　　日付フィールドに今日の日付を入れる</p>
</div>
<div>
<p>　　キーワードフィールドに、ダイアログボックスに入力されたキーワードを入れる</p>
</div>
<div>
<p>　　アイディアフィールドに、ダイアログボックスに入力されたアイディアを入れる</p>
</div>
<p><br /></p>
<div>
<p><span><b>■　ステップ<span><b>3</b></span>　データベースを更新する</b></span></p>
</div>
<div>
<p>　　データベースを更新する</p>
</div>
<div>
<p>　　表示内容を更新する</p>
</div>
<p><br /></p>
<p>　これらのステップと対比させながら、コード全体を眺めておきましょう。［修正］ボタンのClickイベントハンドラーはChangeDataという名前にします（LIST<span>10</span>-<span>12</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 10</span>-<span>12</span>　選択されている行を修正し、データベースを更新する</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ChangeData(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles btnChange.Click</code></pre>
<pre lang="en"><code>        ' 行が選択されてない場合は何もしない</code></pre>
<pre lang="en"><code>        If IdeatableDataGridView.CurrentRow Is Nothing Then Exit Sub</code></pre>
<pre lang="en"><code>        With IdeatableDataGridView.CurrentRow</code></pre>
<div>
<pre lang="en"><code>            dlgRecord.Text = "レコードの修正"　　　●───ステップ1　</code><code>現在のレコードの内容をダイアログボックスに表示する→<a href="#calibre_link-30"><u>P.391</u></a></code>
</pre>
<pre lang="en"><code>            dlgRecord.txtKeyword.Text = .Cells(2).Value.ToString()</code></pre>
<pre lang="en"><code>            dlgRecord.txtIdea.Text = .Cells(3).Value.ToString()</code></pre>
<pre lang="en"><code></code></pre></div>
<pre lang="en"><code></code></pre>
<div>
<pre lang="en"><code>            If (dlgRecord.ShowDialog() &lt;&gt; DialogResult.OK)⇒</code></pre>
<pre lang="en"><code>Then Exit Sub	</code></pre>
<pre lang="en"><code>            Dim SelRows As DataRow()　　　●───ステップ2</code><code>　入力された内容をもとに</code><code>レコードを修正する→<a href="#calibre_link-31"><u>P.391</u></a></code></pre>
<pre lang="en"><code>            SelRows = IdeadbDataSet.ideatable.Select(</code></pre>
<pre lang="en"><code>                "ID='" &amp; .Cells(0).Value.ToString() &amp; "'")</code></pre>
<pre lang="en"><code>            SelRows(0).Item("日付") = Today</code></pre>
<pre lang="en"><code>            SelRows(0).Item("キーワード") = dlgRecord.txtKeyword.Text</code></pre>
<pre lang="en"><code>            SelRows(0).Item("アイディア") = dlgRecord.txtIdea.Text</code></pre></div>
<pre lang="en"><code></code></pre>
<div>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>            IdeatableTableAdapter.Update(IdeadbDataSet.ideatable)</code></pre>
<pre lang="en"><code>            ' 表示の更新	</code></pre>
<pre lang="en"><code>            .Cells(1).Value = Today.ToString("yyyy/MM/dd")</code></pre>
<pre lang="en"><code>            .Cells(2).Value = dlgRecord.txtKeyword.Text</code></pre>
<pre lang="en"><code>            .Cells(3).Value = dlgRecord.txtIdea.Text　　　●───ステップ3</code><code>　データベースを更新する→<a href="#calibre_link-32"><u>P.392</u></a></code>
</pre>
<pre lang="en"><code></code></pre></div>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>        End With</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　レコードを修正するには、DataGridViewコントロールのいずれかの行を選択しておく必要があります。もし、行が選択されていなければ、何もせずプロシージャを抜けます。</p>
<div>
<pre lang="en"><code>If IdeatableDataGridView.CurrentRow Is Nothing Then Exit Sub</code></pre></div>
<p>　DataGridViewコントロールのCurrentRowプロパティは、アクティブなセルがある行を返します。</p>
<p>　各ステップに入る前に、全体がWith ... End Withで囲まれていることに注目してください。名前の長いオブジェクトを何度も使う場合には、このような書き方によって、オブジェクトの名前が省略できます（図<span>10</span>-<span>14</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00030.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>1</b></span>　現在のレコードの内容をダイアログボックスに表示する</b></p>
</b></div>
<p id="calibre_link-30">　ダイアログボックスを表示する前に、DataGridViewコントロールの現在行の<span>2</span>番目のセル（キーワード）と<span>3</span>番目のセル（アイディア）の内容をダイアログボックスのtxtKeywordコントロールとtxtIdeaコントロールのTextプロパティに代入しておきます。このようにすれば、ダイアログボックスが表示されたときに、修正前のデータが表示されるようになります（LIST<span>10</span>-<span>13</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 10</span>-<span>13</span>　選択された行のキーワードとアイディアをダイアログボックスに表示しておく</p>
</div>
<div>
<div>
<pre lang="en"><code>dlgRecord.txtKeyword.Text = .Cells(2).Value.ToString()</code></pre>
<pre lang="en"><code>dlgRecord.txtIdea.Text = .Cells(3).Value.ToString()</code></pre></div>
</div>
<p><br /></p>
<p>　CellsプロパティはDataGridViewコントロールのセルを表します。<span>1</span>行にセルは複数あるので、左から<span>0</span>、<span>1</span>、<span>2</span>......とインデックス（列位置）を指定して区別します。セルの内容はValueプロパティで参照できますが、データ型がObject型なので、ToStringメソッドを使って文字列に変換しています。</p>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>2</b></span>　入力された内容をもとにレコードを更新する</b></p>
</b></div>
<p id="calibre_link-31">　ダイアログボックスの表示方法はすでに述べたとおりです。［OK］ボタンがクリックされたら、ダイアログボックスに表示されている内容をもとに、レコードを書き換えます。まず、IdeadbDataSet.ideatableのSelectメソッドを使って、DataGridViewコントロールで選択された行のIDと等しいレコードを選択します（LIST<span>10</span>-<span>14</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 10</span>-<span>14</span>　IDを利用して、更新すべきレコードを選択する</p>
</div>
<div>
<div>
<pre lang="en"><code>    Dim SelRows As DataRow()</code></pre>
<pre lang="en"><code>    SelRows = IdeadbDataSet.ideatable.Select("ID='" &amp; .Cells(0).⇒</code></pre>
<pre lang="en"><code>Value.ToString() &amp; "'")</code></pre></div>
</div>
<p><br /></p>
<p>　どのようにレコードが選択されるか、図<span>10</span>-<span>15</span>で確認しておきましょう。</p>
<p><br /></p>
<div>
<p><img src="images/00100.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<p>　SelRowsは配列を参照しますが、IDには重複する値がないので、選択されるレコードは<span>1</span>つだけです。そのレコードはSelRows(<span>0</span>)と表されます。</p>
<p>　次に、そのレコードのキーワードフィールドとアイディアフィールドに、ダイアログボックスに入力されている内容を入れます。IDフィールドはそのままにしておき、日付フィールドにはその日の日付を入れます（LIST<span>10</span>-<span>15</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 10</span>-<span>15</span>　レコードの各フィールドを修正する</p>
</div>
<div>
<div>
<pre lang="en"><code>SelRows(0).Item("日付") = Today</code></pre>
<pre lang="en"><code>SelRows(0).Item("キーワード") = dlgRecord.txtKeyword.Text</code></pre>
<pre lang="en"><code>SelRows(0).Item("アイディア") = dlgRecord.txtIdea.Text</code></pre></div>
</div>
<p><br /></p>
<div><b>
<p><b>■ステップ<span><b>3</b></span>　データベースを更新する</b></p>
</b></div>
<p id="calibre_link-32">　最後にTableAdapterコントロールのUpdateメソッドを呼び出して、データベースに書き込みます。DataGridViewコントロールの表示も忘れずに修正しておきましょう（LIST<span>10</span>-<span>16</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 10</span>-<span>16</span>　データベースを更新し、修正内容をDataGridViewコントロールに表示し直す</p>
</div>
<div>
<div>
<pre lang="en"><code>IdeatableTableAdapter.Update(IdeadbDataSet.ideatable)</code></pre>
<pre lang="en"><code>.Cells(1).Value = Today.ToString("yyyy/MM/dd")</code></pre>
<pre lang="en"><code>.Cells(2).Value = dlgRecord.txtKeyword.Text</code></pre>
<pre lang="en"><code>.Cells(3).Value = dlgRecord.txtIdea.Text</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-288">
<div><b>
<p><b>■レコードを削除するためのコードを書く</b></p>
</b></div>
</div>
<hr />
<p>　レコードを削除するには、DataGridViewコントロールで選択されている行をもとに、データセットのテーブルから削除したいレコードを選択し、そのレコードのDeleteメソッドを呼び出します。イベントハンドラー名はDeleteDataとします（LIST<span>10</span>-<span>17</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 10</span>-<span>17</span>　選択されている行を削除し、データベースを更新する</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub DeleteData(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles btnDelete.Click</code></pre>
<pre lang="en"><code>        ' 削除の対象となるレコードを選択する</code></pre>
<pre lang="en"><code>        Dim SelRows() As DataRow</code></pre>
<pre lang="en"><code>        SelRows = IdeadbDataSet.ideatable.Select(</code></pre>
<pre lang="en"><code>            "ID='" &amp; IdeatableDataGridView.CurrentRow.Cells(0).⇒</code></pre>
<pre lang="en"><code>Value.ToString() &amp; "'")</code></pre>
<pre lang="en"><code>        ' 削除の確認をする</code></pre>
<pre lang="en"><code>        If MessageBox.Show("本当に削除していいですか？","削除",</code></pre>
<pre lang="en"><code>                       MessageBoxButtons.YesNo) &lt;&gt;</code></pre>
<pre lang="en"><code>                       DialogResult.Yes Then Exit Sub</code></pre>
<pre lang="en"><code>        ' 選択されたレコードを削除する</code></pre>
<pre lang="en"><code>        SelRows(0).Delete()</code></pre>
<pre lang="en"><code>        ' データベースを更新する</code></pre>
<pre lang="en"><code>        IdeatableTableAdapter.Update(IdeadbDataSet.ideatable)</code></pre>
<pre lang="en"><code>        ' DataGridViewコントロールの現在行を削除する</code></pre>
<pre lang="en"><code>        IdeatableDataGridView.Rows.Remove(IdeatableDataGridView.⇒</code></pre>
<pre lang="en"><code>CurrentRow)</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p>　このコードは簡単なので一気に見てみましょう。ここでも、削除の対象となるレコードを選択するために、DataGridViewコントロールで選択された行のIDの値を利用しています。レコードの選択にはIdeadbDataSet.ideatableのSelectメソッドを使います。考え方は図<span>10</span>-<span>15</span>とまったく同じです。</p>
<p>　レコードが選択できたら、確認のメッセージを表示した後、Deleteメソッドでその行を削除します。最後に、データセットへの変更をデータベースに書き出すためにTableAdapterコントロールのUpdateメソッドを呼び出すのを忘れないでください。また、行を削除した後、DataGridViewコントロールの現在行も削除しておく必要があります。それが最後の行です。DataGridViewコントロールのRows.Removeメソッドに削除したい行を指定しています。</p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-289">
<div><b>
<p><b>■プログラムを終了させる</b></p>
</b></div>
</div>
<hr />
<p>　最後に［終了（X）］ボタンのClickイベントハンドラーを書きます。おなじみのコードですね（LIST<span>10</span>-<span>18</span>）。これでプログラムが完成しました。</p>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span> 10</span>-<span>18</span>　［終了（X）］ボタンのClickイベントハンドラー</p>
</div>
<div>
<div>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)⇒</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
</div>
<p><br /></p>
<p><br /></p>
<p><br /></p>
<div id="calibre_link-290">
<div><b>
<p><b>■プログラムを実行する</b></p>
</b></div>
</div>
<hr />
<p>　コードがすべて入力できたら［開始］ボタン（<img src="images/000124.gif" alt="" />）をクリックして、プログラムを実行します。［キーワード（K）:］ボックスにキーワードを入力し、<img src="images/00137.jpeg" alt="" />キーを押すと、そのキーワードが含まれる行が表示されます。レコードの追加や修正、削除も試してみてください（画面<span>10</span>-<span>18</span>）。</p>
<p><br /></p>
<div>
<p><img src="images/00135.jpeg" alt="" /></p>
</div>
<p><br /></p>
<p><br /></p>
<div>
<div id="calibre_link-301">
<div><b>
<p><b><span><b><img src="images/00053.jpeg" alt="" /><b></b></b></span>LINQクエリを使う</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />IdeaMakerLINQ</p>
</div>
<p><br /></p>
<div>
<p>　Visual Basic 2008からは<span>統合言語クエリ</span>（LINQ：Language-Integrated Query）と呼ばれる方法を使って、SQLクエリを書くのと同じような感覚で柔軟にレコードの操作ができるようになっています。</p>
</div>
<div>
<p>　基本的な書き方は以下のとおりです（LIST<span>10</span>-<span>19</span>）。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>10</span>-<span>19</span>　LINQクエリの書き方</p>
</div>
<div>
<div>
<pre lang="en"><code> Dim 変数名 = From 範囲変数名 In データソース</code></pre>
<pre lang="en"><code>               Where 抽出条件</code></pre>
<pre lang="en"><code>               Select 項目名のリスト</code></pre>
<pre lang="en"><code>               Order By 並べ替えのキー項目</code></pre></div>
</div>
<div></div>
<p><br /></p>
<div>
<p>　検索などの結果は、宣言した変数で参照できます。範囲変数では、データソースの各要素が参照されます。データソースにはテーブルなどを指定します。Where以降の句は、ここでは一部しか示していませんが、SQLクエリと同様の書き方ができます。</p>
</div>
<div>
<p>　例えば、この節のプログラムの検索処理をLINQで書くと次のようになります（LIST<span>10</span>-<span>20</span>）。</p>
</div>
<p><br /></p>
<div>
<p><img src="images/00034.jpeg" alt="" /><span>10</span>-<span>20</span>　LINQクエリを使ってレコードを検索する</p>
</div>
<div>
<div>
<pre lang="en"><code> Dim SelRows = From ideas In IdeadbDataSet.ideatable</code></pre>
<pre lang="en"><code>                       Where(ideas.キーワード Like txtKeyword.Text)</code></pre>
<pre lang="en"><code>    IdeatableDataGridView.Rows.Clear()</code></pre>
<pre lang="en"><code>    For Each aRow As ideadbDataSet.ideatableRow In SelRows</code></pre>
<pre lang="en"><code>        IdeatableDataGridView.Rows.Add(</code></pre>
<pre lang="en"><code>            aRow.ID,</code></pre>
<pre lang="en"><code>            aRow.日付.ToString("yyyy/MM/dd"),</code></pre>
<pre lang="en"><code>            aRow.キーワード,</code></pre>
<pre lang="en"><code>            aRow.アイディア)</code></pre>
<pre lang="en"><code>    Next</code></pre></div>
</div>
<p><br /></p>
<div>
<p>　この場合、データソースがIdeadbDataSet.ideatableというテーブルで、ideasはその中の各要素（各レコード）と考えていいでしょう。範囲変数には好きな変数名が使えるので、別にideasという名前でなくても構いません。Where句には「ideas.キーワード Like txtKeyword.Text」とあるので、キーワードがtxtKeywordコントロールに入力されたパターンと一致するものが抽出されます。抽出の結果はSelRowsという変数で参照できます。それ以降のコードはまったく同じです。</p>
</div>
</div>
<p>　</p>
</div>
</div>
<div id="calibre_link-311">
<div>
<div><b>
<p><b>Chapter<span><b>10</b></span>のまとめ</b></p>
</b></div>
<p><br /></p>
<div><b>
<p><b><span><b>●</b></span><span><b>　</b></span>プロジェクトにデータベースを追加すると、コードを書かなくてもレコードの表示、追加、修正、削除ができます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　データベースから読み出されたデータはTableAdapterコントロールのFillメソッドによりデータセットのテーブルに入れられます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　データセットの内容はTableAdapterコントロールのUpdateメソッドによりデータベースに書き込まれます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　BindingSourceコントロールの働きにより、コントロールとデータセットの間でデータのやりとりができます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　BindingNavigatorコントロールによって、データベースのレコードの表示や追加、修正、削除のできるツールバーが表示されます</b></p>
</b></div>
<div><b>
<p><b><span><b>●</b></span>　BindingSourceコントロールやBindingNavigatorコントロールの機能を使わず、コードを書いてデータベースを取り扱うこともできます</b></p>
</b></div>
</div>
</div>
<div id="calibre_link-13">
<div>
<div id="calibre_link-291">
<div><b>
<p><b>練習問題</b></p>
</b></div>
</div>
<div>
<p><img src="images/00143.jpeg" alt="" />IdeaMaker<span>2</span></p>
</div>
<p><br /></p>
<div>
<div>
<p><span><b>［A］</b></span>このプログラムでは、プログラムの実行時にはDataGridViewコントロールには何も表示されていません。プログラムの実行時にすべてのレコードを表示するようにコードを追加してください。プロジェクト名はIdeaMaker<span>2</span>とします（IdeaMakerにコードを追加しても構いません）。</p>
</div>
</div>
<div>
<div>
<p><br /></p>
</div>
</div>
<div>
<div>
<p><span><b>［B］</b></span>さらに、検索条件をクリアするためのボタンを用意し、検索条件が入力されていないときにはすべてのレコードを表示するようにしてください。</p>
</div>
</div>
<div>
<div>
<p><br /></p>
</div>
</div>
<div>
<div>
<p><span><b>［C］</b></span>このプログラムでは、DataGridViewコントロールの最終行を選択し、［削除］ボタンをクリックするとエラーになります。構造化例外処理を追加し、何も入力されていない行を削除しようした場合にもエラーとならないようにしてください。また、ほかにもエラーが起こる可能性のある箇所があるので、それらにも対処できるようなコードを書いてみてください。</p>
</div>
</div>
</div>
</div>
<div id="calibre_link-59">
<div>
<div id="calibre_link-292">
<div><b>
<p id="calibre_link-358"><b>Appendix</b></p>
</b></div>
</div>
<p><br /></p>
<div><b>
<p><b>付録　確認・練習問題の解答</b></p>
</b></div>
<hr />
<p><br /></p>
<div><b>
<p><b>Chapter<span><b>1</b></span></b></p>
</b></div>
<div><b>
<p><b>▼ 練習問題（P<span><b>32</b></span>）</b></p>
</b></div>
<div>
<p>［A］の解答</p>
</div>
<div>
<p>順に、<span>×</span>、○、○、<span>×</span></p>
</div>
<p><br /></p>
<div>
<p>［B］の解答</p>
</div>
<div>
<p><span>1</span>−（c）　<span>2</span>−（a）　<span>3</span>−（e）　<span>4</span>−（b）　<span>5</span>−（d）</p>
</div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>Chapter<span><b>2</b></span></b></p>
</b></div>
<div><b>
<p><b>▼ 練習問題（P<span><b>70</b></span>）</b></p>
</b></div>
<div>
<p>［A］の解答</p>
</div>
<div>
<p>（あ）−（D）　（い）−（B）　（う）−（E）　（え）−（C）　（お）−（A）</p>
</div>
<p><br /></p>
<div>
<p>［B］の解答</p>
</div>
<div>
<p>（<span>1</span>）ア−（d）　イ−（c）　ウ−（a）　エ−（b）　オ−（e）</p>
</div>
<div>
<p>（<span>2</span>）順に、<span>×</span>、○、<span>×</span>、<span>×</span>、<span>×</span></p>
</div>
<p><br /></p>
<div>
<p>［C］の解答</p>
</div>
<div>
<pre lang="en"><code>    Private Sub ShowMessage(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnMessage.Click</code></pre>
<pre lang="en"><code>        lblMessage.Text = "こんにちは Visual Basic!"</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>Chapter<span><b>3</b></span></b></p>
</b></div>
<div><b>
<p><b>▽ 確認問題（P<span><b>81</b></span>）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>（あ）−（C）　（い）−（E）　（う）−（D）　（え）−（A）</p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<p>整数型（Integerでも可）　　文字列型（Stringでも可）　　倍精度浮動小数点型（Doubleでも可）　　文字列型（Stringでも可）</p>
</div>
<p><br /></p>
<div>
<p><span>3</span>.の解答</p>
</div>
<div>
<p>順に、○、<span>×</span>、<span>×</span>、○</p>
</div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P<span><b>96</b></span>）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、○、<span>×</span>、○、<span>×</span>、<span>×</span>、○</p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>Integer　　Double　　Const　　Private　　Integer</code></pre></div>
<p><br /></p>
<div>
<p><span>3</span>.の解答</p>
</div>
<div>
<p>順に、<span>×</span>、○、○、<span>×</span>、<span>×</span></p>
</div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P110）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、○、<span>×</span>、<span>×</span>、○、<span>×</span></p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<p><span>7</span>　　<span>28</span>　　<span>2</span>.<span>5</span>　　"123456"　　False</p>
</div>
<p><br /></p>
<div>
<p><span>3</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>（1）Dim WeekNumber As Integer = 0</code></pre>
<pre lang="en"><code>（2）WeekNumber = CurrentDay / 7</code></pre>
<pre lang="en"><code>（3）DayOfWeek = StartOffset + CurrentDay Mod 7</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▼ 練習問題（P120）</b></p>
</b></div>
<div>
<p>［A］の解答</p>
</div>
<div>
<pre lang="en"><code>Option Strict On</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub DoCalc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnCalc.Click</code></pre>
<pre lang="en"><code>        Dim Payment As Integer</code></pre>
<pre lang="en"><code>        Dim WorkingTime As Double</code></pre>
<pre lang="en"><code>        Dim PayPerHour, WorkingHour, WorkingMinute As Integer</code></pre>
<pre lang="en"><code>        ' 入力された文字列を数値に変換する</code></pre>
<pre lang="en"><code>        PayPerHour = CInt(txtPayPerHour.Text)</code></pre>
<pre lang="en"><code>        WorkingHour = CInt(txtHour.Text)</code></pre>
<pre lang="en"><code>        WorkingMinute = CInt(txtMinute.Text)</code></pre>
<pre lang="en"><code>        ' 時間の計算をする</code></pre>
<pre lang="en"><code>        WorkingTime = WorkingHour + WorkingMinute / 60</code></pre>
<pre lang="en"><code>        ' 時給を計算する（時給の小数以下は切り上げとする）</code></pre>
<pre lang="en"><code>        Payment = CInt(Math.Ceiling(WorkingTime * PayPerHour))</code></pre>
<pre lang="en"><code>        ' 時給を表示する</code></pre>
<pre lang="en"><code>        lblPayment.Text = Payment.ToString()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<div>
<p>［B］の解答</p>
</div>
<div>
<pre lang="en"><code>Option Strict On</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub DivideValue(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnDivide.Click</code></pre>
<pre lang="en"><code>        Dim a, b As Double</code></pre>
<pre lang="en"><code>        Dim OriginalValue As Double</code></pre>
<pre lang="en"><code>        OriginalValue = CDbl(txtValue.Text)</code></pre>
<pre lang="en"><code>        a = OriginalValue<i><i> ((1 + (1 + Math.Sqrt(5))</i></i> 2))</code></pre>
<pre lang="en"><code>        b = a * ((1 + Math.Sqrt(5)) / 2)</code></pre>
<pre lang="en"><code>        lblA.Text = a.ToString()</code></pre>
<pre lang="en"><code>        lblB.Text = b.ToString()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>Chapter<span><b>4</b></span></b></p>
</b></div>
<div><b>
<p><b>▽ 確認問題（P126）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、<span>×</span>、<span>×</span>、○、<span>×</span></p>
</div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P137）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、○、○、<span>×</span>、○</p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>（1）apX &gt; 100</code></pre>
<pre lang="en"><code>（2）OptionFlag = True（OptionFlagだけでも可）　　Else</code></pre>
<pre lang="en"><code>（3）Or（OrElseでも可）</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P146）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>（1）ElseIf　　ElseIf　　Else</code></pre>
<pre lang="en"><code>（2）Focus()　　SelectAll()　　ElseIf　　Focus()　　SelectAll()　　Else</code></pre></div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>Ifステートメントを以下のように書き換える</code></pre></div>
<p><br /></p>
<div>
<pre lang="en"><code>If Integer.TryParse(txtHour.Text, WorkingHour) = False OrElse</code></pre>
<pre lang="en"><code>WorkingHour &gt;= 24 Then</code></pre>
<pre lang="en"><code>	：</code></pre>
<pre lang="en"><code>ElseIf Integer.TryParse(txtMinute.Text, WorkingMinute) = False OrElse</code></pre>
<pre lang="en"><code>WorkingMinute &gt;= 60 Then</code></pre>
<pre lang="en"><code>	：</code></pre>
<pre lang="en"><code>Else</code></pre>
<pre lang="en"><code>	：</code></pre>
<pre lang="en"><code>End If</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P152）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、○、<span>×</span>、○、○</p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>（1）Select　　Case　　Else　　Select　　　（2）0,5　　Is &lt; 5</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▼ 練習問題（P167）</b></p>
</b></div>
<div>
<p>［A］の解答</p>
</div>
<div>
<pre lang="en"><code>Option Strict On</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub ReCalc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnRecalc.Click</code></pre>
<pre lang="en"><code>        Dim SalesPrice As Integer	' 販売価格</code></pre>
<pre lang="en"><code>        Dim StandardPrice As Integer	' 標準価格</code></pre>
<pre lang="en"><code>        If Integer.TryParse(txtStandardPrice.Text, StandardPrice) =</code></pre>
<pre lang="en"><code>False Then</code></pre>
<pre lang="en"><code>            MessageBox.Show("標準価格に正しい値を入力してください")</code></pre>
<pre lang="en"><code>            txtStandardPrice.Focus()</code></pre>
<pre lang="en"><code>            txtStandardPrice.SelectAll()</code></pre>
<pre lang="en"><code>        Else</code></pre>
<pre lang="en"><code>            If rbNone.Checked = True Then</code></pre>
<pre lang="en"><code>                SalesPrice = StandardPrice</code></pre>
<pre lang="en"><code>            ElseIf rbStudent.Checked = True Then</code></pre>
<pre lang="en"><code>                SalesPrice = CInt(Int(StandardPrice * 0.9))</code></pre>
<pre lang="en"><code>            Else</code></pre>
<pre lang="en"><code>                SalesPrice = CInt(Int(StandardPrice * 0.85))</code></pre>
<pre lang="en"><code>            End If</code></pre>
<pre lang="en"><code>            lblSalesPrice.Text = SalesPrice.ToString("#,##0円")</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<div>
<p>［B］の解答</p>
</div>
<div>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub DoEvaluate(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnShow.Click</code></pre>
<pre lang="en"><code>        Dim Score As Integer</code></pre>
<pre lang="en"><code>        Dim Grade As String</code></pre>
<pre lang="en"><code>        If Integer.TryParse(txtScore.Text, Score) = False _</code></pre>
<pre lang="en"><code>            OrElse Score &lt; 0 OrElse Score &gt; 100 Then</code></pre>
<pre lang="en"><code>            MessageBox.Show("成績を正しく入力してください")</code></pre>
<pre lang="en"><code>            txtScore.Focus()</code></pre>
<pre lang="en"><code>            txtScore.SelectAll()</code></pre>
<pre lang="en"><code>        Else</code></pre>
<pre lang="en"><code>            Select Case Score</code></pre>
<pre lang="en"><code>                Case Is &lt; 60</code></pre>
<pre lang="en"><code>                    Grade = "不可"</code></pre>
<pre lang="en"><code>                Case Is &lt; 70</code></pre>
<pre lang="en"><code>                    Grade = "可"</code></pre>
<pre lang="en"><code>                Case Is &lt; 80</code></pre>
<pre lang="en"><code>                    Grade = "良"</code></pre>
<pre lang="en"><code>                Case Else</code></pre>
<pre lang="en"><code>                    Grade = "優"</code></pre>
<pre lang="en"><code>            End Select</code></pre>
<pre lang="en"><code>            lblGrade.Text = Grade</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>Chapter<span><b>5</b></span></b></p>
</b></div>
<div><b>
<p><b>▽ 確認問題（P184）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、<span>×</span>、○、○、<span>×</span></p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>（1）Until　　+=　　　（2）While　　&lt;</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P188）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、○、<span>×</span>、<span>×</span></p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>（1）To　　Step　　　（2）Integer　　2　　InputNumber</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P193）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、<span>×</span>、○、<span>×</span></p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>（1）For　　MyCollection　　Next　　　（2）Each　　In</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P201）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、<span>×</span>、<span>×</span>、○</p>
</div>
<p><br /></p>
<div><b>
<p><b>▼ 練習問題（P210）</b></p>
</b></div>
<div>
<p>［A］の解答</p>
</div>
<div>
<pre lang="en"><code>Option Strict On</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles MyBase.Load</code></pre>
<pre lang="en"><code>        Dim r As Random = New Random()</code></pre>
<pre lang="en"><code>        lstScore.Items.Clear()</code></pre>
<pre lang="en"><code>        For i = 0 To 9</code></pre>
<pre lang="en"><code>            lstScore.Items.Add(r.Next(101))</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub SearchMinValue(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnMinValue.Click</code></pre>
<pre lang="en"><code>        Dim MinScore As Integer</code></pre>
<pre lang="en"><code>        MinScore = Integer.MaxValue</code></pre>
<pre lang="en"><code>        For Each Score As Integer In lstScore.Items</code></pre>
<pre lang="en"><code>            If Score &lt; MinScore Then</code></pre>
<pre lang="en"><code>                MinScore = Score</code></pre>
<pre lang="en"><code>            End If</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>        MessageBox.Show("最低点は" &amp; MinScore &amp; "です")</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<div>
<p>［B］の解答</p>
</div>
<div>
<pre lang="en"><code>Option Strict On</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles MyBase.Load</code></pre>
<pre lang="en"><code>        Dim r As Random = New Random()</code></pre>
<pre lang="en"><code>        lstScore.Items.Clear()</code></pre>
<pre lang="en"><code>        For i = 0 To 9</code></pre>
<pre lang="en"><code>            lstScore.Items.Add(r.Next(101))</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub CountProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnPassCount.Click</code></pre>
<pre lang="en"><code>        Dim PassCount As Integer = 0</code></pre>
<pre lang="en"><code>        For Each Score As Integer In lstScore.Items</code></pre>
<pre lang="en"><code>            If Score &gt;= 60 Then</code></pre>
<pre lang="en"><code>                PassCount += 1</code></pre>
<pre lang="en"><code>            End If</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>        MessageBox.Show("合格者数は" &amp; PassCount &amp; "人です")</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>Chapter<span><b>6</b></span></b></p>
</b></div>
<div><b>
<p><b>▽ 確認問題（P215）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、<span>×</span>、○、<span>×</span>、○、<span>×</span></p>
</div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P223）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>（あ）−（E）　（い）−（F）　（う）−（C）　（え）−（B）　（お）−（A）</p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<p><span>5</span>　　<span>5</span>　　<span>5</span>　　<span>10</span>　　<span>11</span>　　エラー</p>
</div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P229）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>（1）99　　For　　99　　FREE　　If　　Mod　　VIPONLY</code></pre>
<pre lang="en"><code>（2）99　　Boolean　　For　　99　　idx　　For　　9　　HIT</code></pre>
<pre lang="en"><code>（3）j　　i</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▼ 練習問題（P238）</b></p>
</b></div>
<div>
<p>［A］の解答</p>
</div>
<div>
<pre lang="en"><code>Option Strict On</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sales() As Integer = {1230, 890, 1450, 1520, 1380, 1090}</code></pre>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles MyBase.Load</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To UBound(Sales)</code></pre>
<pre lang="en"><code>            lstSales.Items.Add(Sales(i))</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub DoCalc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnCalc.Click</code></pre>
<pre lang="en"><code>        Dim Sum As Integer = 0</code></pre>
<pre lang="en"><code>        Dim Average As Double, SD As Double</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To UBound(Sales)</code></pre>
<pre lang="en"><code>            Sum += Sales(i)</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>        Average = Sum / Sales.Length</code></pre>
<pre lang="en"><code>        Dim SSE As Double = 0</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To UBound(Sales)</code></pre>
<pre lang="en"><code>            SSE += (Sales(i) - Average) ^ 2</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>        SD = Math.Sqrt(SSE / Sales.Length)</code></pre>
<pre lang="en"><code>        lblSum.Text = Sum.ToString()</code></pre>
<pre lang="en"><code>        lblAverage.Text = Average.ToString("F1")</code></pre>
<pre lang="en"><code>        lblSD.Text = SD.ToString("F2")</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<div>
<p>［B］の解答</p>
</div>
<div>
<pre lang="en"><code>Option Strict On</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sales() As Integer = {1230, 890, 1450, 1520, 1380, 1090}</code></pre>
<pre lang="en"><code>    Private Sub DoCalc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnCalc.Click</code></pre>
<pre lang="en"><code>        Dim Sum As Integer = 0</code></pre>
<pre lang="en"><code>        Dim Average As Double, SD As Double</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To UBound(Sales)</code></pre>
<pre lang="en"><code>            Sum += Sales(i)</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>        Average = Sum / Sales.Length</code></pre>
<pre lang="en"><code>        Dim SSE As Double = 0</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To UBound(Sales)</code></pre>
<pre lang="en"><code>            SSE += (Sales(i) - Average) ^ 2</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>        SD = Math.Sqrt(SSE / Sales.Length)</code></pre>
<pre lang="en"><code>        lblSum.Text = Sum.ToString()</code></pre>
<pre lang="en"><code>        lblAverage.Text = Average.ToString("F1")</code></pre>
<pre lang="en"><code>        lblSD.Text = SD.ToString("F2")</code></pre>
<pre lang="en"><code>        Dim SS As Double</code></pre>
<pre lang="en"><code>        lstSalesSD.Items.Clear()</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To UBound(Sales)</code></pre>
<pre lang="en"><code>            SS = (Sales(i) - Average) / SD * 10 + 50</code></pre>
<pre lang="en"><code>            lstSalesSD.Items.Add(SS.ToString("F1"))</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<div>
<p>［C］の解答</p>
</div>
<div>
<pre lang="en"><code>Option Strict On</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub DoCalc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnCalc.Click</code></pre>
<pre lang="en"><code>        Dim Sum As Integer = 0</code></pre>
<pre lang="en"><code>        Dim Average As Double, SD As Double</code></pre>
<pre lang="en"><code>        Dim SS As Double = 0    ' 各データの2乗の総合計</code></pre>
<pre lang="en"><code>        Dim Sales() As Integer = {1230, 890, 1450, 1520, 1380, 1090}</code></pre>
<pre lang="en"><code>        For i As Integer = 0 To UBound(Sales)</code></pre>
<pre lang="en"><code>            Sum += Sales(i)</code></pre>
<pre lang="en"><code>            SS += Sales(i) ^ 2</code></pre>
<pre lang="en"><code>        Next</code></pre>
<pre lang="en"><code>        Average = Sum / Sales.Length</code></pre>
<pre lang="en"><code>        SD = Math.Sqrt((Sales.Length * SS - Sum ^ 2) / Sales.Length</code></pre>
<pre lang="en"><code>^ 2)</code></pre>
<pre lang="en"><code>        lblSum.Text = Sum.ToString()</code></pre>
<pre lang="en"><code>        lblAverage.Text = Average.ToString("F1")</code></pre>
<pre lang="en"><code>        lblSD.Text = SD.ToString("F2")</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>Chapter<span><b>7</b></span></b></p>
</b></div>
<div><b>
<p><b>▽ 確認問題（P244）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、○、<span>×</span>、○、○、<span>×</span></p>
</div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P251）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>（あ）−（D）　（い）−（E）　（う）−（A）　（え）−（C）</p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>（1）Multiply2　　Private　　Sub　　Sub</code></pre>
<pre lang="en"><code>（2）Private　　Sub　　String　　String　　End　　Sub</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P256）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>（あ）−（B）　（い）−（C）　（う）−（F）　（え）−（A）　（お）−（D）</p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>（1）Add2　　Private　　Function　　Double　　Return（Add2 =でも可）　　Function</code></pre>
<pre lang="en"><code>（2）Private　　Function　　GetBMI　　Double　　Double　　Double　　Return　　Return（GetBMI =でも可）　　End　　Function</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P267）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>（<span>1</span>）<span>3</span>.<span>14</span>　　　（<span>2</span>）<span>6</span>.<span>28</span>　　　（<span>3</span>）今日の日付：　　　（<span>4</span>）秋</p>
</div>
<p><br /></p>
<div><b>
<p><b>▼ 練習問題（P279）</b></p>
</b></div>
<div>
<p>［A］の解答</p>
</div>
<div>
<pre lang="en"><code>    Private Function Limit0To255(value As Integer) As Integer</code></pre>
<pre lang="en"><code>        Return Math.Max(0, Math.Min(255, value))</code></pre>
<pre lang="en"><code>    End Function</code></pre></div>
<p><br /></p>
<div>
<p>［B］の解答</p>
</div>
<div>
<pre lang="en"><code>    Private Sub ChangeTrackBar(txtSource As TextBox,</code></pre>
<pre lang="en"><code>trbTarget As TrackBar)</code></pre>
<pre lang="en"><code>        Dim ColorValue As Integer</code></pre>
<pre lang="en"><code>        If Integer.TryParse(txtSource.Text, ColorValue) Then</code></pre>
<pre lang="en"><code>            trbTarget.Value = Limit0To255(ColorValue)</code></pre>
<pre lang="en"><code>        Else</code></pre>
<pre lang="en"><code>            MessageBox.Show("0〜255の整数を入力してください")</code></pre>
<pre lang="en"><code>            txtSource.Focus()</code></pre>
<pre lang="en"><code>            txtSource.SelectAll()</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>Chapter<span><b>8</b></span></b></p>
</b></div>
<div><b>
<p><b>▽ 確認問題（P284）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、○、<span>×</span>、○、<span>×</span>、○</p>
</div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P290）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>（1）New　　Subject　　Body　　New　　Send</code></pre>
<pre lang="en"><code>（2）New　　LoadXml　　InnerText</code></pre>
<pre lang="en"><code>（3）SetText　　Clipboard</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P305）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>（あ）−（C）　（い）−（B）　（う）−（D）　（え）−（E）　（お）−（A）</p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>String　　Property　　mName　　value</code></pre></div>
<p><br /></p>
<div>
<p><span>3</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>Sub　　Eat　　+=　　value</code></pre></div>
<p><br /></p>
<div><b>
<p><b>▽ 確認問題（P313）</b></p>
</b></div>
<div>
<p><span>1</span>.の解答</p>
</div>
<div>
<p>順に、<span>×</span>、○、○、<span>×</span>、○</p>
</div>
<p><br /></p>
<div>
<p><span>2</span>.の解答</p>
</div>
<div>
<pre lang="en"><code>Rogue　　Rogue　　Protected　　Inherits　　Implements　　mHitPoint　　</code></pre>
<pre lang="en"><code>Implements　　IMagic.Mp　　Interface　　Interface</code></pre></div>
<div><b>
<p><b><br /><b></b></b></p>
<p><b>▼ 練習問題（P326）</b></p>
</b></div>
<div>
<p>［A］の解答</p>
</div>
<div>
<pre lang="en"><code>Public Class Insectroid</code></pre>
<pre lang="en"><code>    Private apX As Integer</code></pre>
<pre lang="en"><code>    Private apY As Integer</code></pre>
<pre lang="en"><code>    Private r As Random = New Random()</code></pre>
<pre lang="en"><code>    Sub New()</code></pre>
<pre lang="en"><code>        apX = 10</code></pre>
<pre lang="en"><code>        apY = 10</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Public Property X() As Integer</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return apX</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(ByVal value As Integer)</code></pre>
<pre lang="en"><code>            apX = value</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>    Public Property Y() As Integer</code></pre>
<pre lang="en"><code>        Get</code></pre>
<pre lang="en"><code>            Return apY</code></pre>
<pre lang="en"><code>        End Get</code></pre>
<pre lang="en"><code>        Set(ByVal value As Integer)</code></pre>
<pre lang="en"><code>            apY = value</code></pre>
<pre lang="en"><code>        End Set</code></pre>
<pre lang="en"><code>    End Property</code></pre>
<pre lang="en"><code>    Public Sub RandomWalk()</code></pre>
<pre lang="en"><code>        apX += r.Next(-1, 2)</code></pre>
<pre lang="en"><code>        apY += r.Next(-1, 2)</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<div>
<p>［B］の解答</p>
</div>
<div>
<pre lang="en"><code>Option Strict On</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private anInsect As Insectroid</code></pre>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles MyBase.Load</code></pre>
<pre lang="en"><code>        anInsect = New Insectroid()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub RandomWalk(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnWalk.Click</code></pre>
<pre lang="en"><code>        anInsect.RandomWalk()</code></pre>
<pre lang="en"><code>        lblPosition.Text = "X:" &amp; anInsect.X.ToString() &amp; "-Y:" &amp;</code></pre>
<pre lang="en"><code>anInsect.Y.ToString()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>    Private Sub ExitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnExit.Click</code></pre>
<pre lang="en"><code>        Application.Exit()</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>Chapter<span><b>9</b></span></b></p>
</b></div>
<div><b>
<p><b>▼ 練習問題（P356）</b></p>
</b></div>
<div>
<p>［A］の解答</p>
</div>
<div>
<p>［次（N）］ボタンをフォームに配置し、フォームのLoadイベントハンドラーを以下のように変える。［次（N）］ボタンのコントロール名はbtnNextとする。</p>
<p><br /></p>
</div>
<div>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs) ⇒</code></pre>
<pre lang="en"><code>Handles MyBase.Load, btnNext.Click</code></pre>
<pre lang="en"><code>	：</code></pre>
<pre lang="en"><code>（これ以降はまったく同じ）</code></pre></div>
<p><br /></p>
<div>
<p>［B］の解答</p>
</div>
<div>
<pre lang="en"><code>Imports Microsoft.VisualBasic.FileIO</code></pre>
<pre lang="en"><code>Public Class Form1</code></pre>
<pre lang="en"><code>    Private Sub ShowFixedFile(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles Button1.Click</code></pre>
<pre lang="en"><code>        Dim aRow As String()</code></pre>
<pre lang="en"><code>        Try</code></pre>
<pre lang="en"><code>            Dim tfp As TextFieldParser = New TextFieldParser(</code></pre>
<pre lang="en"><code>"sample.txt", System.Text.Encoding.GetEncoding("shift_jis"))</code></pre>
<pre lang="en"><code>            tfp.TextFieldType = FieldType.FixedWidth</code></pre>
<pre lang="en"><code>            tfp.FieldWidths = New Integer() {5, 4, 4, 3}</code></pre>
<pre lang="en"><code>            Do While Not tfp.EndOfData</code></pre>
<pre lang="en"><code>                aRow = tfp.ReadFields()</code></pre>
<pre lang="en"><code>                For Each aField As String In aRow</code></pre>
<pre lang="en"><code>                    Debug.WriteLine(aField)</code></pre>
<pre lang="en"><code>                Next</code></pre>
<pre lang="en"><code>            Loop</code></pre>
<pre lang="en"><code>        Catch ex As System.IO.FileNotFoundException</code></pre>
<pre lang="en"><code>            MessageBox.Show("ファイルが見つかりません")</code></pre>
<pre lang="en"><code>            Application.Exit()</code></pre>
<pre lang="en"><code>        Catch ex As MalformedLineException</code></pre>
<pre lang="en"><code>            MessageBox.Show("フィールドの形式が正しくありません")</code></pre>
<pre lang="en"><code>            Application.Exit()</code></pre>
<pre lang="en"><code>        End Try</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code>End Class</code></pre></div>
<p><br /></p>
<p><br /></p>
<div><b>
<p><b>Chapter<span><b>10</b></span></b></p>
</b></div>
<div><b>
<p><b>▼ 練習問題（P396）</b></p>
</b></div>
<div>
<p>［A］の解答</p>
</div>
<div>
<p>フォームのLoadイベントハンドラーを以下のように書き換える。</p>
</div>
<p><br /></p>
<div>
<pre lang="en"><code>    Private Sub Form1_Load(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles MyBase.Load</code></pre>
<pre lang="en"><code>        Try</code></pre>
<pre lang="en"><code>            Me.IdeatableTableAdapter.Fill(Me.IdeadbDataSet.ideatable)</code></pre>
<pre lang="en"><code>            txtKeyword.Text = ""</code></pre>
<pre lang="en"><code>            IdeatableDataGridView.Rows.Clear()</code></pre>
<pre lang="en"><code>            For Each aRow As ideadbDataSet.ideatableRow In</code></pre>
<pre lang="en"><code>IdeadbDataSet.ideatable.Rows</code></pre>
<pre lang="en"><code>                IdeatableDataGridView.Rows.Add(</code></pre>
<pre lang="en"><code>aRow.ID, aRow.日付.ToString("yyyy/MM/dd"), aRow.キーワード, aRow.アイディア)</code></pre>
<pre lang="en"><code>            Next</code></pre>
<pre lang="en"><code>        Catch ex As Exception</code></pre>
<pre lang="en"><code>            MessageBox.Show("データが読み出せません")</code></pre>
<pre lang="en"><code>            Application.Exit()</code></pre>
<pre lang="en"><code>        End Try</code></pre>
<pre lang="en"><code>    End Sub</code></pre></div>
<p><br /></p>
<div>
<p>［B］の解答</p>
</div>
<div>
<p>［クリア］ボタンをフォームに配置し、フォームのLoadイベントハンドラーを以下のように変える。［クリア］ボタンのコントロール名はbtnClearとする。</p>
</div>
<p><br /></p>
<div>
<pre lang="en"><code>    Private Sub InitProc(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles MyBase.Load, btnClear.Click</code></pre>
<pre lang="en"><code>	：</code></pre>
<pre lang="en"><code>（これ以降はまったく同じ）</code></pre></div>
<p><br /></p>
<div>
<p>［C］の解答</p>
</div>
<div>
<p>SearchData、AddData、ChangeData、DeleteDataの各プロシージャを以下のように書き換える。Try ... Catch ... End Tryに注目。</p>
</div>
<p><br /></p>
<div>
<pre lang="en"><code>    Private Sub SearchData(sender As Object, e As KeyEventArgs)</code></pre>
<pre lang="en"><code>Handles txtKeyword.KeyDown</code></pre>
<pre lang="en"><code>        If e.KeyCode &lt;&gt; Keys.Enter Then Exit Sub ' Enterキーを押した</code></pre>
<pre lang="en"><code>ときだけ実行</code></pre>
<pre lang="en"><code>        Dim Keyword As String</code></pre>
<pre lang="en"><code>        If txtKeyword.Text = "" Then</code></pre>
<pre lang="en"><code>            Keyword = "*"</code></pre>
<pre lang="en"><code>        Else</code></pre>
<pre lang="en"><code>            Keyword = txtKeyword.Text</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>        Try</code></pre>
<pre lang="en"><code>            Dim SelRows As DataRow()</code></pre>
<pre lang="en"><code>            SelRows = IdeadbDataSet.ideatable.Select(</code></pre>
<pre lang="en"><code>                "キーワード LIKE '" &amp; Keyword &amp; "'")</code></pre>
<pre lang="en"><code>            IdeatableDataGridView.Rows.Clear()</code></pre>
<pre lang="en"><code>            For Each aRow As ideadbDataSet.ideatableRow In SelRows</code></pre>
<pre lang="en"><code>                IdeatableDataGridView.Rows.Add(aRow.ID, aRow.日付.To</code></pre>
<pre lang="en"><code>String("yyyy/MM/dd"), aRow.キーワード, aRow.アイディア)</code></pre>
<pre lang="en"><code>            Next</code></pre>
<pre lang="en"><code>        Catch ex As EvaluateException</code></pre>
<pre lang="en"><code>            MessageBox.Show("検索条件の指定が間違っています")</code></pre>
<pre lang="en"><code>        Catch ex As Exception</code></pre>
<pre lang="en"><code>            MessageBox.Show("データが読み出せません")</code></pre>
<pre lang="en"><code>            Application.Exit()</code></pre>
<pre lang="en"><code>        End Try</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    Private Sub AddData(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnNew.Click</code></pre>
<pre lang="en"><code>        dlgRecord.Text = "レコードの追加"</code></pre>
<pre lang="en"><code>        dlgRecord.txtKeyword.Text = ""</code></pre>
<pre lang="en"><code>        dlgRecord.txtIdea.Text = ""</code></pre>
<pre lang="en"><code>        If (dlgRecord.ShowDialog() = DialogResult.OK) Then</code></pre>
<pre lang="en"><code>            Try</code></pre>
<pre lang="en"><code>                Dim aRow As DataRow</code></pre>
<pre lang="en"><code>                aRow = IdeadbDataSet.ideatable.NewRow()</code></pre>
<pre lang="en"><code>                aRow.Item("日付") = Today</code></pre>
<pre lang="en"><code>                aRow.Item("キーワード") = dlgRecord.txtKeyword.Text</code></pre>
<pre lang="en"><code>                aRow.Item("アイディア") = dlgRecord.txtIdea.Text</code></pre>
<pre lang="en"><code>                IdeadbDataSet.ideatable.Rows.Add(aRow)</code></pre>
<pre lang="en"><code>                IdeatableTableAdapter.Update(IdeadbDataSet.ideatable)</code></pre>
<pre lang="en"><code>                IdeatableTableAdapter.Fill(IdeadbDataSet.ideatable)</code></pre>
<pre lang="en"><code>                ' 表示を更新する（ここではキーワードはクリアする）</code></pre>
<pre lang="en"><code>                txtKeyword.Text = ""</code></pre>
<pre lang="en"><code>                IdeatableDataGridView.Rows.Clear()</code></pre>
<pre lang="en"><code>                ' aRowという変数名をすでに使っているので別の名前にする</code></pre>
<pre lang="en"><code>                For Each aRow1 As ideadbDataSet.ideatableRow In</code></pre>
<pre lang="en"><code>    IdeadbDataSet.ideatable.Rows</code></pre>
<pre lang="en"><code>                    IdeatableDataGridView.Rows.Add(</code></pre>
<pre lang="en"><code>                        aRow1.ID,</code></pre>
<pre lang="en"><code>                        aRow1.日付.ToString("yyyy/MM/dd"),</code></pre>
<pre lang="en"><code>                        aRow1.キーワード,</code></pre>
<pre lang="en"><code>                        aRow1.アイディア)</code></pre>
<pre lang="en"><code>                Next</code></pre>
<pre lang="en"><code>            Catch ex As Exception</code></pre>
<pre lang="en"><code>                MessageBox.Show("データの追加ができません")</code></pre>
<pre lang="en"><code>                Application.Exit()</code></pre>
<pre lang="en"><code>            End Try</code></pre>
<pre lang="en"><code>        End If</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    Private Sub ChangeData(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnChange.Click</code></pre>
<pre lang="en"><code>        If IdeatableDataGridView.CurrentRow Is Nothing Then Exit Sub</code></pre>
<pre lang="en"><code>        With IdeatableDataGridView.CurrentRow</code></pre>
<pre lang="en"><code>            dlgRecord.Text = "レコードの修正"</code></pre>
<pre lang="en"><code>            dlgRecord.txtKeyword.Text = .Cells(2).Value.ToString()</code></pre>
<pre lang="en"><code>            dlgRecord.txtIdea.Text = .Cells(3).Value.ToString()</code></pre>
<pre lang="en"><code>            If dlgRecord.ShowDialog() = DialogResult.OK Then</code></pre>
<pre lang="en"><code>                Try</code></pre>
<pre lang="en"><code>                    Dim SelRows As DataRow()</code></pre>
<pre lang="en"><code>                    SelRows = IdeadbDataSet.ideatable.Select(</code></pre>
<pre lang="en"><code>"ID='" &amp; .Cells(0).Value.ToString() &amp; "'")</code></pre>
<pre lang="en"><code>                    SelRows(0).Item("日付") = Today</code></pre>
<pre lang="en"><code>                    SelRows(0).Item("キーワード") =</code></pre>
<pre lang="en"><code>                        dlgRecord.txtKeyword.Text</code></pre>
<pre lang="en"><code>                    SelRows(0).Item("アイディア") =</code></pre>
<pre lang="en"><code>                        dlgRecord.txtIdea.Text</code></pre>
<pre lang="en"><code>                    ' データベース更新</code></pre>
<pre lang="en"><code>                    IdeatableTableAdapter.Update(IdeadbDataSet.ideatable)</code></pre>
<pre lang="en"><code>                    ' 表示の更新</code></pre>
<pre lang="en"><code>                    .Cells(1).Value = Today.ToString("yyyy/MM/dd")</code></pre>
<pre lang="en"><code>                    .Cells(2).Value = dlgRecord.txtKeyword.Text</code></pre>
<pre lang="en"><code>                    .Cells(3).Value = dlgRecord.txtIdea.Text</code></pre>
<pre lang="en"><code>                Catch ex As NullReferenceException</code></pre>
<pre lang="en"><code>                    MessageBox.Show("レコードが選択されていません")</code></pre>
<pre lang="en"><code>                Catch ex As Exception</code></pre>
<pre lang="en"><code>                    MessageBox.Show("データの更新ができません")</code></pre>
<pre lang="en"><code>                    Application.Exit()</code></pre>
<pre lang="en"><code>                End Try</code></pre>
<pre lang="en"><code>            End If</code></pre>
<pre lang="en"><code>        End With</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code></code></pre>
<pre lang="en"><code>    Private Sub DeleteData(sender As Object, e As EventArgs)</code></pre>
<pre lang="en"><code>Handles btnDelete.Click</code></pre>
<pre lang="en"><code>        Try</code></pre>
<pre lang="en"><code>            Dim SelRows As DataRow()</code></pre>
<pre lang="en"><code>            SelRows = IdeadbDataSet.ideatable.Select("ID='" &amp;</code></pre>
<pre lang="en"><code>IdeatableDataGridView.CurrentRow.Cells(0).Value.ToString() &amp; "'")</code></pre>
<pre lang="en"><code>            If MessageBox.Show("本当に削除していいですか？", "削除",</code></pre>
<pre lang="en"><code>MessageBoxButtons.YesNo) = DialogResult.Yes Then</code></pre>
<pre lang="en"><code>                SelRows(0).Delete()</code></pre>
<pre lang="en"><code>                IdeatableTableAdapter.Update(IdeadbDataSet.ideatable)</code></pre>
<pre lang="en"><code>                IdeatableDataGridView.Rows.Remove(</code></pre>
<pre lang="en"><code>                    IdeatableDataGridView.CurrentRow)</code></pre>
<pre lang="en"><code>            End If</code></pre>
<pre lang="en"><code>        Catch ex As NullReferenceException</code></pre>
<pre lang="en"><code>            MessageBox.Show("レコードが選択されていません")</code></pre>
<pre lang="en"><code>        Catch ex As Exception</code></pre>
<pre lang="en"><code>            MessageBox.Show("データの削除ができません" &amp; ex.ToString)</code></pre>
<pre lang="en"><code>            Application.Exit()</code></pre>
<pre lang="en"><code>        End Try</code></pre>
<pre lang="en"><code>    End Sub</code></pre>
<pre lang="en"><code></code></pre></div>
</div>
</div>
<div id="calibre_link-353">
<div>
<p><span><b>■ 著者</b></span></p>
<p><span>羽山 博（はやま ひろし）</span></p>
<hr />
<p><span>　1961年大阪生まれ。京都大学文学部哲学科（心理学専攻）卒業後、日本電気株式会社でコンピューターのユーザー教育や社内要員教育を担当。1991年にライターとして独立し、ソフトウェアの基本からプログラミング、認知科学まで幅広く雑誌や書籍で執筆。Visual Basicとのつきあいは『ビギナーズVisual Basic』『アドバンスドVisual Basic』（いずれも1994年、インプレス）の執筆から。当時のバージョンはまだ<span>2</span>.<span>0</span>であった。2006年には東京大学大学院学際情報学府博士課程を単位取得後退学。現在、有限会社ローグ・インターナショナル代表取締役、東京大学、お茶の水女子大学、青山学院大学、日本大学講師。最近の趣味は献血、書道、絵画、ウクレレ。熱烈なトレッキー（スタートレックのファン）でもある。</span></p>
<p><span>　著書には『イラストでよくわかるAndroidアプリのつくり方Android Studio対応版』、『できる大事典  Windows<span>10</span> Home/Pro/Enterprise対応』『できるExcel 関数&amp;マクロ 困った！ &amp;便利技パーフェクトブック』『できるやさしく学ぶExcel統計入門　難しいことはパソコンにまかせて仕事で役立つデータ分析ができる本』（以上インプレス）、『WSHクイックリファレンス』（オライリー / オーム社）、『らくらくマスター  例解  LPICレベル<span>1</span>教科書』『らくらくマスター  実践  LPICレベル<span>1</span>問題集』（以上、共著・オーム社）、『Pages&amp;Numbersで仕事。』『Keynoteでプレゼン。〔改訂版〕』（BNN新社）、『プログラミングの基礎』（マイナビ出版）などがある。</span></p>
<p><br /></p>
<p><br /></p>
</div>
</div>
<div id="calibre_link-302">
<div>
<h2 id="calibre_link-359">　STAFF</h2>
<p><br /></p>
<p><span>　カバーデザイン　ハヤカワデザイン・早川いくを</span></p>
<p><span>　本文デザイン　トップスタジオ</span></p>
<p><span>　本文レイアウト　トップスタジオ</span></p>
<p><span>　イラスト　サワダサワコ</span></p>
<p><br /></p>
<p><span>　編集　鈴木教之（コンピューターテクノロジー編集部）、伊藤隆司(コンピューターテクノロジー編集部)</span></p>
</div>
</div>
<div id="calibre_link-21">
<div>
<p><img src="images/00011.jpeg" alt="" /></p>
</div>
</div>




<script>function myFunction(){document.getElementById("tateyoko").classList.toggle("tateread")}</script></body></html>